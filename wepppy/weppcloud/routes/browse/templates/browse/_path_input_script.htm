<script>
document.addEventListener('DOMContentLoaded', () => {
    const pathInput = document.getElementById('pathInput');
    if (!pathInput) return;

    function deriveBaseDirPath(pathname) {
        if (pathname.endsWith('/')) {
            return pathname;
        }
        const lastSlash = pathname.lastIndexOf('/');
        const lastSegment = pathname.slice(lastSlash + 1);
        const hasWildcard = /[*?\[\]]/.test(lastSegment);
        if (hasWildcard) {
            // Strip the existing wildcard filter so a new search replaces it.
            return pathname.slice(0, lastSlash + 1);
        }
        return pathname + '/';
    }

    function handleNavigation(event) {
        if (event.key !== 'Enter') return;
        event.preventDefault();

        const path = pathInput.value.trim();
        if (!path) return;

        const currentUrl = new URL(window.location.href);
        const searchParams = currentUrl.search;
        let newUrl;

        if (path.startsWith('/')) {
            const baseUrl = `/weppcloud/runs/{{ runid }}/{{ config }}/browse`;
            newUrl = baseUrl + path;
        } else {
            const baseHref = currentUrl.origin + deriveBaseDirPath(currentUrl.pathname);

            const resolvedUrl = new URL(path, baseHref);
            newUrl = resolvedUrl.pathname;
        }

        window.location.href = newUrl + searchParams;
    }

    pathInput.addEventListener('keydown', handleNavigation);
    pathInput.disabled = false;
    pathInput.readOnly = false;

    requestAnimationFrame(() => {
        pathInput.focus({ preventScroll: true });
        const pos = pathInput.value.length;
        try {
            pathInput.setSelectionRange(pos, pos);
        } catch (_) {}
    });
});
</script>
