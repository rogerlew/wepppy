{% extends "base_pure.htm" %}

{% block title %}Fork Project Console â€“ {{ runid }}{% endblock %}

{% from "shared/console_macros.htm" import console_page, console_header, button_row %}
{% import "controls/_pure_macros.html" as ui %}

{% block head_extras %}
  {{ super() }}
  {% if not current_user.is_authenticated %}
  <style>
    .wc-cap-prompt {
      display: grid;
      gap: var(--wc-space-xs);
      max-width: 360px;
    }

    .wc-cap-trigger {
      appearance: none;
      border: 1px solid var(--wc-color-border);
      background: var(--wc-color-surface);
      border-radius: var(--wc-radius-sm);
      box-shadow: var(--wc-shadow-sm);
      padding: var(--wc-space-sm) var(--wc-space-md);
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: var(--wc-space-sm);
      align-items: center;
      text-align: left;
      width: 100%;
      color: var(--wc-color-text);
      font: inherit;
      cursor: pointer;
    }

    .wc-cap-trigger:hover {
      border-color: var(--wc-color-border-strong);
    }

    .wc-cap-trigger:focus-visible {
      outline: 2px solid var(--wc-color-primary);
      outline-offset: 2px;
    }

    .wc-cap-checkbox {
      width: 1.1rem;
      height: 1.1rem;
      border: 2px solid var(--wc-color-border-strong);
      border-radius: 0.2rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--wc-color-surface);
      flex-shrink: 0;
    }

    .wc-cap-label {
      font-weight: 600;
    }

    .wc-cap-brand {
      display: grid;
      justify-items: end;
      gap: 2px;
      font-size: 0.65rem;
      color: var(--wc-color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .wc-cap-brand-mark {
      font-weight: 700;
      letter-spacing: 0.16em;
      color: var(--wc-color-text);
    }

    .wc-cap-brand-text {
      font-size: 0.6rem;
      text-transform: none;
      letter-spacing: 0.04em;
    }

    .wc-cap-status {
      font-size: var(--wc-font-size-sm);
      color: var(--wc-color-text-muted);
    }

    .wc-cap-prompt[data-cap-verified="true"] .wc-cap-status {
      color: var(--wc-color-positive);
    }

    .wc-cap-trigger.is-verified,
    .wc-cap-trigger[disabled] {
      cursor: default;
    }

    .wc-cap-trigger.is-verified {
      opacity: 0.85;
    }

    .wc-cap-trigger.is-verified .wc-cap-checkbox {
      border-color: var(--wc-color-text);
      background: color-mix(in srgb, var(--wc-color-positive) 12%, var(--wc-color-surface));
    }

    .wc-cap-trigger.is-verified .wc-cap-checkbox::after {
      content: "";
      width: 0.35rem;
      height: 0.6rem;
      border-right: 2px solid var(--wc-color-text);
      border-bottom: 2px solid var(--wc-color-text);
      transform: rotate(45deg);
      margin-top: -0.1rem;
    }
  </style>
  {% endif %}
{% endblock %}

{% block body %}
{% call console_page(data_controller="fork-console") %}
  {% call console_header(
    run_link=url_for_run('run_0.runs0', runid=runid, config=config),
    run_label=runid,
    title="Fork Project",
    subtitle="Submit a fork job for this run."
  ) %}{% endcall %}

  {% set fork_console_wrap = False %}
  {% include 'controls/fork_console_control.htm' with context %}
{% endcall %}
{% endblock %}

{% block script_extras %}
<script src="{{ url_for('static', filename='js/controllers-gl.js') }}" defer></script>
<script src="{{ url_for('static', filename='vendor/jquery/jquery.js') }}"></script>
<script src="{{ url_for('static', filename='js/console_utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/status_stream.js') }}"></script>
{% if not current_user.is_authenticated %}
<script>
  window.CAP_CUSTOM_WASM_URL = "{{ cap_asset_base_url }}/cap_wasm.js";
</script>
<script src="{{ cap_asset_base_url }}/widget.js" defer></script>
<script src="{{ cap_asset_base_url }}/floating.js" defer></script>
{% endif %}
<script src="{{ url_for('static', filename='js/fork_console.js') }}"></script>
{% endblock %}
