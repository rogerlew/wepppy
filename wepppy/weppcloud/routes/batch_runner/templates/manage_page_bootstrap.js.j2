<!-- wepppy/weppcloud/routes/batch_runner/templates/manage_page_bootstrap.js.j2 -->
<script>
"use strict";

var site_prefix = {{ site_prefix | tojson }};
var runid = {{ runid | tojson }};
var config = {{ base_config | tojson }};
var ispoweruser = {{ user.has_role('PowerUser') | tojson }};
var WEPP_channel_critical_shear = null;
var error = null;
var cellsize = {{ ron.cellsize | default(0, true) | tojson }};
var readonly = {{ ron.readonly | tojson }};
var pup_relpath = {{ pup_relpath | tojson }};

window.site_prefix = site_prefix;
window.runid = runid;
window.config = config;
window.ispoweruser = ispoweruser;
window.pup_relpath = pup_relpath;

window.batchRunnerBootstrap = {
    enabled: {{ feature_enabled | tojson }},
    batchName: {{ batch_name | tojson }},
    sitePrefix: {{ site_prefix | tojson }},
    geojsonLimitMb: {{ geojson_limit_mb | default(10, true) | tojson }},
    state: {{ batch_runner_state | default({}, true) | tojson }},
};

document.addEventListener('DOMContentLoaded', function () {
    if (typeof window.BatchRunner === 'undefined' || typeof window.BatchRunner.getInstance !== 'function') {
        console.warn('BatchRunner control is not yet available.');
        return;
    }
    var control = window.BatchRunner.getInstance();
    if (typeof control.initManage === 'function') {
        control.initManage(window.batchRunnerBootstrap);
    } else if (typeof control.init === 'function') {
        control.init(window.batchRunnerBootstrap);
    }
});
</script>
