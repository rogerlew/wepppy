<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Batch Runner | Create Batch</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}?20180731">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}" type="image/x-icon">
    <style>
        body {
            background-color: #f8f9fa;
        }

        #batch-create-page {
            padding-top: 5rem;
            padding-bottom: 4rem;
        }

        #batch-create-page .controller-section {
            background: #ffffff;
            border-radius: 0.5rem;
            padding: 2rem;
            box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.08);
        }

        #batch-create-page h1 {
            font-size: 1.75rem;
        }

        #batch-create-page .lead {
            color: #6c757d;
        }

        #batch-create-page .form-text {
            color: #6c757d;
        }

        @media (max-width: 768px) {
            #batch-create-page {
                padding-top: 4.5rem;
                padding-bottom: 3rem;
            }

            #batch-create-page .controller-section {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    {% include 'header/header.htm' %}
    {% include 'command-bar.htm' %}

    <main class="container" id="batch-create-page">
        <div class="row justify-content-center">
            <div class="col-xl-8 col-lg-9">
                <section class="controller-section">
                    <header class="mb-4">
                        <h1 class="mb-3">Create Batch</h1>
                        <p class="lead mb-0">Spin up a new batch workspace, then continue orchestration on the manage page.</p>
                    </header>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    {% if not feature_enabled %}
                        <div class="alert alert-warning mb-4" role="alert">
                            Batch Runner is currently disabled. Set <code>BATCH_RUNNER_ENABLED=1</code> in the deployment configuration to enable creation.
                        </div>
                    {% endif %}

                    {% if errors %}
                        <div class="alert alert-danger" role="alert">
                            <ul class="mb-0">
                                {% for message in errors %}
                                    <li>{{ message }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}

                    <form method="post" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="batch_name">Batch Name</label>
                            <input type="text" class="form-control" id="batch_name" name="batch_name"
                                   placeholder="e.g. forest_fires_2025"
                                   value="{{ form_state.batch_name }}"
                                   {% if not feature_enabled %}disabled{% endif %}>
                            <small class="form-text">3+ characters, letters/numbers/underscores/hyphens only.</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="base_config">Configuration for `_base` project</label>
                            <select class="form-control" id="base_config" name="base_config"
                                    {% if not feature_enabled or not available_configs %}disabled{% endif %}>
                                {% if available_configs %}
                                    {% for cfg in available_configs %}
                                        <option value="{{ cfg }}" {% if cfg == form_state.base_config %}selected{% endif %}>{{ cfg }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="" selected disabled>No batch configurations available</option>
                                {% endif %}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary"
                                {% if not feature_enabled or not available_configs %}disabled{% endif %}>
                            Create Batch
                        </button>
                    </form>
                </section>
            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/controllers.js') }}"></script>
    {% include "create_page_bootstrap.js.j2" %}
</body>
</html>
