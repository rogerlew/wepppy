function WR(i,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in i)){const f=Object.getOwnPropertyDescriptor(n,a);f&&Object.defineProperty(i,a,f.get?f:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const f of a)if(f.type==="childList")for(const m of f.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function e(a){const f={};return a.integrity&&(f.integrity=a.integrity),a.referrerPolicy&&(f.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?f.credentials="include":a.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function n(a){if(a.ep)return;a.ep=!0;const f=e(a);fetch(a.href,f)}})();function qR(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var T0={exports:{}},H_={};var _T;function XR(){if(_T)return H_;_T=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,a,f){var m=null;if(f!==void 0&&(m=""+f),a.key!==void 0&&(m=""+a.key),"key"in a){f={};for(var l in a)l!=="key"&&(f[l]=a[l])}else f=a;return a=f.ref,{$$typeof:i,type:n,key:m,ref:a!==void 0?a:null,props:f}}return H_.Fragment=t,H_.jsx=e,H_.jsxs=e,H_}var yT;function ZR(){return yT||(yT=1,T0.exports=XR()),T0.exports}var Mx=ZR(),S0={exports:{}},xi={};var vT;function GR(){if(vT)return xi;vT=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),f=Symbol.for("react.consumer"),m=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),j=Symbol.iterator;function G(Dt){return Dt===null||typeof Dt!="object"?null:(Dt=j&&Dt[j]||Dt["@@iterator"],typeof Dt=="function"?Dt:null)}var nt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},at=Object.assign,J={};function mt(Dt,he,Ce){this.props=Dt,this.context=he,this.refs=J,this.updater=Ce||nt}mt.prototype.isReactComponent={},mt.prototype.setState=function(Dt,he){if(typeof Dt!="object"&&typeof Dt!="function"&&Dt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Dt,he,"setState")},mt.prototype.forceUpdate=function(Dt){this.updater.enqueueForceUpdate(this,Dt,"forceUpdate")};function Mt(){}Mt.prototype=mt.prototype;function pt(Dt,he,Ce){this.props=Dt,this.context=he,this.refs=J,this.updater=Ce||nt}var Pt=pt.prototype=new Mt;Pt.constructor=pt,at(Pt,mt.prototype),Pt.isPureReactComponent=!0;var kt=Array.isArray;function $t(){}var ae={H:null,A:null,T:null,S:null},qt=Object.prototype.hasOwnProperty;function le(Dt,he,Ce){var Me=Ce.ref;return{$$typeof:i,type:Dt,key:he,ref:Me!==void 0?Me:null,props:Ce}}function Oe(Dt,he){return le(Dt.type,he,Dt.props)}function Be(Dt){return typeof Dt=="object"&&Dt!==null&&Dt.$$typeof===i}function qe(Dt){var he={"=":"=0",":":"=2"};return"$"+Dt.replace(/[=:]/g,function(Ce){return he[Ce]})}var ri=/\/+/g;function Ne(Dt,he){return typeof Dt=="object"&&Dt!==null&&Dt.key!=null?qe(""+Dt.key):he.toString(36)}function wi(Dt){switch(Dt.status){case"fulfilled":return Dt.value;case"rejected":throw Dt.reason;default:switch(typeof Dt.status=="string"?Dt.then($t,$t):(Dt.status="pending",Dt.then(function(he){Dt.status==="pending"&&(Dt.status="fulfilled",Dt.value=he)},function(he){Dt.status==="pending"&&(Dt.status="rejected",Dt.reason=he)})),Dt.status){case"fulfilled":return Dt.value;case"rejected":throw Dt.reason}}throw Dt}function ne(Dt,he,Ce,Me,ei){var ii=typeof Dt;(ii==="undefined"||ii==="boolean")&&(Dt=null);var Je=!1;if(Dt===null)Je=!0;else switch(ii){case"bigint":case"string":case"number":Je=!0;break;case"object":switch(Dt.$$typeof){case i:case t:Je=!0;break;case P:return Je=Dt._init,ne(Je(Dt._payload),he,Ce,Me,ei)}}if(Je)return ei=ei(Dt),Je=Me===""?"."+Ne(Dt,0):Me,kt(ei)?(Ce="",Je!=null&&(Ce=Je.replace(ri,"$&/")+"/"),ne(ei,he,Ce,"",function(Ar){return Ar})):ei!=null&&(Be(ei)&&(ei=Oe(ei,Ce+(ei.key==null||Dt&&Dt.key===ei.key?"":(""+ei.key).replace(ri,"$&/")+"/")+Je)),he.push(ei)),1;Je=0;var zi=Me===""?".":Me+":";if(kt(Dt))for(var Ui=0;Ui<Dt.length;Ui++)Me=Dt[Ui],ii=zi+Ne(Me,Ui),Je+=ne(Me,he,Ce,ii,ei);else if(Ui=G(Dt),typeof Ui=="function")for(Dt=Ui.call(Dt),Ui=0;!(Me=Dt.next()).done;)Me=Me.value,ii=zi+Ne(Me,Ui++),Je+=ne(Me,he,Ce,ii,ei);else if(ii==="object"){if(typeof Dt.then=="function")return ne(wi(Dt),he,Ce,Me,ei);throw he=String(Dt),Error("Objects are not valid as a React child (found: "+(he==="[object Object]"?"object with keys {"+Object.keys(Dt).join(", ")+"}":he)+"). If you meant to render a collection of children, use an array instead.")}return Je}function we(Dt,he,Ce){if(Dt==null)return Dt;var Me=[],ei=0;return ne(Dt,Me,"","",function(ii){return he.call(Ce,ii,ei++)}),Me}function ye(Dt){if(Dt._status===-1){var he=Dt._result;he=he(),he.then(function(Ce){(Dt._status===0||Dt._status===-1)&&(Dt._status=1,Dt._result=Ce)},function(Ce){(Dt._status===0||Dt._status===-1)&&(Dt._status=2,Dt._result=Ce)}),Dt._status===-1&&(Dt._status=0,Dt._result=he)}if(Dt._status===1)return Dt._result.default;throw Dt._result}var Ue=typeof reportError=="function"?reportError:function(Dt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var he=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Dt=="object"&&Dt!==null&&typeof Dt.message=="string"?String(Dt.message):String(Dt),error:Dt});if(!window.dispatchEvent(he))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Dt);return}console.error(Dt)},mi={map:we,forEach:function(Dt,he,Ce){we(Dt,function(){he.apply(this,arguments)},Ce)},count:function(Dt){var he=0;return we(Dt,function(){he++}),he},toArray:function(Dt){return we(Dt,function(he){return he})||[]},only:function(Dt){if(!Be(Dt))throw Error("React.Children.only expected to receive a single React element child.");return Dt}};return xi.Activity=L,xi.Children=mi,xi.Component=mt,xi.Fragment=e,xi.Profiler=a,xi.PureComponent=pt,xi.StrictMode=n,xi.Suspense=w,xi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ae,xi.__COMPILER_RUNTIME={__proto__:null,c:function(Dt){return ae.H.useMemoCache(Dt)}},xi.cache=function(Dt){return function(){return Dt.apply(null,arguments)}},xi.cacheSignal=function(){return null},xi.cloneElement=function(Dt,he,Ce){if(Dt==null)throw Error("The argument must be a React element, but you passed "+Dt+".");var Me=at({},Dt.props),ei=Dt.key;if(he!=null)for(ii in he.key!==void 0&&(ei=""+he.key),he)!qt.call(he,ii)||ii==="key"||ii==="__self"||ii==="__source"||ii==="ref"&&he.ref===void 0||(Me[ii]=he[ii]);var ii=arguments.length-2;if(ii===1)Me.children=Ce;else if(1<ii){for(var Je=Array(ii),zi=0;zi<ii;zi++)Je[zi]=arguments[zi+2];Me.children=Je}return le(Dt.type,ei,Me)},xi.createContext=function(Dt){return Dt={$$typeof:m,_currentValue:Dt,_currentValue2:Dt,_threadCount:0,Provider:null,Consumer:null},Dt.Provider=Dt,Dt.Consumer={$$typeof:f,_context:Dt},Dt},xi.createElement=function(Dt,he,Ce){var Me,ei={},ii=null;if(he!=null)for(Me in he.key!==void 0&&(ii=""+he.key),he)qt.call(he,Me)&&Me!=="key"&&Me!=="__self"&&Me!=="__source"&&(ei[Me]=he[Me]);var Je=arguments.length-2;if(Je===1)ei.children=Ce;else if(1<Je){for(var zi=Array(Je),Ui=0;Ui<Je;Ui++)zi[Ui]=arguments[Ui+2];ei.children=zi}if(Dt&&Dt.defaultProps)for(Me in Je=Dt.defaultProps,Je)ei[Me]===void 0&&(ei[Me]=Je[Me]);return le(Dt,ii,ei)},xi.createRef=function(){return{current:null}},xi.forwardRef=function(Dt){return{$$typeof:l,render:Dt}},xi.isValidElement=Be,xi.lazy=function(Dt){return{$$typeof:P,_payload:{_status:-1,_result:Dt},_init:ye}},xi.memo=function(Dt,he){return{$$typeof:C,type:Dt,compare:he===void 0?null:he}},xi.startTransition=function(Dt){var he=ae.T,Ce={};ae.T=Ce;try{var Me=Dt(),ei=ae.S;ei!==null&&ei(Ce,Me),typeof Me=="object"&&Me!==null&&typeof Me.then=="function"&&Me.then($t,Ue)}catch(ii){Ue(ii)}finally{he!==null&&Ce.types!==null&&(he.types=Ce.types),ae.T=he}},xi.unstable_useCacheRefresh=function(){return ae.H.useCacheRefresh()},xi.use=function(Dt){return ae.H.use(Dt)},xi.useActionState=function(Dt,he,Ce){return ae.H.useActionState(Dt,he,Ce)},xi.useCallback=function(Dt,he){return ae.H.useCallback(Dt,he)},xi.useContext=function(Dt){return ae.H.useContext(Dt)},xi.useDebugValue=function(){},xi.useDeferredValue=function(Dt,he){return ae.H.useDeferredValue(Dt,he)},xi.useEffect=function(Dt,he){return ae.H.useEffect(Dt,he)},xi.useEffectEvent=function(Dt){return ae.H.useEffectEvent(Dt)},xi.useId=function(){return ae.H.useId()},xi.useImperativeHandle=function(Dt,he,Ce){return ae.H.useImperativeHandle(Dt,he,Ce)},xi.useInsertionEffect=function(Dt,he){return ae.H.useInsertionEffect(Dt,he)},xi.useLayoutEffect=function(Dt,he){return ae.H.useLayoutEffect(Dt,he)},xi.useMemo=function(Dt,he){return ae.H.useMemo(Dt,he)},xi.useOptimistic=function(Dt,he){return ae.H.useOptimistic(Dt,he)},xi.useReducer=function(Dt,he,Ce){return ae.H.useReducer(Dt,he,Ce)},xi.useRef=function(Dt){return ae.H.useRef(Dt)},xi.useState=function(Dt){return ae.H.useState(Dt)},xi.useSyncExternalStore=function(Dt,he,Ce){return ae.H.useSyncExternalStore(Dt,he,Ce)},xi.useTransition=function(){return ae.H.useTransition()},xi.version="19.2.0",xi}var bT;function D1(){return bT||(bT=1,S0.exports=GR()),S0.exports}var me=D1(),A0={exports:{}},W_={},E0={exports:{}},C0={};var xT;function YR(){return xT||(xT=1,(function(i){function t(ne,we){var ye=ne.length;ne.push(we);t:for(;0<ye;){var Ue=ye-1>>>1,mi=ne[Ue];if(0<a(mi,we))ne[Ue]=we,ne[ye]=mi,ye=Ue;else break t}}function e(ne){return ne.length===0?null:ne[0]}function n(ne){if(ne.length===0)return null;var we=ne[0],ye=ne.pop();if(ye!==we){ne[0]=ye;t:for(var Ue=0,mi=ne.length,Dt=mi>>>1;Ue<Dt;){var he=2*(Ue+1)-1,Ce=ne[he],Me=he+1,ei=ne[Me];if(0>a(Ce,ye))Me<mi&&0>a(ei,Ce)?(ne[Ue]=ei,ne[Me]=ye,Ue=Me):(ne[Ue]=Ce,ne[he]=ye,Ue=he);else if(Me<mi&&0>a(ei,ye))ne[Ue]=ei,ne[Me]=ye,Ue=Me;else break t}}return we}function a(ne,we){var ye=ne.sortIndex-we.sortIndex;return ye!==0?ye:ne.id-we.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var f=performance;i.unstable_now=function(){return f.now()}}else{var m=Date,l=m.now();i.unstable_now=function(){return m.now()-l}}var w=[],C=[],P=1,L=null,j=3,G=!1,nt=!1,at=!1,J=!1,mt=typeof setTimeout=="function"?setTimeout:null,Mt=typeof clearTimeout=="function"?clearTimeout:null,pt=typeof setImmediate<"u"?setImmediate:null;function Pt(ne){for(var we=e(C);we!==null;){if(we.callback===null)n(C);else if(we.startTime<=ne)n(C),we.sortIndex=we.expirationTime,t(w,we);else break;we=e(C)}}function kt(ne){if(at=!1,Pt(ne),!nt)if(e(w)!==null)nt=!0,$t||($t=!0,qe());else{var we=e(C);we!==null&&wi(kt,we.startTime-ne)}}var $t=!1,ae=-1,qt=5,le=-1;function Oe(){return J?!0:!(i.unstable_now()-le<qt)}function Be(){if(J=!1,$t){var ne=i.unstable_now();le=ne;var we=!0;try{t:{nt=!1,at&&(at=!1,Mt(ae),ae=-1),G=!0;var ye=j;try{e:{for(Pt(ne),L=e(w);L!==null&&!(L.expirationTime>ne&&Oe());){var Ue=L.callback;if(typeof Ue=="function"){L.callback=null,j=L.priorityLevel;var mi=Ue(L.expirationTime<=ne);if(ne=i.unstable_now(),typeof mi=="function"){L.callback=mi,Pt(ne),we=!0;break e}L===e(w)&&n(w),Pt(ne)}else n(w);L=e(w)}if(L!==null)we=!0;else{var Dt=e(C);Dt!==null&&wi(kt,Dt.startTime-ne),we=!1}}break t}finally{L=null,j=ye,G=!1}we=void 0}}finally{we?qe():$t=!1}}}var qe;if(typeof pt=="function")qe=function(){pt(Be)};else if(typeof MessageChannel<"u"){var ri=new MessageChannel,Ne=ri.port2;ri.port1.onmessage=Be,qe=function(){Ne.postMessage(null)}}else qe=function(){mt(Be,0)};function wi(ne,we){ae=mt(function(){ne(i.unstable_now())},we)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ne){ne.callback=null},i.unstable_forceFrameRate=function(ne){0>ne||125<ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):qt=0<ne?Math.floor(1e3/ne):5},i.unstable_getCurrentPriorityLevel=function(){return j},i.unstable_next=function(ne){switch(j){case 1:case 2:case 3:var we=3;break;default:we=j}var ye=j;j=we;try{return ne()}finally{j=ye}},i.unstable_requestPaint=function(){J=!0},i.unstable_runWithPriority=function(ne,we){switch(ne){case 1:case 2:case 3:case 4:case 5:break;default:ne=3}var ye=j;j=ne;try{return we()}finally{j=ye}},i.unstable_scheduleCallback=function(ne,we,ye){var Ue=i.unstable_now();switch(typeof ye=="object"&&ye!==null?(ye=ye.delay,ye=typeof ye=="number"&&0<ye?Ue+ye:Ue):ye=Ue,ne){case 1:var mi=-1;break;case 2:mi=250;break;case 5:mi=1073741823;break;case 4:mi=1e4;break;default:mi=5e3}return mi=ye+mi,ne={id:P++,callback:we,priorityLevel:ne,startTime:ye,expirationTime:mi,sortIndex:-1},ye>Ue?(ne.sortIndex=ye,t(C,ne),e(w)===null&&ne===e(C)&&(at?(Mt(ae),ae=-1):at=!0,wi(kt,ye-Ue))):(ne.sortIndex=mi,t(w,ne),nt||G||(nt=!0,$t||($t=!0,qe()))),ne},i.unstable_shouldYield=Oe,i.unstable_wrapCallback=function(ne){var we=j;return function(){var ye=j;j=we;try{return ne.apply(this,arguments)}finally{j=ye}}}})(C0)),C0}var wT;function KR(){return wT||(wT=1,E0.exports=YR()),E0.exports}var M0={exports:{}},Js={};var TT;function QR(){if(TT)return Js;TT=1;var i=D1();function t(w){var C="https://react.dev/errors/"+w;if(1<arguments.length){C+="?args[]="+encodeURIComponent(arguments[1]);for(var P=2;P<arguments.length;P++)C+="&args[]="+encodeURIComponent(arguments[P])}return"Minified React error #"+w+"; visit "+C+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},a=Symbol.for("react.portal");function f(w,C,P){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:L==null?null:""+L,children:w,containerInfo:C,implementation:P}}var m=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(w,C){if(w==="font")return"";if(typeof C=="string")return C==="use-credentials"?C:""}return Js.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Js.createPortal=function(w,C){var P=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!C||C.nodeType!==1&&C.nodeType!==9&&C.nodeType!==11)throw Error(t(299));return f(w,C,null,P)},Js.flushSync=function(w){var C=m.T,P=n.p;try{if(m.T=null,n.p=2,w)return w()}finally{m.T=C,n.p=P,n.d.f()}},Js.preconnect=function(w,C){typeof w=="string"&&(C?(C=C.crossOrigin,C=typeof C=="string"?C==="use-credentials"?C:"":void 0):C=null,n.d.C(w,C))},Js.prefetchDNS=function(w){typeof w=="string"&&n.d.D(w)},Js.preinit=function(w,C){if(typeof w=="string"&&C&&typeof C.as=="string"){var P=C.as,L=l(P,C.crossOrigin),j=typeof C.integrity=="string"?C.integrity:void 0,G=typeof C.fetchPriority=="string"?C.fetchPriority:void 0;P==="style"?n.d.S(w,typeof C.precedence=="string"?C.precedence:void 0,{crossOrigin:L,integrity:j,fetchPriority:G}):P==="script"&&n.d.X(w,{crossOrigin:L,integrity:j,fetchPriority:G,nonce:typeof C.nonce=="string"?C.nonce:void 0})}},Js.preinitModule=function(w,C){if(typeof w=="string")if(typeof C=="object"&&C!==null){if(C.as==null||C.as==="script"){var P=l(C.as,C.crossOrigin);n.d.M(w,{crossOrigin:P,integrity:typeof C.integrity=="string"?C.integrity:void 0,nonce:typeof C.nonce=="string"?C.nonce:void 0})}}else C==null&&n.d.M(w)},Js.preload=function(w,C){if(typeof w=="string"&&typeof C=="object"&&C!==null&&typeof C.as=="string"){var P=C.as,L=l(P,C.crossOrigin);n.d.L(w,P,{crossOrigin:L,integrity:typeof C.integrity=="string"?C.integrity:void 0,nonce:typeof C.nonce=="string"?C.nonce:void 0,type:typeof C.type=="string"?C.type:void 0,fetchPriority:typeof C.fetchPriority=="string"?C.fetchPriority:void 0,referrerPolicy:typeof C.referrerPolicy=="string"?C.referrerPolicy:void 0,imageSrcSet:typeof C.imageSrcSet=="string"?C.imageSrcSet:void 0,imageSizes:typeof C.imageSizes=="string"?C.imageSizes:void 0,media:typeof C.media=="string"?C.media:void 0})}},Js.preloadModule=function(w,C){if(typeof w=="string")if(C){var P=l(C.as,C.crossOrigin);n.d.m(w,{as:typeof C.as=="string"&&C.as!=="script"?C.as:void 0,crossOrigin:P,integrity:typeof C.integrity=="string"?C.integrity:void 0})}else n.d.m(w)},Js.requestFormReset=function(w){n.d.r(w)},Js.unstable_batchedUpdates=function(w,C){return w(C)},Js.useFormState=function(w,C,P){return m.H.useFormState(w,C,P)},Js.useFormStatus=function(){return m.H.useHostTransitionStatus()},Js.version="19.2.0",Js}var ST;function vE(){if(ST)return M0.exports;ST=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),M0.exports=QR(),M0.exports}var AT;function JR(){if(AT)return W_;AT=1;var i=KR(),t=D1(),e=vE();function n(c){var d="https://react.dev/errors/"+c;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)d+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function f(c){var d=c,y=c;if(c.alternate)for(;d.return;)d=d.return;else{c=d;do d=c,(d.flags&4098)!==0&&(y=d.return),c=d.return;while(c)}return d.tag===3?y:null}function m(c){if(c.tag===13){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function l(c){if(c.tag===31){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function w(c){if(f(c)!==c)throw Error(n(188))}function C(c){var d=c.alternate;if(!d){if(d=f(c),d===null)throw Error(n(188));return d!==c?null:c}for(var y=c,S=d;;){var I=y.return;if(I===null)break;var F=I.alternate;if(F===null){if(S=I.return,S!==null){y=S;continue}break}if(I.child===F.child){for(F=I.child;F;){if(F===y)return w(I),c;if(F===S)return w(I),d;F=F.sibling}throw Error(n(188))}if(y.return!==S.return)y=I,S=F;else{for(var X=!1,st=I.child;st;){if(st===y){X=!0,y=I,S=F;break}if(st===S){X=!0,S=I,y=F;break}st=st.sibling}if(!X){for(st=F.child;st;){if(st===y){X=!0,y=F,S=I;break}if(st===S){X=!0,S=F,y=I;break}st=st.sibling}if(!X)throw Error(n(189))}}if(y.alternate!==S)throw Error(n(190))}if(y.tag!==3)throw Error(n(188));return y.stateNode.current===y?c:d}function P(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c;for(c=c.child;c!==null;){if(d=P(c),d!==null)return d;c=c.sibling}return null}var L=Object.assign,j=Symbol.for("react.element"),G=Symbol.for("react.transitional.element"),nt=Symbol.for("react.portal"),at=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),mt=Symbol.for("react.profiler"),Mt=Symbol.for("react.consumer"),pt=Symbol.for("react.context"),Pt=Symbol.for("react.forward_ref"),kt=Symbol.for("react.suspense"),$t=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),qt=Symbol.for("react.lazy"),le=Symbol.for("react.activity"),Oe=Symbol.for("react.memo_cache_sentinel"),Be=Symbol.iterator;function qe(c){return c===null||typeof c!="object"?null:(c=Be&&c[Be]||c["@@iterator"],typeof c=="function"?c:null)}var ri=Symbol.for("react.client.reference");function Ne(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===ri?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case at:return"Fragment";case mt:return"Profiler";case J:return"StrictMode";case kt:return"Suspense";case $t:return"SuspenseList";case le:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case nt:return"Portal";case pt:return c.displayName||"Context";case Mt:return(c._context.displayName||"Context")+".Consumer";case Pt:var d=c.render;return c=c.displayName,c||(c=d.displayName||d.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case ae:return d=c.displayName||null,d!==null?d:Ne(c.type)||"Memo";case qt:d=c._payload,c=c._init;try{return Ne(c(d))}catch{}}return null}var wi=Array.isArray,ne=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,we=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ye={pending:!1,data:null,method:null,action:null},Ue=[],mi=-1;function Dt(c){return{current:c}}function he(c){0>mi||(c.current=Ue[mi],Ue[mi]=null,mi--)}function Ce(c,d){mi++,Ue[mi]=c.current,c.current=d}var Me=Dt(null),ei=Dt(null),ii=Dt(null),Je=Dt(null);function zi(c,d){switch(Ce(ii,d),Ce(ei,c),Ce(Me,null),d.nodeType){case 9:case 11:c=(c=d.documentElement)&&(c=c.namespaceURI)?Gm(c):0;break;default:if(c=d.tagName,d=d.namespaceURI)d=Gm(d),c=D_(d,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}he(Me),Ce(Me,c)}function Ui(){he(Me),he(ei),he(ii)}function Ar(c){c.memoizedState!==null&&Ce(Je,c);var d=Me.current,y=D_(d,c.type);d!==y&&(Ce(ei,c),Ce(Me,y))}function gs(c){ei.current===c&&(he(Me),he(ei)),Je.current===c&&(he(Je),op._currentValue=ye)}var ar,Dc;function $i(c){if(ar===void 0)try{throw Error()}catch(y){var d=y.stack.trim().match(/\n( *(at )?)/);ar=d&&d[1]||"",Dc=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ar+c+Dc}var Ds=!1;function $s(c,d){if(!c||Ds)return"";Ds=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(d){var ge=function(){throw Error()};if(Object.defineProperty(ge.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ge,[])}catch(re){var ee=re}Reflect.construct(c,[],ge)}else{try{ge.call()}catch(re){ee=re}c.call(ge.prototype)}}else{try{throw Error()}catch(re){ee=re}(ge=c())&&typeof ge.catch=="function"&&ge.catch(function(){})}}catch(re){if(re&&ee&&typeof re.stack=="string")return[re.stack,ee.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var I=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");I&&I.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var F=S.DetermineComponentFrameRoot(),X=F[0],st=F[1];if(X&&st){var Rt=X.split(`
`),Jt=st.split(`
`);for(I=S=0;S<Rt.length&&!Rt[S].includes("DetermineComponentFrameRoot");)S++;for(;I<Jt.length&&!Jt[I].includes("DetermineComponentFrameRoot");)I++;if(S===Rt.length||I===Jt.length)for(S=Rt.length-1,I=Jt.length-1;1<=S&&0<=I&&Rt[S]!==Jt[I];)I--;for(;1<=S&&0<=I;S--,I--)if(Rt[S]!==Jt[I]){if(S!==1||I!==1)do if(S--,I--,0>I||Rt[S]!==Jt[I]){var oe=`
`+Rt[S].replace(" at new "," at ");return c.displayName&&oe.includes("<anonymous>")&&(oe=oe.replace("<anonymous>",c.displayName)),oe}while(1<=S&&0<=I);break}}}finally{Ds=!1,Error.prepareStackTrace=y}return(y=c?c.displayName||c.name:"")?$i(y):""}function wn(c,d){switch(c.tag){case 26:case 27:case 5:return $i(c.type);case 16:return $i("Lazy");case 13:return c.child!==d&&d!==null?$i("Suspense Fallback"):$i("Suspense");case 19:return $i("SuspenseList");case 0:case 15:return $s(c.type,!1);case 11:return $s(c.type.render,!1);case 1:return $s(c.type,!0);case 31:return $i("Activity");default:return""}}function aa(c){try{var d="",y=null;do d+=wn(c,y),y=c,c=c.return;while(c);return d}catch(S){return`
Error generating stack: `+S.message+`
`+S.stack}}var Hs=Object.prototype.hasOwnProperty,qo=i.unstable_scheduleCallback,Pa=i.unstable_cancelCallback,Ia=i.unstable_shouldYield,Xo=i.unstable_requestPaint,or=i.unstable_now,_s=i.unstable_getCurrentPriorityLevel,kc=i.unstable_ImmediatePriority,Oc=i.unstable_UserBlockingPriority,Da=i.unstable_NormalPriority,Bc=i.unstable_LowPriority,so=i.unstable_IdlePriority,Lc=i.log,Fl=i.unstable_setDisableYieldValue,ts=null,yn=null;function Ct(c){if(typeof Lc=="function"&&Fl(c),yn&&typeof yn.setStrictMode=="function")try{yn.setStrictMode(ts,c)}catch{}}var Q=Math.clz32?Math.clz32:bt,tt=Math.log,rt=Math.LN2;function bt(c){return c>>>=0,c===0?32:31-(tt(c)/rt|0)|0}var wt=256,Ft=262144,ut=4194304;function Ot(c){var d=c&42;if(d!==0)return d;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function Kt(c,d,y){var S=c.pendingLanes;if(S===0)return 0;var I=0,F=c.suspendedLanes,X=c.pingedLanes;c=c.warmLanes;var st=S&134217727;return st!==0?(S=st&~F,S!==0?I=Ot(S):(X&=st,X!==0?I=Ot(X):y||(y=st&~c,y!==0&&(I=Ot(y))))):(st=S&~F,st!==0?I=Ot(st):X!==0?I=Ot(X):y||(y=S&~c,y!==0&&(I=Ot(y)))),I===0?0:d!==0&&d!==I&&(d&F)===0&&(F=I&-I,y=d&-d,F>=y||F===32&&(y&4194048)!==0)?d:I}function te(c,d){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&d)===0}function ie(c,d){switch(c){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function De(){var c=ut;return ut<<=1,(ut&62914560)===0&&(ut=4194304),c}function He(c){for(var d=[],y=0;31>y;y++)d.push(c);return d}function si(c,d){c.pendingLanes|=d,d!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Mn(c,d,y,S,I,F){var X=c.pendingLanes;c.pendingLanes=y,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=y,c.entangledLanes&=y,c.errorRecoveryDisabledLanes&=y,c.shellSuspendCounter=0;var st=c.entanglements,Rt=c.expirationTimes,Jt=c.hiddenUpdates;for(y=X&~y;0<y;){var oe=31-Q(y),ge=1<<oe;st[oe]=0,Rt[oe]=-1;var ee=Jt[oe];if(ee!==null)for(Jt[oe]=null,oe=0;oe<ee.length;oe++){var re=ee[oe];re!==null&&(re.lane&=-536870913)}y&=~ge}S!==0&&gi(c,S,0),F!==0&&I===0&&c.tag!==0&&(c.suspendedLanes|=F&~(X&~d))}function gi(c,d,y){c.pendingLanes|=d,c.suspendedLanes&=~d;var S=31-Q(d);c.entangledLanes|=d,c.entanglements[S]=c.entanglements[S]|1073741824|y&261930}function Bi(c,d){var y=c.entangledLanes|=d;for(c=c.entanglements;y;){var S=31-Q(y),I=1<<S;I&d|c[S]&d&&(c[S]|=d),y&=~I}}function Qi(c,d){var y=d&-d;return y=(y&42)!==0?1:xe(y),(y&(c.suspendedLanes|d))!==0?0:y}function xe(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Ji(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function tn(){var c=we.p;return c!==0?c:(c=window.event,c===void 0?32:Iv(c.type))}function Vn(c,d){var y=we.p;try{return we.p=c,d()}finally{we.p=y}}var Li=Math.random().toString(36).slice(2),fe="__reactFiber$"+Li,Re="__reactProps$"+Li,We="__reactContainer$"+Li,Ur="__reactEvents$"+Li,Nl="__reactListeners$"+Li,gr="__reactHandles$"+Li,ni="__reactResources$"+Li,ks="__reactMarker$"+Li;function Zo(c){delete c[fe],delete c[Re],delete c[Ur],delete c[Nl],delete c[gr]}function oa(c){var d=c[fe];if(d)return d;for(var y=c.parentNode;y;){if(d=y[We]||y[fe]){if(y=d.alternate,d.child!==null||y!==null&&y.child!==null)for(c=Tv(c);c!==null;){if(y=c[fe])return y;c=Tv(c)}return d}c=y,y=c.parentNode}return null}function Vr(c){if(c=c[fe]||c[We]){var d=c.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return c}return null}function la(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c.stateNode;throw Error(n(33))}function ca(c){var d=c[ni];return d||(d=c[ni]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Rn(c){c[ks]=!0}var ys=new Set,en={};function zl(c,d){es(c,d),es(c+"Capture",d)}function es(c,d){for(en[c]=d,c=0;c<d.length;c++)ys.add(d[c])}var Cu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),vn={},ao={};function id(c){return Hs.call(ao,c)?!0:Hs.call(vn,c)?!1:Cu.test(c)?ao[c]=!0:(vn[c]=!0,!1)}function oo(c,d,y){if(id(d))if(y===null)c.removeAttribute(d);else{switch(typeof y){case"undefined":case"function":case"symbol":c.removeAttribute(d);return;case"boolean":var S=d.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){c.removeAttribute(d);return}}c.setAttribute(d,""+y)}}function Fc(c,d,y){if(y===null)c.removeAttribute(d);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(d);return}c.setAttribute(d,""+y)}}function vs(c,d,y,S){if(S===null)c.removeAttribute(y);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(y);return}c.setAttributeNS(d,y,""+S)}}function Os(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function nd(c){var d=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function t_(c,d,y){var S=Object.getOwnPropertyDescriptor(c.constructor.prototype,d);if(!c.hasOwnProperty(d)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var I=S.get,F=S.set;return Object.defineProperty(c,d,{configurable:!0,get:function(){return I.call(this)},set:function(X){y=""+X,F.call(this,X)}}),Object.defineProperty(c,d,{enumerable:S.enumerable}),{getValue:function(){return y},setValue:function(X){y=""+X},stopTracking:function(){c._valueTracker=null,delete c[d]}}}}function zh(c){if(!c._valueTracker){var d=nd(c)?"checked":"value";c._valueTracker=t_(c,d,""+c[d])}}function rd(c){if(!c)return!1;var d=c._valueTracker;if(!d)return!0;var y=d.getValue(),S="";return c&&(S=nd(c)?c.checked?"true":"false":c.value),c=S,c!==y?(d.setValue(c),!0):!1}function Mu(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var sd=/[\n"\\]/g;function bs(c){return c.replace(sd,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function Uh(c,d,y,S,I,F,X,st){c.name="",X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?c.type=X:c.removeAttribute("type"),d!=null?X==="number"?(d===0&&c.value===""||c.value!=d)&&(c.value=""+Os(d)):c.value!==""+Os(d)&&(c.value=""+Os(d)):X!=="submit"&&X!=="reset"||c.removeAttribute("value"),d!=null?Ru(c,X,Os(d)):y!=null?Ru(c,X,Os(y)):S!=null&&c.removeAttribute("value"),I==null&&F!=null&&(c.defaultChecked=!!F),I!=null&&(c.checked=I&&typeof I!="function"&&typeof I!="symbol"),st!=null&&typeof st!="function"&&typeof st!="symbol"&&typeof st!="boolean"?c.name=""+Os(st):c.removeAttribute("name")}function Vh(c,d,y,S,I,F,X,st){if(F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(c.type=F),d!=null||y!=null){if(!(F!=="submit"&&F!=="reset"||d!=null)){zh(c);return}y=y!=null?""+Os(y):"",d=d!=null?""+Os(d):y,st||d===c.value||(c.value=d),c.defaultValue=d}S=S??I,S=typeof S!="function"&&typeof S!="symbol"&&!!S,c.checked=st?c.checked:!!S,c.defaultChecked=!!S,X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"&&(c.name=X),zh(c)}function Ru(c,d,y){d==="number"&&Mu(c.ownerDocument)===c||c.defaultValue===""+y||(c.defaultValue=""+y)}function Ul(c,d,y,S){if(c=c.options,d){d={};for(var I=0;I<y.length;I++)d["$"+y[I]]=!0;for(y=0;y<c.length;y++)I=d.hasOwnProperty("$"+c[y].value),c[y].selected!==I&&(c[y].selected=I),I&&S&&(c[y].defaultSelected=!0)}else{for(y=""+Os(y),d=null,I=0;I<c.length;I++){if(c[I].value===y){c[I].selected=!0,S&&(c[I].defaultSelected=!0);return}d!==null||c[I].disabled||(d=c[I])}d!==null&&(d.selected=!0)}}function ka(c,d,y){if(d!=null&&(d=""+Os(d),d!==c.value&&(c.value=d),y==null)){c.defaultValue!==d&&(c.defaultValue=d);return}c.defaultValue=y!=null?""+Os(y):""}function Pu(c,d,y,S){if(d==null){if(S!=null){if(y!=null)throw Error(n(92));if(wi(S)){if(1<S.length)throw Error(n(93));S=S[0]}y=S}y==null&&(y=""),d=y}y=Os(d),c.defaultValue=y,S=c.textContent,S===y&&S!==""&&S!==null&&(c.value=S),zh(c)}function Vl(c,d){if(d){var y=c.firstChild;if(y&&y===c.lastChild&&y.nodeType===3){y.nodeValue=d;return}}c.textContent=d}var Oa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ad(c,d,y){var S=d.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?S?c.setProperty(d,""):d==="float"?c.cssFloat="":c[d]="":S?c.setProperty(d,y):typeof y!="number"||y===0||Oa.has(d)?d==="float"?c.cssFloat=y:c[d]=(""+y).trim():c[d]=y+"px"}function qp(c,d,y){if(d!=null&&typeof d!="object")throw Error(n(62));if(c=c.style,y!=null){for(var S in y)!y.hasOwnProperty(S)||d!=null&&d.hasOwnProperty(S)||(S.indexOf("--")===0?c.setProperty(S,""):S==="float"?c.cssFloat="":c[S]="");for(var I in d)S=d[I],d.hasOwnProperty(I)&&y[I]!==S&&ad(c,I,S)}else for(var F in d)d.hasOwnProperty(F)&&ad(c,F,d[F])}function Ba(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jl=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),bi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function is(c){return bi.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function hi(){}var La=null;function Bn(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var jn=null,$n=null;function Kn(c){var d=Vr(c);if(d&&(c=d.stateNode)){var y=c[Re]||null;t:switch(c=d.stateNode,d.type){case"input":if(Uh(c,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),d=y.name,y.type==="radio"&&d!=null){for(y=c;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+bs(""+d)+'"][type="radio"]'),d=0;d<y.length;d++){var S=y[d];if(S!==c&&S.form===c.form){var I=S[Re]||null;if(!I)throw Error(n(90));Uh(S,I.value,I.defaultValue,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name)}}for(d=0;d<y.length;d++)S=y[d],S.form===c.form&&rd(S)}break t;case"textarea":ka(c,y.value,y.defaultValue);break t;case"select":d=y.value,d!=null&&Ul(c,!!y.multiple,d,!1)}}}var Zi=!1;function Iu(c,d,y){if(Zi)return c(d,y);Zi=!0;try{var S=c(d);return S}finally{if(Zi=!1,(jn!==null||$n!==null)&&(km(),jn&&(d=jn,c=$n,$n=jn=null,Kn(d),c)))for(d=0;d<c.length;d++)Kn(c[d])}}function lr(c,d){var y=c.stateNode;if(y===null)return null;var S=y[Re]||null;if(S===null)return null;y=S[d];t:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(c=c.type,S=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!S;break t;default:c=!1}if(c)return null;if(y&&typeof y!="function")throw Error(n(231,d,typeof y));return y}var Ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_r=!1;if(Ln)try{var Nc={};Object.defineProperty(Nc,"passive",{get:function(){_r=!0}}),window.addEventListener("test",Nc,Nc),window.removeEventListener("test",Nc,Nc)}catch{_r=!1}var ns=null,nn=null,lo=null;function co(){if(lo)return lo;var c,d=nn,y=d.length,S,I="value"in ns?ns.value:ns.textContent,F=I.length;for(c=0;c<y&&d[c]===I[c];c++);var X=y-c;for(S=1;S<=X&&d[y-S]===I[F-S];S++);return lo=I.slice(c,1<S?1-S:void 0)}function Go(c){var d=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&d===13&&(c=13)):c=d,c===10&&(c=13),32<=c||c===13?c:0}function Er(){return!0}function ln(){return!1}function Pn(c){function d(y,S,I,F,X){this._reactName=y,this._targetInst=I,this.type=S,this.nativeEvent=F,this.target=X,this.currentTarget=null;for(var st in c)c.hasOwnProperty(st)&&(y=c[st],this[st]=y?y(F):F[st]);return this.isDefaultPrevented=(F.defaultPrevented!=null?F.defaultPrevented:F.returnValue===!1)?Er:ln,this.isPropagationStopped=ln,this}return L(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Er)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Er)},persist:function(){},isPersistent:Er}),d}var _i={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oi=Pn(_i),Fa=L({},_i,{view:0,detail:0}),Ei=Pn(Fa),Yo,Bs,uo,Na=L({},Fa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hh,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==uo&&(uo&&c.type==="mousemove"?(Yo=c.screenX-uo.screenX,Bs=c.screenY-uo.screenY):Bs=Yo=0,uo=c),Yo)},movementY:function(c){return"movementY"in c?c.movementY:Bs}}),Du=Pn(Na),ku=L({},Na,{dataTransfer:0}),Ou=Pn(ku),jh=L({},Fa,{relatedTarget:0}),Ko=Pn(jh),Xp=L({},_i,{animationName:0,elapsedTime:0,pseudoElement:0}),za=Pn(Xp),Cr=L({},_i,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),$h=Pn(Cr),Zp=L({},_i,{data:0}),yr=Pn(Zp),Qn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ua={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function od(c){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(c):(c=zc[c])?!!d[c]:!1}function Hh(){return od}var ha=L({},Fa,{key:function(c){if(c.key){var d=Qn[c.key]||c.key;if(d!=="Unidentified")return d}return c.type==="keypress"?(c=Go(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?ua[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hh,charCode:function(c){return c.type==="keypress"?Go(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Go(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),Wh=Pn(ha),ld=L({},Na,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gp=Pn(ld),Yp=L({},Fa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hh}),qh=Pn(Yp),Xh=L({},_i,{propertyName:0,elapsedTime:0,pseudoElement:0}),xs=Pn(Xh),Zh=L({},Na,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),$l=Pn(Zh),cd=L({},_i,{newState:0,oldState:0}),Bu=Pn(cd),Ua=[9,13,27,32],ud=Ln&&"CompositionEvent"in window,Hl=null;Ln&&"documentMode"in document&&(Hl=document.documentMode);var Lu=Ln&&"TextEvent"in window&&!Hl,ho=Ln&&(!ud||Hl&&8<Hl&&11>=Hl),Kp=" ",Uc=!1;function hd(c,d){switch(c){case"keyup":return Ua.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wl(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var ql=!1;function Qp(c,d){switch(c){case"compositionend":return Wl(d);case"keypress":return d.which!==32?null:(Uc=!0,Kp);case"textInput":return c=d.data,c===Kp&&Uc?null:c;default:return null}}function e_(c,d){if(ql)return c==="compositionend"||!ud&&hd(c,d)?(c=co(),lo=nn=ns=null,ql=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return ho&&d.locale!=="ko"?null:d.data;default:return null}}var Jp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gh(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d==="input"?!!Jp[c.type]:d==="textarea"}function fd(c,d,y,S){jn?$n?$n.push(S):$n=[S]:jn=S,d=Yd(d,"onChange"),0<d.length&&(y=new oi("onChange","change",null,y,S),c.push({event:y,listeners:d}))}var Xl=null,Zl=null;function dd(c){yv(c,0)}function Va(c){var d=la(c);if(rd(d))return c}function pd(c,d){if(c==="change")return d}var md=!1;if(Ln){var Gl;if(Ln){var Vc="oninput"in document;if(!Vc){var jc=document.createElement("div");jc.setAttribute("oninput","return;"),Vc=typeof jc.oninput=="function"}Gl=Vc}else Gl=!1;md=Gl&&(!document.documentMode||9<document.documentMode)}function tm(){Xl&&(Xl.detachEvent("onpropertychange",em),Zl=Xl=null)}function em(c){if(c.propertyName==="value"&&Va(Zl)){var d=[];fd(d,Zl,c,Bn(c)),Iu(dd,d)}}function im(c,d,y){c==="focusin"?(tm(),Xl=d,Zl=y,Xl.attachEvent("onpropertychange",em)):c==="focusout"&&tm()}function Yh(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return Va(Zl)}function gd(c,d){if(c==="click")return Va(d)}function _d(c,d){if(c==="input"||c==="change")return Va(d)}function nm(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var Mr=typeof Object.is=="function"?Object.is:nm;function ws(c,d){if(Mr(c,d))return!0;if(typeof c!="object"||c===null||typeof d!="object"||d===null)return!1;var y=Object.keys(c),S=Object.keys(d);if(y.length!==S.length)return!1;for(S=0;S<y.length;S++){var I=y[S];if(!Hs.call(d,I)||!Mr(c[I],d[I]))return!1}return!0}function Kh(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function Qh(c,d){var y=Kh(c);c=0;for(var S;y;){if(y.nodeType===3){if(S=c+y.textContent.length,c<=d&&S>=d)return{node:y,offset:d-c};c=S}t:{for(;y;){if(y.nextSibling){y=y.nextSibling;break t}y=y.parentNode}y=void 0}y=Kh(y)}}function Jh(c,d){return c&&d?c===d?!0:c&&c.nodeType===3?!1:d&&d.nodeType===3?Jh(c,d.parentNode):"contains"in c?c.contains(d):c.compareDocumentPosition?!!(c.compareDocumentPosition(d)&16):!1:!1}function tf(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var d=Mu(c.document);d instanceof c.HTMLIFrameElement;){try{var y=typeof d.contentWindow.location.href=="string"}catch{y=!1}if(y)c=d.contentWindow;else break;d=Mu(c.document)}return d}function Fu(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d&&(d==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||d==="textarea"||c.contentEditable==="true")}var Yl=Ln&&"documentMode"in document&&11>=document.documentMode,Qo=null,yd=null,Mi=null,vd=!1;function rm(c,d,y){var S=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;vd||Qo==null||Qo!==Mu(S)||(S=Qo,"selectionStart"in S&&Fu(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Mi&&ws(Mi,S)||(Mi=S,S=Yd(yd,"onSelect"),0<S.length&&(d=new oi("onSelect","select",null,d,y),c.push({event:d,listeners:S}),d.target=Qo)))}function Jo(c,d){var y={};return y[c.toLowerCase()]=d.toLowerCase(),y["Webkit"+c]="webkit"+d,y["Moz"+c]="moz"+d,y}var $c={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionrun:Jo("Transition","TransitionRun"),transitionstart:Jo("Transition","TransitionStart"),transitioncancel:Jo("Transition","TransitionCancel"),transitionend:Jo("Transition","TransitionEnd")},ef={},Nu={};Ln&&(Nu=document.createElement("div").style,"AnimationEvent"in window||(delete $c.animationend.animation,delete $c.animationiteration.animation,delete $c.animationstart.animation),"TransitionEvent"in window||delete $c.transitionend.transition);function ja(c){if(ef[c])return ef[c];if(!$c[c])return c;var d=$c[c],y;for(y in d)if(d.hasOwnProperty(y)&&y in Nu)return ef[c]=d[y];return c}var zu=ja("animationend"),nf=ja("animationiteration"),tl=ja("animationstart"),Uu=ja("transitionrun"),Hc=ja("transitionstart"),Ws=ja("transitioncancel"),bd=ja("transitionend"),xd=new Map,Vu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vu.push("scrollEnd");function Rr(c,d){xd.set(c,d),zl(d,[c])}var Kl=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},rs=[],$a=0,Wc=0;function ju(){for(var c=$a,d=Wc=$a=0;d<c;){var y=rs[d];rs[d++]=null;var S=rs[d];rs[d++]=null;var I=rs[d];rs[d++]=null;var F=rs[d];if(rs[d++]=null,S!==null&&I!==null){var X=S.pending;X===null?I.next=I:(I.next=X.next,X.next=I),S.pending=I}F!==0&&rf(y,I,F)}}function fo(c,d,y,S){rs[$a++]=c,rs[$a++]=d,rs[$a++]=y,rs[$a++]=S,Wc|=S,c.lanes|=S,c=c.alternate,c!==null&&(c.lanes|=S)}function el(c,d,y,S){return fo(c,d,y,S),pi(c)}function il(c,d){return fo(c,null,null,d),pi(c)}function rf(c,d,y){c.lanes|=y;var S=c.alternate;S!==null&&(S.lanes|=y);for(var I=!1,F=c.return;F!==null;)F.childLanes|=y,S=F.alternate,S!==null&&(S.childLanes|=y),F.tag===22&&(c=F.stateNode,c===null||c._visibility&1||(I=!0)),c=F,F=F.return;return c.tag===3?(F=c.stateNode,I&&d!==null&&(I=31-Q(y),c=F.hiddenUpdates,S=c[I],S===null?c[I]=[d]:S.push(d),d.lane=y|536870912),F):null}function pi(c){if(50<ph)throw ph=0,Im=null,Error(n(185));for(var d=c.return;d!==null;)c=d,d=c.return;return c.tag===3?c.stateNode:null}var po={};function i_(c,d,y,S){this.tag=c,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ts(c,d,y,S){return new i_(c,d,y,S)}function Ql(c){return c=c.prototype,!(!c||!c.isReactComponent)}function fa(c,d){var y=c.alternate;return y===null?(y=Ts(c.tag,d,c.key,c.mode),y.elementType=c.elementType,y.type=c.type,y.stateNode=c.stateNode,y.alternate=c,c.alternate=y):(y.pendingProps=d,y.type=c.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=c.flags&65011712,y.childLanes=c.childLanes,y.lanes=c.lanes,y.child=c.child,y.memoizedProps=c.memoizedProps,y.memoizedState=c.memoizedState,y.updateQueue=c.updateQueue,d=c.dependencies,y.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},y.sibling=c.sibling,y.index=c.index,y.ref=c.ref,y.refCleanup=c.refCleanup,y}function sm(c,d){c.flags&=65011714;var y=c.alternate;return y===null?(c.childLanes=0,c.lanes=d,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=y.childLanes,c.lanes=y.lanes,c.child=y.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=y.memoizedProps,c.memoizedState=y.memoizedState,c.updateQueue=y.updateQueue,c.type=y.type,d=y.dependencies,c.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),c}function $u(c,d,y,S,I,F){var X=0;if(S=c,typeof c=="function")Ql(c)&&(X=1);else if(typeof c=="string")X=g0(c,y,Me.current)?26:c==="html"||c==="head"||c==="body"?27:5;else t:switch(c){case le:return c=Ts(31,y,d,I),c.elementType=le,c.lanes=F,c;case at:return Jl(y.children,I,F,d);case J:X=8,I|=24;break;case mt:return c=Ts(12,y,d,I|2),c.elementType=mt,c.lanes=F,c;case kt:return c=Ts(13,y,d,I),c.elementType=kt,c.lanes=F,c;case $t:return c=Ts(19,y,d,I),c.elementType=$t,c.lanes=F,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case pt:X=10;break t;case Mt:X=9;break t;case Pt:X=11;break t;case ae:X=14;break t;case qt:X=16,S=null;break t}X=29,y=Error(n(130,c===null?"null":typeof c,"")),S=null}return d=Ts(X,y,d,I),d.elementType=c,d.type=S,d.lanes=F,d}function Jl(c,d,y,S){return c=Ts(7,c,S,d),c.lanes=y,c}function qc(c,d,y){return c=Ts(6,c,null,d),c.lanes=y,c}function Hu(c){var d=Ts(18,null,null,0);return d.stateNode=c,d}function Xc(c,d,y){return d=Ts(4,c.children!==null?c.children:[],c.key,d),d.lanes=y,d.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},d}var nl=new WeakMap;function ss(c,d){if(typeof c=="object"&&c!==null){var y=nl.get(c);return y!==void 0?y:(d={value:c,source:d,stack:aa(d)},nl.set(c,d),d)}return{value:c,source:d,stack:aa(d)}}var tc=[],mo=0,ec=null,rl=0,Pr=[],as=0,go=null,Ss=1,Ha="";function da(c,d){tc[mo++]=rl,tc[mo++]=ec,ec=c,rl=d}function Zc(c,d,y){Pr[as++]=Ss,Pr[as++]=Ha,Pr[as++]=go,go=c;var S=Ss;c=Ha;var I=32-Q(S)-1;S&=~(1<<I),y+=1;var F=32-Q(d)+I;if(30<F){var X=I-I%5;F=(S&(1<<X)-1).toString(32),S>>=X,I-=X,Ss=1<<32-Q(d)+I|y<<I|S,Ha=F+c}else Ss=1<<F|y<<I|S,Ha=c}function Gc(c){c.return!==null&&(da(c,1),Zc(c,1,0))}function sf(c){for(;c===ec;)ec=tc[--mo],tc[mo]=null,rl=tc[--mo],tc[mo]=null;for(;c===go;)go=Pr[--as],Pr[as]=null,Ha=Pr[--as],Pr[as]=null,Ss=Pr[--as],Pr[as]=null}function wd(c,d){Pr[as++]=Ss,Pr[as++]=Ha,Pr[as++]=go,Ss=d.id,Ha=d.overflow,go=c}var Jn=null,cn=null,Ri=!1,Wa=null,Ii=!1,pa=Error(n(519));function Hn(c){var d=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw _o(ss(d,c)),pa}function Yc(c){var d=c.stateNode,y=c.type,S=c.memoizedProps;switch(d[fe]=c,d[Re]=S,y){case"dialog":Ci("cancel",d),Ci("close",d);break;case"iframe":case"object":case"embed":Ci("load",d);break;case"video":case"audio":for(y=0;y<Zd.length;y++)Ci(Zd[y],d);break;case"source":Ci("error",d);break;case"img":case"image":case"link":Ci("error",d),Ci("load",d);break;case"details":Ci("toggle",d);break;case"input":Ci("invalid",d),Vh(d,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0);break;case"select":Ci("invalid",d);break;case"textarea":Ci("invalid",d),Pu(d,S.value,S.defaultValue,S.children)}y=S.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||d.textContent===""+y||S.suppressHydrationWarning===!0||P_(d.textContent,y)?(S.popover!=null&&(Ci("beforetoggle",d),Ci("toggle",d)),S.onScroll!=null&&Ci("scroll",d),S.onScrollEnd!=null&&Ci("scrollend",d),S.onClick!=null&&(d.onclick=hi),d=!0):d=!1,d||Hn(c,!0)}function sl(c){for(Jn=c.return;Jn;)switch(Jn.tag){case 5:case 31:case 13:Ii=!1;return;case 27:case 3:Ii=!0;return;default:Jn=Jn.return}}function ic(c){if(c!==Jn)return!1;if(!Ri)return sl(c),Ri=!0,!1;var d=c.tag,y;if((y=d!==3&&d!==27)&&((y=d===5)&&(y=c.type,y=!(y!=="form"&&y!=="button")||Qd(c.type,c.memoizedProps)),y=!y),y&&cn&&Hn(c),sl(c),d===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));cn=yh(c)}else if(d===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));cn=yh(c)}else d===27?(d=cn,Ks(c.type)?(c=_c,_c=null,cn=c):cn=d):cn=Jn?Sa(c.stateNode.nextSibling):null;return!0}function qs(){cn=Jn=null,Ri=!1}function Wu(){var c=Wa;return c!==null&&(zs===null?zs=c:zs.push.apply(zs,c),Wa=null),c}function _o(c){Wa===null?Wa=[c]:Wa.push(c)}var qu=Dt(null),al=null,ma=null;function qa(c,d,y){Ce(qu,d._currentValue),d._currentValue=y}function Ls(c){c._currentValue=qu.current,he(qu)}function af(c,d,y){for(;c!==null;){var S=c.alternate;if((c.childLanes&d)!==d?(c.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),c===y)break;c=c.return}}function Xa(c,d,y,S){var I=c.child;for(I!==null&&(I.return=c);I!==null;){var F=I.dependencies;if(F!==null){var X=I.child;F=F.firstContext;t:for(;F!==null;){var st=F;F=I;for(var Rt=0;Rt<d.length;Rt++)if(st.context===d[Rt]){F.lanes|=y,st=F.alternate,st!==null&&(st.lanes|=y),af(F.return,y,c),S||(X=null);break t}F=st.next}}else if(I.tag===18){if(X=I.return,X===null)throw Error(n(341));X.lanes|=y,F=X.alternate,F!==null&&(F.lanes|=y),af(X,y,c),X=null}else X=I.child;if(X!==null)X.return=I;else for(X=I;X!==null;){if(X===c){X=null;break}if(I=X.sibling,I!==null){I.return=X.return,X=I;break}X=X.return}I=X}}function ol(c,d,y,S){c=null;for(var I=d,F=!1;I!==null;){if(!F){if((I.flags&524288)!==0)F=!0;else if((I.flags&262144)!==0)break}if(I.tag===10){var X=I.alternate;if(X===null)throw Error(n(387));if(X=X.memoizedProps,X!==null){var st=I.type;Mr(I.pendingProps.value,X.value)||(c!==null?c.push(st):c=[st])}}else if(I===Je.current){if(X=I.alternate,X===null)throw Error(n(387));X.memoizedState.memoizedState!==I.memoizedState.memoizedState&&(c!==null?c.push(op):c=[op])}I=I.return}c!==null&&Xa(d,c,y,S),d.flags|=262144}function Xu(c){for(c=c.firstContext;c!==null;){if(!Mr(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function yo(c){al=c,ma=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function cr(c){return Td(al,c)}function vo(c,d){return al===null&&yo(c),Td(c,d)}function Td(c,d){var y=d._currentValue;if(d={context:d,memoizedValue:y,next:null},ma===null){if(c===null)throw Error(n(308));ma=d,c.dependencies={lanes:0,firstContext:d},c.flags|=524288}else ma=ma.next=d;return y}var am=typeof AbortController<"u"?AbortController:function(){var c=[],d=this.signal={aborted:!1,addEventListener:function(y,S){c.push(S)}};this.abort=function(){d.aborted=!0,c.forEach(function(y){return y()})}},om=i.unstable_scheduleCallback,of=i.unstable_NormalPriority,Wn={$$typeof:pt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function As(){return{controller:new am,data:new Map,refCount:0}}function ur(c){c.refCount--,c.refCount===0&&om(of,function(){c.controller.abort()})}var Za=null,bn=0,Ga=0,Xs=null;function n_(c,d){if(Za===null){var y=Za=[];bn=0,Ga=jm(),Xs={status:"pending",value:void 0,then:function(S){y.push(S)}}}return bn++,d.then(lm,lm),d}function lm(){if(--bn===0&&Za!==null){Xs!==null&&(Xs.status="fulfilled");var c=Za;Za=null,Ga=0,Xs=null;for(var d=0;d<c.length;d++)(0,c[d])()}}function Zu(c,d){var y=[],S={status:"pending",value:null,reason:null,then:function(I){y.push(I)}};return c.then(function(){S.status="fulfilled",S.value=d;for(var I=0;I<y.length;I++)(0,y[I])(d)},function(I){for(S.status="rejected",S.reason=I,I=0;I<y.length;I++)(0,y[I])(void 0)}),S}var Sd=ne.S;ne.S=function(c,d){$d=or(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&n_(c,d),Sd!==null&&Sd(c,d)};var Ya=Dt(null);function nc(){var c=Ya.current;return c!==null?c:xn.pooledCache}function Es(c,d){d===null?Ce(Ya,Ya.current):Ce(Ya,d.pool)}function Ie(){var c=nc();return c===null?null:{parent:Wn._currentValue,pool:c}}var ga=Error(n(460)),Gu=Error(n(474)),Yu=Error(n(542)),ll={then:function(){}};function Ka(c){return c=c.status,c==="fulfilled"||c==="rejected"}function lf(c,d,y){switch(y=c[y],y===void 0?c.push(d):y!==d&&(d.then(hi,hi),d=y),d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,uf(c),c;default:if(typeof d.status=="string")d.then(hi,hi);else{if(c=xn,c!==null&&100<c.shellSuspendCounter)throw Error(n(482));c=d,c.status="pending",c.then(function(S){if(d.status==="pending"){var I=d;I.status="fulfilled",I.value=S}},function(S){if(d.status==="pending"){var I=d;I.status="rejected",I.reason=S}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,uf(c),c}throw Zs=d,ga}}function rc(c){try{var d=c._init;return d(c._payload)}catch(y){throw y!==null&&typeof y=="object"&&typeof y.then=="function"?(Zs=y,ga):y}}var Zs=null;function cf(){if(Zs===null)throw Error(n(459));var c=Zs;return Zs=null,c}function uf(c){if(c===ga||c===Yu)throw Error(n(483))}var Qa=null,Kc=0;function Ku(c){var d=Kc;return Kc+=1,Qa===null&&(Qa=[]),lf(Qa,c,d)}function sc(c,d){d=d.props.ref,c.ref=d!==void 0?d:null}function Qu(c,d){throw d.$$typeof===j?Error(n(525)):(c=Object.prototype.toString.call(d),Error(n(31,c==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":c)))}function Ju(c){function d(Vt,Lt){if(c){var Qt=Vt.deletions;Qt===null?(Vt.deletions=[Lt],Vt.flags|=16):Qt.push(Lt)}}function y(Vt,Lt){if(!c)return null;for(;Lt!==null;)d(Vt,Lt),Lt=Lt.sibling;return null}function S(Vt){for(var Lt=new Map;Vt!==null;)Vt.key!==null?Lt.set(Vt.key,Vt):Lt.set(Vt.index,Vt),Vt=Vt.sibling;return Lt}function I(Vt,Lt){return Vt=fa(Vt,Lt),Vt.index=0,Vt.sibling=null,Vt}function F(Vt,Lt,Qt){return Vt.index=Qt,c?(Qt=Vt.alternate,Qt!==null?(Qt=Qt.index,Qt<Lt?(Vt.flags|=67108866,Lt):Qt):(Vt.flags|=67108866,Lt)):(Vt.flags|=1048576,Lt)}function X(Vt){return c&&Vt.alternate===null&&(Vt.flags|=67108866),Vt}function st(Vt,Lt,Qt,de){return Lt===null||Lt.tag!==6?(Lt=qc(Qt,Vt.mode,de),Lt.return=Vt,Lt):(Lt=I(Lt,Qt),Lt.return=Vt,Lt)}function Rt(Vt,Lt,Qt,de){var ti=Qt.type;return ti===at?oe(Vt,Lt,Qt.props.children,de,Qt.key):Lt!==null&&(Lt.elementType===ti||typeof ti=="object"&&ti!==null&&ti.$$typeof===qt&&rc(ti)===Lt.type)?(Lt=I(Lt,Qt.props),sc(Lt,Qt),Lt.return=Vt,Lt):(Lt=$u(Qt.type,Qt.key,Qt.props,null,Vt.mode,de),sc(Lt,Qt),Lt.return=Vt,Lt)}function Jt(Vt,Lt,Qt,de){return Lt===null||Lt.tag!==4||Lt.stateNode.containerInfo!==Qt.containerInfo||Lt.stateNode.implementation!==Qt.implementation?(Lt=Xc(Qt,Vt.mode,de),Lt.return=Vt,Lt):(Lt=I(Lt,Qt.children||[]),Lt.return=Vt,Lt)}function oe(Vt,Lt,Qt,de,ti){return Lt===null||Lt.tag!==7?(Lt=Jl(Qt,Vt.mode,de,ti),Lt.return=Vt,Lt):(Lt=I(Lt,Qt),Lt.return=Vt,Lt)}function ge(Vt,Lt,Qt){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number"||typeof Lt=="bigint")return Lt=qc(""+Lt,Vt.mode,Qt),Lt.return=Vt,Lt;if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case G:return Qt=$u(Lt.type,Lt.key,Lt.props,null,Vt.mode,Qt),sc(Qt,Lt),Qt.return=Vt,Qt;case nt:return Lt=Xc(Lt,Vt.mode,Qt),Lt.return=Vt,Lt;case qt:return Lt=rc(Lt),ge(Vt,Lt,Qt)}if(wi(Lt)||qe(Lt))return Lt=Jl(Lt,Vt.mode,Qt,null),Lt.return=Vt,Lt;if(typeof Lt.then=="function")return ge(Vt,Ku(Lt),Qt);if(Lt.$$typeof===pt)return ge(Vt,vo(Vt,Lt),Qt);Qu(Vt,Lt)}return null}function ee(Vt,Lt,Qt,de){var ti=Lt!==null?Lt.key:null;if(typeof Qt=="string"&&Qt!==""||typeof Qt=="number"||typeof Qt=="bigint")return ti!==null?null:st(Vt,Lt,""+Qt,de);if(typeof Qt=="object"&&Qt!==null){switch(Qt.$$typeof){case G:return Qt.key===ti?Rt(Vt,Lt,Qt,de):null;case nt:return Qt.key===ti?Jt(Vt,Lt,Qt,de):null;case qt:return Qt=rc(Qt),ee(Vt,Lt,Qt,de)}if(wi(Qt)||qe(Qt))return ti!==null?null:oe(Vt,Lt,Qt,de,null);if(typeof Qt.then=="function")return ee(Vt,Lt,Ku(Qt),de);if(Qt.$$typeof===pt)return ee(Vt,Lt,vo(Vt,Qt),de);Qu(Vt,Qt)}return null}function re(Vt,Lt,Qt,de,ti){if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return Vt=Vt.get(Qt)||null,st(Lt,Vt,""+de,ti);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case G:return Vt=Vt.get(de.key===null?Qt:de.key)||null,Rt(Lt,Vt,de,ti);case nt:return Vt=Vt.get(de.key===null?Qt:de.key)||null,Jt(Lt,Vt,de,ti);case qt:return de=rc(de),re(Vt,Lt,Qt,de,ti)}if(wi(de)||qe(de))return Vt=Vt.get(Qt)||null,oe(Lt,Vt,de,ti,null);if(typeof de.then=="function")return re(Vt,Lt,Qt,Ku(de),ti);if(de.$$typeof===pt)return re(Vt,Lt,Qt,vo(Lt,de),ti);Qu(Lt,de)}return null}function $e(Vt,Lt,Qt,de){for(var ti=null,Ni=null,Ze=Lt,vi=Lt=0,Pi=null;Ze!==null&&vi<Qt.length;vi++){Ze.index>vi?(Pi=Ze,Ze=null):Pi=Ze.sibling;var Xi=ee(Vt,Ze,Qt[vi],de);if(Xi===null){Ze===null&&(Ze=Pi);break}c&&Ze&&Xi.alternate===null&&d(Vt,Ze),Lt=F(Xi,Lt,vi),Ni===null?ti=Xi:Ni.sibling=Xi,Ni=Xi,Ze=Pi}if(vi===Qt.length)return y(Vt,Ze),Ri&&da(Vt,vi),ti;if(Ze===null){for(;vi<Qt.length;vi++)Ze=ge(Vt,Qt[vi],de),Ze!==null&&(Lt=F(Ze,Lt,vi),Ni===null?ti=Ze:Ni.sibling=Ze,Ni=Ze);return Ri&&da(Vt,vi),ti}for(Ze=S(Ze);vi<Qt.length;vi++)Pi=re(Ze,Vt,vi,Qt[vi],de),Pi!==null&&(c&&Pi.alternate!==null&&Ze.delete(Pi.key===null?vi:Pi.key),Lt=F(Pi,Lt,vi),Ni===null?ti=Pi:Ni.sibling=Pi,Ni=Pi);return c&&Ze.forEach(function(u){return d(Vt,u)}),Ri&&da(Vt,vi),ti}function ai(Vt,Lt,Qt,de){if(Qt==null)throw Error(n(151));for(var ti=null,Ni=null,Ze=Lt,vi=Lt=0,Pi=null,Xi=Qt.next();Ze!==null&&!Xi.done;vi++,Xi=Qt.next()){Ze.index>vi?(Pi=Ze,Ze=null):Pi=Ze.sibling;var u=ee(Vt,Ze,Xi.value,de);if(u===null){Ze===null&&(Ze=Pi);break}c&&Ze&&u.alternate===null&&d(Vt,Ze),Lt=F(u,Lt,vi),Ni===null?ti=u:Ni.sibling=u,Ni=u,Ze=Pi}if(Xi.done)return y(Vt,Ze),Ri&&da(Vt,vi),ti;if(Ze===null){for(;!Xi.done;vi++,Xi=Qt.next())Xi=ge(Vt,Xi.value,de),Xi!==null&&(Lt=F(Xi,Lt,vi),Ni===null?ti=Xi:Ni.sibling=Xi,Ni=Xi);return Ri&&da(Vt,vi),ti}for(Ze=S(Ze);!Xi.done;vi++,Xi=Qt.next())Xi=re(Ze,Vt,vi,Xi.value,de),Xi!==null&&(c&&Xi.alternate!==null&&Ze.delete(Xi.key===null?vi:Xi.key),Lt=F(Xi,Lt,vi),Ni===null?ti=Xi:Ni.sibling=Xi,Ni=Xi);return c&&Ze.forEach(function(r){return d(Vt,r)}),Ri&&da(Vt,vi),ti}function un(Vt,Lt,Qt,de){if(typeof Qt=="object"&&Qt!==null&&Qt.type===at&&Qt.key===null&&(Qt=Qt.props.children),typeof Qt=="object"&&Qt!==null){switch(Qt.$$typeof){case G:t:{for(var ti=Qt.key;Lt!==null;){if(Lt.key===ti){if(ti=Qt.type,ti===at){if(Lt.tag===7){y(Vt,Lt.sibling),de=I(Lt,Qt.props.children),de.return=Vt,Vt=de;break t}}else if(Lt.elementType===ti||typeof ti=="object"&&ti!==null&&ti.$$typeof===qt&&rc(ti)===Lt.type){y(Vt,Lt.sibling),de=I(Lt,Qt.props),sc(de,Qt),de.return=Vt,Vt=de;break t}y(Vt,Lt);break}else d(Vt,Lt);Lt=Lt.sibling}Qt.type===at?(de=Jl(Qt.props.children,Vt.mode,de,Qt.key),de.return=Vt,Vt=de):(de=$u(Qt.type,Qt.key,Qt.props,null,Vt.mode,de),sc(de,Qt),de.return=Vt,Vt=de)}return X(Vt);case nt:t:{for(ti=Qt.key;Lt!==null;){if(Lt.key===ti)if(Lt.tag===4&&Lt.stateNode.containerInfo===Qt.containerInfo&&Lt.stateNode.implementation===Qt.implementation){y(Vt,Lt.sibling),de=I(Lt,Qt.children||[]),de.return=Vt,Vt=de;break t}else{y(Vt,Lt);break}else d(Vt,Lt);Lt=Lt.sibling}de=Xc(Qt,Vt.mode,de),de.return=Vt,Vt=de}return X(Vt);case qt:return Qt=rc(Qt),un(Vt,Lt,Qt,de)}if(wi(Qt))return $e(Vt,Lt,Qt,de);if(qe(Qt)){if(ti=qe(Qt),typeof ti!="function")throw Error(n(150));return Qt=ti.call(Qt),ai(Vt,Lt,Qt,de)}if(typeof Qt.then=="function")return un(Vt,Lt,Ku(Qt),de);if(Qt.$$typeof===pt)return un(Vt,Lt,vo(Vt,Qt),de);Qu(Vt,Qt)}return typeof Qt=="string"&&Qt!==""||typeof Qt=="number"||typeof Qt=="bigint"?(Qt=""+Qt,Lt!==null&&Lt.tag===6?(y(Vt,Lt.sibling),de=I(Lt,Qt),de.return=Vt,Vt=de):(y(Vt,Lt),de=qc(Qt,Vt.mode,de),de.return=Vt,Vt=de),X(Vt)):y(Vt,Lt)}return function(Vt,Lt,Qt,de){try{Kc=0;var ti=un(Vt,Lt,Qt,de);return Qa=null,ti}catch(Ze){if(Ze===ga||Ze===Yu)throw Ze;var Ni=Ts(29,Ze,null,Vt.mode);return Ni.lanes=de,Ni.return=Vt,Ni}finally{}}}var cl=Ju(!0),cm=Ju(!1),jr=!1;function Hi(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function hf(c,d){c=c.updateQueue,d.updateQueue===c&&(d.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function _a(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function ya(c,d,y){var S=c.updateQueue;if(S===null)return null;if(S=S.shared,(ji&2)!==0){var I=S.pending;return I===null?d.next=d:(d.next=I.next,I.next=d),S.pending=d,d=pi(c),rf(c,null,y),d}return fo(c,S,d,y),pi(c)}function ac(c,d,y){if(d=d.updateQueue,d!==null&&(d=d.shared,(y&4194048)!==0)){var S=d.lanes;S&=c.pendingLanes,y|=S,d.lanes=y,Bi(c,y)}}function ff(c,d){var y=c.updateQueue,S=c.alternate;if(S!==null&&(S=S.updateQueue,y===S)){var I=null,F=null;if(y=y.firstBaseUpdate,y!==null){do{var X={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};F===null?I=F=X:F=F.next=X,y=y.next}while(y!==null);F===null?I=F=d:F=F.next=d}else I=F=d;y={baseState:S.baseState,firstBaseUpdate:I,lastBaseUpdate:F,shared:S.shared,callbacks:S.callbacks},c.updateQueue=y;return}c=y.lastBaseUpdate,c===null?y.firstBaseUpdate=d:c.next=d,y.lastBaseUpdate=d}var df=!1;function Qc(){if(df){var c=Xs;if(c!==null)throw c}}function os(c,d,y,S){df=!1;var I=c.updateQueue;jr=!1;var F=I.firstBaseUpdate,X=I.lastBaseUpdate,st=I.shared.pending;if(st!==null){I.shared.pending=null;var Rt=st,Jt=Rt.next;Rt.next=null,X===null?F=Jt:X.next=Jt,X=Rt;var oe=c.alternate;oe!==null&&(oe=oe.updateQueue,st=oe.lastBaseUpdate,st!==X&&(st===null?oe.firstBaseUpdate=Jt:st.next=Jt,oe.lastBaseUpdate=Rt))}if(F!==null){var ge=I.baseState;X=0,oe=Jt=Rt=null,st=F;do{var ee=st.lane&-536870913,re=ee!==st.lane;if(re?(ki&ee)===ee:(S&ee)===ee){ee!==0&&ee===Ga&&(df=!0),oe!==null&&(oe=oe.next={lane:0,tag:st.tag,payload:st.payload,callback:null,next:null});t:{var $e=c,ai=st;ee=d;var un=y;switch(ai.tag){case 1:if($e=ai.payload,typeof $e=="function"){ge=$e.call(un,ge,ee);break t}ge=$e;break t;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=ai.payload,ee=typeof $e=="function"?$e.call(un,ge,ee):$e,ee==null)break t;ge=L({},ge,ee);break t;case 2:jr=!0}}ee=st.callback,ee!==null&&(c.flags|=64,re&&(c.flags|=8192),re=I.callbacks,re===null?I.callbacks=[ee]:re.push(ee))}else re={lane:ee,tag:st.tag,payload:st.payload,callback:st.callback,next:null},oe===null?(Jt=oe=re,Rt=ge):oe=oe.next=re,X|=ee;if(st=st.next,st===null){if(st=I.shared.pending,st===null)break;re=st,st=re.next,re.next=null,I.lastBaseUpdate=re,I.shared.pending=null}}while(!0);oe===null&&(Rt=ge),I.baseState=Rt,I.firstBaseUpdate=Jt,I.lastBaseUpdate=oe,F===null&&(I.shared.lanes=0),au|=X,c.lanes=X,c.memoizedState=ge}}function Jc(c,d){if(typeof c!="function")throw Error(n(191,c));c.call(d)}function ze(c,d){var y=c.callbacks;if(y!==null)for(c.callbacks=null,c=0;c<y.length;c++)Jc(y[c],d)}var je=Dt(null),ul=Dt(0);function th(c,d){c=fc,Ce(ul,c),Ce(je,d),fc=c|d.baseLanes}function tu(){Ce(ul,fc),Ce(je,je.current)}function Ir(){fc=ul.current,he(je),he(ul)}var ls=Dt(null),In=null;function Ja(c){var d=c.alternate;Ce(fi,fi.current&1),Ce(ls,c),In===null&&(d===null||je.current!==null||d.memoizedState!==null)&&(In=c)}function Ad(c){Ce(fi,fi.current),Ce(ls,c),In===null&&(In=c)}function um(c){c.tag===22?(Ce(fi,fi.current),Ce(ls,c),In===null&&(In=c)):hl()}function hl(){Ce(fi,fi.current),Ce(ls,ls.current)}function Dr(c){he(ls),In===c&&(In=null),he(fi)}var fi=Dt(0);function Wi(c){for(var d=c;d!==null;){if(d.tag===13){var y=d.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||Gn(y)||If(y)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var to=0,ci=null,Vi=null,Dn=null,eu=!1,fl=!1,kr=!1,oc=0,bo=0,xo=null,eh=0;function Tn(){throw Error(n(321))}function dl(c,d){if(d===null)return!1;for(var y=0;y<d.length&&y<c.length;y++)if(!Mr(c[y],d[y]))return!1;return!0}function wo(c,d,y,S,I,F){return to=F,ci=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,ne.H=c===null||c.memoizedState===null?gl:Md,kr=!1,F=y(S,I),kr=!1,fl&&(F=ih(d,y,S,I)),pf(c),F}function pf(c){ne.H=iu;var d=Vi!==null&&Vi.next!==null;if(to=0,Dn=Vi=ci=null,eu=!1,bo=0,xo=null,d)throw Error(n(300));c===null||hr||(c=c.dependencies,c!==null&&Xu(c)&&(hr=!0))}function ih(c,d,y,S){ci=c;var I=0;do{if(fl&&(xo=null),bo=0,fl=!1,25<=I)throw Error(n(301));if(I+=1,Dn=Vi=null,c.updateQueue!=null){var F=c.updateQueue;F.lastEffect=null,F.events=null,F.stores=null,F.memoCache!=null&&(F.memoCache.index=0)}ne.H=Rd,F=d(y,S)}while(fl);return F}function pl(){var c=ne.H,d=c.useState()[0];return d=typeof d.then=="function"?h(d):d,c=c.useState()[0],(Vi!==null?Vi.memoizedState:null)!==c&&(ci.flags|=1024),d}function nh(){var c=oc!==0;return oc=0,c}function rh(c,d,y){d.updateQueue=c.updateQueue,d.flags&=-2053,c.lanes&=~y}function lc(c){if(eu){for(c=c.memoizedState;c!==null;){var d=c.queue;d!==null&&(d.pending=null),c=c.next}eu=!1}to=0,Dn=Vi=ci=null,fl=!1,bo=oc=0,xo=null}function Or(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?ci.memoizedState=Dn=c:Dn=Dn.next=c,Dn}function T(){if(Vi===null){var c=ci.alternate;c=c!==null?c.memoizedState:null}else c=Vi.next;var d=Dn===null?ci.memoizedState:Dn.next;if(d!==null)Dn=d,Vi=c;else{if(c===null)throw ci.alternate===null?Error(n(467)):Error(n(310));Vi=c,c={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},Dn===null?ci.memoizedState=Dn=c:Dn=Dn.next=c}return Dn}function s(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function h(c){var d=bo;return bo+=1,xo===null&&(xo=[]),c=lf(xo,c,d),d=ci,(Dn===null?d.memoizedState:Dn.next)===null&&(d=d.alternate,ne.H=d===null||d.memoizedState===null?gl:Md),c}function _(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return h(c);if(c.$$typeof===pt)return cr(c)}throw Error(n(438,String(c)))}function b(c){var d=null,y=ci.updateQueue;if(y!==null&&(d=y.memoCache),d==null){var S=ci.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(d={data:S.data.map(function(I){return I.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),y===null&&(y=s(),ci.updateQueue=y),y.memoCache=d,y=d.data[d.index],y===void 0)for(y=d.data[d.index]=Array(c),S=0;S<c;S++)y[S]=Oe;return d.index++,y}function A(c,d){return typeof d=="function"?d(c):d}function M(c){var d=T();return k(d,Vi,c)}function k(c,d,y){var S=c.queue;if(S===null)throw Error(n(311));S.lastRenderedReducer=y;var I=c.baseQueue,F=S.pending;if(F!==null){if(I!==null){var X=I.next;I.next=F.next,F.next=X}d.baseQueue=I=F,S.pending=null}if(F=c.baseState,I===null)c.memoizedState=F;else{d=I.next;var st=X=null,Rt=null,Jt=d,oe=!1;do{var ge=Jt.lane&-536870913;if(ge!==Jt.lane?(ki&ge)===ge:(to&ge)===ge){var ee=Jt.revertLane;if(ee===0)Rt!==null&&(Rt=Rt.next={lane:0,revertLane:0,gesture:null,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null}),ge===Ga&&(oe=!0);else if((to&ee)===ee){Jt=Jt.next,ee===Ga&&(oe=!0);continue}else ge={lane:0,revertLane:Jt.revertLane,gesture:null,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null},Rt===null?(st=Rt=ge,X=F):Rt=Rt.next=ge,ci.lanes|=ee,au|=ee;ge=Jt.action,kr&&y(F,ge),F=Jt.hasEagerState?Jt.eagerState:y(F,ge)}else ee={lane:ge,revertLane:Jt.revertLane,gesture:Jt.gesture,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null},Rt===null?(st=Rt=ee,X=F):Rt=Rt.next=ee,ci.lanes|=ge,au|=ge;Jt=Jt.next}while(Jt!==null&&Jt!==d);if(Rt===null?X=F:Rt.next=st,!Mr(F,c.memoizedState)&&(hr=!0,oe&&(y=Xs,y!==null)))throw y;c.memoizedState=F,c.baseState=X,c.baseQueue=Rt,S.lastRenderedState=F}return I===null&&(S.lanes=0),[c.memoizedState,S.dispatch]}function O(c){var d=T(),y=d.queue;if(y===null)throw Error(n(311));y.lastRenderedReducer=c;var S=y.dispatch,I=y.pending,F=d.memoizedState;if(I!==null){y.pending=null;var X=I=I.next;do F=c(F,X.action),X=X.next;while(X!==I);Mr(F,d.memoizedState)||(hr=!0),d.memoizedState=F,d.baseQueue===null&&(d.baseState=F),y.lastRenderedState=F}return[F,S]}function z(c,d,y){var S=ci,I=T(),F=Ri;if(F){if(y===void 0)throw Error(n(407));y=y()}else y=d();var X=!Mr((Vi||I).memoizedState,y);if(X&&(I.memoizedState=y,hr=!0),I=I.queue,Fi(H.bind(null,S,I,c),[c]),I.getSnapshot!==d||X||Dn!==null&&Dn.memoizedState.tag&1){if(S.flags|=2048,ve(9,{destroy:void 0},q.bind(null,S,I,y,d),null),xn===null)throw Error(n(349));F||(to&127)!==0||U(S,d,y)}return y}function U(c,d,y){c.flags|=16384,c={getSnapshot:d,value:y},d=ci.updateQueue,d===null?(d=s(),ci.updateQueue=d,d.stores=[c]):(y=d.stores,y===null?d.stores=[c]:y.push(c))}function q(c,d,y,S){d.value=y,d.getSnapshot=S,Y(d)&&et(c)}function H(c,d,y){return y(function(){Y(d)&&et(c)})}function Y(c){var d=c.getSnapshot;c=c.value;try{var y=d();return!Mr(c,y)}catch{return!0}}function et(c){var d=il(c,2);d!==null&&Lr(d,c,2)}function ot(c){var d=Or();if(typeof c=="function"){var y=c;if(c=y(),kr){Ct(!0);try{y()}finally{Ct(!1)}}}return d.memoizedState=d.baseState=c,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:A,lastRenderedState:c},d}function ct(c,d,y,S){return c.baseState=y,k(c,Vi,typeof S=="function"?S:A)}function ht(c,d,y,S,I){if(sn(c))throw Error(n(485));if(c=d.action,c!==null){var F={payload:I,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(X){F.listeners.push(X)}};ne.T!==null?y(!0):F.isTransition=!1,S(F),y=d.pending,y===null?(F.next=d.pending=F,_t(d,F)):(F.next=y.next,d.pending=y.next=F)}}function _t(c,d){var y=d.action,S=d.payload,I=c.state;if(d.isTransition){var F=ne.T,X={};ne.T=X;try{var st=y(I,S),Rt=ne.S;Rt!==null&&Rt(X,st),Tt(c,d,st)}catch(Jt){St(c,d,Jt)}finally{F!==null&&X.types!==null&&(F.types=X.types),ne.T=F}}else try{F=y(I,S),Tt(c,d,F)}catch(Jt){St(c,d,Jt)}}function Tt(c,d,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(S){gt(c,d,S)},function(S){return St(c,d,S)}):gt(c,d,y)}function gt(c,d,y){d.status="fulfilled",d.value=y,Et(d),c.state=y,d=c.pending,d!==null&&(y=d.next,y===d?c.pending=null:(y=y.next,d.next=y,_t(c,y)))}function St(c,d,y){var S=c.pending;if(c.pending=null,S!==null){S=S.next;do d.status="rejected",d.reason=y,Et(d),d=d.next;while(d!==S)}c.action=null}function Et(c){c=c.listeners;for(var d=0;d<c.length;d++)(0,c[d])()}function xt(c,d){return d}function Bt(c,d){if(Ri){var y=xn.formState;if(y!==null){t:{var S=ci;if(Ri){if(cn){e:{for(var I=cn,F=Ii;I.nodeType!==8;){if(!F){I=null;break e}if(I=Sa(I.nextSibling),I===null){I=null;break e}}F=I.data,I=F==="F!"||F==="F"?I:null}if(I){cn=Sa(I.nextSibling),S=I.data==="F!";break t}}Hn(S)}S=!1}S&&(d=y[0])}}return y=Or(),y.memoizedState=y.baseState=d,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xt,lastRenderedState:d},y.queue=S,y=mn.bind(null,ci,S),S.dispatch=y,S=ot(!1),F=Sn.bind(null,ci,!1,S.queue),S=Or(),I={state:d,dispatch:null,action:c,pending:null},S.queue=I,y=ht.bind(null,ci,I,F,y),I.dispatch=y,S.memoizedState=c,[d,y,!1]}function Gt(c){var d=T();return Ht(d,Vi,c)}function Ht(c,d,y){if(d=k(c,d,xt)[0],c=M(A)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var S=h(d)}catch(X){throw X===ga?Yu:X}else S=d;d=T();var I=d.queue,F=I.dispatch;return y!==d.memoizedState&&(ci.flags|=2048,ve(9,{destroy:void 0},Wt.bind(null,I,y),null)),[S,F,c]}function Wt(c,d){c.action=d}function Yt(c){var d=T(),y=Vi;if(y!==null)return Ht(d,y,c);T(),d=d.memoizedState,y=T();var S=y.queue.dispatch;return y.memoizedState=c,[d,S,!1]}function ve(c,d,y,S){return c={tag:c,create:y,deps:S,inst:d,next:null},d=ci.updateQueue,d===null&&(d=s(),ci.updateQueue=d),y=d.lastEffect,y===null?d.lastEffect=c.next=c:(S=y.next,y.next=c,c.next=S,d.lastEffect=c),c}function Te(){return T().memoizedState}function ce(c,d,y,S){var I=Or();ci.flags|=c,I.memoizedState=ve(1|d,{destroy:void 0},y,S===void 0?null:S)}function ke(c,d,y,S){var I=T();S=S===void 0?null:S;var F=I.memoizedState.inst;Vi!==null&&S!==null&&dl(S,Vi.memoizedState.deps)?I.memoizedState=ve(d,F,y,S):(ci.flags|=c,I.memoizedState=ve(1|d,F,y,S))}function Ve(c,d){ce(8390656,8,c,d)}function Fi(c,d){ke(2048,8,c,d)}function dn(c){ci.flags|=4;var d=ci.updateQueue;if(d===null)d=s(),ci.updateQueue=d,d.events=[c];else{var y=d.events;y===null?d.events=[c]:y.push(c)}}function rn(c){var d=T().memoizedState;return dn({ref:d,nextImpl:c}),function(){if((ji&2)!==0)throw Error(n(440));return d.impl.apply(void 0,arguments)}}function pn(c,d){return ke(4,2,c,d)}function Gi(c,d){return ke(4,4,c,d)}function qn(c,d){if(typeof d=="function"){c=c();var y=d(c);return function(){typeof y=="function"?y():d(null)}}if(d!=null)return c=c(),d.current=c,function(){d.current=null}}function Yi(c,d,y){y=y!=null?y.concat([c]):null,ke(4,4,qn.bind(null,d,c),y)}function tr(){}function kn(c,d){var y=T();d=d===void 0?null:d;var S=y.memoizedState;return d!==null&&dl(d,S[1])?S[0]:(y.memoizedState=[c,d],c)}function Xn(c,d){var y=T();d=d===void 0?null:d;var S=y.memoizedState;if(d!==null&&dl(d,S[1]))return S[0];if(S=c(),kr){Ct(!0);try{c()}finally{Ct(!1)}}return y.memoizedState=[S,d],S}function vr(c,d,y){return y===void 0||(to&1073741824)!==0&&(ki&261930)===0?c.memoizedState=d:(c.memoizedState=y,c=Dm(),ci.lanes|=c,au|=c,y)}function va(c,d,y,S){return Mr(y,d)?y:je.current!==null?(c=vr(c,y,S),Mr(c,d)||(hr=!0),c):(to&42)===0||(to&1073741824)!==0&&(ki&261930)===0?(hr=!0,c.memoizedState=y):(c=Dm(),ci.lanes|=c,au|=c,d)}function To(c,d,y,S,I){var F=we.p;we.p=F!==0&&8>F?F:8;var X=ne.T,st={};ne.T=st,Sn(c,!1,d,y);try{var Rt=I(),Jt=ne.S;if(Jt!==null&&Jt(st,Rt),Rt!==null&&typeof Rt=="object"&&typeof Rt.then=="function"){var oe=Zu(Rt,S);qi(c,d,oe,Ys(c))}else qi(c,d,S,Ys(c))}catch(ge){qi(c,d,{then:function(){},status:"rejected",reason:ge},Ys())}finally{we.p=F,X!==null&&st.types!==null&&(X.types=st.types),ne.T=X}}function So(){}function ba(c,d,y,S){if(c.tag!==5)throw Error(n(476));var I=Fs(c).queue;To(c,I,d,ye,y===null?So:function(){return ml(c),y(S)})}function Fs(c){var d=c.memoizedState;if(d!==null)return d;d={memoizedState:ye,baseState:ye,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:A,lastRenderedState:ye},next:null};var y={};return d.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:A,lastRenderedState:y},next:null},c.memoizedState=d,c=c.alternate,c!==null&&(c.memoizedState=d),d}function ml(c){var d=Fs(c);d.next===null&&(d=c.alternate.memoizedState),qi(c,d.next.queue,{},Ys())}function Ao(){return cr(op)}function Cs(){return T().memoizedState}function Eo(){return T().memoizedState}function Co(c){for(var d=c.return;d!==null;){switch(d.tag){case 24:case 3:var y=Ys();c=_a(y);var S=ya(d,c,y);S!==null&&(Lr(S,d,y),ac(S,d,y)),d={cache:As()},c.payload=d;return}d=d.return}}function Mo(c,d,y){var S=Ys();y={lane:S,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},sn(c)?Ed(d,y):(y=el(c,d,y,S),y!==null&&(Lr(y,c,S),Cd(y,d,S)))}function mn(c,d,y){var S=Ys();qi(c,d,y,S)}function qi(c,d,y,S){var I={lane:S,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null};if(sn(c))Ed(d,I);else{var F=c.alternate;if(c.lanes===0&&(F===null||F.lanes===0)&&(F=d.lastRenderedReducer,F!==null))try{var X=d.lastRenderedState,st=F(X,y);if(I.hasEagerState=!0,I.eagerState=st,Mr(st,X))return fo(c,d,I,0),xn===null&&ju(),!1}catch{}finally{}if(y=el(c,d,I,S),y!==null)return Lr(y,c,S),Cd(y,d,S),!0}return!1}function Sn(c,d,y,S){if(S={lane:2,revertLane:jm(),gesture:null,action:S,hasEagerState:!1,eagerState:null,next:null},sn(c)){if(d)throw Error(n(479))}else d=el(c,y,S,2),d!==null&&Lr(d,c,2)}function sn(c){var d=c.alternate;return c===ci||d!==null&&d===ci}function Ed(c,d){fl=eu=!0;var y=c.pending;y===null?d.next=d:(d.next=y.next,y.next=d),c.pending=d}function Cd(c,d,y){if((y&4194048)!==0){var S=d.lanes;S&=c.pendingLanes,y|=S,d.lanes=y,Bi(c,y)}}var iu={readContext:cr,use:_,useCallback:Tn,useContext:Tn,useEffect:Tn,useImperativeHandle:Tn,useLayoutEffect:Tn,useInsertionEffect:Tn,useMemo:Tn,useReducer:Tn,useRef:Tn,useState:Tn,useDebugValue:Tn,useDeferredValue:Tn,useTransition:Tn,useSyncExternalStore:Tn,useId:Tn,useHostTransitionStatus:Tn,useFormState:Tn,useActionState:Tn,useOptimistic:Tn,useMemoCache:Tn,useCacheRefresh:Tn};iu.useEffectEvent=Tn;var gl={readContext:cr,use:_,useCallback:function(c,d){return Or().memoizedState=[c,d===void 0?null:d],c},useContext:cr,useEffect:Ve,useImperativeHandle:function(c,d,y){y=y!=null?y.concat([c]):null,ce(4194308,4,qn.bind(null,d,c),y)},useLayoutEffect:function(c,d){return ce(4194308,4,c,d)},useInsertionEffect:function(c,d){ce(4,2,c,d)},useMemo:function(c,d){var y=Or();d=d===void 0?null:d;var S=c();if(kr){Ct(!0);try{c()}finally{Ct(!1)}}return y.memoizedState=[S,d],S},useReducer:function(c,d,y){var S=Or();if(y!==void 0){var I=y(d);if(kr){Ct(!0);try{y(d)}finally{Ct(!1)}}}else I=d;return S.memoizedState=S.baseState=I,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:I},S.queue=c,c=c.dispatch=Mo.bind(null,ci,c),[S.memoizedState,c]},useRef:function(c){var d=Or();return c={current:c},d.memoizedState=c},useState:function(c){c=ot(c);var d=c.queue,y=mn.bind(null,ci,d);return d.dispatch=y,[c.memoizedState,y]},useDebugValue:tr,useDeferredValue:function(c,d){var y=Or();return vr(y,c,d)},useTransition:function(){var c=ot(!1);return c=To.bind(null,ci,c.queue,!0,!1),Or().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,d,y){var S=ci,I=Or();if(Ri){if(y===void 0)throw Error(n(407));y=y()}else{if(y=d(),xn===null)throw Error(n(349));(ki&127)!==0||U(S,d,y)}I.memoizedState=y;var F={value:y,getSnapshot:d};return I.queue=F,Ve(H.bind(null,S,F,c),[c]),S.flags|=2048,ve(9,{destroy:void 0},q.bind(null,S,F,y,d),null),y},useId:function(){var c=Or(),d=xn.identifierPrefix;if(Ri){var y=Ha,S=Ss;y=(S&~(1<<32-Q(S)-1)).toString(32)+y,d="_"+d+"R_"+y,y=oc++,0<y&&(d+="H"+y.toString(32)),d+="_"}else y=eh++,d="_"+d+"r_"+y.toString(32)+"_";return c.memoizedState=d},useHostTransitionStatus:Ao,useFormState:Bt,useActionState:Bt,useOptimistic:function(c){var d=Or();d.memoizedState=d.baseState=c;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=y,d=Sn.bind(null,ci,!0,y),y.dispatch=d,[c,d]},useMemoCache:b,useCacheRefresh:function(){return Or().memoizedState=Co.bind(null,ci)},useEffectEvent:function(c){var d=Or(),y={impl:c};return d.memoizedState=y,function(){if((ji&2)!==0)throw Error(n(440));return y.impl.apply(void 0,arguments)}}},Md={readContext:cr,use:_,useCallback:kn,useContext:cr,useEffect:Fi,useImperativeHandle:Yi,useInsertionEffect:pn,useLayoutEffect:Gi,useMemo:Xn,useReducer:M,useRef:Te,useState:function(){return M(A)},useDebugValue:tr,useDeferredValue:function(c,d){var y=T();return va(y,Vi.memoizedState,c,d)},useTransition:function(){var c=M(A)[0],d=T().memoizedState;return[typeof c=="boolean"?c:h(c),d]},useSyncExternalStore:z,useId:Cs,useHostTransitionStatus:Ao,useFormState:Gt,useActionState:Gt,useOptimistic:function(c,d){var y=T();return ct(y,Vi,c,d)},useMemoCache:b,useCacheRefresh:Eo};Md.useEffectEvent=rn;var Rd={readContext:cr,use:_,useCallback:kn,useContext:cr,useEffect:Fi,useImperativeHandle:Yi,useInsertionEffect:pn,useLayoutEffect:Gi,useMemo:Xn,useReducer:O,useRef:Te,useState:function(){return O(A)},useDebugValue:tr,useDeferredValue:function(c,d){var y=T();return Vi===null?vr(y,c,d):va(y,Vi.memoizedState,c,d)},useTransition:function(){var c=O(A)[0],d=T().memoizedState;return[typeof c=="boolean"?c:h(c),d]},useSyncExternalStore:z,useId:Cs,useHostTransitionStatus:Ao,useFormState:Yt,useActionState:Yt,useOptimistic:function(c,d){var y=T();return Vi!==null?ct(y,Vi,c,d):(y.baseState=c,[c,y.queue.dispatch])},useMemoCache:b,useCacheRefresh:Eo};Rd.useEffectEvent=rn;function xa(c,d,y,S){d=c.memoizedState,y=y(S,d),y=y==null?d:L({},d,y),c.memoizedState=y,c.lanes===0&&(c.updateQueue.baseState=y)}var sh={enqueueSetState:function(c,d,y){c=c._reactInternals;var S=Ys(),I=_a(S);I.payload=d,y!=null&&(I.callback=y),d=ya(c,I,S),d!==null&&(Lr(d,c,S),ac(d,c,S))},enqueueReplaceState:function(c,d,y){c=c._reactInternals;var S=Ys(),I=_a(S);I.tag=1,I.payload=d,y!=null&&(I.callback=y),d=ya(c,I,S),d!==null&&(Lr(d,c,S),ac(d,c,S))},enqueueForceUpdate:function(c,d){c=c._reactInternals;var y=Ys(),S=_a(y);S.tag=2,d!=null&&(S.callback=d),d=ya(c,S,y),d!==null&&(Lr(d,c,y),ac(d,c,y))}};function Ro(c,d,y,S,I,F,X){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(S,F,X):d.prototype&&d.prototype.isPureReactComponent?!ws(y,S)||!ws(I,F):!0}function Po(c,d,y,S){c=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(y,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(y,S),d.state!==c&&sh.enqueueReplaceState(d,d.state,null)}function eo(c,d){var y=d;if("ref"in d){y={};for(var S in d)S!=="ref"&&(y[S]=d[S])}if(c=c.defaultProps){y===d&&(y=L({},y));for(var I in c)y[I]===void 0&&(y[I]=c[I])}return y}function Pd(c){Kl(c)}function nu(c){console.error(c)}function r_(c){Kl(c)}function ah(c,d){try{var y=c.onUncaughtError;y(d.value,{componentStack:d.stack})}catch(S){setTimeout(function(){throw S})}}function s_(c,d,y){try{var S=c.onCaughtError;S(y.value,{componentStack:y.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(I){setTimeout(function(){throw I})}}function a_(c,d,y){return y=_a(y),y.tag=3,y.payload={element:null},y.callback=function(){ah(c,d)},y}function hm(c){return c=_a(c),c.tag=3,c}function Uy(c,d,y,S){var I=y.type.getDerivedStateFromError;if(typeof I=="function"){var F=S.value;c.payload=function(){return I(F)},c.callback=function(){s_(d,y,S)}}var X=y.stateNode;X!==null&&typeof X.componentDidCatch=="function"&&(c.callback=function(){s_(d,y,S),typeof I!="function"&&(lu===null?lu=new Set([this]):lu.add(this));var st=S.stack;this.componentDidCatch(S.value,{componentStack:st!==null?st:""})})}function o_(c,d,y,S,I){if(y.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(d=y.alternate,d!==null&&ol(d,y,I,!0),y=ls.current,y!==null){switch(y.tag){case 31:case 13:return In===null?Om():y.alternate===null&&ir===0&&(ir=3),y.flags&=-257,y.flags|=65536,y.lanes=I,S===ll?y.flags|=16384:(d=y.updateQueue,d===null?y.updateQueue=new Set([S]):d.add(S),E_(c,S,I)),!1;case 22:return y.flags|=65536,S===ll?y.flags|=16384:(d=y.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([S])},y.updateQueue=d):(y=d.retryQueue,y===null?d.retryQueue=new Set([S]):y.add(S)),E_(c,S,I)),!1}throw Error(n(435,y.tag))}return E_(c,S,I),Om(),!1}if(Ri)return d=ls.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=I,S!==pa&&(c=Error(n(422),{cause:S}),_o(ss(c,y)))):(S!==pa&&(d=Error(n(423),{cause:S}),_o(ss(d,y))),c=c.current.alternate,c.flags|=65536,I&=-I,c.lanes|=I,S=ss(S,y),I=a_(c.stateNode,S,I),ff(c,I),ir!==4&&(ir=2)),!1;var F=Error(n(520),{cause:S});if(F=ss(F,y),Tf===null?Tf=[F]:Tf.push(F),ir!==4&&(ir=2),d===null)return!0;S=ss(S,y),y=d;do{switch(y.tag){case 3:return y.flags|=65536,c=I&-I,y.lanes|=c,c=a_(y.stateNode,S,c),ff(y,c),!1;case 1:if(d=y.type,F=y.stateNode,(y.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(lu===null||!lu.has(F))))return y.flags|=65536,I&=-I,y.lanes|=I,I=hm(I),Uy(I,c,y,S),ff(y,I),!1}y=y.return}while(y!==null);return!1}var fm=Error(n(461)),hr=!1;function er(c,d,y,S){d.child=c===null?cm(d,null,y,S):cl(d,c.child,y,S)}function Vy(c,d,y,S,I){y=y.render;var F=d.ref;if("ref"in S){var X={};for(var st in S)st!=="ref"&&(X[st]=S[st])}else X=S;return yo(d),S=wo(c,d,y,X,F,I),st=nh(),c!==null&&!hr?(rh(c,d,I),cc(c,d,I)):(Ri&&st&&Gc(d),d.flags|=1,er(c,d,S,I),d.child)}function oh(c,d,y,S,I){if(c===null){var F=y.type;return typeof F=="function"&&!Ql(F)&&F.defaultProps===void 0&&y.compare===null?(d.tag=15,d.type=F,Id(c,d,F,S,I)):(c=$u(y.type,null,S,d,d.mode,I),c.ref=d.ref,c.return=d,d.child=c)}if(F=c.child,!xm(c,I)){var X=F.memoizedProps;if(y=y.compare,y=y!==null?y:ws,y(X,S)&&c.ref===d.ref)return cc(c,d,I)}return d.flags|=1,c=fa(F,S),c.ref=d.ref,c.return=d,d.child=c}function Id(c,d,y,S,I){if(c!==null){var F=c.memoizedProps;if(ws(F,S)&&c.ref===d.ref)if(hr=!1,d.pendingProps=S=F,xm(c,I))(c.flags&131072)!==0&&(hr=!0);else return d.lanes=c.lanes,cc(c,d,I)}return pm(c,d,y,S,I)}function Dd(c,d,y,S){var I=S.children,F=c!==null?c.memoizedState:null;if(c===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),S.mode==="hidden"){if((d.flags&128)!==0){if(F=F!==null?F.baseLanes|y:y,c!==null){for(S=d.child=c.child,I=0;S!==null;)I=I|S.lanes|S.childLanes,S=S.sibling;S=I&~F}else S=0,d.child=null;return jy(c,d,F,y,S)}if((y&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},c!==null&&Es(d,F!==null?F.cachePool:null),F!==null?th(d,F):tu(),um(d);else return S=d.lanes=536870912,jy(c,d,F!==null?F.baseLanes|y:y,y,S)}else F!==null?(Es(d,F.cachePool),th(d,F),hl(),d.memoizedState=null):(c!==null&&Es(d,null),tu(),hl());return er(c,d,I,y),d.child}function kd(c,d){return c!==null&&c.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function jy(c,d,y,S,I){var F=nc();return F=F===null?null:{parent:Wn._currentValue,pool:F},d.memoizedState={baseLanes:y,cachePool:F},c!==null&&Es(d,null),tu(),um(d),c!==null&&ol(c,d,S,!0),d.childLanes=I,null}function dm(c,d){return d=gf({mode:d.mode,children:d.children},c.mode),d.ref=c.ref,c.child=d,d.return=c,d}function $y(c,d,y){return cl(d,c.child,null,y),c=dm(d,d.pendingProps),c.flags|=2,Dr(d),d.memoizedState=null,c}function Hy(c,d,y){var S=d.pendingProps,I=(d.flags&128)!==0;if(d.flags&=-129,c===null){if(Ri){if(S.mode==="hidden")return c=dm(d,S),d.lanes=536870912,kd(null,c);if(Ad(d),(c=cn)?(c=Ym(c,Ii),c=c!==null&&c.data==="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:go!==null?{id:Ss,overflow:Ha}:null,retryLane:536870912,hydrationErrors:null},y=Hu(c),y.return=d,d.child=y,Jn=d,cn=null)):c=null,c===null)throw Hn(d);return d.lanes=536870912,null}return dm(d,S)}var F=c.memoizedState;if(F!==null){var X=F.dehydrated;if(Ad(d),I)if(d.flags&256)d.flags&=-257,d=$y(c,d,y);else if(d.memoizedState!==null)d.child=c.child,d.flags|=128,d=null;else throw Error(n(558));else if(hr||ol(c,d,y,!1),I=(y&c.childLanes)!==0,hr||I){if(S=xn,S!==null&&(X=Qi(S,y),X!==0&&X!==F.retryLane))throw F.retryLane=X,il(c,X),Lr(S,c,X),fm;Om(),d=$y(c,d,y)}else c=F.treeContext,cn=Sa(X.nextSibling),Jn=d,Ri=!0,Wa=null,Ii=!1,c!==null&&wd(d,c),d=dm(d,S),d.flags|=4096;return d}return c=fa(c.child,{mode:S.mode,children:S.children}),c.ref=d.ref,d.child=c,c.return=d,c}function mf(c,d){var y=d.ref;if(y===null)c!==null&&c.ref!==null&&(d.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(n(284));(c===null||c.ref!==y)&&(d.flags|=4194816)}}function pm(c,d,y,S,I){return yo(d),y=wo(c,d,y,S,void 0,I),S=nh(),c!==null&&!hr?(rh(c,d,I),cc(c,d,I)):(Ri&&S&&Gc(d),d.flags|=1,er(c,d,y,I),d.child)}function l_(c,d,y,S,I,F){return yo(d),d.updateQueue=null,y=ih(d,S,y,I),pf(c),S=nh(),c!==null&&!hr?(rh(c,d,F),cc(c,d,F)):(Ri&&S&&Gc(d),d.flags|=1,er(c,d,y,F),d.child)}function Wy(c,d,y,S,I){if(yo(d),d.stateNode===null){var F=po,X=y.contextType;typeof X=="object"&&X!==null&&(F=cr(X)),F=new y(S,F),d.memoizedState=F.state!==null&&F.state!==void 0?F.state:null,F.updater=sh,d.stateNode=F,F._reactInternals=d,F=d.stateNode,F.props=S,F.state=d.memoizedState,F.refs={},Hi(d),X=y.contextType,F.context=typeof X=="object"&&X!==null?cr(X):po,F.state=d.memoizedState,X=y.getDerivedStateFromProps,typeof X=="function"&&(xa(d,y,X,S),F.state=d.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof F.getSnapshotBeforeUpdate=="function"||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(X=F.state,typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount(),X!==F.state&&sh.enqueueReplaceState(F,F.state,null),os(d,S,F,I),Qc(),F.state=d.memoizedState),typeof F.componentDidMount=="function"&&(d.flags|=4194308),S=!0}else if(c===null){F=d.stateNode;var st=d.memoizedProps,Rt=eo(y,st);F.props=Rt;var Jt=F.context,oe=y.contextType;X=po,typeof oe=="object"&&oe!==null&&(X=cr(oe));var ge=y.getDerivedStateFromProps;oe=typeof ge=="function"||typeof F.getSnapshotBeforeUpdate=="function",st=d.pendingProps!==st,oe||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(st||Jt!==X)&&Po(d,F,S,X),jr=!1;var ee=d.memoizedState;F.state=ee,os(d,S,F,I),Qc(),Jt=d.memoizedState,st||ee!==Jt||jr?(typeof ge=="function"&&(xa(d,y,ge,S),Jt=d.memoizedState),(Rt=jr||Ro(d,y,Rt,S,ee,Jt,X))?(oe||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(d.flags|=4194308)):(typeof F.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=Jt),F.props=S,F.state=Jt,F.context=X,S=Rt):(typeof F.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{F=d.stateNode,hf(c,d),X=d.memoizedProps,oe=eo(y,X),F.props=oe,ge=d.pendingProps,ee=F.context,Jt=y.contextType,Rt=po,typeof Jt=="object"&&Jt!==null&&(Rt=cr(Jt)),st=y.getDerivedStateFromProps,(Jt=typeof st=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(X!==ge||ee!==Rt)&&Po(d,F,S,Rt),jr=!1,ee=d.memoizedState,F.state=ee,os(d,S,F,I),Qc();var re=d.memoizedState;X!==ge||ee!==re||jr||c!==null&&c.dependencies!==null&&Xu(c.dependencies)?(typeof st=="function"&&(xa(d,y,st,S),re=d.memoizedState),(oe=jr||Ro(d,y,oe,S,ee,re,Rt)||c!==null&&c.dependencies!==null&&Xu(c.dependencies))?(Jt||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(S,re,Rt),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(S,re,Rt)),typeof F.componentDidUpdate=="function"&&(d.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof F.componentDidUpdate!="function"||X===c.memoizedProps&&ee===c.memoizedState||(d.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||X===c.memoizedProps&&ee===c.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=re),F.props=S,F.state=re,F.context=Rt,S=oe):(typeof F.componentDidUpdate!="function"||X===c.memoizedProps&&ee===c.memoizedState||(d.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||X===c.memoizedProps&&ee===c.memoizedState||(d.flags|=1024),S=!1)}return F=S,mf(c,d),S=(d.flags&128)!==0,F||S?(F=d.stateNode,y=S&&typeof y.getDerivedStateFromError!="function"?null:F.render(),d.flags|=1,c!==null&&S?(d.child=cl(d,c.child,null,I),d.child=cl(d,null,y,I)):er(c,d,y,I),d.memoizedState=F.state,c=d.child):c=cc(c,d,I),c}function qy(c,d,y,S){return qs(),d.flags|=256,er(c,d,y,S),d.child}var mm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function gm(c){return{baseLanes:c,cachePool:Ie()}}function c_(c,d,y){return c=c!==null?c.childLanes&~y:0,d&&(c|=Gs),c}function _m(c,d,y){var S=d.pendingProps,I=!1,F=(d.flags&128)!==0,X;if((X=F)||(X=c!==null&&c.memoizedState===null?!1:(fi.current&2)!==0),X&&(I=!0,d.flags&=-129),X=(d.flags&32)!==0,d.flags&=-33,c===null){if(Ri){if(I?Ja(d):hl(),(c=cn)?(c=Ym(c,Ii),c=c!==null&&c.data!=="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:go!==null?{id:Ss,overflow:Ha}:null,retryLane:536870912,hydrationErrors:null},y=Hu(c),y.return=d,d.child=y,Jn=d,cn=null)):c=null,c===null)throw Hn(d);return If(c)?d.lanes=32:d.lanes=536870912,null}var st=S.children;return S=S.fallback,I?(hl(),I=d.mode,st=gf({mode:"hidden",children:st},I),S=Jl(S,I,y,null),st.return=d,S.return=d,st.sibling=S,d.child=st,S=d.child,S.memoizedState=gm(y),S.childLanes=c_(c,X,y),d.memoizedState=mm,kd(null,S)):(Ja(d),ym(d,st))}var Rt=c.memoizedState;if(Rt!==null&&(st=Rt.dehydrated,st!==null)){if(F)d.flags&256?(Ja(d),d.flags&=-257,d=lh(c,d,y)):d.memoizedState!==null?(hl(),d.child=c.child,d.flags|=128,d=null):(hl(),st=S.fallback,I=d.mode,S=gf({mode:"visible",children:S.children},I),st=Jl(st,I,y,null),st.flags|=2,S.return=d,st.return=d,S.sibling=st,d.child=S,cl(d,c.child,null,y),S=d.child,S.memoizedState=gm(y),S.childLanes=c_(c,X,y),d.memoizedState=mm,d=kd(null,S));else if(Ja(d),If(st)){if(X=st.nextSibling&&st.nextSibling.dataset,X)var Jt=X.dgst;X=Jt,S=Error(n(419)),S.stack="",S.digest=X,_o({value:S,source:null,stack:null}),d=lh(c,d,y)}else if(hr||ol(c,d,y,!1),X=(y&c.childLanes)!==0,hr||X){if(X=xn,X!==null&&(S=Qi(X,y),S!==0&&S!==Rt.retryLane))throw Rt.retryLane=S,il(c,S),Lr(X,c,S),fm;Gn(st)||Om(),d=lh(c,d,y)}else Gn(st)?(d.flags|=192,d.child=c.child,d=null):(c=Rt.treeContext,cn=Sa(st.nextSibling),Jn=d,Ri=!0,Wa=null,Ii=!1,c!==null&&wd(d,c),d=ym(d,S.children),d.flags|=4096);return d}return I?(hl(),st=S.fallback,I=d.mode,Rt=c.child,Jt=Rt.sibling,S=fa(Rt,{mode:"hidden",children:S.children}),S.subtreeFlags=Rt.subtreeFlags&65011712,Jt!==null?st=fa(Jt,st):(st=Jl(st,I,y,null),st.flags|=2),st.return=d,S.return=d,S.sibling=st,d.child=S,kd(null,S),S=d.child,st=c.child.memoizedState,st===null?st=gm(y):(I=st.cachePool,I!==null?(Rt=Wn._currentValue,I=I.parent!==Rt?{parent:Rt,pool:Rt}:I):I=Ie(),st={baseLanes:st.baseLanes|y,cachePool:I}),S.memoizedState=st,S.childLanes=c_(c,X,y),d.memoizedState=mm,kd(c.child,S)):(Ja(d),y=c.child,c=y.sibling,y=fa(y,{mode:"visible",children:S.children}),y.return=d,y.sibling=null,c!==null&&(X=d.deletions,X===null?(d.deletions=[c],d.flags|=16):X.push(c)),d.child=y,d.memoizedState=null,y)}function ym(c,d){return d=gf({mode:"visible",children:d},c.mode),d.return=c,c.child=d}function gf(c,d){return c=Ts(22,c,null,d),c.lanes=0,c}function lh(c,d,y){return cl(d,c.child,null,y),c=ym(d,d.pendingProps.children),c.flags|=2,d.memoizedState=null,c}function Ms(c,d,y){c.lanes|=d;var S=c.alternate;S!==null&&(S.lanes|=d),af(c.return,d,y)}function vm(c,d,y,S,I,F){var X=c.memoizedState;X===null?c.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:y,tailMode:I,treeForkCount:F}:(X.isBackwards=d,X.rendering=null,X.renderingStartTime=0,X.last=S,X.tail=y,X.tailMode=I,X.treeForkCount=F)}function bm(c,d,y){var S=d.pendingProps,I=S.revealOrder,F=S.tail;S=S.children;var X=fi.current,st=(X&2)!==0;if(st?(X=X&1|2,d.flags|=128):X&=1,Ce(fi,X),er(c,d,S,y),S=Ri?rl:0,!st&&c!==null&&(c.flags&128)!==0)t:for(c=d.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&Ms(c,y,d);else if(c.tag===19)Ms(c,y,d);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===d)break t;for(;c.sibling===null;){if(c.return===null||c.return===d)break t;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(I){case"forwards":for(y=d.child,I=null;y!==null;)c=y.alternate,c!==null&&Wi(c)===null&&(I=y),y=y.sibling;y=I,y===null?(I=d.child,d.child=null):(I=y.sibling,y.sibling=null),vm(d,!1,I,y,F,S);break;case"backwards":case"unstable_legacy-backwards":for(y=null,I=d.child,d.child=null;I!==null;){if(c=I.alternate,c!==null&&Wi(c)===null){d.child=I;break}c=I.sibling,I.sibling=y,y=I,I=c}vm(d,!0,y,null,F,S);break;case"together":vm(d,!1,null,null,void 0,S);break;default:d.memoizedState=null}return d.child}function cc(c,d,y){if(c!==null&&(d.dependencies=c.dependencies),au|=d.lanes,(y&d.childLanes)===0)if(c!==null){if(ol(c,d,y,!1),(y&d.childLanes)===0)return null}else return null;if(c!==null&&d.child!==c.child)throw Error(n(153));if(d.child!==null){for(c=d.child,y=fa(c,c.pendingProps),d.child=y,y.return=d;c.sibling!==null;)c=c.sibling,y=y.sibling=fa(c,c.pendingProps),y.return=d;y.sibling=null}return d.child}function xm(c,d){return(c.lanes&d)!==0?!0:(c=c.dependencies,!!(c!==null&&Xu(c)))}function n0(c,d,y){switch(d.tag){case 3:zi(d,d.stateNode.containerInfo),qa(d,Wn,c.memoizedState.cache),qs();break;case 27:case 5:Ar(d);break;case 4:zi(d,d.stateNode.containerInfo);break;case 10:qa(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,Ad(d),null;break;case 13:var S=d.memoizedState;if(S!==null)return S.dehydrated!==null?(Ja(d),d.flags|=128,null):(y&d.child.childLanes)!==0?_m(c,d,y):(Ja(d),c=cc(c,d,y),c!==null?c.sibling:null);Ja(d);break;case 19:var I=(c.flags&128)!==0;if(S=(y&d.childLanes)!==0,S||(ol(c,d,y,!1),S=(y&d.childLanes)!==0),I){if(S)return bm(c,d,y);d.flags|=128}if(I=d.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),Ce(fi,fi.current),S)break;return null;case 22:return d.lanes=0,Dd(c,d,y,d.pendingProps);case 24:qa(d,Wn,c.memoizedState.cache)}return cc(c,d,y)}function Xy(c,d,y){if(c!==null)if(c.memoizedProps!==d.pendingProps)hr=!0;else{if(!xm(c,y)&&(d.flags&128)===0)return hr=!1,n0(c,d,y);hr=(c.flags&131072)!==0}else hr=!1,Ri&&(d.flags&1048576)!==0&&Zc(d,rl,d.index);switch(d.lanes=0,d.tag){case 16:t:{var S=d.pendingProps;if(c=rc(d.elementType),d.type=c,typeof c=="function")Ql(c)?(S=eo(c,S),d.tag=1,d=Wy(null,d,c,S,y)):(d.tag=0,d=pm(null,d,c,S,y));else{if(c!=null){var I=c.$$typeof;if(I===Pt){d.tag=11,d=Vy(null,d,c,S,y);break t}else if(I===ae){d.tag=14,d=oh(null,d,c,S,y);break t}}throw d=Ne(c)||c,Error(n(306,d,""))}}return d;case 0:return pm(c,d,d.type,d.pendingProps,y);case 1:return S=d.type,I=eo(S,d.pendingProps),Wy(c,d,S,I,y);case 3:t:{if(zi(d,d.stateNode.containerInfo),c===null)throw Error(n(387));S=d.pendingProps;var F=d.memoizedState;I=F.element,hf(c,d),os(d,S,null,y);var X=d.memoizedState;if(S=X.cache,qa(d,Wn,S),S!==F.cache&&Xa(d,[Wn],y,!0),Qc(),S=X.element,F.isDehydrated)if(F={element:S,isDehydrated:!1,cache:X.cache},d.updateQueue.baseState=F,d.memoizedState=F,d.flags&256){d=qy(c,d,S,y);break t}else if(S!==I){I=ss(Error(n(424)),d),_o(I),d=qy(c,d,S,y);break t}else{switch(c=d.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(cn=Sa(c.firstChild),Jn=d,Ri=!0,Wa=null,Ii=!0,y=cm(d,null,S,y),d.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(qs(),S===I){d=cc(c,d,y);break t}er(c,d,S,y)}d=d.child}return d;case 26:return mf(c,d),c===null?(y=Ev(d.type,null,d.pendingProps,null))?d.memoizedState=y:Ri||(y=d.type,c=d.pendingProps,S=Pf(ii.current).createElement(y),S[fe]=d,S[Re]=c,dr(S,y,c),Rn(S),d.stateNode=S):d.memoizedState=Ev(d.type,c.memoizedProps,d.pendingProps,c.memoizedState),null;case 27:return Ar(d),c===null&&Ri&&(S=d.stateNode=k_(d.type,d.pendingProps,ii.current),Jn=d,Ii=!0,I=cn,Ks(d.type)?(_c=I,cn=Sa(S.firstChild)):cn=I),er(c,d,d.pendingProps.children,y),mf(c,d),c===null&&(d.flags|=4194304),d.child;case 5:return c===null&&Ri&&((I=S=cn)&&(S=wv(S,d.type,d.pendingProps,Ii),S!==null?(d.stateNode=S,Jn=d,cn=Sa(S.firstChild),Ii=!1,I=!0):I=!1),I||Hn(d)),Ar(d),I=d.type,F=d.pendingProps,X=c!==null?c.memoizedProps:null,S=F.children,Qd(I,F)?S=null:X!==null&&Qd(I,X)&&(d.flags|=32),d.memoizedState!==null&&(I=wo(c,d,pl,null,null,y),op._currentValue=I),mf(c,d),er(c,d,S,y),d.child;case 6:return c===null&&Ri&&((c=y=cn)&&(y=Ta(y,d.pendingProps,Ii),y!==null?(d.stateNode=y,Jn=d,cn=null,c=!0):c=!1),c||Hn(d)),null;case 13:return _m(c,d,y);case 4:return zi(d,d.stateNode.containerInfo),S=d.pendingProps,c===null?d.child=cl(d,null,S,y):er(c,d,S,y),d.child;case 11:return Vy(c,d,d.type,d.pendingProps,y);case 7:return er(c,d,d.pendingProps,y),d.child;case 8:return er(c,d,d.pendingProps.children,y),d.child;case 12:return er(c,d,d.pendingProps.children,y),d.child;case 10:return S=d.pendingProps,qa(d,d.type,S.value),er(c,d,S.children,y),d.child;case 9:return I=d.type._context,S=d.pendingProps.children,yo(d),I=cr(I),S=S(I),d.flags|=1,er(c,d,S,y),d.child;case 14:return oh(c,d,d.type,d.pendingProps,y);case 15:return Id(c,d,d.type,d.pendingProps,y);case 19:return bm(c,d,y);case 31:return Hy(c,d,y);case 22:return Dd(c,d,y,d.pendingProps);case 24:return yo(d),S=cr(Wn),c===null?(I=nc(),I===null&&(I=xn,F=As(),I.pooledCache=F,F.refCount++,F!==null&&(I.pooledCacheLanes|=y),I=F),d.memoizedState={parent:S,cache:I},Hi(d),qa(d,Wn,I)):((c.lanes&y)!==0&&(hf(c,d),os(d,null,null,y),Qc()),I=c.memoizedState,F=d.memoizedState,I.parent!==S?(I={parent:S,cache:S},d.memoizedState=I,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=I),qa(d,Wn,S)):(S=F.cache,qa(d,Wn,S),S!==I.cache&&Xa(d,[Wn],y,!0))),er(c,d,d.pendingProps.children,y),d.child;case 29:throw d.pendingProps}throw Error(n(156,d.tag))}function _l(c){c.flags|=4}function u_(c,d,y,S,I){if((d=(c.mode&32)!==0)&&(d=!1),d){if(c.flags|=16777216,(I&335544128)===I)if(c.stateNode.complete)c.flags|=8192;else if(av())c.flags|=8192;else throw Zs=ll,Gu}else c.flags&=-16777217}function wm(c,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!eg(d))if(av())c.flags|=8192;else throw Zs=ll,Gu}function Od(c,d){d!==null&&(c.flags|=4),c.flags&16384&&(d=c.tag!==22?De():536870912,c.lanes|=d,ou|=d)}function _f(c,d){if(!Ri)switch(c.tailMode){case"hidden":d=c.tail;for(var y=null;d!==null;)d.alternate!==null&&(y=d),d=d.sibling;y===null?c.tail=null:y.sibling=null;break;case"collapsed":y=c.tail;for(var S=null;y!==null;)y.alternate!==null&&(S=y),y=y.sibling;S===null?d||c.tail===null?c.tail=null:c.tail.sibling=null:S.sibling=null}}function On(c){var d=c.alternate!==null&&c.alternate.child===c.child,y=0,S=0;if(d)for(var I=c.child;I!==null;)y|=I.lanes|I.childLanes,S|=I.subtreeFlags&65011712,S|=I.flags&65011712,I.return=c,I=I.sibling;else for(I=c.child;I!==null;)y|=I.lanes|I.childLanes,S|=I.subtreeFlags,S|=I.flags,I.return=c,I=I.sibling;return c.subtreeFlags|=S,c.childLanes=y,d}function r0(c,d,y){var S=d.pendingProps;switch(sf(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return On(d),null;case 1:return On(d),null;case 3:return y=d.stateNode,S=null,c!==null&&(S=c.memoizedState.cache),d.memoizedState.cache!==S&&(d.flags|=2048),Ls(Wn),Ui(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(c===null||c.child===null)&&(ic(d)?_l(d):c===null||c.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Wu())),On(d),null;case 26:var I=d.type,F=d.memoizedState;return c===null?(_l(d),F!==null?(On(d),wm(d,F)):(On(d),u_(d,I,null,S,y))):F?F!==c.memoizedState?(_l(d),On(d),wm(d,F)):(On(d),d.flags&=-16777217):(c=c.memoizedProps,c!==S&&_l(d),On(d),u_(d,I,c,S,y)),null;case 27:if(gs(d),y=ii.current,I=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==S&&_l(d);else{if(!S){if(d.stateNode===null)throw Error(n(166));return On(d),null}c=Me.current,ic(d)?Yc(d):(c=k_(I,S,y),d.stateNode=c,_l(d))}return On(d),null;case 5:if(gs(d),I=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==S&&_l(d);else{if(!S){if(d.stateNode===null)throw Error(n(166));return On(d),null}if(F=Me.current,ic(d))Yc(d);else{var X=Pf(ii.current);switch(F){case 1:F=X.createElementNS("http://www.w3.org/2000/svg",I);break;case 2:F=X.createElementNS("http://www.w3.org/1998/Math/MathML",I);break;default:switch(I){case"svg":F=X.createElementNS("http://www.w3.org/2000/svg",I);break;case"math":F=X.createElementNS("http://www.w3.org/1998/Math/MathML",I);break;case"script":F=X.createElement("div"),F.innerHTML="<script><\/script>",F=F.removeChild(F.firstChild);break;case"select":F=typeof S.is=="string"?X.createElement("select",{is:S.is}):X.createElement("select"),S.multiple?F.multiple=!0:S.size&&(F.size=S.size);break;default:F=typeof S.is=="string"?X.createElement(I,{is:S.is}):X.createElement(I)}}F[fe]=d,F[Re]=S;t:for(X=d.child;X!==null;){if(X.tag===5||X.tag===6)F.appendChild(X.stateNode);else if(X.tag!==4&&X.tag!==27&&X.child!==null){X.child.return=X,X=X.child;continue}if(X===d)break t;for(;X.sibling===null;){if(X.return===null||X.return===d)break t;X=X.return}X.sibling.return=X.return,X=X.sibling}d.stateNode=F;t:switch(dr(F,I,S),I){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break t;case"img":S=!0;break t;default:S=!1}S&&_l(d)}}return On(d),u_(d,d.type,c===null?null:c.memoizedProps,d.pendingProps,y),null;case 6:if(c&&d.stateNode!=null)c.memoizedProps!==S&&_l(d);else{if(typeof S!="string"&&d.stateNode===null)throw Error(n(166));if(c=ii.current,ic(d)){if(c=d.stateNode,y=d.memoizedProps,S=null,I=Jn,I!==null)switch(I.tag){case 27:case 5:S=I.memoizedProps}c[fe]=d,c=!!(c.nodeValue===y||S!==null&&S.suppressHydrationWarning===!0||P_(c.nodeValue,y)),c||Hn(d,!0)}else c=Pf(c).createTextNode(S),c[fe]=d,d.stateNode=c}return On(d),null;case 31:if(y=d.memoizedState,c===null||c.memoizedState!==null){if(S=ic(d),y!==null){if(c===null){if(!S)throw Error(n(318));if(c=d.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(557));c[fe]=d}else qs(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;On(d),c=!1}else y=Wu(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=y),c=!0;if(!c)return d.flags&256?(Dr(d),d):(Dr(d),null);if((d.flags&128)!==0)throw Error(n(558))}return On(d),null;case 13:if(S=d.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(I=ic(d),S!==null&&S.dehydrated!==null){if(c===null){if(!I)throw Error(n(318));if(I=d.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(n(317));I[fe]=d}else qs(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;On(d),I=!1}else I=Wu(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=I),I=!0;if(!I)return d.flags&256?(Dr(d),d):(Dr(d),null)}return Dr(d),(d.flags&128)!==0?(d.lanes=y,d):(y=S!==null,c=c!==null&&c.memoizedState!==null,y&&(S=d.child,I=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(I=S.alternate.memoizedState.cachePool.pool),F=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(F=S.memoizedState.cachePool.pool),F!==I&&(S.flags|=2048)),y!==c&&y&&(d.child.flags|=8192),Od(d,d.updateQueue),On(d),null);case 4:return Ui(),c===null&&Wm(d.stateNode.containerInfo),On(d),null;case 10:return Ls(d.type),On(d),null;case 19:if(he(fi),S=d.memoizedState,S===null)return On(d),null;if(I=(d.flags&128)!==0,F=S.rendering,F===null)if(I)_f(S,!1);else{if(ir!==0||c!==null&&(c.flags&128)!==0)for(c=d.child;c!==null;){if(F=Wi(c),F!==null){for(d.flags|=128,_f(S,!1),c=F.updateQueue,d.updateQueue=c,Od(d,c),d.subtreeFlags=0,c=y,y=d.child;y!==null;)sm(y,c),y=y.sibling;return Ce(fi,fi.current&1|2),Ri&&da(d,S.treeForkCount),d.child}c=c.sibling}S.tail!==null&&or()>Pm&&(d.flags|=128,I=!0,_f(S,!1),d.lanes=4194304)}else{if(!I)if(c=Wi(F),c!==null){if(d.flags|=128,I=!0,c=c.updateQueue,d.updateQueue=c,Od(d,c),_f(S,!0),S.tail===null&&S.tailMode==="hidden"&&!F.alternate&&!Ri)return On(d),null}else 2*or()-S.renderingStartTime>Pm&&y!==536870912&&(d.flags|=128,I=!0,_f(S,!1),d.lanes=4194304);S.isBackwards?(F.sibling=d.child,d.child=F):(c=S.last,c!==null?c.sibling=F:d.child=F,S.last=F)}return S.tail!==null?(c=S.tail,S.rendering=c,S.tail=c.sibling,S.renderingStartTime=or(),c.sibling=null,y=fi.current,Ce(fi,I?y&1|2:y&1),Ri&&da(d,S.treeForkCount),c):(On(d),null);case 22:case 23:return Dr(d),Ir(),S=d.memoizedState!==null,c!==null?c.memoizedState!==null!==S&&(d.flags|=8192):S&&(d.flags|=8192),S?(y&536870912)!==0&&(d.flags&128)===0&&(On(d),d.subtreeFlags&6&&(d.flags|=8192)):On(d),y=d.updateQueue,y!==null&&Od(d,y.retryQueue),y=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(y=c.memoizedState.cachePool.pool),S=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(S=d.memoizedState.cachePool.pool),S!==y&&(d.flags|=2048),c!==null&&he(Ya),null;case 24:return y=null,c!==null&&(y=c.memoizedState.cache),d.memoizedState.cache!==y&&(d.flags|=2048),Ls(Wn),On(d),null;case 25:return null;case 30:return null}throw Error(n(156,d.tag))}function s0(c,d){switch(sf(d),d.tag){case 1:return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 3:return Ls(Wn),Ui(),c=d.flags,(c&65536)!==0&&(c&128)===0?(d.flags=c&-65537|128,d):null;case 26:case 27:case 5:return gs(d),null;case 31:if(d.memoizedState!==null){if(Dr(d),d.alternate===null)throw Error(n(340));qs()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 13:if(Dr(d),c=d.memoizedState,c!==null&&c.dehydrated!==null){if(d.alternate===null)throw Error(n(340));qs()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 19:return he(fi),null;case 4:return Ui(),null;case 10:return Ls(d.type),null;case 22:case 23:return Dr(d),Ir(),c!==null&&he(Ya),c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 24:return Ls(Wn),null;case 25:return null;default:return null}}function Bd(c,d){switch(sf(d),d.tag){case 3:Ls(Wn),Ui();break;case 26:case 27:case 5:gs(d);break;case 4:Ui();break;case 31:d.memoizedState!==null&&Dr(d);break;case 13:Dr(d);break;case 19:he(fi);break;case 10:Ls(d.type);break;case 22:case 23:Dr(d),Ir(),c!==null&&he(Ya);break;case 24:Ls(Wn)}}function ch(c,d){try{var y=d.updateQueue,S=y!==null?y.lastEffect:null;if(S!==null){var I=S.next;y=I;do{if((y.tag&c)===c){S=void 0;var F=y.create,X=y.inst;S=F(),X.destroy=S}y=y.next}while(y!==I)}}catch(st){Ki(d,d.return,st)}}function uc(c,d,y){try{var S=d.updateQueue,I=S!==null?S.lastEffect:null;if(I!==null){var F=I.next;S=F;do{if((S.tag&c)===c){var X=S.inst,st=X.destroy;if(st!==void 0){X.destroy=void 0,I=d;var Rt=y,Jt=st;try{Jt()}catch(oe){Ki(I,Rt,oe)}}}S=S.next}while(S!==F)}}catch(oe){Ki(d,d.return,oe)}}function ru(c){var d=c.updateQueue;if(d!==null){var y=c.stateNode;try{ze(d,y)}catch(S){Ki(c,c.return,S)}}}function yf(c,d,y){y.props=eo(c.type,c.memoizedProps),y.state=c.memoizedState;try{y.componentWillUnmount()}catch(S){Ki(c,d,S)}}function Ld(c,d){try{var y=c.ref;if(y!==null){switch(c.tag){case 26:case 27:case 5:var S=c.stateNode;break;case 30:S=c.stateNode;break;default:S=c.stateNode}typeof y=="function"?c.refCleanup=y(S):y.current=S}}catch(I){Ki(c,d,I)}}function yl(c,d){var y=c.ref,S=c.refCleanup;if(y!==null)if(typeof S=="function")try{S()}catch(I){Ki(c,d,I)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(I){Ki(c,d,I)}else y.current=null}function Zy(c){var d=c.type,y=c.memoizedProps,S=c.stateNode;try{t:switch(d){case"button":case"input":case"select":case"textarea":y.autoFocus&&S.focus();break t;case"img":y.src?S.src=y.src:y.srcSet&&(S.srcset=y.srcSet)}}catch(I){Ki(c,c.return,I)}}function h_(c,d,y){try{var S=c.stateNode;_h(S,c.type,y,d),S[Re]=d}catch(I){Ki(c,c.return,I)}}function Gy(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Ks(c.type)||c.tag===4}function f_(c){t:for(;;){for(;c.sibling===null;){if(c.return===null||Gy(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Ks(c.type)||c.flags&2||c.child===null||c.tag===4)continue t;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function d_(c,d,y){var S=c.tag;if(S===5||S===6)c=c.stateNode,d?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(c,d):(d=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,d.appendChild(c),y=y._reactRootContainer,y!=null||d.onclick!==null||(d.onclick=hi));else if(S!==4&&(S===27&&Ks(c.type)&&(y=c.stateNode,d=null),c=c.child,c!==null))for(d_(c,d,y),c=c.sibling;c!==null;)d_(c,d,y),c=c.sibling}function vf(c,d,y){var S=c.tag;if(S===5||S===6)c=c.stateNode,d?y.insertBefore(c,d):y.appendChild(c);else if(S!==4&&(S===27&&Ks(c.type)&&(y=c.stateNode),c=c.child,c!==null))for(vf(c,d,y),c=c.sibling;c!==null;)vf(c,d,y),c=c.sibling}function Yy(c){var d=c.stateNode,y=c.memoizedProps;try{for(var S=c.type,I=d.attributes;I.length;)d.removeAttributeNode(I[0]);dr(d,S,y),d[fe]=c,d[Re]=y}catch(F){Ki(c,c.return,F)}}var vl=!1,Fn=!1,p_=!1,Nn=typeof WeakSet=="function"?WeakSet:Set,Zn=null;function Ky(c,d){if(c=c.containerInfo,fu=Eh,c=tf(c),Fu(c)){if("selectionStart"in c)var y={start:c.selectionStart,end:c.selectionEnd};else t:{y=(y=c.ownerDocument)&&y.defaultView||window;var S=y.getSelection&&y.getSelection();if(S&&S.rangeCount!==0){y=S.anchorNode;var I=S.anchorOffset,F=S.focusNode;S=S.focusOffset;try{y.nodeType,F.nodeType}catch{y=null;break t}var X=0,st=-1,Rt=-1,Jt=0,oe=0,ge=c,ee=null;e:for(;;){for(var re;ge!==y||I!==0&&ge.nodeType!==3||(st=X+I),ge!==F||S!==0&&ge.nodeType!==3||(Rt=X+S),ge.nodeType===3&&(X+=ge.nodeValue.length),(re=ge.firstChild)!==null;)ee=ge,ge=re;for(;;){if(ge===c)break e;if(ee===y&&++Jt===I&&(st=X),ee===F&&++oe===S&&(Rt=X),(re=ge.nextSibling)!==null)break;ge=ee,ee=ge.parentNode}ge=re}y=st===-1||Rt===-1?null:{start:st,end:Rt}}else y=null}y=y||{start:0,end:0}}else y=null;for(Rf={focusedElem:c,selectionRange:y},Eh=!1,Zn=d;Zn!==null;)if(d=Zn,c=d.child,(d.subtreeFlags&1028)!==0&&c!==null)c.return=d,Zn=c;else for(;Zn!==null;){switch(d=Zn,F=d.alternate,c=d.flags,d.tag){case 0:if((c&4)!==0&&(c=d.updateQueue,c=c!==null?c.events:null,c!==null))for(y=0;y<c.length;y++)I=c[y],I.ref.impl=I.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&F!==null){c=void 0,y=d,I=F.memoizedProps,F=F.memoizedState,S=y.stateNode;try{var $e=eo(y.type,I);c=S.getSnapshotBeforeUpdate($e,F),S.__reactInternalSnapshotBeforeUpdate=c}catch(ai){Ki(y,y.return,ai)}}break;case 3:if((c&1024)!==0){if(c=d.stateNode.containerInfo,y=c.nodeType,y===9)nr(c);else if(y===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":nr(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(n(163))}if(c=d.sibling,c!==null){c.return=d.return,Zn=c;break}Zn=d.return}}function Fd(c,d,y){var S=y.flags;switch(y.tag){case 0:case 11:case 15:xl(c,y),S&4&&ch(5,y);break;case 1:if(xl(c,y),S&4)if(c=y.stateNode,d===null)try{c.componentDidMount()}catch(X){Ki(y,y.return,X)}else{var I=eo(y.type,d.memoizedProps);d=d.memoizedState;try{c.componentDidUpdate(I,d,c.__reactInternalSnapshotBeforeUpdate)}catch(X){Ki(y,y.return,X)}}S&64&&ru(y),S&512&&Ld(y,y.return);break;case 3:if(xl(c,y),S&64&&(c=y.updateQueue,c!==null)){if(d=null,y.child!==null)switch(y.child.tag){case 27:case 5:d=y.child.stateNode;break;case 1:d=y.child.stateNode}try{ze(c,d)}catch(X){Ki(y,y.return,X)}}break;case 27:d===null&&S&4&&Yy(y);case 26:case 5:xl(c,y),d===null&&S&4&&Zy(y),S&512&&Ld(y,y.return);break;case 12:xl(c,y);break;case 31:xl(c,y),S&4&&Tm(c,y);break;case 13:xl(c,y),S&4&&uh(c,y),S&64&&(c=y.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(y=o0.bind(null,y),p0(c,y))));break;case 22:if(S=y.memoizedState!==null||vl,!S){d=d!==null&&d.memoizedState!==null||Fn,I=vl;var F=Fn;vl=S,(Fn=d)&&!F?ko(c,y,(y.subtreeFlags&8772)!==0):xl(c,y),vl=I,Fn=F}break;case 30:break;default:xl(c,y)}}function Nd(c){var d=c.alternate;d!==null&&(c.alternate=null,Nd(d)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(d=c.stateNode,d!==null&&Zo(d)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var gn=null,Ns=!1;function bl(c,d,y){for(y=y.child;y!==null;)bf(c,d,y),y=y.sibling}function bf(c,d,y){if(yn&&typeof yn.onCommitFiberUnmount=="function")try{yn.onCommitFiberUnmount(ts,y)}catch{}switch(y.tag){case 26:Fn||yl(y,d),bl(c,d,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:Fn||yl(y,d);var S=gn,I=Ns;Ks(y.type)&&(gn=y.stateNode,Ns=!1),bl(c,d,y),Df(y.stateNode),gn=S,Ns=I;break;case 5:Fn||yl(y,d);case 6:if(S=gn,I=Ns,gn=null,bl(c,d,y),gn=S,Ns=I,gn!==null)if(Ns)try{(gn.nodeType===9?gn.body:gn.nodeName==="HTML"?gn.ownerDocument.body:gn).removeChild(y.stateNode)}catch(F){Ki(y,d,F)}else try{gn.removeChild(y.stateNode)}catch(F){Ki(y,d,F)}break;case 18:gn!==null&&(Ns?(c=gn,Us(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,y.stateNode),Ch(c)):Us(gn,y.stateNode));break;case 4:S=gn,I=Ns,gn=y.stateNode.containerInfo,Ns=!0,bl(c,d,y),gn=S,Ns=I;break;case 0:case 11:case 14:case 15:uc(2,y,d),Fn||uc(4,y,d),bl(c,d,y);break;case 1:Fn||(yl(y,d),S=y.stateNode,typeof S.componentWillUnmount=="function"&&yf(y,d,S)),bl(c,d,y);break;case 21:bl(c,d,y);break;case 22:Fn=(S=Fn)||y.memoizedState!==null,bl(c,d,y),Fn=S;break;default:bl(c,d,y)}}function Tm(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{Ch(c)}catch(y){Ki(d,d.return,y)}}}function uh(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{Ch(c)}catch(y){Ki(d,d.return,y)}}function Sm(c){switch(c.tag){case 31:case 13:case 19:var d=c.stateNode;return d===null&&(d=c.stateNode=new Nn),d;case 22:return c=c.stateNode,d=c._retryCache,d===null&&(d=c._retryCache=new Nn),d;default:throw Error(n(435,c.tag))}}function hc(c,d){var y=Sm(c);d.forEach(function(S){if(!y.has(S)){y.add(S);var I=l0.bind(null,c,S);S.then(I,I)}})}function $r(c,d){var y=d.deletions;if(y!==null)for(var S=0;S<y.length;S++){var I=y[S],F=c,X=d,st=X;t:for(;st!==null;){switch(st.tag){case 27:if(Ks(st.type)){gn=st.stateNode,Ns=!1;break t}break;case 5:gn=st.stateNode,Ns=!1;break t;case 3:case 4:gn=st.stateNode.containerInfo,Ns=!0;break t}st=st.return}if(gn===null)throw Error(n(160));bf(F,X,I),gn=null,Ns=!1,F=I.alternate,F!==null&&(F.return=null),I.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)m_(d,c),d=d.sibling}var Io=null;function m_(c,d){var y=c.alternate,S=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:$r(d,c),br(c),S&4&&(uc(3,c,c.return),ch(3,c),uc(5,c,c.return));break;case 1:$r(d,c),br(c),S&512&&(Fn||y===null||yl(y,y.return)),S&64&&vl&&(c=c.updateQueue,c!==null&&(S=c.callbacks,S!==null&&(y=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=y===null?S:y.concat(S))));break;case 26:var I=Io;if($r(d,c),br(c),S&512&&(Fn||y===null||yl(y,y.return)),S&4){var F=y!==null?y.memoizedState:null;if(S=c.memoizedState,y===null)if(S===null)if(c.stateNode===null){t:{S=c.type,y=c.memoizedProps,I=I.ownerDocument||I;e:switch(S){case"title":F=I.getElementsByTagName("title")[0],(!F||F[ks]||F[fe]||F.namespaceURI==="http://www.w3.org/2000/svg"||F.hasAttribute("itemprop"))&&(F=I.createElement(S),I.head.insertBefore(F,I.querySelector("head > title"))),dr(F,S,y),F[fe]=c,Rn(F),S=F;break t;case"link":var X=rp("link","href",I).get(S+(y.href||""));if(X){for(var st=0;st<X.length;st++)if(F=X[st],F.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&F.getAttribute("rel")===(y.rel==null?null:y.rel)&&F.getAttribute("title")===(y.title==null?null:y.title)&&F.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){X.splice(st,1);break e}}F=I.createElement(S),dr(F,S,y),I.head.appendChild(F);break;case"meta":if(X=rp("meta","content",I).get(S+(y.content||""))){for(st=0;st<X.length;st++)if(F=X[st],F.getAttribute("content")===(y.content==null?null:""+y.content)&&F.getAttribute("name")===(y.name==null?null:y.name)&&F.getAttribute("property")===(y.property==null?null:y.property)&&F.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&F.getAttribute("charset")===(y.charSet==null?null:y.charSet)){X.splice(st,1);break e}}F=I.createElement(S),dr(F,S,y),I.head.appendChild(F);break;default:throw Error(n(468,S))}F[fe]=c,Rn(F),S=F}c.stateNode=S}else sp(I,c.type,c.stateNode);else c.stateNode=tg(I,S,c.memoizedProps);else F!==S?(F===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):F.count--,S===null?sp(I,c.type,c.stateNode):tg(I,S,c.memoizedProps)):S===null&&c.stateNode!==null&&h_(c,c.memoizedProps,y.memoizedProps)}break;case 27:$r(d,c),br(c),S&512&&(Fn||y===null||yl(y,y.return)),y!==null&&S&4&&h_(c,c.memoizedProps,y.memoizedProps);break;case 5:if($r(d,c),br(c),S&512&&(Fn||y===null||yl(y,y.return)),c.flags&32){I=c.stateNode;try{Vl(I,"")}catch($e){Ki(c,c.return,$e)}}S&4&&c.stateNode!=null&&(I=c.memoizedProps,h_(c,I,y!==null?y.memoizedProps:I)),S&1024&&(p_=!0);break;case 6:if($r(d,c),br(c),S&4){if(c.stateNode===null)throw Error(n(162));S=c.memoizedProps,y=c.stateNode;try{y.nodeValue=S}catch($e){Ki(c,c.return,$e)}}break;case 3:if(np=null,I=Io,Io=tp(d.containerInfo),$r(d,c),Io=I,br(c),S&4&&y!==null&&y.memoizedState.isDehydrated)try{Ch(d.containerInfo)}catch($e){Ki(c,c.return,$e)}p_&&(p_=!1,Qy(c));break;case 4:S=Io,Io=tp(c.stateNode.containerInfo),$r(d,c),br(c),Io=S;break;case 12:$r(d,c),br(c);break;case 31:$r(d,c),br(c),S&4&&(S=c.updateQueue,S!==null&&(c.updateQueue=null,hc(c,S)));break;case 13:$r(d,c),br(c),c.child.flags&8192&&c.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(Rm=or()),S&4&&(S=c.updateQueue,S!==null&&(c.updateQueue=null,hc(c,S)));break;case 22:I=c.memoizedState!==null;var Rt=y!==null&&y.memoizedState!==null,Jt=vl,oe=Fn;if(vl=Jt||I,Fn=oe||Rt,$r(d,c),Fn=oe,vl=Jt,br(c),S&8192)t:for(d=c.stateNode,d._visibility=I?d._visibility&-2:d._visibility|1,I&&(y===null||Rt||vl||Fn||Do(c)),y=null,d=c;;){if(d.tag===5||d.tag===26){if(y===null){Rt=y=d;try{if(F=Rt.stateNode,I)X=F.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none";else{st=Rt.stateNode;var ge=Rt.memoizedProps.style,ee=ge!=null&&ge.hasOwnProperty("display")?ge.display:null;st.style.display=ee==null||typeof ee=="boolean"?"":(""+ee).trim()}}catch($e){Ki(Rt,Rt.return,$e)}}}else if(d.tag===6){if(y===null){Rt=d;try{Rt.stateNode.nodeValue=I?"":Rt.memoizedProps}catch($e){Ki(Rt,Rt.return,$e)}}}else if(d.tag===18){if(y===null){Rt=d;try{var re=Rt.stateNode;I?pr(re,!0):pr(Rt.stateNode,!1)}catch($e){Ki(Rt,Rt.return,$e)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===c)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break t;for(;d.sibling===null;){if(d.return===null||d.return===c)break t;y===d&&(y=null),d=d.return}y===d&&(y=null),d.sibling.return=d.return,d=d.sibling}S&4&&(S=c.updateQueue,S!==null&&(y=S.retryQueue,y!==null&&(S.retryQueue=null,hc(c,y))));break;case 19:$r(d,c),br(c),S&4&&(S=c.updateQueue,S!==null&&(c.updateQueue=null,hc(c,S)));break;case 30:break;case 21:break;default:$r(d,c),br(c)}}function br(c){var d=c.flags;if(d&2){try{for(var y,S=c.return;S!==null;){if(Gy(S)){y=S;break}S=S.return}if(y==null)throw Error(n(160));switch(y.tag){case 27:var I=y.stateNode,F=f_(c);vf(c,F,I);break;case 5:var X=y.stateNode;y.flags&32&&(Vl(X,""),y.flags&=-33);var st=f_(c);vf(c,st,X);break;case 3:case 4:var Rt=y.stateNode.containerInfo,Jt=f_(c);d_(c,Jt,Rt);break;default:throw Error(n(161))}}catch(oe){Ki(c,c.return,oe)}c.flags&=-3}d&4096&&(c.flags&=-4097)}function Qy(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var d=c;Qy(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),c=c.sibling}}function xl(c,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)Fd(c,d.alternate,d),d=d.sibling}function Do(c){for(c=c.child;c!==null;){var d=c;switch(d.tag){case 0:case 11:case 14:case 15:uc(4,d,d.return),Do(d);break;case 1:yl(d,d.return);var y=d.stateNode;typeof y.componentWillUnmount=="function"&&yf(d,d.return,y),Do(d);break;case 27:Df(d.stateNode);case 26:case 5:yl(d,d.return),Do(d);break;case 22:d.memoizedState===null&&Do(d);break;case 30:Do(d);break;default:Do(d)}c=c.sibling}}function ko(c,d,y){for(y=y&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var S=d.alternate,I=c,F=d,X=F.flags;switch(F.tag){case 0:case 11:case 15:ko(I,F,y),ch(4,F);break;case 1:if(ko(I,F,y),S=F,I=S.stateNode,typeof I.componentDidMount=="function")try{I.componentDidMount()}catch(Jt){Ki(S,S.return,Jt)}if(S=F,I=S.updateQueue,I!==null){var st=S.stateNode;try{var Rt=I.shared.hiddenCallbacks;if(Rt!==null)for(I.shared.hiddenCallbacks=null,I=0;I<Rt.length;I++)Jc(Rt[I],st)}catch(Jt){Ki(S,S.return,Jt)}}y&&X&64&&ru(F),Ld(F,F.return);break;case 27:Yy(F);case 26:case 5:ko(I,F,y),y&&S===null&&X&4&&Zy(F),Ld(F,F.return);break;case 12:ko(I,F,y);break;case 31:ko(I,F,y),y&&X&4&&Tm(I,F);break;case 13:ko(I,F,y),y&&X&4&&uh(I,F);break;case 22:F.memoizedState===null&&ko(I,F,y),Ld(F,F.return);break;case 30:break;default:ko(I,F,y)}d=d.sibling}}function Am(c,d){var y=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(y=c.memoizedState.cachePool.pool),c=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(c=d.memoizedState.cachePool.pool),c!==y&&(c!=null&&c.refCount++,y!=null&&ur(y))}function Em(c,d){c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&ur(c))}function Oo(c,d,y,S){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)Jy(c,d,y,S),d=d.sibling}function Jy(c,d,y,S){var I=d.flags;switch(d.tag){case 0:case 11:case 15:Oo(c,d,y,S),I&2048&&ch(9,d);break;case 1:Oo(c,d,y,S);break;case 3:Oo(c,d,y,S),I&2048&&(c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&ur(c)));break;case 12:if(I&2048){Oo(c,d,y,S),c=d.stateNode;try{var F=d.memoizedProps,X=F.id,st=F.onPostCommit;typeof st=="function"&&st(X,d.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(Rt){Ki(d,d.return,Rt)}}else Oo(c,d,y,S);break;case 31:Oo(c,d,y,S);break;case 13:Oo(c,d,y,S);break;case 23:break;case 22:F=d.stateNode,X=d.alternate,d.memoizedState!==null?F._visibility&2?Oo(c,d,y,S):zd(c,d):F._visibility&2?Oo(c,d,y,S):(F._visibility|=2,xf(c,d,y,S,(d.subtreeFlags&10256)!==0||!1)),I&2048&&Am(X,d);break;case 24:Oo(c,d,y,S),I&2048&&Em(d.alternate,d);break;default:Oo(c,d,y,S)}}function xf(c,d,y,S,I){for(I=I&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var F=c,X=d,st=y,Rt=S,Jt=X.flags;switch(X.tag){case 0:case 11:case 15:xf(F,X,st,Rt,I),ch(8,X);break;case 23:break;case 22:var oe=X.stateNode;X.memoizedState!==null?oe._visibility&2?xf(F,X,st,Rt,I):zd(F,X):(oe._visibility|=2,xf(F,X,st,Rt,I)),I&&Jt&2048&&Am(X.alternate,X);break;case 24:xf(F,X,st,Rt,I),I&&Jt&2048&&Em(X.alternate,X);break;default:xf(F,X,st,Rt,I)}d=d.sibling}}function zd(c,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var y=c,S=d,I=S.flags;switch(S.tag){case 22:zd(y,S),I&2048&&Am(S.alternate,S);break;case 24:zd(y,S),I&2048&&Em(S.alternate,S);break;default:zd(y,S)}d=d.sibling}}var Ud=8192;function Bo(c,d,y){if(c.subtreeFlags&Ud)for(c=c.child;c!==null;)tv(c,d,y),c=c.sibling}function tv(c,d,y){switch(c.tag){case 26:Bo(c,d,y),c.flags&Ud&&c.memoizedState!==null&&Cv(y,Io,c.memoizedState,c.memoizedProps);break;case 5:Bo(c,d,y);break;case 3:case 4:var S=Io;Io=tp(c.stateNode.containerInfo),Bo(c,d,y),Io=S;break;case 22:c.memoizedState===null&&(S=c.alternate,S!==null&&S.memoizedState!==null?(S=Ud,Ud=16777216,Bo(c,d,y),Ud=S):Bo(c,d,y));break;default:Bo(c,d,y)}}function ev(c){var d=c.alternate;if(d!==null&&(c=d.child,c!==null)){d.child=null;do d=c.sibling,c.sibling=null,c=d;while(c!==null)}}function wf(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var y=0;y<d.length;y++){var S=d[y];Zn=S,nv(S,c)}ev(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)iv(c),c=c.sibling}function iv(c){switch(c.tag){case 0:case 11:case 15:wf(c),c.flags&2048&&uc(9,c,c.return);break;case 3:wf(c);break;case 12:wf(c);break;case 22:var d=c.stateNode;c.memoizedState!==null&&d._visibility&2&&(c.return===null||c.return.tag!==13)?(d._visibility&=-3,Vd(c)):wf(c);break;default:wf(c)}}function Vd(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var y=0;y<d.length;y++){var S=d[y];Zn=S,nv(S,c)}ev(c)}for(c=c.child;c!==null;){switch(d=c,d.tag){case 0:case 11:case 15:uc(8,d,d.return),Vd(d);break;case 22:y=d.stateNode,y._visibility&2&&(y._visibility&=-3,Vd(d));break;default:Vd(d)}c=c.sibling}}function nv(c,d){for(;Zn!==null;){var y=Zn;switch(y.tag){case 0:case 11:case 15:uc(8,y,d);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var S=y.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:ur(y.memoizedState.cache)}if(S=y.child,S!==null)S.return=y,Zn=S;else t:for(y=c;Zn!==null;){S=Zn;var I=S.sibling,F=S.return;if(Nd(S),S===y){Zn=null;break t}if(I!==null){I.return=F,Zn=I;break t}Zn=F}}}var g_={getCacheForType:function(c){var d=cr(Wn),y=d.data.get(c);return y===void 0&&(y=c(),d.data.set(c,y)),y},cacheSignal:function(){return cr(Wn).controller.signal}},jd=typeof WeakMap=="function"?WeakMap:Map,ji=0,xn=null,Di=null,ki=0,an=0,wa=null,su=!1,wl=!1,Cm=!1,fc=0,ir=0,au=0,hh=0,__=0,Gs=0,ou=0,Tf=null,zs=null,Mm=!1,Rm=0,$d=0,Pm=1/0,Hd=null,lu=null,Br=0,cu=null,fh=null,dc=0,y_=0,dh=null,fr=null,ph=0,Im=null;function Ys(){return(ji&2)!==0&&ki!==0?ki&-ki:ne.T!==null?jm():tn()}function Dm(){if(Gs===0)if((ki&536870912)===0||Ri){var c=Ft;Ft<<=1,(Ft&3932160)===0&&(Ft=262144),Gs=c}else Gs=536870912;return c=ls.current,c!==null&&(c.flags|=32),Gs}function Lr(c,d,y){(c===xn&&(an===2||an===9)||c.cancelPendingCommit!==null)&&(Sf(c,0),uu(c,ki,Gs,!1)),si(c,y),((ji&2)===0||c!==xn)&&(c===xn&&((ji&2)===0&&(hh|=y),ir===4&&uu(c,ki,Gs,!1)),no(c))}function v_(c,d,y){if((ji&6)!==0)throw Error(n(327));var S=!y&&(d&127)===0&&(d&c.expiredLanes)===0||te(c,d),I=S?w_(c,d):x_(c,d,!0),F=S;do{if(I===0){wl&&!S&&uu(c,d,0,!1);break}else{if(y=c.current.alternate,F&&!a0(y)){I=x_(c,d,!1),F=!1;continue}if(I===2){if(F=d,c.errorRecoveryDisabledLanes&F)var X=0;else X=c.pendingLanes&-536870913,X=X!==0?X:X&536870912?536870912:0;if(X!==0){d=X;t:{var st=c;I=Tf;var Rt=st.current.memoizedState.isDehydrated;if(Rt&&(Sf(st,X).flags|=256),X=x_(st,X,!1),X!==2){if(Cm&&!Rt){st.errorRecoveryDisabledLanes|=F,hh|=F,I=4;break t}F=zs,zs=I,F!==null&&(zs===null?zs=F:zs.push.apply(zs,F))}I=X}if(F=!1,I!==2)continue}}if(I===1){Sf(c,0),uu(c,d,0,!0);break}t:{switch(S=c,F=I,F){case 0:case 1:throw Error(n(345));case 4:if((d&4194048)!==d)break;case 6:uu(S,d,Gs,!su);break t;case 2:zs=null;break;case 3:case 5:break;default:throw Error(n(329))}if((d&62914560)===d&&(I=Rm+300-or(),10<I)){if(uu(S,d,Gs,!su),Kt(S,0,!0)!==0)break t;dc=d,S.timeoutHandle=xv(rv.bind(null,S,y,zs,Hd,Mm,d,Gs,hh,ou,su,F,"Throttled",-0,0),I);break t}rv(S,y,zs,Hd,Mm,d,Gs,hh,ou,su,F,null,-0,0)}}break}while(!0);no(c)}function rv(c,d,y,S,I,F,X,st,Rt,Jt,oe,ge,ee,re){if(c.timeoutHandle=-1,ge=d.subtreeFlags,ge&8192||(ge&16785408)===16785408){ge={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:hi},tv(d,F,ge);var $e=(F&62914560)===F?Rm-or():(F&4194048)===F?$d-or():0;if($e=_0(ge,$e),$e!==null){dc=F,c.cancelPendingCommit=$e(hv.bind(null,c,d,F,y,S,I,X,st,Rt,oe,ge,null,ee,re)),uu(c,F,X,!Jt);return}}hv(c,d,F,y,S,I,X,st,Rt)}function a0(c){for(var d=c;;){var y=d.tag;if((y===0||y===11||y===15)&&d.flags&16384&&(y=d.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var S=0;S<y.length;S++){var I=y[S],F=I.getSnapshot;I=I.value;try{if(!Mr(F(),I))return!1}catch{return!1}}if(y=d.child,d.subtreeFlags&16384&&y!==null)y.return=d,d=y;else{if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function uu(c,d,y,S){d&=~__,d&=~hh,c.suspendedLanes|=d,c.pingedLanes&=~d,S&&(c.warmLanes|=d),S=c.expirationTimes;for(var I=d;0<I;){var F=31-Q(I),X=1<<F;S[F]=-1,I&=~X}y!==0&&gi(c,y,d)}function km(){return(ji&6)===0?(Xd(0),!1):!0}function b_(){if(Di!==null){if(an===0)var c=Di.return;else c=Di,ma=al=null,lc(c),Qa=null,Kc=0,c=Di;for(;c!==null;)Bd(c.alternate,c),c=c.return;Di=null}}function Sf(c,d){var y=c.timeoutHandle;y!==-1&&(c.timeoutHandle=-1,Hr(y)),y=c.cancelPendingCommit,y!==null&&(c.cancelPendingCommit=null,y()),dc=0,b_(),xn=c,Di=y=fa(c.current,null),ki=d,an=0,wa=null,su=!1,wl=te(c,d),Cm=!1,ou=Gs=__=hh=au=ir=0,zs=Tf=null,Mm=!1,(d&8)!==0&&(d|=d&32);var S=c.entangledLanes;if(S!==0)for(c=c.entanglements,S&=d;0<S;){var I=31-Q(S),F=1<<I;d|=c[I],S&=~F}return fc=d,ju(),y}function sv(c,d){ci=null,ne.H=iu,d===ga||d===Yu?(d=cf(),an=3):d===Gu?(d=cf(),an=4):an=d===fm?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,wa=d,Di===null&&(ir=1,ah(c,ss(d,c.current)))}function av(){var c=ls.current;return c===null?!0:(ki&4194048)===ki?In===null:(ki&62914560)===ki||(ki&536870912)!==0?c===In:!1}function ov(){var c=ne.H;return ne.H=iu,c===null?iu:c}function lv(){var c=ne.A;return ne.A=g_,c}function Om(){ir=4,su||(ki&4194048)!==ki&&ls.current!==null||(wl=!0),(au&134217727)===0&&(hh&134217727)===0||xn===null||uu(xn,ki,Gs,!1)}function x_(c,d,y){var S=ji;ji|=2;var I=ov(),F=lv();(xn!==c||ki!==d)&&(Hd=null,Sf(c,d)),d=!1;var X=ir;t:do try{if(an!==0&&Di!==null){var st=Di,Rt=wa;switch(an){case 8:b_(),X=6;break t;case 3:case 2:case 9:case 6:ls.current===null&&(d=!0);var Jt=an;if(an=0,wa=null,Lo(c,st,Rt,Jt),y&&wl){X=0;break t}break;default:Jt=an,an=0,wa=null,Lo(c,st,Rt,Jt)}}cv(),X=ir;break}catch(oe){sv(c,oe)}while(!0);return d&&c.shellSuspendCounter++,ma=al=null,ji=S,ne.H=I,ne.A=F,Di===null&&(xn=null,ki=0,ju()),X}function cv(){for(;Di!==null;)pc(Di)}function w_(c,d){var y=ji;ji|=2;var S=ov(),I=lv();xn!==c||ki!==d?(Hd=null,Pm=or()+500,Sf(c,d)):wl=te(c,d);t:do try{if(an!==0&&Di!==null){d=Di;var F=wa;e:switch(an){case 1:an=0,wa=null,Lo(c,d,F,1);break;case 2:case 9:if(Ka(F)){an=0,wa=null,Af(d);break}d=function(){an!==2&&an!==9||xn!==c||(an=7),no(c)},F.then(d,d);break t;case 3:an=7;break t;case 4:an=5;break t;case 7:Ka(F)?(an=0,wa=null,Af(d)):(an=0,wa=null,Lo(c,d,F,7));break;case 5:var X=null;switch(Di.tag){case 26:X=Di.memoizedState;case 5:case 27:var st=Di;if(X?eg(X):st.stateNode.complete){an=0,wa=null;var Rt=st.sibling;if(Rt!==null)Di=Rt;else{var Jt=st.return;Jt!==null?(Di=Jt,mh(Jt)):Di=null}break e}}an=0,wa=null,Lo(c,d,F,5);break;case 6:an=0,wa=null,Lo(c,d,F,6);break;case 8:b_(),ir=6;break t;default:throw Error(n(462))}}uv();break}catch(oe){sv(c,oe)}while(!0);return ma=al=null,ne.H=S,ne.A=I,ji=y,Di!==null?0:(xn=null,ki=0,ju(),ir)}function uv(){for(;Di!==null&&!Ia();)pc(Di)}function pc(c){var d=Xy(c.alternate,c,fc);c.memoizedProps=c.pendingProps,d===null?mh(c):Di=d}function Af(c){var d=c,y=d.alternate;switch(d.tag){case 15:case 0:d=l_(y,d,d.pendingProps,d.type,void 0,ki);break;case 11:d=l_(y,d,d.pendingProps,d.type.render,d.ref,ki);break;case 5:lc(d);default:Bd(y,d),d=Di=sm(d,fc),d=Xy(y,d,fc)}c.memoizedProps=c.pendingProps,d===null?mh(c):Di=d}function Lo(c,d,y,S){ma=al=null,lc(d),Qa=null,Kc=0;var I=d.return;try{if(o_(c,I,d,y,ki)){ir=1,ah(c,ss(y,c.current)),Di=null;return}}catch(F){if(I!==null)throw Di=I,F;ir=1,ah(c,ss(y,c.current)),Di=null;return}d.flags&32768?(Ri||S===1?c=!0:wl||(ki&536870912)!==0?c=!1:(su=c=!0,(S===2||S===9||S===3||S===6)&&(S=ls.current,S!==null&&S.tag===13&&(S.flags|=16384))),Wd(d,c)):mh(d)}function mh(c){var d=c;do{if((d.flags&32768)!==0){Wd(d,su);return}c=d.return;var y=r0(d.alternate,d,fc);if(y!==null){Di=y;return}if(d=d.sibling,d!==null){Di=d;return}Di=d=c}while(d!==null);ir===0&&(ir=5)}function Wd(c,d){do{var y=s0(c.alternate,c);if(y!==null){y.flags&=32767,Di=y;return}if(y=c.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!d&&(c=c.sibling,c!==null)){Di=c;return}Di=c=y}while(c!==null);ir=6,Di=null}function hv(c,d,y,S,I,F,X,st,Rt){c.cancelPendingCommit=null;do qd();while(Br!==0);if((ji&6)!==0)throw Error(n(327));if(d!==null){if(d===c.current)throw Error(n(177));if(F=d.lanes|d.childLanes,F|=Wc,Mn(c,y,F,X,st,Rt),c===xn&&(Di=xn=null,ki=0),fh=d,cu=c,dc=y,y_=F,dh=I,fr=S,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,c0(Da,function(){return A_(),null})):(c.callbackNode=null,c.callbackPriority=0),S=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||S){S=ne.T,ne.T=null,I=we.p,we.p=2,X=ji,ji|=4;try{Ky(c,d,y)}finally{ji=X,we.p=I,ne.T=S}}Br=1,fv(),T_(),S_()}}function fv(){if(Br===1){Br=0;var c=cu,d=fh,y=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||y){y=ne.T,ne.T=null;var S=we.p;we.p=2;var I=ji;ji|=4;try{m_(d,c);var F=Rf,X=tf(c.containerInfo),st=F.focusedElem,Rt=F.selectionRange;if(X!==st&&st&&st.ownerDocument&&Jh(st.ownerDocument.documentElement,st)){if(Rt!==null&&Fu(st)){var Jt=Rt.start,oe=Rt.end;if(oe===void 0&&(oe=Jt),"selectionStart"in st)st.selectionStart=Jt,st.selectionEnd=Math.min(oe,st.value.length);else{var ge=st.ownerDocument||document,ee=ge&&ge.defaultView||window;if(ee.getSelection){var re=ee.getSelection(),$e=st.textContent.length,ai=Math.min(Rt.start,$e),un=Rt.end===void 0?ai:Math.min(Rt.end,$e);!re.extend&&ai>un&&(X=un,un=ai,ai=X);var Vt=Qh(st,ai),Lt=Qh(st,un);if(Vt&&Lt&&(re.rangeCount!==1||re.anchorNode!==Vt.node||re.anchorOffset!==Vt.offset||re.focusNode!==Lt.node||re.focusOffset!==Lt.offset)){var Qt=ge.createRange();Qt.setStart(Vt.node,Vt.offset),re.removeAllRanges(),ai>un?(re.addRange(Qt),re.extend(Lt.node,Lt.offset)):(Qt.setEnd(Lt.node,Lt.offset),re.addRange(Qt))}}}}for(ge=[],re=st;re=re.parentNode;)re.nodeType===1&&ge.push({element:re,left:re.scrollLeft,top:re.scrollTop});for(typeof st.focus=="function"&&st.focus(),st=0;st<ge.length;st++){var de=ge[st];de.element.scrollLeft=de.left,de.element.scrollTop=de.top}}Eh=!!fu,Rf=fu=null}finally{ji=I,we.p=S,ne.T=y}}c.current=d,Br=2}}function T_(){if(Br===2){Br=0;var c=cu,d=fh,y=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||y){y=ne.T,ne.T=null;var S=we.p;we.p=2;var I=ji;ji|=4;try{Fd(c,d.alternate,d)}finally{ji=I,we.p=S,ne.T=y}}Br=3}}function S_(){if(Br===4||Br===3){Br=0,Xo();var c=cu,d=fh,y=dc,S=fr;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?Br=5:(Br=0,fh=cu=null,dv(c,c.pendingLanes));var I=c.pendingLanes;if(I===0&&(lu=null),Ji(y),d=d.stateNode,yn&&typeof yn.onCommitFiberRoot=="function")try{yn.onCommitFiberRoot(ts,d,void 0,(d.current.flags&128)===128)}catch{}if(S!==null){d=ne.T,I=we.p,we.p=2,ne.T=null;try{for(var F=c.onRecoverableError,X=0;X<S.length;X++){var st=S[X];F(st.value,{componentStack:st.stack})}}finally{ne.T=d,we.p=I}}(dc&3)!==0&&qd(),no(c),I=c.pendingLanes,(y&261930)!==0&&(I&42)!==0?c===Im?ph++:(ph=0,Im=c):ph=0,Xd(0)}}function dv(c,d){(c.pooledCacheLanes&=d)===0&&(d=c.pooledCache,d!=null&&(c.pooledCache=null,ur(d)))}function qd(){return fv(),T_(),S_(),A_()}function A_(){if(Br!==5)return!1;var c=cu,d=y_;y_=0;var y=Ji(dc),S=ne.T,I=we.p;try{we.p=32>y?32:y,ne.T=null,y=dh,dh=null;var F=cu,X=dc;if(Br=0,fh=cu=null,dc=0,(ji&6)!==0)throw Error(n(331));var st=ji;if(ji|=4,iv(F.current),Jy(F,F.current,X,y),ji=st,Xd(0,!1),yn&&typeof yn.onPostCommitFiberRoot=="function")try{yn.onPostCommitFiberRoot(ts,F)}catch{}return!0}finally{we.p=I,ne.T=S,dv(c,d)}}function Bm(c,d,y){d=ss(y,d),d=a_(c.stateNode,d,2),c=ya(c,d,2),c!==null&&(si(c,2),no(c))}function Ki(c,d,y){if(c.tag===3)Bm(c,c,y);else for(;d!==null;){if(d.tag===3){Bm(d,c,y);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(lu===null||!lu.has(S))){c=ss(y,c),y=hm(2),S=ya(d,y,2),S!==null&&(Uy(y,S,d,c),si(S,2),no(S));break}}d=d.return}}function E_(c,d,y){var S=c.pingCache;if(S===null){S=c.pingCache=new jd;var I=new Set;S.set(d,I)}else I=S.get(d),I===void 0&&(I=new Set,S.set(d,I));I.has(y)||(Cm=!0,I.add(y),c=pv.bind(null,c,d,y),d.then(c,c))}function pv(c,d,y){var S=c.pingCache;S!==null&&S.delete(d),c.pingedLanes|=c.suspendedLanes&y,c.warmLanes&=~y,xn===c&&(ki&y)===y&&(ir===4||ir===3&&(ki&62914560)===ki&&300>or()-Rm?(ji&2)===0&&Sf(c,0):__|=y,ou===ki&&(ou=0)),no(c)}function mv(c,d){d===0&&(d=De()),c=il(c,d),c!==null&&(si(c,d),no(c))}function o0(c){var d=c.memoizedState,y=0;d!==null&&(y=d.retryLane),mv(c,y)}function l0(c,d){var y=0;switch(c.tag){case 31:case 13:var S=c.stateNode,I=c.memoizedState;I!==null&&(y=I.retryLane);break;case 19:S=c.stateNode;break;case 22:S=c.stateNode._retryCache;break;default:throw Error(n(314))}S!==null&&S.delete(d),mv(c,y)}function c0(c,d){return qo(c,d)}var Lm=null,gh=null,Fm=!1,io=!1,Tl=!1,mc=0;function no(c){c!==gh&&c.next===null&&(gh===null?Lm=gh=c:gh=gh.next=c),io=!0,Fm||(Fm=!0,Ef())}function Xd(c,d){if(!Tl&&io){Tl=!0;do for(var y=!1,S=Lm;S!==null;){if(c!==0){var I=S.pendingLanes;if(I===0)var F=0;else{var X=S.suspendedLanes,st=S.pingedLanes;F=(1<<31-Q(42|c)+1)-1,F&=I&~(X&~st),F=F&201326741?F&201326741|1:F?F|2:0}F!==0&&(y=!0,Vm(S,F))}else F=ki,F=Kt(S,S===xn?F:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(F&3)===0||te(S,F)||(y=!0,Vm(S,F));S=S.next}while(y);Tl=!1}}function Nm(){zm()}function zm(){io=Fm=!1;var c=0;mc!==0&&d0()&&(c=mc);for(var d=or(),y=null,S=Lm;S!==null;){var I=S.next,F=gv(S,d);F===0?(S.next=null,y===null?Lm=I:y.next=I,I===null&&(gh=y)):(y=S,(c!==0||(F&3)!==0)&&(io=!0)),S=I}Br!==0&&Br!==5||Xd(c),mc!==0&&(mc=0)}function gv(c,d){for(var y=c.suspendedLanes,S=c.pingedLanes,I=c.expirationTimes,F=c.pendingLanes&-62914561;0<F;){var X=31-Q(F),st=1<<X,Rt=I[X];Rt===-1?((st&y)===0||(st&S)!==0)&&(I[X]=ie(st,d)):Rt<=d&&(c.expiredLanes|=st),F&=~st}if(d=xn,y=ki,y=Kt(c,c===d?y:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),S=c.callbackNode,y===0||c===d&&(an===2||an===9)||c.cancelPendingCommit!==null)return S!==null&&S!==null&&Pa(S),c.callbackNode=null,c.callbackPriority=0;if((y&3)===0||te(c,y)){if(d=y&-y,d===c.callbackPriority)return d;switch(S!==null&&Pa(S),Ji(y)){case 2:case 8:y=Oc;break;case 32:y=Da;break;case 268435456:y=so;break;default:y=Da}return S=Um.bind(null,c),y=qo(y,S),c.callbackPriority=d,c.callbackNode=y,d}return S!==null&&S!==null&&Pa(S),c.callbackPriority=2,c.callbackNode=null,2}function Um(c,d){if(Br!==0&&Br!==5)return c.callbackNode=null,c.callbackPriority=0,null;var y=c.callbackNode;if(qd()&&c.callbackNode!==y)return null;var S=ki;return S=Kt(c,c===xn?S:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),S===0?null:(v_(c,S,d),gv(c,or()),c.callbackNode!=null&&c.callbackNode===y?Um.bind(null,c):null)}function Vm(c,d){if(qd())return null;v_(c,d,!0)}function Ef(){gc(function(){(ji&6)!==0?qo(kc,Nm):zm()})}function jm(){if(mc===0){var c=Ga;c===0&&(c=wt,wt<<=1,(wt&261888)===0&&(wt=256)),mc=c}return mc}function C_(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:is(""+c)}function $m(c,d){var y=d.ownerDocument.createElement("input");return y.name=d.name,y.value=d.value,c.id&&y.setAttribute("form",c.id),d.parentNode.insertBefore(y,d),c=new FormData(c),y.parentNode.removeChild(y),c}function _v(c,d,y,S,I){if(d==="submit"&&y&&y.stateNode===I){var F=C_((I[Re]||null).action),X=S.submitter;X&&(d=(d=X[Re]||null)?C_(d.formAction):X.getAttribute("formAction"),d!==null&&(F=d,X=null));var st=new oi("action","action",null,S,I);c.push({event:st,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(mc!==0){var Rt=X?$m(I,X):new FormData(I);ba(y,{pending:!0,data:Rt,method:I.method,action:F},null,Rt)}}else typeof F=="function"&&(st.preventDefault(),Rt=X?$m(I,X):new FormData(I),ba(y,{pending:!0,data:Rt,method:I.method,action:F},F,Rt))},currentTarget:I}]})}}for(var Cf=0;Cf<Vu.length;Cf++){var Hm=Vu[Cf],u0=Hm.toLowerCase(),h0=Hm[0].toUpperCase()+Hm.slice(1);Rr(u0,"on"+h0)}Rr(zu,"onAnimationEnd"),Rr(nf,"onAnimationIteration"),Rr(tl,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Uu,"onTransitionRun"),Rr(Hc,"onTransitionStart"),Rr(Ws,"onTransitionCancel"),Rr(bd,"onTransitionEnd"),es("onMouseEnter",["mouseout","mouseover"]),es("onMouseLeave",["mouseout","mouseover"]),es("onPointerEnter",["pointerout","pointerover"]),es("onPointerLeave",["pointerout","pointerover"]),zl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),zl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),zl("onBeforeInput",["compositionend","keypress","textInput","paste"]),zl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),zl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),zl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zd));function yv(c,d){d=(d&4)!==0;for(var y=0;y<c.length;y++){var S=c[y],I=S.event;S=S.listeners;t:{var F=void 0;if(d)for(var X=S.length-1;0<=X;X--){var st=S[X],Rt=st.instance,Jt=st.currentTarget;if(st=st.listener,Rt!==F&&I.isPropagationStopped())break t;F=st,I.currentTarget=Jt;try{F(I)}catch(oe){Kl(oe)}I.currentTarget=null,F=Rt}else for(X=0;X<S.length;X++){if(st=S[X],Rt=st.instance,Jt=st.currentTarget,st=st.listener,Rt!==F&&I.isPropagationStopped())break t;F=st,I.currentTarget=Jt;try{F(I)}catch(oe){Kl(oe)}I.currentTarget=null,F=Rt}}}}function Ci(c,d){var y=d[Ur];y===void 0&&(y=d[Ur]=new Set);var S=c+"__bubble";y.has(S)||(M_(d,c,2,!1),y.add(S))}function Sl(c,d,y){var S=0;d&&(S|=4),M_(y,c,S,d)}var Gd="_reactListening"+Math.random().toString(36).slice(2);function Wm(c){if(!c[Gd]){c[Gd]=!0,ys.forEach(function(y){y!=="selectionchange"&&(f0.has(y)||Sl(y,!1,c),Sl(y,!0,c))});var d=c.nodeType===9?c:c.ownerDocument;d===null||d[Gd]||(d[Gd]=!0,Sl("selectionchange",!1,d))}}function M_(c,d,y,S){switch(Iv(d)){case 2:var I=y0;break;case 8:I=Pv;break;default:I=rg}y=I.bind(null,d,y,c),I=void 0,!_r||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(I=!0),S?I!==void 0?c.addEventListener(d,y,{capture:!0,passive:I}):c.addEventListener(d,y,!0):I!==void 0?c.addEventListener(d,y,{passive:I}):c.addEventListener(d,y,!1)}function qm(c,d,y,S,I){var F=S;if((d&1)===0&&(d&2)===0&&S!==null)t:for(;;){if(S===null)return;var X=S.tag;if(X===3||X===4){var st=S.stateNode.containerInfo;if(st===I)break;if(X===4)for(X=S.return;X!==null;){var Rt=X.tag;if((Rt===3||Rt===4)&&X.stateNode.containerInfo===I)return;X=X.return}for(;st!==null;){if(X=oa(st),X===null)return;if(Rt=X.tag,Rt===5||Rt===6||Rt===26||Rt===27){S=F=X;continue t}st=st.parentNode}}S=S.return}Iu(function(){var Jt=F,oe=Bn(y),ge=[];t:{var ee=xd.get(c);if(ee!==void 0){var re=oi,$e=c;switch(c){case"keypress":if(Go(y)===0)break t;case"keydown":case"keyup":re=Wh;break;case"focusin":$e="focus",re=Ko;break;case"focusout":$e="blur",re=Ko;break;case"beforeblur":case"afterblur":re=Ko;break;case"click":if(y.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=Du;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=Ou;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=qh;break;case zu:case nf:case tl:re=za;break;case bd:re=xs;break;case"scroll":case"scrollend":re=Ei;break;case"wheel":re=$l;break;case"copy":case"cut":case"paste":re=$h;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=Gp;break;case"toggle":case"beforetoggle":re=Bu}var ai=(d&4)!==0,un=!ai&&(c==="scroll"||c==="scrollend"),Vt=ai?ee!==null?ee+"Capture":null:ee;ai=[];for(var Lt=Jt,Qt;Lt!==null;){var de=Lt;if(Qt=de.stateNode,de=de.tag,de!==5&&de!==26&&de!==27||Qt===null||Vt===null||(de=lr(Lt,Vt),de!=null&&ai.push(Mf(Lt,de,Qt))),un)break;Lt=Lt.return}0<ai.length&&(ee=new re(ee,$e,null,y,oe),ge.push({event:ee,listeners:ai}))}}if((d&7)===0){t:{if(ee=c==="mouseover"||c==="pointerover",re=c==="mouseout"||c==="pointerout",ee&&y!==La&&($e=y.relatedTarget||y.fromElement)&&(oa($e)||$e[We]))break t;if((re||ee)&&(ee=oe.window===oe?oe:(ee=oe.ownerDocument)?ee.defaultView||ee.parentWindow:window,re?($e=y.relatedTarget||y.toElement,re=Jt,$e=$e?oa($e):null,$e!==null&&(un=f($e),ai=$e.tag,$e!==un||ai!==5&&ai!==27&&ai!==6)&&($e=null)):(re=null,$e=Jt),re!==$e)){if(ai=Du,de="onMouseLeave",Vt="onMouseEnter",Lt="mouse",(c==="pointerout"||c==="pointerover")&&(ai=Gp,de="onPointerLeave",Vt="onPointerEnter",Lt="pointer"),un=re==null?ee:la(re),Qt=$e==null?ee:la($e),ee=new ai(de,Lt+"leave",re,y,oe),ee.target=un,ee.relatedTarget=Qt,de=null,oa(oe)===Jt&&(ai=new ai(Vt,Lt+"enter",$e,y,oe),ai.target=Qt,ai.relatedTarget=un,de=ai),un=de,re&&$e)e:{for(ai=Xm,Vt=re,Lt=$e,Qt=0,de=Vt;de;de=ai(de))Qt++;de=0;for(var ti=Lt;ti;ti=ai(ti))de++;for(;0<Qt-de;)Vt=ai(Vt),Qt--;for(;0<de-Qt;)Lt=ai(Lt),de--;for(;Qt--;){if(Vt===Lt||Lt!==null&&Vt===Lt.alternate){ai=Vt;break e}Vt=ai(Vt),Lt=ai(Lt)}ai=null}else ai=null;re!==null&&R_(ge,ee,re,ai,!1),$e!==null&&un!==null&&R_(ge,un,$e,ai,!0)}}t:{if(ee=Jt?la(Jt):window,re=ee.nodeName&&ee.nodeName.toLowerCase(),re==="select"||re==="input"&&ee.type==="file")var Ni=pd;else if(Gh(ee))if(md)Ni=_d;else{Ni=Yh;var Ze=im}else re=ee.nodeName,!re||re.toLowerCase()!=="input"||ee.type!=="checkbox"&&ee.type!=="radio"?Jt&&Ba(Jt.elementType)&&(Ni=pd):Ni=gd;if(Ni&&(Ni=Ni(c,Jt))){fd(ge,Ni,y,oe);break t}Ze&&Ze(c,ee,Jt),c==="focusout"&&Jt&&ee.type==="number"&&Jt.memoizedProps.value!=null&&Ru(ee,"number",ee.value)}switch(Ze=Jt?la(Jt):window,c){case"focusin":(Gh(Ze)||Ze.contentEditable==="true")&&(Qo=Ze,yd=Jt,Mi=null);break;case"focusout":Mi=yd=Qo=null;break;case"mousedown":vd=!0;break;case"contextmenu":case"mouseup":case"dragend":vd=!1,rm(ge,y,oe);break;case"selectionchange":if(Yl)break;case"keydown":case"keyup":rm(ge,y,oe)}var vi;if(ud)t:{switch(c){case"compositionstart":var Pi="onCompositionStart";break t;case"compositionend":Pi="onCompositionEnd";break t;case"compositionupdate":Pi="onCompositionUpdate";break t}Pi=void 0}else ql?hd(c,y)&&(Pi="onCompositionEnd"):c==="keydown"&&y.keyCode===229&&(Pi="onCompositionStart");Pi&&(ho&&y.locale!=="ko"&&(ql||Pi!=="onCompositionStart"?Pi==="onCompositionEnd"&&ql&&(vi=co()):(ns=oe,nn="value"in ns?ns.value:ns.textContent,ql=!0)),Ze=Yd(Jt,Pi),0<Ze.length&&(Pi=new yr(Pi,c,null,y,oe),ge.push({event:Pi,listeners:Ze}),vi?Pi.data=vi:(vi=Wl(y),vi!==null&&(Pi.data=vi)))),(vi=Lu?Qp(c,y):e_(c,y))&&(Pi=Yd(Jt,"onBeforeInput"),0<Pi.length&&(Ze=new yr("onBeforeInput","beforeinput",null,y,oe),ge.push({event:Ze,listeners:Pi}),Ze.data=vi)),_v(ge,c,Jt,y,oe)}yv(ge,d)})}function Mf(c,d,y){return{instance:c,listener:d,currentTarget:y}}function Yd(c,d){for(var y=d+"Capture",S=[];c!==null;){var I=c,F=I.stateNode;if(I=I.tag,I!==5&&I!==26&&I!==27||F===null||(I=lr(c,y),I!=null&&S.unshift(Mf(c,I,F)),I=lr(c,d),I!=null&&S.push(Mf(c,I,F))),c.tag===3)return S;c=c.return}return[]}function Xm(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function R_(c,d,y,S,I){for(var F=d._reactName,X=[];y!==null&&y!==S;){var st=y,Rt=st.alternate,Jt=st.stateNode;if(st=st.tag,Rt!==null&&Rt===S)break;st!==5&&st!==26&&st!==27||Jt===null||(Rt=Jt,I?(Jt=lr(y,F),Jt!=null&&X.unshift(Mf(y,Jt,Rt))):I||(Jt=lr(y,F),Jt!=null&&X.push(Mf(y,Jt,Rt)))),y=y.return}X.length!==0&&c.push({event:d,listeners:X})}var Kd=/\r\n?/g,vv=/\u0000|\uFFFD/g;function Zm(c){return(typeof c=="string"?c:""+c).replace(Kd,`
`).replace(vv,"")}function P_(c,d){return d=Zm(d),Zm(c)===d}function Ai(c,d,y,S,I,F){switch(y){case"children":typeof S=="string"?d==="body"||d==="textarea"&&S===""||Vl(c,S):(typeof S=="number"||typeof S=="bigint")&&d!=="body"&&Vl(c,""+S);break;case"className":Fc(c,"class",S);break;case"tabIndex":Fc(c,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":Fc(c,y,S);break;case"style":qp(c,S,F);break;case"data":if(d!=="object"){Fc(c,"data",S);break}case"src":case"href":if(S===""&&(d!=="a"||y!=="href")){c.removeAttribute(y);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){c.removeAttribute(y);break}S=is(""+S),c.setAttribute(y,S);break;case"action":case"formAction":if(typeof S=="function"){c.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof F=="function"&&(y==="formAction"?(d!=="input"&&Ai(c,d,"name",I.name,I,null),Ai(c,d,"formEncType",I.formEncType,I,null),Ai(c,d,"formMethod",I.formMethod,I,null),Ai(c,d,"formTarget",I.formTarget,I,null)):(Ai(c,d,"encType",I.encType,I,null),Ai(c,d,"method",I.method,I,null),Ai(c,d,"target",I.target,I,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){c.removeAttribute(y);break}S=is(""+S),c.setAttribute(y,S);break;case"onClick":S!=null&&(c.onclick=hi);break;case"onScroll":S!=null&&Ci("scroll",c);break;case"onScrollEnd":S!=null&&Ci("scrollend",c);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(y=S.__html,y!=null){if(I.children!=null)throw Error(n(60));c.innerHTML=y}}break;case"multiple":c.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":c.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){c.removeAttribute("xlink:href");break}y=is(""+S),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?c.setAttribute(y,""+S):c.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?c.setAttribute(y,""):c.removeAttribute(y);break;case"capture":case"download":S===!0?c.setAttribute(y,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?c.setAttribute(y,S):c.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?c.setAttribute(y,S):c.removeAttribute(y);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?c.removeAttribute(y):c.setAttribute(y,S);break;case"popover":Ci("beforetoggle",c),Ci("toggle",c),oo(c,"popover",S);break;case"xlinkActuate":vs(c,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":vs(c,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":vs(c,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":vs(c,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":vs(c,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":vs(c,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":vs(c,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":vs(c,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":vs(c,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":oo(c,"is",S);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=jl.get(y)||y,oo(c,y,S))}}function hu(c,d,y,S,I,F){switch(y){case"style":qp(c,S,F);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(y=S.__html,y!=null){if(I.children!=null)throw Error(n(60));c.innerHTML=y}}break;case"children":typeof S=="string"?Vl(c,S):(typeof S=="number"||typeof S=="bigint")&&Vl(c,""+S);break;case"onScroll":S!=null&&Ci("scroll",c);break;case"onScrollEnd":S!=null&&Ci("scrollend",c);break;case"onClick":S!=null&&(c.onclick=hi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!en.hasOwnProperty(y))t:{if(y[0]==="o"&&y[1]==="n"&&(I=y.endsWith("Capture"),d=y.slice(2,I?y.length-7:void 0),F=c[Re]||null,F=F!=null?F[y]:null,typeof F=="function"&&c.removeEventListener(d,F,I),typeof S=="function")){typeof F!="function"&&F!==null&&(y in c?c[y]=null:c.hasAttribute(y)&&c.removeAttribute(y)),c.addEventListener(d,S,I);break t}y in c?c[y]=S:S===!0?c.setAttribute(y,""):oo(c,y,S)}}}function dr(c,d,y){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ci("error",c),Ci("load",c);var S=!1,I=!1,F;for(F in y)if(y.hasOwnProperty(F)){var X=y[F];if(X!=null)switch(F){case"src":S=!0;break;case"srcSet":I=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:Ai(c,d,F,X,y,null)}}I&&Ai(c,d,"srcSet",y.srcSet,y,null),S&&Ai(c,d,"src",y.src,y,null);return;case"input":Ci("invalid",c);var st=F=X=I=null,Rt=null,Jt=null;for(S in y)if(y.hasOwnProperty(S)){var oe=y[S];if(oe!=null)switch(S){case"name":I=oe;break;case"type":X=oe;break;case"checked":Rt=oe;break;case"defaultChecked":Jt=oe;break;case"value":F=oe;break;case"defaultValue":st=oe;break;case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(n(137,d));break;default:Ai(c,d,S,oe,y,null)}}Vh(c,F,st,Rt,Jt,X,I,!1);return;case"select":Ci("invalid",c),S=X=F=null;for(I in y)if(y.hasOwnProperty(I)&&(st=y[I],st!=null))switch(I){case"value":F=st;break;case"defaultValue":X=st;break;case"multiple":S=st;default:Ai(c,d,I,st,y,null)}d=F,y=X,c.multiple=!!S,d!=null?Ul(c,!!S,d,!1):y!=null&&Ul(c,!!S,y,!0);return;case"textarea":Ci("invalid",c),F=I=S=null;for(X in y)if(y.hasOwnProperty(X)&&(st=y[X],st!=null))switch(X){case"value":S=st;break;case"defaultValue":I=st;break;case"children":F=st;break;case"dangerouslySetInnerHTML":if(st!=null)throw Error(n(91));break;default:Ai(c,d,X,st,y,null)}Pu(c,S,I,F);return;case"option":for(Rt in y)if(y.hasOwnProperty(Rt)&&(S=y[Rt],S!=null))switch(Rt){case"selected":c.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:Ai(c,d,Rt,S,y,null)}return;case"dialog":Ci("beforetoggle",c),Ci("toggle",c),Ci("cancel",c),Ci("close",c);break;case"iframe":case"object":Ci("load",c);break;case"video":case"audio":for(S=0;S<Zd.length;S++)Ci(Zd[S],c);break;case"image":Ci("error",c),Ci("load",c);break;case"details":Ci("toggle",c);break;case"embed":case"source":case"link":Ci("error",c),Ci("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Jt in y)if(y.hasOwnProperty(Jt)&&(S=y[Jt],S!=null))switch(Jt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:Ai(c,d,Jt,S,y,null)}return;default:if(Ba(d)){for(oe in y)y.hasOwnProperty(oe)&&(S=y[oe],S!==void 0&&hu(c,d,oe,S,y,void 0));return}}for(st in y)y.hasOwnProperty(st)&&(S=y[st],S!=null&&Ai(c,d,st,S,y,null))}function _h(c,d,y,S){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var I=null,F=null,X=null,st=null,Rt=null,Jt=null,oe=null;for(re in y){var ge=y[re];if(y.hasOwnProperty(re)&&ge!=null)switch(re){case"checked":break;case"value":break;case"defaultValue":Rt=ge;default:S.hasOwnProperty(re)||Ai(c,d,re,null,S,ge)}}for(var ee in S){var re=S[ee];if(ge=y[ee],S.hasOwnProperty(ee)&&(re!=null||ge!=null))switch(ee){case"type":F=re;break;case"name":I=re;break;case"checked":Jt=re;break;case"defaultChecked":oe=re;break;case"value":X=re;break;case"defaultValue":st=re;break;case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(n(137,d));break;default:re!==ge&&Ai(c,d,ee,re,S,ge)}}Uh(c,X,st,Rt,Jt,oe,F,I);return;case"select":re=X=st=ee=null;for(F in y)if(Rt=y[F],y.hasOwnProperty(F)&&Rt!=null)switch(F){case"value":break;case"multiple":re=Rt;default:S.hasOwnProperty(F)||Ai(c,d,F,null,S,Rt)}for(I in S)if(F=S[I],Rt=y[I],S.hasOwnProperty(I)&&(F!=null||Rt!=null))switch(I){case"value":ee=F;break;case"defaultValue":st=F;break;case"multiple":X=F;default:F!==Rt&&Ai(c,d,I,F,S,Rt)}d=st,y=X,S=re,ee!=null?Ul(c,!!y,ee,!1):!!S!=!!y&&(d!=null?Ul(c,!!y,d,!0):Ul(c,!!y,y?[]:"",!1));return;case"textarea":re=ee=null;for(st in y)if(I=y[st],y.hasOwnProperty(st)&&I!=null&&!S.hasOwnProperty(st))switch(st){case"value":break;case"children":break;default:Ai(c,d,st,null,S,I)}for(X in S)if(I=S[X],F=y[X],S.hasOwnProperty(X)&&(I!=null||F!=null))switch(X){case"value":ee=I;break;case"defaultValue":re=I;break;case"children":break;case"dangerouslySetInnerHTML":if(I!=null)throw Error(n(91));break;default:I!==F&&Ai(c,d,X,I,S,F)}ka(c,ee,re);return;case"option":for(var $e in y)if(ee=y[$e],y.hasOwnProperty($e)&&ee!=null&&!S.hasOwnProperty($e))switch($e){case"selected":c.selected=!1;break;default:Ai(c,d,$e,null,S,ee)}for(Rt in S)if(ee=S[Rt],re=y[Rt],S.hasOwnProperty(Rt)&&ee!==re&&(ee!=null||re!=null))switch(Rt){case"selected":c.selected=ee&&typeof ee!="function"&&typeof ee!="symbol";break;default:Ai(c,d,Rt,ee,S,re)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ai in y)ee=y[ai],y.hasOwnProperty(ai)&&ee!=null&&!S.hasOwnProperty(ai)&&Ai(c,d,ai,null,S,ee);for(Jt in S)if(ee=S[Jt],re=y[Jt],S.hasOwnProperty(Jt)&&ee!==re&&(ee!=null||re!=null))switch(Jt){case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(n(137,d));break;default:Ai(c,d,Jt,ee,S,re)}return;default:if(Ba(d)){for(var un in y)ee=y[un],y.hasOwnProperty(un)&&ee!==void 0&&!S.hasOwnProperty(un)&&hu(c,d,un,void 0,S,ee);for(oe in S)ee=S[oe],re=y[oe],!S.hasOwnProperty(oe)||ee===re||ee===void 0&&re===void 0||hu(c,d,oe,ee,S,re);return}}for(var Vt in y)ee=y[Vt],y.hasOwnProperty(Vt)&&ee!=null&&!S.hasOwnProperty(Vt)&&Ai(c,d,Vt,null,S,ee);for(ge in S)ee=S[ge],re=y[ge],!S.hasOwnProperty(ge)||ee===re||ee==null&&re==null||Ai(c,d,ge,ee,S,re)}function I_(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function bv(){if(typeof performance.getEntriesByType=="function"){for(var c=0,d=0,y=performance.getEntriesByType("resource"),S=0;S<y.length;S++){var I=y[S],F=I.transferSize,X=I.initiatorType,st=I.duration;if(F&&st&&I_(X)){for(X=0,st=I.responseEnd,S+=1;S<y.length;S++){var Rt=y[S],Jt=Rt.startTime;if(Jt>st)break;var oe=Rt.transferSize,ge=Rt.initiatorType;oe&&I_(ge)&&(Rt=Rt.responseEnd,X+=oe*(Rt<st?1:(st-Jt)/(Rt-Jt)))}if(--S,d+=8*(F+X)/(I.duration/1e3),c++,10<c)break}}if(0<c)return d/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var fu=null,Rf=null;function Pf(c){return c.nodeType===9?c:c.ownerDocument}function Gm(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function D_(c,d){if(c===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&d==="foreignObject"?0:c}function Qd(c,d){return c==="textarea"||c==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var Jd=null;function d0(){var c=window.event;return c&&c.type==="popstate"?c===Jd?!1:(Jd=c,!0):(Jd=null,!1)}var xv=typeof setTimeout=="function"?setTimeout:void 0,Hr=typeof clearTimeout=="function"?clearTimeout:void 0,yi=typeof Promise=="function"?Promise:void 0,gc=typeof queueMicrotask=="function"?queueMicrotask:typeof yi<"u"?function(c){return yi.resolve(null).then(c).catch(Fo)}:xv;function Fo(c){setTimeout(function(){throw c})}function Ks(c){return c==="head"}function Us(c,d){var y=d,S=0;do{var I=y.nextSibling;if(c.removeChild(y),I&&I.nodeType===8)if(y=I.data,y==="/$"||y==="/&"){if(S===0){c.removeChild(I),Ch(d);return}S--}else if(y==="$"||y==="$?"||y==="$~"||y==="$!"||y==="&")S++;else if(y==="html")Df(c.ownerDocument.documentElement);else if(y==="head"){y=c.ownerDocument.head,Df(y);for(var F=y.firstChild;F;){var X=F.nextSibling,st=F.nodeName;F[ks]||st==="SCRIPT"||st==="STYLE"||st==="LINK"&&F.rel.toLowerCase()==="stylesheet"||y.removeChild(F),F=X}}else y==="body"&&Df(c.ownerDocument.body);y=I}while(y);Ch(d)}function pr(c,d){var y=c;c=0;do{var S=y.nextSibling;if(y.nodeType===1?d?(y._stashedDisplay=y.style.display,y.style.display="none"):(y.style.display=y._stashedDisplay||"",y.getAttribute("style")===""&&y.removeAttribute("style")):y.nodeType===3&&(d?(y._stashedText=y.nodeValue,y.nodeValue=""):y.nodeValue=y._stashedText||""),S&&S.nodeType===8)if(y=S.data,y==="/$"){if(c===0)break;c--}else y!=="$"&&y!=="$?"&&y!=="$~"&&y!=="$!"||c++;y=S}while(y)}function nr(c){var d=c.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var y=d;switch(d=d.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":nr(y),Zo(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}c.removeChild(y)}}function wv(c,d,y,S){for(;c.nodeType===1;){var I=y;if(c.nodeName.toLowerCase()!==d.toLowerCase()){if(!S&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(S){if(!c[ks])switch(d){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(F=c.getAttribute("rel"),F==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(F!==I.rel||c.getAttribute("href")!==(I.href==null||I.href===""?null:I.href)||c.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin)||c.getAttribute("title")!==(I.title==null?null:I.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(F=c.getAttribute("src"),(F!==(I.src==null?null:I.src)||c.getAttribute("type")!==(I.type==null?null:I.type)||c.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin))&&F&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(d==="input"&&c.type==="hidden"){var F=I.name==null?null:""+I.name;if(I.type==="hidden"&&c.getAttribute("name")===F)return c}else return c;if(c=Sa(c.nextSibling),c===null)break}return null}function Ta(c,d,y){if(d==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!y||(c=Sa(c.nextSibling),c===null))return null;return c}function Ym(c,d){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!d||(c=Sa(c.nextSibling),c===null))return null;return c}function Gn(c){return c.data==="$?"||c.data==="$~"}function If(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function p0(c,d){var y=c.ownerDocument;if(c.data==="$~")c._reactRetry=d;else if(c.data!=="$?"||y.readyState!=="loading")d();else{var S=function(){d(),y.removeEventListener("DOMContentLoaded",S)};y.addEventListener("DOMContentLoaded",S),c._reactRetry=S}}function Sa(c){for(;c!=null;c=c.nextSibling){var d=c.nodeType;if(d===1||d===3)break;if(d===8){if(d=c.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return c}var _c=null;function yh(c){c=c.nextSibling;for(var d=0;c;){if(c.nodeType===8){var y=c.data;if(y==="/$"||y==="/&"){if(d===0)return Sa(c.nextSibling);d--}else y!=="$"&&y!=="$!"&&y!=="$?"&&y!=="$~"&&y!=="&"||d++}c=c.nextSibling}return null}function Tv(c){c=c.previousSibling;for(var d=0;c;){if(c.nodeType===8){var y=c.data;if(y==="$"||y==="$!"||y==="$?"||y==="$~"||y==="&"){if(d===0)return c;d--}else y!=="/$"&&y!=="/&"||d++}c=c.previousSibling}return null}function k_(c,d,y){switch(d=Pf(y),c){case"html":if(c=d.documentElement,!c)throw Error(n(452));return c;case"head":if(c=d.head,!c)throw Error(n(453));return c;case"body":if(c=d.body,!c)throw Error(n(454));return c;default:throw Error(n(451))}}function Df(c){for(var d=c.attributes;d.length;)c.removeAttributeNode(d[0]);Zo(c)}var Aa=new Map,Km=new Set;function tp(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Rs=we.d;we.d={f:vh,r:Qm,D:No,C:li,L:Sv,m:Av,X:m0,S:kf,M:Of};function vh(){var c=Rs.f(),d=km();return c||d}function Qm(c){var d=Vr(c);d!==null&&d.tag===5&&d.type==="form"?ml(d):Rs.r(c)}var Al=typeof document>"u"?null:document;function Wr(c,d,y){var S=Al;if(S&&typeof d=="string"&&d){var I=bs(d);I='link[rel="'+c+'"][href="'+I+'"]',typeof y=="string"&&(I+='[crossorigin="'+y+'"]'),Km.has(I)||(Km.add(I),c={rel:c,crossOrigin:y,href:d},S.querySelector(I)===null&&(d=S.createElement("link"),dr(d,"link",c),Rn(d),S.head.appendChild(d)))}}function No(c){Rs.D(c),Wr("dns-prefetch",c,null)}function li(c,d){Rs.C(c,d),Wr("preconnect",c,d)}function Sv(c,d,y){Rs.L(c,d,y);var S=Al;if(S&&c&&d){var I='link[rel="preload"][as="'+bs(d)+'"]';d==="image"&&y&&y.imageSrcSet?(I+='[imagesrcset="'+bs(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(I+='[imagesizes="'+bs(y.imageSizes)+'"]')):I+='[href="'+bs(c)+'"]';var F=I;switch(d){case"style":F=bh(c);break;case"script":F=pu(c)}Aa.has(F)||(c=L({rel:"preload",href:d==="image"&&y&&y.imageSrcSet?void 0:c,as:d},y),Aa.set(F,c),S.querySelector(I)!==null||d==="style"&&S.querySelector(du(F))||d==="script"&&S.querySelector(xh(F))||(d=S.createElement("link"),dr(d,"link",c),Rn(d),S.head.appendChild(d)))}}function Av(c,d){Rs.m(c,d);var y=Al;if(y&&c){var S=d&&typeof d.as=="string"?d.as:"script",I='link[rel="modulepreload"][as="'+bs(S)+'"][href="'+bs(c)+'"]',F=I;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":F=pu(c)}if(!Aa.has(F)&&(c=L({rel:"modulepreload",href:c},d),Aa.set(F,c),y.querySelector(I)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(xh(F)))return}S=y.createElement("link"),dr(S,"link",c),Rn(S),y.head.appendChild(S)}}}function kf(c,d,y){Rs.S(c,d,y);var S=Al;if(S&&c){var I=ca(S).hoistableStyles,F=bh(c);d=d||"default";var X=I.get(F);if(!X){var st={loading:0,preload:null};if(X=S.querySelector(du(F)))st.loading=5;else{c=L({rel:"stylesheet",href:c,"data-precedence":d},y),(y=Aa.get(F))&&wh(c,y);var Rt=X=S.createElement("link");Rn(Rt),dr(Rt,"link",c),Rt._p=new Promise(function(Jt,oe){Rt.onload=Jt,Rt.onerror=oe}),Rt.addEventListener("load",function(){st.loading|=1}),Rt.addEventListener("error",function(){st.loading|=2}),st.loading|=4,ip(X,d,S)}X={type:"stylesheet",instance:X,count:1,state:st},I.set(F,X)}}}function m0(c,d){Rs.X(c,d);var y=Al;if(y&&c){var S=ca(y).hoistableScripts,I=pu(c),F=S.get(I);F||(F=y.querySelector(xh(I)),F||(c=L({src:c,async:!0},d),(d=Aa.get(I))&&Th(c,d),F=y.createElement("script"),Rn(F),dr(F,"link",c),y.head.appendChild(F)),F={type:"script",instance:F,count:1,state:null},S.set(I,F))}}function Of(c,d){Rs.M(c,d);var y=Al;if(y&&c){var S=ca(y).hoistableScripts,I=pu(c),F=S.get(I);F||(F=y.querySelector(xh(I)),F||(c=L({src:c,async:!0,type:"module"},d),(d=Aa.get(I))&&Th(c,d),F=y.createElement("script"),Rn(F),dr(F,"link",c),y.head.appendChild(F)),F={type:"script",instance:F,count:1,state:null},S.set(I,F))}}function Ev(c,d,y,S){var I=(I=ii.current)?tp(I):null;if(!I)throw Error(n(446));switch(c){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(d=bh(y.href),y=ca(I).hoistableStyles,S=y.get(d),S||(S={type:"style",instance:null,count:0,state:null},y.set(d,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){c=bh(y.href);var F=ca(I).hoistableStyles,X=F.get(c);if(X||(I=I.ownerDocument||I,X={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},F.set(c,X),(F=I.querySelector(du(c)))&&!F._p&&(X.instance=F,X.state.loading=5),Aa.has(c)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},Aa.set(c,y),F||Jm(I,c,y,X.state))),d&&S===null)throw Error(n(528,""));return X}if(d&&S!==null)throw Error(n(529,""));return null;case"script":return d=y.async,y=y.src,typeof y=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=pu(y),y=ca(I).hoistableScripts,S=y.get(d),S||(S={type:"script",instance:null,count:0,state:null},y.set(d,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,c))}}function bh(c){return'href="'+bs(c)+'"'}function du(c){return'link[rel="stylesheet"]['+c+"]"}function ep(c){return L({},c,{"data-precedence":c.precedence,precedence:null})}function Jm(c,d,y,S){c.querySelector('link[rel="preload"][as="style"]['+d+"]")?S.loading=1:(d=c.createElement("link"),S.preload=d,d.addEventListener("load",function(){return S.loading|=1}),d.addEventListener("error",function(){return S.loading|=2}),dr(d,"link",y),Rn(d),c.head.appendChild(d))}function pu(c){return'[src="'+bs(c)+'"]'}function xh(c){return"script[async]"+c}function tg(c,d,y){if(d.count++,d.instance===null)switch(d.type){case"style":var S=c.querySelector('style[data-href~="'+bs(y.href)+'"]');if(S)return d.instance=S,Rn(S),S;var I=L({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return S=(c.ownerDocument||c).createElement("style"),Rn(S),dr(S,"style",I),ip(S,y.precedence,c),d.instance=S;case"stylesheet":I=bh(y.href);var F=c.querySelector(du(I));if(F)return d.state.loading|=4,d.instance=F,Rn(F),F;S=ep(y),(I=Aa.get(I))&&wh(S,I),F=(c.ownerDocument||c).createElement("link"),Rn(F);var X=F;return X._p=new Promise(function(st,Rt){X.onload=st,X.onerror=Rt}),dr(F,"link",S),d.state.loading|=4,ip(F,y.precedence,c),d.instance=F;case"script":return F=pu(y.src),(I=c.querySelector(xh(F)))?(d.instance=I,Rn(I),I):(S=y,(I=Aa.get(F))&&(S=L({},y),Th(S,I)),c=c.ownerDocument||c,I=c.createElement("script"),Rn(I),dr(I,"link",S),c.head.appendChild(I),d.instance=I);case"void":return null;default:throw Error(n(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(S=d.instance,d.state.loading|=4,ip(S,y.precedence,c));return d.instance}function ip(c,d,y){for(var S=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),I=S.length?S[S.length-1]:null,F=I,X=0;X<S.length;X++){var st=S[X];if(st.dataset.precedence===d)F=st;else if(F!==I)break}F?F.parentNode.insertBefore(c,F.nextSibling):(d=y.nodeType===9?y.head:y,d.insertBefore(c,d.firstChild))}function wh(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.title==null&&(c.title=d.title)}function Th(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.integrity==null&&(c.integrity=d.integrity)}var np=null;function rp(c,d,y){if(np===null){var S=new Map,I=np=new Map;I.set(y,S)}else I=np,S=I.get(y),S||(S=new Map,I.set(y,S));if(S.has(c))return S;for(S.set(c,null),y=y.getElementsByTagName(c),I=0;I<y.length;I++){var F=y[I];if(!(F[ks]||F[fe]||c==="link"&&F.getAttribute("rel")==="stylesheet")&&F.namespaceURI!=="http://www.w3.org/2000/svg"){var X=F.getAttribute(d)||"";X=c+X;var st=S.get(X);st?st.push(F):S.set(X,[F])}}return S}function sp(c,d,y){c=c.ownerDocument||c,c.head.insertBefore(y,d==="title"?c.querySelector("head > title"):null)}function g0(c,d,y){if(y===1||d.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return c=d.disabled,typeof d.precedence=="string"&&c==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function eg(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function Cv(c,d,y,S){if(y.type==="stylesheet"&&(typeof S.media!="string"||matchMedia(S.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var I=bh(S.href),F=d.querySelector(du(I));if(F){d=F._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(c.count++,c=ap.bind(c),d.then(c,c)),y.state.loading|=4,y.instance=F,Rn(F);return}F=d.ownerDocument||d,S=ep(S),(I=Aa.get(I))&&wh(S,I),F=F.createElement("link"),Rn(F);var X=F;X._p=new Promise(function(st,Rt){X.onload=st,X.onerror=Rt}),dr(F,"link",S),y.instance=F}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(y,d),(d=y.state.preload)&&(y.state.loading&3)===0&&(c.count++,y=ap.bind(c),d.addEventListener("load",y),d.addEventListener("error",y))}}var O_=0;function _0(c,d){return c.stylesheets&&c.count===0&&mu(c,c.stylesheets),0<c.count||0<c.imgCount?function(y){var S=setTimeout(function(){if(c.stylesheets&&mu(c,c.stylesheets),c.unsuspend){var F=c.unsuspend;c.unsuspend=null,F()}},6e4+d);0<c.imgBytes&&O_===0&&(O_=62500*bv());var I=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&mu(c,c.stylesheets),c.unsuspend)){var F=c.unsuspend;c.unsuspend=null,F()}},(c.imgBytes>O_?50:800)+d);return c.unsuspend=y,function(){c.unsuspend=null,clearTimeout(S),clearTimeout(I)}}:null}function ap(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mu(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var ig=null;function mu(c,d){c.stylesheets=null,c.unsuspend!==null&&(c.count++,ig=new Map,d.forEach(Mv,c),ig=null,ap.call(c))}function Mv(c,d){if(!(d.state.loading&4)){var y=ig.get(c);if(y)var S=y.get(null);else{y=new Map,ig.set(c,y);for(var I=c.querySelectorAll("link[data-precedence],style[data-precedence]"),F=0;F<I.length;F++){var X=I[F];(X.nodeName==="LINK"||X.getAttribute("media")!=="not all")&&(y.set(X.dataset.precedence,X),S=X)}S&&y.set(null,S)}I=d.instance,X=I.getAttribute("data-precedence"),F=y.get(X)||S,F===S&&y.set(null,I),y.set(X,I),this.count++,S=ap.bind(this),I.addEventListener("load",S),I.addEventListener("error",S),F?F.parentNode.insertBefore(I,F.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(I,c.firstChild)),d.state.loading|=4}}var op={$$typeof:pt,Provider:null,Consumer:null,_currentValue:ye,_currentValue2:ye,_threadCount:0};function B_(c,d,y,S,I,F,X,st,Rt){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=He(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=He(0),this.hiddenUpdates=He(null),this.identifierPrefix=S,this.onUncaughtError=I,this.onCaughtError=F,this.onRecoverableError=X,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Rt,this.incompleteTransitions=new Map}function ng(c,d,y,S,I,F,X,st,Rt,Jt,oe,ge){return c=new B_(c,d,y,X,Rt,Jt,oe,ge,st),d=1,F===!0&&(d|=24),F=Ts(3,null,null,d),c.current=F,F.stateNode=c,d=As(),d.refCount++,c.pooledCache=d,d.refCount++,F.memoizedState={element:S,isDehydrated:y,cache:d},Hi(F),c}function L_(c){return c?(c=po,c):po}function Sh(c,d,y,S,I,F){I=L_(I),S.context===null?S.context=I:S.pendingContext=I,S=_a(d),S.payload={element:y},F=F===void 0?null:F,F!==null&&(S.callback=F),y=ya(c,S,d),y!==null&&(Lr(y,c,d),ac(y,c,d))}function F_(c,d){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var y=c.retryLane;c.retryLane=y!==0&&y<d?y:d}}function Ah(c,d){F_(c,d),(c=c.alternate)&&F_(c,d)}function Rv(c){if(c.tag===13||c.tag===31){var d=il(c,67108864);d!==null&&Lr(d,c,67108864),Ah(c,67108864)}}function Bf(c){if(c.tag===13||c.tag===31){var d=Ys();d=xe(d);var y=il(c,d);y!==null&&Lr(y,c,d),Ah(c,d)}}var Eh=!0;function y0(c,d,y,S){var I=ne.T;ne.T=null;var F=we.p;try{we.p=2,rg(c,d,y,S)}finally{we.p=F,ne.T=I}}function Pv(c,d,y,S){var I=ne.T;ne.T=null;var F=we.p;try{we.p=8,rg(c,d,y,S)}finally{we.p=F,ne.T=I}}function rg(c,d,y,S){if(Eh){var I=N_(S);if(I===null)qm(c,d,S,sg,y),V_(c,S);else if(b0(I,c,d,y,S))S.stopPropagation();else if(V_(c,S),d&4&&-1<v0.indexOf(c)){for(;I!==null;){var F=Vr(I);if(F!==null)switch(F.tag){case 3:if(F=F.stateNode,F.current.memoizedState.isDehydrated){var X=Ot(F.pendingLanes);if(X!==0){var st=F;for(st.pendingLanes|=2,st.entangledLanes|=2;X;){var Rt=1<<31-Q(X);st.entanglements[1]|=Rt,X&=~Rt}no(F),(ji&6)===0&&(Pm=or()+500,Xd(0))}}break;case 31:case 13:st=il(F,2),st!==null&&Lr(st,F,2),km(),Ah(F,2)}if(F=N_(S),F===null&&qm(c,d,S,sg,y),F===I)break;I=F}I!==null&&S.stopPropagation()}else qm(c,d,S,null,y)}}function N_(c){return c=Bn(c),z_(c)}var sg=null;function z_(c){if(sg=null,c=oa(c),c!==null){var d=f(c);if(d===null)c=null;else{var y=d.tag;if(y===13){if(c=m(d),c!==null)return c;c=null}else if(y===31){if(c=l(d),c!==null)return c;c=null}else if(y===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;c=null}else d!==c&&(c=null)}}return sg=c,null}function Iv(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_s()){case kc:return 2;case Oc:return 8;case Da:case Bc:return 32;case so:return 268435456;default:return 32}default:return 32}}var U_=!1,yc=null,vc=null,bc=null,lp=new Map,Lf=new Map,xc=[],v0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function V_(c,d){switch(c){case"focusin":case"focusout":yc=null;break;case"dragenter":case"dragleave":vc=null;break;case"mouseover":case"mouseout":bc=null;break;case"pointerover":case"pointerout":lp.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lf.delete(d.pointerId)}}function cp(c,d,y,S,I,F){return c===null||c.nativeEvent!==F?(c={blockedOn:d,domEventName:y,eventSystemFlags:S,nativeEvent:F,targetContainers:[I]},d!==null&&(d=Vr(d),d!==null&&Rv(d)),c):(c.eventSystemFlags|=S,d=c.targetContainers,I!==null&&d.indexOf(I)===-1&&d.push(I),c)}function b0(c,d,y,S,I){switch(d){case"focusin":return yc=cp(yc,c,d,y,S,I),!0;case"dragenter":return vc=cp(vc,c,d,y,S,I),!0;case"mouseover":return bc=cp(bc,c,d,y,S,I),!0;case"pointerover":var F=I.pointerId;return lp.set(F,cp(lp.get(F)||null,c,d,y,S,I)),!0;case"gotpointercapture":return F=I.pointerId,Lf.set(F,cp(Lf.get(F)||null,c,d,y,S,I)),!0}return!1}function wc(c){var d=oa(c.target);if(d!==null){var y=f(d);if(y!==null){if(d=y.tag,d===13){if(d=m(y),d!==null){c.blockedOn=d,Vn(c.priority,function(){Bf(y)});return}}else if(d===31){if(d=l(y),d!==null){c.blockedOn=d,Vn(c.priority,function(){Bf(y)});return}}else if(d===3&&y.stateNode.current.memoizedState.isDehydrated){c.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}c.blockedOn=null}function up(c){if(c.blockedOn!==null)return!1;for(var d=c.targetContainers;0<d.length;){var y=N_(c.nativeEvent);if(y===null){y=c.nativeEvent;var S=new y.constructor(y.type,y);La=S,y.target.dispatchEvent(S),La=null}else return d=Vr(y),d!==null&&Rv(d),c.blockedOn=y,!1;d.shift()}return!0}function j_(c,d,y){up(c)&&y.delete(d)}function Dv(){U_=!1,yc!==null&&up(yc)&&(yc=null),vc!==null&&up(vc)&&(vc=null),bc!==null&&up(bc)&&(bc=null),lp.forEach(j_),Lf.forEach(j_)}function hp(c,d){c.blockedOn===d&&(c.blockedOn=null,U_||(U_=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Dv)))}var ag=null;function kv(c){ag!==c&&(ag=c,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){ag===c&&(ag=null);for(var d=0;d<c.length;d+=3){var y=c[d],S=c[d+1],I=c[d+2];if(typeof S!="function"){if(z_(S||y)===null)continue;break}var F=Vr(y);F!==null&&(c.splice(d,3),d-=3,ba(F,{pending:!0,data:I,method:y.method,action:S},S,I))}}))}function Ch(c){function d(Rt){return hp(Rt,c)}yc!==null&&hp(yc,c),vc!==null&&hp(vc,c),bc!==null&&hp(bc,c),lp.forEach(d),Lf.forEach(d);for(var y=0;y<xc.length;y++){var S=xc[y];S.blockedOn===c&&(S.blockedOn=null)}for(;0<xc.length&&(y=xc[0],y.blockedOn===null);)wc(y),y.blockedOn===null&&xc.shift();if(y=(c.ownerDocument||c).$$reactFormReplay,y!=null)for(S=0;S<y.length;S+=3){var I=y[S],F=y[S+1],X=I[Re]||null;if(typeof F=="function")X||kv(y);else if(X){var st=null;if(F&&F.hasAttribute("formAction")){if(I=F,X=F[Re]||null)st=X.formAction;else if(z_(I)!==null)continue}else st=X.action;typeof st=="function"?y[S+1]=st:(y.splice(S,3),S-=3),kv(y)}}}function $_(){function c(F){F.canIntercept&&F.info==="react-transition"&&F.intercept({handler:function(){return new Promise(function(X){return I=X})},focusReset:"manual",scroll:"manual"})}function d(){I!==null&&(I(),I=null),S||setTimeout(y,20)}function y(){if(!S&&!navigation.transition){var F=navigation.currentEntry;F&&F.url!=null&&navigation.navigate(F.url,{state:F.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var S=!1,I=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(y,100),function(){S=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),I!==null&&(I(),I=null)}}}function Ff(c){this._internalRoot=c}fp.prototype.render=Ff.prototype.render=function(c){var d=this._internalRoot;if(d===null)throw Error(n(409));var y=d.current,S=Ys();Sh(y,S,c,d,null,null)},fp.prototype.unmount=Ff.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var d=c.containerInfo;Sh(c.current,2,null,c,null,null),km(),d[We]=null}};function fp(c){this._internalRoot=c}fp.prototype.unstable_scheduleHydration=function(c){if(c){var d=tn();c={blockedOn:null,target:c,priority:d};for(var y=0;y<xc.length&&d!==0&&d<xc[y].priority;y++);xc.splice(y,0,c),y===0&&wc(c)}};var dp=t.version;if(dp!=="19.2.0")throw Error(n(527,dp,"19.2.0"));we.findDOMNode=function(c){var d=c._reactInternals;if(d===void 0)throw typeof c.render=="function"?Error(n(188)):(c=Object.keys(c).join(","),Error(n(268,c)));return c=C(d),c=c!==null?P(c):null,c=c===null?null:c.stateNode,c};var og={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:ne,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mh.isDisabled&&Mh.supportsFiber)try{ts=Mh.inject(og),yn=Mh}catch{}}return W_.createRoot=function(c,d){if(!a(c))throw Error(n(299));var y=!1,S="",I=Pd,F=nu,X=r_;return d!=null&&(d.unstable_strictMode===!0&&(y=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onUncaughtError!==void 0&&(I=d.onUncaughtError),d.onCaughtError!==void 0&&(F=d.onCaughtError),d.onRecoverableError!==void 0&&(X=d.onRecoverableError)),d=ng(c,1,!1,null,null,y,S,null,I,F,X,$_),c[We]=d.current,Wm(c),new Ff(d)},W_.hydrateRoot=function(c,d,y){if(!a(c))throw Error(n(299));var S=!1,I="",F=Pd,X=nu,st=r_,Rt=null;return y!=null&&(y.unstable_strictMode===!0&&(S=!0),y.identifierPrefix!==void 0&&(I=y.identifierPrefix),y.onUncaughtError!==void 0&&(F=y.onUncaughtError),y.onCaughtError!==void 0&&(X=y.onCaughtError),y.onRecoverableError!==void 0&&(st=y.onRecoverableError),y.formState!==void 0&&(Rt=y.formState)),d=ng(c,1,!0,d,y??null,S,I,Rt,F,X,st,$_),d.context=L_(null),y=d.current,S=Ys(),S=xe(S),I=_a(S),I.callback=null,ya(y,I,S),y=S,d.current.lanes=y,si(d,y),no(d),c[We]=d.current,Wm(c),new fp(d)},W_.version="19.2.0",W_}var ET;function tP(){if(ET)return A0.exports;ET=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),A0.exports=JR(),A0.exports}var C$=tP();const bE=me.createContext({});function eP(i){const t=me.useRef(null);return t.current===null&&(t.current=i()),t.current}const k1=typeof window<"u",iP=k1?me.useLayoutEffect:me.useEffect,O1=me.createContext(null);function B1(i,t){i.indexOf(t)===-1&&i.push(t)}function L1(i,t){const e=i.indexOf(t);e>-1&&i.splice(e,1)}const Bh=(i,t,e)=>e>t?t:e<i?i:e;let F1=()=>{};const Lh={},xE=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i);function wE(i){return typeof i=="object"&&i!==null}const TE=i=>/^0[^.\s]+$/u.test(i);function N1(i){let t;return()=>(t===void 0&&(t=i()),t)}const Il=i=>i,nP=(i,t)=>e=>t(i(e)),Ry=(...i)=>i.reduce(nP),yy=(i,t,e)=>{const n=t-i;return n===0?1:(e-i)/n};class z1{constructor(){this.subscriptions=[]}add(t){return B1(this.subscriptions,t),()=>L1(this.subscriptions,t)}notify(t,e,n){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,e,n);else for(let f=0;f<a;f++){const m=this.subscriptions[f];m&&m(t,e,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Tu=i=>i*1e3,Ml=i=>i/1e3;function SE(i,t){return t?i*(1e3/t):0}const AE=(i,t,e)=>(((1-3*e+3*t)*i+(3*e-6*t))*i+3*t)*i,rP=1e-7,sP=12;function aP(i,t,e,n,a){let f,m,l=0;do m=t+(e-t)/2,f=AE(m,n,a)-i,f>0?e=m:t=m;while(Math.abs(f)>rP&&++l<sP);return m}function Py(i,t,e,n){if(i===t&&e===n)return Il;const a=f=>aP(f,0,1,i,e);return f=>f===0||f===1?f:AE(a(f),t,n)}const EE=i=>t=>t<=.5?i(2*t)/2:(2-i(2*(1-t)))/2,CE=i=>t=>1-i(1-t),ME=Py(.33,1.53,.69,.99),U1=CE(ME),RE=EE(U1),PE=i=>(i*=2)<1?.5*U1(i):.5*(2-Math.pow(2,-10*(i-1))),V1=i=>1-Math.sin(Math.acos(i)),IE=CE(V1),DE=EE(V1),oP=Py(.42,0,1,1),lP=Py(0,0,.58,1),kE=Py(.42,0,.58,1),cP=i=>Array.isArray(i)&&typeof i[0]!="number",OE=i=>Array.isArray(i)&&typeof i[0]=="number",uP={linear:Il,easeIn:oP,easeInOut:kE,easeOut:lP,circIn:V1,circInOut:DE,circOut:IE,backIn:U1,backInOut:RE,backOut:ME,anticipate:PE},hP=i=>typeof i=="string",CT=i=>{if(OE(i)){F1(i.length===4);const[t,e,n,a]=i;return Py(t,e,n,a)}else if(hP(i))return uP[i];return i},Bv=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function fP(i,t){let e=new Set,n=new Set,a=!1,f=!1;const m=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function w(P){m.has(P)&&(C.schedule(P),i()),P(l)}const C={schedule:(P,L=!1,j=!1)=>{const nt=j&&a?e:n;return L&&m.add(P),nt.has(P)||nt.add(P),P},cancel:P=>{n.delete(P),m.delete(P)},process:P=>{if(l=P,a){f=!0;return}a=!0,[e,n]=[n,e],e.forEach(w),e.clear(),a=!1,f&&(f=!1,C.process(P))}};return C}const dP=40;function BE(i,t){let e=!1,n=!0;const a={delta:0,timestamp:0,isProcessing:!1},f=()=>e=!0,m=Bv.reduce((pt,Pt)=>(pt[Pt]=fP(f),pt),{}),{setup:l,read:w,resolveKeyframes:C,preUpdate:P,update:L,preRender:j,render:G,postRender:nt}=m,at=()=>{const pt=Lh.useManualTiming?a.timestamp:performance.now();e=!1,Lh.useManualTiming||(a.delta=n?1e3/60:Math.max(Math.min(pt-a.timestamp,dP),1)),a.timestamp=pt,a.isProcessing=!0,l.process(a),w.process(a),C.process(a),P.process(a),L.process(a),j.process(a),G.process(a),nt.process(a),a.isProcessing=!1,e&&t&&(n=!1,i(at))},J=()=>{e=!0,n=!0,a.isProcessing||i(at)};return{schedule:Bv.reduce((pt,Pt)=>{const kt=m[Pt];return pt[Pt]=($t,ae=!1,qt=!1)=>(e||J(),kt.schedule($t,ae,qt)),pt},{}),cancel:pt=>{for(let Pt=0;Pt<Bv.length;Pt++)m[Bv[Pt]].cancel(pt)},state:a,steps:m}}const{schedule:rr,cancel:Yf,state:js,steps:R0}=BE(typeof requestAnimationFrame<"u"?requestAnimationFrame:Il,!0);let eb;function pP(){eb=void 0}const ro={now:()=>(eb===void 0&&ro.set(js.isProcessing||Lh.useManualTiming?js.timestamp:performance.now()),eb),set:i=>{eb=i,queueMicrotask(pP)}},LE=i=>t=>typeof t=="string"&&t.startsWith(i),j1=LE("--"),mP=LE("var(--"),$1=i=>mP(i)?gP.test(i.split("/*")[0].trim()):!1,gP=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Zg={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},vy={...Zg,transform:i=>Bh(0,1,i)},Lv={...Zg,default:1},ry=i=>Math.round(i*1e5)/1e5,H1=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function _P(i){return i==null}const yP=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,W1=(i,t)=>e=>!!(typeof e=="string"&&yP.test(e)&&e.startsWith(i)||t&&!_P(e)&&Object.prototype.hasOwnProperty.call(e,t)),FE=(i,t,e)=>n=>{if(typeof n!="string")return n;const[a,f,m,l]=n.match(H1);return{[i]:parseFloat(a),[t]:parseFloat(f),[e]:parseFloat(m),alpha:l!==void 0?parseFloat(l):1}},vP=i=>Bh(0,255,i),P0={...Zg,transform:i=>Math.round(vP(i))},Tp={test:W1("rgb","red"),parse:FE("red","green","blue"),transform:({red:i,green:t,blue:e,alpha:n=1})=>"rgba("+P0.transform(i)+", "+P0.transform(t)+", "+P0.transform(e)+", "+ry(vy.transform(n))+")"};function bP(i){let t="",e="",n="",a="";return i.length>5?(t=i.substring(1,3),e=i.substring(3,5),n=i.substring(5,7),a=i.substring(7,9)):(t=i.substring(1,2),e=i.substring(2,3),n=i.substring(3,4),a=i.substring(4,5),t+=t,e+=e,n+=n,a+=a),{red:parseInt(t,16),green:parseInt(e,16),blue:parseInt(n,16),alpha:a?parseInt(a,16)/255:1}}const Rx={test:W1("#"),parse:bP,transform:Tp.transform},Iy=i=>({test:t=>typeof t=="string"&&t.endsWith(i)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${i}`}),jf=Iy("deg"),Su=Iy("%"),di=Iy("px"),xP=Iy("vh"),wP=Iy("vw"),MT={...Su,parse:i=>Su.parse(i)/100,transform:i=>Su.transform(i*100)},xg={test:W1("hsl","hue"),parse:FE("hue","saturation","lightness"),transform:({hue:i,saturation:t,lightness:e,alpha:n=1})=>"hsla("+Math.round(i)+", "+Su.transform(ry(t))+", "+Su.transform(ry(e))+", "+ry(vy.transform(n))+")"},Qr={test:i=>Tp.test(i)||Rx.test(i)||xg.test(i),parse:i=>Tp.test(i)?Tp.parse(i):xg.test(i)?xg.parse(i):Rx.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?Tp.transform(i):xg.transform(i),getAnimatableNone:i=>{const t=Qr.parse(i);return t.alpha=0,Qr.transform(t)}},TP=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function SP(i){return isNaN(i)&&typeof i=="string"&&(i.match(H1)?.length||0)+(i.match(TP)?.length||0)>0}const NE="number",zE="color",AP="var",EP="var(",RT="${}",CP=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function by(i){const t=i.toString(),e=[],n={color:[],number:[],var:[]},a=[];let f=0;const l=t.replace(CP,w=>(Qr.test(w)?(n.color.push(f),a.push(zE),e.push(Qr.parse(w))):w.startsWith(EP)?(n.var.push(f),a.push(AP),e.push(w)):(n.number.push(f),a.push(NE),e.push(parseFloat(w))),++f,RT)).split(RT);return{values:e,split:l,indexes:n,types:a}}function UE(i){return by(i).values}function VE(i){const{split:t,types:e}=by(i),n=t.length;return a=>{let f="";for(let m=0;m<n;m++)if(f+=t[m],a[m]!==void 0){const l=e[m];l===NE?f+=ry(a[m]):l===zE?f+=Qr.transform(a[m]):f+=a[m]}return f}}const MP=i=>typeof i=="number"?0:Qr.test(i)?Qr.getAnimatableNone(i):i;function RP(i){const t=UE(i);return VE(i)(t.map(MP))}const Kf={test:SP,parse:UE,createTransformer:VE,getAnimatableNone:RP};function I0(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*(2/3-e)*6:i}function PP({hue:i,saturation:t,lightness:e,alpha:n}){i/=360,t/=100,e/=100;let a=0,f=0,m=0;if(!t)a=f=m=e;else{const l=e<.5?e*(1+t):e+t-e*t,w=2*e-l;a=I0(w,l,i+1/3),f=I0(w,l,i),m=I0(w,l,i-1/3)}return{red:Math.round(a*255),green:Math.round(f*255),blue:Math.round(m*255),alpha:n}}function db(i,t){return e=>e>0?t:i}const mr=(i,t,e)=>i+(t-i)*e,D0=(i,t,e)=>{const n=i*i,a=e*(t*t-n)+n;return a<0?0:Math.sqrt(a)},IP=[Rx,Tp,xg],DP=i=>IP.find(t=>t.test(i));function PT(i){const t=DP(i);if(!t)return!1;let e=t.parse(i);return t===xg&&(e=PP(e)),e}const IT=(i,t)=>{const e=PT(i),n=PT(t);if(!e||!n)return db(i,t);const a={...e};return f=>(a.red=D0(e.red,n.red,f),a.green=D0(e.green,n.green,f),a.blue=D0(e.blue,n.blue,f),a.alpha=mr(e.alpha,n.alpha,f),Tp.transform(a))},Px=new Set(["none","hidden"]);function kP(i,t){return Px.has(i)?e=>e<=0?i:t:e=>e>=1?t:i}function OP(i,t){return e=>mr(i,t,e)}function q1(i){return typeof i=="number"?OP:typeof i=="string"?$1(i)?db:Qr.test(i)?IT:FP:Array.isArray(i)?jE:typeof i=="object"?Qr.test(i)?IT:BP:db}function jE(i,t){const e=[...i],n=e.length,a=i.map((f,m)=>q1(f)(f,t[m]));return f=>{for(let m=0;m<n;m++)e[m]=a[m](f);return e}}function BP(i,t){const e={...i,...t},n={};for(const a in e)i[a]!==void 0&&t[a]!==void 0&&(n[a]=q1(i[a])(i[a],t[a]));return a=>{for(const f in n)e[f]=n[f](a);return e}}function LP(i,t){const e=[],n={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const f=t.types[a],m=i.indexes[f][n[f]],l=i.values[m]??0;e[a]=l,n[f]++}return e}const FP=(i,t)=>{const e=Kf.createTransformer(t),n=by(i),a=by(t);return n.indexes.var.length===a.indexes.var.length&&n.indexes.color.length===a.indexes.color.length&&n.indexes.number.length>=a.indexes.number.length?Px.has(i)&&!a.values.length||Px.has(t)&&!n.values.length?kP(i,t):Ry(jE(LP(n,a),a.values),e):db(i,t)};function $E(i,t,e){return typeof i=="number"&&typeof t=="number"&&typeof e=="number"?mr(i,t,e):q1(i)(i,t)}const NP=i=>{const t=({timestamp:e})=>i(e);return{start:(e=!0)=>rr.update(t,e),stop:()=>Yf(t),now:()=>js.isProcessing?js.timestamp:ro.now()}},HE=(i,t,e=10)=>{let n="";const a=Math.max(Math.round(t/e),2);for(let f=0;f<a;f++)n+=Math.round(i(f/(a-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},pb=2e4;function X1(i){let t=0;const e=50;let n=i.next(t);for(;!n.done&&t<pb;)t+=e,n=i.next(t);return t>=pb?1/0:t}function zP(i,t=100,e){const n=e({...i,keyframes:[0,t]}),a=Math.min(X1(n),pb);return{type:"keyframes",ease:f=>n.next(a*f).value/t,duration:Ml(a)}}const UP=5;function WE(i,t,e){const n=Math.max(t-UP,0);return SE(e-i(n),t-n)}const Tr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},k0=.001;function VP({duration:i=Tr.duration,bounce:t=Tr.bounce,velocity:e=Tr.velocity,mass:n=Tr.mass}){let a,f,m=1-t;m=Bh(Tr.minDamping,Tr.maxDamping,m),i=Bh(Tr.minDuration,Tr.maxDuration,Ml(i)),m<1?(a=C=>{const P=C*m,L=P*i,j=P-e,G=Ix(C,m),nt=Math.exp(-L);return k0-j/G*nt},f=C=>{const L=C*m*i,j=L*e+e,G=Math.pow(m,2)*Math.pow(C,2)*i,nt=Math.exp(-L),at=Ix(Math.pow(C,2),m);return(-a(C)+k0>0?-1:1)*((j-G)*nt)/at}):(a=C=>{const P=Math.exp(-C*i),L=(C-e)*i+1;return-k0+P*L},f=C=>{const P=Math.exp(-C*i),L=(e-C)*(i*i);return P*L});const l=5/i,w=$P(a,f,l);if(i=Tu(i),isNaN(w))return{stiffness:Tr.stiffness,damping:Tr.damping,duration:i};{const C=Math.pow(w,2)*n;return{stiffness:C,damping:m*2*Math.sqrt(n*C),duration:i}}}const jP=12;function $P(i,t,e){let n=e;for(let a=1;a<jP;a++)n=n-i(n)/t(n);return n}function Ix(i,t){return i*Math.sqrt(1-t*t)}const HP=["duration","bounce"],WP=["stiffness","damping","mass"];function DT(i,t){return t.some(e=>i[e]!==void 0)}function qP(i){let t={velocity:Tr.velocity,stiffness:Tr.stiffness,damping:Tr.damping,mass:Tr.mass,isResolvedFromDuration:!1,...i};if(!DT(i,WP)&&DT(i,HP))if(i.visualDuration){const e=i.visualDuration,n=2*Math.PI/(e*1.2),a=n*n,f=2*Bh(.05,1,1-(i.bounce||0))*Math.sqrt(a);t={...t,mass:Tr.mass,stiffness:a,damping:f}}else{const e=VP(i);t={...t,...e,mass:Tr.mass},t.isResolvedFromDuration=!0}return t}function mb(i=Tr.visualDuration,t=Tr.bounce){const e=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:t}:i;let{restSpeed:n,restDelta:a}=e;const f=e.keyframes[0],m=e.keyframes[e.keyframes.length-1],l={done:!1,value:f},{stiffness:w,damping:C,mass:P,duration:L,velocity:j,isResolvedFromDuration:G}=qP({...e,velocity:-Ml(e.velocity||0)}),nt=j||0,at=C/(2*Math.sqrt(w*P)),J=m-f,mt=Ml(Math.sqrt(w/P)),Mt=Math.abs(J)<5;n||(n=Mt?Tr.restSpeed.granular:Tr.restSpeed.default),a||(a=Mt?Tr.restDelta.granular:Tr.restDelta.default);let pt;if(at<1){const kt=Ix(mt,at);pt=$t=>{const ae=Math.exp(-at*mt*$t);return m-ae*((nt+at*mt*J)/kt*Math.sin(kt*$t)+J*Math.cos(kt*$t))}}else if(at===1)pt=kt=>m-Math.exp(-mt*kt)*(J+(nt+mt*J)*kt);else{const kt=mt*Math.sqrt(at*at-1);pt=$t=>{const ae=Math.exp(-at*mt*$t),qt=Math.min(kt*$t,300);return m-ae*((nt+at*mt*J)*Math.sinh(qt)+kt*J*Math.cosh(qt))/kt}}const Pt={calculatedDuration:G&&L||null,next:kt=>{const $t=pt(kt);if(G)l.done=kt>=L;else{let ae=kt===0?nt:0;at<1&&(ae=kt===0?Tu(nt):WE(pt,kt,$t));const qt=Math.abs(ae)<=n,le=Math.abs(m-$t)<=a;l.done=qt&&le}return l.value=l.done?m:$t,l},toString:()=>{const kt=Math.min(X1(Pt),pb),$t=HE(ae=>Pt.next(kt*ae).value,kt,30);return kt+"ms "+$t},toTransition:()=>{}};return Pt}mb.applyToOptions=i=>{const t=zP(i,100,mb);return i.ease=t.ease,i.duration=Tu(t.duration),i.type="keyframes",i};function Dx({keyframes:i,velocity:t=0,power:e=.8,timeConstant:n=325,bounceDamping:a=10,bounceStiffness:f=500,modifyTarget:m,min:l,max:w,restDelta:C=.5,restSpeed:P}){const L=i[0],j={done:!1,value:L},G=qt=>l!==void 0&&qt<l||w!==void 0&&qt>w,nt=qt=>l===void 0?w:w===void 0||Math.abs(l-qt)<Math.abs(w-qt)?l:w;let at=e*t;const J=L+at,mt=m===void 0?J:m(J);mt!==J&&(at=mt-L);const Mt=qt=>-at*Math.exp(-qt/n),pt=qt=>mt+Mt(qt),Pt=qt=>{const le=Mt(qt),Oe=pt(qt);j.done=Math.abs(le)<=C,j.value=j.done?mt:Oe};let kt,$t;const ae=qt=>{G(j.value)&&(kt=qt,$t=mb({keyframes:[j.value,nt(j.value)],velocity:WE(pt,qt,j.value),damping:a,stiffness:f,restDelta:C,restSpeed:P}))};return ae(0),{calculatedDuration:null,next:qt=>{let le=!1;return!$t&&kt===void 0&&(le=!0,Pt(qt),ae(qt)),kt!==void 0&&qt>=kt?$t.next(qt-kt):(!le&&Pt(qt),j)}}}function XP(i,t,e){const n=[],a=e||Lh.mix||$E,f=i.length-1;for(let m=0;m<f;m++){let l=a(i[m],i[m+1]);if(t){const w=Array.isArray(t)?t[m]||Il:t;l=Ry(w,l)}n.push(l)}return n}function ZP(i,t,{clamp:e=!0,ease:n,mixer:a}={}){const f=i.length;if(F1(f===t.length),f===1)return()=>t[0];if(f===2&&t[0]===t[1])return()=>t[1];const m=i[0]===i[1];i[0]>i[f-1]&&(i=[...i].reverse(),t=[...t].reverse());const l=XP(t,n,a),w=l.length,C=P=>{if(m&&P<i[0])return t[0];let L=0;if(w>1)for(;L<i.length-2&&!(P<i[L+1]);L++);const j=yy(i[L],i[L+1],P);return l[L](j)};return e?P=>C(Bh(i[0],i[f-1],P)):C}function GP(i,t){const e=i[i.length-1];for(let n=1;n<=t;n++){const a=yy(0,t,n);i.push(mr(e,1,a))}}function YP(i){const t=[0];return GP(t,i.length-1),t}function KP(i,t){return i.map(e=>e*t)}function QP(i,t){return i.map(()=>t||kE).splice(0,i.length-1)}function sy({duration:i=300,keyframes:t,times:e,ease:n="easeInOut"}){const a=cP(n)?n.map(CT):CT(n),f={done:!1,value:t[0]},m=KP(e&&e.length===t.length?e:YP(t),i),l=ZP(m,t,{ease:Array.isArray(a)?a:QP(t,a)});return{calculatedDuration:i,next:w=>(f.value=l(w),f.done=w>=i,f)}}const JP=i=>i!==null;function Z1(i,{repeat:t,repeatType:e="loop"},n,a=1){const f=i.filter(JP),l=a<0||t&&e!=="loop"&&t%2===1?0:f.length-1;return!l||n===void 0?f[l]:n}const tI={decay:Dx,inertia:Dx,tween:sy,keyframes:sy,spring:mb};function qE(i){typeof i.type=="string"&&(i.type=tI[i.type])}class G1{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,e){return this.finished.then(t,e)}}const eI=i=>i/100;class Y1 extends G1{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==ro.now()&&this.tick(ro.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;qE(t);const{type:e=sy,repeat:n=0,repeatDelay:a=0,repeatType:f,velocity:m=0}=t;let{keyframes:l}=t;const w=e||sy;w!==sy&&typeof l[0]!="number"&&(this.mixKeyframes=Ry(eI,$E(l[0],l[1])),l=[0,100]);const C=w({...t,keyframes:l});f==="mirror"&&(this.mirroredGenerator=w({...t,keyframes:[...l].reverse(),velocity:-m})),C.calculatedDuration===null&&(C.calculatedDuration=X1(C));const{calculatedDuration:P}=C;this.calculatedDuration=P,this.resolvedDuration=P+a,this.totalDuration=this.resolvedDuration*(n+1)-a,this.generator=C}updateTime(t){const e=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=e}tick(t,e=!1){const{generator:n,totalDuration:a,mixKeyframes:f,mirroredGenerator:m,resolvedDuration:l,calculatedDuration:w}=this;if(this.startTime===null)return n.next(0);const{delay:C=0,keyframes:P,repeat:L,repeatType:j,repeatDelay:G,type:nt,onUpdate:at,finalKeyframe:J}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),e?this.currentTime=t:this.updateTime(t);const mt=this.currentTime-C*(this.playbackSpeed>=0?1:-1),Mt=this.playbackSpeed>=0?mt<0:mt>a;this.currentTime=Math.max(mt,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let pt=this.currentTime,Pt=n;if(L){const qt=Math.min(this.currentTime,a)/l;let le=Math.floor(qt),Oe=qt%1;!Oe&&qt>=1&&(Oe=1),Oe===1&&le--,le=Math.min(le,L+1),!!(le%2)&&(j==="reverse"?(Oe=1-Oe,G&&(Oe-=G/l)):j==="mirror"&&(Pt=m)),pt=Bh(0,1,Oe)*l}const kt=Mt?{done:!1,value:P[0]}:Pt.next(pt);f&&(kt.value=f(kt.value));let{done:$t}=kt;!Mt&&w!==null&&($t=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const ae=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&$t);return ae&&nt!==Dx&&(kt.value=Z1(P,this.options,J,this.speed)),at&&at(kt.value),ae&&this.finish(),kt}then(t,e){return this.finished.then(t,e)}get duration(){return Ml(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Ml(t)}get time(){return Ml(this.currentTime)}set time(t){t=Tu(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(ro.now());const e=this.playbackSpeed!==t;this.playbackSpeed=t,e&&(this.time=Ml(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=NP,startTime:e}=this.options;this.driver||(this.driver=t(a=>this.tick(a))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=e??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ro.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function iI(i){for(let t=1;t<i.length;t++)i[t]??(i[t]=i[t-1])}const Sp=i=>i*180/Math.PI,kx=i=>{const t=Sp(Math.atan2(i[1],i[0]));return Ox(t)},nI={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:i=>(Math.abs(i[0])+Math.abs(i[3]))/2,rotate:kx,rotateZ:kx,skewX:i=>Sp(Math.atan(i[1])),skewY:i=>Sp(Math.atan(i[2])),skew:i=>(Math.abs(i[1])+Math.abs(i[2]))/2},Ox=i=>(i=i%360,i<0&&(i+=360),i),kT=kx,OT=i=>Math.sqrt(i[0]*i[0]+i[1]*i[1]),BT=i=>Math.sqrt(i[4]*i[4]+i[5]*i[5]),rI={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:OT,scaleY:BT,scale:i=>(OT(i)+BT(i))/2,rotateX:i=>Ox(Sp(Math.atan2(i[6],i[5]))),rotateY:i=>Ox(Sp(Math.atan2(-i[2],i[0]))),rotateZ:kT,rotate:kT,skewX:i=>Sp(Math.atan(i[4])),skewY:i=>Sp(Math.atan(i[1])),skew:i=>(Math.abs(i[1])+Math.abs(i[4]))/2};function Bx(i){return i.includes("scale")?1:0}function Lx(i,t){if(!i||i==="none")return Bx(t);const e=i.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,a;if(e)n=rI,a=e;else{const l=i.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=nI,a=l}if(!a)return Bx(t);const f=n[t],m=a[1].split(",").map(aI);return typeof f=="function"?f(m):m[f]}const sI=(i,t)=>{const{transform:e="none"}=getComputedStyle(i);return Lx(e,t)};function aI(i){return parseFloat(i.trim())}const Gg=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Yg=new Set(Gg),LT=i=>i===Zg||i===di,oI=new Set(["x","y","z"]),lI=Gg.filter(i=>!oI.has(i));function cI(i){const t=[];return lI.forEach(e=>{const n=i.getValue(e);n!==void 0&&(t.push([e,n.get()]),n.set(e.startsWith("scale")?1:0))}),t}const Mp={width:({x:i},{paddingLeft:t="0",paddingRight:e="0"})=>i.max-i.min-parseFloat(t)-parseFloat(e),height:({y:i},{paddingTop:t="0",paddingBottom:e="0"})=>i.max-i.min-parseFloat(t)-parseFloat(e),top:(i,{top:t})=>parseFloat(t),left:(i,{left:t})=>parseFloat(t),bottom:({y:i},{top:t})=>parseFloat(t)+(i.max-i.min),right:({x:i},{left:t})=>parseFloat(t)+(i.max-i.min),x:(i,{transform:t})=>Lx(t,"x"),y:(i,{transform:t})=>Lx(t,"y")};Mp.translateX=Mp.x;Mp.translateY=Mp.y;const Rp=new Set;let Fx=!1,Nx=!1,zx=!1;function XE(){if(Nx){const i=Array.from(Rp).filter(n=>n.needsMeasurement),t=new Set(i.map(n=>n.element)),e=new Map;t.forEach(n=>{const a=cI(n);a.length&&(e.set(n,a),n.render())}),i.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const a=e.get(n);a&&a.forEach(([f,m])=>{n.getValue(f)?.set(m)})}),i.forEach(n=>n.measureEndState()),i.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Nx=!1,Fx=!1,Rp.forEach(i=>i.complete(zx)),Rp.clear()}function ZE(){Rp.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(Nx=!0)})}function uI(){zx=!0,ZE(),XE(),zx=!1}class K1{constructor(t,e,n,a,f,m=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=e,this.name=n,this.motionValue=a,this.element=f,this.isAsync=m}scheduleResolve(){this.state="scheduled",this.isAsync?(Rp.add(this),Fx||(Fx=!0,rr.read(ZE),rr.resolveKeyframes(XE))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:e,element:n,motionValue:a}=this;if(t[0]===null){const f=a?.get(),m=t[t.length-1];if(f!==void 0)t[0]=f;else if(n&&e){const l=n.readValue(e,m);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=m),a&&f===void 0&&a.set(t[0])}iI(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Rp.delete(this)}cancel(){this.state==="scheduled"&&(Rp.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const hI=i=>i.startsWith("--");function fI(i,t,e){hI(t)?i.style.setProperty(t,e):i.style[t]=e}const dI=N1(()=>window.ScrollTimeline!==void 0),pI={};function mI(i,t){const e=N1(i);return()=>pI[t]??e()}const GE=mI(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Q_=([i,t,e,n])=>`cubic-bezier(${i}, ${t}, ${e}, ${n})`,FT={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Q_([0,.65,.55,1]),circOut:Q_([.55,0,1,.45]),backIn:Q_([.31,.01,.66,-.59]),backOut:Q_([.33,1.53,.69,.99])};function YE(i,t){if(i)return typeof i=="function"?GE()?HE(i,t):"ease-out":OE(i)?Q_(i):Array.isArray(i)?i.map(e=>YE(e,t)||FT.easeOut):FT[i]}function gI(i,t,e,{delay:n=0,duration:a=300,repeat:f=0,repeatType:m="loop",ease:l="easeOut",times:w}={},C=void 0){const P={[t]:e};w&&(P.offset=w);const L=YE(l,a);Array.isArray(L)&&(P.easing=L);const j={delay:n,duration:a,easing:Array.isArray(L)?"linear":L,fill:"both",iterations:f+1,direction:m==="reverse"?"alternate":"normal"};return C&&(j.pseudoElement=C),i.animate(P,j)}function KE(i){return typeof i=="function"&&"applyToOptions"in i}function _I({type:i,...t}){return KE(i)&&GE()?i.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class yI extends G1{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:e,name:n,keyframes:a,pseudoElement:f,allowFlatten:m=!1,finalKeyframe:l,onComplete:w}=t;this.isPseudoElement=!!f,this.allowFlatten=m,this.options=t,F1(typeof t.type!="string");const C=_I(t);this.animation=gI(e,n,a,C,f),C.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!f){const P=Z1(a,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(P):fI(e,n,P),this.animation.cancel()}w?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return Ml(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Ml(t)}get time(){return Ml(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=Tu(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:e}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&dI()?(this.animation.timeline=t,Il):e(this)}}const QE={anticipate:PE,backInOut:RE,circInOut:DE};function vI(i){return i in QE}function bI(i){typeof i.ease=="string"&&vI(i.ease)&&(i.ease=QE[i.ease])}const NT=10;class xI extends yI{constructor(t){bI(t),qE(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:e,onUpdate:n,onComplete:a,element:f,...m}=this.options;if(!e)return;if(t!==void 0){e.set(t);return}const l=new Y1({...m,autoplay:!1}),w=Tu(this.finishedTime??this.time);e.setWithVelocity(l.sample(w-NT).value,l.sample(w).value,NT),l.stop()}}const zT=(i,t)=>t==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(Kf.test(i)||i==="0")&&!i.startsWith("url("));function wI(i){const t=i[0];if(i.length===1)return!0;for(let e=0;e<i.length;e++)if(i[e]!==t)return!0}function TI(i,t,e,n){const a=i[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const f=i[i.length-1],m=zT(a,t),l=zT(f,t);return!m||!l?!1:wI(i)||(e==="spring"||KE(e))&&n}function Ux(i){i.duration=0,i.type="keyframes"}const SI=new Set(["opacity","clipPath","filter","transform"]),AI=N1(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function EI(i){const{motionValue:t,name:e,repeatDelay:n,repeatType:a,damping:f,type:m}=i;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:w,transformTemplate:C}=t.owner.getProps();return AI()&&e&&SI.has(e)&&(e!=="transform"||!C)&&!w&&!n&&a!=="mirror"&&f!==0&&m!=="inertia"}const CI=40;class MI extends G1{constructor({autoplay:t=!0,delay:e=0,type:n="keyframes",repeat:a=0,repeatDelay:f=0,repeatType:m="loop",keyframes:l,name:w,motionValue:C,element:P,...L}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=ro.now();const j={autoplay:t,delay:e,type:n,repeat:a,repeatDelay:f,repeatType:m,name:w,motionValue:C,element:P,...L},G=P?.KeyframeResolver||K1;this.keyframeResolver=new G(l,(nt,at,J)=>this.onKeyframesResolved(nt,at,j,!J),w,C,P),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,e,n,a){this.keyframeResolver=void 0;const{name:f,type:m,velocity:l,delay:w,isHandoff:C,onUpdate:P}=n;this.resolvedAt=ro.now(),TI(t,f,m,l)||((Lh.instantAnimations||!w)&&P?.(Z1(t,n,e)),t[0]=t[t.length-1],Ux(n),n.repeat=0);const j={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>CI?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:e,...n,keyframes:t},G=!C&&EI(j)?new xI({...j,element:j.motionValue.owner.current}):new Y1(j);G.finished.then(()=>this.notifyFinished()).catch(Il),this.pendingTimeline&&(this.stopTimeline=G.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=G}get finished(){return this._animation?this.animation.finished:this._finished}then(t,e){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),uI()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const RI=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function PI(i){const t=RI.exec(i);if(!t)return[,];const[,e,n,a]=t;return[`--${e??n}`,a]}function JE(i,t,e=1){const[n,a]=PI(i);if(!n)return;const f=window.getComputedStyle(t).getPropertyValue(n);if(f){const m=f.trim();return xE(m)?parseFloat(m):m}return $1(a)?JE(a,t,e+1):a}function Q1(i,t){return i?.[t]??i?.default??i}const t3=new Set(["width","height","top","left","right","bottom",...Gg]),II={test:i=>i==="auto",parse:i=>i},e3=i=>t=>t.test(i),i3=[Zg,di,Su,jf,wP,xP,II],UT=i=>i3.find(e3(i));function DI(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||TE(i):!0}const kI=new Set(["brightness","contrast","saturate","opacity"]);function OI(i){const[t,e]=i.slice(0,-1).split("(");if(t==="drop-shadow")return i;const[n]=e.match(H1)||[];if(!n)return i;const a=e.replace(n,"");let f=kI.has(t)?1:0;return n!==e&&(f*=100),t+"("+f+a+")"}const BI=/\b([a-z-]*)\(.*?\)/gu,Vx={...Kf,getAnimatableNone:i=>{const t=i.match(BI);return t?t.map(OI).join(" "):i}},VT={...Zg,transform:Math.round},LI={rotate:jf,rotateX:jf,rotateY:jf,rotateZ:jf,scale:Lv,scaleX:Lv,scaleY:Lv,scaleZ:Lv,skew:jf,skewX:jf,skewY:jf,distance:di,translateX:di,translateY:di,translateZ:di,x:di,y:di,z:di,perspective:di,transformPerspective:di,opacity:vy,originX:MT,originY:MT,originZ:di},J1={borderWidth:di,borderTopWidth:di,borderRightWidth:di,borderBottomWidth:di,borderLeftWidth:di,borderRadius:di,radius:di,borderTopLeftRadius:di,borderTopRightRadius:di,borderBottomRightRadius:di,borderBottomLeftRadius:di,width:di,maxWidth:di,height:di,maxHeight:di,top:di,right:di,bottom:di,left:di,padding:di,paddingTop:di,paddingRight:di,paddingBottom:di,paddingLeft:di,margin:di,marginTop:di,marginRight:di,marginBottom:di,marginLeft:di,backgroundPositionX:di,backgroundPositionY:di,...LI,zIndex:VT,fillOpacity:vy,strokeOpacity:vy,numOctaves:VT},FI={...J1,color:Qr,backgroundColor:Qr,outlineColor:Qr,fill:Qr,stroke:Qr,borderColor:Qr,borderTopColor:Qr,borderRightColor:Qr,borderBottomColor:Qr,borderLeftColor:Qr,filter:Vx,WebkitFilter:Vx},n3=i=>FI[i];function r3(i,t){let e=n3(i);return e!==Vx&&(e=Kf),e.getAnimatableNone?e.getAnimatableNone(t):void 0}const NI=new Set(["auto","none","0"]);function zI(i,t,e){let n=0,a;for(;n<i.length&&!a;){const f=i[n];typeof f=="string"&&!NI.has(f)&&by(f).values.length&&(a=i[n]),n++}if(a&&e)for(const f of t)i[f]=r3(e,a)}class UI extends K1{constructor(t,e,n,a,f){super(t,e,n,a,f,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:e,name:n}=this;if(!e||!e.current)return;super.readKeyframes();for(let w=0;w<t.length;w++){let C=t[w];if(typeof C=="string"&&(C=C.trim(),$1(C))){const P=JE(C,e.current);P!==void 0&&(t[w]=P),w===t.length-1&&(this.finalKeyframe=C)}}if(this.resolveNoneKeyframes(),!t3.has(n)||t.length!==2)return;const[a,f]=t,m=UT(a),l=UT(f);if(m!==l)if(LT(m)&&LT(l))for(let w=0;w<t.length;w++){const C=t[w];typeof C=="string"&&(t[w]=parseFloat(C))}else Mp[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:e}=this,n=[];for(let a=0;a<t.length;a++)(t[a]===null||DI(t[a]))&&n.push(a);n.length&&zI(t,n,e)}measureInitialState(){const{element:t,unresolvedKeyframes:e,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Mp[n](t.measureViewportBox(),window.getComputedStyle(t.current)),e[0]=this.measuredOrigin;const a=e[e.length-1];a!==void 0&&t.getValue(n,a).jump(a,!1)}measureEndState(){const{element:t,name:e,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const a=t.getValue(e);a&&a.jump(this.measuredOrigin,!1);const f=n.length-1,m=n[f];n[f]=Mp[e](t.measureViewportBox(),window.getComputedStyle(t.current)),m!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=m),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,w])=>{t.getValue(l).set(w)}),this.resolveNoneKeyframes()}}function VI(i,t,e){if(i instanceof EventTarget)return[i];if(typeof i=="string"){let n=document;const a=e?.[i]??n.querySelectorAll(i);return a?Array.from(a):[]}return Array.from(i)}const s3=(i,t)=>t&&typeof i=="number"?t.transform(i):i;function jI(i){return wE(i)&&"offsetHeight"in i}const jT=30,$I=i=>!isNaN(parseFloat(i));class HI{constructor(t,e={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const a=ro.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const f of this.dependents)f.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=e.owner}setCurrent(t){this.current=t,this.updatedAt=ro.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=$I(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,e){this.events[t]||(this.events[t]=new z1);const n=this.events[t].add(e);return t==="change"?()=>{n(),rr.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,e){this.passiveEffect=t,this.stopPassiveEffect=e}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,e,n){this.set(e),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,e=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,e&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=ro.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>jT)return 0;const e=Math.min(this.updatedAt-this.prevUpdatedAt,jT);return SE(parseFloat(this.current)-parseFloat(this.prevFrameValue),e)}start(t){return this.stop(),new Promise(e=>{this.hasAnimated=!0,this.animation=t(e),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Lg(i,t){return new HI(i,t)}const{schedule:tw}=BE(queueMicrotask,!1),Rc={x:!1,y:!1};function a3(){return Rc.x||Rc.y}function WI(i){return i==="x"||i==="y"?Rc[i]?null:(Rc[i]=!0,()=>{Rc[i]=!1}):Rc.x||Rc.y?null:(Rc.x=Rc.y=!0,()=>{Rc.x=Rc.y=!1})}function o3(i,t){const e=VI(i),n=new AbortController,a={passive:!0,...t,signal:n.signal};return[e,a,()=>n.abort()]}function $T(i){return!(i.pointerType==="touch"||a3())}function qI(i,t,e={}){const[n,a,f]=o3(i,e),m=l=>{if(!$T(l))return;const{target:w}=l,C=t(w,l);if(typeof C!="function"||!w)return;const P=L=>{$T(L)&&(C(L),w.removeEventListener("pointerleave",P))};w.addEventListener("pointerleave",P,a)};return n.forEach(l=>{l.addEventListener("pointerenter",m,a)}),f}const l3=(i,t)=>t?i===t?!0:l3(i,t.parentElement):!1,ew=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,XI=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function ZI(i){return XI.has(i.tagName)||i.tabIndex!==-1}const ib=new WeakSet;function HT(i){return t=>{t.key==="Enter"&&i(t)}}function O0(i,t){i.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const GI=(i,t)=>{const e=i.currentTarget;if(!e)return;const n=HT(()=>{if(ib.has(e))return;O0(e,"down");const a=HT(()=>{O0(e,"up")}),f=()=>O0(e,"cancel");e.addEventListener("keyup",a,t),e.addEventListener("blur",f,t)});e.addEventListener("keydown",n,t),e.addEventListener("blur",()=>e.removeEventListener("keydown",n),t)};function WT(i){return ew(i)&&!a3()}function YI(i,t,e={}){const[n,a,f]=o3(i,e),m=l=>{const w=l.currentTarget;if(!WT(l))return;ib.add(w);const C=t(w,l),P=(G,nt)=>{window.removeEventListener("pointerup",L),window.removeEventListener("pointercancel",j),ib.has(w)&&ib.delete(w),WT(G)&&typeof C=="function"&&C(G,{success:nt})},L=G=>{P(G,w===window||w===document||e.useGlobalTarget||l3(w,G.target))},j=G=>{P(G,!1)};window.addEventListener("pointerup",L,a),window.addEventListener("pointercancel",j,a)};return n.forEach(l=>{(e.useGlobalTarget?window:l).addEventListener("pointerdown",m,a),jI(l)&&(l.addEventListener("focus",C=>GI(C,a)),!ZI(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),f}function c3(i){return wE(i)&&"ownerSVGElement"in i}function KI(i){return c3(i)&&i.tagName==="svg"}const sa=i=>!!(i&&i.getVelocity),QI=[...i3,Qr,Kf],JI=i=>QI.find(e3(i)),u3=me.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});function tD(i=!0){const t=me.useContext(O1);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:n,register:a}=t,f=me.useId();me.useEffect(()=>{if(i)return a(f)},[i]);const m=me.useCallback(()=>i&&n&&n(f),[f,n,i]);return!e&&n?[!1,m]:[!0]}const h3=me.createContext({strict:!1}),qT={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Fg={};for(const i in qT)Fg[i]={isEnabled:t=>qT[i].some(e=>!!t[e])};function eD(i){for(const t in i)Fg[t]={...Fg[t],...i[t]}}const iD=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function gb(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||iD.has(i)}let f3=i=>!gb(i);function nD(i){typeof i=="function"&&(f3=t=>t.startsWith("on")?!gb(t):i(t))}try{nD(require("@emotion/is-prop-valid").default)}catch{}function rD(i,t,e){const n={};for(const a in i)a==="values"&&typeof i.values=="object"||(f3(a)||e===!0&&gb(a)||!t&&!gb(a)||i.draggable&&a.startsWith("onDrag"))&&(n[a]=i[a]);return n}const $b=me.createContext({});function Hb(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}function xy(i){return typeof i=="string"||Array.isArray(i)}const iw=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],nw=["initial",...iw];function Wb(i){return Hb(i.animate)||nw.some(t=>xy(i[t]))}function d3(i){return!!(Wb(i)||i.variants)}function sD(i,t){if(Wb(i)){const{initial:e,animate:n}=i;return{initial:e===!1||xy(e)?e:void 0,animate:xy(n)?n:void 0}}return i.inherit!==!1?t:{}}function aD(i){const{initial:t,animate:e}=sD(i,me.useContext($b));return me.useMemo(()=>({initial:t,animate:e}),[XT(t),XT(e)])}function XT(i){return Array.isArray(i)?i.join(" "):i}const wy={};function oD(i){for(const t in i)wy[t]=i[t],j1(t)&&(wy[t].isCSSVariable=!0)}function p3(i,{layout:t,layoutId:e}){return Yg.has(i)||i.startsWith("origin")||(t||e!==void 0)&&(!!wy[i]||i==="opacity")}const lD={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},cD=Gg.length;function uD(i,t,e){let n="",a=!0;for(let f=0;f<cD;f++){const m=Gg[f],l=i[m];if(l===void 0)continue;let w=!0;if(typeof l=="number"?w=l===(m.startsWith("scale")?1:0):w=parseFloat(l)===0,!w||e){const C=s3(l,J1[m]);if(!w){a=!1;const P=lD[m]||m;n+=`${P}(${C}) `}e&&(t[m]=C)}}return n=n.trim(),e?n=e(t,a?"":n):a&&(n="none"),n}function rw(i,t,e){const{style:n,vars:a,transformOrigin:f}=i;let m=!1,l=!1;for(const w in t){const C=t[w];if(Yg.has(w)){m=!0;continue}else if(j1(w)){a[w]=C;continue}else{const P=s3(C,J1[w]);w.startsWith("origin")?(l=!0,f[w]=P):n[w]=P}}if(t.transform||(m||e?n.transform=uD(t,i.transform,e):n.transform&&(n.transform="none")),l){const{originX:w="50%",originY:C="50%",originZ:P=0}=f;n.transformOrigin=`${w} ${C} ${P}`}}const sw=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function m3(i,t,e){for(const n in t)!sa(t[n])&&!p3(n,e)&&(i[n]=t[n])}function hD({transformTemplate:i},t){return me.useMemo(()=>{const e=sw();return rw(e,t,i),Object.assign({},e.vars,e.style)},[t])}function fD(i,t){const e=i.style||{},n={};return m3(n,e,i),Object.assign(n,hD(i,t)),n}function dD(i,t){const e={},n=fD(i,t);return i.drag&&i.dragListener!==!1&&(e.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(e.tabIndex=0),e.style=n,e}const pD={offset:"stroke-dashoffset",array:"stroke-dasharray"},mD={offset:"strokeDashoffset",array:"strokeDasharray"};function gD(i,t,e=1,n=0,a=!0){i.pathLength=1;const f=a?pD:mD;i[f.offset]=di.transform(-n);const m=di.transform(t),l=di.transform(e);i[f.array]=`${m} ${l}`}function g3(i,{attrX:t,attrY:e,attrScale:n,pathLength:a,pathSpacing:f=1,pathOffset:m=0,...l},w,C,P){if(rw(i,l,C),w){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:L,style:j}=i;L.transform&&(j.transform=L.transform,delete L.transform),(j.transform||L.transformOrigin)&&(j.transformOrigin=L.transformOrigin??"50% 50%",delete L.transformOrigin),j.transform&&(j.transformBox=P?.transformBox??"fill-box",delete L.transformBox),t!==void 0&&(L.x=t),e!==void 0&&(L.y=e),n!==void 0&&(L.scale=n),a!==void 0&&gD(L,a,f,m,!1)}const _3=()=>({...sw(),attrs:{}}),y3=i=>typeof i=="string"&&i.toLowerCase()==="svg";function _D(i,t,e,n){const a=me.useMemo(()=>{const f=_3();return g3(f,t,y3(n),i.transformTemplate,i.style),{...f.attrs,style:{...f.style}}},[t]);if(i.style){const f={};m3(f,i.style,i),a.style={...f,...a.style}}return a}const yD=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function aw(i){return typeof i!="string"||i.includes("-")?!1:!!(yD.indexOf(i)>-1||/[A-Z]/u.test(i))}function vD(i,t,e,{latestValues:n},a,f=!1){const l=(aw(i)?_D:dD)(t,n,a,i),w=rD(t,typeof i=="string",f),C=i!==me.Fragment?{...w,...l,ref:e}:{},{children:P}=t,L=me.useMemo(()=>sa(P)?P.get():P,[P]);return me.createElement(i,{...C,children:L})}function ZT(i){const t=[{},{}];return i?.values.forEach((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()}),t}function ow(i,t,e,n){if(typeof t=="function"){const[a,f]=ZT(n);t=t(e!==void 0?e:i.custom,a,f)}if(typeof t=="string"&&(t=i.variants&&i.variants[t]),typeof t=="function"){const[a,f]=ZT(n);t=t(e!==void 0?e:i.custom,a,f)}return t}function nb(i){return sa(i)?i.get():i}function bD({scrapeMotionValuesFromProps:i,createRenderState:t},e,n,a){return{latestValues:xD(e,n,a,i),renderState:t()}}function xD(i,t,e,n){const a={},f=n(i,{});for(const j in f)a[j]=nb(f[j]);let{initial:m,animate:l}=i;const w=Wb(i),C=d3(i);t&&C&&!w&&i.inherit!==!1&&(m===void 0&&(m=t.initial),l===void 0&&(l=t.animate));let P=e?e.initial===!1:!1;P=P||m===!1;const L=P?l:m;if(L&&typeof L!="boolean"&&!Hb(L)){const j=Array.isArray(L)?L:[L];for(let G=0;G<j.length;G++){const nt=ow(i,j[G]);if(nt){const{transitionEnd:at,transition:J,...mt}=nt;for(const Mt in mt){let pt=mt[Mt];if(Array.isArray(pt)){const Pt=P?pt.length-1:0;pt=pt[Pt]}pt!==null&&(a[Mt]=pt)}for(const Mt in at)a[Mt]=at[Mt]}}}return a}const v3=i=>(t,e)=>{const n=me.useContext($b),a=me.useContext(O1),f=()=>bD(i,t,n,a);return e?f():eP(f)};function lw(i,t,e){const{style:n}=i,a={};for(const f in n)(sa(n[f])||t.style&&sa(t.style[f])||p3(f,i)||e?.getValue(f)?.liveStyle!==void 0)&&(a[f]=n[f]);return a}const wD=v3({scrapeMotionValuesFromProps:lw,createRenderState:sw});function b3(i,t,e){const n=lw(i,t,e);for(const a in i)if(sa(i[a])||sa(t[a])){const f=Gg.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;n[f]=i[a]}return n}const TD=v3({scrapeMotionValuesFromProps:b3,createRenderState:_3}),SD=Symbol.for("motionComponentSymbol");function wg(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function AD(i,t,e){return me.useCallback(n=>{n&&i.onMount&&i.onMount(n),t&&(n?t.mount(n):t.unmount()),e&&(typeof e=="function"?e(n):wg(e)&&(e.current=n))},[t])}const cw=i=>i.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ED="framerAppearId",x3="data-"+cw(ED),w3=me.createContext({});function CD(i,t,e,n,a){const{visualElement:f}=me.useContext($b),m=me.useContext(h3),l=me.useContext(O1),w=me.useContext(u3).reducedMotion,C=me.useRef(null);n=n||m.renderer,!C.current&&n&&(C.current=n(i,{visualState:t,parent:f,props:e,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:w}));const P=C.current,L=me.useContext(w3);P&&!P.projection&&a&&(P.type==="html"||P.type==="svg")&&MD(C.current,e,a,L);const j=me.useRef(!1);me.useInsertionEffect(()=>{P&&j.current&&P.update(e,l)});const G=e[x3],nt=me.useRef(!!G&&!window.MotionHandoffIsComplete?.(G)&&window.MotionHasOptimisedAnimation?.(G));return iP(()=>{P&&(j.current=!0,window.MotionIsMounted=!0,P.updateFeatures(),P.scheduleRenderMicrotask(),nt.current&&P.animationState&&P.animationState.animateChanges())}),me.useEffect(()=>{P&&(!nt.current&&P.animationState&&P.animationState.animateChanges(),nt.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(G)}),nt.current=!1),P.enteringChildren=void 0)}),P}function MD(i,t,e,n){const{layoutId:a,layout:f,drag:m,dragConstraints:l,layoutScroll:w,layoutRoot:C,layoutCrossfade:P}=t;i.projection=new e(i.latestValues,t["data-framer-portal-id"]?void 0:T3(i.parent)),i.projection.setOptions({layoutId:a,layout:f,alwaysMeasureLayout:!!m||l&&wg(l),visualElement:i,animationType:typeof f=="string"?f:"both",initialPromotionConfig:n,crossfade:P,layoutScroll:w,layoutRoot:C})}function T3(i){if(i)return i.options.allowProjection!==!1?i.projection:T3(i.parent)}function B0(i,{forwardMotionProps:t=!1}={},e,n){e&&eD(e);const a=aw(i)?TD:wD;function f(l,w){let C;const P={...me.useContext(u3),...l,layoutId:RD(l)},{isStatic:L}=P,j=aD(l),G=a(l,L);if(!L&&k1){PD();const nt=ID(P);C=nt.MeasureLayout,j.visualElement=CD(i,G,P,n,nt.ProjectionNode)}return Mx.jsxs($b.Provider,{value:j,children:[C&&j.visualElement?Mx.jsx(C,{visualElement:j.visualElement,...P}):null,vD(i,l,AD(G,j.visualElement,w),G,L,t)]})}f.displayName=`motion.${typeof i=="string"?i:`create(${i.displayName??i.name??""})`}`;const m=me.forwardRef(f);return m[SD]=i,m}function RD({layoutId:i}){const t=me.useContext(bE).id;return t&&i!==void 0?t+"-"+i:i}function PD(i,t){me.useContext(h3).strict}function ID(i){const{drag:t,layout:e}=Fg;if(!t&&!e)return{};const n={...t,...e};return{MeasureLayout:t?.isEnabled(i)||e?.isEnabled(i)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function DD(i,t){if(typeof Proxy>"u")return B0;const e=new Map,n=(f,m)=>B0(f,m,i,t),a=(f,m)=>n(f,m);return new Proxy(a,{get:(f,m)=>m==="create"?n:(e.has(m)||e.set(m,B0(m,void 0,i,t)),e.get(m))})}function S3({top:i,left:t,right:e,bottom:n}){return{x:{min:t,max:e},y:{min:i,max:n}}}function kD({x:i,y:t}){return{top:t.min,right:i.max,bottom:t.max,left:i.min}}function OD(i,t){if(!t)return i;const e=t({x:i.left,y:i.top}),n=t({x:i.right,y:i.bottom});return{top:e.y,left:e.x,bottom:n.y,right:n.x}}function L0(i){return i===void 0||i===1}function jx({scale:i,scaleX:t,scaleY:e}){return!L0(i)||!L0(t)||!L0(e)}function xp(i){return jx(i)||A3(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function A3(i){return GT(i.x)||GT(i.y)}function GT(i){return i&&i!=="0%"}function _b(i,t,e){const n=i-e,a=t*n;return e+a}function YT(i,t,e,n,a){return a!==void 0&&(i=_b(i,a,n)),_b(i,e,n)+t}function $x(i,t=0,e=1,n,a){i.min=YT(i.min,t,e,n,a),i.max=YT(i.max,t,e,n,a)}function E3(i,{x:t,y:e}){$x(i.x,t.translate,t.scale,t.originPoint),$x(i.y,e.translate,e.scale,e.originPoint)}const KT=.999999999999,QT=1.0000000000001;function BD(i,t,e,n=!1){const a=e.length;if(!a)return;t.x=t.y=1;let f,m;for(let l=0;l<a;l++){f=e[l],m=f.projectionDelta;const{visualElement:w}=f.options;w&&w.props.style&&w.props.style.display==="contents"||(n&&f.options.layoutScroll&&f.scroll&&f!==f.root&&Sg(i,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),m&&(t.x*=m.x.scale,t.y*=m.y.scale,E3(i,m)),n&&xp(f.latestValues)&&Sg(i,f.latestValues))}t.x<QT&&t.x>KT&&(t.x=1),t.y<QT&&t.y>KT&&(t.y=1)}function Tg(i,t){i.min=i.min+t,i.max=i.max+t}function JT(i,t,e,n,a=.5){const f=mr(i.min,i.max,a);$x(i,t,e,f,n)}function Sg(i,t){JT(i.x,t.x,t.scaleX,t.scale,t.originX),JT(i.y,t.y,t.scaleY,t.scale,t.originY)}function C3(i,t){return S3(OD(i.getBoundingClientRect(),t))}function LD(i,t,e){const n=C3(i,e),{scroll:a}=t;return a&&(Tg(n.x,a.offset.x),Tg(n.y,a.offset.y)),n}const t2=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ag=()=>({x:t2(),y:t2()}),e2=()=>({min:0,max:0}),zr=()=>({x:e2(),y:e2()}),Hx={current:null},M3={current:!1};function FD(){if(M3.current=!0,!!k1)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),t=()=>Hx.current=i.matches;i.addEventListener("change",t),t()}else Hx.current=!1}const ND=new WeakMap;function zD(i,t,e){for(const n in t){const a=t[n],f=e[n];if(sa(a))i.addValue(n,a);else if(sa(f))i.addValue(n,Lg(a,{owner:i}));else if(f!==a)if(i.hasValue(n)){const m=i.getValue(n);m.liveStyle===!0?m.jump(a):m.hasAnimated||m.set(a)}else{const m=i.getStaticValue(n);i.addValue(n,Lg(m!==void 0?m:a,{owner:i}))}}for(const n in e)t[n]===void 0&&i.removeValue(n);return t}const i2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class UD{scrapeMotionValuesFromProps(t,e,n){return{}}constructor({parent:t,props:e,presenceContext:n,reducedMotionConfig:a,blockInitialAnimation:f,visualState:m},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=K1,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const j=ro.now();this.renderScheduledAt<j&&(this.renderScheduledAt=j,rr.render(this.render,!1,!0))};const{latestValues:w,renderState:C}=m;this.latestValues=w,this.baseTarget={...w},this.initialValues=e.initial?{...w}:{},this.renderState=C,this.parent=t,this.props=e,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.options=l,this.blockInitialAnimation=!!f,this.isControllingVariants=Wb(e),this.isVariantNode=d3(e),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:P,...L}=this.scrapeMotionValuesFromProps(e,{},this);for(const j in L){const G=L[j];w[j]!==void 0&&sa(G)&&G.set(w[j])}}mount(t){this.current=t,ND.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,n)=>this.bindToMotionValue(n,e)),M3.current||FD(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Hx.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Yf(this.notifyUpdate),Yf(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const e=this.features[t];e&&(e.unmount(),e.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,e){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=Yg.has(t);n&&this.onBindTransform&&this.onBindTransform();const a=e.on("change",m=>{this.latestValues[t]=m,this.props.onUpdate&&rr.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,e)),this.valueSubscriptions.set(t,()=>{a(),f&&f(),e.owner&&e.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Fg){const e=Fg[t];if(!e)continue;const{isEnabled:n,Feature:a}=e;if(!this.features[t]&&a&&n(this.props)&&(this.features[t]=new a(this)),this.features[t]){const f=this.features[t];f.isMounted?f.update():(f.mount(),f.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):zr()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,e){this.latestValues[t]=e}update(t,e){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=e;for(let n=0;n<i2.length;n++){const a=i2[n];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const f="on"+a,m=t[f];m&&(this.propEventSubscriptions[a]=this.on(a,m))}this.prevMotionValues=zD(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const e=this.getClosestVariantNode();if(e)return e.variantChildren&&e.variantChildren.add(t),()=>e.variantChildren.delete(t)}addValue(t,e){const n=this.values.get(t);e!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,e),this.values.set(t,e),this.latestValues[t]=e.get())}removeValue(t){this.values.delete(t);const e=this.valueSubscriptions.get(t);e&&(e(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,e){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&e!==void 0&&(n=Lg(e===null?void 0:e,{owner:this}),this.addValue(t,n)),n}readValue(t,e){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(xE(n)||TE(n))?n=parseFloat(n):!JI(n)&&Kf.test(e)&&(n=r3(t,e)),this.setBaseTarget(t,sa(n)?n.get():n)),sa(n)?n.get():n}setBaseTarget(t,e){this.baseTarget[t]=e}getBaseTarget(t){const{initial:e}=this.props;let n;if(typeof e=="string"||typeof e=="object"){const f=ow(this.props,e,this.presenceContext?.custom);f&&(n=f[t])}if(e&&n!==void 0)return n;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!sa(a)?a:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,e){return this.events[t]||(this.events[t]=new z1),this.events[t].add(e)}notify(t,...e){this.events[t]&&this.events[t].notify(...e)}scheduleRenderMicrotask(){tw.render(this.render)}}class R3 extends UD{constructor(){super(...arguments),this.KeyframeResolver=UI}sortInstanceNodePosition(t,e){return t.compareDocumentPosition(e)&2?1:-1}getBaseTargetFromProps(t,e){return t.style?t.style[e]:void 0}removeValueFromRenderState(t,{vars:e,style:n}){delete e[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;sa(t)&&(this.childSubscription=t.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}function P3(i,{style:t,vars:e},n,a){const f=i.style;let m;for(m in t)f[m]=t[m];a?.applyProjectionStyles(f,n);for(m in e)f.setProperty(m,e[m])}function VD(i){return window.getComputedStyle(i)}class jD extends R3{constructor(){super(...arguments),this.type="html",this.renderInstance=P3}readValueFromInstance(t,e){if(Yg.has(e))return this.projection?.isProjecting?Bx(e):sI(t,e);{const n=VD(t),a=(j1(e)?n.getPropertyValue(e):n[e])||0;return typeof a=="string"?a.trim():a}}measureInstanceViewportBox(t,{transformPagePoint:e}){return C3(t,e)}build(t,e,n){rw(t,e,n.transformTemplate)}scrapeMotionValuesFromProps(t,e,n){return lw(t,e,n)}}const I3=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function $D(i,t,e,n){P3(i,t,void 0,n);for(const a in t.attrs)i.setAttribute(I3.has(a)?a:cw(a),t.attrs[a])}class HD extends R3{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=zr}getBaseTargetFromProps(t,e){return t[e]}readValueFromInstance(t,e){if(Yg.has(e)){const n=n3(e);return n&&n.default||0}return e=I3.has(e)?e:cw(e),t.getAttribute(e)}scrapeMotionValuesFromProps(t,e,n){return b3(t,e,n)}build(t,e,n){g3(t,e,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,e,n,a){$D(t,e,n,a)}mount(t){this.isSVGTag=y3(t.tagName),super.mount(t)}}const WD=(i,t)=>aw(i)?new HD(t):new jD(t,{allowProjection:i!==me.Fragment});function Ig(i,t,e){const n=i.getProps();return ow(n,t,e!==void 0?e:n.custom,i)}const Wx=i=>Array.isArray(i);function qD(i,t,e){i.hasValue(t)?i.getValue(t).set(e):i.addValue(t,Lg(e))}function XD(i){return Wx(i)?i[i.length-1]||0:i}function ZD(i,t){const e=Ig(i,t);let{transitionEnd:n={},transition:a={},...f}=e||{};f={...f,...n};for(const m in f){const l=XD(f[m]);qD(i,m,l)}}function GD(i){return!!(sa(i)&&i.add)}function qx(i,t){const e=i.getValue("willChange");if(GD(e))return e.add(t);if(!e&&Lh.WillChange){const n=new Lh.WillChange("auto");i.addValue("willChange",n),n.add(t)}}function D3(i){return i.props[x3]}const YD=i=>i!==null;function KD(i,{repeat:t,repeatType:e="loop"},n){const a=i.filter(YD),f=t&&e!=="loop"&&t%2===1?0:a.length-1;return a[f]}const QD={type:"spring",stiffness:500,damping:25,restSpeed:10},JD=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),tk={type:"keyframes",duration:.8},ek={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ik=(i,{keyframes:t})=>t.length>2?tk:Yg.has(i)?i.startsWith("scale")?JD(t[1]):QD:ek;function nk({when:i,delay:t,delayChildren:e,staggerChildren:n,staggerDirection:a,repeat:f,repeatType:m,repeatDelay:l,from:w,elapsed:C,...P}){return!!Object.keys(P).length}const uw=(i,t,e,n={},a,f)=>m=>{const l=Q1(n,i)||{},w=l.delay||n.delay||0;let{elapsed:C=0}=n;C=C-Tu(w);const P={keyframes:Array.isArray(e)?e:[null,e],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-C,onUpdate:j=>{t.set(j),l.onUpdate&&l.onUpdate(j)},onComplete:()=>{m(),l.onComplete&&l.onComplete()},name:i,motionValue:t,element:f?void 0:a};nk(l)||Object.assign(P,ik(i,P)),P.duration&&(P.duration=Tu(P.duration)),P.repeatDelay&&(P.repeatDelay=Tu(P.repeatDelay)),P.from!==void 0&&(P.keyframes[0]=P.from);let L=!1;if((P.type===!1||P.duration===0&&!P.repeatDelay)&&(Ux(P),P.delay===0&&(L=!0)),(Lh.instantAnimations||Lh.skipAnimations)&&(L=!0,Ux(P),P.delay=0),P.allowFlatten=!l.type&&!l.ease,L&&!f&&t.get()!==void 0){const j=KD(P.keyframes,l);if(j!==void 0){rr.update(()=>{P.onUpdate(j),P.onComplete()});return}}return l.isSync?new Y1(P):new MI(P)};function rk({protectedKeys:i,needsAnimating:t},e){const n=i.hasOwnProperty(e)&&t[e]!==!0;return t[e]=!1,n}function k3(i,t,{delay:e=0,transitionOverride:n,type:a}={}){let{transition:f=i.getDefaultTransition(),transitionEnd:m,...l}=t;n&&(f=n);const w=[],C=a&&i.animationState&&i.animationState.getState()[a];for(const P in l){const L=i.getValue(P,i.latestValues[P]??null),j=l[P];if(j===void 0||C&&rk(C,P))continue;const G={delay:e,...Q1(f||{},P)},nt=L.get();if(nt!==void 0&&!L.isAnimating&&!Array.isArray(j)&&j===nt&&!G.velocity)continue;let at=!1;if(window.MotionHandoffAnimation){const mt=D3(i);if(mt){const Mt=window.MotionHandoffAnimation(mt,P,rr);Mt!==null&&(G.startTime=Mt,at=!0)}}qx(i,P),L.start(uw(P,L,j,i.shouldReduceMotion&&t3.has(P)?{type:!1}:G,i,at));const J=L.animation;J&&w.push(J)}return m&&Promise.all(w).then(()=>{rr.update(()=>{m&&ZD(i,m)})}),w}function O3(i,t,e,n=0,a=1){const f=Array.from(i).sort((C,P)=>C.sortNodePosition(P)).indexOf(t),m=i.size,l=(m-1)*n;return typeof e=="function"?e(f,m):a===1?f*n:l-f*n}function Xx(i,t,e={}){const n=Ig(i,t,e.type==="exit"?i.presenceContext?.custom:void 0);let{transition:a=i.getDefaultTransition()||{}}=n||{};e.transitionOverride&&(a=e.transitionOverride);const f=n?()=>Promise.all(k3(i,n,e)):()=>Promise.resolve(),m=i.variantChildren&&i.variantChildren.size?(w=0)=>{const{delayChildren:C=0,staggerChildren:P,staggerDirection:L}=a;return sk(i,t,w,C,P,L,e)}:()=>Promise.resolve(),{when:l}=a;if(l){const[w,C]=l==="beforeChildren"?[f,m]:[m,f];return w().then(()=>C())}else return Promise.all([f(),m(e.delay)])}function sk(i,t,e=0,n=0,a=0,f=1,m){const l=[];for(const w of i.variantChildren)w.notify("AnimationStart",t),l.push(Xx(w,t,{...m,delay:e+(typeof n=="function"?0:n)+O3(i.variantChildren,w,n,a,f)}).then(()=>w.notify("AnimationComplete",t)));return Promise.all(l)}function ak(i,t,e={}){i.notify("AnimationStart",t);let n;if(Array.isArray(t)){const a=t.map(f=>Xx(i,f,e));n=Promise.all(a)}else if(typeof t=="string")n=Xx(i,t,e);else{const a=typeof t=="function"?Ig(i,t,e.custom):t;n=Promise.all(k3(i,a,e))}return n.then(()=>{i.notify("AnimationComplete",t)})}function B3(i,t){if(!Array.isArray(t))return!1;const e=t.length;if(e!==i.length)return!1;for(let n=0;n<e;n++)if(t[n]!==i[n])return!1;return!0}const ok=nw.length;function L3(i){if(!i)return;if(!i.isControllingVariants){const e=i.parent?L3(i.parent)||{}:{};return i.props.initial!==void 0&&(e.initial=i.props.initial),e}const t={};for(let e=0;e<ok;e++){const n=nw[e],a=i.props[n];(xy(a)||a===!1)&&(t[n]=a)}return t}const lk=[...iw].reverse(),ck=iw.length;function uk(i){return t=>Promise.all(t.map(({animation:e,options:n})=>ak(i,e,n)))}function hk(i){let t=uk(i),e=n2(),n=!0;const a=w=>(C,P)=>{const L=Ig(i,P,w==="exit"?i.presenceContext?.custom:void 0);if(L){const{transition:j,transitionEnd:G,...nt}=L;C={...C,...nt,...G}}return C};function f(w){t=w(i)}function m(w){const{props:C}=i,P=L3(i.parent)||{},L=[],j=new Set;let G={},nt=1/0;for(let J=0;J<ck;J++){const mt=lk[J],Mt=e[mt],pt=C[mt]!==void 0?C[mt]:P[mt],Pt=xy(pt),kt=mt===w?Mt.isActive:null;kt===!1&&(nt=J);let $t=pt===P[mt]&&pt!==C[mt]&&Pt;if($t&&n&&i.manuallyAnimateOnMount&&($t=!1),Mt.protectedKeys={...G},!Mt.isActive&&kt===null||!pt&&!Mt.prevProp||Hb(pt)||typeof pt=="boolean")continue;const ae=fk(Mt.prevProp,pt);let qt=ae||mt===w&&Mt.isActive&&!$t&&Pt||J>nt&&Pt,le=!1;const Oe=Array.isArray(pt)?pt:[pt];let Be=Oe.reduce(a(mt),{});kt===!1&&(Be={});const{prevResolvedValues:qe={}}=Mt,ri={...qe,...Be},Ne=we=>{qt=!0,j.has(we)&&(le=!0,j.delete(we)),Mt.needsAnimating[we]=!0;const ye=i.getValue(we);ye&&(ye.liveStyle=!1)};for(const we in ri){const ye=Be[we],Ue=qe[we];if(G.hasOwnProperty(we))continue;let mi=!1;Wx(ye)&&Wx(Ue)?mi=!B3(ye,Ue):mi=ye!==Ue,mi?ye!=null?Ne(we):j.add(we):ye!==void 0&&j.has(we)?Ne(we):Mt.protectedKeys[we]=!0}Mt.prevProp=pt,Mt.prevResolvedValues=Be,Mt.isActive&&(G={...G,...Be}),n&&i.blockInitialAnimation&&(qt=!1);const wi=$t&&ae;qt&&(!wi||le)&&L.push(...Oe.map(we=>{const ye={type:mt};if(typeof we=="string"&&n&&!wi&&i.manuallyAnimateOnMount&&i.parent){const{parent:Ue}=i,mi=Ig(Ue,we);if(Ue.enteringChildren&&mi){const{delayChildren:Dt}=mi.transition||{};ye.delay=O3(Ue.enteringChildren,i,Dt)}}return{animation:we,options:ye}}))}if(j.size){const J={};if(typeof C.initial!="boolean"){const mt=Ig(i,Array.isArray(C.initial)?C.initial[0]:C.initial);mt&&mt.transition&&(J.transition=mt.transition)}j.forEach(mt=>{const Mt=i.getBaseTarget(mt),pt=i.getValue(mt);pt&&(pt.liveStyle=!0),J[mt]=Mt??null}),L.push({animation:J})}let at=!!L.length;return n&&(C.initial===!1||C.initial===C.animate)&&!i.manuallyAnimateOnMount&&(at=!1),n=!1,at?t(L):Promise.resolve()}function l(w,C){if(e[w].isActive===C)return Promise.resolve();i.variantChildren?.forEach(L=>L.animationState?.setActive(w,C)),e[w].isActive=C;const P=m(w);for(const L in e)e[L].protectedKeys={};return P}return{animateChanges:m,setActive:l,setAnimateFunction:f,getState:()=>e,reset:()=>{e=n2()}}}function fk(i,t){return typeof t=="string"?t!==i:Array.isArray(t)?!B3(t,i):!1}function _p(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function n2(){return{animate:_p(!0),whileInView:_p(),whileHover:_p(),whileTap:_p(),whileDrag:_p(),whileFocus:_p(),exit:_p()}}class td{constructor(t){this.isMounted=!1,this.node=t}update(){}}class dk extends td{constructor(t){super(t),t.animationState||(t.animationState=hk(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Hb(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:e}=this.node.prevProps||{};t!==e&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let pk=0;class mk extends td{constructor(){super(...arguments),this.id=pk++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:e}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const a=this.node.animationState.setActive("exit",!t);e&&!t&&a.then(()=>{e(this.id)})}mount(){const{register:t,onExitComplete:e}=this.node.presenceContext||{};e&&e(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const gk={animation:{Feature:dk},exit:{Feature:mk}};function Ty(i,t,e,n={passive:!0}){return i.addEventListener(t,e,n),()=>i.removeEventListener(t,e)}function Dy(i){return{point:{x:i.pageX,y:i.pageY}}}const _k=i=>t=>ew(t)&&i(t,Dy(t));function ay(i,t,e,n){return Ty(i,t,_k(e),n)}const F3=1e-4,yk=1-F3,vk=1+F3,N3=.01,bk=0-N3,xk=0+N3;function Ra(i){return i.max-i.min}function wk(i,t,e){return Math.abs(i-t)<=e}function r2(i,t,e,n=.5){i.origin=n,i.originPoint=mr(t.min,t.max,i.origin),i.scale=Ra(e)/Ra(t),i.translate=mr(e.min,e.max,i.origin)-i.originPoint,(i.scale>=yk&&i.scale<=vk||isNaN(i.scale))&&(i.scale=1),(i.translate>=bk&&i.translate<=xk||isNaN(i.translate))&&(i.translate=0)}function oy(i,t,e,n){r2(i.x,t.x,e.x,n?n.originX:void 0),r2(i.y,t.y,e.y,n?n.originY:void 0)}function s2(i,t,e){i.min=e.min+t.min,i.max=i.min+Ra(t)}function Tk(i,t,e){s2(i.x,t.x,e.x),s2(i.y,t.y,e.y)}function a2(i,t,e){i.min=t.min-e.min,i.max=i.min+Ra(t)}function ly(i,t,e){a2(i.x,t.x,e.x),a2(i.y,t.y,e.y)}function Cl(i){return[i("x"),i("y")]}const z3=({current:i})=>i?i.ownerDocument.defaultView:null,o2=(i,t)=>Math.abs(i-t);function Sk(i,t){const e=o2(i.x,t.x),n=o2(i.y,t.y);return Math.sqrt(e**2+n**2)}class U3{constructor(t,e,{transformPagePoint:n,contextWindow:a=window,dragSnapToOrigin:f=!1,distanceThreshold:m=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const j=N0(this.lastMoveEventInfo,this.history),G=this.startEvent!==null,nt=Sk(j.offset,{x:0,y:0})>=this.distanceThreshold;if(!G&&!nt)return;const{point:at}=j,{timestamp:J}=js;this.history.push({...at,timestamp:J});const{onStart:mt,onMove:Mt}=this.handlers;G||(mt&&mt(this.lastMoveEvent,j),this.startEvent=this.lastMoveEvent),Mt&&Mt(this.lastMoveEvent,j)},this.handlePointerMove=(j,G)=>{this.lastMoveEvent=j,this.lastMoveEventInfo=F0(G,this.transformPagePoint),rr.update(this.updatePoint,!0)},this.handlePointerUp=(j,G)=>{this.end();const{onEnd:nt,onSessionEnd:at,resumeAnimation:J}=this.handlers;if(this.dragSnapToOrigin&&J&&J(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const mt=N0(j.type==="pointercancel"?this.lastMoveEventInfo:F0(G,this.transformPagePoint),this.history);this.startEvent&&nt&&nt(j,mt),at&&at(j,mt)},!ew(t))return;this.dragSnapToOrigin=f,this.handlers=e,this.transformPagePoint=n,this.distanceThreshold=m,this.contextWindow=a||window;const l=Dy(t),w=F0(l,this.transformPagePoint),{point:C}=w,{timestamp:P}=js;this.history=[{...C,timestamp:P}];const{onSessionStart:L}=e;L&&L(t,N0(w,this.history)),this.removeListeners=Ry(ay(this.contextWindow,"pointermove",this.handlePointerMove),ay(this.contextWindow,"pointerup",this.handlePointerUp),ay(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Yf(this.updatePoint)}}function F0(i,t){return t?{point:t(i.point)}:i}function l2(i,t){return{x:i.x-t.x,y:i.y-t.y}}function N0({point:i},t){return{point:i,delta:l2(i,V3(t)),offset:l2(i,Ak(t)),velocity:Ek(t,.1)}}function Ak(i){return i[0]}function V3(i){return i[i.length-1]}function Ek(i,t){if(i.length<2)return{x:0,y:0};let e=i.length-1,n=null;const a=V3(i);for(;e>=0&&(n=i[e],!(a.timestamp-n.timestamp>Tu(t)));)e--;if(!n)return{x:0,y:0};const f=Ml(a.timestamp-n.timestamp);if(f===0)return{x:0,y:0};const m={x:(a.x-n.x)/f,y:(a.y-n.y)/f};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function Ck(i,{min:t,max:e},n){return t!==void 0&&i<t?i=n?mr(t,i,n.min):Math.max(i,t):e!==void 0&&i>e&&(i=n?mr(e,i,n.max):Math.min(i,e)),i}function c2(i,t,e){return{min:t!==void 0?i.min+t:void 0,max:e!==void 0?i.max+e-(i.max-i.min):void 0}}function Mk(i,{top:t,left:e,bottom:n,right:a}){return{x:c2(i.x,e,a),y:c2(i.y,t,n)}}function u2(i,t){let e=t.min-i.min,n=t.max-i.max;return t.max-t.min<i.max-i.min&&([e,n]=[n,e]),{min:e,max:n}}function Rk(i,t){return{x:u2(i.x,t.x),y:u2(i.y,t.y)}}function Pk(i,t){let e=.5;const n=Ra(i),a=Ra(t);return a>n?e=yy(t.min,t.max-n,i.min):n>a&&(e=yy(i.min,i.max-a,t.min)),Bh(0,1,e)}function Ik(i,t){const e={};return t.min!==void 0&&(e.min=t.min-i.min),t.max!==void 0&&(e.max=t.max-i.min),e}const Zx=.35;function Dk(i=Zx){return i===!1?i=0:i===!0&&(i=Zx),{x:h2(i,"left","right"),y:h2(i,"top","bottom")}}function h2(i,t,e){return{min:f2(i,t),max:f2(i,e)}}function f2(i,t){return typeof i=="number"?i:i[t]||0}const kk=new WeakMap;class Ok{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=zr(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:e=!1,distanceThreshold:n}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const f=L=>{const{dragSnapToOrigin:j}=this.getProps();j?this.pauseAnimation():this.stopAnimation(),e&&this.snapToCursor(Dy(L).point)},m=(L,j)=>{const{drag:G,dragPropagation:nt,onDragStart:at}=this.getProps();if(G&&!nt&&(this.openDragLock&&this.openDragLock(),this.openDragLock=WI(G),!this.openDragLock))return;this.latestPointerEvent=L,this.latestPanInfo=j,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Cl(mt=>{let Mt=this.getAxisMotionValue(mt).get()||0;if(Su.test(Mt)){const{projection:pt}=this.visualElement;if(pt&&pt.layout){const Pt=pt.layout.layoutBox[mt];Pt&&(Mt=Ra(Pt)*(parseFloat(Mt)/100))}}this.originPoint[mt]=Mt}),at&&rr.postRender(()=>at(L,j)),qx(this.visualElement,"transform");const{animationState:J}=this.visualElement;J&&J.setActive("whileDrag",!0)},l=(L,j)=>{this.latestPointerEvent=L,this.latestPanInfo=j;const{dragPropagation:G,dragDirectionLock:nt,onDirectionLock:at,onDrag:J}=this.getProps();if(!G&&!this.openDragLock)return;const{offset:mt}=j;if(nt&&this.currentDirection===null){this.currentDirection=Bk(mt),this.currentDirection!==null&&at&&at(this.currentDirection);return}this.updateAxis("x",j.point,mt),this.updateAxis("y",j.point,mt),this.visualElement.render(),J&&J(L,j)},w=(L,j)=>{this.latestPointerEvent=L,this.latestPanInfo=j,this.stop(L,j),this.latestPointerEvent=null,this.latestPanInfo=null},C=()=>Cl(L=>this.getAnimationState(L)==="paused"&&this.getAxisMotionValue(L).animation?.play()),{dragSnapToOrigin:P}=this.getProps();this.panSession=new U3(t,{onSessionStart:f,onStart:m,onMove:l,onSessionEnd:w,resumeAnimation:C},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:P,distanceThreshold:n,contextWindow:z3(this.visualElement)})}stop(t,e){const n=t||this.latestPointerEvent,a=e||this.latestPanInfo,f=this.isDragging;if(this.cancel(),!f||!a||!n)return;const{velocity:m}=a;this.startAnimation(m);const{onDragEnd:l}=this.getProps();l&&rr.postRender(()=>l(n,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:e}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),e&&e.setActive("whileDrag",!1)}updateAxis(t,e,n){const{drag:a}=this.getProps();if(!n||!Fv(t,a,this.currentDirection))return;const f=this.getAxisMotionValue(t);let m=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(m=Ck(m,this.constraints[t],this.elastic[t])),f.set(m)}resolveConstraints(){const{dragConstraints:t,dragElastic:e}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,a=this.constraints;t&&wg(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=Mk(n.layoutBox,t):this.constraints=!1,this.elastic=Dk(e),a!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Cl(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=Ik(n.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:e}=this.getProps();if(!t||!wg(t))return!1;const n=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const f=LD(n,a.root,this.visualElement.getTransformPagePoint());let m=Rk(a.layout.layoutBox,f);if(e){const l=e(kD(m));this.hasMutatedConstraints=!!l,l&&(m=S3(l))}return m}startAnimation(t){const{drag:e,dragMomentum:n,dragElastic:a,dragTransition:f,dragSnapToOrigin:m,onDragTransitionEnd:l}=this.getProps(),w=this.constraints||{},C=Cl(P=>{if(!Fv(P,e,this.currentDirection))return;let L=w&&w[P]||{};m&&(L={min:0,max:0});const j=a?200:1e6,G=a?40:1e7,nt={type:"inertia",velocity:n?t[P]:0,bounceStiffness:j,bounceDamping:G,timeConstant:750,restDelta:1,restSpeed:10,...f,...L};return this.startAxisValueAnimation(P,nt)});return Promise.all(C).then(l)}startAxisValueAnimation(t,e){const n=this.getAxisMotionValue(t);return qx(this.visualElement,t),n.start(uw(t,n,0,e,this.visualElement,!1))}stopAnimation(){Cl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Cl(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const e=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),a=n[e];return a||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Cl(e=>{const{drag:n}=this.getProps();if(!Fv(e,n,this.currentDirection))return;const{projection:a}=this.visualElement,f=this.getAxisMotionValue(e);if(a&&a.layout){const{min:m,max:l}=a.layout.layoutBox[e];f.set(t[e]-mr(m,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:e}=this.getProps(),{projection:n}=this.visualElement;if(!wg(e)||!n||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Cl(m=>{const l=this.getAxisMotionValue(m);if(l&&this.constraints!==!1){const w=l.get();a[m]=Pk({min:w,max:w},this.constraints[m])}});const{transformTemplate:f}=this.visualElement.getProps();this.visualElement.current.style.transform=f?f({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Cl(m=>{if(!Fv(m,t,null))return;const l=this.getAxisMotionValue(m),{min:w,max:C}=this.constraints[m];l.set(mr(w,C,a[m]))})}addListeners(){if(!this.visualElement.current)return;kk.set(this.visualElement,this);const t=this.visualElement.current,e=ay(t,"pointerdown",w=>{const{drag:C,dragListener:P=!0}=this.getProps();C&&P&&this.start(w)}),n=()=>{const{dragConstraints:w}=this.getProps();wg(w)&&w.current&&(this.constraints=this.resolveRefConstraints())},{projection:a}=this.visualElement,f=a.addEventListener("measure",n);a&&!a.layout&&(a.root&&a.root.updateScroll(),a.updateLayout()),rr.read(n);const m=Ty(window,"resize",()=>this.scalePositionWithinConstraints()),l=a.addEventListener("didUpdate",(({delta:w,hasLayoutChanged:C})=>{this.isDragging&&C&&(Cl(P=>{const L=this.getAxisMotionValue(P);L&&(this.originPoint[P]+=w[P].translate,L.set(L.get()+w[P].translate))}),this.visualElement.render())}));return()=>{m(),e(),f(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:e=!1,dragDirectionLock:n=!1,dragPropagation:a=!1,dragConstraints:f=!1,dragElastic:m=Zx,dragMomentum:l=!0}=t;return{...t,drag:e,dragDirectionLock:n,dragPropagation:a,dragConstraints:f,dragElastic:m,dragMomentum:l}}}function Fv(i,t,e){return(t===!0||t===i)&&(e===null||e===i)}function Bk(i,t=10){let e=null;return Math.abs(i.y)>t?e="y":Math.abs(i.x)>t&&(e="x"),e}class Lk extends td{constructor(t){super(t),this.removeGroupControls=Il,this.removeListeners=Il,this.controls=new Ok(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Il}unmount(){this.removeGroupControls(),this.removeListeners()}}const d2=i=>(t,e)=>{i&&rr.postRender(()=>i(t,e))};class Fk extends td{constructor(){super(...arguments),this.removePointerDownListener=Il}onPointerDown(t){this.session=new U3(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:z3(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:e,onPan:n,onPanEnd:a}=this.node.getProps();return{onSessionStart:d2(t),onStart:d2(e),onMove:n,onEnd:(f,m)=>{delete this.session,a&&rr.postRender(()=>a(f,m))}}}mount(){this.removePointerDownListener=ay(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const rb={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function p2(i,t){return t.max===t.min?0:i/(t.max-t.min)*100}const q_={correct:(i,t)=>{if(!t.target)return i;if(typeof i=="string")if(di.test(i))i=parseFloat(i);else return i;const e=p2(i,t.target.x),n=p2(i,t.target.y);return`${e}% ${n}%`}},Nk={correct:(i,{treeScale:t,projectionDelta:e})=>{const n=i,a=Kf.parse(i);if(a.length>5)return n;const f=Kf.createTransformer(i),m=typeof a[0]!="number"?1:0,l=e.x.scale*t.x,w=e.y.scale*t.y;a[0+m]/=l,a[1+m]/=w;const C=mr(l,w,.5);return typeof a[2+m]=="number"&&(a[2+m]/=C),typeof a[3+m]=="number"&&(a[3+m]/=C),f(a)}};let z0=!1;class zk extends me.Component{componentDidMount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:n,layoutId:a}=this.props,{projection:f}=t;oD(Uk),f&&(e.group&&e.group.add(f),n&&n.register&&a&&n.register(f),z0&&f.root.didUpdate(),f.addEventListener("animationComplete",()=>{this.safeToRemove()}),f.setOptions({...f.options,onExitComplete:()=>this.safeToRemove()})),rb.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:e,visualElement:n,drag:a,isPresent:f}=this.props,{projection:m}=n;return m&&(m.isPresent=f,z0=!0,a||t.layoutDependency!==e||e===void 0||t.isPresent!==f?m.willUpdate():this.safeToRemove(),t.isPresent!==f&&(f?m.promote():m.relegate()||rr.postRender(()=>{const l=m.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),tw.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:n}=this.props,{projection:a}=t;z0=!0,a&&(a.scheduleCheckAfterUnmount(),e&&e.group&&e.group.remove(a),n&&n.deregister&&n.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function j3(i){const[t,e]=tD(),n=me.useContext(bE);return Mx.jsx(zk,{...i,layoutGroup:n,switchLayoutGroup:me.useContext(w3),isPresent:t,safeToRemove:e})}const Uk={borderRadius:{...q_,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:q_,borderTopRightRadius:q_,borderBottomLeftRadius:q_,borderBottomRightRadius:q_,boxShadow:Nk};function Vk(i,t,e){const n=sa(i)?i:Lg(i);return n.start(uw("",n,t,e)),n.animation}const jk=(i,t)=>i.depth-t.depth;class $k{constructor(){this.children=[],this.isDirty=!1}add(t){B1(this.children,t),this.isDirty=!0}remove(t){L1(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(jk),this.isDirty=!1,this.children.forEach(t)}}function Hk(i,t){const e=ro.now(),n=({timestamp:a})=>{const f=a-e;f>=t&&(Yf(n),i(f-t))};return rr.setup(n,!0),()=>Yf(n)}const $3=["TopLeft","TopRight","BottomLeft","BottomRight"],Wk=$3.length,m2=i=>typeof i=="string"?parseFloat(i):i,g2=i=>typeof i=="number"||di.test(i);function qk(i,t,e,n,a,f){a?(i.opacity=mr(0,e.opacity??1,Xk(n)),i.opacityExit=mr(t.opacity??1,0,Zk(n))):f&&(i.opacity=mr(t.opacity??1,e.opacity??1,n));for(let m=0;m<Wk;m++){const l=`border${$3[m]}Radius`;let w=_2(t,l),C=_2(e,l);if(w===void 0&&C===void 0)continue;w||(w=0),C||(C=0),w===0||C===0||g2(w)===g2(C)?(i[l]=Math.max(mr(m2(w),m2(C),n),0),(Su.test(C)||Su.test(w))&&(i[l]+="%")):i[l]=C}(t.rotate||e.rotate)&&(i.rotate=mr(t.rotate||0,e.rotate||0,n))}function _2(i,t){return i[t]!==void 0?i[t]:i.borderRadius}const Xk=H3(0,.5,IE),Zk=H3(.5,.95,Il);function H3(i,t,e){return n=>n<i?0:n>t?1:e(yy(i,t,n))}function y2(i,t){i.min=t.min,i.max=t.max}function El(i,t){y2(i.x,t.x),y2(i.y,t.y)}function v2(i,t){i.translate=t.translate,i.scale=t.scale,i.originPoint=t.originPoint,i.origin=t.origin}function b2(i,t,e,n,a){return i-=t,i=_b(i,1/e,n),a!==void 0&&(i=_b(i,1/a,n)),i}function Gk(i,t=0,e=1,n=.5,a,f=i,m=i){if(Su.test(t)&&(t=parseFloat(t),t=mr(m.min,m.max,t/100)-m.min),typeof t!="number")return;let l=mr(f.min,f.max,n);i===f&&(l-=t),i.min=b2(i.min,t,e,l,a),i.max=b2(i.max,t,e,l,a)}function x2(i,t,[e,n,a],f,m){Gk(i,t[e],t[n],t[a],t.scale,f,m)}const Yk=["x","scaleX","originX"],Kk=["y","scaleY","originY"];function w2(i,t,e,n){x2(i.x,t,Yk,e?e.x:void 0,n?n.x:void 0),x2(i.y,t,Kk,e?e.y:void 0,n?n.y:void 0)}function T2(i){return i.translate===0&&i.scale===1}function W3(i){return T2(i.x)&&T2(i.y)}function S2(i,t){return i.min===t.min&&i.max===t.max}function Qk(i,t){return S2(i.x,t.x)&&S2(i.y,t.y)}function A2(i,t){return Math.round(i.min)===Math.round(t.min)&&Math.round(i.max)===Math.round(t.max)}function q3(i,t){return A2(i.x,t.x)&&A2(i.y,t.y)}function E2(i){return Ra(i.x)/Ra(i.y)}function C2(i,t){return i.translate===t.translate&&i.scale===t.scale&&i.originPoint===t.originPoint}class Jk{constructor(){this.members=[]}add(t){B1(this.members,t),t.scheduleRender()}remove(t){if(L1(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(t){const e=this.members.findIndex(a=>t===a);if(e===0)return!1;let n;for(let a=e;a>=0;a--){const f=this.members[a];if(f.isPresent!==!1){n=f;break}}return n?(this.promote(n),!0):!1}promote(t,e){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,e&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:a}=t.options;a===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:e,resumingFrom:n}=t;e.onExitComplete&&e.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function tO(i,t,e){let n="";const a=i.x.translate/t.x,f=i.y.translate/t.y,m=e?.z||0;if((a||f||m)&&(n=`translate3d(${a}px, ${f}px, ${m}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),e){const{transformPerspective:C,rotate:P,rotateX:L,rotateY:j,skewX:G,skewY:nt}=e;C&&(n=`perspective(${C}px) ${n}`),P&&(n+=`rotate(${P}deg) `),L&&(n+=`rotateX(${L}deg) `),j&&(n+=`rotateY(${j}deg) `),G&&(n+=`skewX(${G}deg) `),nt&&(n+=`skewY(${nt}deg) `)}const l=i.x.scale*t.x,w=i.y.scale*t.y;return(l!==1||w!==1)&&(n+=`scale(${l}, ${w})`),n||"none"}const U0=["","X","Y","Z"],eO=1e3;let iO=0;function V0(i,t,e,n){const{latestValues:a}=t;a[i]&&(e[i]=a[i],t.setStaticValue(i,0),n&&(n[i]=0))}function X3(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:t}=i.options;if(!t)return;const e=D3(t);if(window.MotionHasOptimisedAnimation(e,"transform")){const{layout:a,layoutId:f}=i.options;window.MotionCancelOptimisedAnimation(e,"transform",rr,!(a||f))}const{parent:n}=i;n&&!n.hasCheckedOptimisedAppear&&X3(n)}function Z3({attachResizeListener:i,defaultParent:t,measureScroll:e,checkIsScrollRoot:n,resetTransform:a}){return class{constructor(m={},l=t?.()){this.id=iO++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(sO),this.nodes.forEach(cO),this.nodes.forEach(uO),this.nodes.forEach(aO)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=m,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let w=0;w<this.path.length;w++)this.path[w].shouldResetTransform=!0;this.root===this&&(this.nodes=new $k)}addEventListener(m,l){return this.eventHandlers.has(m)||this.eventHandlers.set(m,new z1),this.eventHandlers.get(m).add(l)}notifyListeners(m,...l){const w=this.eventHandlers.get(m);w&&w.notify(...l)}hasListeners(m){return this.eventHandlers.has(m)}mount(m){if(this.instance)return;this.isSVG=c3(m)&&!KI(m),this.instance=m;const{layoutId:l,layout:w,visualElement:C}=this.options;if(C&&!C.current&&C.mount(m),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(w||l)&&(this.isLayoutDirty=!0),i){let P,L=0;const j=()=>this.root.updateBlockedByResize=!1;rr.read(()=>{L=window.innerWidth}),i(m,()=>{const G=window.innerWidth;G!==L&&(L=G,this.root.updateBlockedByResize=!0,P&&P(),P=Hk(j,250),rb.hasAnimatedSinceResize&&(rb.hasAnimatedSinceResize=!1,this.nodes.forEach(P2)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&C&&(l||w)&&this.addEventListener("didUpdate",({delta:P,hasLayoutChanged:L,hasRelativeLayoutChanged:j,layout:G})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const nt=this.options.transition||C.getDefaultTransition()||mO,{onLayoutAnimationStart:at,onLayoutAnimationComplete:J}=C.getProps(),mt=!this.targetLayout||!q3(this.targetLayout,G),Mt=!L&&j;if(this.options.layoutRoot||this.resumeFrom||Mt||L&&(mt||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const pt={...Q1(nt,"layout"),onPlay:at,onComplete:J};(C.shouldReduceMotion||this.options.layoutRoot)&&(pt.delay=0,pt.type=!1),this.startAnimation(pt),this.setAnimationOrigin(P,Mt)}else L||P2(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=G})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const m=this.getStack();m&&m.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Yf(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(hO),this.animationId++)}getTransformTemplate(){const{visualElement:m}=this.options;return m&&m.getProps().transformTemplate}willUpdate(m=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&X3(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let P=0;P<this.path.length;P++){const L=this.path[P];L.shouldResetTransform=!0,L.updateScroll("snapshot"),L.options.layoutRoot&&L.willUpdate(!1)}const{layoutId:l,layout:w}=this.options;if(l===void 0&&!w)return;const C=this.getTransformTemplate();this.prevTransformTemplateValue=C?C(this.latestValues,""):void 0,this.updateSnapshot(),m&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(M2);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(R2);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(lO),this.nodes.forEach(nO),this.nodes.forEach(rO)):this.nodes.forEach(R2),this.clearAllSnapshots();const l=ro.now();js.delta=Bh(0,1e3/60,l-js.timestamp),js.timestamp=l,js.isProcessing=!0,R0.update.process(js),R0.preRender.process(js),R0.render.process(js),js.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,tw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(oO),this.sharedNodes.forEach(fO)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,rr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){rr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ra(this.snapshot.measuredBox.x)&&!Ra(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let w=0;w<this.path.length;w++)this.path[w].updateScroll();const m=this.layout;this.layout=this.measure(!1),this.layoutCorrected=zr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,m?m.layoutBox:void 0)}updateScroll(m="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===m&&(l=!1),l&&this.instance){const w=n(this.instance);this.scroll={animationId:this.root.animationId,phase:m,isRoot:w,offset:e(this.instance),wasRoot:this.scroll?this.scroll.isRoot:w}}}resetTransform(){if(!a)return;const m=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!W3(this.projectionDelta),w=this.getTransformTemplate(),C=w?w(this.latestValues,""):void 0,P=C!==this.prevTransformTemplateValue;m&&this.instance&&(l||xp(this.latestValues)||P)&&(a(this.instance,C),this.shouldResetTransform=!1,this.scheduleRender())}measure(m=!0){const l=this.measurePageBox();let w=this.removeElementScroll(l);return m&&(w=this.removeTransform(w)),gO(w),{animationId:this.root.animationId,measuredBox:l,layoutBox:w,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:m}=this.options;if(!m)return zr();const l=m.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(_O))){const{scroll:C}=this.root;C&&(Tg(l.x,C.offset.x),Tg(l.y,C.offset.y))}return l}removeElementScroll(m){const l=zr();if(El(l,m),this.scroll?.wasRoot)return l;for(let w=0;w<this.path.length;w++){const C=this.path[w],{scroll:P,options:L}=C;C!==this.root&&P&&L.layoutScroll&&(P.wasRoot&&El(l,m),Tg(l.x,P.offset.x),Tg(l.y,P.offset.y))}return l}applyTransform(m,l=!1){const w=zr();El(w,m);for(let C=0;C<this.path.length;C++){const P=this.path[C];!l&&P.options.layoutScroll&&P.scroll&&P!==P.root&&Sg(w,{x:-P.scroll.offset.x,y:-P.scroll.offset.y}),xp(P.latestValues)&&Sg(w,P.latestValues)}return xp(this.latestValues)&&Sg(w,this.latestValues),w}removeTransform(m){const l=zr();El(l,m);for(let w=0;w<this.path.length;w++){const C=this.path[w];if(!C.instance||!xp(C.latestValues))continue;jx(C.latestValues)&&C.updateSnapshot();const P=zr(),L=C.measurePageBox();El(P,L),w2(l,C.latestValues,C.snapshot?C.snapshot.layoutBox:void 0,P)}return xp(this.latestValues)&&w2(l,this.latestValues),l}setTargetDelta(m){this.targetDelta=m,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(m){this.options={...this.options,...m,crossfade:m.crossfade!==void 0?m.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==js.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(m=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const w=!!this.resumingFrom||this!==l;if(!(m||w&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:P,layoutId:L}=this.options;if(!(!this.layout||!(P||L))){if(this.resolvedRelativeTargetAt=js.timestamp,!this.targetDelta&&!this.relativeTarget){const j=this.getClosestProjectingParent();j&&j.layout&&this.animationProgress!==1?(this.relativeParent=j,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zr(),this.relativeTargetOrigin=zr(),ly(this.relativeTargetOrigin,this.layout.layoutBox,j.layout.layoutBox),El(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=zr(),this.targetWithTransforms=zr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Tk(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):El(this.target,this.layout.layoutBox),E3(this.target,this.targetDelta)):El(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const j=this.getClosestProjectingParent();j&&!!j.resumingFrom==!!this.resumingFrom&&!j.options.layoutScroll&&j.target&&this.animationProgress!==1?(this.relativeParent=j,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zr(),this.relativeTargetOrigin=zr(),ly(this.relativeTargetOrigin,this.target,j.target),El(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||jx(this.parent.latestValues)||A3(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const m=this.getLead(),l=!!this.resumingFrom||this!==m;let w=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(w=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(w=!1),this.resolvedRelativeTargetAt===js.timestamp&&(w=!1),w)return;const{layout:C,layoutId:P}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||P))return;El(this.layoutCorrected,this.layout.layoutBox);const L=this.treeScale.x,j=this.treeScale.y;BD(this.layoutCorrected,this.treeScale,this.path,l),m.layout&&!m.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(m.target=m.layout.layoutBox,m.targetWithTransforms=zr());const{target:G}=m;if(!G){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(v2(this.prevProjectionDelta.x,this.projectionDelta.x),v2(this.prevProjectionDelta.y,this.projectionDelta.y)),oy(this.projectionDelta,this.layoutCorrected,G,this.latestValues),(this.treeScale.x!==L||this.treeScale.y!==j||!C2(this.projectionDelta.x,this.prevProjectionDelta.x)||!C2(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",G))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(m=!0){if(this.options.visualElement?.scheduleRender(),m){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ag(),this.projectionDelta=Ag(),this.projectionDeltaWithTransform=Ag()}setAnimationOrigin(m,l=!1){const w=this.snapshot,C=w?w.latestValues:{},P={...this.latestValues},L=Ag();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const j=zr(),G=w?w.source:void 0,nt=this.layout?this.layout.source:void 0,at=G!==nt,J=this.getStack(),mt=!J||J.members.length<=1,Mt=!!(at&&!mt&&this.options.crossfade===!0&&!this.path.some(pO));this.animationProgress=0;let pt;this.mixTargetDelta=Pt=>{const kt=Pt/1e3;I2(L.x,m.x,kt),I2(L.y,m.y,kt),this.setTargetDelta(L),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ly(j,this.layout.layoutBox,this.relativeParent.layout.layoutBox),dO(this.relativeTarget,this.relativeTargetOrigin,j,kt),pt&&Qk(this.relativeTarget,pt)&&(this.isProjectionDirty=!1),pt||(pt=zr()),El(pt,this.relativeTarget)),at&&(this.animationValues=P,qk(P,C,this.latestValues,kt,Mt,mt)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=kt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(m){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Yf(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=rr.update(()=>{rb.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Lg(0)),this.currentAnimation=Vk(this.motionValue,[0,1e3],{...m,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),m.onUpdate&&m.onUpdate(l)},onStop:()=>{},onComplete:()=>{m.onComplete&&m.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const m=this.getStack();m&&m.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(eO),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const m=this.getLead();let{targetWithTransforms:l,target:w,layout:C,latestValues:P}=m;if(!(!l||!w||!C)){if(this!==m&&this.layout&&C&&G3(this.options.animationType,this.layout.layoutBox,C.layoutBox)){w=this.target||zr();const L=Ra(this.layout.layoutBox.x);w.x.min=m.target.x.min,w.x.max=w.x.min+L;const j=Ra(this.layout.layoutBox.y);w.y.min=m.target.y.min,w.y.max=w.y.min+j}El(l,w),Sg(l,P),oy(this.projectionDeltaWithTransform,this.layoutCorrected,l,P)}}registerSharedNode(m,l){this.sharedNodes.has(m)||this.sharedNodes.set(m,new Jk),this.sharedNodes.get(m).add(l);const C=l.options.initialPromotionConfig;l.promote({transition:C?C.transition:void 0,preserveFollowOpacity:C&&C.shouldPreserveFollowOpacity?C.shouldPreserveFollowOpacity(l):void 0})}isLead(){const m=this.getStack();return m?m.lead===this:!0}getLead(){const{layoutId:m}=this.options;return m?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:m}=this.options;return m?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:m}=this.options;if(m)return this.root.sharedNodes.get(m)}promote({needsReset:m,transition:l,preserveFollowOpacity:w}={}){const C=this.getStack();C&&C.promote(this,w),m&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const m=this.getStack();return m?m.relegate(this):!1}resetSkewAndRotation(){const{visualElement:m}=this.options;if(!m)return;let l=!1;const{latestValues:w}=m;if((w.z||w.rotate||w.rotateX||w.rotateY||w.rotateZ||w.skewX||w.skewY)&&(l=!0),!l)return;const C={};w.z&&V0("z",m,C,this.animationValues);for(let P=0;P<U0.length;P++)V0(`rotate${U0[P]}`,m,C,this.animationValues),V0(`skew${U0[P]}`,m,C,this.animationValues);m.render();for(const P in C)m.setStaticValue(P,C[P]),this.animationValues&&(this.animationValues[P]=C[P]);m.scheduleRender()}applyProjectionStyles(m,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){m.visibility="hidden";return}const w=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,m.visibility="",m.opacity="",m.pointerEvents=nb(l?.pointerEvents)||"",m.transform=w?w(this.latestValues,""):"none";return}const C=this.getLead();if(!this.projectionDelta||!this.layout||!C.target){this.options.layoutId&&(m.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,m.pointerEvents=nb(l?.pointerEvents)||""),this.hasProjected&&!xp(this.latestValues)&&(m.transform=w?w({},""):"none",this.hasProjected=!1);return}m.visibility="";const P=C.animationValues||C.latestValues;this.applyTransformsToTarget();let L=tO(this.projectionDeltaWithTransform,this.treeScale,P);w&&(L=w(P,L)),m.transform=L;const{x:j,y:G}=this.projectionDelta;m.transformOrigin=`${j.origin*100}% ${G.origin*100}% 0`,C.animationValues?m.opacity=C===this?P.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:P.opacityExit:m.opacity=C===this?P.opacity!==void 0?P.opacity:"":P.opacityExit!==void 0?P.opacityExit:0;for(const nt in wy){if(P[nt]===void 0)continue;const{correct:at,applyTo:J,isCSSVariable:mt}=wy[nt],Mt=L==="none"?P[nt]:at(P[nt],C);if(J){const pt=J.length;for(let Pt=0;Pt<pt;Pt++)m[J[Pt]]=Mt}else mt?this.options.visualElement.renderState.vars[nt]=Mt:m[nt]=Mt}this.options.layoutId&&(m.pointerEvents=C===this?nb(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(m=>m.currentAnimation?.stop()),this.root.nodes.forEach(M2),this.root.sharedNodes.clear()}}}function nO(i){i.updateLayout()}function rO(i){const t=i.resumeFrom?.snapshot||i.snapshot;if(i.isLead()&&i.layout&&t&&i.hasListeners("didUpdate")){const{layoutBox:e,measuredBox:n}=i.layout,{animationType:a}=i.options,f=t.source!==i.layout.source;a==="size"?Cl(P=>{const L=f?t.measuredBox[P]:t.layoutBox[P],j=Ra(L);L.min=e[P].min,L.max=L.min+j}):G3(a,t.layoutBox,e)&&Cl(P=>{const L=f?t.measuredBox[P]:t.layoutBox[P],j=Ra(e[P]);L.max=L.min+j,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[P].max=i.relativeTarget[P].min+j)});const m=Ag();oy(m,e,t.layoutBox);const l=Ag();f?oy(l,i.applyTransform(n,!0),t.measuredBox):oy(l,e,t.layoutBox);const w=!W3(m);let C=!1;if(!i.resumeFrom){const P=i.getClosestProjectingParent();if(P&&!P.resumeFrom){const{snapshot:L,layout:j}=P;if(L&&j){const G=zr();ly(G,t.layoutBox,L.layoutBox);const nt=zr();ly(nt,e,j.layoutBox),q3(G,nt)||(C=!0),P.options.layoutRoot&&(i.relativeTarget=nt,i.relativeTargetOrigin=G,i.relativeParent=P)}}}i.notifyListeners("didUpdate",{layout:e,snapshot:t,delta:l,layoutDelta:m,hasLayoutChanged:w,hasRelativeLayoutChanged:C})}else if(i.isLead()){const{onExitComplete:e}=i.options;e&&e()}i.options.transition=void 0}function sO(i){i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function aO(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function oO(i){i.clearSnapshot()}function M2(i){i.clearMeasurements()}function R2(i){i.isLayoutDirty=!1}function lO(i){const{visualElement:t}=i.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),i.resetTransform()}function P2(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function cO(i){i.resolveTargetDelta()}function uO(i){i.calcProjection()}function hO(i){i.resetSkewAndRotation()}function fO(i){i.removeLeadSnapshot()}function I2(i,t,e){i.translate=mr(t.translate,0,e),i.scale=mr(t.scale,1,e),i.origin=t.origin,i.originPoint=t.originPoint}function D2(i,t,e,n){i.min=mr(t.min,e.min,n),i.max=mr(t.max,e.max,n)}function dO(i,t,e,n){D2(i.x,t.x,e.x,n),D2(i.y,t.y,e.y,n)}function pO(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const mO={duration:.45,ease:[.4,0,.1,1]},k2=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),O2=k2("applewebkit/")&&!k2("chrome/")?Math.round:Il;function B2(i){i.min=O2(i.min),i.max=O2(i.max)}function gO(i){B2(i.x),B2(i.y)}function G3(i,t,e){return i==="position"||i==="preserve-aspect"&&!wk(E2(t),E2(e),.2)}function _O(i){return i!==i.root&&i.scroll?.wasRoot}const yO=Z3({attachResizeListener:(i,t)=>Ty(i,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),j0={current:void 0},Y3=Z3({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!j0.current){const i=new yO({});i.mount(window),i.setOptions({layoutScroll:!0}),j0.current=i}return j0.current},resetTransform:(i,t)=>{i.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),vO={pan:{Feature:Fk},drag:{Feature:Lk,ProjectionNode:Y3,MeasureLayout:j3}};function L2(i,t,e){const{props:n}=i;i.animationState&&n.whileHover&&i.animationState.setActive("whileHover",e==="Start");const a="onHover"+e,f=n[a];f&&rr.postRender(()=>f(t,Dy(t)))}class bO extends td{mount(){const{current:t}=this.node;t&&(this.unmount=qI(t,(e,n)=>(L2(this.node,n,"Start"),a=>L2(this.node,a,"End"))))}unmount(){}}class xO extends td{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ry(Ty(this.node.current,"focus",()=>this.onFocus()),Ty(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function F2(i,t,e){const{props:n}=i;if(i.current instanceof HTMLButtonElement&&i.current.disabled)return;i.animationState&&n.whileTap&&i.animationState.setActive("whileTap",e==="Start");const a="onTap"+(e==="End"?"":e),f=n[a];f&&rr.postRender(()=>f(t,Dy(t)))}class wO extends td{mount(){const{current:t}=this.node;t&&(this.unmount=YI(t,(e,n)=>(F2(this.node,n,"Start"),(a,{success:f})=>F2(this.node,a,f?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Gx=new WeakMap,$0=new WeakMap,TO=i=>{const t=Gx.get(i.target);t&&t(i)},SO=i=>{i.forEach(TO)};function AO({root:i,...t}){const e=i||document;$0.has(e)||$0.set(e,{});const n=$0.get(e),a=JSON.stringify(t);return n[a]||(n[a]=new IntersectionObserver(SO,{root:i,...t})),n[a]}function EO(i,t,e){const n=AO(t);return Gx.set(i,e),n.observe(i),()=>{Gx.delete(i),n.unobserve(i)}}const CO={some:0,all:1};class MO extends td{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:e,margin:n,amount:a="some",once:f}=t,m={root:e?e.current:void 0,rootMargin:n,threshold:typeof a=="number"?a:CO[a]},l=w=>{const{isIntersecting:C}=w;if(this.isInView===C||(this.isInView=C,f&&!C&&this.hasEnteredView))return;C&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",C);const{onViewportEnter:P,onViewportLeave:L}=this.node.getProps(),j=C?P:L;j&&j(w)};return EO(this.node.current,m,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:e}=this.node;["amount","margin","root"].some(RO(t,e))&&this.startObserver()}unmount(){}}function RO({viewport:i={}},{viewport:t={}}={}){return e=>i[e]!==t[e]}const PO={inView:{Feature:MO},tap:{Feature:wO},focus:{Feature:xO},hover:{Feature:bO}},IO={layout:{ProjectionNode:Y3,MeasureLayout:j3}},DO={...gk,...PO,...vO,...IO},R$=DD(DO,WD);function yb(i,t){if(!i)throw new Error(t||"loader assertion failed.")}const hw=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),N2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);N2&&parseFloat(N2[1]);const z2=globalThis,U2=globalThis.process||{},kO=globalThis.navigator||{};function K3(i){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function Vp(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||K3()}function OO(i){return Vp()?K3()?"Electron":(kO.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Q3="4.1.0";function BO(i){try{const t=window[i],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class LO{constructor(t,e,n="sessionStorage"){this.storage=BO(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function FO(i){let t;return i<10?t=`${i.toFixed(2)}ms`:i<100?t=`${i.toFixed(1)}ms`:i<1e3?t=`${i.toFixed(0)}ms`:t=`${(i/1e3).toFixed(2)}s`,t}function NO(i,t=8){const e=Math.max(t-i.length,0);return`${" ".repeat(e)}${i}`}var vb;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(vb||(vb={}));const zO=10;function V2(i){return typeof i!="string"?i:(i=i.toUpperCase(),vb[i]||vb.WHITE)}function UO(i,t,e){return!Vp&&typeof i=="string"&&(t&&(i=`\x1B[${V2(t)}m${i}\x1B[39m`),e&&(i=`\x1B[${V2(e)+zO}m${i}\x1B[49m`)),i}function VO(i,t=["constructor"]){const e=Object.getPrototypeOf(i),n=Object.getOwnPropertyNames(e),a=i;for(const f of n){const m=a[f];typeof m=="function"&&(t.find(l=>f===l)||(a[f]=m.bind(i)))}}function fw(i,t){if(!i)throw new Error("Assertion failed")}function dg(){let i;if(Vp()&&z2.performance)i=z2?.performance?.now?.();else if("hrtime"in U2){const t=U2?.hrtime?.();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}const pg={debug:Vp()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},jO={enabled:!0,level:0};function mg(){}const j2={},$2={once:!0};class ky{constructor({id:t}={id:""}){this.VERSION=Q3,this._startTs=dg(),this._deltaTs=dg(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new LO(`__probe-${this.id}__`,jO),this.timeStamp(`${this.id} started`),VO(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((dg()-this._startTs).toPrecision(10))}getDelta(){return Number((dg()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,pg.warn,arguments,$2)}error(t){return this._getLogFunction(0,t,pg.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,pg.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,pg.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,pg.debug||pg.info,arguments,$2)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||mg,n&&[n],{tag:HO(e)}):mg}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||mg)}group(t,e,n={collapsed:!1}){const a=H2({logLevel:t,message:e,opts:n}),{collapsed:f}=n;return a.method=(f?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}groupCollapsed(t,e,n={}){return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||mg)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=J3(t)}_getLogFunction(t,e,n,a,f){if(this._shouldLog(t)){f=H2({logLevel:t,message:e,args:a,opts:f}),n=n||f.method,fw(n),f.total=this.getTotal(),f.delta=this.getDelta(),this._deltaTs=dg();const m=f.tag||f.message;if(f.once&&m)if(!j2[m])j2[m]=dg();else return mg;return e=$O(this.id,f.message,f),n.bind(console,e,...f.args)}return mg}}ky.VERSION=Q3;function J3(i){if(!i)return 0;let t;switch(typeof i){case"number":t=i;break;case"object":t=i.logLevel||i.priority||0;break;default:return 0}return fw(Number.isFinite(t)&&t>=0),t}function H2(i){const{logLevel:t,message:e}=i;i.logLevel=J3(t);const n=i.args?Array.from(i.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),i.message=t;break;case"object":Object.assign(i,t);break}typeof i.message=="function"&&(i.message=i.message());const a=typeof i.message;return fw(a==="string"||a==="object"),Object.assign(i,{args:n},i.opts)}function $O(i,t,e){if(typeof t=="string"){const n=e.time?NO(FO(e.total)):"";t=e.time?`${i}: ${n}  ${t}`:`${i}: ${t}`,t=UO(t,e.color,e.background)}return t}function HO(i){for(const t in i)for(const e in i[t])return e||"untitled";return"empty"}const H0="4.3.3",WO=H0[0]>="0"&&H0[0]<="9"?`v${H0}`:"";function qO(){const i=new ky({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=i,globalThis.loaders.version=WO,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=i,i}const XO=qO();function ZO(i,t){return tC(i||{},t)}function tC(i,t,e=0){if(e>3)return t;const n={...i};for(const[a,f]of Object.entries(t))f&&typeof f=="object"&&!Array.isArray(f)?n[a]=tC(n[a]||{},t[a],e+1):n[a]=t[a];return n}const GO="latest";function YO(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const KO=YO();function Qf(i,t){if(!i)throw new Error(t||"loaders.gl assertion failed.")}const Pp=typeof process!="object"||String(process)!=="[object process]"||process.browser,QO=typeof window<"u"&&typeof window.orientation<"u",W2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);W2&&parseFloat(W2[1]);class JO{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,e){this.name=t,this.workerThread=e,this.result=new Promise((n,a)=>{this._resolve=n,this._reject=a})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Qf(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Qf(this.isRunning),this.isRunning=!1,this._reject(t)}}class W0{terminate(){}}const q0=new Map;function t4(i){Qf(i.source&&!i.url||!i.source&&i.url);let t=q0.get(i.source||i.url);return t||(i.url&&(t=e4(i.url),q0.set(i.url,t)),i.source&&(t=eC(i.source),q0.set(i.source,t))),Qf(t),t}function e4(i){if(!i.startsWith("http"))return i;const t=i4(i);return eC(t)}function eC(i){const t=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(t)}function i4(i){return`try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`}function iC(i,t=!0,e){const n=e||new Set;if(i){if(q2(i))n.add(i);else if(q2(i.buffer))n.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(t&&typeof i=="object")for(const a in i)iC(i[a],t,n)}}return e===void 0?Array.from(n):[]}function q2(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const X0=()=>{};class Yx{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Pp||typeof W0<"u"&&!Pp}constructor(t){const{name:e,source:n,url:a}=t;Qf(n||a),this.name=e,this.source=n,this.url=a,this.onMessage=X0,this.onError=f=>console.log(f),this.worker=Pp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=X0,this.onError=X0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||iC(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=t4({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new W0(n,{eval:!1})}else if(this.source)t=new W0(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class n4{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Yx.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(a,f,m)=>a.done(m),n=(a,f)=>a.error(f)){const a=new Promise(f=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:f}),this));return this._startQueuedJob(),await a}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new JO(e.name,t);t.onMessage=a=>e.onMessage(n,a.type,a.payload),t.onError=a=>e.onError(n,a),e.onStart(n);try{await n.result}catch(a){console.error(`Worker exception: ${a}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Pp||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Yx({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return QO?this.maxMobileConcurrency:this.maxConcurrency}}const r4={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Hf{props;workerPools=new Map;static _workerFarm;static isSupported(){return Yx.isSupported()}static getWorkerFarm(t={}){return Hf._workerFarm=Hf._workerFarm||new Hf({}),Hf._workerFarm.setProps(t),Hf._workerFarm}constructor(t){this.props={...r4},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:a}=t;let f=this.workerPools.get(e);return f||(f=new n4({name:e,source:n,url:a}),f.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,f)),f}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function s4(i,t={}){const e=t[i.id]||{},n=Pp?`${i.id}-worker.js`:`${i.id}-worker-node.js`;let a=e.workerUrl;if(!a&&i.id==="compression"&&(a=t.workerUrl),t._workerType==="test"&&(Pp?a=`modules/${i.module}/dist/${n}`:a=`modules/${i.module}/src/workers/${i.id}-worker-node.ts`),!a){let f=i.version;f==="latest"&&(f=GO);const m=f?`@${f}`:"";a=`https://unpkg.com/@loaders.gl/${i.module}${m}/dist/${n}`}return Qf(a),a}function a4(i,t=KO){Qf(i,"no worker provided");const e=i.version;return!(!t||!e)}function o4(i,t){return!Hf.isSupported()||!Pp&&!t?._nodeWorkers?!1:i.worker&&t?.worker}async function l4(i,t,e,n,a){const f=i.id,m=s4(i,e),w=Hf.getWorkerFarm(e).getWorkerPool({name:f,url:m});e=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(n||{}));const C=await w.startJob("process-on-worker",c4.bind(null,a));return C.postMessage("process",{input:t,options:e,context:n}),await(await C.result).result}async function c4(i,t,e,n){switch(e){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:a,input:f,options:m}=n;try{const l=await i(f,m);t.postMessage("done",{id:a,result:l})}catch(l){const w=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:a,error:w})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function u4(i,t,e){if(e=e||i.byteLength,i.byteLength<e||t.byteLength<e)return!1;const n=new Uint8Array(i),a=new Uint8Array(t);for(let f=0;f<n.length;++f)if(n[f]!==a[f])return!1;return!0}function h4(...i){return f4(i)}function f4(i){const t=i.map(f=>f instanceof ArrayBuffer?new Uint8Array(f):f),e=t.reduce((f,m)=>f+m.byteLength,0),n=new Uint8Array(e);let a=0;for(const f of t)n.set(f,a),a+=f.byteLength;return n.buffer}async function d4(i){const t=[];for await(const e of i)t.push(e);return h4(...t)}function X2(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}class Z2{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=X2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(X2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class qb{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:n}=t;let a=this.stats[e];return a||(t instanceof Z2?a=t:a=new Z2(e,n),this.stats[e]=a),a}}let p4="";const G2={};function m4(i){for(const t in G2)if(i.startsWith(t)){const e=G2[t];i=i.replace(t,e)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`${p4}${i}`),i}function g4(i){return i&&typeof i=="object"&&i.isBuffer}function nC(i){if(g4(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const t=i;return new TextEncoder().encode(t).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function rC(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(t+1):""}function _4(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(0,t):""}const y4=i=>typeof i=="boolean",cy=i=>typeof i=="function",Oy=i=>i!==null&&typeof i=="object",Y2=i=>Oy(i)&&i.constructor==={}.constructor,v4=i=>!!i&&typeof i[Symbol.iterator]=="function",b4=i=>i&&typeof i[Symbol.asyncIterator]=="function",jp=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,$p=i=>typeof Blob<"u"&&i instanceof Blob,x4=i=>i&&typeof i=="object"&&i.isBuffer,w4=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||Oy(i)&&cy(i.tee)&&cy(i.cancel)&&cy(i.getReader),T4=i=>Oy(i)&&cy(i.read)&&cy(i.pipe)&&y4(i.readable),sC=i=>w4(i)||T4(i);class S4 extends Error{constructor(t,e){super(t),this.reason=e.reason,this.url=e.url,this.response=e.response}reason;url;response}const A4=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,E4=/^([-\w.]+\/[-\w.+]+)/;function K2(i,t){return i.toLowerCase()===t.toLowerCase()}function C4(i){const t=E4.exec(i);return t?t[1]:i}function Q2(i){const t=A4.exec(i);return t?t[1]:""}const aC=/\?.*/;function M4(i){const t=i.match(aC);return t&&t[0]}function dw(i){return i.replace(aC,"")}function R4(i){if(i.length<50)return i;const t=i.slice(i.length-15);return`${i.substr(0,32)}...${t}`}function Xb(i){return jp(i)?i.url:$p(i)?i.name||"":typeof i=="string"?i:""}function pw(i){if(jp(i)){const t=i,e=t.headers.get("content-type")||"",n=dw(t.url);return C4(e)||Q2(n)}return $p(i)?i.type||"":typeof i=="string"?Q2(i):""}function P4(i){return jp(i)?i.headers["content-length"]||-1:$p(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function oC(i){if(jp(i))return i;const t={},e=P4(i);e>=0&&(t["content-length"]=String(e));const n=Xb(i),a=pw(i);a&&(t["content-type"]=a);const f=await k4(i);f&&(t["x-first-bytes"]=f),typeof i=="string"&&(i=new TextEncoder().encode(i));const m=new Response(i,{headers:t});return Object.defineProperty(m,"url",{value:n}),m}async function I4(i){if(!i.ok)throw await D4(i)}async function D4(i){const t=R4(i.url);let e=`Failed to fetch resource (${i.status}) ${i.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const n={reason:i.statusText,url:i.url,response:i};try{const a=i.headers.get("Content-Type");n.reason=!i.bodyUsed&&a?.includes("application/json")?await i.json():await i.text()}catch{}return new S4(e,n)}async function k4(i){if(typeof i=="string")return`data:,${i.slice(0,5)}`;if(i instanceof Blob){const e=i.slice(0,5);return await new Promise(n=>{const a=new FileReader;a.onload=f=>n(f?.target?.result),a.readAsDataURL(e)})}if(i instanceof ArrayBuffer){const e=i.slice(0,5);return`data:base64,${O4(e)}`}return null}function O4(i){let t="";const e=new Uint8Array(i);for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function B4(i){return!L4(i)&&!F4(i)}function L4(i){return i.startsWith("http:")||i.startsWith("https:")}function F4(i){return i.startsWith("data:")}async function J2(i,t){if(typeof i=="string"){const e=m4(i);return B4(e)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(e,t):await fetch(e,t)}return await oC(i)}const tS=new ky({id:"loaders.gl"});class N4{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class z4{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const lC={fetch:null,mimeType:void 0,nothrow:!1,log:new z4,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:hw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},U4={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function cC(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state||(i._state={}),i._state}function uC(){const i=cC();return i.globalOptions=i.globalOptions||{...lC},i.globalOptions}function V4(i,t,e,n){return e=e||[],e=Array.isArray(e)?e:[e],j4(i,e),H4(t,i,n)}function j4(i,t){eS(i,null,lC,U4,t);for(const e of t){const n=i&&i[e.id]||{},a=e.options&&e.options[e.id]||{},f=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};eS(n,e.id,a,f,t)}}function eS(i,t,e,n,a){const f=t||"Top level",m=t?`${t}.`:"";for(const l in i){const w=!t&&Oy(i[l]),C=l==="baseUri"&&!t,P=l==="workerUrl"&&t;if(!(l in e)&&!C&&!P){if(l in n)tS.warn(`${f} loader option '${m}${l}' no longer supported, use '${n[l]}'`)();else if(!w){const L=$4(l,a);tS.warn(`${f} loader option '${m}${l}' not recognized. ${L}`)()}}}}function $4(i,t){const e=i.toLowerCase();let n="";for(const a of t)for(const f in a.options){if(i===f)return`Did you mean '${a.id}.${f}'?`;const m=f.toLowerCase();(e.startsWith(m)||m.startsWith(e))&&(n=n||`Did you mean '${a.id}.${f}'?`)}return n}function H4(i,t,e){const a={...i.options||{}};return W4(a,e),a.log===null&&(a.log=new N4),iS(a,uC()),iS(a,t),a}function iS(i,t){for(const e in t)if(e in t){const n=t[e];Y2(n)&&Y2(i[e])?i[e]={...i[e],...t[e]}:i[e]=t[e]}}function W4(i,t){t&&!("baseUri"in i)&&(i.baseUri=t)}function mw(i){return i?(Array.isArray(i)&&(i=i[0]),Array.isArray(i?.extensions)):!1}function gw(i){yb(i,"null loader"),yb(mw(i),"invalid loader");let t;return Array.isArray(i)&&(t=i[1],i=i[0],i={...i,options:{...i.options,...t}}),(i?.parseTextSync||i?.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const hC=()=>{const i=cC();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function q4(i){const t=hC();i=Array.isArray(i)?i:[i];for(const e of i){const n=gw(e);t.find(a=>n===a)||t.unshift(n)}}function X4(){return hC()}const Z4=/\.([^.]+)$/;async function G4(i,t=[],e,n){if(!fC(i))return null;let a=nS(i,t,{...e,nothrow:!0},n);if(a)return a;if($p(i)&&(i=await i.slice(0,10).arrayBuffer(),a=nS(i,t,e,n)),!a&&!e?.nothrow)throw new Error(dC(i));return a}function nS(i,t=[],e,n){if(!fC(i))return null;if(t&&!Array.isArray(t))return gw(t);let a=[];t&&(a=a.concat(t)),e?.ignoreRegisteredLoaders||a.push(...X4()),K4(a);const f=Y4(i,a,e,n);if(!f&&!e?.nothrow)throw new Error(dC(i));return f}function Y4(i,t,e,n){const a=Xb(i),f=pw(i),m=dw(a)||n?.url;let l=null,w="";return e?.mimeType&&(l=Z0(t,e?.mimeType),w=`match forced by supplied MIME type ${e?.mimeType}`),l=l||Q4(t,m),w=w||(l?`matched url ${m}`:""),l=l||Z0(t,f),w=w||(l?`matched MIME type ${f}`:""),l=l||tB(t,i),w=w||(l?`matched initial data ${pC(i)}`:""),e?.fallbackMimeType&&(l=l||Z0(t,e?.fallbackMimeType),w=w||(l?`matched fallback MIME type ${f}`:"")),w&&XO.log(1,`selectLoader selected ${l?.name}: ${w}.`),l}function fC(i){return!(i instanceof Response&&i.status===204)}function dC(i){const t=Xb(i),e=pw(i);let n="No valid loader found (";n+=t?`${rC(t)}, `:"no url provided, ",n+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const a=i?pC(i):"";return n+=a?` first bytes: "${a}"`:"first bytes: not available",n+=")",n}function K4(i){for(const t of i)gw(t)}function Q4(i,t){const e=t&&Z4.exec(t),n=e&&e[1];return n?J4(i,n):null}function J4(i,t){t=t.toLowerCase();for(const e of i)for(const n of e.extensions)if(n.toLowerCase()===t)return e;return null}function Z0(i,t){for(const e of i)if(e.mimeTypes?.some(n=>K2(t,n))||K2(t,`application/x.${e.id}`))return e;return null}function tB(i,t){if(!t)return null;for(const e of i)if(typeof t=="string"){if(eB(t,e))return e}else if(ArrayBuffer.isView(t)){if(rS(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&rS(t,0,e))return e;return null}function eB(i,t){return t.testText?t.testText(i):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>i.startsWith(n))}function rS(i,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(a=>iB(i,t,e,a))}function iB(i,t,e,n){if(n instanceof ArrayBuffer)return u4(n,i,n.byteLength);switch(typeof n){case"function":return n(i);case"string":const a=Kx(i,t,n.length);return n===a;default:return!1}}function pC(i,t=5){return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?Kx(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?Kx(i,0,t):""}function Kx(i,t,e){if(i.byteLength<t+e)return"";const n=new DataView(i);let a="";for(let f=0;f<e;f++)a+=String.fromCharCode(n.getUint8(t+f));return a}const nB=256*1024;function*rB(i,t){const e=t?.chunkSize||nB;let n=0;const a=new TextEncoder;for(;n<i.length;){const f=Math.min(i.length-n,e),m=i.slice(n,n+f);n+=f,yield a.encode(m)}}const sB=256*1024;function*aB(i,t={}){const{chunkSize:e=sB}=t;let n=0;for(;n<i.byteLength;){const a=Math.min(i.byteLength-n,e),f=new ArrayBuffer(a),m=new Uint8Array(i,n,a);new Uint8Array(f).set(m),n+=a,yield f}}const oB=1024*1024;async function*lB(i,t){const e=t?.chunkSize||oB;let n=0;for(;n<i.size;){const a=n+e,f=await i.slice(n,a).arrayBuffer();n=a,yield f}}function sS(i,t){return hw?cB(i,t):uB(i)}async function*cB(i,t){const e=i.getReader();let n;try{for(;;){const a=n||e.read();t?._streamReadAhead&&(n=e.read());const{done:f,value:m}=await a;if(f)return;yield nC(m)}}catch{e.releaseLock()}}async function*uB(i,t){for await(const e of i)yield nC(e)}function hB(i,t){if(typeof i=="string")return rB(i,t);if(i instanceof ArrayBuffer)return aB(i,t);if($p(i))return lB(i,t);if(sC(i))return sS(i,t);if(jp(i))return sS(i.body,t);throw new Error("makeIterator")}const mC="Cannot convert supplied data type";function fB(i,t,e){if(t.text&&typeof i=="string")return i;if(x4(i)&&(i=i.buffer),i instanceof ArrayBuffer){const n=i;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(i)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(i);let n=i.buffer;const a=i.byteLength||i.length;return(i.byteOffset!==0||a!==n.byteLength)&&(n=n.slice(i.byteOffset,i.byteOffset+a)),n}throw new Error(mC)}async function dB(i,t,e){const n=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||n)return fB(i,t);if($p(i)&&(i=await oC(i)),jp(i)){const a=i;return await I4(a),t.binary?await a.arrayBuffer():await a.text()}if(sC(i)&&(i=hB(i,e)),v4(i)||b4(i))return d4(i);throw new Error(mC)}function gC(i,t){const e=uC(),n=i||e;return typeof n.fetch=="function"?n.fetch:Oy(n.fetch)?a=>J2(a,n.fetch):t?.fetch?t?.fetch:J2}function pB(i,t,e){if(e)return e;const n={fetch:gC(t,i),...i};if(n.url){const a=dw(n.url);n.baseUrl=a,n.queryString=M4(n.url),n.filename=rC(a),n.baseUrl=_4(a)}return Array.isArray(n.loaders)||(n.loaders=null),n}function mB(i,t){if(i&&!Array.isArray(i))return i;let e;if(i&&(e=Array.isArray(i)?i:[i]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...n]:n}return e&&e.length?e:void 0}async function bb(i,t,e,n){t&&!Array.isArray(t)&&!mw(t)&&(n=void 0,e=t,t=void 0),i=await i,e=e||{};const a=Xb(i),m=mB(t,n),l=await G4(i,m,e);return l?(e=V4(e,l,m,a),n=pB({url:a,_parse:bb,loaders:m},e,n||null),await gB(l,i,e,n)):null}async function gB(i,t,e,n){if(a4(i),e=ZO(i.options,e),jp(t)){const f=t,{ok:m,redirected:l,status:w,statusText:C,type:P,url:L}=f,j=Object.fromEntries(f.headers.entries());n.response={headers:j,ok:m,redirected:l,status:w,statusText:C,type:P,url:L}}t=await dB(t,i,e);const a=i;if(a.parseTextSync&&typeof t=="string")return a.parseTextSync(t,e,n);if(o4(i,e))return await l4(i,t,e,n,bb);if(a.parseText&&typeof t=="string")return await a.parseText(t,e,n);if(a.parse)return await a.parse(t,e,n);throw Qf(!a.parseSync),new Error(`${i.id} loader - no parser found and worker is disabled`)}async function xb(i,t,e,n){let a,f;!Array.isArray(t)&&!mw(t)?(a=[],f=t):(a=t,f=e);const m=gC(f);let l=i;return typeof i=="string"&&(l=await m(i)),$p(i)&&(l=await m(i)),Array.isArray(a)?await bb(l,a,f):await bb(l,a,f)}const _B="4.3.3",yB=globalThis.loaders?.parseImageNode,Qx=typeof Image<"u",Jx=typeof ImageBitmap<"u",vB=!!yB,t1=hw?!0:vB;function bB(i){switch(i){case"auto":return Jx||Qx||t1;case"imagebitmap":return Jx;case"image":return Qx;case"data":return t1;default:throw new Error(`@loaders.gl/images: image ${i} not supported in this environment`)}}function xB(){if(Jx)return"imagebitmap";if(Qx)return"image";if(t1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function wB(i){const t=SB(i);if(!t)throw new Error("Not an image");return t}function TB(i){switch(wB(i)){case"data":return i;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=i.width,t.height=i.height,e.drawImage(i,0,0),e.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function SB(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const AB=/^data:image\/svg\+xml/,EB=/\.svg((\?|#).*)?$/;function _w(i){return i&&(AB.test(i)||EB.test(i))}function CB(i,t){if(_w(t)){let n=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(f){throw new Error(f.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return _C(i,t)}function _C(i,t){if(_w(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function yC(i,t,e){const n=CB(i,e),a=self.URL||self.webkitURL,f=typeof n!="string"&&a.createObjectURL(n);try{return await MB(f||n,t)}finally{f&&a.revokeObjectURL(f)}}async function MB(i,t){const e=new Image;return e.src=i,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((n,a)=>{try{e.onload=()=>n(e),e.onerror=f=>{const m=f instanceof Error?f.message:"error";a(new Error(m))}}catch(f){a(f)}})}const RB={};let aS=!0;async function PB(i,t,e){let n;_w(e)?n=await yC(i,t,e):n=_C(i,e);const a=t&&t.imagebitmap;return await IB(n,a)}async function IB(i,t=null){if((DB(t)||!aS)&&(t=null),t)try{return await createImageBitmap(i,t)}catch(e){console.warn(e),aS=!1}return await createImageBitmap(i)}function DB(i){for(const t in i||RB)return!1;return!0}function kB(i){return!FB(i,"ftyp",4)||(i[8]&96)===0?null:OB(i)}function OB(i){switch(BB(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function BB(i,t,e){return String.fromCharCode(...i.slice(t,e))}function LB(i){return[...i].map(t=>t.charCodeAt(0))}function FB(i,t,e=0){const n=LB(t);for(let a=0;a<n.length;++a)if(n[a]!==i[a+e])return!1;return!0}const xu=!1,uy=!0;function vC(i){const t=By(i);return zB(t)||jB(t)||UB(t)||VB(t)||NB(t)}function NB(i){const t=new Uint8Array(i instanceof DataView?i.buffer:i),e=kB(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function zB(i){const t=By(i);return t.byteLength>=24&&t.getUint32(0,xu)===2303741511?{mimeType:"image/png",width:t.getUint32(16,xu),height:t.getUint32(20,xu)}:null}function UB(i){const t=By(i);return t.byteLength>=10&&t.getUint32(0,xu)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,uy),height:t.getUint16(8,uy)}:null}function VB(i){const t=By(i);return t.byteLength>=14&&t.getUint16(0,xu)===16973&&t.getUint32(2,uy)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,uy),height:t.getUint32(22,uy)}:null}function jB(i){const t=By(i);if(!(t.byteLength>=3&&t.getUint16(0,xu)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:a}=$B();let f=2;for(;f+9<t.byteLength;){const m=t.getUint16(f,xu);if(a.has(m))return{mimeType:"image/jpeg",height:t.getUint16(f+5,xu),width:t.getUint16(f+7,xu)};if(!n.has(m))return null;f+=2,f+=t.getUint16(f,xu)}return null}function $B(){const i=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)i.add(e);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function By(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function HB(i,t){const{mimeType:e}=vC(i)||{},n=globalThis.loaders?.parseImageNode;return yb(n),await n(i,e)}async function WB(i,t,e){t=t||{};const a=(t.image||{}).type||"auto",{url:f}=e||{},m=qB(a);let l;switch(m){case"imagebitmap":l=await PB(i,t,f);break;case"image":l=await yC(i,t,f);break;case"data":l=await HB(i);break;default:yb(!1)}return a==="data"&&(l=TB(l)),l}function qB(i){switch(i){case"auto":case"data":return xB();default:return bB(i),i}}const XB=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],ZB=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],GB={image:{type:"auto",decode:!0}},YB={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:_B,mimeTypes:ZB,extensions:XB,parse:WB,tests:[i=>!!vC(new DataView(i))],options:GB},on=new ky({id:"deck"});let e1={};function KB(i){e1=i}function na(i,t,e,n){on.level>0&&e1[i]&&e1[i].call(null,t,e,n)}function QB(i){const t=i[0],e=i[i.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const JB={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:QB,parseTextSync:JSON.parse};function tL(){const i="9.2.2",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==i)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${i}`);return t||(on.log(1,`deck.gl ${i}`)(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:on,_registerLoggers:KB},q4([JB,[YB,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const eL=tL();function yw(i,t){if(!i)throw new Error(t||"shadertools: assertion failed.")}const G0={number:{type:"number",validate(i,t){return Number.isFinite(i)&&typeof t=="object"&&(t.max===void 0||i<=t.max)&&(t.min===void 0||i>=t.min)}},array:{type:"array",validate(i,t){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function iL(i){const t={};for(const[e,n]of Object.entries(i))t[e]=nL(n);return t}function nL(i){let t=oS(i);if(t!=="object")return{value:i,...G0[t],type:t};if(typeof i=="object")return i?i.type!==void 0?{...i,...G0[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(t=oS(i.value),{...i,...G0[t],type:t}):{type:"object",value:null};throw new Error("props")}function oS(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const rL=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,sL=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,aL={vertex:rL,fragment:sL},lS=/void\s+main\s*\([^)]*\)\s*\{\n?/,cS=/}\n?[^{}]*$/,Y0=[],sb="__LUMA_INJECT_DECLARATIONS__";function oL(i){const t={vertex:{},fragment:{}};for(const e in i){let n=i[e];const a=lL(e);typeof n=="string"&&(n={order:0,injection:n}),t[a][e]=n}return t}function lL(i){const t=i.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function wb(i,t,e,n=!1){const a=t==="vertex";for(const f in e){const m=e[f];m.sort((w,C)=>w.order-C.order),Y0.length=m.length;for(let w=0,C=m.length;w<C;++w)Y0[w]=m[w].injection;const l=`${Y0.join(`
`)}
`;switch(f){case"vs:#decl":a&&(i=i.replace(sb,l));break;case"vs:#main-start":a&&(i=i.replace(lS,w=>w+l));break;case"vs:#main-end":a&&(i=i.replace(cS,w=>l+w));break;case"fs:#decl":a||(i=i.replace(sb,l));break;case"fs:#main-start":a||(i=i.replace(lS,w=>w+l));break;case"fs:#main-end":a||(i=i.replace(cS,w=>l+w));break;default:i=i.replace(f,w=>w+l)}}return i=i.replace(sb,""),n&&(i=i.replace(/\}\s*$/,f=>f+aL[t])),i}function Tb(i){i.map(t=>cL(t))}function cL(i){if(i.instance)return;Tb(i.dependencies||[]);const{propTypes:t={},deprecations:e=[],inject:n={}}=i,a={normalizedInjections:oL(n),parsedDeprecations:uL(e)};t&&(a.propValidators=iL(t)),i.instance=a;let f={};t&&(f=Object.entries(t).reduce((m,[l,w])=>{const C=w?.value;return C&&(m[l]=C),m},{})),i.defaultUniforms={...i.defaultUniforms,...f}}function bC(i,t,e){i.deprecations?.forEach(n=>{n.regex?.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}function uL(i){return i.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),i}function vw(i){Tb(i);const t={},e={};xC({modules:i,level:0,moduleMap:t,moduleDepth:e});const n=Object.keys(e).sort((a,f)=>e[f]-e[a]).map(a=>t[a]);return Tb(n),n}function xC(i){const{modules:t,level:e,moduleMap:n,moduleDepth:a}=i;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const f of t)n[f.name]=f,(a[f.name]===void 0||a[f.name]<e)&&(a[f.name]=e);for(const f of t)f.dependencies&&xC({modules:f.dependencies,level:e+1,moduleMap:n,moduleDepth:a})}function hL(i){switch(i?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function fL(i,t){if(Number(i.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return i=uS(i,dL),i;case"fragment":return i=uS(i,pL),i;default:throw new Error(t)}}const wC=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],dL=[...wC,[i1("attribute"),"in $1"],[i1("varying"),"out $1"]],pL=[...wC,[i1("varying"),"in $1"]];function uS(i,t){for(const[e,n]of t)i=i.replace(e,n);return i}function i1(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function TC(i,t){let e="";for(const n in i){const a=i[n];if(e+=`void ${a.signature} {
`,a.header&&(e+=`  ${a.header}`),t[n]){const f=t[n];f.sort((m,l)=>m.order-l.order);for(const m of f)e+=`  ${m.injection}
`}a.footer&&(e+=`  ${a.footer}`),e+=`}
`}return e}function SC(i){const t={vertex:{},fragment:{}};for(const e of i){let n,a;typeof e!="string"?(n=e,a=n.hook):(n={},a=e),a=a.trim();const[f,m]=a.split(":"),l=a.replace(/\(.+/,""),w=Object.assign(n,{signature:m});switch(f){case"vs":t.vertex[l]=w;break;case"fs":t.fragment[l]=w;break;default:throw new Error(f)}}return t}function mL(i,t){return{name:gL(i,t),language:"glsl",version:_L(i)}}function gL(i,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return n?n[1]:t}function _L(i){let t=100;const e=i.match(/[^\s]+/g);if(e&&e.length>=2&&e[0]==="#version"){const n=parseInt(e[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const AC=`

${sb}
`,yL=`precision highp float;
`;function vL(i){const t=vw(i.modules||[]);return{source:xL(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:t}),getUniforms:EC(t)}}function bL(i){const{vs:t,fs:e}=i,n=vw(i.modules||[]);return{vs:hS(i.platformInfo,{...i,source:t,stage:"vertex",modules:n}),fs:hS(i.platformInfo,{...i,source:e,stage:"fragment",modules:n}),getUniforms:EC(n)}}function xL(i,t){const{source:e,stage:n,modules:a,hookFunctions:f=[],inject:m={},log:l}=t;yw(typeof e=="string","shader source must be a string");const w=e;let C="";const P=SC(f),L={},j={},G={};for(const at in m){const J=typeof m[at]=="string"?{injection:m[at],order:0}:m[at],mt=/^(v|f)s:(#)?([\w-]+)$/.exec(at);if(mt){const Mt=mt[2],pt=mt[3];Mt?pt==="decl"?j[at]=[J]:G[at]=[J]:L[at]=[J]}else G[at]=[J]}const nt=a;for(const at of nt){l&&bC(at,w,l);const J=CC(at,"wgsl");C+=J;const mt=at.injections?.[n]||{};for(const Mt in mt){const pt=/^(v|f)s:#([\w-]+)$/.exec(Mt);if(pt){const kt=pt[2]==="decl"?j:G;kt[Mt]=kt[Mt]||[],kt[Mt].push(mt[Mt])}else L[Mt]=L[Mt]||[],L[Mt].push(mt[Mt])}}return C+=AC,C=wb(C,n,j),C+=TC(P[n],L),C+=w,C=wb(C,n,G),C}function hS(i,t){const{source:e,stage:n,language:a="glsl",modules:f,defines:m={},hookFunctions:l=[],inject:w={},prologue:C=!0,log:P}=t;yw(typeof e=="string","shader source must be a string");const L=a==="glsl"?mL(e).version:-1,j=i.shaderLanguageVersion,G=L===100?"#version 100":"#version 300 es",at=e.split(`
`).slice(1).join(`
`),J={};f.forEach($t=>{Object.assign(J,$t.defines)}),Object.assign(J,m);let mt="";switch(a){case"wgsl":break;case"glsl":mt=C?`${G}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${hL(i)}
${n==="fragment"?yL:""}

// ----- APPLICATION DEFINES -------------------------

${wL(J)}

`:`${G}
`;break}const Mt=SC(l),pt={},Pt={},kt={};for(const $t in w){const ae=typeof w[$t]=="string"?{injection:w[$t],order:0}:w[$t],qt=/^(v|f)s:(#)?([\w-]+)$/.exec($t);if(qt){const le=qt[2],Oe=qt[3];le?Oe==="decl"?Pt[$t]=[ae]:kt[$t]=[ae]:pt[$t]=[ae]}else kt[$t]=[ae]}for(const $t of f){P&&bC($t,at,P);const ae=CC($t,n);mt+=ae;const qt=$t.instance?.normalizedInjections[n]||{};for(const le in qt){const Oe=/^(v|f)s:#([\w-]+)$/.exec(le);if(Oe){const qe=Oe[2]==="decl"?Pt:kt;qe[le]=qe[le]||[],qe[le].push(qt[le])}else pt[le]=pt[le]||[],pt[le].push(qt[le])}}return mt+="// ----- MAIN SHADER SOURCE -------------------------",mt+=AC,mt=wb(mt,n,Pt),mt+=TC(Mt[n],pt),mt+=at,mt=wb(mt,n,kt),a==="glsl"&&L!==j&&(mt=fL(mt,n)),mt.trim()}function EC(i){return function(e){const n={};for(const a of i){const f=a.getUniforms?.(e,n);Object.assign(n,f)}return n}}function wL(i={}){let t="";for(const e in i){const n=i[e];(n||Number.isFinite(n))&&(t+=`#define ${e.toUpperCase()} ${i[e]}
`)}return t}function CC(i,t){let e;switch(t){case"vertex":e=i.vs||"";break;case"fragment":e=i.fs||"";break;case"wgsl":e=i.source||"";break;default:yw(!1)}if(!i.name)throw new Error("Shader module must have a name");const n=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let a=`// ----- MODULE ${i.name} ---------------

`;return t!=="wgsl"&&(a+=`#define MODULE_${n}
`),a+=`${e}
`,a}const TL=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,SL=/^\s*\#\s*endif\s*$/;function AL(i,t){const e=i.split(`
`),n=[];let a=!0,f=null;for(const m of e){const l=m.match(TL),w=m.match(SL);l?(f=l[1],a=!!t?.defines?.[f]):w?a=!0:a&&n.push(m)}return n.join(`
`)}class Ap{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Ap.defaultShaderAssembler=Ap.defaultShaderAssembler||new Ap,Ap.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(e=>e.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==e)}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const e=this._getModuleList(t.modules),n=this._hookFunctions,{source:a,getUniforms:f}=vL({...t,source:t.source,modules:e,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?AL(a):a,getUniforms:f,modules:e}}assembleGLSLShaderPair(t){const e=this._getModuleList(t.modules),n=this._hookFunctions;return{...bL({...t,vs:t.vs,fs:t.fs,modules:e,hookFunctions:n}),modules:e}}_getModuleList(t=[]){const e=new Array(this._defaultModules.length+t.length),n={};let a=0;for(let f=0,m=this._defaultModules.length;f<m;++f){const l=this._defaultModules[f],w=l.name;e[a++]=l,n[w]=!0}for(let f=0,m=t.length;f<m;++f){const l=t[f],w=l.name;n[w]||(e[a++]=l,n[w]=!0)}return e.length=a,Tb(e),e}}const EL=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,CL=`#version 300 es
${EL}`;function ML(i){const{input:t,inputChannels:e,output:n}={};if(!t)return CL;if(!e)throw new Error("inputChannels");const a=RL(e),f=PL(t,e);return`#version 300 es
in ${a} ${t};
out vec4 ${n};
void main() {
  ${n} = ${f};
}`}function RL(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${i}`)}}function PL(i,t){switch(t){case 1:return`vec4(${i}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${i}, 0.0, 1.0)`;case 3:return`vec4(${i}, 1.0)`;case 4:return i;default:throw new Error(`invalid channels: ${t}`)}}class IL{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new qb({id:t})),this.stats.get(t)}}const MC=new IL,Se=new ky({id:"luma.gl"}),K0={};function Zb(i="id"){K0[i]=K0[i]||1;const t=K0[i]++;return`${i}-${t}`}let Cn=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,e,n){if(!t)throw new Error("no device");this._device=t,this.props=DL(e,n);const a=this.props.id!=="undefined"?this.props.id:Zb(this[Symbol.toStringTag]);this.props.id=a,this.id=a,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}};function DL(i,t){const e={...t};for(const n in i)i[n]!==void 0&&(e[n]=i[n]);return e}class Un extends Cn{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,e){const n={...e};(e.usage||0)&Un.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(t,n,Un.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,e,n){const a=ArrayBuffer.isView(t)?t.buffer:t,f=Math.min(t?t.byteLength:n,Un.DEBUG_DATA_MAX_LENGTH);a===null?this.debugData=new ArrayBuffer(f):e===0&&n===a.byteLength?this.debugData=a.slice(0,f):this.debugData=a.slice(e,e+f)}static defaultProps={...Cn.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function RC(i){const[t,e,n]=ww[i],a=i.includes("norm"),f=!a&&!i.startsWith("float"),m=i.startsWith("s");return{signedType:t,primitiveType:e,byteLength:n,normalized:a,integer:f,signed:m}}function kL(i){const t=i;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}function OL(i,t){switch(t){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}function bw(i){const t=ArrayBuffer.isView(i)?i.constructor:i;if(t===Uint8ClampedArray)return"uint8";const e=Object.values(ww).find(n=>t===n[4]);if(!e)throw new Error(t.name);return e[0]}function xw(i){const[,,,,t]=ww[i];return t}const ww={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Tw(i){let t;i.endsWith("-webgl")&&(i.replace("-webgl",""),t=!0);const[e,n]=i.split("x"),a=e,f=n?parseInt(n):1,m=RC(a),l={type:a,components:f,byteLength:m.byteLength*f,integer:m.integer,signed:m.signed,normalized:m.normalized};return t&&(l.webglOnly=!0),l}function BL(i,t,e){const n=e?kL(i):i;switch(n){case"unorm8":return t===1?"unorm8":t===3?"unorm8x3-webgl":`${n}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(t===1||t===3)throw new Error(`size: ${t}`);return`${n}x${t}`;default:return t===1?n:`${n}x${t}`}}function LL(i,t,e){if(!t||t>4)throw new Error(`size ${t}`);const n=t,a=bw(i);return BL(a,n,e)}function FL(i){let t;switch(i.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return i.components<=2?"float16x2":"float16x4"}return i.components===1?t:`${t}x${i.components}`}const ta="texture-compression-bc",En="texture-compression-astc",_u="texture-compression-etc2",NL="texture-compression-etc1-webgl",Nv="texture-compression-pvrtc-webgl",Q0="texture-compression-atc-webgl",zv="float32-renderable-webgl",J0="float16-renderable-webgl",zL="rgb9e5ufloat-renderable-webgl",tx="snorm8-renderable-webgl",X_="norm16-renderable-webgl",ex="snorm16-renderable-webgl",Uv="float32-filterable",fS="float16-filterable-webgl";function PC(i){const t=jL[i];if(!t)throw new Error(`Unsupported texture format ${i}`);return t}const UL={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:tx},rg8snorm:{render:tx},"rgb8snorm-webgl":{},rgba8snorm:{render:tx},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:X_},rg16unorm:{render:X_},"rgb16unorm-webgl":{f:X_},rgba16unorm:{render:X_},r16snorm:{f:ex},rg16snorm:{render:ex},"rgb16snorm-webgl":{f:X_},rgba16snorm:{render:ex},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:J0,filter:"float16-filterable-webgl"},rg16float:{render:J0,filter:fS},rgba16float:{render:J0,filter:fS},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:zv,filter:Uv},rg32float:{render:!1,filter:Uv},"rgb32float-webgl":{render:zv,filter:Uv},rgba32float:{render:zv,filter:Uv},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:zL},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:zv},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},VL={"bc1-rgb-unorm-webgl":{f:ta},"bc1-rgb-unorm-srgb-webgl":{f:ta},"bc1-rgba-unorm":{f:ta},"bc1-rgba-unorm-srgb":{f:ta},"bc2-rgba-unorm":{f:ta},"bc2-rgba-unorm-srgb":{f:ta},"bc3-rgba-unorm":{f:ta},"bc3-rgba-unorm-srgb":{f:ta},"bc4-r-unorm":{f:ta},"bc4-r-snorm":{f:ta},"bc5-rg-unorm":{f:ta},"bc5-rg-snorm":{f:ta},"bc6h-rgb-ufloat":{f:ta},"bc6h-rgb-float":{f:ta},"bc7-rgba-unorm":{f:ta},"bc7-rgba-unorm-srgb":{f:ta},"etc2-rgb8unorm":{f:_u},"etc2-rgb8unorm-srgb":{f:_u},"etc2-rgb8a1unorm":{f:_u},"etc2-rgb8a1unorm-srgb":{f:_u},"etc2-rgba8unorm":{f:_u},"etc2-rgba8unorm-srgb":{f:_u},"eac-r11unorm":{f:_u},"eac-r11snorm":{f:_u},"eac-rg11unorm":{f:_u},"eac-rg11snorm":{f:_u},"astc-4x4-unorm":{f:En},"astc-4x4-unorm-srgb":{f:En},"astc-5x4-unorm":{f:En},"astc-5x4-unorm-srgb":{f:En},"astc-5x5-unorm":{f:En},"astc-5x5-unorm-srgb":{f:En},"astc-6x5-unorm":{f:En},"astc-6x5-unorm-srgb":{f:En},"astc-6x6-unorm":{f:En},"astc-6x6-unorm-srgb":{f:En},"astc-8x5-unorm":{f:En},"astc-8x5-unorm-srgb":{f:En},"astc-8x6-unorm":{f:En},"astc-8x6-unorm-srgb":{f:En},"astc-8x8-unorm":{f:En},"astc-8x8-unorm-srgb":{f:En},"astc-10x5-unorm":{f:En},"astc-10x5-unorm-srgb":{f:En},"astc-10x6-unorm":{f:En},"astc-10x6-unorm-srgb":{f:En},"astc-10x8-unorm":{f:En},"astc-10x8-unorm-srgb":{f:En},"astc-10x10-unorm":{f:En},"astc-10x10-unorm-srgb":{f:En},"astc-12x10-unorm":{f:En},"astc-12x10-unorm-srgb":{f:En},"astc-12x12-unorm":{f:En},"astc-12x12-unorm-srgb":{f:En},"pvrtc-rgb4unorm-webgl":{f:Nv},"pvrtc-rgba4unorm-webgl":{f:Nv},"pvrtc-rbg2unorm-webgl":{f:Nv},"pvrtc-rgba2unorm-webgl":{f:Nv},"etc1-rbg-unorm-webgl":{f:NL},"atc-rgb-unorm-webgl":{f:Q0},"atc-rgba-unorm-webgl":{f:Q0},"atc-rgbai-unorm-webgl":{f:Q0}},jL={...UL,...VL},$L=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],HL=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class WL{getInfo(t){return dS(t)}isColor(t){return t.startsWith("rgba")||t.startsWith("bgra")||t.startsWith("rgb")}isDepthStencil(t){return t.startsWith("depth")||t.startsWith("stencil")}isCompressed(t){return $L.some(e=>t.startsWith(e))}getCapabilities(t){const e=PC(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},a=dS(t),f=t.startsWith("depth")||t.startsWith("stencil"),m=a?.signed,l=a?.integer,w=a?.webgl;return n.render&&=!m,n.filter&&=!f&&!m&&!l&&!w,n}}const Dg=new WL;function dS(i){let t=qL(i);if(Dg.isCompressed(i)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=XL(i);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const e=HL.exec(i);if(e){const[,n,a,f,m,l]=e,w=`${f}${a}`,C=RC(w),P=C.byteLength*8,L=n.length,j=[P,L>=2?P:0,L>=3?P:0,L>=4?P:0];t={format:i,attachment:t.attachment,dataType:C.signedType,components:L,channels:n,integer:C.integer,signed:C.signed,normalized:C.normalized,bitsPerChannel:j,bytesPerPixel:C.byteLength*n.length,packed:t.packed,srgb:t.srgb},l==="-webgl"&&(t.webgl=!0),m==="-srgb"&&(t.srgb=!0)}return i.endsWith("-webgl")&&(t.webgl=!0),i.endsWith("-srgb")&&(t.srgb=!0),t}function qL(i){const t=PC(i),e=t.bytesPerPixel||1,n=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:i,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:e,bitsPerChannel:n,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function XL(i){const e=/.*-(\d+)x(\d+)-.*/.exec(i);if(e){const[,n,a]=e;return{blockWidth:Number(n),blockHeight:Number(a)}}return null}function ZL(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}function GL(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}class YL{}class KL{features;disabledFeatures;constructor(t=[],e){this.features=new Set(t),this.disabledFeatures=e||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}}class Bp{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(t,e)=>{},onResize:(t,e)=>{const[n,a]=t.getDevicePixelSize();Se.log(1,`${t} resized => ${n}x${a}px`)()},onPositionChange:(t,e)=>{const[n,a]=t.getPosition();Se.log(1,`${t} repositioned => ${n},${a}`)()},onVisibilityChange:t=>Se.log(1,`${t} Visibility changed ${t.isVisible}`)(),onDevicePixelRatioChange:(t,e)=>Se.log(1,`${t} DPR changed ${e.oldRatio} => ${t.devicePixelRatio}`)(),debug:Se.get("debug")||void 0,debugShaders:Se.get("debug-shaders")||void 0,debugFramebuffers:!!Se.get("debug-framebuffers"),debugFactories:!!Se.get("debug-factories"),debugWebGL:!!Se.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=MC;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(t){this.props={...Bp.defaultProps,...t},this.id=this.props.id||Zb(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(t){return Tw(t)}isVertexFormatSupported(t){return!0}getTextureFormatInfo(t){return Dg.getInfo(t)}getTextureFormatCapabilities(t){let e=this._textureCaps[t];if(!e){const n=this._getDeviceTextureFormatCapabilities(t);e=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[t]=e}return e}getMipLevelCount(t,e,n=1){const a=Math.max(t,e,n);return 1+Math.floor(Math.log2(a))}isExternalImage(t){return ZL(t)}getExternalImageSize(t){return GL(t)}isTextureFormatSupported(t){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return Dg.isCompressed(t)}pushDebugGroup(t){this.commandEncoder.pushDebugGroup(t)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(t){this.commandEncoder?.insertDebugMarker(t)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(t,e,...n){return this.props.onError(t,e)?()=>{}:Se.error(t.message,e,...n)}debug(){if(this.props.debug)debugger;else Se.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(t){return this.commandEncoder.beginRenderPass(t)}beginComputePass(t){return this.commandEncoder.beginComputePass(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,e){throw new Error("not implemented")}readPixelsToBufferWebGL(t,e){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,e){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_getDeviceTextureFormatCapabilities(t){const e=Dg.getCapabilities(t),n=f=>(typeof f=="string"?this.features.has(f):f)??!0,a=n(e.create);return{format:t,create:a,render:a&&n(e.render),filter:a&&n(e.filter),blend:a&&n(e.blend),store:a&&n(e.store)}}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e={...t};if((t.usage||0)&Un.INDEX&&(t.indexType||(t.data instanceof Uint32Array?e.indexType="uint32":t.data instanceof Uint16Array&&(e.indexType="uint16")),!e.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return e}}const QL="set luma.log.level=1 (or higher) to trace rendering",pS="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Sb{static defaultProps={...Bp.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=MC;log=Se;VERSION="9.2.4";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Se.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Se.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Se.error("This version of luma.gl has already been initialized")()}Se.log(1,`${this.VERSION} - ${QL}`)(),globalThis.luma=this}async createDevice(t={}){const e={...Sb.defaultProps,...t},n=this.selectAdapter(e.type,e.adapters);if(!n)throw new Error(pS);return e.waitForPageLoad&&await n.pageLoaded,await n.create(e)}async attachDevice(t,e){const n=this._getTypeFromHandle(t,e.adapters),a=n&&this.selectAdapter(n,e.adapters);if(!a)throw new Error(pS);return await a?.attach?.(t,e)}registerAdapters(t){for(const e of t)this.preregisteredAdapters.set(e.type,e)}getSupportedAdapters(t=[]){const e=this._getAdapterMap(t);return Array.from(e).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(t=[]){const e=["webgpu","webgl","null"],n=this._getAdapterMap(t);for(const a of e)if(n.get(a)?.isSupported?.())return a;return null}selectAdapter(t,e=[]){let n=t;t==="best-available"&&(n=this.getBestAvailableAdapterType(e));const a=this._getAdapterMap(e);return n&&a.get(n)||null}enforceWebGL2(t=!0,e=[]){const a=this._getAdapterMap(e).get("webgl");a||Se.warn("enforceWebGL2: webgl adapter not found")(),a?.enforceWebGL2?.(t)}setDefaultDeviceProps(t){Object.assign(Sb.defaultProps,t)}_getAdapterMap(t=[]){const e=new Map(this.preregisteredAdapters);for(const n of t)e.set(n.type,n);return e}_getTypeFromHandle(t,e=[]){return t instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&t instanceof GPUDevice||t?.queue?"webgpu":t===null?"null":(t instanceof WebGLRenderingContext?Se.warn("WebGL1 is not supported",t)():Se.warn("Unknown handle type",t)(),null)}}const n1=new Sb;class JL{get pageLoaded(){return iF()}}const tF=Vp()&&typeof document<"u",eF=()=>tF&&document.readyState==="complete";let Vv=null;function iF(){return Vv||(eF()||typeof window>"u"?Vv=Promise.resolve():Vv=new Promise(i=>window.addEventListener("load",()=>i()))),Vv}function nF(){let i,t;return{promise:new Promise((n,a)=>{i=n,t=a}),resolve:i,reject:t}}class Ep{static isHTMLCanvas(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}static isOffscreenCanvas(t){return typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=nF();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...Ep.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,Vp()?t.canvas?typeof t.canvas=="string"?this.canvas=sF(t.canvas):this.canvas=t.canvas:this.canvas=aF(t):this.canvas={width:t.width||1,height:t.height||1},Ep.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Ep.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Ep.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(t){return"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const t=this.device.limits.maxTextureDimension2D;return[t,t]}setDrawingBufferSize(t,e){this.canvas.width=t,this.canvas.height=e,this.drawingBufferWidth=t,this.drawingBufferHeight=e}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(t,e=!0){const n=this.cssToDeviceRatio(),[a,f]=this.getDrawingBufferSize();return oF(t,n,a,f,e)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[t,e]=this.getDevicePixelSize();return t/e}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),[e]=this.getCSSSize();return e?t/e:1}catch{return 1}}resize(t){this.setDrawingBufferSize(t.width,t.height)}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}_handleIntersection(t){const e=t.find(a=>a.target===this.canvas);if(!e)return;const n=e.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(t){const e=t.find(w=>w.target===this.canvas);if(!e)return;this.cssWidth=e.contentBoxSize[0].inlineSize,this.cssHeight=e.contentBoxSize[0].blockSize;const n=this.getDevicePixelSize(),a=e.devicePixelContentBoxSize?.[0].inlineSize||e.contentBoxSize[0].inlineSize*devicePixelRatio,f=e.devicePixelContentBoxSize?.[0].blockSize||e.contentBoxSize[0].blockSize*devicePixelRatio,[m,l]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(a,m)),this.devicePixelHeight=Math.max(1,Math.min(f,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const t=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*t,this.cssHeight*t)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const t=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:t}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(t=100){const e=setInterval(()=>{this.destroyed?clearInterval(e):this.updatePosition()},t)}updatePosition(){const t=this.htmlCanvas?.getBoundingClientRect();if(t){const e=[t.left,t.top];if(this._position??=e,e[0]!==this._position[0]||e[1]!==this._position[1]){const a=this._position;this._position=e,this.device.props.onPositionChange?.(this,{oldPosition:a})}}}}function rF(i){if(typeof i=="string"){const t=document.getElementById(i);if(!t)throw new Error(`${i} is not an HTML element`);return t}return i||document.body}function sF(i){const t=document.getElementById(i);if(!Ep.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}function aF(i){const{width:t,height:e}=i,n=document.createElement("canvas");n.id=Zb("lumagl-auto-created-canvas"),n.width=t||1,n.height=e||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(e)?`${e}px`:"100%",i?.visible||(n.style.visibility="hidden");const a=rF(i?.container||null);return a.insertBefore(n,a.firstChild),n}function oF(i,t,e,n,a){const f=i,m=mS(f[0],t,e);let l=gS(f[1],t,n,a),w=mS(f[0]+1,t,e);const C=w===e-1?w:w-1;w=gS(f[1]+1,t,n,a);let P;return a?(w=w===0?w:w+1,P=l,l=w):P=w===n-1?w:w-1,{x:m,y:l,width:Math.max(C-m+1,1),height:Math.max(P-l+1,1)}}function mS(i,t,e){return Math.min(Math.round(i*t),e-1)}function gS(i,t,e,n){return n?Math.max(0,e-1-Math.round(i*t)):Math.min(Math.round(i*t),e-1)}class Lp extends Cn{static defaultProps={...Cn.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,e){e=Lp.normalizeProps(t,e),super(t,e,Lp.defaultProps)}static normalizeProps(t,e){return e}}const lF={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class ms extends Cn{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(t,e){if(e=ms.normalizeProps(t,e),super(t,e,ms.defaultProps),this.dimension=this.props.dimension,this.baseDimension=lF[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(t.isExternalImage(e.data)){const n=t.getExternalImageSize(e.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Se.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}setSampler(t){this.sampler=t instanceof Lp?t:this.device.createSampler(t)}clone(t){return this.device.createTexture({...this.props,...t})}static normalizeProps(t,e){const n={...e},{width:a,height:f}=n;return typeof a=="number"&&(n.width=Math.max(1,Math.ceil(a))),typeof f=="number"&&(n.height=Math.max(1,Math.ceil(f))),n}_initializeData(t){this.device.isExternalImage(t)?this.copyExternalImage({image:t,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):t&&this.copyImageData({data:t,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:e,height:n,depth:a}=this,f={...ms.defaultCopyDataOptions,width:e,height:n,depth:a,...t},m=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!m.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return f.bytesPerRow=t.bytesPerRow||e*(m.bytesPerPixel||4),f.rowsPerImage=t.rowsPerImage||n,f}_normalizeCopyExternalImageOptions(t){const e=this.device.getExternalImageSize(t.image),n={...ms.defaultCopyExternalImageOptions,...e,...t};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...Cn.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:ms.TEXTURE|ms.RENDER_ATTACHMENT|ms.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class Gb extends Cn{get[Symbol.toStringTag](){return"TextureView"}constructor(t,e){super(t,e,Gb.defaultProps)}static defaultProps={...Cn.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function cF(i,t,e){let n="";const a=t.split(/\r?\n/),f=i.slice().sort((m,l)=>m.lineNum-l.lineNum);switch(e?.showSourceCode||"no"){case"all":let m=0;for(let l=1;l<=a.length;l++)for(n+=IC(a[l-1],l,e);f.length>m&&f[m].lineNum===l;){const w=f[m++];n+=ix(w,a,w.lineNum,{...e,inlineSource:!1})}for(;f.length>m;){const l=f[m++];n+=ix(l,[],0,{...e,inlineSource:!1})}return n;case"issues":case"no":for(const l of i)n+=ix(l,a,l.lineNum,{inlineSource:e?.showSourceCode!=="no"});return n}}function ix(i,t,e,n){if(n?.inlineSource){const f=uF(t,e),m=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${f}${m}${i.type.toUpperCase()}: ${i.message}

`}const a=i.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${a};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function uF(i,t,e){let n="";for(let a=t-2;a<=t;a++){const f=i[a-1];f!==void 0&&(n+=IC(f,t,e))}return n}function IC(i,t,e){const n=e?.html?fF(i):i;return`${hF(String(t),4)}: ${n}${e?.html?"<br/>":`
`}`}function hF(i,t){let e="";for(let n=i.length;n<t;++n)e+=" ";return e+i}function fF(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Yb extends Cn{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,e){e={...e,debugShaders:e.debugShaders||t.props.debugShaders||"errors"},super(t,{id:dF(e),...e},Yb.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const e=await this.getCompilationInfo();t==="warnings"&&e?.length===0||this._displayShaderLog(e,this.id)}_displayShaderLog(t,e){if(typeof document>"u"||!document?.createElement)return;const n=e,a=`${this.stage} shader "${n}"`;let f=cF(t,this.source,{showSourceCode:"all",html:!0});const m=this.getTranslatedSource();m&&(f+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${m}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Compilation error in ${a}</h1><br /><br />
<code style="user-select:text;"><pre>
${f}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),l.onclick=()=>{const C=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(C)}}static defaultProps={...Cn.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function dF(i){return pF(i.source)||i.id||Zb(`unnamed ${i.stage}-shader`)}function pF(i,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return n?n[1]:t}class Kb extends Cn{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,e={}){super(t,e,Kb.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){const e=this.colorAttachments.map(a=>a.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:e,depthStencilAttachment:n})}resize(t){let e=!t;if(t){const[n,a]=Array.isArray(t)?t:[t.width,t.height];e=e||a!==this.height||n!==this.width,this.width=n,this.height=a}e&&(Se.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,n)=>{if(typeof e=="string"){const a=this.createColorTexture(e,n);return this.attachResource(a),a.view}return e instanceof ms?e.view:e});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const e=this.createDepthStencilTexture(t);this.attachResource(e),this.depthStencilAttachment=e.view}else t instanceof ms?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,e){return this.device.createTexture({id:`${this.id}-color-attachment-${e}`,usage:ms.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ms.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,e){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const a=this.colorAttachments[n].texture.clone({width:t,height:e});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=a.view,this.attachResource(a.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:t,height:e});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...Cn.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Ip extends Cn{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,e){super(t,e,Ip.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Cn.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class wp extends Cn{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(t,e){e=wp.normalizeProps(t,e),super(t,e,wp.defaultProps)}static normalizeProps(t,e){return e}static defaultProps={...Cn.defaultProps,framebuffer:null,parameters:void 0,clearColor:wp.defaultClearColor,clearColors:void 0,clearDepth:wp.defaultClearDepth,clearStencil:wp.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class Ab extends Cn{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,e){super(t,e,Ab.defaultProps),this.shaderLayout=e.shaderLayout}static defaultProps={...Cn.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Sw extends Cn{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,e){super(t,e,Sw.defaultProps)}static defaultProps={...Cn.defaultProps,measureExecutionTime:void 0}}class Aw extends Cn{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,e){super(t,e,Aw.defaultProps)}static defaultProps={...Cn.defaultProps}}function DC(i){return yF[i]}function mF(i){const[t,e]=_F[i],n=t==="i32"||t==="u32",a=t!=="u32",f=gF[t]*e;return{primitiveType:t,components:e,byteLength:f,integer:n,signed:a}}const gF={f32:4,f16:2,i32:4,u32:4},_F={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},yF={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function kC(i,t){const e={};for(const n of i.attributes){const a=bF(i,t,n.name);a&&(e[n.name]=a)}return e}function vF(i,t,e=16){const n=kC(i,t),a=new Array(e).fill(null);for(const f of Object.values(n))a[f.location]=f;return a}function bF(i,t,e){const n=xF(i,e),a=wF(t,e);if(!n)return null;const f=mF(n.type),m=FL(f),l=a?.vertexFormat||m,w=Tw(l);return{attributeName:a?.attributeName||n.name,bufferName:a?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:f.primitiveType,shaderComponents:f.components,vertexFormat:l,bufferDataType:w.type,bufferComponents:w.components,normalized:w.normalized,integer:f.integer,stepMode:a?.stepMode||n.stepMode||"vertex",byteOffset:a?.byteOffset||0,byteStride:a?.byteStride||0}}function xF(i,t){const e=i.attributes.find(n=>n.name===t);return e||Se.warn(`shader layout attribute "${t}" not present in shader`),e||null}function wF(i,t){TF(i);let e=SF(i,t);return e||(e=AF(i,t),e)?e:(Se.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function TF(i){for(const t of i)(t.attributes&&t.format||!t.attributes&&!t.format)&&Se.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function SF(i,t){for(const e of i)if(e.format&&e.name===t)return{attributeName:e.name,bufferName:t,stepMode:e.stepMode,vertexFormat:e.format,byteOffset:0,byteStride:e.byteStride||0};return null}function AF(i,t){for(const e of i){let n=e.byteStride;if(typeof e.byteStride!="number")for(const f of e.attributes||[]){const m=Tw(f.format);n+=m.byteLength}const a=e.attributes?.find(f=>f.attribute===t);if(a)return{attributeName:a.attribute,bufferName:e.name,stepMode:e.stepMode,vertexFormat:a.format,byteOffset:a.byteOffset,byteStride:n}}return null}class Ew extends Cn{static defaultProps={...Cn.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,e){super(t,e,Ew.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=vF(e.shaderLayout,e.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,e){this.device.reportError(new Error("constant attributes not supported"),this)()}}class Cw extends Cn{static defaultProps={...Cn.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,e){super(t,e,Cw.defaultProps)}}class Mw extends Cn{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,e){super(t,e,Mw.defaultProps)}static defaultProps={...Cn.defaultProps,type:void 0,count:void 0}}let jv;function OC(i){return(!jv||jv.byteLength<i)&&(jv=new ArrayBuffer(i)),jv}function EF(i,t){const e=OC(i.BYTES_PER_ELEMENT*t);return new i(e,0,t)}function CF(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Eb(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":CF(i)}const MF=1024;class RF{layout={};byteLength;constructor(t,e={}){let n=0;for(const[f,m]of Object.entries(t)){const l=DC(m),{type:w,components:C}=l,P=C*(e?.[f]??1);n=OL(n,P);const L=n;n+=P,this.layout[f]={type:w,size:P,offset:L}}n+=(4-n%4)%4;const a=n*4;this.byteLength=Math.max(a,MF)}getData(t){const e=OC(this.byteLength),n={i32:new Int32Array(e),u32:new Uint32Array(e),f32:new Float32Array(e),f16:new Uint16Array(e)};for(const[a,f]of Object.entries(t)){const m=this.layout[a];if(!m){Se.warn(`Supplied uniform value ${a} not present in uniform block layout`)();continue}const{type:l,size:w,offset:C}=m,P=n[l];if(w===1){if(typeof f!="number"&&typeof f!="boolean"){Se.warn(`Supplied value for single component uniform ${a} is not a number: ${f}`)();continue}P[C]=Number(f)}else{if(!Eb(f)){Se.warn(`Supplied value for multi component / array uniform ${a} is not a numeric array: ${f}`)();continue}P.set(f,C)}}return new Uint8Array(e,0,this.byteLength)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function PF(i,t,e=16){if(i!==t)return!1;const n=i,a=t;if(!Eb(n))return!1;if(Eb(a)&&n.length===a.length){for(let f=0;f<n.length;++f)if(a[f]!==n[f])return!1}return!0}function IF(i){return Eb(i)?i.slice():i}class DF{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){const e=t?.shaderLayout.bindings?.find(a=>a.type==="uniform"&&a.name===t?.name);if(!e)throw new Error(t?.name);const n=e;for(const a of n.uniforms||[])this.bindingLayout[a.name]=a}}setUniforms(t){for(const[e,n]of Object.entries(t))this._setUniform(e,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${e}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,e){PF(this.uniforms[t],e)||(this.uniforms[t]=IF(e),this.modifiedUniforms[t]=!0,this.modified=!0)}}class kF{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(const[e,n]of Object.entries(t)){const a=e,f=new RF(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(a,f);const m=new DF({name:e});m.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(a,m)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[e,n]of Object.entries(t))this.uniformBlocks.get(e)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){const e=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(e)}createUniformBuffer(t,e,n){n&&this.setUniforms(n);const a=this.getUniformBufferByteLength(e),f=t.createBuffer({usage:Un.UNIFORM|Un.COPY_DST,byteLength:a}),m=this.getUniformBufferData(e);return f.write(m),f}getManagedUniformBuffer(t,e){if(!this.uniformBuffers.get(e)){const n=this.getUniformBufferByteLength(e),a=t.createBuffer({usage:Un.UNIFORM|Un.COPY_DST,byteLength:n});this.uniformBuffers.set(e,a)}return this.uniformBuffers.get(e)}updateUniformBuffers(){let t=!1;for(const e of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(e);t||=n}return t&&Se.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const e=this.uniformBlocks.get(t);let n=this.uniformBuffers.get(t),a=!1;if(n&&e?.needsRedraw){a||=e.needsRedraw;const f=this.getUniformBufferData(t);n=this.uniformBuffers.get(t),n?.write(f);const m=this.uniformBlocks.get(t)?.getAllUniforms();Se.log(4,`Writing to uniform buffer ${String(t)}`,f,m)()}return a}}class Dl{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class _S{constructor(t,e,n){this.name=t,this.type=e,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Wf extends Dl{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Zf extends Dl{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}let r1=class extends Dl{constructor(t,e,n){super(t,n),this.format=e}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}};class Fp extends Dl{constructor(t,e,n,a){super(t,n),this.format=e,this.access=a}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}var $f;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})($f||($f={}));class $v{constructor(t,e,n,a,f,m,l){this.name=t,this.type=e,this.group=n,this.binding=a,this.attributes=f,this.resourceType=m,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class OF{constructor(t,e){this.name=t,this.type=e}}class BF{constructor(t,e,n,a){this.name=t,this.type=e,this.locationType=n,this.location=a,this.interpolation=null}}class yS{constructor(t,e,n,a){this.name=t,this.type=e,this.locationType=n,this.location=a}}class LF{constructor(t,e,n,a){this.name=t,this.type=e,this.attributes=n,this.id=a}}class FF{constructor(t,e,n){this.name=t,this.type=e,this.attributes=n}}class NF{constructor(t,e=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e,this.attributes=n}}class zF{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function UF(i){var t=(32768&i)>>15,e=(31744&i)>>10,n=1023&i;return e==0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):e==31?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,e-15)*(1+n/Math.pow(2,10))}const BC=new Float32Array(1),VF=new Int32Array(BC.buffer),ea=new Uint16Array(1);function jF(i){BC[0]=i;const t=VF[0],e=t>>31&1;let n=t>>23&255,a=8388607&t;if(n===255)return ea[0]=e<<15|31744|(a!==0?512:0),ea[0];if(n===0){if(a===0)return ea[0]=e<<15,ea[0];a|=8388608;let f=113;for(;!(8388608&a);)a<<=1,f--;return n=127-f,a&=8388607,n>0?(a=(a>>126-n)+(a>>127-n&1),ea[0]=e<<15|n<<10|a>>13,ea[0]):(ea[0]=e<<15,ea[0])}return n=n-127+15,n>=31?(ea[0]=e<<15|31744,ea[0]):n<=0?n<-10?(ea[0]=e<<15,ea[0]):(a=(8388608|a)>>1-n,ea[0]=e<<15|a>>13,ea[0]):(a>>=13,ea[0]=e<<15|n<<10|a,ea[0])}const Rw=new Uint32Array(1),LC=new Float32Array(Rw.buffer,0,1);function vS(i){const t=112+(i>>6&31)<<23|(63&i)<<17;return Rw[0]=t,LC[0]}function $F(i,t,e,n,a,f,m,l,w){const C=n*(m>>=a)*(f>>=a)+e*m+t*l;switch(w){case"r8unorm":return[hn(i,C,"8unorm",1)[0]];case"r8snorm":return[hn(i,C,"8snorm",1)[0]];case"r8uint":return[hn(i,C,"8uint",1)[0]];case"r8sint":return[hn(i,C,"8sint",1)[0]];case"rg8unorm":{const P=hn(i,C,"8unorm",2);return[P[0],P[1]]}case"rg8snorm":{const P=hn(i,C,"8snorm",2);return[P[0],P[1]]}case"rg8uint":{const P=hn(i,C,"8uint",2);return[P[0],P[1]]}case"rg8sint":{const P=hn(i,C,"8sint",2);return[P[0],P[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const P=hn(i,C,"8unorm",4);return[P[0],P[1],P[2],P[3]]}case"rgba8snorm":{const P=hn(i,C,"8snorm",4);return[P[0],P[1],P[2],P[3]]}case"rgba8uint":{const P=hn(i,C,"8uint",4);return[P[0],P[1],P[2],P[3]]}case"rgba8sint":{const P=hn(i,C,"8sint",4);return[P[0],P[1],P[2],P[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const P=hn(i,C,"8unorm",4);return[P[2],P[1],P[0],P[3]]}case"r16uint":return[hn(i,C,"16uint",1)[0]];case"r16sint":return[hn(i,C,"16sint",1)[0]];case"r16float":return[hn(i,C,"16float",1)[0]];case"rg16uint":{const P=hn(i,C,"16uint",2);return[P[0],P[1]]}case"rg16sint":{const P=hn(i,C,"16sint",2);return[P[0],P[1]]}case"rg16float":{const P=hn(i,C,"16float",2);return[P[0],P[1]]}case"rgba16uint":{const P=hn(i,C,"16uint",4);return[P[0],P[1],P[2],P[3]]}case"rgba16sint":{const P=hn(i,C,"16sint",4);return[P[0],P[1],P[2],P[3]]}case"rgba16float":{const P=hn(i,C,"16float",4);return[P[0],P[1],P[2],P[3]]}case"r32uint":return[hn(i,C,"32uint",1)[0]];case"r32sint":return[hn(i,C,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[hn(i,C,"32float",1)[0]];case"rg32uint":{const P=hn(i,C,"32uint",2);return[P[0],P[1]]}case"rg32sint":{const P=hn(i,C,"32sint",2);return[P[0],P[1]]}case"rg32float":{const P=hn(i,C,"32float",2);return[P[0],P[1]]}case"rgba32uint":{const P=hn(i,C,"32uint",4);return[P[0],P[1],P[2],P[3]]}case"rgba32sint":{const P=hn(i,C,"32sint",4);return[P[0],P[1],P[2],P[3]]}case"rgba32float":{const P=hn(i,C,"32float",4);return[P[0],P[1],P[2],P[3]]}case"rg11b10ufloat":{const P=new Uint32Array(i.buffer,C,1)[0],L=(4192256&P)>>11,j=(4290772992&P)>>22;return[vS(2047&P),vS(L),(function(G){const nt=112+(G>>5&31)<<23|(31&G)<<18;return Rw[0]=nt,LC[0]})(j),1]}}return null}function hn(i,t,e,n){const a=[0,0,0,0];for(let f=0;f<n;++f)switch(e){case"8unorm":a[f]=i[t]/255,t++;break;case"8snorm":a[f]=i[t]/255*2-1,t++;break;case"8uint":a[f]=i[t],t++;break;case"8sint":a[f]=i[t]-127,t++;break;case"16uint":a[f]=i[t]|i[t+1]<<8,t+=2;break;case"16sint":a[f]=(i[t]|i[t+1]<<8)-32768,t+=2;break;case"16float":a[f]=UF(i[t]|i[t+1]<<8),t+=2;break;case"32uint":case"32sint":a[f]=i[t]|i[t+1]<<8|i[t+2]<<16|i[t+3]<<24,t+=4;break;case"32float":a[f]=new Float32Array(i.buffer,t,1)[0],t+=4}return a}function _n(i,t,e,n,a){for(let f=0;f<n;++f)switch(e){case"8unorm":i[t]=255*a[f],t++;break;case"8snorm":i[t]=.5*(a[f]+1)*255,t++;break;case"8uint":i[t]=a[f],t++;break;case"8sint":i[t]=a[f]+127,t++;break;case"16uint":new Uint16Array(i.buffer,t,1)[0]=a[f],t+=2;break;case"16sint":new Int16Array(i.buffer,t,1)[0]=a[f],t+=2;break;case"16float":{const m=jF(a[f]);new Uint16Array(i.buffer,t,1)[0]=m,t+=2;break}case"32uint":new Uint32Array(i.buffer,t,1)[0]=a[f],t+=4;break;case"32sint":new Int32Array(i.buffer,t,1)[0]=a[f],t+=4;break;case"32float":new Float32Array(i.buffer,t,1)[0]=a[f],t+=4}return a}const nx={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ll{constructor(){this.id=Ll._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,e){if(t){e(Cb.instance);for(const n of t)n instanceof Array?this.searchBlock(n,e):n.search(e);e(Mb.instance)}}constEvaluate(t,e){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}}Ll._id=0;class Cb extends Ll{}Cb.instance=new Cb;class Mb extends Ll{}Mb.instance=new Mb;const FC=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class sr extends Ll{constructor(){super()}}class Sy extends sr{constructor(t,e,n,a,f,m){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=n,this.body=a,this.startLine=f,this.endLine=m}get astNodeType(){return"function"}search(t){if(this.attributes)for(const e of this.attributes)t(e);t(this);for(const e of this.args)t(e);this.searchBlock(this.body,t)}}class HF extends sr{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class NC extends sr{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class s1 extends sr{constructor(t,e){super(),this.body=t,this.loopId=e}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class zC extends sr{constructor(t,e,n,a){super(),this.init=t,this.condition=e,this.increment=n,this.body=a}get astNodeType(){return"for"}search(t){var e,n,a;(e=this.init)===null||e===void 0||e.search(t),(n=this.condition)===null||n===void 0||n.search(t),(a=this.increment)===null||a===void 0||a.search(t),this.searchBlock(this.body,t)}}class Oh extends sr{constructor(t,e,n,a,f){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=a,this.value=f}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class Pw extends sr{constructor(t,e,n){super(),this.attributes=null,this.name=t,this.type=e,this.value=n}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class hy extends sr{constructor(t,e,n,a,f){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=a,this.value=f}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class ab extends sr{constructor(t,e,n,a,f){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=a,this.value=f}get astNodeType(){return"const"}constEvaluate(t,e){return this.value.constEvaluate(t,e)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var Eg,J_,Zt,zt;(i=>{i.increment="++",i.decrement="--"})(Eg||(Eg={})),(i=>{i.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for IncrementOperator");return i[e]}})(Eg||(Eg={}));class UC extends sr{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(J_||(J_={})),(i=>{i.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for AssignOperator");return e}})(J_||(J_={}));class VC extends sr{constructor(t,e,n){super(),this.operator=t,this.variable=e,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class Iw extends sr{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}isBuiltin(){return FC.has(this.name)}search(t){for(const e of this.args)e.search(t);t(this)}}class jC extends sr{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}search(t){var e;this.searchBlock(this.body,t),(e=this.continuing)===null||e===void 0||e.search(t)}}class $C extends sr{constructor(t,e){super(),this.condition=t,this.cases=e}get astNodeType(){return"switch"}search(t){t(this);for(const e of this.cases)e.search(t)}}class HC extends sr{constructor(t,e,n,a){super(),this.condition=t,this.body=e,this.elseif=n,this.else=a}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class WC extends sr{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class WF extends sr{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class qF extends sr{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class qC extends sr{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class Dw extends sr{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class XF extends sr{constructor(){super()}get astNodeType(){return"discard"}}class XC extends sr{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class ZC extends sr{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class be extends sr{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let e=t[0];if(e.name==="f32")return e;for(let n=1;n<t.length;++n){const a=be._priority.get(e.name);be._priority.get(t[n].name)<a&&(e=t[n])}return e.name==="x32"?be.i32:e}getTypeName(){return this.name}}be.x32=new be("x32"),be.f32=new be("f32"),be.i32=new be("i32"),be.u32=new be("u32"),be.f16=new be("f16"),be.bool=new be("bool"),be.void=new be("void"),be._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class bS extends be{constructor(t){super(t)}}class Dh extends be{constructor(t,e,n,a){super(t),this.members=e,this.startLine=n,this.endLine=a}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}search(t){for(const e of this.members)t(e)}}class jt extends be{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}jt.vec2f=new jt("vec2",be.f32,null),jt.vec3f=new jt("vec3",be.f32,null),jt.vec4f=new jt("vec4",be.f32,null),jt.vec2i=new jt("vec2",be.i32,null),jt.vec3i=new jt("vec3",be.i32,null),jt.vec4i=new jt("vec4",be.i32,null),jt.vec2u=new jt("vec2",be.u32,null),jt.vec3u=new jt("vec3",be.u32,null),jt.vec4u=new jt("vec4",be.u32,null),jt.vec2h=new jt("vec2",be.f16,null),jt.vec3h=new jt("vec3",be.f16,null),jt.vec4h=new jt("vec4",be.f16,null),jt.vec2b=new jt("vec2",be.bool,null),jt.vec3b=new jt("vec3",be.bool,null),jt.vec4b=new jt("vec4",be.bool,null),jt.mat2x2f=new jt("mat2x2",be.f32,null),jt.mat2x3f=new jt("mat2x3",be.f32,null),jt.mat2x4f=new jt("mat2x4",be.f32,null),jt.mat3x2f=new jt("mat3x2",be.f32,null),jt.mat3x3f=new jt("mat3x3",be.f32,null),jt.mat3x4f=new jt("mat3x4",be.f32,null),jt.mat4x2f=new jt("mat4x2",be.f32,null),jt.mat4x3f=new jt("mat4x3",be.f32,null),jt.mat4x4f=new jt("mat4x4",be.f32,null),jt.mat2x2h=new jt("mat2x2",be.f16,null),jt.mat2x3h=new jt("mat2x3",be.f16,null),jt.mat2x4h=new jt("mat2x4",be.f16,null),jt.mat3x2h=new jt("mat3x2",be.f16,null),jt.mat3x3h=new jt("mat3x3",be.f16,null),jt.mat3x4h=new jt("mat3x4",be.f16,null),jt.mat4x2h=new jt("mat4x2",be.f16,null),jt.mat4x3h=new jt("mat4x3",be.f16,null),jt.mat4x4h=new jt("mat4x4",be.f16,null),jt.mat2x2i=new jt("mat2x2",be.i32,null),jt.mat2x3i=new jt("mat2x3",be.i32,null),jt.mat2x4i=new jt("mat2x4",be.i32,null),jt.mat3x2i=new jt("mat3x2",be.i32,null),jt.mat3x3i=new jt("mat3x3",be.i32,null),jt.mat3x4i=new jt("mat3x4",be.i32,null),jt.mat4x2i=new jt("mat4x2",be.i32,null),jt.mat4x3i=new jt("mat4x3",be.i32,null),jt.mat4x4i=new jt("mat4x4",be.i32,null),jt.mat2x2u=new jt("mat2x2",be.u32,null),jt.mat2x3u=new jt("mat2x3",be.u32,null),jt.mat2x4u=new jt("mat2x4",be.u32,null),jt.mat3x2u=new jt("mat3x2",be.u32,null),jt.mat3x3u=new jt("mat3x3",be.u32,null),jt.mat3x4u=new jt("mat3x4",be.u32,null),jt.mat4x2u=new jt("mat4x2",be.u32,null),jt.mat4x3u=new jt("mat4x3",be.u32,null),jt.mat4x4u=new jt("mat4x4",be.u32,null);class ob extends be{constructor(t,e,n,a){super(t),this.storage=e,this.type=n,this.access=a}get astNodeType(){return"pointer"}}class fy extends be{constructor(t,e,n,a){super(t),this.attributes=e,this.format=n,this.count=a}get astNodeType(){return"array"}get isArray(){return!0}}class ty extends be{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"sampler"}}class Ic extends Ll{constructor(){super(),this.postfix=null}}class Np extends Ic{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class vu extends Ic{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}constEvaluate(t,e){return e&&(e[0]=this.type),t.evalExpression(this,t.context)}}class kw extends Ic{constructor(t,e){super(),this.cachedReturnValue=null,this.name=t,this.args=e}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return FC.has(this.name)}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){for(const e of this.args)e.search(t);t(this)}}class Wo extends Ic{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,e){return t.evalExpression(this,t.context)}}class GC extends Ic{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}constEvaluate(t,e){if(this.initializer){const n=t.evalExpression(this.initializer,t.context);return n!==null&&this.postfix?n.getSubData(t,this.postfix,t.context):n}return null}search(t){this.initializer.search(t)}}class ds extends Ic{constructor(t,e){super(),this.value=t,this.type=e}get astNodeType(){return"literalExpr"}constEvaluate(t,e){return e!==void 0&&(e[0]=this.type),this.value}get isScalar(){return this.value instanceof Nt}get isVector(){return this.value instanceof vt||this.value instanceof ui}get scalarValue(){return this.value instanceof Nt?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof vt||this.value instanceof ui?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class YC extends Ic{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class Ng extends Ic{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class KC extends Ic{constructor(){super()}}class Kr extends KC{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}}class Mc extends KC{constructor(t,e,n){super(),this.operator=t,this.left=e,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(t,e){return t.name===e.name?t:t.name==="f32"||e.name==="f32"?be.f32:t.name==="u32"||e.name==="u32"?be.u32:be.i32}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}}class QC extends Ll{constructor(t){super(),this.body=t}search(t){t(this),this.searchBlock(this.body,t)}}class lb extends Ic{constructor(){super()}get astNodeType(){return"default"}}class JC extends QC{constructor(t,e){super(e),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class tM extends QC{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class xS extends Ll{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"argument"}}class ZF extends Ll{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class wS extends Ll{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"member"}}class eM extends Ll{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}class Bl{constructor(t,e){this.parent=null,this.typeInfo=t,this.parent=e,this.id=Bl._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,e,n,a){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,e,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Bl._id=0;class a1 extends Bl{constructor(){super(new Dl("void",null),null)}toString(){return"void"}}a1.void=new a1;class gg extends Bl{constructor(t){super(new r1("pointer",t.typeInfo,null),null),this.reference=t}clone(){return this}setDataValue(t,e,n,a){this.reference.setDataValue(t,e,n,a)}getSubData(t,e,n){return e?this.reference.getSubData(t,e,n):this}toString(){return`&${this.reference.toString()}`}}class Nt extends Bl{constructor(t,e,n=null){super(e,n),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!==0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",e)}clone(){if(this.data instanceof Float32Array)return new Nt(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Nt(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Nt(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,e,n,a){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(e instanceof Nt))return void console.error("SetDataValue: Invalid value",e);let f=e.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?f=Math.floor(f):this.typeInfo.name==="bool"&&(f=f?1:0),this.data[0]=f}getSubData(t,e,n){return e?(console.error("getSubData: Scalar data does not support postfix",e),null):this}toString(){return`${this.value}`}}function GF(i,t,e){const n=t.length;return n===2?e==="f32"?new vt(new Float32Array(t),i.getTypeInfo("vec2f")):e==="i32"||e==="bool"?new vt(new Int32Array(t),i.getTypeInfo("vec2i")):e==="u32"?new vt(new Uint32Array(t),i.getTypeInfo("vec2u")):e==="f16"?new vt(new Float32Array(t),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${e}`),null):n===3?e==="f32"?new vt(new Float32Array(t),i.getTypeInfo("vec3f")):e==="i32"||e==="bool"?new vt(new Int32Array(t),i.getTypeInfo("vec3i")):e==="u32"?new vt(new Uint32Array(t),i.getTypeInfo("vec3u")):e==="f16"?new vt(new Float32Array(t),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${e}`),null):n===4?e==="f32"?new vt(new Float32Array(t),i.getTypeInfo("vec4f")):e==="i32"||e==="bool"?new vt(new Int32Array(t),i.getTypeInfo("vec4i")):e==="u32"?new vt(new Uint32Array(t),i.getTypeInfo("vec4u")):e==="f16"?new vt(new Float32Array(t),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${e}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class vt extends Bl{constructor(t,e,n=null){if(super(e,n),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{const a=this.typeInfo.name;a==="vec2f"||a==="vec3f"||a==="vec4f"?this.data=new Float32Array(t):a==="vec2i"||a==="vec3i"||a==="vec4i"?this.data=new Int32Array(t):a==="vec2u"||a==="vec3u"||a==="vec4u"?this.data=new Uint32Array(t):a==="vec2h"||a==="vec3h"||a==="vec4h"?this.data=new Float32Array(t):a==="vec2b"||a==="vec3b"||a==="vec4b"?this.data=new Int32Array(t):a==="vec2"||a==="vec3"||a==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${a}`)}}clone(){if(this.data instanceof Float32Array)return new vt(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new vt(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new vt(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,e,n,a){n instanceof Np?console.error("TODO: Set vector postfix"):e instanceof vt?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,n){if(e===null)return this;let a=t.getTypeInfo("f32");if(this.typeInfo instanceof Fp)a=this.typeInfo.format||a;else{const m=this.typeInfo.name;m==="vec2f"||m==="vec3f"||m==="vec4f"?a=t.getTypeInfo("f32"):m==="vec2i"||m==="vec3i"||m==="vec4i"?a=t.getTypeInfo("i32"):m==="vec2b"||m==="vec3b"||m==="vec4b"?a=t.getTypeInfo("bool"):m==="vec2u"||m==="vec3u"||m==="vec4u"?a=t.getTypeInfo("u32"):m==="vec2h"||m==="vec3h"||m==="vec4h"?a=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${m}`)}let f=this;for(;e!==null&&f!==null;){if(e instanceof Ng){const m=e.index;let l=-1;if(m instanceof ds){if(!(m.value instanceof Nt))return console.error(`GetSubData: Invalid array index ${m.value}`),null;l=m.value.value}else{const w=t.evalExpression(m,n);if(!(w instanceof Nt))return console.error("GetSubData: Unknown index type",m),null;l=w.value}if(l<0||l>=f.data.length)return console.error("GetSubData: Index out of range",l),null;if(f.data instanceof Float32Array){const w=new Float32Array(f.data.buffer,f.data.byteOffset+4*l,1);return new Nt(w,a)}if(f.data instanceof Int32Array){const w=new Int32Array(f.data.buffer,f.data.byteOffset+4*l,1);return new Nt(w,a)}if(f.data instanceof Uint32Array){const w=new Uint32Array(f.data.buffer,f.data.byteOffset+4*l,1);return new Nt(w,a)}throw"GetSubData: Invalid data type"}if(!(e instanceof Np))return console.error("GetSubData: Unknown postfix",e),null;{const m=e.value.toLowerCase();if(m.length===1){let w=0;if(m==="x"||m==="r")w=0;else if(m==="y"||m==="g")w=1;else if(m==="z"||m==="b")w=2;else{if(m!=="w"&&m!=="a")return console.error(`GetSubData: Unknown member ${m}`),null;w=3}if(this.data instanceof Float32Array){let C=new Float32Array(this.data.buffer,this.data.byteOffset+4*w,1);return new Nt(C,a,this)}if(this.data instanceof Int32Array){let C=new Int32Array(this.data.buffer,this.data.byteOffset+4*w,1);return new Nt(C,a,this)}if(this.data instanceof Uint32Array){let C=new Uint32Array(this.data.buffer,this.data.byteOffset+4*w,1);return new Nt(C,a,this)}}const l=[];for(const w of m)w==="x"||w==="r"?l.push(this.data[0]):w==="y"||w==="g"?l.push(this.data[1]):w==="z"||w==="b"?l.push(this.data[2]):w==="w"||w==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${w}`);f=GF(t,l,a.name)}e=e.postfix}return f}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class ui extends Bl{constructor(t,e,n=null){super(e,n),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new ui(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,e,n,a){n instanceof Np?console.error("TODO: Set matrix postfix"):e instanceof ui?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,n){if(e===null)return this;const a=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof Fp)this.typeInfo.format;else if(a.endsWith("f"))t.getTypeInfo("f32");else if(a.endsWith("i"))t.getTypeInfo("i32");else if(a.endsWith("u"))t.getTypeInfo("u32");else{if(!a.endsWith("h"))return console.error(`GetDataValue: Unknown type ${a}`),null;t.getTypeInfo("f16")}if(e instanceof Ng){const f=e.index;let m=-1;if(f instanceof ds){if(!(f.value instanceof Nt))return console.error(`GetDataValue: Invalid array index ${f.value}`),null;m=f.value.value}else{const C=t.evalExpression(f,n);if(!(C instanceof Nt))return console.error("GetDataValue: Unknown index type",f),null;m=C.value}if(m<0||m>=this.data.length)return console.error("GetDataValue: Index out of range",m),null;const l=a.endsWith("h")?"h":"f";let w;if(a==="mat2x2"||a==="mat2x2f"||a==="mat2x2h"||a==="mat3x2"||a==="mat3x2f"||a==="mat3x2h"||a==="mat4x2"||a==="mat4x2f"||a==="mat4x2h")w=new vt(new Float32Array(this.data.buffer,this.data.byteOffset+2*m*4,2),t.getTypeInfo(`vec2${l}`));else if(a==="mat2x3"||a==="mat2x3f"||a==="mat2x3h"||a==="mat3x3"||a==="mat3x3f"||a==="mat3x3h"||a==="mat4x3"||a==="mat4x3f"||a==="mat4x3h")w=new vt(new Float32Array(this.data.buffer,this.data.byteOffset+3*m*4,3),t.getTypeInfo(`vec3${l}`));else{if(a!=="mat2x4"&&a!=="mat2x4f"&&a!=="mat2x4h"&&a!=="mat3x4"&&a!=="mat3x4f"&&a!=="mat3x4h"&&a!=="mat4x4"&&a!=="mat4x4f"&&a!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${a}`),null;w=new vt(new Float32Array(this.data.buffer,this.data.byteOffset+4*m*4,4),t.getTypeInfo(`vec4${l}`))}return e.postfix?w.getSubData(t,e.postfix,n):w}return console.error("GetDataValue: Invalid postfix",e),null}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class Sr extends Bl{constructor(t,e,n=0,a=null){super(e,a),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=n}clone(){const t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Sr(t.buffer,this.typeInfo,0,null)}setDataValue(t,e,n,a){if(e===null)return void console.log("setDataValue: NULL data.");let f=this.offset,m=this.typeInfo;for(;n;){if(n instanceof Ng)if(m instanceof Zf){const l=n.index;if(l instanceof ds){if(!(l.value instanceof Nt))return void console.error(`SetDataValue: Invalid index type ${l.value}`);f+=l.value.value*m.stride}else{const w=t.evalExpression(l,a);if(!(w instanceof Nt))return void console.error("SetDataValue: Unknown index type",l);f+=w.value*m.stride}m=m.format}else console.error(`SetDataValue: Type ${m.getTypeName()} is not an array`);else{if(!(n instanceof Np))return void console.error("SetDataValue: Unknown postfix type",n);{const l=n.value;if(m instanceof Wf){let w=!1;for(const C of m.members)if(C.name===l){f+=C.offset,m=C.type,w=!0;break}if(!w)return void console.error(`SetDataValue: Member ${l} not found`)}else if(m instanceof Dl){const w=m.getTypeName();let C=0;if(l==="x"||l==="r")C=0;else if(l==="y"||l==="g")C=1;else if(l==="z"||l==="b")C=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);C=3}if(!(e instanceof Nt))return void console.error("SetDataValue: Invalid value",e);const P=e.value;return w==="vec2f"?void(new Float32Array(this.buffer,f,2)[C]=P):w==="vec3f"?void(new Float32Array(this.buffer,f,3)[C]=P):w==="vec4f"?void(new Float32Array(this.buffer,f,4)[C]=P):w==="vec2i"?void(new Int32Array(this.buffer,f,2)[C]=P):w==="vec3i"?void(new Int32Array(this.buffer,f,3)[C]=P):w==="vec4i"?void(new Int32Array(this.buffer,f,4)[C]=P):w==="vec2u"?void(new Uint32Array(this.buffer,f,2)[C]=P):w==="vec3u"?void(new Uint32Array(this.buffer,f,3)[C]=P):w==="vec4u"?void(new Uint32Array(this.buffer,f,4)[C]=P):void console.error(`SetDataValue: Type ${w} is not a struct`)}}}n=n.postfix}this.setData(t,e,m,f,a)}setData(t,e,n,a,f){const m=n.getTypeName();if(m!=="f32"&&m!=="f16")if(m!=="i32"&&m!=="atomic<i32>"&&m!=="x32")if(m!=="u32"&&m!=="atomic<u32>")if(m!=="bool"){if(m==="vec2f"||m==="vec2h"){const l=new Float32Array(this.buffer,a,2);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(m==="vec3f"||m==="vec3h"){const l=new Float32Array(this.buffer,a,3);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(m==="vec4f"||m==="vec4h"){const l=new Float32Array(this.buffer,a,4);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(m==="vec2i"){const l=new Int32Array(this.buffer,a,2);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(m==="vec3i"){const l=new Int32Array(this.buffer,a,3);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(m==="vec4i"){const l=new Int32Array(this.buffer,a,4);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(m==="vec2u"){const l=new Uint32Array(this.buffer,a,2);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(m==="vec3u"){const l=new Uint32Array(this.buffer,a,3);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(m==="vec4u"){const l=new Uint32Array(this.buffer,a,4);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(m==="vec2b"){const l=new Uint32Array(this.buffer,a,2);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(m==="vec3b"){const l=new Uint32Array(this.buffer,a,3);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(m==="vec4b"){const l=new Uint32Array(this.buffer,a,4);return void(e instanceof vt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(m==="mat2x2f"||m==="mat2x2h"){const l=new Float32Array(this.buffer,a,4);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(m==="mat2x3f"||m==="mat2x3h"){const l=new Float32Array(this.buffer,a,6);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5]))}if(m==="mat2x4f"||m==="mat2x4h"){const l=new Float32Array(this.buffer,a,8);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7]))}if(m==="mat3x2f"||m==="mat3x2h"){const l=new Float32Array(this.buffer,a,6);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5]))}if(m==="mat3x3f"||m==="mat3x3h"){const l=new Float32Array(this.buffer,a,9);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8]))}if(m==="mat3x4f"||m==="mat3x4h"){const l=new Float32Array(this.buffer,a,12);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11]))}if(m==="mat4x2f"||m==="mat4x2h"){const l=new Float32Array(this.buffer,a,8);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7]))}if(m==="mat4x3f"||m==="mat4x3h"){const l=new Float32Array(this.buffer,a,12);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11]))}if(m==="mat4x4f"||m==="mat4x4h"){const l=new Float32Array(this.buffer,a,16);return void(e instanceof ui?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11],l[12]=e.data[12],l[13]=e.data[13],l[14]=e.data[14],l[15]=e.data[15]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11],l[12]=e[12],l[13]=e[13],l[14]=e[14],l[15]=e[15]))}if(e instanceof Sr){if(n===e.typeInfo)return void new Uint8Array(this.buffer,a,e.buffer.byteLength).set(new Uint8Array(e.buffer));console.error("SetDataValue: Type mismatch",m,e.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${m}`)}else e instanceof Nt&&(new Int32Array(this.buffer,a,1)[0]=e.value);else e instanceof Nt&&(new Uint32Array(this.buffer,a,1)[0]=e.value);else e instanceof Nt&&(new Int32Array(this.buffer,a,1)[0]=e.value);else e instanceof Nt&&(new Float32Array(this.buffer,a,1)[0]=e.value)}getSubData(t,e,n){var a,f,m;if(e===null)return this;let l=this.offset,w=this.typeInfo;for(;e;){if(e instanceof Ng){const P=e.index,L=P instanceof Ic?t.evalExpression(P,n):P;let j=0;if(L instanceof Nt?j=L.value:typeof L=="number"?j=L:console.error("GetDataValue: Invalid index type",P),w instanceof Zf)l+=j*w.stride,w=w.format;else{const G=w.getTypeName();G==="mat4x4"||G==="mat4x4f"||G==="mat4x4h"?(l+=16*j,w=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${w.getTypeName()} is not an array`)}}else{if(!(e instanceof Np))return console.error("GetDataValue: Unknown postfix type",e),null;{const P=e.value;if(w instanceof Wf){let L=!1;for(const j of w.members)if(j.name===P){l+=j.offset,w=j.type,L=!0;break}if(!L)return console.error(`GetDataValue: Member ${P} not found`),null}else if(w instanceof Dl){const L=w.getTypeName();if(L==="vec2f"||L==="vec3f"||L==="vec4f"||L==="vec2i"||L==="vec3i"||L==="vec4i"||L==="vec2u"||L==="vec3u"||L==="vec4u"||L==="vec2b"||L==="vec3b"||L==="vec4b"||L==="vec2h"||L==="vec3h"||L==="vec4h"||L==="vec2"||L==="vec3"||L==="vec4"){if(P.length>0&&P.length<5){let j="f";const G=[];for(let nt=0;nt<P.length;++nt){const at=P[nt].toLowerCase();let J=0;if(at==="x"||at==="r")J=0;else if(at==="y"||at==="g")J=1;else if(at==="z"||at==="b")J=2;else{if(at!=="w"&&at!=="a")return console.error(`Unknown member ${P}`),null;J=3}if(P.length===1){if(L.endsWith("f"))return this.buffer.byteLength<l+4*J+4?(console.log("Insufficient buffer data"),null):new Nt(new Float32Array(this.buffer,l+4*J,1),t.getTypeInfo("f32"),this);if(L.endsWith("h"))return new Nt(new Float32Array(this.buffer,l+4*J,1),t.getTypeInfo("f16"),this);if(L.endsWith("i"))return new Nt(new Int32Array(this.buffer,l+4*J,1),t.getTypeInfo("i32"),this);if(L.endsWith("b"))return new Nt(new Int32Array(this.buffer,l+4*J,1),t.getTypeInfo("bool"),this);if(L.endsWith("u"))return new Nt(new Uint32Array(this.buffer,l+4*J,1),t.getTypeInfo("i32"),this)}if(L==="vec2f")G.push(new Float32Array(this.buffer,l,2)[J]);else if(L==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const mt=new Float32Array(this.buffer,l,3);G.push(mt[J])}else if(L==="vec4f")G.push(new Float32Array(this.buffer,l,4)[J]);else if(L==="vec2i")j="i",G.push(new Int32Array(this.buffer,l,2)[J]);else if(L==="vec3i")j="i",G.push(new Int32Array(this.buffer,l,3)[J]);else if(L==="vec4i")j="i",G.push(new Int32Array(this.buffer,l,4)[J]);else if(L==="vec2u"){j="u";const mt=new Uint32Array(this.buffer,l,2);G.push(mt[J])}else L==="vec3u"?(j="u",G.push(new Uint32Array(this.buffer,l,3)[J])):L==="vec4u"&&(j="u",G.push(new Uint32Array(this.buffer,l,4)[J]))}return G.length===2?w=t.getTypeInfo(`vec2${j}`):G.length===3?w=t.getTypeInfo(`vec3${j}`):G.length===4?w=t.getTypeInfo(`vec4${j}`):console.error(`GetDataValue: Invalid vector length ${G.length}`),new vt(G,w,null)}return console.error(`GetDataValue: Unknown member ${P}`),null}return console.error(`GetDataValue: Type ${L} is not a struct`),null}}}e=e.postfix}const C=w.getTypeName();return C==="f32"?new Nt(new Float32Array(this.buffer,l,1),w,this):C==="i32"?new Nt(new Int32Array(this.buffer,l,1),w,this):C==="u32"?new Nt(new Uint32Array(this.buffer,l,1),w,this):C==="vec2f"?new vt(new Float32Array(this.buffer,l,2),w,this):C==="vec3f"?new vt(new Float32Array(this.buffer,l,3),w,this):C==="vec4f"?new vt(new Float32Array(this.buffer,l,4),w,this):C==="vec2i"?new vt(new Int32Array(this.buffer,l,2),w,this):C==="vec3i"?new vt(new Int32Array(this.buffer,l,3),w,this):C==="vec4i"?new vt(new Int32Array(this.buffer,l,4),w,this):C==="vec2u"?new vt(new Uint32Array(this.buffer,l,2),w,this):C==="vec3u"?new vt(new Uint32Array(this.buffer,l,3),w,this):C==="vec4u"?new vt(new Uint32Array(this.buffer,l,4),w,this):w instanceof Fp&&w.name==="atomic"?((a=w.format)===null||a===void 0?void 0:a.name)==="u32"?new Nt(new Uint32Array(this.buffer,l,1)[0],w.format,this):((f=w.format)===null||f===void 0?void 0:f.name)==="i32"?new Nt(new Int32Array(this.buffer,l,1)[0],w.format,this):(console.error(`GetDataValue: Invalid atomic format ${(m=w.format)===null||m===void 0?void 0:m.name}`),null):new Sr(this.buffer,w,l,this)}toString(){let t="";if(this.typeInfo instanceof Zf)if(this.typeInfo.format.name==="f32"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="i32"){const e=new Int32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="u32"){const e=new Uint32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="vec2f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}]`;for(let n=1;n<e.length/2;++n)t+=`, [${e[2*n]}, ${e[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}]`;for(let n=4;n<e.length;n+=4)t+=`, [${e[n]}, ${e[n+1]}, ${e[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}]`;for(let n=4;n<e.length;n+=4)t+=`, [${e[n]}, ${e[n+1]}, ${e[n+2]}, ${e[n+3]}]`}else t="[...]";else this.typeInfo instanceof Wf?t+="{...}":t="[...]";return t}}class kh extends Bl{constructor(t,e,n,a){super(e,null),this.data=t,this.descriptor=n,this.view=a}clone(){return new kh(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(t=n[0])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.width)!==null&&e!==void 0?e:0}get height(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(t=n[1])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.height)!==null&&e!==void 0?e:0}get depthOrArrayLayers(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(t=n[2])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.depthOrArrayLayers)!==null&&e!==void 0?e:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];const e=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<e.length;++n)e[n]=Math.max(1,e[n]>>t);return e}get texelByteSize(){const t=this.format,e=nx[t];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const t=this.format,e=nx[t];return!!e&&e.isDepthStencil}getGpuSize(){const t=this.format,e=nx[t],n=this.width;if(!t||n<=0||!e)return-1;const a=this.height,f=this.depthOrArrayLayers,m=this.dimension;return n/e.blockWidth*(m==="1d"?1:a/e.blockHeight)*e.bytesPerBlock*f}getPixel(t,e,n=0,a=0){const f=this.texelByteSize,m=this.bytesPerRow,l=this.height,w=this.data[a];return $F(new Uint8Array(w),t,e,n,a,l,m,f,this.format)}setPixel(t,e,n,a,f){const m=this.texelByteSize,l=this.bytesPerRow,w=this.height,C=this.data[a];(function(P,L,j,G,nt,at,J,mt,Mt,pt){const Pt=G*(J>>=nt)*(at>>=nt)+j*J+L*mt;switch(Mt){case"r8unorm":return void _n(P,Pt,"8unorm",1,pt);case"r8snorm":return void _n(P,Pt,"8snorm",1,pt);case"r8uint":return void _n(P,Pt,"8uint",1,pt);case"r8sint":return void _n(P,Pt,"8sint",1,pt);case"rg8unorm":return void _n(P,Pt,"8unorm",2,pt);case"rg8snorm":return void _n(P,Pt,"8snorm",2,pt);case"rg8uint":return void _n(P,Pt,"8uint",2,pt);case"rg8sint":return void _n(P,Pt,"8sint",2,pt);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void _n(P,Pt,"8unorm",4,pt);case"rgba8snorm":return void _n(P,Pt,"8snorm",4,pt);case"rgba8uint":return void _n(P,Pt,"8uint",4,pt);case"rgba8sint":return void _n(P,Pt,"8sint",4,pt);case"r16uint":return void _n(P,Pt,"16uint",1,pt);case"r16sint":return void _n(P,Pt,"16sint",1,pt);case"r16float":return void _n(P,Pt,"16float",1,pt);case"rg16uint":return void _n(P,Pt,"16uint",2,pt);case"rg16sint":return void _n(P,Pt,"16sint",2,pt);case"rg16float":return void _n(P,Pt,"16float",2,pt);case"rgba16uint":return void _n(P,Pt,"16uint",4,pt);case"rgba16sint":return void _n(P,Pt,"16sint",4,pt);case"rgba16float":return void _n(P,Pt,"16float",4,pt);case"r32uint":return void _n(P,Pt,"32uint",1,pt);case"r32sint":return void _n(P,Pt,"32sint",1,pt);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void _n(P,Pt,"32float",1,pt);case"rg32uint":return void _n(P,Pt,"32uint",2,pt);case"rg32sint":return void _n(P,Pt,"32sint",2,pt);case"rg32float":return void _n(P,Pt,"32float",2,pt);case"rgba32uint":return void _n(P,Pt,"32uint",4,pt);case"rgba32sint":return void _n(P,Pt,"32sint",4,pt);case"rgba32float":return void _n(P,Pt,"32float",4,pt);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(C),t,e,n,a,w,l,m,this.format,f)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(zt||(zt={}));class Ut{constructor(t,e,n){this.name=t,this.type=e,this.rule=n}toString(){return this.name}}class dt{}Zt=dt,dt.none=new Ut("",zt.reserved,""),dt.eof=new Ut("EOF",zt.token,""),dt.reserved={asm:new Ut("asm",zt.reserved,"asm"),bf16:new Ut("bf16",zt.reserved,"bf16"),do:new Ut("do",zt.reserved,"do"),enum:new Ut("enum",zt.reserved,"enum"),f16:new Ut("f16",zt.reserved,"f16"),f64:new Ut("f64",zt.reserved,"f64"),handle:new Ut("handle",zt.reserved,"handle"),i8:new Ut("i8",zt.reserved,"i8"),i16:new Ut("i16",zt.reserved,"i16"),i64:new Ut("i64",zt.reserved,"i64"),mat:new Ut("mat",zt.reserved,"mat"),premerge:new Ut("premerge",zt.reserved,"premerge"),regardless:new Ut("regardless",zt.reserved,"regardless"),typedef:new Ut("typedef",zt.reserved,"typedef"),u8:new Ut("u8",zt.reserved,"u8"),u16:new Ut("u16",zt.reserved,"u16"),u64:new Ut("u64",zt.reserved,"u64"),unless:new Ut("unless",zt.reserved,"unless"),using:new Ut("using",zt.reserved,"using"),vec:new Ut("vec",zt.reserved,"vec"),void:new Ut("void",zt.reserved,"void")},dt.keywords={array:new Ut("array",zt.keyword,"array"),atomic:new Ut("atomic",zt.keyword,"atomic"),bool:new Ut("bool",zt.keyword,"bool"),f32:new Ut("f32",zt.keyword,"f32"),i32:new Ut("i32",zt.keyword,"i32"),mat2x2:new Ut("mat2x2",zt.keyword,"mat2x2"),mat2x3:new Ut("mat2x3",zt.keyword,"mat2x3"),mat2x4:new Ut("mat2x4",zt.keyword,"mat2x4"),mat3x2:new Ut("mat3x2",zt.keyword,"mat3x2"),mat3x3:new Ut("mat3x3",zt.keyword,"mat3x3"),mat3x4:new Ut("mat3x4",zt.keyword,"mat3x4"),mat4x2:new Ut("mat4x2",zt.keyword,"mat4x2"),mat4x3:new Ut("mat4x3",zt.keyword,"mat4x3"),mat4x4:new Ut("mat4x4",zt.keyword,"mat4x4"),ptr:new Ut("ptr",zt.keyword,"ptr"),sampler:new Ut("sampler",zt.keyword,"sampler"),sampler_comparison:new Ut("sampler_comparison",zt.keyword,"sampler_comparison"),struct:new Ut("struct",zt.keyword,"struct"),texture_1d:new Ut("texture_1d",zt.keyword,"texture_1d"),texture_2d:new Ut("texture_2d",zt.keyword,"texture_2d"),texture_2d_array:new Ut("texture_2d_array",zt.keyword,"texture_2d_array"),texture_3d:new Ut("texture_3d",zt.keyword,"texture_3d"),texture_cube:new Ut("texture_cube",zt.keyword,"texture_cube"),texture_cube_array:new Ut("texture_cube_array",zt.keyword,"texture_cube_array"),texture_multisampled_2d:new Ut("texture_multisampled_2d",zt.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ut("texture_storage_1d",zt.keyword,"texture_storage_1d"),texture_storage_2d:new Ut("texture_storage_2d",zt.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ut("texture_storage_2d_array",zt.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ut("texture_storage_3d",zt.keyword,"texture_storage_3d"),texture_depth_2d:new Ut("texture_depth_2d",zt.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ut("texture_depth_2d_array",zt.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ut("texture_depth_cube",zt.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ut("texture_depth_cube_array",zt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ut("texture_depth_multisampled_2d",zt.keyword,"texture_depth_multisampled_2d"),texture_external:new Ut("texture_external",zt.keyword,"texture_external"),u32:new Ut("u32",zt.keyword,"u32"),vec2:new Ut("vec2",zt.keyword,"vec2"),vec3:new Ut("vec3",zt.keyword,"vec3"),vec4:new Ut("vec4",zt.keyword,"vec4"),bitcast:new Ut("bitcast",zt.keyword,"bitcast"),block:new Ut("block",zt.keyword,"block"),break:new Ut("break",zt.keyword,"break"),case:new Ut("case",zt.keyword,"case"),continue:new Ut("continue",zt.keyword,"continue"),continuing:new Ut("continuing",zt.keyword,"continuing"),default:new Ut("default",zt.keyword,"default"),diagnostic:new Ut("diagnostic",zt.keyword,"diagnostic"),discard:new Ut("discard",zt.keyword,"discard"),else:new Ut("else",zt.keyword,"else"),enable:new Ut("enable",zt.keyword,"enable"),fallthrough:new Ut("fallthrough",zt.keyword,"fallthrough"),false:new Ut("false",zt.keyword,"false"),fn:new Ut("fn",zt.keyword,"fn"),for:new Ut("for",zt.keyword,"for"),function:new Ut("function",zt.keyword,"function"),if:new Ut("if",zt.keyword,"if"),let:new Ut("let",zt.keyword,"let"),const:new Ut("const",zt.keyword,"const"),loop:new Ut("loop",zt.keyword,"loop"),while:new Ut("while",zt.keyword,"while"),private:new Ut("private",zt.keyword,"private"),read:new Ut("read",zt.keyword,"read"),read_write:new Ut("read_write",zt.keyword,"read_write"),return:new Ut("return",zt.keyword,"return"),requires:new Ut("requires",zt.keyword,"requires"),storage:new Ut("storage",zt.keyword,"storage"),switch:new Ut("switch",zt.keyword,"switch"),true:new Ut("true",zt.keyword,"true"),alias:new Ut("alias",zt.keyword,"alias"),type:new Ut("type",zt.keyword,"type"),uniform:new Ut("uniform",zt.keyword,"uniform"),var:new Ut("var",zt.keyword,"var"),override:new Ut("override",zt.keyword,"override"),workgroup:new Ut("workgroup",zt.keyword,"workgroup"),write:new Ut("write",zt.keyword,"write"),r8unorm:new Ut("r8unorm",zt.keyword,"r8unorm"),r8snorm:new Ut("r8snorm",zt.keyword,"r8snorm"),r8uint:new Ut("r8uint",zt.keyword,"r8uint"),r8sint:new Ut("r8sint",zt.keyword,"r8sint"),r16uint:new Ut("r16uint",zt.keyword,"r16uint"),r16sint:new Ut("r16sint",zt.keyword,"r16sint"),r16float:new Ut("r16float",zt.keyword,"r16float"),rg8unorm:new Ut("rg8unorm",zt.keyword,"rg8unorm"),rg8snorm:new Ut("rg8snorm",zt.keyword,"rg8snorm"),rg8uint:new Ut("rg8uint",zt.keyword,"rg8uint"),rg8sint:new Ut("rg8sint",zt.keyword,"rg8sint"),r32uint:new Ut("r32uint",zt.keyword,"r32uint"),r32sint:new Ut("r32sint",zt.keyword,"r32sint"),r32float:new Ut("r32float",zt.keyword,"r32float"),rg16uint:new Ut("rg16uint",zt.keyword,"rg16uint"),rg16sint:new Ut("rg16sint",zt.keyword,"rg16sint"),rg16float:new Ut("rg16float",zt.keyword,"rg16float"),rgba8unorm:new Ut("rgba8unorm",zt.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ut("rgba8unorm_srgb",zt.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ut("rgba8snorm",zt.keyword,"rgba8snorm"),rgba8uint:new Ut("rgba8uint",zt.keyword,"rgba8uint"),rgba8sint:new Ut("rgba8sint",zt.keyword,"rgba8sint"),bgra8unorm:new Ut("bgra8unorm",zt.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ut("bgra8unorm_srgb",zt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ut("rgb10a2unorm",zt.keyword,"rgb10a2unorm"),rg11b10float:new Ut("rg11b10float",zt.keyword,"rg11b10float"),rg32uint:new Ut("rg32uint",zt.keyword,"rg32uint"),rg32sint:new Ut("rg32sint",zt.keyword,"rg32sint"),rg32float:new Ut("rg32float",zt.keyword,"rg32float"),rgba16uint:new Ut("rgba16uint",zt.keyword,"rgba16uint"),rgba16sint:new Ut("rgba16sint",zt.keyword,"rgba16sint"),rgba16float:new Ut("rgba16float",zt.keyword,"rgba16float"),rgba32uint:new Ut("rgba32uint",zt.keyword,"rgba32uint"),rgba32sint:new Ut("rgba32sint",zt.keyword,"rgba32sint"),rgba32float:new Ut("rgba32float",zt.keyword,"rgba32float"),static_assert:new Ut("static_assert",zt.keyword,"static_assert")},dt.tokens={decimal_float_literal:new Ut("decimal_float_literal",zt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Ut("hex_float_literal",zt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Ut("int_literal",zt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ut("uint_literal",zt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Ut("name",zt.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Ut("ident",zt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ut("and",zt.token,"&"),and_and:new Ut("and_and",zt.token,"&&"),arrow:new Ut("arrow ",zt.token,"->"),attr:new Ut("attr",zt.token,"@"),forward_slash:new Ut("forward_slash",zt.token,"/"),bang:new Ut("bang",zt.token,"!"),bracket_left:new Ut("bracket_left",zt.token,"["),bracket_right:new Ut("bracket_right",zt.token,"]"),brace_left:new Ut("brace_left",zt.token,"{"),brace_right:new Ut("brace_right",zt.token,"}"),colon:new Ut("colon",zt.token,":"),comma:new Ut("comma",zt.token,","),equal:new Ut("equal",zt.token,"="),equal_equal:new Ut("equal_equal",zt.token,"=="),not_equal:new Ut("not_equal",zt.token,"!="),greater_than:new Ut("greater_than",zt.token,">"),greater_than_equal:new Ut("greater_than_equal",zt.token,">="),shift_right:new Ut("shift_right",zt.token,">>"),less_than:new Ut("less_than",zt.token,"<"),less_than_equal:new Ut("less_than_equal",zt.token,"<="),shift_left:new Ut("shift_left",zt.token,"<<"),modulo:new Ut("modulo",zt.token,"%"),minus:new Ut("minus",zt.token,"-"),minus_minus:new Ut("minus_minus",zt.token,"--"),period:new Ut("period",zt.token,"."),plus:new Ut("plus",zt.token,"+"),plus_plus:new Ut("plus_plus",zt.token,"++"),or:new Ut("or",zt.token,"|"),or_or:new Ut("or_or",zt.token,"||"),paren_left:new Ut("paren_left",zt.token,"("),paren_right:new Ut("paren_right",zt.token,")"),semicolon:new Ut("semicolon",zt.token,";"),star:new Ut("star",zt.token,"*"),tilde:new Ut("tilde",zt.token,"~"),underscore:new Ut("underscore",zt.token,"_"),xor:new Ut("xor",zt.token,"^"),plus_equal:new Ut("plus_equal",zt.token,"+="),minus_equal:new Ut("minus_equal",zt.token,"-="),times_equal:new Ut("times_equal",zt.token,"*="),division_equal:new Ut("division_equal",zt.token,"/="),modulo_equal:new Ut("modulo_equal",zt.token,"%="),and_equal:new Ut("and_equal",zt.token,"&="),or_equal:new Ut("or_equal",zt.token,"|="),xor_equal:new Ut("xor_equal",zt.token,"^="),shift_right_equal:new Ut("shift_right_equal",zt.token,">>="),shift_left_equal:new Ut("shift_left_equal",zt.token,"<<=")},dt.simpleTokens={"@":Zt.tokens.attr,"{":Zt.tokens.brace_left,"}":Zt.tokens.brace_right,":":Zt.tokens.colon,",":Zt.tokens.comma,"(":Zt.tokens.paren_left,")":Zt.tokens.paren_right,";":Zt.tokens.semicolon},dt.literalTokens={"&":Zt.tokens.and,"&&":Zt.tokens.and_and,"->":Zt.tokens.arrow,"/":Zt.tokens.forward_slash,"!":Zt.tokens.bang,"[":Zt.tokens.bracket_left,"]":Zt.tokens.bracket_right,"=":Zt.tokens.equal,"==":Zt.tokens.equal_equal,"!=":Zt.tokens.not_equal,">":Zt.tokens.greater_than,">=":Zt.tokens.greater_than_equal,">>":Zt.tokens.shift_right,"<":Zt.tokens.less_than,"<=":Zt.tokens.less_than_equal,"<<":Zt.tokens.shift_left,"%":Zt.tokens.modulo,"-":Zt.tokens.minus,"--":Zt.tokens.minus_minus,".":Zt.tokens.period,"+":Zt.tokens.plus,"++":Zt.tokens.plus_plus,"|":Zt.tokens.or,"||":Zt.tokens.or_or,"*":Zt.tokens.star,"~":Zt.tokens.tilde,_:Zt.tokens.underscore,"^":Zt.tokens.xor,"+=":Zt.tokens.plus_equal,"-=":Zt.tokens.minus_equal,"*=":Zt.tokens.times_equal,"/=":Zt.tokens.division_equal,"%=":Zt.tokens.modulo_equal,"&=":Zt.tokens.and_equal,"|=":Zt.tokens.or_equal,"^=":Zt.tokens.xor_equal,">>=":Zt.tokens.shift_right_equal,"<<=":Zt.tokens.shift_left_equal},dt.regexTokens={decimal_float_literal:Zt.tokens.decimal_float_literal,hex_float_literal:Zt.tokens.hex_float_literal,int_literal:Zt.tokens.int_literal,uint_literal:Zt.tokens.uint_literal,ident:Zt.tokens.ident},dt.storage_class=[Zt.keywords.function,Zt.keywords.private,Zt.keywords.workgroup,Zt.keywords.uniform,Zt.keywords.storage],dt.access_mode=[Zt.keywords.read,Zt.keywords.write,Zt.keywords.read_write],dt.sampler_type=[Zt.keywords.sampler,Zt.keywords.sampler_comparison],dt.sampled_texture_type=[Zt.keywords.texture_1d,Zt.keywords.texture_2d,Zt.keywords.texture_2d_array,Zt.keywords.texture_3d,Zt.keywords.texture_cube,Zt.keywords.texture_cube_array],dt.multisampled_texture_type=[Zt.keywords.texture_multisampled_2d],dt.storage_texture_type=[Zt.keywords.texture_storage_1d,Zt.keywords.texture_storage_2d,Zt.keywords.texture_storage_2d_array,Zt.keywords.texture_storage_3d],dt.depth_texture_type=[Zt.keywords.texture_depth_2d,Zt.keywords.texture_depth_2d_array,Zt.keywords.texture_depth_cube,Zt.keywords.texture_depth_cube_array,Zt.keywords.texture_depth_multisampled_2d],dt.texture_external_type=[Zt.keywords.texture_external],dt.any_texture_type=[...Zt.sampled_texture_type,...Zt.multisampled_texture_type,...Zt.storage_texture_type,...Zt.depth_texture_type,...Zt.texture_external_type],dt.texel_format=[Zt.keywords.r8unorm,Zt.keywords.r8snorm,Zt.keywords.r8uint,Zt.keywords.r8sint,Zt.keywords.r16uint,Zt.keywords.r16sint,Zt.keywords.r16float,Zt.keywords.rg8unorm,Zt.keywords.rg8snorm,Zt.keywords.rg8uint,Zt.keywords.rg8sint,Zt.keywords.r32uint,Zt.keywords.r32sint,Zt.keywords.r32float,Zt.keywords.rg16uint,Zt.keywords.rg16sint,Zt.keywords.rg16float,Zt.keywords.rgba8unorm,Zt.keywords.rgba8unorm_srgb,Zt.keywords.rgba8snorm,Zt.keywords.rgba8uint,Zt.keywords.rgba8sint,Zt.keywords.bgra8unorm,Zt.keywords.bgra8unorm_srgb,Zt.keywords.rgb10a2unorm,Zt.keywords.rg11b10float,Zt.keywords.rg32uint,Zt.keywords.rg32sint,Zt.keywords.rg32float,Zt.keywords.rgba16uint,Zt.keywords.rgba16sint,Zt.keywords.rgba16float,Zt.keywords.rgba32uint,Zt.keywords.rgba32sint,Zt.keywords.rgba32float],dt.const_literal=[Zt.tokens.int_literal,Zt.tokens.uint_literal,Zt.tokens.decimal_float_literal,Zt.tokens.hex_float_literal,Zt.keywords.true,Zt.keywords.false],dt.literal_or_ident=[Zt.tokens.ident,Zt.tokens.int_literal,Zt.tokens.uint_literal,Zt.tokens.decimal_float_literal,Zt.tokens.hex_float_literal,Zt.tokens.name],dt.element_count_expression=[Zt.tokens.int_literal,Zt.tokens.uint_literal,Zt.tokens.ident],dt.template_types=[Zt.keywords.vec2,Zt.keywords.vec3,Zt.keywords.vec4,Zt.keywords.mat2x2,Zt.keywords.mat2x3,Zt.keywords.mat2x4,Zt.keywords.mat3x2,Zt.keywords.mat3x3,Zt.keywords.mat3x4,Zt.keywords.mat4x2,Zt.keywords.mat4x3,Zt.keywords.mat4x4,Zt.keywords.atomic,Zt.keywords.bitcast,...Zt.any_texture_type],dt.attribute_name=[Zt.tokens.ident,Zt.keywords.block,Zt.keywords.diagnostic],dt.assignment_operators=[Zt.tokens.equal,Zt.tokens.plus_equal,Zt.tokens.minus_equal,Zt.tokens.times_equal,Zt.tokens.division_equal,Zt.tokens.modulo_equal,Zt.tokens.and_equal,Zt.tokens.or_equal,Zt.tokens.xor_equal,Zt.tokens.shift_right_equal,Zt.tokens.shift_left_equal],dt.increment_operators=[Zt.tokens.plus_plus,Zt.tokens.minus_minus];class TS{constructor(t,e,n,a,f){this.type=t,this.lexeme=e,this.line=n,this.start=a,this.end=f}toString(){return this.lexeme}isTemplateType(){return dt.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==dt.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class YF{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new TS(dt.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let m=1;for(;m>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),m--,m==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),m++)}return!0}}const e=dt.simpleTokens[t];if(e)return this._addToken(e),!0;let n=dt.none;const a=this._isAlpha(t),f=t==="_";if(this._isAlphaNumeric(t)){let m=this._peekAhead();for(;this._isAlphaNumeric(m);)t+=this._advance(),m=this._peekAhead()}if(a){const m=dt.keywords[t];if(m)return this._addToken(m),!0}if(a||f)return this._addToken(dt.tokens.ident),!0;for(;;){let m=this._findType(t);const l=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(l=="=")return this._current++,t+=l,this._addToken(dt.tokens.minus_equal),!0;if(l=="-")return this._current++,t+=l,this._addToken(dt.tokens.minus_minus),!0;const w=this._tokens.length-1;if((dt.literal_or_ident.indexOf(this._tokens[w].type)!=-1||this._tokens[w].type==dt.tokens.paren_right)&&l!=">")return this._addToken(m),!0}if(t==">"&&(l==">"||l=="=")){let w=!1,C=this._tokens.length-1;for(let P=0;P<5&&C>=0&&dt.assignment_operators.indexOf(this._tokens[C].type)===-1;++P,--C)if(this._tokens[C].type===dt.tokens.less_than){C>0&&this._tokens[C-1].isArrayOrTemplateType()&&(w=!0);break}if(w)return this._addToken(m),!0}if(m===dt.none){let w=t,C=0;const P=2;for(let L=0;L<P;++L)if(w+=this._peekAhead(L),m=this._findType(w),m!==dt.none){C=L;break}if(m===dt.none)return n!==dt.none&&(this._current--,this._addToken(n),!0);t=w,this._current+=C+1}if(n=m,this._isAtEnd())break;t+=this._advance()}return n!==dt.none&&(this._addToken(n),!0)}_findType(t){for(const n in dt.regexTokens){const a=dt.regexTokens[n];if(this._match(t,a.rule))return a}return dt.literalTokens[t]||dt.none}_match(t,e){const n=e.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new TS(t,e,this._line,this._start,this._current))}}function Le(i){return Array.isArray(i)||i?.buffer instanceof ArrayBuffer}const Rb=new Float32Array(1),KF=new Uint32Array(Rb.buffer),QF=new Uint32Array(Rb.buffer),Pb=new Int32Array(1),JF=new Float32Array(Pb.buffer),tN=new Uint32Array(Pb.buffer),Ib=new Uint32Array(1),eN=new Float32Array(Ib.buffer),iN=new Int32Array(Ib.buffer);function SS(i,t,e){if(t===e)return i;if(t==="f32"){if(e==="i32"||e==="x32")return Rb[0]=i,KF[0];if(e==="u32")return Rb[0]=i,QF[0]}else if(t==="i32"||t==="x32"){if(e==="f32")return Pb[0]=i,JF[0];if(e==="u32")return Pb[0]=i,tN[0]}else if(t==="u32"){if(e==="f32")return Ib[0]=i,eN[0];if(e==="i32"||e==="x32")return Ib[0]=i,iN[0]}return console.error(`Unsupported cast from ${t} to ${e}`),i}class nN{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class Hv{constructor(t,e){this.align=t,this.size=e}}class wu{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new zF,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(const e of t)e instanceof Sy&&this._functions.set(e.name,new nN(e));for(const e of t)if(e instanceof Dh){const n=this.getTypeInfo(e,null);n instanceof Wf&&this.structs.push(n)}for(const e of t)if(e instanceof Dw)this.aliases.push(this._getAliasInfo(e));else{if(e instanceof Pw){const n=e,a=this._getAttributeNum(n.attributes,"id",0),f=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new LF(n.name,f,n.attributes,a));continue}if(this._isUniformVar(e)){const n=e,a=this._getAttributeNum(n.attributes,"group",0),f=this._getAttributeNum(n.attributes,"binding",0),m=this.getTypeInfo(n.type,n.attributes),l=new $v(n.name,m,a,f,n.attributes,$f.Uniform,n.access);l.access||(l.access="read"),this.uniforms.push(l);continue}if(this._isStorageVar(e)){const n=e,a=this._getAttributeNum(n.attributes,"group",0),f=this._getAttributeNum(n.attributes,"binding",0),m=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(m),w=new $v(n.name,m,a,f,n.attributes,l?$f.StorageTexture:$f.Storage,n.access);w.access||(w.access="read"),this.storage.push(w);continue}if(this._isTextureVar(e)){const n=e,a=this._getAttributeNum(n.attributes,"group",0),f=this._getAttributeNum(n.attributes,"binding",0),m=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(m),w=new $v(n.name,m,a,f,n.attributes,l?$f.StorageTexture:$f.Texture,n.access);w.access||(w.access="read"),l?this.storage.push(w):this.textures.push(w);continue}if(this._isSamplerVar(e)){const n=e,a=this._getAttributeNum(n.attributes,"group",0),f=this._getAttributeNum(n.attributes,"binding",0),m=this.getTypeInfo(n.type,n.attributes),l=new $v(n.name,m,a,f,n.attributes,$f.Sampler,n.access);this.samplers.push(l);continue}}for(const e of t)if(e instanceof Sy){const n=this._getAttribute(e,"vertex"),a=this._getAttribute(e,"fragment"),f=this._getAttribute(e,"compute"),m=n||a||f,l=new NF(e.name,m?.name,e.attributes);l.attributes=e.attributes,l.startLine=e.startLine,l.endLine=e.endLine,this.functions.push(l),this._functions.get(e.name).info=l,m&&(this._functions.get(e.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(e,!!m),l.inputs=this._getInputs(e.args),l.outputs=this._getOutputs(e.returnType),this.entry[m.name].push(l)),l.arguments=e.args.map(w=>new FF(w.name,this.getTypeInfo(w.type,w.attributes),w.attributes)),l.returnType=e.returnType?this.getTypeInfo(e.returnType,e.attributes):null;continue}for(const e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(const e of this._functions.values())e.node.search(n=>{var a,f,m;if(n instanceof eM){if(n.value)if(Le(n.value))for(const l of n.value)for(const w of this.overrides)l===w.name&&((a=e.info)===null||a===void 0||a.overrides.push(w));else for(const l of this.overrides)n.value===l.name&&((f=e.info)===null||f===void 0||f.overrides.push(l))}else if(n instanceof Wo)for(const l of this.overrides)n.name===l.name&&((m=e.info)===null||m===void 0||m.overrides.push(l))});for(const e of this.uniforms)this._markStructsInUse(e.type);for(const e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(t){for(const e of this.functions)if(e.name==t)return e;return null}getStructInfo(t){for(const e of this.structs)if(e.name==t)return e;return null}getOverrideInfo(t){for(const e of this.overrides)if(e.name==t)return e;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var n;for(const a of t.calls){const f=(n=this._functions.get(a.name))===null||n===void 0?void 0:n.info;f&&e.add(f)}}findResource(t,e,n){if(n){for(const a of this.entry.compute)if(a.name===n){for(const f of a.resources)if(f.group==t&&f.binding==e)return f}for(const a of this.entry.vertex)if(a.name===n){for(const f of a.resources)if(f.group==t&&f.binding==e)return f}for(const a of this.entry.fragment)if(a.name===n){for(const f of a.resources)if(f.group==t&&f.binding==e)return f}}for(const a of this.uniforms)if(a.group==t&&a.binding==e)return a;for(const a of this.storage)if(a.group==t&&a.binding==e)return a;for(const a of this.textures)if(a.group==t&&a.binding==e)return a;for(const a of this.samplers)if(a.group==t&&a.binding==e)return a;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this.getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const n=[],a=this,f=[];return t.search(m=>{if(m instanceof Cb)f.push({});else if(m instanceof Mb)f.pop();else if(m instanceof Oh){const l=m;e&&l.type!==null&&this._markStructsFromAST(l.type),f.length>0&&(f[f.length-1][l.name]=l)}else if(m instanceof vu){const l=m;e&&l.type!==null&&this._markStructsFromAST(l.type)}else if(m instanceof hy){const l=m;e&&l.type!==null&&this._markStructsFromAST(l.type),f.length>0&&(f[f.length-1][l.name]=l)}else if(m instanceof Wo){const l=m;if(f.length>0&&f[f.length-1][l.name])return;const w=a._findResource(l.name);w&&n.push(w)}else if(m instanceof kw){const l=m,w=a._functions.get(l.name);w&&(e&&(w.inUse=!0),t.calls.add(w.node),w.resources===null&&(w.resources=a._findResources(w.node,e)),n.push(...w.resources))}else if(m instanceof Iw){const l=m,w=a._functions.get(l.name);w&&(e&&(w.inUse=!0),t.calls.add(w.node),w.resources===null&&(w.resources=a._findResources(w.node,e)),n.push(...w.resources))}}),[...new Map(n.map(m=>[m.name,m])).values()]}getBindGroups(){const t=[];function e(n,a){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),a>=t[n].length&&(t[n].length=a+1)}for(const n of this.uniforms)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.storage)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.textures)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.samplers)e(n.group,n.binding),t[n.group][n.binding]=n;return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Dh)this._getStructOutputs(t,e);else{const n=this._getOutputInfo(t);n!==null&&e.push(n)}return e}_getStructOutputs(t,e){for(const n of t.members)if(n.type instanceof Dh)this._getStructOutputs(n.type,e);else{const a=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(a!==null){const f=this.getTypeInfo(n.type,n.type.attributes),m=this._parseInt(a.value),l=new yS(n.name,f,a.name,m);e.push(l)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this.getTypeInfo(t,t.attributes),a=this._parseInt(e.value);return new yS("",n,e.name,a)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const n of t)if(n.type instanceof Dh)this._getStructInputs(n.type,e);else{const a=this._getInputInfo(n);a!==null&&e.push(a)}return e}_getStructInputs(t,e){for(const n of t.members)if(n.type instanceof Dh)this._getStructInputs(n.type,e);else{const a=this._getInputInfo(n);a!==null&&e.push(a)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this._getAttribute(t,"interpolation"),a=this.getTypeInfo(t.type,t.attributes),f=this._parseInt(e.value),m=new BF(t.name,a,e.name,f);return n!==null&&(m.interpolation=this._parseString(n.value)),m}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new OF(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(const e of this.structs)if(e.name==t)return e;for(const e of this.aliases)if(e.name==t)return e.type;return null}getTypeInfo(t,e=null){if(this._types.has(t))return this._types.get(t);if(t instanceof ob){const a=t.type?this.getTypeInfo(t.type,t.attributes):null,f=new r1(t.name,a,e);return this._types.set(t,f),this._updateTypeInfo(f),f}if(t instanceof fy){const a=t,f=a.format?this.getTypeInfo(a.format,a.attributes):null,m=new Zf(a.name,e);return m.format=f,m.count=a.count,this._types.set(t,m),this._updateTypeInfo(m),m}if(t instanceof Dh){const a=t,f=new Wf(a.name,e);f.startLine=a.startLine,f.endLine=a.endLine;for(const m of a.members){const l=this.getTypeInfo(m.type,m.attributes);f.members.push(new _S(m.name,l,m.attributes))}return this._types.set(t,f),this._updateTypeInfo(f),f}if(t instanceof ty){const a=t,f=a.format instanceof be,m=a.format?f?this.getTypeInfo(a.format,null):new Dl(a.format,null):null,l=new Fp(a.name,m,e,a.access);return this._types.set(t,l),this._updateTypeInfo(l),l}if(t instanceof jt){const a=t,f=a.format?this.getTypeInfo(a.format,null):null,m=new Fp(a.name,f,e,a.access);return this._types.set(t,m),this._updateTypeInfo(m),m}const n=new Dl(t.name,e);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var e,n,a;const f=this._getTypeSize(t);if(t.size=(e=f?.size)!==null&&e!==void 0?e:0,t instanceof Zf&&t.format){const m=this._getTypeSize(t.format);t.stride=Math.max((n=m?.size)!==null&&n!==void 0?n:0,(a=m?.align)!==null&&a!==void 0?a:0),this._updateTypeInfo(t.format)}t instanceof r1&&this._updateTypeInfo(t.format),t instanceof Wf&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let n=0,a=0,f=0,m=0;for(let l=0,w=t.members.length;l<w;++l){const C=t.members[l],P=this._getTypeSize(C);if(!P)continue;(e=this._getAlias(C.type.name))!==null&&e!==void 0||C.type;const L=P.align,j=P.size;n=this._roundUp(L,n+a),a=j,f=n,m=Math.max(m,L),C.offset=n,C.size=j,this._updateTypeInfo(C.type)}t.size=this._roundUp(m,f+a),t.align=m}_getTypeSize(t){var e,n;if(t==null)return null;const a=this._getAttributeNum(t.attributes,"size",0),f=this._getAttributeNum(t.attributes,"align",0);if(t instanceof _S&&(t=t.type),t instanceof Dl){const m=this._getAlias(t.name);m!==null&&(t=m)}{const m=wu._typeInfo[t.name];if(m!==void 0){const l=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new Hv(Math.max(f,m.align/l),Math.max(a,m.size/l))}}{const m=wu._typeInfo[t.name.substring(0,t.name.length-1)];if(m){const l=t.name[t.name.length-1]==="h"?2:1;return new Hv(Math.max(f,m.align/l),Math.max(a,m.size/l))}}if(t instanceof Zf){let m=t,l=8,w=8;const C=this._getTypeSize(m.format);return C!==null&&(w=C.size,l=C.align),w=m.count*this._getAttributeNum((n=t?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(l,w)),a&&(w=a),new Hv(Math.max(f,l),Math.max(a,w))}if(t instanceof Wf){let m=0,l=0,w=0,C=0,P=0;for(const L of t.members){const j=this._getTypeSize(L.type);j!==null&&(m=Math.max(j.align,m),w=this._roundUp(j.align,w+C),C=j.size,P=w)}return l=this._roundUp(m,P+C),new Hv(Math.max(f,m),Math.max(a,l))}return null}_isUniformVar(t){return t instanceof Oh&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Oh&&t.storage=="storage"}_isTextureVar(t){return t instanceof Oh&&t.type!==null&&wu._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Oh&&t.type!==null&&wu._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const n=t;if(!n||!n.attributes)return null;const a=n.attributes;for(let f of a)if(f.name==e)return f;return null}_getAttributeNum(t,e,n){if(t===null)return n;for(let a of t)if(a.name==e){let f=a!==null&&a.value!==null?a.value:n;return f instanceof Array&&(f=f[0]),typeof f=="number"?f:typeof f=="string"?parseInt(f):n}return n}_roundUp(t,e){return Math.ceil(e/t)*t}}wu._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},wu._textureTypes=dt.any_texture_type.map(i=>i.name),wu._samplerTypes=dt.sampler_type.map(i=>i.name);let Ow=0;class Bw{constructor(t,e,n){this.id=Ow++,this.name=t,this.value=e,this.node=n}clone(){return new Bw(this.name,this.value,this.node)}}class Lw{constructor(t){this.id=Ow++,this.name=t.name,this.node=t}clone(){return new Lw(this.node)}}class Fw{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Ow++,t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var e;return this.variables.has(t)?(e=this.variables.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var e;return this.functions.has(t)?(e=this.functions.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getFunction(t):null}createVariable(t,e,n){this.variables.set(t,new Bw(t,e,n??null))}setVariable(t,e,n){const a=this.getVariable(t);a!==null?a.value=e:this.createVariable(t,e,n)}getVariableValue(t){var e;const n=this.getVariable(t);return(e=n?.value)!==null&&e!==void 0?e:null}clone(){return new Fw(this)}}class rN{evalExpression(t,e){return null}getTypeInfo(t){return null}getVariableName(t,e){return""}}class sN{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,e){const n=this.exec.evalExpression(t.args[0],e);let a=!0;if(n instanceof vt)return n.data.forEach(f=>{f||(a=!1)}),new Nt(a?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt){const a=n.data.some(f=>f);return new Nt(a?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,e){const n=this.exec.evalExpression(t.args[2],e);if(!(n instanceof Nt))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return n.value?this.exec.evalExpression(t.args[1],e):this.exec.evalExpression(t.args[0],e)}ArrayLength(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.evalExpression(n,e);if(a instanceof Sr&&a.typeInfo.size===0){const f=a.typeInfo,m=a.buffer.byteLength/f.stride;return new Nt(m,this.getTypeInfo("u32"))}return new Nt(a.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.abs(f)),n.typeInfo);const a=n;return new Nt(Math.abs(a.value),a.typeInfo)}Acos(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.acos(f)),n.typeInfo);const a=n;return new Nt(Math.acos(a.value),n.typeInfo)}Acosh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.acosh(f)),n.typeInfo);const a=n;return new Nt(Math.acosh(a.value),n.typeInfo)}Asin(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.asin(f)),n.typeInfo);const a=n;return new Nt(Math.asin(a.value),n.typeInfo)}Asinh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.asinh(f)),n.typeInfo);const a=n;return new Nt(Math.asinh(a.value),n.typeInfo)}Atan(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.atan(f)),n.typeInfo);const a=n;return new Nt(Math.atan(a.value),n.typeInfo)}Atanh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.atanh(f)),n.typeInfo);const a=n;return new Nt(Math.atanh(a.value),n.typeInfo)}Atan2(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt)return new vt(n.data.map((l,w)=>Math.atan2(l,a.data[w])),n.typeInfo);const f=n,m=a;return new Nt(Math.atan2(f.value,m.value),n.typeInfo)}Ceil(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.ceil(f)),n.typeInfo);const a=n;return new Nt(Math.ceil(a.value),n.typeInfo)}_clamp(t,e,n){return Math.min(Math.max(t,e),n)}Clamp(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e);if(n instanceof vt&&a instanceof vt&&f instanceof vt)return new vt(n.data.map((C,P)=>this._clamp(C,a.data[P],f.data[P])),n.typeInfo);const m=n,l=a,w=f;return new Nt(this._clamp(m.value,l.value,w.value),n.typeInfo)}Cos(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.cos(f)),n.typeInfo);const a=n;return new Nt(Math.cos(a.value),n.typeInfo)}Cosh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.cosh(f)),n.typeInfo);const a=n;return new Nt(Math.cos(a.value),n.typeInfo)}CountLeadingZeros(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.clz32(f)),n.typeInfo);const a=n;return new Nt(Math.clz32(a.value),n.typeInfo)}_countOneBits(t){let e=0;for(;t!==0;)1&t&&e++,t>>=1;return e}CountOneBits(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>this._countOneBits(f)),n.typeInfo);const a=n;return new Nt(this._countOneBits(a.value),n.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let e=0;for(;!(1&t);)t>>=1,e++;return e}CountTrailingZeros(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>this._countTrailingZeros(f)),n.typeInfo);const a=n;return new Nt(this._countTrailingZeros(a.value),n.typeInfo)}Cross(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt){if(n.data.length!==3||a.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;const f=n.data,m=a.data;return new vt([f[1]*m[2]-m[1]*f[2],f[2]*m[0]-m[2]*f[0],f[0]*m[1]-m[0]*f[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,e){const n=this.exec.evalExpression(t.args[0],e),a=180/Math.PI;return n instanceof vt?new vt(n.data.map(f=>f*a),n.typeInfo):new Nt(n.value*a,this.getTypeInfo("f32"))}Determinant(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof ui){const a=n.data,f=n.typeInfo.getTypeName(),m=f.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(f==="mat2x2"||f==="mat2x2f"||f==="mat2x2h")return new Nt(a[0]*a[3]-a[1]*a[2],m);if(f==="mat2x3"||f==="mat2x3f"||f==="mat2x3h")return new Nt(a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6]),m);if(f==="mat2x4"||f==="mat2x4f"||f==="mat2x4h")console.error(`TODO: Determinant for ${f}`);else if(f==="mat3x2"||f==="mat3x2f"||f==="mat3x2h")console.error(`TODO: Determinant for ${f}`);else{if(f==="mat3x3"||f==="mat3x3f"||f==="mat3x3h")return new Nt(a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6]),m);f==="mat3x4"||f==="mat3x4f"||f==="mat3x4h"||f==="mat4x2"||f==="mat4x2f"||f==="mat4x2h"||f==="mat4x3"||f==="mat4x3f"||f==="mat4x3h"?console.error(`TODO: Determinant for ${f}`):f!=="mat4x4"&&f!=="mat4x4f"&&f!=="mat4x4h"||console.error(`TODO: Determinant for ${f}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt){let l=0;for(let w=0;w<n.data.length;++w)l+=(n.data[w]-a.data[w])*(n.data[w]-a.data[w]);return new Nt(Math.sqrt(l),this.getTypeInfo("f32"))}const f=n,m=a;return new Nt(Math.abs(f.value-m.value),n.typeInfo)}_dot(t,e){let n=0;for(let a=0;a<t.length;++a)n+=e[a]*t[a];return n}Dot(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);return n instanceof vt&&a instanceof vt?new Nt(this._dot(n.data,a.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,e){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,e){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.exp(f)),n.typeInfo);const a=n;return new Nt(Math.exp(a.value),n.typeInfo)}Exp2(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.pow(2,f)),n.typeInfo);const a=n;return new Nt(Math.pow(2,a.value),n.typeInfo)}ExtractBits(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e);if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(f.typeInfo.name!=="u32"&&f.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;const m=a.value,l=f.value;if(n instanceof vt)return new vt(n.data.map(C=>C>>m&(1<<l)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;const w=n.value;return new Nt(w>>m&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e);if(n instanceof vt&&a instanceof vt&&f instanceof vt){const m=this._dot(a.data,f.data);return new vt(m<0?Array.from(n.data):n.data.map(l=>-l),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>this._firstLeadingBit(f)),n.typeInfo);const a=n;return new Nt(this._firstLeadingBit(a.value),n.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>this._firstTrailingBit(f)),n.typeInfo);const a=n;return new Nt(this._firstTrailingBit(a.value),n.typeInfo)}Floor(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.floor(f)),n.typeInfo);const a=n;return new Nt(Math.floor(a.value),n.typeInfo)}Fma(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e);if(n instanceof vt&&a instanceof vt&&f instanceof vt)return n.data.length!==a.data.length||n.data.length!==f.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new vt(n.data.map((C,P)=>C*a.data[P]+f.data[P]),n.typeInfo);const m=n,l=a,w=f;return new Nt(m.value*l.value+w.value,m.typeInfo)}Fract(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>f-Math.floor(f)),n.typeInfo);const a=n;return new Nt(a.value-Math.floor(a.value),n.typeInfo)}Frexp(t,e){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e),m=this.exec.evalExpression(t.args[3],e);if(f.typeInfo.name!=="u32"&&f.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;const l=f.value,w=(1<<m.value)-1<<l,C=~w;if(n instanceof vt&&a instanceof vt)return new vt(n.data.map((j,G)=>j&C|a.data[G]<<l&w),n.typeInfo);const P=n.value,L=a.value;return new Nt(P&C|L<<l&w,n.typeInfo)}InverseSqrt(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>1/Math.sqrt(f)),n.typeInfo);const a=n;return new Nt(1/Math.sqrt(a.value),n.typeInfo)}Ldexp(t,e){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt){let f=0;return n.data.forEach(m=>{f+=m*m}),new Nt(Math.sqrt(f),this.getTypeInfo("f32"))}const a=n;return new Nt(Math.abs(a.value),n.typeInfo)}Log(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.log(f)),n.typeInfo);const a=n;return new Nt(Math.log(a.value),n.typeInfo)}Log2(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.log2(f)),n.typeInfo);const a=n;return new Nt(Math.log2(a.value),n.typeInfo)}Max(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt)return new vt(n.data.map((l,w)=>Math.max(l,a.data[w])),n.typeInfo);const f=n,m=a;return new Nt(Math.max(f.value,m.value),n.typeInfo)}Min(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt)return new vt(n.data.map((l,w)=>Math.min(l,a.data[w])),n.typeInfo);const f=n,m=a;return new Nt(Math.min(f.value,m.value),n.typeInfo)}Mix(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e);if(n instanceof vt&&a instanceof vt&&f instanceof vt)return new vt(n.data.map((w,C)=>n.data[C]*(1-f.data[C])+a.data[C]*f.data[C]),n.typeInfo);const m=a,l=f;return new Nt(n.value*(1-l.value)+m.value*l.value,n.typeInfo)}Modf(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt)return new vt(n.data.map((m,l)=>m%a.data[l]),n.typeInfo);const f=a;return new Nt(n.value%f.value,n.typeInfo)}Normalize(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt){const a=this.Length(t,e).value;return new vt(n.data.map(f=>f/a),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt)return new vt(n.data.map((l,w)=>Math.pow(l,a.data[w])),n.typeInfo);const f=n,m=a;return new Nt(Math.pow(f.value,m.value),n.typeInfo)}QuantizeToF16(t,e){const n=this.exec.evalExpression(t.args[0],e);return n instanceof vt?new vt(n.data.map(a=>a),n.typeInfo):new Nt(n.value,n.typeInfo)}Radians(t,e){const n=this.exec.evalExpression(t.args[0],e);return n instanceof vt?new vt(n.data.map(a=>a*Math.PI/180),n.typeInfo):new Nt(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,e){let n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(n instanceof vt&&a instanceof vt){const f=this._dot(n.data,a.data);return new vt(n.data.map((m,l)=>m-2*f*a.data[l]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,e){let n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e);if(n instanceof vt&&a instanceof vt&&f instanceof Nt){const m=this._dot(a.data,n.data);return new vt(n.data.map((l,w)=>{const C=1-f.value*f.value*(1-m*m);if(C<0)return 0;const P=Math.sqrt(C);return f.value*l-(f.value*m+P)*a.data[w]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,e){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.round(f)),n.typeInfo);const a=n;return new Nt(Math.round(a.value),n.typeInfo)}Saturate(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.min(Math.max(f,0),1)),n.typeInfo);const a=n;return new Nt(Math.min(Math.max(a.value,0),1),n.typeInfo)}Sign(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.sign(f)),n.typeInfo);const a=n;return new Nt(Math.sign(a.value),n.typeInfo)}Sin(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.sin(f)),n.typeInfo);const a=n;return new Nt(Math.sin(a.value),n.typeInfo)}Sinh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.sinh(f)),n.typeInfo);const a=n;return new Nt(Math.sinh(a.value),n.typeInfo)}_smoothstep(t,e,n){const a=Math.min(Math.max((n-t)/(e-t),0),1);return a*a*(3-2*a)}SmoothStep(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e),f=this.exec.evalExpression(t.args[2],e);if(f instanceof vt&&n instanceof vt&&a instanceof vt)return new vt(f.data.map((C,P)=>this._smoothstep(n.data[P],a.data[P],C)),f.typeInfo);const m=n,l=a,w=f;return new Nt(this._smoothstep(m.value,l.value,w.value),f.typeInfo)}Sqrt(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.sqrt(f)),n.typeInfo);const a=n;return new Nt(Math.sqrt(a.value),n.typeInfo)}Step(t,e){const n=this.exec.evalExpression(t.args[0],e),a=this.exec.evalExpression(t.args[1],e);if(a instanceof vt&&n instanceof vt)return new vt(a.data.map((m,l)=>m<n.data[l]?0:1),a.typeInfo);const f=n;return new Nt(a.value<f.value?0:1,f.typeInfo)}Tan(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.tan(f)),n.typeInfo);const a=n;return new Nt(Math.tan(a.value),n.typeInfo)}Tanh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.tanh(f)),n.typeInfo);const a=n;return new Nt(Math.tanh(a.value),n.typeInfo)}_getTransposeType(t){const e=t.getTypeName();return e==="mat2x2f"||e==="mat2x2h"?t:e==="mat2x3f"?this.getTypeInfo("mat3x2f"):e==="mat2x3h"?this.getTypeInfo("mat3x2h"):e==="mat2x4f"?this.getTypeInfo("mat4x2f"):e==="mat2x4h"?this.getTypeInfo("mat4x2h"):e==="mat3x2f"?this.getTypeInfo("mat2x3f"):e==="mat3x2h"?this.getTypeInfo("mat2x3h"):e==="mat3x3f"||e==="mat3x3h"?t:e==="mat3x4f"?this.getTypeInfo("mat4x3f"):e==="mat3x4h"?this.getTypeInfo("mat4x3h"):e==="mat4x2f"?this.getTypeInfo("mat2x4f"):e==="mat4x2h"?this.getTypeInfo("mat2x4h"):e==="mat4x3f"?this.getTypeInfo("mat3x4f"):e==="mat4x3h"?this.getTypeInfo("mat3x4h"):(e==="mat4x4f"||e==="mat4x4h"||console.error(`Invalid matrix type ${e}`),t)}Transpose(t,e){const n=this.exec.evalExpression(t.args[0],e);if(!(n instanceof ui))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;const a=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const f=n.data;return new ui([f[0],f[2],f[1],f[3]],a)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const f=n.data;return new ui([f[0],f[3],f[6],f[1],f[4],f[7]],a)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const f=n.data;return new ui([f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13]],a)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const f=n.data;return new ui([f[0],f[3],f[1],f[4],f[2],f[5]],a)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const f=n.data;return new ui([f[0],f[3],f[6],f[1],f[4],f[7],f[2],f[5],f[8]],a)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const f=n.data;return new ui([f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13],f[2],f[6],f[10],f[14]],a)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const f=n.data;return new ui([f[0],f[4],f[1],f[5],f[2],f[6]],a)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const f=n.data;return new ui([f[0],f[4],f[8],f[1],f[5],f[9],f[2],f[6],f[10]],a)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const f=n.data;return new ui([f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13],f[2],f[6],f[10],f[14],f[3],f[7],f[11],f[15]],a)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof vt)return new vt(n.data.map(f=>Math.trunc(f)),n.typeInfo);const a=n;return new Nt(Math.trunc(a.value),n.typeInfo)}Dpdx(t,e){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,e){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,e){return console.error("TODO: dpdxFine"),null}Dpdy(t,e){return console.error("TODO: dpdy"),null}DpdyCoarse(t,e){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,e){return console.error("TODO: dpdyFine"),null}Fwidth(t,e){return console.error("TODO: fwidth"),null}FwidthCoarse(t,e){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,e){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,e){const n=t.args[0],a=t.args.length>1?this.exec.evalExpression(t.args[1],e).value:0;if(n instanceof Wo){const f=n.name,m=e.getVariableValue(f);if(m instanceof kh){if(a<0||a>=m.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;const l=m.getMipLevelSize(a),w=m.dimension;return w==="1d"?new Nt(l[0],this.getTypeInfo("u32")):w==="3d"?new vt(l,this.getTypeInfo("vec3u")):w==="2d"?new vt(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${w} not found. Line ${t.line}`),null)}return console.error(`Texture ${f} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,e){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,e){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,e){const n=t.args[0],a=this.exec.evalExpression(t.args[1],e),f=t.args.length>2?this.exec.evalExpression(t.args[2],e).value:0;if(!(a instanceof vt)||a.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(n instanceof Wo){const m=n.name,l=e.getVariableValue(m);if(l instanceof kh){const w=Math.floor(a.data[0]),C=Math.floor(a.data[1]);if(w<0||w>=l.width||C<0||C>=l.height)return console.error(`Texture ${m} out of bounds. Line ${t.line}`),null;const P=l.getPixel(w,C,0,f);return P===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new vt(P,this.getTypeInfo("vec4f"))}return console.error(`Texture ${m} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,e){const n=t.args[0];if(n instanceof Wo){const a=n.name,f=e.getVariableValue(a);return f instanceof kh?new Nt(f.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${a} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,e){const n=t.args[0];if(n instanceof Wo){const a=n.name,f=e.getVariableValue(a);return f instanceof kh?new Nt(f.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${a} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,e){const n=t.args[0];if(n instanceof Wo){const a=n.name,f=e.getVariableValue(a);return f instanceof kh?new Nt(f.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${a} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,e){return console.error("TODO: textureSample"),null}TextureSampleBias(t,e){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,e){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,e){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,e){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,e){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,e){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,e){const n=t.args[0],a=this.exec.evalExpression(t.args[1],e),f=t.args.length===4?this.exec.evalExpression(t.args[2],e).value:0,m=t.args.length===4?this.exec.evalExpression(t.args[3],e).data:this.exec.evalExpression(t.args[2],e).data;if(m.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(a instanceof vt)||a.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(n instanceof Wo){const l=n.name,w=e.getVariableValue(l);if(w instanceof kh){const C=w.getMipLevelSize(0),P=Math.floor(a.data[0]),L=Math.floor(a.data[1]);return P<0||P>=C[0]||L<0||L>=C[1]?(console.error(`Texture ${l} out of bounds. Line ${t.line}`),null):(w.setPixel(P,L,0,f,Array.from(m)),null)}return console.error(`Texture ${l} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e);return e.getVariable(a).value.getSubData(this.exec,n.postfix,e)}AtomicStore(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e);return w instanceof Nt&&l instanceof Nt&&(w.value=l.value),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),null}AtomicAdd(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value+=l.value),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicSub(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value-=l.value),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicMax(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value=Math.max(w.value,l.value)),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicMin(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value=Math.min(w.value,l.value)),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicAnd(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value=w.value&l.value),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicOr(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value=w.value|l.value),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicXor(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value=w.value^l.value),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicExchange(t,e){let n=t.args[0];n instanceof Kr&&(n=n.right);const a=this.exec.getVariableName(n,e),f=e.getVariable(a);let m=t.args[1];const l=this.exec.evalExpression(m,e),w=f.value.getSubData(this.exec,n.postfix,e),C=new Nt(w.value,w.typeInfo);return w instanceof Nt&&l instanceof Nt&&(w.value=l.value),f.value instanceof Sr&&f.value.setDataValue(this.exec,w,n.postfix,e),C}AtomicCompareExchangeWeak(t,e){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,e){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,e){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,e){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,e){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,e){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,e){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,e){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,e){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,e){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,e){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,e){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,e){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,e){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,e){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,e){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,e){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,e){return null}TextureBarrier(t,e){return null}WorkgroupBarrier(t,e){return null}WorkgroupUniformLoad(t,e){return null}SubgroupAdd(t,e){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,e){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,e){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,e){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,e){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,e){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,e){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,e){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,e){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,e){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,e){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,e){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,e){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,e){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,e){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,e){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,e){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,e){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,e){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,e){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,e){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,e){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,e){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,e){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,e){return console.error("TODO: quadSwapY"),null}}const rx={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Ma={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class ia extends rN{constructor(t,e){var n;super(),this.ast=t??[],this.reflection=new wu,this.reflection.updateAST(this.ast),this.context=(n=e?.clone())!==null&&n!==void 0?n:new Fw,this.builtins=new sN(this),this.typeInfo={bool:this.getTypeInfo(be.bool),i32:this.getTypeInfo(be.i32),u32:this.getTypeInfo(be.u32),f32:this.getTypeInfo(be.f32),f16:this.getTypeInfo(be.f16),vec2f:this.getTypeInfo(jt.vec2f),vec2u:this.getTypeInfo(jt.vec2u),vec2i:this.getTypeInfo(jt.vec2i),vec2h:this.getTypeInfo(jt.vec2h),vec3f:this.getTypeInfo(jt.vec3f),vec3u:this.getTypeInfo(jt.vec3u),vec3i:this.getTypeInfo(jt.vec3i),vec3h:this.getTypeInfo(jt.vec3h),vec4f:this.getTypeInfo(jt.vec4f),vec4u:this.getTypeInfo(jt.vec4u),vec4i:this.getTypeInfo(jt.vec4i),vec4h:this.getTypeInfo(jt.vec4h),mat2x2f:this.getTypeInfo(jt.mat2x2f),mat2x3f:this.getTypeInfo(jt.mat2x3f),mat2x4f:this.getTypeInfo(jt.mat2x4f),mat3x2f:this.getTypeInfo(jt.mat3x2f),mat3x3f:this.getTypeInfo(jt.mat3x3f),mat3x4f:this.getTypeInfo(jt.mat3x4f),mat4x2f:this.getTypeInfo(jt.mat4x2f),mat4x3f:this.getTypeInfo(jt.mat4x3f),mat4x4f:this.getTypeInfo(jt.mat4x4f)}}getVariableValue(t){var e,n;const a=(n=(e=this.context.getVariable(t))===null||e===void 0?void 0:e.value)!==null&&n!==void 0?n:null;if(a===null)return null;if(a instanceof Nt)return a.value;if(a instanceof vt||a instanceof ui)return Array.from(a.data);if(a instanceof Sr&&a.typeInfo instanceof Zf){if(a.typeInfo.format.name==="u32")return Array.from(new Uint32Array(a.buffer,a.offset,a.typeInfo.count));if(a.typeInfo.format.name==="i32")return Array.from(new Int32Array(a.buffer,a.offset,a.typeInfo.count));if(a.typeInfo.format.name==="f32")return Array.from(new Float32Array(a.buffer,a.offset,a.typeInfo.count))}return console.error(`Unsupported return variable type ${a.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,e,n,a){const f=this.context.clone();(a=a??{}).constants&&this._setOverrides(a.constants,f),this._execStatements(this.ast,f);const m=f.getFunction(t);if(!m)return void console.error(`Function ${t} not found`);if(typeof e=="number")e=[e,1,1];else{if(e.length===0)return void console.error("Invalid dispatch count");e.length===1?e=[e[0],1,1]:e.length===2?e=[e[0],e[1],1]:e.length>3&&(e=[e[0],e[1],e[2]])}const l=e[0],w=e[1],C=e[2],P=this.getTypeInfo("vec3u");f.setVariable("@num_workgroups",new vt(e,P));const L=this.reflection.getFunctionInfo(t);L===null&&console.error(`Function ${t} not found in reflection data`);for(const j in n)for(const G in n[j]){const nt=n[j][G];f.variables.forEach(at=>{var J;const mt=at.node;if(mt?.attributes){let Mt=null,pt=null;for(const Pt of mt.attributes)Pt.name==="binding"?Mt=Pt.value:Pt.name==="group"&&(pt=Pt.value);if(G==Mt&&j==pt){let Pt=!1;for(const kt of L.resources)if(kt.name===at.name&&kt.group===parseInt(j)&&kt.binding===parseInt(G)){Pt=!0;break}if(Pt)if(nt.texture!==void 0&&nt.descriptor!==void 0){const kt=new kh(nt.texture,this.getTypeInfo(mt.type),nt.descriptor,(J=nt.texture.view)!==null&&J!==void 0?J:null);at.value=kt}else nt.uniform!==void 0?at.value=new Sr(nt.uniform,this.getTypeInfo(mt.type)):at.value=new Sr(nt,this.getTypeInfo(mt.type))}}})}for(let j=0;j<C;++j)for(let G=0;G<w;++G)for(let nt=0;nt<l;++nt)f.setVariable("@workgroup_id",new vt([nt,G,j],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(m,[nt,G,j],f)}execStatement(t,e){if(t instanceof WC)return this.evalExpression(t.value,e);if(t instanceof XC){if(t.condition){const n=this.evalExpression(t.condition,e);if(!(n instanceof Nt))throw new Error("Invalid break-if condition");if(!n.value)return null}return ia._breakObj}if(t instanceof ZC)return ia._continueObj;if(t instanceof hy)this._let(t,e);else if(t instanceof Oh)this._var(t,e);else if(t instanceof ab)this._const(t,e);else if(t instanceof Sy)this._function(t,e);else{if(t instanceof HC)return this._if(t,e);if(t instanceof $C)return this._switch(t,e);if(t instanceof zC)return this._for(t,e);if(t instanceof NC)return this._while(t,e);if(t instanceof jC)return this._loop(t,e);if(t instanceof s1){const n=e.clone();return n.currentFunctionName=e.currentFunctionName,this._execStatements(t.body,n)}if(t instanceof VC)this._assign(t,e);else if(t instanceof UC)this._increment(t,e);else{if(t instanceof Dh)return null;if(t instanceof Pw){const n=t.name;e.getVariable(n)===null&&e.setVariable(n,new Nt(0,this.getTypeInfo("u32")))}else if(t instanceof Iw)this._call(t,e);else{if(t instanceof qC||t instanceof Dw)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,e){return t instanceof Mc?this._evalBinaryOp(t,e):t instanceof ds?this._evalLiteral(t,e):t instanceof Wo?this._evalVariable(t,e):t instanceof kw?this._evalCall(t,e):t instanceof vu?this._evalCreate(t,e):t instanceof GC?this._evalConst(t,e):t instanceof YC?this._evalBitcast(t,e):t instanceof Kr?this._evalUnaryOp(t,e):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var e;if(t instanceof be){const a=this.reflection.getTypeInfo(t);if(a!==null)return a}let n=(e=this.typeInfo[t])!==null&&e!==void 0?e:null;return n!==null||(n=this.reflection.getTypeInfoByName(t)),n}_setOverrides(t,e){for(const n in t){const a=t[n],f=this.reflection.getOverrideInfo(n);f!==null?(f.type===null&&(f.type=this.getTypeInfo("u32")),f.type.name==="u32"||f.type.name==="i32"||f.type.name==="f32"||f.type.name==="f16"?e.setVariable(n,new Nt(a,f.type)):f.type.name==="bool"?e.setVariable(n,new Nt(a?1:0,f.type)):f.type.name==="vec2"||f.type.name==="vec3"||f.type.name==="vec4"||f.type.name==="vec2f"||f.type.name==="vec3f"||f.type.name==="vec4f"||f.type.name==="vec2i"||f.type.name==="vec3i"||f.type.name==="vec4i"||f.type.name==="vec2u"||f.type.name==="vec3u"||f.type.name==="vec4u"||f.type.name==="vec2h"||f.type.name==="vec3h"||f.type.name==="vec4h"?e.setVariable(n,new vt(a,f.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(t,e,n){const a=[1,1,1];for(const P of t.node.attributes)if(P.name==="workgroup_size"){if(P.value.length>0){const L=n.getVariableValue(P.value[0]);a[0]=L instanceof Nt?L.value:parseInt(P.value[0])}if(P.value.length>1){const L=n.getVariableValue(P.value[1]);a[1]=L instanceof Nt?L.value:parseInt(P.value[1])}if(P.value.length>2){const L=n.getVariableValue(P.value[2]);a[2]=L instanceof Nt?L.value:parseInt(P.value[2])}}const f=this.getTypeInfo("vec3u"),m=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new vt(a,f));const l=a[0],w=a[1],C=a[2];for(let P=0,L=0;P<C;++P)for(let j=0;j<w;++j)for(let G=0;G<l;++G,++L){const nt=[G,j,P],at=[G+e[0]*a[0],j+e[1]*a[1],P+e[2]*a[2]];n.setVariable("@local_invocation_id",new vt(nt,f)),n.setVariable("@global_invocation_id",new vt(at,f)),n.setVariable("@local_invocation_index",new Nt(L,m)),this._dispatchExec(t,n)}}_dispatchExec(t,e){for(const n of t.node.args)for(const a of n.attributes)if(a.name==="builtin"){const f=`@${a.value}`,m=e.getVariable(f);m!==void 0&&e.variables.set(n.name,m)}this._execStatements(t.node.body,e)}getVariableName(t,e){for(;t instanceof Kr;)t=t.right;return t instanceof Wo?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,e){for(const n of t){if(n instanceof Array){const f=e.clone(),m=this._execStatements(n,f);if(m)return m;continue}const a=this.execStatement(n,e);if(a)return a}return null}_call(t,e){const n=e.clone();n.currentFunctionName=t.name;const a=e.getFunction(t.name);if(a){for(let f=0;f<a.node.args.length;++f){const m=a.node.args[f],l=this.evalExpression(t.args[f],n);n.setVariable(m.name,l,m)}this._execStatements(a.node.body,n)}else t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)&&this._evalCreate(t,e)}_increment(t,e){const n=this.getVariableName(t.variable,e),a=e.getVariable(n);a?t.operator==="++"?a.value instanceof Nt?a.value.value++:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):t.operator==="--"?a.value instanceof Nt?a.value.value--:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${n} not found. Line ${t.line}`)}_getVariableData(t,e){if(t instanceof Wo){const n=this.getVariableName(t,e),a=e.getVariable(n);return a===null?(console.error(`Variable ${n} not found. Line ${t.line}`),null):a.value.getSubData(this,t.postfix,e)}if(t instanceof Kr){if(t.operator==="*"){const n=this._getVariableData(t.right,e);return n instanceof gg?n.reference.getSubData(this,t.postfix,e):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){const n=this._getVariableData(t.right,e);return new gg(n)}}return null}_assign(t,e){let n=null,a="<var>",f=null;if(t.variable instanceof Kr){const w=this._getVariableData(t.variable,e),C=this.evalExpression(t.value,e),P=t.operator;if(P==="="){if(w instanceof Nt||w instanceof vt||w instanceof ui){if(C instanceof Nt||C instanceof vt||C instanceof ui&&w.data.length===C.data.length)return void w.data.set(C.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(w instanceof Sr&&C instanceof Sr&&w.buffer.byteLength-w.offset>=C.buffer.byteLength-C.offset)return void(w.buffer.byteLength%4==0?new Uint32Array(w.buffer,w.offset,w.typeInfo.size/4).set(new Uint32Array(C.buffer,C.offset,C.typeInfo.size/4)):new Uint8Array(w.buffer,w.offset,w.typeInfo.size).set(new Uint8Array(C.buffer,C.offset,C.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(P==="+=")return w instanceof Nt||w instanceof vt||w instanceof ui?C instanceof Nt||C instanceof vt||C instanceof ui?void w.data.set(C.data.map((L,j)=>w.data[j]+L)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(P==="-=")return(w instanceof Nt||w instanceof vt||w instanceof ui)&&(C instanceof Nt||C instanceof vt||C instanceof ui)?void w.data.set(C.data.map((L,j)=>w.data[j]-L)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof Kr){if(t.variable.operator==="*"){a=this.getVariableName(t.variable.right,e);const w=e.getVariable(a);if(!(w&&w.value instanceof gg))return void console.error(`Variable ${a} is not a pointer. Line ${t.line}`);n=w.value.reference;let C=t.variable.postfix;if(!C){let P=t.variable.right;for(;P instanceof Kr;){if(P.postfix){C=P.postfix;break}P=P.right}}C&&(n=n.getSubData(this,C,e))}}else{f=t.variable.postfix,a=this.getVariableName(t.variable,e);const w=e.getVariable(a);if(w===null)return void console.error(`Variable ${a} not found. Line ${t.line}`);n=w.value}if(n instanceof gg&&(n=n.reference),n===null)return void console.error(`Variable ${a} not found. Line ${t.line}`);const m=this.evalExpression(t.value,e),l=t.operator;if(l!=="="){const w=n.getSubData(this,f,e);if(w instanceof vt&&m instanceof Nt){const C=w.data,P=m.value;if(l==="+=")for(let L=0;L<C.length;++L)C[L]+=P;else if(l==="-=")for(let L=0;L<C.length;++L)C[L]-=P;else if(l==="*=")for(let L=0;L<C.length;++L)C[L]*=P;else if(l==="/=")for(let L=0;L<C.length;++L)C[L]/=P;else if(l==="%=")for(let L=0;L<C.length;++L)C[L]%=P;else if(l==="&=")for(let L=0;L<C.length;++L)C[L]&=P;else if(l==="|=")for(let L=0;L<C.length;++L)C[L]|=P;else if(l==="^=")for(let L=0;L<C.length;++L)C[L]^=P;else if(l==="<<=")for(let L=0;L<C.length;++L)C[L]<<=P;else if(l===">>=")for(let L=0;L<C.length;++L)C[L]>>=P;else console.error(`Invalid operator ${l}. Line ${t.line}`)}else if(w instanceof vt&&m instanceof vt){const C=w.data,P=m.data;if(C.length!==P.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(l==="+=")for(let L=0;L<C.length;++L)C[L]+=P[L];else if(l==="-=")for(let L=0;L<C.length;++L)C[L]-=P[L];else if(l==="*=")for(let L=0;L<C.length;++L)C[L]*=P[L];else if(l==="/=")for(let L=0;L<C.length;++L)C[L]/=P[L];else if(l==="%=")for(let L=0;L<C.length;++L)C[L]%=P[L];else if(l==="&=")for(let L=0;L<C.length;++L)C[L]&=P[L];else if(l==="|=")for(let L=0;L<C.length;++L)C[L]|=P[L];else if(l==="^=")for(let L=0;L<C.length;++L)C[L]^=P[L];else if(l==="<<=")for(let L=0;L<C.length;++L)C[L]<<=P[L];else if(l===">>=")for(let L=0;L<C.length;++L)C[L]>>=P[L];else console.error(`Invalid operator ${l}. Line ${t.line}`)}else{if(!(w instanceof Nt&&m instanceof Nt))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);l==="+="?w.value+=m.value:l==="-="?w.value-=m.value:l==="*="?w.value*=m.value:l==="/="?w.value/=m.value:l==="%="?w.value%=m.value:l==="&="?w.value&=m.value:l==="|="?w.value|=m.value:l==="^="?w.value^=m.value:l==="<<="?w.value<<=m.value:l===">>="?w.value>>=m.value:console.error(`Invalid operator ${l}. Line ${t.line}`)}return void(n instanceof Sr&&n.setDataValue(this,w,f,e))}if(n instanceof Sr)n.setDataValue(this,m,f,e);else if(f){if(!(n instanceof vt||n instanceof ui))return void console.error(`Variable ${a} is not a vector or matrix. Line ${t.line}`);if(f instanceof Ng){const w=this.evalExpression(f.index,e).value;if(n instanceof vt){if(!(m instanceof Nt))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[w]=m.value}else{if(!(n instanceof ui))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);{const C=this.evalExpression(f.index,e).value;if(C<0)return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);if(!(m instanceof vt))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);{const P=n.typeInfo.getTypeName();if(P==="mat2x2"||P==="mat2x2f"||P==="mat2x2h"){if(!(C<2&&m.data.length===2))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[2*C]=m.data[0],n.data[2*C+1]=m.data[1]}else if(P==="mat2x3"||P==="mat2x3f"||P==="mat2x3h"){if(!(C<2&&m.data.length===3))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[3*C]=m.data[0],n.data[3*C+1]=m.data[1],n.data[3*C+2]=m.data[2]}else if(P==="mat2x4"||P==="mat2x4f"||P==="mat2x4h"){if(!(C<2&&m.data.length===4))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[4*C]=m.data[0],n.data[4*C+1]=m.data[1],n.data[4*C+2]=m.data[2],n.data[4*C+3]=m.data[3]}else if(P==="mat3x2"||P==="mat3x2f"||P==="mat3x2h"){if(!(C<3&&m.data.length===2))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[2*C]=m.data[0],n.data[2*C+1]=m.data[1]}else if(P==="mat3x3"||P==="mat3x3f"||P==="mat3x3h"){if(!(C<3&&m.data.length===3))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[3*C]=m.data[0],n.data[3*C+1]=m.data[1],n.data[3*C+2]=m.data[2]}else if(P==="mat3x4"||P==="mat3x4f"||P==="mat3x4h"){if(!(C<3&&m.data.length===4))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[4*C]=m.data[0],n.data[4*C+1]=m.data[1],n.data[4*C+2]=m.data[2],n.data[4*C+3]=m.data[3]}else if(P==="mat4x2"||P==="mat4x2f"||P==="mat4x2h"){if(!(C<4&&m.data.length===2))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[2*C]=m.data[0],n.data[2*C+1]=m.data[1]}else if(P==="mat4x3"||P==="mat4x3f"||P==="mat4x3h"){if(!(C<4&&m.data.length===3))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[3*C]=m.data[0],n.data[3*C+1]=m.data[1],n.data[3*C+2]=m.data[2]}else{if(P!=="mat4x4"&&P!=="mat4x4f"&&P!=="mat4x4h")return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);if(!(C<4&&m.data.length===4))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);n.data[4*C]=m.data[0],n.data[4*C+1]=m.data[1],n.data[4*C+2]=m.data[2],n.data[4*C+3]=m.data[3]}}}}}else if(f instanceof Np){const w=f.value;if(!(n instanceof vt))return void console.error(`Invalid assignment to ${w}. Variable ${a} is not a vector. Line ${t.line}`);if(m instanceof Nt){if(w.length>1)return void console.error(`Invalid assignment to ${w} for variable ${a}. Line ${t.line}`);if(w==="x")n.data[0]=m.value;else if(w==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${w} for variable ${a}. Line ${t.line}`);n.data[1]=m.value}else if(w==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${w} for variable ${a}. Line ${t.line}`);n.data[2]=m.value}else if(w==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${w} for variable ${a}. Line ${t.line}`);n.data[3]=m.value}}else{if(!(m instanceof vt))return void console.error(`Invalid assignment to ${a}. Line ${t.line}`);if(w.length!==m.data.length)return void console.error(`Invalid assignment to ${w} for variable ${a}. Line ${t.line}`);for(let C=0;C<w.length;++C){const P=w[C];if(P==="x"||P==="r")n.data[0]=m.data[C];else if(P==="y"||P==="g"){if(m.data.length<2)return void console.error(`Invalid assignment to ${P} for variable ${a}. Line ${t.line}`);n.data[1]=m.data[C]}else if(P==="z"||P==="b"){if(m.data.length<3)return void console.error(`Invalid assignment to ${P} for variable ${a}. Line ${t.line}`);n.data[2]=m.data[C]}else{if(P!=="w"&&P!=="a")return void console.error(`Invalid assignment to ${P} for variable ${a}. Line ${t.line}`);if(m.data.length<4)return void console.error(`Invalid assignment to ${P} for variable ${a}. Line ${t.line}`);n.data[3]=m.data[C]}}}}}else n instanceof Nt&&m instanceof Nt?n.value=m.value:n instanceof vt&&m instanceof vt||n instanceof ui&&m instanceof ui?n.data.set(m.data):console.error(`Invalid assignment to ${a}. Line ${t.line}`)}_function(t,e){const n=new Lw(t);e.functions.set(t.name,n)}_const(t,e){let n=null;t.value!==null&&(n=this.evalExpression(t.value,e)),e.createVariable(t.name,n,t)}_let(t,e){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,e),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Kr||(n=n.clone())}else{const a=t.type.name;if(a==="f32"||a==="i32"||a==="u32"||a==="bool"||a==="f16"||a==="vec2"||a==="vec3"||a==="vec4"||a==="vec2f"||a==="vec3f"||a==="vec4f"||a==="vec2i"||a==="vec3i"||a==="vec4i"||a==="vec2u"||a==="vec3u"||a==="vec4u"||a==="vec2h"||a==="vec3h"||a==="vec4h"||a==="vec2b"||a==="vec3b"||a==="vec4b"||a==="mat2x2"||a==="mat2x3"||a==="mat2x4"||a==="mat3x2"||a==="mat3x3"||a==="mat3x4"||a==="mat4x2"||a==="mat4x3"||a==="mat4x4"||a==="mat2x2f"||a==="mat2x3f"||a==="mat2x4f"||a==="mat3x2f"||a==="mat3x3f"||a==="mat3x4f"||a==="mat4x2f"||a==="mat4x3f"||a==="mat4x4f"||a==="mat2x2h"||a==="mat2x3h"||a==="mat2x4h"||a==="mat3x2h"||a==="mat3x3h"||a==="mat3x4h"||a==="mat4x2h"||a==="mat4x3h"||a==="mat4x4h"||a==="array"){const f=new vu(t.type,[]);n=this._evalCreate(f,e)}}e.createVariable(t.name,n,t)}_var(t,e){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,e),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Kr||(n=n.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);const a=t.type.name;if(a==="f32"||a==="i32"||a==="u32"||a==="bool"||a==="f16"||a==="vec2"||a==="vec3"||a==="vec4"||a==="vec2f"||a==="vec3f"||a==="vec4f"||a==="vec2i"||a==="vec3i"||a==="vec4i"||a==="vec2u"||a==="vec3u"||a==="vec4u"||a==="vec2h"||a==="vec3h"||a==="vec4h"||a==="vec2b"||a==="vec3b"||a==="vec4b"||a==="mat2x2"||a==="mat2x3"||a==="mat2x4"||a==="mat3x2"||a==="mat3x3"||a==="mat3x4"||a==="mat4x2"||a==="mat4x3"||a==="mat4x4"||a==="mat2x2f"||a==="mat2x3f"||a==="mat2x4f"||a==="mat3x2f"||a==="mat3x3f"||a==="mat3x4f"||a==="mat4x2f"||a==="mat4x3f"||a==="mat4x4f"||a==="mat2x2h"||a==="mat2x3h"||a==="mat2x4h"||a==="mat3x2h"||a==="mat3x3h"||a==="mat3x4h"||a==="mat4x2h"||a==="mat4x3h"||a==="mat4x4h"||t.type instanceof fy||t.type instanceof Dh||t.type instanceof jt){const f=new vu(t.type,[]);n=this._evalCreate(f,e)}}e.createVariable(t.name,n,t)}_switch(t,e){e=e.clone();const n=this.evalExpression(t.condition,e);if(!(n instanceof Nt))return console.error(`Invalid if condition. Line ${t.line}`),null;let a=null;for(const f of t.cases)if(f instanceof JC)for(const m of f.selectors){if(m instanceof lb){a=f;continue}const l=this.evalExpression(m,e);if(!(l instanceof Nt))return console.error(`Invalid case selector. Line ${t.line}`),null;if(l.value===n.value)return this._execStatements(f.body,e)}else f instanceof tM&&(a=f);return a?this._execStatements(a.body,e):null}_if(t,e){e=e.clone();const n=this.evalExpression(t.condition,e);if(!(n instanceof Nt))return console.error(`Invalid if condition. Line ${t.line}`),null;if(n.value)return this._execStatements(t.body,e);for(const a of t.elseif){const f=this.evalExpression(a.condition,e);if(!(f instanceof Nt))return console.error(`Invalid if condition. Line ${t.line}`),null;if(f.value)return this._execStatements(a.body,e)}return t.else?this._execStatements(t.else,e):null}_getScalarValue(t){return t instanceof Nt?t.value:(console.error("Expected scalar value.",t),0)}_for(t,e){for(e=e.clone(),this.execStatement(t.init,e);this._getScalarValue(this.evalExpression(t.condition,e));){const n=this._execStatements(t.body,e);if(n===ia._breakObj)break;if(n!==null&&n!==ia._continueObj)return n;this.execStatement(t.increment,e)}return null}_loop(t,e){for(e=e.clone();;){const n=this._execStatements(t.body,e);if(n===ia._breakObj)break;if(n===ia._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,e)===ia._breakObj)break}else if(n!==null)return n}return null}_while(t,e){for(e=e.clone();this._getScalarValue(this.evalExpression(t.condition,e));){const n=this._execStatements(t.body,e);if(n===ia._breakObj)break;if(n!==ia._continueObj&&n!==null)return n}return null}_evalBitcast(t,e){const n=this.evalExpression(t.value,e),a=t.type;if(n instanceof Nt){const f=SS(n.value,n.typeInfo.name,a.name);return new Nt(f,this.getTypeInfo(a))}if(n instanceof vt){const f=n.typeInfo.getTypeName();let m="";if(f.endsWith("f"))m="f32";else if(f.endsWith("i"))m="i32";else if(f.endsWith("u"))m="u32";else if(f.endsWith("b"))m="bool";else{if(!f.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${t.line}`),null;m="f16"}const l=a.getTypeName();let w="";if(l.endsWith("f"))w="f32";else if(l.endsWith("i"))w="i32";else if(l.endsWith("u"))w="u32";else if(l.endsWith("b"))w="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${w}. Line ${t.line}`),null;w="f16"}const C=(function(P,L,j){if(L===j)return P;const G=new Array(P.length);for(let nt=0;nt<P.length;nt++)G[nt]=SS(P[nt],L,j);return G})(Array.from(n.data),m,w);return new vt(C,this.getTypeInfo(a))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,e){return e.getVariableValue(t.name).clone().getSubData(this,t.postfix,e)}_evalCreate(t,e){var n;if(t instanceof vu){if(t.type===null)return a1.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,e);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,e);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,e)}}const a=t instanceof vu?t.type.name:t.name,f=t instanceof vu?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(f===null)return console.error(`Unknown type ${a}. Line ${t.line}`),null;if(f.size===0)return null;const m=new Sr(new ArrayBuffer(f.size),f,0);if(f instanceof Wf){if(t.args)for(let l=0;l<t.args.length;++l){const w=f.members[l],C=t.args[l],P=this.evalExpression(C,e);m.setData(this,P,w.type,w.offset,e)}}else if(f instanceof Zf){let l=0;if(t.args)for(let w=0;w<t.args.length;++w){const C=t.args[w],P=this.evalExpression(C,e);f.format===null&&(((n=P.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?f.format=this.getTypeInfo("i32"):f.format=P.typeInfo),m.setData(this,P,f.format,l,e),l+=f.stride}}else console.error(`Unknown type "${a}". Line ${t.line}`);return t instanceof vu?m.getSubData(this,t.postfix,e):m}_evalLiteral(t,e){const n=this.getTypeInfo(t.type),a=n.name;return a==="x32"||a==="u32"||a==="f32"||a==="f16"||a==="i32"||a==="bool"?new Nt(t.scalarValue,n):a==="vec2"||a==="vec3"||a==="vec4"||a==="vec2f"||a==="vec3f"||a==="vec4f"||a==="vec2h"||a==="vec3h"||a==="vec4h"||a==="vec2i"||a==="vec3i"||a==="vec4i"||a==="vec2u"||a==="vec3u"||a==="vec4u"?this._callConstructorVec(t,e):a==="mat2x2"||a==="mat2x3"||a==="mat2x4"||a==="mat3x2"||a==="mat3x3"||a==="mat3x4"||a==="mat4x2"||a==="mat4x3"||a==="mat4x4"||a==="mat2x2f"||a==="mat2x3f"||a==="mat2x4f"||a==="mat3x2f"||a==="mat3x3f"||a==="mat3x4f"||a==="mat4x2f"||a==="mat4x3f"||a==="mat4x4f"||a==="mat2x2h"||a==="mat2x3h"||a==="mat2x4h"||a==="mat3x2h"||a==="mat3x3h"||a==="mat3x4h"||a==="mat4x2h"||a==="mat4x3h"||a==="mat4x4h"?this._callConstructorMatrix(t,e):t.value}_evalVariable(t,e){const n=e.getVariableValue(t.name);return n===null?n:n.getSubData(this,t.postfix,e)}_maxFormatTypeInfo(t){let e=t[0];if(e.name==="f32")return e;for(let n=1;n<t.length;++n){const a=ia._priority.get(e.name);ia._priority.get(t[n].name)<a&&(e=t[n])}return e.name==="x32"?this.getTypeInfo("i32"):e}_evalUnaryOp(t,e){const n=this.evalExpression(t.right,e);if(t.operator==="&")return new gg(n);if(t.operator==="*")return n instanceof gg?n.reference.getSubData(this,t.postfix,e):(console.error(`Invalid dereference. Line ${t.line}`),null);const a=n instanceof Nt?n.value:n instanceof vt?Array.from(n.data):null;switch(t.operator){case"+":{if(Le(a)){const l=a.map((w,C)=>+w);return new vt(l,n.typeInfo)}const f=a,m=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Nt(+f,m)}case"-":{if(Le(a)){const l=a.map((w,C)=>-w);return new vt(l,n.typeInfo)}const f=a,m=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Nt(-f,m)}case"!":{if(Le(a)){const l=a.map((w,C)=>w?0:1);return new vt(l,n.typeInfo)}const f=a,m=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Nt(f?0:1,m)}case"~":{if(Le(a)){const l=a.map((w,C)=>~w);return new vt(l,n.typeInfo)}const f=a,m=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Nt(~f,m)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,e){const n=this.evalExpression(t.left,e),a=this.evalExpression(t.right,e),f=n instanceof Nt?n.value:n instanceof vt||n instanceof ui?Array.from(n.data):null,m=a instanceof Nt?a.value:a instanceof vt||a instanceof ui?Array.from(a.data):null;switch(t.operator){case"+":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G+L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j+P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P+j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l+w,C)}case"-":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G-L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j-P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P-j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l-w,C)}case"*":{if(Le(f)&&Le(m)){const P=f,L=m;if(n instanceof ui&&a instanceof ui){const j=(function(J,mt,Mt,pt){if(Ma[mt.name]===void 0||Ma[pt.name]===void 0)return null;const Pt=Ma[mt.name][0],kt=Ma[mt.name][1],$t=Ma[pt.name][0];if(Pt!==Ma[pt.name][1])return null;const ae=new Array($t*kt);for(let qt=0;qt<kt;qt++)for(let le=0;le<$t;le++){let Oe=0;for(let Be=0;Be<Pt;Be++)Oe+=J[Be*kt+qt]*Mt[le*Pt+Be];ae[qt*$t+le]=Oe}return ae})(P,n.typeInfo,L,a.typeInfo);if(j===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;const G=Ma[a.typeInfo.name][0],nt=Ma[n.typeInfo.name][1],at=this.getTypeInfo(`mat${G}x${nt}f`);return new ui(j,at)}if(n instanceof ui&&a instanceof vt){const j=(function(G,nt,at,J){if(Ma[nt.name]===void 0||rx[J.name]===void 0)return null;const mt=Ma[nt.name][0],Mt=Ma[nt.name][1];if(mt!==at.length)return null;const pt=new Array(Mt);for(let Pt=0;Pt<Mt;Pt++){let kt=0;for(let $t=0;$t<mt;$t++)kt+=G[$t*Mt+Pt]*at[$t];pt[Pt]=kt}return pt})(P,n.typeInfo,L,a.typeInfo);return j===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new vt(j,a.typeInfo)}if(n instanceof vt&&a instanceof ui){const j=(function(G,nt,at,J){if(rx[nt.name]===void 0||Ma[J.name]===void 0)return null;const mt=Ma[J.name][0],Mt=Ma[J.name][1];if(Mt!==G.length)return null;const pt=[];for(let Pt=0;Pt<mt;Pt++){let kt=0;for(let $t=0;$t<Mt;$t++)kt+=G[$t]*at[$t*mt+Pt];pt[Pt]=kt}return pt})(P,n.typeInfo,L,a.typeInfo);return j===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new vt(j,n.typeInfo)}{if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G*L[nt]);return new vt(j,n.typeInfo)}}if(Le(f)){const P=m,L=f.map((j,G)=>j*P);return n instanceof ui?new ui(L,n.typeInfo):new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P*j);return a instanceof ui?new ui(L,a.typeInfo):new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l*w,C)}case"%":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G%L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j%P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P%j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l%w,C)}case"/":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G/L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j/P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P/j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l/w,C)}case"&":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G&L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j&P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P&j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l&w,C)}case"|":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G|L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j|P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P|j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l|w,C)}case"^":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G^L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j^P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P^j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l^w,C)}case"<<":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G<<L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j<<P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P<<j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l<<w,C)}case">>":{if(Le(f)&&Le(m)){const P=f,L=m;if(P.length!==L.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const j=P.map((G,nt)=>G>>L[nt]);return new vt(j,n.typeInfo)}if(Le(f)){const P=m,L=f.map((j,G)=>j>>P);return new vt(L,n.typeInfo)}if(Le(m)){const P=f,L=m.map((j,G)=>P>>j);return new vt(L,a.typeInfo)}const l=f,w=m,C=this._maxFormatTypeInfo([n.typeInfo,a.typeInfo]);return new Nt(l>>w,C)}case">":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P>w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C>l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l>C?1:0);return new vt(w,a.typeInfo)}return new Nt(f>m?1:0,this.getTypeInfo("bool"));case"<":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P<w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C<l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l<C?1:0);return new vt(w,a.typeInfo)}return new Nt(f<m?1:0,this.getTypeInfo("bool"));case"==":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P===w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C==l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l==C?1:0);return new vt(w,a.typeInfo)}return new Nt(f===m?1:0,this.getTypeInfo("bool"));case"!=":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P!==w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C!==l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l!==C?1:0);return new vt(w,a.typeInfo)}return new Nt(f!==m?1:0,this.getTypeInfo("bool"));case">=":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P>=w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C>=l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l>=C?1:0);return new vt(w,a.typeInfo)}return new Nt(f>=m?1:0,this.getTypeInfo("bool"));case"<=":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P<=w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C<=l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l<=C?1:0);return new vt(w,a.typeInfo)}return new Nt(f<=m?1:0,this.getTypeInfo("bool"));case"&&":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P&&w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C&&l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l&&C?1:0);return new vt(w,a.typeInfo)}return new Nt(f&&m?1:0,this.getTypeInfo("bool"));case"||":if(Le(f)&&Le(m)){const l=f,w=m;if(l.length!==w.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const C=l.map((P,L)=>P||w[L]?1:0);return new vt(C,n.typeInfo)}if(Le(f)){const l=m,w=f.map((C,P)=>C||l?1:0);return new vt(w,n.typeInfo)}if(Le(m)){const l=f,w=m.map((C,P)=>l||C?1:0);return new vt(w,a.typeInfo)}return new Nt(f||m?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,e){if(t.cachedReturnValue!==null)return t.cachedReturnValue;const n=e.clone();n.currentFunctionName=t.name;const a=e.getFunction(t.name);if(!a)return t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)?this._evalCreate(t,e):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let f=0;f<a.node.args.length;++f){const m=a.node.args[f],l=this.evalExpression(t.args[f],n);n.createVariable(m.name,l,m)}return this._execStatements(a.node.body,n)}_callBuiltinFunction(t,e){switch(t.name){case"all":return this.builtins.All(t,e);case"any":return this.builtins.Any(t,e);case"select":return this.builtins.Select(t,e);case"arrayLength":return this.builtins.ArrayLength(t,e);case"abs":return this.builtins.Abs(t,e);case"acos":return this.builtins.Acos(t,e);case"acosh":return this.builtins.Acosh(t,e);case"asin":return this.builtins.Asin(t,e);case"asinh":return this.builtins.Asinh(t,e);case"atan":return this.builtins.Atan(t,e);case"atanh":return this.builtins.Atanh(t,e);case"atan2":return this.builtins.Atan2(t,e);case"ceil":return this.builtins.Ceil(t,e);case"clamp":return this.builtins.Clamp(t,e);case"cos":return this.builtins.Cos(t,e);case"cosh":return this.builtins.Cosh(t,e);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,e);case"countOneBits":return this.builtins.CountOneBits(t,e);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,e);case"cross":return this.builtins.Cross(t,e);case"degrees":return this.builtins.Degrees(t,e);case"determinant":return this.builtins.Determinant(t,e);case"distance":return this.builtins.Distance(t,e);case"dot":return this.builtins.Dot(t,e);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,e);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,e);case"exp":return this.builtins.Exp(t,e);case"exp2":return this.builtins.Exp2(t,e);case"extractBits":return this.builtins.ExtractBits(t,e);case"faceForward":return this.builtins.FaceForward(t,e);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,e);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,e);case"floor":return this.builtins.Floor(t,e);case"fma":return this.builtins.Fma(t,e);case"fract":return this.builtins.Fract(t,e);case"frexp":return this.builtins.Frexp(t,e);case"insertBits":return this.builtins.InsertBits(t,e);case"inverseSqrt":return this.builtins.InverseSqrt(t,e);case"ldexp":return this.builtins.Ldexp(t,e);case"length":return this.builtins.Length(t,e);case"log":return this.builtins.Log(t,e);case"log2":return this.builtins.Log2(t,e);case"max":return this.builtins.Max(t,e);case"min":return this.builtins.Min(t,e);case"mix":return this.builtins.Mix(t,e);case"modf":return this.builtins.Modf(t,e);case"normalize":return this.builtins.Normalize(t,e);case"pow":return this.builtins.Pow(t,e);case"quantizeToF16":return this.builtins.QuantizeToF16(t,e);case"radians":return this.builtins.Radians(t,e);case"reflect":return this.builtins.Reflect(t,e);case"refract":return this.builtins.Refract(t,e);case"reverseBits":return this.builtins.ReverseBits(t,e);case"round":return this.builtins.Round(t,e);case"saturate":return this.builtins.Saturate(t,e);case"sign":return this.builtins.Sign(t,e);case"sin":return this.builtins.Sin(t,e);case"sinh":return this.builtins.Sinh(t,e);case"smoothstep":return this.builtins.SmoothStep(t,e);case"sqrt":return this.builtins.Sqrt(t,e);case"step":return this.builtins.Step(t,e);case"tan":return this.builtins.Tan(t,e);case"tanh":return this.builtins.Tanh(t,e);case"transpose":return this.builtins.Transpose(t,e);case"trunc":return this.builtins.Trunc(t,e);case"dpdx":return this.builtins.Dpdx(t,e);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,e);case"dpdxFine":return this.builtins.DpdxFine(t,e);case"dpdy":return this.builtins.Dpdy(t,e);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,e);case"dpdyFine":return this.builtins.DpdyFine(t,e);case"fwidth":return this.builtins.Fwidth(t,e);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,e);case"fwidthFine":return this.builtins.FwidthFine(t,e);case"textureDimensions":return this.builtins.TextureDimensions(t,e);case"textureGather":return this.builtins.TextureGather(t,e);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,e);case"textureLoad":return this.builtins.TextureLoad(t,e);case"textureNumLayers":return this.builtins.TextureNumLayers(t,e);case"textureNumLevels":return this.builtins.TextureNumLevels(t,e);case"textureNumSamples":return this.builtins.TextureNumSamples(t,e);case"textureSample":return this.builtins.TextureSample(t,e);case"textureSampleBias":return this.builtins.TextureSampleBias(t,e);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,e);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,e);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,e);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,e);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,e);case"textureStore":return this.builtins.TextureStore(t,e);case"atomicLoad":return this.builtins.AtomicLoad(t,e);case"atomicStore":return this.builtins.AtomicStore(t,e);case"atomicAdd":return this.builtins.AtomicAdd(t,e);case"atomicSub":return this.builtins.AtomicSub(t,e);case"atomicMax":return this.builtins.AtomicMax(t,e);case"atomicMin":return this.builtins.AtomicMin(t,e);case"atomicAnd":return this.builtins.AtomicAnd(t,e);case"atomicOr":return this.builtins.AtomicOr(t,e);case"atomicXor":return this.builtins.AtomicXor(t,e);case"atomicExchange":return this.builtins.AtomicExchange(t,e);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,e);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,e);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,e);case"pack4xI8":return this.builtins.Pack4xI8(t,e);case"pack4xU8":return this.builtins.Pack4xU8(t,e);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,e);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,e);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,e);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,e);case"pack2x16float":return this.builtins.Pack2x16float(t,e);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,e);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,e);case"unpack4xI8":return this.builtins.Unpack4xI8(t,e);case"unpack4xU8":return this.builtins.Unpack4xU8(t,e);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,e);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,e);case"unpack2x16float":return this.builtins.Unpack2x16float(t,e);case"storageBarrier":return this.builtins.StorageBarrier(t,e);case"textureBarrier":return this.builtins.TextureBarrier(t,e);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,e);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,e);case"subgroupAdd":return this.builtins.SubgroupAdd(t,e);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,e);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,e);case"subgroupAll":return this.builtins.SubgroupAll(t,e);case"subgroupAnd":return this.builtins.SubgroupAnd(t,e);case"subgroupAny":return this.builtins.SubgroupAny(t,e);case"subgroupBallot":return this.builtins.SubgroupBallot(t,e);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,e);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,e);case"subgroupElect":return this.builtins.SubgroupElect(t,e);case"subgroupMax":return this.builtins.SubgroupMax(t,e);case"subgroupMin":return this.builtins.SubgroupMin(t,e);case"subgroupMul":return this.builtins.SubgroupMul(t,e);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,e);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,e);case"subgroupOr":return this.builtins.SubgroupOr(t,e);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,e);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,e);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,e);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,e);case"subgroupXor":return this.builtins.SubgroupXor(t,e);case"quadBroadcast":return this.builtins.QuadBroadcast(t,e);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,e);case"quadSwapX":return this.builtins.QuadSwapX(t,e);case"quadSwapY":return this.builtins.QuadSwapY(t,e)}const n=e.getFunction(t.name);if(n){const a=e.clone();for(let f=0;f<n.node.args.length;++f){const m=n.node.args[f],l=this.evalExpression(t.args[f],a);a.setVariable(m.name,l,m)}return this._execStatements(n.node.body,a)}return null}_callConstructorValue(t,e){if(!t.args||t.args.length===0)return new Nt(0,this.getTypeInfo(t.type));const n=this.evalExpression(t.args[0],e);return n.typeInfo=this.getTypeInfo(t.type),n.getSubData(this,t.postfix,e).clone()}_callConstructorVec(t,e){const n=this.getTypeInfo(t.type),a=t.type.getTypeName(),f=rx[a];if(f===void 0)return console.error(`Invalid vec constructor ${a}. Line ${t.line}`),null;const m=[];if(t instanceof ds)if(t.isVector){const l=t.vectorValue;for(const w of l)m.push(w)}else m.push(t.scalarValue);else if(t.args)for(const l of t.args){const w=this.evalExpression(l,e);if(w instanceof vt){const C=w.data;for(let P=0;P<C.length;++P){let L=C[P];m.push(L)}}else if(w instanceof Nt){let C=w.value;m.push(C)}}if(t.type instanceof jt&&t.type.format===null&&(t.type.format=jt.f32),m.length===0){const l=new Array(f).fill(0);return new vt(l,n).getSubData(this,t.postfix,e)}if(m.length===1)for(;m.length<f;)m.push(m[0]);return m.length<f?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new vt(m.length>f?m.slice(0,f):m,n).getSubData(this,t.postfix,e)}_callConstructorMatrix(t,e){const n=this.getTypeInfo(t.type),a=t.type.getTypeName(),f=Ma[a];if(f===void 0)return console.error(`Invalid matrix constructor ${a}. Line ${t.line}`),null;const m=[];if(t instanceof ds)if(t.isVector){const l=t.vectorValue;for(const w of l)m.push(w)}else m.push(t.scalarValue);else if(t.args)for(const l of t.args){const w=this.evalExpression(l,e);w instanceof vt?m.push(...w.data):w instanceof Nt?m.push(w.value):w instanceof ui&&m.push(...w.data)}if(n instanceof Fp&&n.format===null&&(n.format=this.getTypeInfo("f32")),m.length===0){const l=new Array(f[2]).fill(0);return new ui(l,n).getSubData(this,t.postfix,e)}return m.length!==f[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new ui(m,n).getSubData(this,t.postfix,e)}}ia._breakObj=new Bl(new Dl("BREAK",null),null),ia._continueObj=new Bl(new Dl("CONTINUE",null),null),ia._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class aN{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class oN{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new aN,this._exec=new ia,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;e.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const a=n.arrayType,f=n.countNode;if(f instanceof Wo){const m=f.name,l=this._context.constants.get(m);if(l)try{const w=l.constEvaluate(this._exec);a.count=w}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of e)n.search(a=>{a instanceof wS||a instanceof ob?a.type=this._forwardType(a.type):a instanceof fy?a.format=this._forwardType(a.format):a instanceof Oh||a instanceof hy||a instanceof ab?a.type=this._forwardType(a.type):a instanceof Sy?a.returnType=this._forwardType(a.returnType):a instanceof xS&&(a.type=this._forwardType(a.type))});return e}_forwardType(t){if(t instanceof bS){const e=this._getType(t.name);if(e)return e}else t instanceof ob?t.type=this._forwardType(t.type):t instanceof fy&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){const e=new YF(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,e){return t.line=e??this._currentLine,t}_error(t,e){return{token:t,message:e,toString:()=>`${e}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==dt.eof}_match(t){if(t instanceof Ut)return!!this._check(t)&&(this._advance(),!0);for(let e=0,n=t.length;e<n;++e){const a=t[e];if(this._check(a))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),`${e}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const n=e.type;let a=!1;for(const f of t){if(n===f)return!0;f===dt.tokens.name&&(a=!0)}if(a){const f=dt.tokens.name.rule.exec(e.lexeme);if(f&&f.index==0&&f[0]==e.lexeme)return!0}return!1}if(e.type===t)return!0;if(t===dt.tokens.name){const n=dt.tokens.name.rule.exec(e.lexeme);return n&&n.index==0&&n[0]==e.lexeme}return!1}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(dt.tokens.semicolon)&&!this._isAtEnd(););if(this._match(dt.keywords.alias)){const e=this._type_alias();return this._consume(dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(dt.keywords.diagnostic)){const e=this._diagnostic();return this._consume(dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(dt.keywords.requires)){const e=this._requires_directive();return this._consume(dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(dt.keywords.enable)){const e=this._enable_directive();return this._consume(dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const t=this._attribute();if(this._check(dt.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(dt.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(dt.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(dt.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(dt.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}if(this._check(dt.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}return null}_function_decl(){if(!this._match(dt.keywords.fn))return null;const t=this._currentLine,e=this._consume(dt.tokens.ident,"Expected function name.").toString();this._consume(dt.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(dt.tokens.paren_right))do{if(this._check(dt.tokens.paren_right))break;const l=this._attribute(),w=this._consume(dt.tokens.name,"Expected argument name.").toString();this._consume(dt.tokens.colon,"Expected ':' for argument type.");const C=this._attribute(),P=this._type_decl();P!=null&&(P.attributes=C,n.push(this._updateNode(new xS(w,P,l))))}while(this._match(dt.tokens.comma));this._consume(dt.tokens.paren_right,"Expected ')' after function arguments.");let a=null;if(this._match(dt.tokens.arrow)){const l=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=l)}const f=this._compound_statement(),m=this._currentLine;return this._updateNode(new Sy(e,n,a,f,t,m),t)}_compound_statement(){const t=[];for(this._consume(dt.tokens.brace_left,"Expected '{' for block.");!this._check(dt.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(dt.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(dt.tokens.semicolon)&&!this._isAtEnd(););if(this._check(dt.tokens.attr)&&this._attribute(),this._check(dt.keywords.if))return this._if_statement();if(this._check(dt.keywords.switch))return this._switch_statement();if(this._check(dt.keywords.loop))return this._loop_statement();if(this._check(dt.keywords.for))return this._for_statement();if(this._check(dt.keywords.while))return this._while_statement();if(this._check(dt.keywords.continuing))return this._continuing_statement();if(this._check(dt.keywords.static_assert))return this._static_assert_statement();if(this._check(dt.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(dt.keywords.return))t=this._return_statement();else if(this._check([dt.keywords.var,dt.keywords.let,dt.keywords.const]))t=this._variable_statement();else if(this._match(dt.keywords.discard))t=this._updateNode(new XF);else if(this._match(dt.keywords.break)){const e=this._updateNode(new XC);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];e.loopId=n.id}t=e,this._check(dt.keywords.if)&&(this._advance(),e.condition=this._optional_paren_expression())}else if(this._match(dt.keywords.continue)){const e=this._updateNode(new ZC);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${e.line}`);{const n=this._currentLoop[this._currentLoop.length-1];e.loopId=n.id}t=e}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(dt.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(dt.keywords.static_assert))return null;const t=this._currentLine,e=this._optional_paren_expression();return this._updateNode(new HF(e),t)}_while_statement(){if(!this._match(dt.keywords.while))return null;const t=this._updateNode(new NC(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(dt.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){const t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(dt.keywords.continuing))return null;const e=this._currentLine,n=this._compound_statement();return this._updateNode(new s1(n,t),e)}_for_statement(){if(!this._match(dt.keywords.for))return null;this._consume(dt.tokens.paren_left,"Expected '('.");const t=this._updateNode(new zC(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(dt.tokens.semicolon)?null:this._for_init(),this._consume(dt.tokens.semicolon,"Expected ';'."),t.condition=this._check(dt.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(dt.tokens.semicolon,"Expected ';'."),t.increment=this._check(dt.tokens.paren_right)?null:this._for_increment(),this._consume(dt.tokens.paren_right,"Expected ')'."),this._check(dt.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(dt.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(dt.tokens.equal)&&(e=this._short_circuit_or_expression()),this._updateNode(new Oh(t.name,t.type,t.storage,t.access,e),t.line)}if(this._match(dt.keywords.let)){const t=this._currentLine,e=this._consume(dt.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(dt.tokens.colon)){const f=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=f)}this._consume(dt.tokens.equal,"Expected '=' for let.");const a=this._short_circuit_or_expression();return this._updateNode(new hy(e,n,null,null,a),t)}if(this._match(dt.keywords.const)){const t=this._currentLine,e=this._consume(dt.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(dt.tokens.colon)){const f=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=f)}this._consume(dt.tokens.equal,"Expected '=' for const.");const a=this._short_circuit_or_expression();return n===null&&a instanceof ds&&(n=a.type),this._updateNode(new ab(e,n,null,null,a),t)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(dt.increment_operators))return this._current=t,null;const n=this._consume(dt.increment_operators,"Expected increment operator");return this._updateNode(new UC(n.type===dt.tokens.plus_plus?Eg.increment:Eg.decrement,e))}_assignment_statement(){let t=null;const e=this._currentLine;if(this._check(dt.tokens.brace_right))return null;let n=this._match(dt.tokens.underscore);if(n||(t=this._unary_expression()),!n&&t==null)return null;const a=this._consume(dt.assignment_operators,"Expected assignment operator."),f=this._short_circuit_or_expression();return this._updateNode(new VC(J_.parse(a.lexeme),t,f),e)}_func_call_statement(){if(!this._check(dt.tokens.ident))return null;const t=this._currentLine,e=this._current,n=this._consume(dt.tokens.ident,"Expected function name."),a=this._argument_expression_list();return a===null?(this._current=e,null):this._updateNode(new Iw(n.lexeme,a),t)}_loop_statement(){if(!this._match(dt.keywords.loop))return null;this._check(dt.tokens.attr)&&this._attribute(),this._consume(dt.tokens.brace_left,"Expected '{' for loop.");const t=this._updateNode(new jC([],null));this._currentLoop.push(t);let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let n of e)t.body.push(n);else t.body.push(e);if(e instanceof s1){t.continuing=e;break}e=this._statement()}return this._currentLoop.pop(),this._consume(dt.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(dt.keywords.switch))return null;const t=this._updateNode(new $C(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(dt.tokens.attr)&&this._attribute(),this._consume(dt.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(dt.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){const t=[];let e=!1;for(;this._check([dt.keywords.default,dt.keywords.case]);){if(this._match(dt.keywords.case)){const n=this._case_selectors();for(const f of n)if(f instanceof lb){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");e=!0;break}this._match(dt.tokens.colon),this._check(dt.tokens.attr)&&this._attribute(),this._consume(dt.tokens.brace_left,"Exected '{' for switch case.");const a=this._case_body();this._consume(dt.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new JC(n,a)))}if(this._match(dt.keywords.default)){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(dt.tokens.colon),this._check(dt.tokens.attr)&&this._attribute(),this._consume(dt.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(dt.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new tM(n)))}}return t}_case_selectors(){const t=[];for(this._match(dt.keywords.default)?t.push(this._updateNode(new lb)):t.push(this._shift_expression());this._match(dt.tokens.comma);)this._match(dt.keywords.default)?t.push(this._updateNode(new lb)):t.push(this._shift_expression());return t}_case_body(){if(this._match(dt.keywords.fallthrough))return this._consume(dt.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(dt.keywords.if))return null;const t=this._currentLine,e=this._optional_paren_expression();this._check(dt.tokens.attr)&&this._attribute();const n=this._compound_statement();let a=[];this._match_elseif()&&(this._check(dt.tokens.attr)&&this._attribute(),a=this._elseif_statement(a));let f=null;return this._match(dt.keywords.else)&&(this._check(dt.tokens.attr)&&this._attribute(),f=this._compound_statement()),this._updateNode(new HC(e,n,a,f),t)}_match_elseif(){return this._tokens[this._current].type===dt.keywords.else&&this._tokens[this._current+1].type===dt.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const e=this._optional_paren_expression(),n=this._compound_statement();return t.push(this._updateNode(new ZF(e,n))),this._match_elseif()&&(this._check(dt.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(dt.keywords.return))return null;const t=this._short_circuit_or_expression();return this._updateNode(new WC(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(dt.tokens.or_or);)t=this._updateNode(new Mc(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(dt.tokens.and_and);)t=this._updateNode(new Mc(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(dt.tokens.or);)t=this._updateNode(new Mc(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(dt.tokens.xor);)t=this._updateNode(new Mc(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(dt.tokens.and);)t=this._updateNode(new Mc(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){const t=this._relational_expression();return this._match([dt.tokens.equal_equal,dt.tokens.not_equal])?this._updateNode(new Mc(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([dt.tokens.less_than,dt.tokens.greater_than,dt.tokens.less_than_equal,dt.tokens.greater_than_equal]);)t=this._updateNode(new Mc(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([dt.tokens.shift_left,dt.tokens.shift_right]);)t=this._updateNode(new Mc(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([dt.tokens.plus,dt.tokens.minus]);)t=this._updateNode(new Mc(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([dt.tokens.star,dt.tokens.forward_slash,dt.tokens.modulo]);)t=this._updateNode(new Mc(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([dt.tokens.minus,dt.tokens.bang,dt.tokens.tilde,dt.tokens.star,dt.tokens.and])?this._updateNode(new Kr(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(dt.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(dt.tokens.bracket_right,"Expected ']'.");const e=this._updateNode(new Ng(t)),n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(dt.tokens.period)){const t=this._consume(dt.tokens.name,"Expected member name."),e=this._postfix_expression(),n=this._updateNode(new Np(t.lexeme));return e&&(n.postfix=e),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){const e=this._getStruct(t);if(e!==null)return e;switch(t){case"void":return be.void;case"bool":return be.bool;case"i32":return be.i32;case"u32":return be.u32;case"f32":return be.f32;case"f16":return be.f16;case"vec2f":return jt.vec2f;case"vec3f":return jt.vec3f;case"vec4f":return jt.vec4f;case"vec2i":return jt.vec2i;case"vec3i":return jt.vec3i;case"vec4i":return jt.vec4i;case"vec2u":return jt.vec2u;case"vec3u":return jt.vec3u;case"vec4u":return jt.vec4u;case"vec2h":return jt.vec2h;case"vec3h":return jt.vec3h;case"vec4h":return jt.vec4h;case"mat2x2f":return jt.mat2x2f;case"mat2x3f":return jt.mat2x3f;case"mat2x4f":return jt.mat2x4f;case"mat3x2f":return jt.mat3x2f;case"mat3x3f":return jt.mat3x3f;case"mat3x4f":return jt.mat3x4f;case"mat4x2f":return jt.mat4x2f;case"mat4x3f":return jt.mat4x3f;case"mat4x4f":return jt.mat4x4f;case"mat2x2h":return jt.mat2x2h;case"mat2x3h":return jt.mat2x3h;case"mat2x4h":return jt.mat2x4h;case"mat3x2h":return jt.mat3x2h;case"mat3x3h":return jt.mat3x3h;case"mat3x4h":return jt.mat3x4h;case"mat4x2h":return jt.mat4x2h;case"mat4x3h":return jt.mat4x3h;case"mat4x4h":return jt.mat4x4h;case"mat2x2i":return jt.mat2x2i;case"mat2x3i":return jt.mat2x3i;case"mat2x4i":return jt.mat2x4i;case"mat3x2i":return jt.mat3x2i;case"mat3x3i":return jt.mat3x3i;case"mat3x4i":return jt.mat3x4i;case"mat4x2i":return jt.mat4x2i;case"mat4x3i":return jt.mat4x3i;case"mat4x4i":return jt.mat4x4i;case"mat2x2u":return jt.mat2x2u;case"mat2x3u":return jt.mat2x3u;case"mat2x4u":return jt.mat2x4u;case"mat3x2u":return jt.mat3x2u;case"mat3x3u":return jt.mat3x3u;case"mat3x4u":return jt.mat3x4u;case"mat4x2u":return jt.mat4x2u;case"mat4x3u":return jt.mat4x3u;case"mat4x4u":return jt.mat4x4u}return null}_validateTypeRange(t,e){if(e.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(e.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(dt.tokens.ident)){const n=this._previous().toString();if(this._check(dt.tokens.paren_left)){const a=this._argument_expression_list(),f=this._getType(n);return f!==null?this._updateNode(new vu(f,a)):this._updateNode(new kw(n,a))}if(this._context.constants.has(n)){const a=this._context.constants.get(n);return this._updateNode(new GC(n,a.value))}return this._updateNode(new Wo(n))}if(this._match(dt.tokens.int_literal)){const n=this._previous().toString();let a=n.endsWith("i")||n.endsWith("i")?be.i32:n.endsWith("u")||n.endsWith("U")?be.u32:be.x32;const f=parseInt(n);return this._validateTypeRange(f,a),this._updateNode(new ds(new Nt(f,this._exec.getTypeInfo(a)),a))}if(this._match(dt.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,be.u32),this._updateNode(new ds(new Nt(n,this._exec.getTypeInfo(be.u32)),be.u32))}if(this._match([dt.tokens.decimal_float_literal,dt.tokens.hex_float_literal])){let n=this._previous().toString(),a=n.endsWith("h");a&&(n=n.substring(0,n.length-1));const f=parseFloat(n);this._validateTypeRange(f,a?be.f16:be.f32);const m=a?be.f16:be.f32;return this._updateNode(new ds(new Nt(f,this._exec.getTypeInfo(m)),m))}if(this._match([dt.keywords.true,dt.keywords.false])){let n=this._previous().toString()===dt.keywords.true.rule;return this._updateNode(new ds(new Nt(n?1:0,this._exec.getTypeInfo(be.bool)),be.bool))}if(this._check(dt.tokens.paren_left))return this._paren_expression();if(this._match(dt.keywords.bitcast)){this._consume(dt.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(dt.tokens.greater_than,"Expected '>'.");const a=this._paren_expression();return this._updateNode(new YC(n,a))}const t=this._type_decl(),e=this._argument_expression_list();return this._updateNode(new vu(t,e))}_argument_expression_list(){if(!this._match(dt.tokens.paren_left))return null;const t=[];do{if(this._check(dt.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(dt.tokens.comma));return this._consume(dt.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(dt.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(dt.tokens.paren_right),t}_paren_expression(){this._consume(dt.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(dt.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(dt.keywords.struct))return null;const t=this._currentLine,e=this._consume(dt.tokens.ident,"Expected name for struct.").toString();this._consume(dt.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(dt.tokens.brace_right);){const m=this._attribute(),l=this._consume(dt.tokens.name,"Expected variable name.").toString();this._consume(dt.tokens.colon,"Expected ':' for struct member type.");const w=this._attribute(),C=this._type_decl();C!=null&&(C.attributes=w),this._check(dt.tokens.brace_right)?this._match(dt.tokens.comma):this._consume(dt.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new wS(l,C,m)))}this._consume(dt.tokens.brace_right,"Expected '}' after struct body.");const a=this._currentLine,f=this._updateNode(new Dh(e,n,t,a),t);return this._context.structs.set(e,f),f}_global_variable_decl(){const t=this._variable_decl();if(!t)return null;if(this._match(dt.tokens.equal)){const e=this._const_expression();t.value=e}if(t.type!==null&&t.value instanceof ds){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof ds&&(t.type=t.value.type.name==="x32"?be.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(dt.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(dt.keywords.const))return null;const e=this._consume(dt.tokens.name,"Expected variable name"),n=this._currentLine;let a=null;if(this._match(dt.tokens.colon)){const w=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=w)}let f=null;this._consume(dt.tokens.equal,"const declarations require an assignment");const m=this._short_circuit_or_expression();try{let w=[be.f32],C=m.constEvaluate(this._exec,w);C instanceof Nt&&this._validateTypeRange(C.value,w[0]),w[0]instanceof jt&&w[0].format===null&&C.typeInfo instanceof Fp&&C.typeInfo.format!==null&&(C.typeInfo.format.name==="f16"?w[0].format=be.f16:C.typeInfo.format.name==="f32"?w[0].format=be.f32:C.typeInfo.format.name==="i32"?w[0].format=be.i32:C.typeInfo.format.name==="u32"?w[0].format=be.u32:C.typeInfo.format.name==="bool"?w[0].format=be.bool:console.error(`TODO: impelement template format type ${C.typeInfo.format.name}`)),f=this._updateNode(new ds(C,w[0])),this._exec.context.setVariable(e.toString(),C)}catch{f=m}if(a!==null&&f instanceof ds){if(f.type.name!=="x32"&&a.getTypeName()!==f.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${f.type.name} to ${a.name}. Line:${this._currentLine}`);f.type=a,f.isScalar&&this._validateTypeRange(f.scalarValue,f.type)}else a===null&&f instanceof ds&&(a=(t=f?.type)!==null&&t!==void 0?t:be.f32,a===be.x32&&(a=be.i32));const l=this._updateNode(new ab(e.toString(),a,"","",f),n);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(dt.keywords.let))return null;const t=this._currentLine,e=this._consume(dt.tokens.name,"Expected variable name");let n=null;if(this._match(dt.tokens.colon)){const f=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=f)}let a=null;if(this._match(dt.tokens.equal)&&(a=this._const_expression()),n!==null&&a instanceof ds){if(a.type.name!=="x32"&&n.getTypeName()!==a.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.type.name} to ${n.name}. Line:${this._currentLine}`);a.type=n}else n===null&&a instanceof ds&&(n=a.type.name==="x32"?be.i32:a.type);return a instanceof ds&&a.isScalar&&this._validateTypeRange(a.scalarValue,n),this._updateNode(new hy(e.toString(),n,"","",a),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(dt.keywords.var))return null;const t=this._currentLine;let e="",n="";this._match(dt.tokens.less_than)&&(e=this._consume(dt.storage_class,"Expected storage_class.").toString(),this._match(dt.tokens.comma)&&(n=this._consume(dt.access_mode,"Expected access_mode.").toString()),this._consume(dt.tokens.greater_than,"Expected '>'."));const a=this._consume(dt.tokens.name,"Expected variable name");let f=null;if(this._match(dt.tokens.colon)){const m=this._attribute();f=this._type_decl(),f!=null&&(f.attributes=m)}return this._updateNode(new Oh(a.toString(),f,e,n,null),t)}_override_decl(){if(!this._match(dt.keywords.override))return null;const t=this._consume(dt.tokens.name,"Expected variable name");let e=null;if(this._match(dt.tokens.colon)){const n=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=n)}return this._updateNode(new Pw(t.toString(),e,null))}_diagnostic(){this._consume(dt.tokens.paren_left,"Expected '('");const t=this._consume(dt.tokens.ident,"Expected severity control name.");this._consume(dt.tokens.comma,"Expected ','");let e=this._consume(dt.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(dt.tokens.period)&&(e+=`.${this._consume(dt.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(dt.tokens.paren_right,"Expected ')'"),this._updateNode(new qC(t.toString(),e))}_enable_directive(){const t=this._consume(dt.tokens.ident,"identity expected.");return this._updateNode(new WF(t.toString()))}_requires_directive(){const t=[this._consume(dt.tokens.ident,"identity expected.").toString()];for(;this._match(dt.tokens.comma);){const e=this._consume(dt.tokens.ident,"identity expected.");t.push(e.toString())}return this._updateNode(new qF(t))}_type_alias(){const t=this._consume(dt.tokens.ident,"identity expected.");this._consume(dt.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const n=this._updateNode(new Dw(t.toString(),e));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([dt.tokens.ident,...dt.texel_format,dt.keywords.bool,dt.keywords.f32,dt.keywords.i32,dt.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const a=this._updateNode(new bS(n));return this._forwardTypeCount++,a}return this._updateNode(new be(n))}let t=this._texture_sampler_types();if(t)return t;if(this._check(dt.template_types)){let n=this._advance().toString(),a=null,f=null;return this._match(dt.tokens.less_than)&&(a=this._type_decl(),f=null,this._match(dt.tokens.comma)&&(f=this._consume(dt.access_mode,"Expected access_mode for pointer").toString()),this._consume(dt.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new jt(n,a,f))}if(this._match(dt.keywords.ptr)){let n=this._previous().toString();this._consume(dt.tokens.less_than,"Expected '<' for pointer.");const a=this._consume(dt.storage_class,"Expected storage_class for pointer");this._consume(dt.tokens.comma,"Expected ',' for pointer.");const f=this._type_decl();let m=null;return this._match(dt.tokens.comma)&&(m=this._consume(dt.access_mode,"Expected access_mode for pointer").toString()),this._consume(dt.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new ob(n,a.toString(),f,m))}const e=this._attribute();if(this._match(dt.keywords.array)){let n=null,a=-1;const f=this._previous();let m=null;if(this._match(dt.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let w="";if(this._match(dt.tokens.comma)){m=this._shift_expression();try{w=m.constEvaluate(this._exec).toString(),m=null}catch{w="1"}}this._consume(dt.tokens.greater_than,"Expected '>' for array."),a=w?parseInt(w):0}const l=this._updateNode(new fy(f.toString(),e,n,a));return m&&this._deferArrayCountEval.push({arrayType:l,countNode:m}),l}return null}_texture_sampler_types(){if(this._match(dt.sampler_type))return this._updateNode(new ty(this._previous().toString(),null,null));if(this._match(dt.depth_texture_type))return this._updateNode(new ty(this._previous().toString(),null,null));if(this._match(dt.sampled_texture_type)||this._match(dt.multisampled_texture_type)){const t=this._previous();this._consume(dt.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(dt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ty(t.toString(),e,null))}if(this._match(dt.storage_texture_type)){const t=this._previous();this._consume(dt.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(dt.texel_format,"Invalid texel format.").toString();this._consume(dt.tokens.comma,"Expected ',' after texel format.");const n=this._consume(dt.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(dt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ty(t.toString(),e,n))}return null}_attribute(){let t=[];for(;this._match(dt.tokens.attr);){const e=this._consume(dt.attribute_name,"Expected attribute name"),n=this._updateNode(new eM(e.toString(),null));if(this._match(dt.tokens.paren_left)){if(n.value=this._consume(dt.literal_or_ident,"Expected attribute value").toString(),this._check(dt.tokens.comma)){this._advance();do{const a=this._consume(dt.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(a)}while(this._match(dt.tokens.comma))}this._consume(dt.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}}class lN extends wu{constructor(t){super(),t&&this.update(t)}update(t){const e=new oN().parse(t);this.updateAST(e)}}function cN(i){const t={attributes:[],bindings:[]};let e;try{e=uN(i)}catch(f){return Se.error(f.message)(),t}for(const f of e.uniforms){const m=[];for(const l of f.type?.members||[])m.push({name:l.name,type:AS(l.type)});t.bindings.push({type:"uniform",name:f.name,group:f.group,location:f.binding,members:m})}for(const f of e.textures)t.bindings.push({type:"texture",name:f.name,group:f.group,location:f.binding});for(const f of e.samplers)t.bindings.push({type:"sampler",name:f.name,group:f.group,location:f.binding});const n=e.entry.vertex[0],a=n?.inputs.length||0;for(let f=0;f<a;f++){const m=n.inputs[f];if(m.locationType==="location"){const l=AS(m.type);t.attributes.push({name:m.name,location:Number(m.location),type:l})}}return t}function AS(i){return i?.format?`${i.name}<${i.format.name}>`:i.name}function uN(i){try{return new lN(i)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw typeof t=="object"&&t?.message&&(e+=`: ${t.message} `),typeof t=="object"&&t?.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}const hN={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...hN}};const kl=globalThis.mathgl.config;function fN(i,{precision:t=kl.precision}={}){return i=dN(i),`${parseFloat(i.toPrecision(t))}`}function zg(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function qf(i,t,e){return mN(i,n=>Math.max(t,Math.min(e,n)))}function Db(i,t,e){return zg(i)?i.map((n,a)=>Db(n,t[a],e)):e*t+(1-e)*i}function Ay(i,t,e){const n=kl.EPSILON;try{if(i===t)return!0;if(zg(i)&&zg(t)){if(i.length!==t.length)return!1;for(let a=0;a<i.length;++a)if(!Ay(i[a],t[a]))return!1;return!0}return i&&i.equals?i.equals(t):t&&t.equals?t.equals(i):typeof i=="number"&&typeof t=="number"?Math.abs(i-t)<=kl.EPSILON*Math.max(1,Math.abs(i),Math.abs(t)):!1}finally{kl.EPSILON=n}}function dN(i){return Math.round(i/kl.EPSILON)*kl.EPSILON}function pN(i){return i.clone?i.clone():new Array(i.length)}function mN(i,t,e){if(zg(i)){const n=i;e=e||pN(n);for(let a=0;a<e.length&&a<n.length;++a){const f=typeof i=="number"?i:i[a];e[a]=t(f,a,e)}return e}return t(i)}class iM extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:zg(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(kl)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+fN(this[n],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Ay(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(n===void 0)return this.lerp(this,t,e);for(let a=0;a<this.ELEMENTS;++a){const f=t[a],m=typeof e=="number"?e:e[a];this[a]=f+n*(m-f)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=e[n];return this.check()}subtract(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=e[n];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(kl.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function gN(i,t){if(i.length!==t)return!1;for(let e=0;e<i.length;++e)if(!Number.isFinite(i[e]))return!1;return!0}function Ho(i){if(!Number.isFinite(i))throw new Error(`Invalid number ${JSON.stringify(i)}`);return i}function sx(i,t,e=""){if(kl.debug&&!gN(i,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return i}function ES(i,t){if(!i)throw new Error(`math.gl assertion ${t}`)}class _N extends iM{get x(){return this[0]}set x(t){this[0]=Ho(t)}get y(){return this[1]}set y(t){this[1]=Ho(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const a=this[n]-t[n];e+=a*a}return Ho(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Ho(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=e[n];return this.check()}divide(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return ES(t>=0&&t<this.ELEMENTS,"index is out of range"),Ho(this[t])}setComponent(t,e){return ES(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const cb=1e-6;let Ug=typeof Float32Array<"u"?Float32Array:Array;function yN(){const i=new Ug(2);return Ug!=Float32Array&&(i[0]=0,i[1]=0),i}function CS(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function vN(i,t){return i[0]=-t[0],i[1]=-t[1],i}function nM(i,t,e,n){const a=t[0],f=t[1];return i[0]=a+n*(e[0]-a),i[1]=f+n*(e[1]-f),i}function bN(i,t,e){const n=t[0],a=t[1];return i[0]=e[0]*n+e[4]*a+e[12],i[1]=e[1]*n+e[5]*a+e[13],i}(function(){const i=yN();return function(t,e,n,a,f,m){let l,w;for(e||(e=2),n||(n=0),a?w=Math.min(a*e+n,t.length):w=t.length,l=n;l<w;l+=e)i[0]=t[l],i[1]=t[l+1],f(i,i,m),t[l]=i[0],t[l+1]=i[1];return t}})();function xN(i,t,e){const n=t[0],a=t[1],f=e[3]*n+e[7]*a||1;return i[0]=(e[0]*n+e[4]*a)/f,i[1]=(e[1]*n+e[5]*a)/f,i}function rM(i,t,e){const n=t[0],a=t[1],f=t[2],m=e[3]*n+e[7]*a+e[11]*f||1;return i[0]=(e[0]*n+e[4]*a+e[8]*f)/m,i[1]=(e[1]*n+e[5]*a+e[9]*f)/m,i[2]=(e[2]*n+e[6]*a+e[10]*f)/m,i}function wN(i,t,e){const n=t[0],a=t[1];return i[0]=e[0]*n+e[2]*a,i[1]=e[1]*n+e[3]*a,i[2]=t[2],i}function TN(){const i=new Ug(3);return Ug!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function SN(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function AN(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function EN(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function CN(i,t,e){const n=t[0],a=t[1],f=t[2],m=e[0],l=e[1],w=e[2];return i[0]=a*w-f*l,i[1]=f*m-n*w,i[2]=n*l-a*m,i}function sM(i,t,e){const n=t[0],a=t[1],f=t[2];let m=e[3]*n+e[7]*a+e[11]*f+e[15];return m=m||1,i[0]=(e[0]*n+e[4]*a+e[8]*f+e[12])/m,i[1]=(e[1]*n+e[5]*a+e[9]*f+e[13])/m,i[2]=(e[2]*n+e[6]*a+e[10]*f+e[14])/m,i}function MN(i,t,e){const n=t[0],a=t[1],f=t[2];return i[0]=n*e[0]+a*e[3]+f*e[6],i[1]=n*e[1]+a*e[4]+f*e[7],i[2]=n*e[2]+a*e[5]+f*e[8],i}function RN(i,t,e){const n=e[0],a=e[1],f=e[2],m=e[3],l=t[0],w=t[1],C=t[2];let P=a*C-f*w,L=f*l-n*C,j=n*w-a*l,G=a*j-f*L,nt=f*P-n*j,at=n*L-a*P;const J=m*2;return P*=J,L*=J,j*=J,G*=2,nt*=2,at*=2,i[0]=l+P+G,i[1]=w+L+nt,i[2]=C+j+at,i}function PN(i,t,e,n){const a=[],f=[];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],f[0]=a[0],f[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),f[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),i[0]=f[0]+e[0],i[1]=f[1]+e[1],i[2]=f[2]+e[2],i}function IN(i,t,e,n){const a=[],f=[];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],f[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),f[1]=a[1],f[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),i[0]=f[0]+e[0],i[1]=f[1]+e[1],i[2]=f[2]+e[2],i}function DN(i,t,e,n){const a=[],f=[];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],f[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),f[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),f[2]=a[2],i[0]=f[0]+e[0],i[1]=f[1]+e[1],i[2]=f[2]+e[2],i}function kN(i,t){const e=i[0],n=i[1],a=i[2],f=t[0],m=t[1],l=t[2],w=Math.sqrt((e*e+n*n+a*a)*(f*f+m*m+l*l)),C=w&&EN(i,t)/w;return Math.acos(Math.min(Math.max(C,-1),1))}const ON=SN;(function(){const i=TN();return function(t,e,n,a,f,m){let l,w;for(e||(e=3),n||(n=0),a?w=Math.min(a*e+n,t.length):w=t.length,l=n;l<w;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],f(i,i,m),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();const ax=[0,0,0];let Wv;class Au extends _N{static get ZERO(){return Wv||(Wv=new Au(0,0,0),Object.freeze(Wv)),Wv}constructor(t=0,e=0,n=0){super(-0,-0,-0),arguments.length===1&&zg(t)?this.copy(t):(kl.debug&&(Ho(t),Ho(e),Ho(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return kl.debug&&(Ho(t.x),Ho(t.y),Ho(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Ho(t)}angle(t){return kN(this,t)}cross(t){return CN(this,this,t),this.check()}rotateX({radians:t,origin:e=ax}){return PN(this,this,e,t),this.check()}rotateY({radians:t,origin:e=ax}){return IN(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=ax}){return DN(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return sM(this,this,t),this.check()}transformAsVector(t){return rM(this,this,t),this.check()}transformByMatrix3(t){return MN(this,this,t),this.check()}transformByMatrix2(t){return wN(this,this,t),this.check()}transformByQuaternion(t){return RN(this,this,t),this.check()}}class BN extends iM{toString(){let t="[";if(kl.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=Ho(n),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let a=0;a<this.RANK;++a)e[a]=this[n+a];return e}setColumn(t,e){const n=t*this.RANK;for(let a=0;a<this.RANK;++a)this[n+a]=e[a];return this}}function LN(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function FN(i,t){if(i===t){const e=t[1],n=t[2],a=t[3],f=t[6],m=t[7],l=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=n,i[9]=f,i[11]=t[14],i[12]=a,i[13]=m,i[14]=l}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function o1(i,t){const e=t[0],n=t[1],a=t[2],f=t[3],m=t[4],l=t[5],w=t[6],C=t[7],P=t[8],L=t[9],j=t[10],G=t[11],nt=t[12],at=t[13],J=t[14],mt=t[15],Mt=e*l-n*m,pt=e*w-a*m,Pt=e*C-f*m,kt=n*w-a*l,$t=n*C-f*l,ae=a*C-f*w,qt=P*at-L*nt,le=P*J-j*nt,Oe=P*mt-G*nt,Be=L*J-j*at,qe=L*mt-G*at,ri=j*mt-G*J;let Ne=Mt*ri-pt*qe+Pt*Be+kt*Oe-$t*le+ae*qt;return Ne?(Ne=1/Ne,i[0]=(l*ri-w*qe+C*Be)*Ne,i[1]=(a*qe-n*ri-f*Be)*Ne,i[2]=(at*ae-J*$t+mt*kt)*Ne,i[3]=(j*$t-L*ae-G*kt)*Ne,i[4]=(w*Oe-m*ri-C*le)*Ne,i[5]=(e*ri-a*Oe+f*le)*Ne,i[6]=(J*Pt-nt*ae-mt*pt)*Ne,i[7]=(P*ae-j*Pt+G*pt)*Ne,i[8]=(m*qe-l*Oe+C*qt)*Ne,i[9]=(n*Oe-e*qe-f*qt)*Ne,i[10]=(nt*$t-at*Pt+mt*Mt)*Ne,i[11]=(L*Pt-P*$t-G*Mt)*Ne,i[12]=(l*le-m*Be-w*qt)*Ne,i[13]=(e*Be-n*le+a*qt)*Ne,i[14]=(at*pt-nt*kt-J*Mt)*Ne,i[15]=(P*kt-L*pt+j*Mt)*Ne,i):null}function NN(i){const t=i[0],e=i[1],n=i[2],a=i[3],f=i[4],m=i[5],l=i[6],w=i[7],C=i[8],P=i[9],L=i[10],j=i[11],G=i[12],nt=i[13],at=i[14],J=i[15],mt=t*m-e*f,Mt=t*l-n*f,pt=e*l-n*m,Pt=C*nt-P*G,kt=C*at-L*G,$t=P*at-L*nt,ae=t*$t-e*kt+n*Pt,qt=f*$t-m*kt+l*Pt,le=C*pt-P*Mt+L*mt,Oe=G*pt-nt*Mt+at*mt;return w*ae-a*qt+J*le-j*Oe}function Dp(i,t,e){const n=t[0],a=t[1],f=t[2],m=t[3],l=t[4],w=t[5],C=t[6],P=t[7],L=t[8],j=t[9],G=t[10],nt=t[11],at=t[12],J=t[13],mt=t[14],Mt=t[15];let pt=e[0],Pt=e[1],kt=e[2],$t=e[3];return i[0]=pt*n+Pt*l+kt*L+$t*at,i[1]=pt*a+Pt*w+kt*j+$t*J,i[2]=pt*f+Pt*C+kt*G+$t*mt,i[3]=pt*m+Pt*P+kt*nt+$t*Mt,pt=e[4],Pt=e[5],kt=e[6],$t=e[7],i[4]=pt*n+Pt*l+kt*L+$t*at,i[5]=pt*a+Pt*w+kt*j+$t*J,i[6]=pt*f+Pt*C+kt*G+$t*mt,i[7]=pt*m+Pt*P+kt*nt+$t*Mt,pt=e[8],Pt=e[9],kt=e[10],$t=e[11],i[8]=pt*n+Pt*l+kt*L+$t*at,i[9]=pt*a+Pt*w+kt*j+$t*J,i[10]=pt*f+Pt*C+kt*G+$t*mt,i[11]=pt*m+Pt*P+kt*nt+$t*Mt,pt=e[12],Pt=e[13],kt=e[14],$t=e[15],i[12]=pt*n+Pt*l+kt*L+$t*at,i[13]=pt*a+Pt*w+kt*j+$t*J,i[14]=pt*f+Pt*C+kt*G+$t*mt,i[15]=pt*m+Pt*P+kt*nt+$t*Mt,i}function kb(i,t,e){const n=e[0],a=e[1],f=e[2];let m,l,w,C,P,L,j,G,nt,at,J,mt;return t===i?(i[12]=t[0]*n+t[4]*a+t[8]*f+t[12],i[13]=t[1]*n+t[5]*a+t[9]*f+t[13],i[14]=t[2]*n+t[6]*a+t[10]*f+t[14],i[15]=t[3]*n+t[7]*a+t[11]*f+t[15]):(m=t[0],l=t[1],w=t[2],C=t[3],P=t[4],L=t[5],j=t[6],G=t[7],nt=t[8],at=t[9],J=t[10],mt=t[11],i[0]=m,i[1]=l,i[2]=w,i[3]=C,i[4]=P,i[5]=L,i[6]=j,i[7]=G,i[8]=nt,i[9]=at,i[10]=J,i[11]=mt,i[12]=m*n+P*a+nt*f+t[12],i[13]=l*n+L*a+at*f+t[13],i[14]=w*n+j*a+J*f+t[14],i[15]=C*n+G*a+mt*f+t[15]),i}function Nw(i,t,e){const n=e[0],a=e[1],f=e[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*a,i[5]=t[5]*a,i[6]=t[6]*a,i[7]=t[7]*a,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function zN(i,t,e,n){let a=n[0],f=n[1],m=n[2],l=Math.sqrt(a*a+f*f+m*m),w,C,P,L,j,G,nt,at,J,mt,Mt,pt,Pt,kt,$t,ae,qt,le,Oe,Be,qe,ri,Ne,wi;return l<cb?null:(l=1/l,a*=l,f*=l,m*=l,C=Math.sin(e),w=Math.cos(e),P=1-w,L=t[0],j=t[1],G=t[2],nt=t[3],at=t[4],J=t[5],mt=t[6],Mt=t[7],pt=t[8],Pt=t[9],kt=t[10],$t=t[11],ae=a*a*P+w,qt=f*a*P+m*C,le=m*a*P-f*C,Oe=a*f*P-m*C,Be=f*f*P+w,qe=m*f*P+a*C,ri=a*m*P+f*C,Ne=f*m*P-a*C,wi=m*m*P+w,i[0]=L*ae+at*qt+pt*le,i[1]=j*ae+J*qt+Pt*le,i[2]=G*ae+mt*qt+kt*le,i[3]=nt*ae+Mt*qt+$t*le,i[4]=L*Oe+at*Be+pt*qe,i[5]=j*Oe+J*Be+Pt*qe,i[6]=G*Oe+mt*Be+kt*qe,i[7]=nt*Oe+Mt*Be+$t*qe,i[8]=L*ri+at*Ne+pt*wi,i[9]=j*ri+J*Ne+Pt*wi,i[10]=G*ri+mt*Ne+kt*wi,i[11]=nt*ri+Mt*Ne+$t*wi,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function aM(i,t,e){const n=Math.sin(e),a=Math.cos(e),f=t[4],m=t[5],l=t[6],w=t[7],C=t[8],P=t[9],L=t[10],j=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*a+C*n,i[5]=m*a+P*n,i[6]=l*a+L*n,i[7]=w*a+j*n,i[8]=C*a-f*n,i[9]=P*a-m*n,i[10]=L*a-l*n,i[11]=j*a-w*n,i}function UN(i,t,e){const n=Math.sin(e),a=Math.cos(e),f=t[0],m=t[1],l=t[2],w=t[3],C=t[8],P=t[9],L=t[10],j=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*a-C*n,i[1]=m*a-P*n,i[2]=l*a-L*n,i[3]=w*a-j*n,i[8]=f*n+C*a,i[9]=m*n+P*a,i[10]=l*n+L*a,i[11]=w*n+j*a,i}function oM(i,t,e){const n=Math.sin(e),a=Math.cos(e),f=t[0],m=t[1],l=t[2],w=t[3],C=t[4],P=t[5],L=t[6],j=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*a+C*n,i[1]=m*a+P*n,i[2]=l*a+L*n,i[3]=w*a+j*n,i[4]=C*a-f*n,i[5]=P*a-m*n,i[6]=L*a-l*n,i[7]=j*a-w*n,i}function VN(i,t){const e=t[0],n=t[1],a=t[2],f=t[3],m=e+e,l=n+n,w=a+a,C=e*m,P=n*m,L=n*l,j=a*m,G=a*l,nt=a*w,at=f*m,J=f*l,mt=f*w;return i[0]=1-L-nt,i[1]=P+mt,i[2]=j-J,i[3]=0,i[4]=P-mt,i[5]=1-C-nt,i[6]=G+at,i[7]=0,i[8]=j+J,i[9]=G-at,i[10]=1-C-L,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function jN(i,t,e,n,a,f,m){const l=1/(e-t),w=1/(a-n),C=1/(f-m);return i[0]=f*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f*2*w,i[6]=0,i[7]=0,i[8]=(e+t)*l,i[9]=(a+n)*w,i[10]=(m+f)*C,i[11]=-1,i[12]=0,i[13]=0,i[14]=m*f*2*C,i[15]=0,i}function $N(i,t,e,n,a){const f=1/Math.tan(t/2);if(i[0]=f/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0){const m=1/(n-a);i[10]=(a+n)*m,i[14]=2*a*n*m}else i[10]=-1,i[14]=-2*n;return i}const HN=$N;function WN(i,t,e,n,a,f,m){const l=1/(t-e),w=1/(n-a),C=1/(f-m);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(t+e)*l,i[13]=(a+n)*w,i[14]=(m+f)*C,i[15]=1,i}const qN=WN;function XN(i,t,e,n){let a,f,m,l,w,C,P,L,j,G;const nt=t[0],at=t[1],J=t[2],mt=n[0],Mt=n[1],pt=n[2],Pt=e[0],kt=e[1],$t=e[2];return Math.abs(nt-Pt)<cb&&Math.abs(at-kt)<cb&&Math.abs(J-$t)<cb?LN(i):(L=nt-Pt,j=at-kt,G=J-$t,a=1/Math.sqrt(L*L+j*j+G*G),L*=a,j*=a,G*=a,f=Mt*G-pt*j,m=pt*L-mt*G,l=mt*j-Mt*L,a=Math.sqrt(f*f+m*m+l*l),a?(a=1/a,f*=a,m*=a,l*=a):(f=0,m=0,l=0),w=j*l-G*m,C=G*f-L*l,P=L*m-j*f,a=Math.sqrt(w*w+C*C+P*P),a?(a=1/a,w*=a,C*=a,P*=a):(w=0,C=0,P=0),i[0]=f,i[1]=w,i[2]=L,i[3]=0,i[4]=m,i[5]=C,i[6]=j,i[7]=0,i[8]=l,i[9]=P,i[10]=G,i[11]=0,i[12]=-(f*nt+m*at+l*J),i[13]=-(w*nt+C*at+P*J),i[14]=-(L*nt+j*at+G*J),i[15]=1,i)}function ZN(){const i=new Ug(4);return Ug!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function GN(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function Ly(i,t,e){const n=t[0],a=t[1],f=t[2],m=t[3];return i[0]=e[0]*n+e[4]*a+e[8]*f+e[12]*m,i[1]=e[1]*n+e[5]*a+e[9]*f+e[13]*m,i[2]=e[2]*n+e[6]*a+e[10]*f+e[14]*m,i[3]=e[3]*n+e[7]*a+e[11]*f+e[15]*m,i}(function(){const i=ZN();return function(t,e,n,a,f,m){let l,w;for(e||(e=4),n||(n=0),a?w=Math.min(a*e+n,t.length):w=t.length,l=n;l<w;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],f(i,i,m),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();var l1;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(l1||(l1={}));const YN=45*Math.PI/180,KN=1,ox=.1,lx=500,QN=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Eu extends BN{static get IDENTITY(){return tz()}static get ZERO(){return JN()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return l1}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,a,f,m,l,w,C,P,L,j,G,nt,at,J){return this[0]=t,this[1]=e,this[2]=n,this[3]=a,this[4]=f,this[5]=m,this[6]=l,this[7]=w,this[8]=C,this[9]=P,this[10]=L,this[11]=j,this[12]=G,this[13]=nt,this[14]=at,this[15]=J,this.check()}setRowMajor(t,e,n,a,f,m,l,w,C,P,L,j,G,nt,at,J){return this[0]=t,this[1]=f,this[2]=C,this[3]=G,this[4]=e,this[5]=m,this[6]=P,this[7]=nt,this[8]=n,this[9]=l,this[10]=L,this[11]=at,this[12]=a,this[13]=w,this[14]=j,this[15]=J,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(QN)}fromObject(t){return this.check()}fromQuaternion(t){return VN(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:a,top:f,near:m=ox,far:l=lx}=t;return l===1/0?ez(this,e,n,a,f,m):jN(this,e,n,a,f,m,l),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:a=[0,1,0]}=t;return XN(this,e,n,a),this.check()}ortho(t){const{left:e,right:n,bottom:a,top:f,near:m=ox,far:l=lx}=t;return qN(this,e,n,a,f,m,l),this.check()}orthographic(t){const{fovy:e=YN,aspect:n=KN,focalDistance:a=1,near:f=ox,far:m=lx}=t;MS(e);const l=e/2,w=a*Math.tan(l),C=w*n;return this.ortho({left:-C,right:C,bottom:-w,top:w,near:f,far:m})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:a=.1,far:f=500}=t;return MS(e),HN(this,e,n,a,f),this.check()}determinant(){return NN(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),a=1/n[0],f=1/n[1],m=1/n[2];return t[0]=this[0]*a,t[1]=this[1]*f,t[2]=this[2]*m,t[3]=0,t[4]=this[4]*a,t[5]=this[5]*f,t[6]=this[6]*m,t[7]=0,t[8]=this[8]*a,t[9]=this[9]*f,t[10]=this[10]*m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),a=1/n[0],f=1/n[1],m=1/n[2];return t[0]=this[0]*a,t[1]=this[1]*f,t[2]=this[2]*m,t[3]=this[4]*a,t[4]=this[5]*f,t[5]=this[6]*m,t[6]=this[8]*a,t[7]=this[9]*f,t[8]=this[10]*m,t}transpose(){return FN(this,this),this.check()}invert(){return o1(this,this),this.check()}multiplyLeft(t){return Dp(this,t,this),this.check()}multiplyRight(t){return Dp(this,this,t),this.check()}rotateX(t){return aM(this,this,t),this.check()}rotateY(t){return UN(this,this,t),this.check()}rotateZ(t){return oM(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return zN(this,this,t,e),this.check()}scale(t){return Nw(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return kb(this,this,t),this.check()}transform(t,e){return t.length===4?(e=Ly(e||[-0,-0,-0,-0],t,this),sx(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let a;switch(n){case 2:a=bN(e||[-0,-0],t,this);break;case 3:a=sM(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return sx(a,t.length),a}transformAsVector(t,e){let n;switch(t.length){case 2:n=xN(e||[-0,-0],t,this);break;case 3:n=rM(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return sx(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let qv,Xv;function JN(){return qv||(qv=new Eu([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(qv)),qv}function tz(){return Xv||(Xv=new Eu,Object.freeze(Xv)),Xv}function MS(i){if(i>Math.PI*2)throw Error("expected radians")}function ez(i,t,e,n,a,f){const m=2*f/(e-t),l=2*f/(a-n),w=(e+t)/(e-t),C=(a+n)/(a-n),P=-1,L=-1,j=-2*f;return i[0]=m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=w,i[9]=C,i[10]=P,i[11]=L,i[12]=0,i[13]=0,i[14]=j,i[15]=0,i}function lM(i,t=[],e=0){const n=Math.fround(i),a=i-n;return t[e]=n,t[e+1]=a,t}function iz(i){return i-Math.fround(i)}function nz(i){const t=new Float32Array(32);for(let e=0;e<4;++e)for(let n=0;n<4;++n){const a=e*4+n;lM(i[n*4+e],t,a*2)}return t}const rz=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,sz={name:"fp32",vs:rz},az=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,oz={ONE:1},lz={name:"fp64arithmetic",vs:az,defaultUniforms:oz,uniformTypes:{ONE:"f32"},fp64ify:lM,fp64LowPart:iz,fp64ifyMatrix4:nz},cz=[0,1,1,1],uz=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,hz=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,RS={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:cz},vs:uz,fs:hz,getUniforms:fz};function fz(i={},t){const e={};if(i.highlightedObjectColor!==void 0)if(i.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const n=i.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=n}if(i.highlightColor){const n=Array.from(i.highlightColor,a=>a/255);Number.isFinite(n[3])||(n[3]=1),e.highlightColor=n}return i.isActive!==void 0&&(e.isActive=!!i.isActive,e.isAttribute=!!i.isAttribute),i.useFloatColors!==void 0&&(e.useFloatColors=!!i.useFloatColors),e}const PS=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,dz={name:"layer",vs:PS,fs:PS,getUniforms:i=>({opacity:Math.pow(i.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},pz=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,mz={name:"color",dependencies:[],source:pz,getUniforms:i=>({}),uniformTypes:{opacity:"f32"}},gz=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,cM="#define SMOOTH_EDGE_RADIUS 0.5",_z=`${cM}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,yz=`${cM}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,uM={name:"geometry",source:gz,vs:_z,fs:yz},vz=25;var Jr;(function(i){i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel"})(Jr||(Jr={}));var ps;(function(i){i[i.None=0]="None",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Up=4]="Up",i[i.Down=8]="Down",i[i.Horizontal=3]="Horizontal",i[i.Vertical=12]="Vertical",i[i.All=15]="All"})(ps||(ps={}));var Si;(function(i){i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Recognized=8]="Recognized",i[i.Cancelled=16]="Cancelled",i[i.Failed=32]="Failed"})(Si||(Si={}));const bz="compute",xz="auto",c1="manipulation",ub="none",u1="pan-x",h1="pan-y";function wz(i){if(i.includes(ub))return ub;const t=i.includes(u1),e=i.includes(h1);return t&&e?ub:t||e?t?u1:h1:i.includes(c1)?c1:xz}class Tz{constructor(t,e){this.actions="",this.manager=t,this.set(e)}set(t){t===bz&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(const e of this.manager.recognizers)e.options.enable&&(t=t.concat(e.getTouchAction()));return wz(t.join(" "))}}function Ob(i){return i.trim().split(/\s+/g)}function cx(i,t,e){if(i)for(const n of Ob(t))i.addEventListener(n,e,!1)}function ux(i,t,e){if(i)for(const n of Ob(t))i.removeEventListener(n,e,!1)}function IS(i){return(i.ownerDocument||i).defaultView}function Sz(i,t){let e=i;for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function hM(i){const t=i.length;if(t===1)return{x:Math.round(i[0].clientX),y:Math.round(i[0].clientY)};let e=0,n=0,a=0;for(;a<t;)e+=i[a].clientX,n+=i[a].clientY,a++;return{x:Math.round(e/t),y:Math.round(n/t)}}function DS(i){const t=[];let e=0;for(;e<i.pointers.length;)t[e]={clientX:Math.round(i.pointers[e].clientX),clientY:Math.round(i.pointers[e].clientY)},e++;return{timeStamp:Date.now(),pointers:t,center:hM(t),deltaX:i.deltaX,deltaY:i.deltaY}}function fM(i,t){const e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)}function kS(i,t){const e=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(e*e+n*n)}function Az(i,t){const e=t.x-i.x,n=t.y-i.y;return Math.atan2(n,e)*180/Math.PI}function OS(i,t){const e=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.atan2(n,e)*180/Math.PI}function dM(i,t){return i===t?ps.None:Math.abs(i)>=Math.abs(t)?i<0?ps.Left:ps.Right:t<0?ps.Up:ps.Down}function Ez(i,t){const e=t.center;let n=i.offsetDelta,a=i.prevDelta;const f=i.prevInput;return(t.eventType===Jr.Start||f?.eventType===Jr.End)&&(a=i.prevDelta={x:f?.deltaX||0,y:f?.deltaY||0},n=i.offsetDelta={x:e.x,y:e.y}),{deltaX:a.x+(e.x-n.x),deltaY:a.y+(e.y-n.y)}}function pM(i,t,e){return{x:t/i||0,y:e/i||0}}function Cz(i,t){return kS(t[0],t[1])/kS(i[0],i[1])}function Mz(i,t){return OS(t[1],t[0])-OS(i[1],i[0])}function Rz(i,t){const e=i.lastInterval||t,n=t.timeStamp-e.timeStamp;let a,f,m,l;if(t.eventType!==Jr.Cancel&&(n>vz||e.velocity===void 0)){const w=t.deltaX-e.deltaX,C=t.deltaY-e.deltaY,P=pM(n,w,C);f=P.x,m=P.y,a=Math.abs(P.x)>Math.abs(P.y)?P.x:P.y,l=dM(w,C),i.lastInterval=t}else a=e.velocity,f=e.velocityX,m=e.velocityY,l=e.direction;t.velocity=a,t.velocityX=f,t.velocityY=m,t.direction=l}function Pz(i,t){const{session:e}=i,{pointers:n}=t,{length:a}=n;e.firstInput||(e.firstInput=DS(t)),a>1&&!e.firstMultiple?e.firstMultiple=DS(t):a===1&&(e.firstMultiple=!1);const{firstInput:f,firstMultiple:m}=e,l=m?m.center:f.center,w=t.center=hM(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-f.timeStamp,t.angle=Az(l,w),t.distance=fM(l,w);const{deltaX:C,deltaY:P}=Ez(e,t);t.deltaX=C,t.deltaY=P,t.offsetDirection=dM(t.deltaX,t.deltaY);const L=pM(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=L.x,t.overallVelocityY=L.y,t.overallVelocity=Math.abs(L.x)>Math.abs(L.y)?L.x:L.y,t.scale=m?Cz(m.pointers,n):1,t.rotation=m?Mz(m.pointers,n):0,t.maxPointers=e.prevInput?t.pointers.length>e.prevInput.maxPointers?t.pointers.length:e.prevInput.maxPointers:t.pointers.length;let j=i.element;return Sz(t.srcEvent.target,j)&&(j=t.srcEvent.target),t.target=j,Rz(e,t),t}function Iz(i,t,e){const n=e.pointers.length,a=e.changedPointers.length,f=t&Jr.Start&&n-a===0,m=t&(Jr.End|Jr.Cancel)&&n-a===0;e.isFirst=!!f,e.isFinal=!!m,f&&(i.session={}),e.eventType=t;const l=Pz(i,e);i.emit("hammer.input",l),i.recognize(l),i.session.prevInput=l}let Dz=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,e){Iz(this.manager,t,e)}init(){cx(this.element,this.evEl,this.domHandler),cx(this.target,this.evTarget,this.domHandler),cx(IS(this.element),this.evWin,this.domHandler)}destroy(){ux(this.element,this.evEl,this.domHandler),ux(this.target,this.evTarget,this.domHandler),ux(IS(this.element),this.evWin,this.domHandler)}};const kz={pointerdown:Jr.Start,pointermove:Jr.Move,pointerup:Jr.End,pointercancel:Jr.Cancel,pointerout:Jr.Cancel},Oz="pointerdown",Bz="pointermove pointerup pointercancel";class Lz extends Dz{constructor(t){super(t),this.evEl=Oz,this.evWin=Bz,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:e}=this;let n=!1;const a=kz[t.type],f=t.pointerType,m=f==="touch";let l=e.findIndex(w=>w.pointerId===t.pointerId);a&Jr.Start&&(t.buttons||m)?l<0&&(e.push(t),l=e.length-1):a&(Jr.End|Jr.Cancel)&&(n=!0),!(l<0)&&(e[l]=t,this.callback(a,{pointers:e,changedPointers:[t],eventType:a,pointerType:f,srcEvent:t}),n&&e.splice(l,1))}}const Fz=["","webkit","Moz","MS","ms","o"];function Nz(i,t){const e=t[0].toUpperCase()+t.slice(1);for(const n of Fz){const a=n?n+e:t;if(a in i)return a}}const zz=1,BS=2,LS={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Uz{constructor(t,e){this.options={...LS,...e,cssProps:{...LS.cssProps,...e.cssProps},inputTarget:e.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new Lz(this),this.touchAction=new Tz(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?BS:zz}recognize(t){const{session:e}=this;if(e.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let n;const{recognizers:a}=this;let{curRecognizer:f}=e;(!f||f&&f.state&Si.Recognized)&&(f=e.curRecognizer=null);let m=0;for(;m<a.length;)n=a[m],e.stopped!==BS&&(!f||n===f||n.canRecognizeWith(f))?n.recognize(t):n.reset(),!f&&n.state&(Si.Began|Si.Changed|Si.Ended)&&(f=e.curRecognizer=n),m++}get(t){const{recognizers:e}=this;for(let n=0;n<e.length;n++)if(e[n].options.event===t)return e[n];return null}add(t){if(Array.isArray(t)){for(const n of t)this.add(n);return this}const e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(const n of t)this.remove(n);return this}const e=typeof t=="string"?this.get(t):t;if(e){const{recognizers:n}=this,a=n.indexOf(e);a!==-1&&(n.splice(a,1),this.touchAction.update())}return this}on(t,e){if(!t||!e)return;const{handlers:n}=this;for(const a of Ob(t))n[a]=n[a]||[],n[a].push(e)}off(t,e){if(!t)return;const{handlers:n}=this;for(const a of Ob(t))e?n[a]&&n[a].splice(n[a].indexOf(e),1):delete n[a]}emit(t,e){const n=this.handlers[t]&&this.handlers[t].slice();if(!n||!n.length)return;const a=e;a.type=t,a.preventDefault=function(){e.srcEvent.preventDefault()};let f=0;for(;f<n.length;)n[f](a),f++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){const{element:e}=this;if(e){for(const[n,a]of Object.entries(this.options.cssProps)){const f=Nz(e.style,n);t?(this.oldCssProps[f]=e.style[f],e.style[f]=a):e.style[f]=this.oldCssProps[f]||""}t||(this.oldCssProps={})}}}let Vz=1;function jz(){return Vz++}function FS(i){return i&Si.Cancelled?"cancel":i&Si.Ended?"end":i&Si.Changed?"move":i&Si.Began?"start":""}class mM{constructor(t){this.options=t,this.id=jz(),this.state=Si.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const a of t)this.recognizeWith(a);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{simultaneous:n}=this;return n[e.id]||(n[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const n of t)this.dropRecognizeWith(n);return this}let e;return typeof t=="string"?e=this.manager.get(t):e=t,e&&delete this.simultaneous[e.id],this}requireFailure(t){if(Array.isArray(t)){for(const a of t)this.requireFailure(a);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{requireFail:n}=this;return n.indexOf(e)===-1&&(n.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const n of t)this.dropRequireFailure(n);return this}let e;if(typeof t=="string"?e=this.manager.get(t):e=t,e){const n=this.requireFail.indexOf(e);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:e}=this;e<Si.Ended&&this.manager.emit(this.options.event+FS(e),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),e>=Si.Ended&&this.manager.emit(this.options.event+FS(e),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=Si.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Si.Failed|Si.Possible)))return!1;t++}return!0}recognize(t){const e={...t};if(!this.options.enable){this.reset(),this.state=Si.Failed;return}this.state&(Si.Recognized|Si.Cancelled|Si.Failed)&&(this.state=Si.Possible),this.state=this.process(e),this.state&(Si.Began|Si.Changed|Si.Ended|Si.Cancelled)&&this.tryEmit(e)}getEventNames(){return[this.options.event]}reset(){}}class gM extends mM{attrTest(t){const e=this.options.pointers;return e===0||t.pointers.length===e}process(t){const{state:e}=this,{eventType:n}=t,a=e&(Si.Began|Si.Changed),f=this.attrTest(t);return a&&(n&Jr.Cancel||!f)?e|Si.Cancelled:a||f?n&Jr.End?e|Si.Ended:e&Si.Began?e|Si.Changed:Si.Began:Si.Failed}}class NS extends mM{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[c1]}process(t){const{options:e}=this,n=t.pointers.length===e.pointers,a=t.distance<e.threshold,f=t.deltaTime<e.time;if(this.reset(),t.eventType&Jr.Start&&this.count===0)return this.failTimeout();if(a&&f&&n){if(t.eventType!==Jr.End)return this.failTimeout();const m=this.pTime?t.timeStamp-this.pTime<e.interval:!0,l=!this.pCenter||fM(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!l||!m?this.count=1:this.count+=1,this._input=t,this.count%e.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Si.Recognized,this.tryEmit(this._input)},e.interval),Si.Began):Si.Recognized}return Si.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Si.Failed},this.options.interval),Si.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===Si.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const $z=["","start","move","end","cancel","up","down","left","right"];class zS extends gM{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ps.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,e=[];return t&ps.Horizontal&&e.push(h1),t&ps.Vertical&&e.push(u1),e}getEventNames(){return $z.map(t=>this.options.event+t)}directionTest(t){const{options:e}=this;let n=!0,{distance:a}=t,{direction:f}=t;const m=t.deltaX,l=t.deltaY;return f&e.direction||(e.direction&ps.Horizontal?(f=m===0?ps.None:m<0?ps.Left:ps.Right,n=m!==this.pX,a=Math.abs(t.deltaX)):(f=l===0?ps.None:l<0?ps.Up:ps.Down,n=l!==this.pY,a=Math.abs(t.deltaY))),t.direction=f,n&&a>e.threshold&&!!(f&e.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&Si.Began)||!(this.state&Si.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const e=ps[t.direction].toLowerCase();e&&(t.additionalEvent=this.options.event+e),super.emit(t)}}const Hz=["","start","move","end","cancel","in","out"];class Wz extends gM{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[ub]}getEventNames(){return Hz.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&Si.Began))}emit(t){if(t.scale!==1){const e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}super.emit(t)}}class Qb{constructor(t,e,n){this.element=t,this.callback=e,this.options=n}}const qz=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Xz=qz.indexOf("firefox")!==-1,US=4.000244140625,Zz=40,Gz=.25;class Yz extends Qb{constructor(t,e,n){super(t,e,{enable:!0,...n}),this.handleEvent=a=>{if(!this.options.enable)return;let f=a.deltaY;globalThis.WheelEvent&&(Xz&&a.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(f/=globalThis.devicePixelRatio),a.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(f*=Zz)),f!==0&&f%US===0&&(f=Math.floor(f/US)),a.shiftKey&&f&&(f=f*Gz),this.callback({type:"wheel",center:{x:a.clientX,y:a.clientY},delta:-f,srcEvent:a,pointerType:"mouse",target:a.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,e){t==="wheel"&&(this.options.enable=e)}}const VS=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class Kz extends Qb{constructor(t,e,n){super(t,e,{enable:!0,...n}),this.handleEvent=f=>{this.handleOverEvent(f),this.handleOutEvent(f),this.handleEnterEvent(f),this.handleLeaveEvent(f),this.handleMoveEvent(f)},this.pressed=!1;const{enable:a}=this.options;this.enableMoveEvent=a,this.enableLeaveEvent=a,this.enableEnterEvent=a,this.enableOutEvent=a,this.enableOverEvent=a,VS.forEach(f=>t.addEventListener(f,this.handleEvent))}destroy(){VS.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){switch(t){case"pointermove":this.enableMoveEvent=e;break;case"pointerover":this.enableOverEvent=e;break;case"pointerout":this.enableOutEvent=e;break;case"pointerenter":this.enableEnterEvent=e;break;case"pointerleave":this.enableLeaveEvent=e;break}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const jS=["keydown","keyup"];class Qz extends Qb{constructor(t,e,n){super(t,e,{enable:!0,tabIndex:0,...n}),this.handleEvent=a=>{const f=a.target||a.srcElement;f.tagName==="INPUT"&&f.type==="text"||f.tagName==="TEXTAREA"||(this.enableDownEvent&&a.type==="keydown"&&this.callback({type:"keydown",srcEvent:a,key:a.key,target:a.target}),this.enableUpEvent&&a.type==="keyup"&&this.callback({type:"keyup",srcEvent:a,key:a.key,target:a.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",jS.forEach(a=>t.addEventListener(a,this.handleEvent))}destroy(){jS.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t==="keydown"&&(this.enableDownEvent=e),t==="keyup"&&(this.enableUpEvent=e)}}class Jz extends Qb{constructor(t,e,n){super(t,e,n),this.handleEvent=a=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t==="contextmenu"&&(this.options.enable=e)}}const $S=1,f1=2,HS=4,t6={pointerdown:$S,pointermove:f1,pointerup:HS,mousedown:$S,mousemove:f1,mouseup:HS},e6=0,i6=1,n6=2,r6=1,s6=2,a6=4;function o6(i){const t=t6[i.srcEvent.type];if(!t)return null;const{buttons:e,button:n}=i.srcEvent;let a=!1,f=!1,m=!1;return t===f1?(a=!!(e&r6),f=!!(e&a6),m=!!(e&s6)):(a=n===e6,f=n===i6,m=n===n6),{leftButton:a,middleButton:f,rightButton:m}}function l6(i,t){const e=i.center;if(!e)return null;const n=t.getBoundingClientRect(),a=n.width/t.offsetWidth||1,f=n.height/t.offsetHeight||1,m={x:(e.x-n.left-t.clientLeft)/a,y:(e.y-n.top-t.clientTop)/f};return{center:e,offsetCenter:m}}const c6={srcElement:"root",priority:0};class u6{constructor(t,e){this.handleEvent=n=>{if(this.isEmpty())return;const a=this._normalizeEvent(n);let f=n.srcEvent.target;for(;f&&f!==a.rootElement;){if(this._emit(a,f),a.handled)return;f=f.parentNode}this._emit(a,"root")},this.eventManager=t,this.recognizerName=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n,a=!1,f=!1){const{handlers:m,handlersByElement:l}=this,w={...c6,...n};let C=l.get(w.srcElement);C||(C=[],l.set(w.srcElement,C));const P={type:t,handler:e,srcElement:w.srcElement,priority:w.priority};a&&(P.once=!0),f&&(P.passive=!0),m.push(P),this._active=this._active||!P.passive;let L=C.length-1;for(;L>=0&&!(C[L].priority>=P.priority);)L--;C.splice(L+1,0,P)}remove(t,e){const{handlers:n,handlersByElement:a}=this;for(let f=n.length-1;f>=0;f--){const m=n[f];if(m.type===t&&m.handler===e){n.splice(f,1);const l=a.get(m.srcElement);l.splice(l.indexOf(m),1),l.length===0&&a.delete(m.srcElement)}}this._active=n.some(f=>!f.passive)}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let a=!1;const f=()=>{t.handled=!0},m=()=>{t.handled=!0,a=!0},l=[];for(let w=0;w<n.length;w++){const{type:C,handler:P,once:L}=n[w];if(P({...t,type:C,stopPropagation:f,stopImmediatePropagation:m}),L&&l.push(n[w]),a)break}for(let w=0;w<l.length;w++){const{type:C,handler:P}=l[w];this.remove(C,P)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...o6(t),...l6(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}function h6(i){if("recognizer"in i)return i;let t;const e=Array.isArray(i)?[...i]:[i];if(typeof e[0]=="function"){const n=e.shift(),a=e.shift()||{};t=new n(a)}else t=e.shift();return{recognizer:t,recognizeWith:typeof e[0]=="string"?[e[0]]:e[0],requireFailure:typeof e[1]=="string"?[e[1]]:e[1]}}class f6{constructor(t=null,e={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...e},this.events=new Map,this.element=t,!!t){this.manager=new Uz(t,this.options);for(const n of this.options.recognizers){const{recognizer:a,recognizeWith:f,requireFailure:m}=h6(n);this.manager.add(a),f&&a.recognizeWith(f),m&&a.requireFailure(m)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Yz(t,this._onOtherEvent,{enable:!1}),this.moveInput=new Kz(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Qz(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new Jz(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const a=n.get(t);a&&(a.set({enable:e}),n.touchAction.update()),this.wheelInput?.enableEventType(t,e),this.moveInput?.enableEventType(t,e),this.keyInput?.enableEventType(t,e),this.contextmenuInput?.enableEventType(t,e)}_addEventHandler(t,e,n,a,f){if(typeof t!="string"){n=e;for(const[C,P]of Object.entries(t))this._addEventHandler(C,P,n,a,f);return}const{manager:m,events:l}=this;if(!m)return;let w=l.get(t);if(!w){const C=this._getRecognizerName(t)||t;w=new u6(this,C),l.set(t,w),m&&m.on(t,w.handleEvent)}w.add(t,e,n,a,f),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const[f,m]of Object.entries(t))this._removeEventHandler(f,m);return}const{events:n}=this,a=n.get(t);if(a&&(a.remove(t,e),a.isEmpty())){const{recognizerName:f}=a;let m=!1;for(const l of n.values())if(l.recognizerName===f&&!l.isEmpty()){m=!0;break}m||this._toggleRecognizer(f,!1)}}_getRecognizerName(t){return this.manager.recognizers.find(e=>e.getEventNames().includes(t))?.options.event}}const fn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(fn,"IDENTITY",{get:()=>(on.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Rl={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Jf={common:0,meters:1,pixels:2},d1={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},WS={multipan:[zS,{threshold:10,direction:ps.Vertical,pointers:2}],pinch:[Wz,{},null,["multipan"]],pan:[zS,{threshold:1},["pinch"],["multipan"]],dblclick:[NS,{event:"dblclick",taps:2}],click:[NS,{event:"click"},null,["dblclick"]]};function d6(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}return!1}function Fy(i){let t={},e;return n=>{for(const a in n)if(!d6(n[a],t[a])){e=i(n),t=n;break}return e}}const qS=[0,0,0,0],p6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],_M=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],m6=[0,0,0],yM=[0,0,0],g6=Fy(v6);function vM(i,t,e=yM){e.length<3&&(e=[e[0],e[1],0]);let n=e,a,f=!0;switch(t===fn.LNGLAT_OFFSETS||t===fn.METER_OFFSETS?a=e:a=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Rl.WEB_MERCATOR:(t===fn.LNGLAT||t===fn.CARTESIAN)&&(a=[0,0,0],f=!1);break;case Rl.WEB_MERCATOR_AUTO_OFFSET:t===fn.LNGLAT?n=a:t===fn.CARTESIAN&&(n=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],a=i.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case Rl.IDENTITY:n=i.position.map(Math.fround),n[2]=n[2]||0;break;case Rl.GLOBE:f=!1,a=null;break;default:f=!1}return{geospatialOrigin:a,shaderCoordinateOrigin:n,offsetMode:f}}function _6(i,t,e){const{viewMatrixUncentered:n,projectionMatrix:a}=i;let{viewMatrix:f,viewProjectionMatrix:m}=i,l=qS,w=qS,C=i.cameraPosition;const{geospatialOrigin:P,shaderCoordinateOrigin:L,offsetMode:j}=vM(i,t,e);return j&&(w=i.projectPosition(P||L),C=[C[0]-w[0],C[1]-w[1],C[2]-w[2]],w[3]=1,l=Ly([],w,m),f=n||f,m=Dp([],a,f),m=Dp([],m,p6)),{viewMatrix:f,viewProjectionMatrix:m,projectionCenter:l,originCommon:w,cameraPosCommon:C,shaderCoordinateOrigin:L,geospatialOrigin:P}}function y6({viewport:i,devicePixelRatio:t=1,modelMatrix:e=null,coordinateSystem:n=fn.DEFAULT,coordinateOrigin:a=yM,autoWrapLongitude:f=!1}){n===fn.DEFAULT&&(n=i.isGeospatial?fn.LNGLAT:fn.CARTESIAN);const m=g6({viewport:i,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:a});return m.wrapLongitude=f,m.modelMatrix=e||_M,m}function v6({viewport:i,devicePixelRatio:t,coordinateSystem:e,coordinateOrigin:n}){const{projectionCenter:a,viewProjectionMatrix:f,originCommon:m,cameraPosCommon:l,shaderCoordinateOrigin:w,geospatialOrigin:C}=_6(i,e,n),P=i.getDistanceScales(),L=[i.width*t,i.height*t],j=Ly([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,G={coordinateSystem:e,projectionMode:i.projectionMode,coordinateOrigin:w,commonOrigin:m.slice(0,3),center:a,pseudoMeters:!!i._pseudoMeters,viewportSize:L,devicePixelRatio:t,focalDistance:j,commonUnitsPerMeter:P.unitsPerMeter,commonUnitsPerWorldUnit:P.unitsPerMeter,commonUnitsPerWorldUnit2:m6,scale:i.scale,wrapLongitude:!1,viewProjectionMatrix:f,modelMatrix:_M,cameraPosition:l};if(C){const nt=i.getDistanceScales(C);switch(e){case fn.METER_OFFSETS:G.commonUnitsPerWorldUnit=nt.unitsPerMeter,G.commonUnitsPerWorldUnit2=nt.unitsPerMeter2;break;case fn.LNGLAT:case fn.LNGLAT_OFFSETS:i._pseudoMeters||(G.commonUnitsPerMeter=nt.unitsPerMeter),G.commonUnitsPerWorldUnit=nt.unitsPerDegree,G.commonUnitsPerWorldUnit2=nt.unitsPerDegree2;break;case fn.CARTESIAN:G.commonUnitsPerWorldUnit=[1,1,nt.unitsPerMeter[2]],G.commonUnitsPerWorldUnit2=[0,0,nt.unitsPerMeter2[2]];break}}return G}const b6=Object.keys(fn).map(i=>`const COORDINATE_SYSTEM_${i}: i32 = ${fn[i]};`).join(""),x6=Object.keys(Rl).map(i=>`const PROJECTION_MODE_${i}: i32 = ${Rl[i]};`).join(""),w6=Object.keys(Jf).map(i=>`const UNIT_${i.toUpperCase()}: i32 = ${Jf[i]};`).join(""),T6=`${b6}
${x6}
${w6}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,S6=`${T6}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,A6=Object.keys(fn).map(i=>`const int COORDINATE_SYSTEM_${i} = ${fn[i]};`).join(""),E6=Object.keys(Rl).map(i=>`const int PROJECTION_MODE_${i} = ${Rl[i]};`).join(""),C6=Object.keys(Jf).map(i=>`const int UNIT_${i.toUpperCase()} = ${Jf[i]};`).join(""),M6=`${A6}
${E6}
${C6}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,R6={};function P6(i=R6){return"viewport"in i?y6(i):{}}const zw={name:"project",dependencies:[sz,uM],source:S6,vs:M6,getUniforms:P6,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},I6=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,D6=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Uw={name:"project32",dependencies:[zw],source:I6,vs:D6};function k6(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function kg(i,t){const e=Ly([],t,i);return GN(e,e,1/e[3]),e}function XS(i,t){const e=i%t;return e<0?t+e:e}function p1(i,t,e){return i<t?t:i>e?e:i}function O6(i){return Math.log(i)*Math.LOG2E}const Vw=Math.log2||O6;function Fh(i,t){if(!i)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Pc=Math.PI,bM=Pc/4,Ol=Pc/180,m1=180/Pc,Vg=512,Bb=4003e4,Zv=85.051129,B6=1.5;function L6(i){return Vw(i)}function Lb(i){const[t,e]=i;Fh(Number.isFinite(t)),Fh(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*Ol,a=e*Ol,f=Vg*(n+Pc)/(2*Pc),m=Vg*(Pc+Math.log(Math.tan(bM+a*.5)))/(2*Pc);return[f,m]}function jg(i){const[t,e]=i,n=t/Vg*(2*Pc)-Pc,a=2*(Math.atan(Math.exp(e/Vg*(2*Pc)-Pc))-bM);return[n*m1,a*m1]}function F6(i){const{latitude:t}=i;Fh(Number.isFinite(t));const e=Math.cos(t*Ol);return L6(Bb*e)-9}function hx(i){const t=Math.cos(i*Ol);return Vg/Bb/t}function g1(i){const{latitude:t,longitude:e,highPrecision:n=!1}=i;Fh(Number.isFinite(t)&&Number.isFinite(e));const a=Vg,f=Math.cos(t*Ol),m=a/360,l=m/f,w=a/Bb/f,C={unitsPerMeter:[w,w,w],metersPerUnit:[1/w,1/w,1/w],unitsPerDegree:[m,l,w],degreesPerUnit:[1/m,1/l,1/w]};if(n){const P=Ol*Math.tan(t*Ol)/f,L=m*P/2,j=a/Bb*P,G=j/l*w;C.unitsPerDegree2=[0,L,j],C.unitsPerMeter2=[G,0,G]}return C}function xM(i,t){const[e,n,a]=i,[f,m,l]=t,{unitsPerMeter:w,unitsPerMeter2:C}=g1({longitude:e,latitude:n,highPrecision:!0}),P=Lb(i);P[0]+=f*(w[0]+C[0]*m),P[1]+=m*(w[1]+C[1]*m);const L=jg(P),j=(a||0)+(l||0);return Number.isFinite(a)||Number.isFinite(l)?[L[0],L[1],j]:L}function N6(i){const{height:t,pitch:e,bearing:n,altitude:a,scale:f,center:m}=i,l=k6();kb(l,l,[0,0,-a]),aM(l,l,-e*Ol),oM(l,l,n*Ol);const w=f/t;return Nw(l,l,[w,w,w]),m&&kb(l,l,AN([],m)),l}function z6(i){const{width:t,height:e,altitude:n,pitch:a=0,offset:f,center:m,scale:l,nearZMultiplier:w=1,farZMultiplier:C=1}=i;let{fovy:P=Fb(B6)}=i;n!==void 0&&(P=Fb(n));const L=P*Ol,j=a*Ol,G=wM(P);let nt=G;m&&(nt+=m[2]*l/Math.cos(j)/e);const at=L*(.5+(f?f[1]:0)/e),J=Math.sin(at)*nt/Math.sin(p1(Math.PI/2-j-at,.01,Math.PI-.01)),mt=Math.sin(j)*J+nt,Mt=nt*10,pt=Math.min(mt*C,Mt);return{fov:L,aspect:t/e,focalDistance:G,near:w,far:pt}}function Fb(i){return 2*Math.atan(.5/i)*m1}function wM(i){return .5/Math.tan(.5*i*Ol)}function TM(i,t){const[e,n,a=0]=i;return Fh(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(a)),kg(t,[e,n,a,1])}function jw(i,t,e=0){const[n,a,f]=i;if(Fh(Number.isFinite(n)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(f))return kg(t,[n,a,f,1]);const m=kg(t,[n,a,0,1]),l=kg(t,[n,a,1,1]),w=m[2],C=l[2],P=w===C?0:((e||0)-w)/(C-w);return nM([],m,l,P)}function U6(i){const{width:t,height:e,bounds:n,minExtent:a=0,maxZoom:f=24,offset:m=[0,0]}=i,[[l,w],[C,P]]=n,L=V6(i.padding),j=Lb([l,p1(P,-Zv,Zv)]),G=Lb([C,p1(w,-Zv,Zv)]),nt=[Math.max(Math.abs(G[0]-j[0]),a),Math.max(Math.abs(G[1]-j[1]),a)],at=[t-L.left-L.right-Math.abs(m[0])*2,e-L.top-L.bottom-Math.abs(m[1])*2];Fh(at[0]>0&&at[1]>0);const J=at[0]/nt[0],mt=at[1]/nt[1],Mt=(L.right-L.left)/2/J,pt=(L.top-L.bottom)/2/mt,Pt=[(G[0]+j[0])/2+Mt,(G[1]+j[1])/2+pt],kt=jg(Pt),$t=Math.min(f,Vw(Math.abs(Math.min(J,mt))));return Fh(Number.isFinite($t)),{longitude:kt[0],latitude:kt[1],zoom:$t}}function V6(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(Fh(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const ZS=Math.PI/180;function j6(i,t=0){const{width:e,height:n,unproject:a}=i,f={targetZ:t},m=a([0,n],f),l=a([e,n],f);let w,C;const P=i.fovy?.5*i.fovy*ZS:Math.atan(.5/i.altitude),L=(90-i.pitch)*ZS;return P>L-.01?(w=GS(i,0,t),C=GS(i,e,t)):(w=a([0,0],f),C=a([e,0],f)),[m,l,C,w]}function GS(i,t,e){const{pixelUnprojectionMatrix:n}=i,a=kg(n,[t,0,1,1]),f=kg(n,[t,i.height,1,1]),l=(e*i.distanceScales.unitsPerMeter[2]-a[2])/(f[2]-a[2]),w=nM([],a,f,l),C=jg(w);return C.push(e),C}const YS=512;function $6(i){const{width:t,height:e,pitch:n=0}=i;let{longitude:a,latitude:f,zoom:m,bearing:l=0}=i;(a<-180||a>180)&&(a=XS(a+180,360)-180),(l<-180||l>180)&&(l=XS(l+180,360)-180);const w=Vw(e/YS);if(m<=w)m=w,f=0;else{const C=e/2/Math.pow(2,m),P=jg([0,C])[1];if(f<P)f=P;else{const L=jg([0,YS-C])[1];f>L&&(f=L)}}return{width:t,height:e,longitude:a,latitude:f,zoom:m,pitch:n,bearing:l}}const SM=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,H6=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,W6=`
${SM}
${H6}
`,q6=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,X6=`
${SM}
${q6}
`,Z6=Fy(J6),G6=Fy(tU),Y6=[0,0,0,1],K6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Q6(i,t){const[e,n,a]=i,f=jw([e,n,a],t);return Number.isFinite(a)?f:[f[0],f[1],0]}function J6({viewport:i,center:t}){return new Eu(i.viewProjectionMatrix).invert().transform(t)}function tU({viewport:i,shadowMatrices:t}){const e=[],n=i.pixelUnprojectionMatrix,a=i.isGeospatial?void 0:1,f=[[0,0,a],[i.width,0,a],[0,i.height,a],[i.width,i.height,a],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(m=>Q6(m,n));for(const m of t){const l=m.clone().translate(new Au(i.center).negate()),w=f.map(P=>l.transform(P)),C=new Eu().ortho({left:Math.min(...w.map(P=>P[0])),right:Math.max(...w.map(P=>P[0])),bottom:Math.min(...w.map(P=>P[1])),top:Math.max(...w.map(P=>P[1])),near:Math.min(...w.map(P=>-P[2])),far:Math.max(...w.map(P=>-P[2]))});e.push(C.multiplyRight(m))}return e}function eU(i){const{shadowEnabled:t=!0,project:e}=i;if(!t||!e||!i.shadowMatrices||!i.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};const n=zw.getUniforms(e),a=Z6({viewport:e.viewport,center:n.center}),f=[],m=G6({shadowMatrices:i.shadowMatrices,viewport:e.viewport}).slice();for(let w=0;w<i.shadowMatrices.length;w++){const C=m[w],P=C.clone().translate(new Au(e.viewport.center).negate());n.coordinateSystem===fn.LNGLAT&&n.projectionMode===Rl.WEB_MERCATOR?(m[w]=P,f[w]=a):(m[w]=C.clone().multiplyRight(K6),f[w]=P.transform(a))}const l={drawShadowMap:!!i.drawToShadowMap,useShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,color:i.shadowColor||Y6,lightId:i.shadowLightId||0,lightCount:i.shadowMatrices.length,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};for(let w=0;w<m.length;w++)l[`viewProjectionMatrix${w}`]=m[w],l[`projectCenter${w}`]=f[w];for(let w=0;w<2;w++)l[`shadow_uShadowMap${w}`]=i.shadowMaps&&i.shadowMaps[w]||i.dummyShadowMap;return l}const KS={name:"shadow",dependencies:[zw],vs:W6,fs:X6,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:eU,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},$w={...RS,defaultUniforms:{...RS.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},iU=[uM],nU=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],rU=[];function sU(i){const t=Ap.getDefaultShaderAssembler();for(const n of iU)t.addDefaultModule(n);t._hookFunctions.length=0;const e=i==="glsl"?nU:rU;for(const n of e)t.addShaderHook(n);return t}const aU=[255,255,255],oU=1;let lU=0;class cU{constructor(t={}){this.type="ambient";const{color:e=aU}=t,{intensity:n=oU}=t;this.id=t.id||`ambient-${lU++}`,this.color=e,this.intensity=n}}const uU=[255,255,255],hU=1,fU=[0,0,-1];let dU=0;class QS{constructor(t={}){this.type="directional";const{color:e=uU}=t,{intensity:n=hU}=t,{direction:a=fU}=t,{_shadow:f=!1}=t;this.id=t.id||`directional-${dU++}`,this.color=e,this.intensity=n,this.type="directional",this.direction=new Au(a).normalize().toArray(),this.shadow=f}getProjectedLight(t){return this}}class pU{constructor(t,e={id:"pass"}){const{id:n}=e;this.id=n,this.device=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class Hw extends pU{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[e,n]=this.device.canvasContext.getDrawingBufferSize(),a=t.clearCanvas??!0,f=t.clearColor??(a?[0,0,0,0]:!1),m=a?1:!1,l=a?0:!1,w=t.colorMask??15,C={viewport:[0,0,e,n]};t.colorMask&&(C.colorMask=w),t.scissorRect&&(C.scissorRect=t.scissorRect);const P=this.device.beginRenderPass({framebuffer:t.target,parameters:C,clearColor:f,clearDepth:m,clearStencil:l});try{return this._drawLayers(P,t)}finally{P.end(),this.device.submit()}}_drawLayers(t,e){const{target:n,shaderModuleProps:a,viewports:f,views:m,onViewportActive:l,clearStack:w=!0}=e;e.pass=e.pass||"unknown",w&&(this._lastRenderIndex=-1);const C=[];for(const P of f){const L=m&&m[P.id];l?.(P);const j=this._getDrawLayerParams(P,e),G=P.subViewports||[P];for(const nt of G){const at=this._drawLayersInViewport(t,{target:n,shaderModuleProps:a,viewport:nt,view:L,pass:e.pass,layers:e.layers},j);C.push(at)}}return C}_getDrawLayerParams(t,{layers:e,pass:n,isPicking:a=!1,layerFilter:f,cullRect:m,effects:l,shaderModuleProps:w},C=!1){const P=[],L=AM(this._lastRenderIndex+1),j={layer:e[0],viewport:t,isPicking:a,renderPass:n,cullRect:m},G={};for(let nt=0;nt<e.length;nt++){const at=e[nt],J=this._shouldDrawLayer(at,j,f,G),mt={shouldDrawLayer:J};J&&!C&&(mt.shouldDrawLayer=!0,mt.layerRenderIndex=L(at,J),mt.shaderModuleProps=this._getShaderModuleProps(at,l,n,w),mt.layerParameters={...at.context.deck?.props.parameters,...this.getLayerParameters(at,nt,t)}),P[nt]=mt}return P}_drawLayersInViewport(t,{layers:e,shaderModuleProps:n,pass:a,target:f,viewport:m,view:l},w){const C=mU(this.device,{shaderModuleProps:n,target:f,viewport:m});if(l){const{clear:L,clearColor:j,clearDepth:G,clearStencil:nt}=l.props;if(L){let at=[0,0,0,0],J=1,mt=0;Array.isArray(j)?at=[...j.slice(0,3),j[3]||255].map(pt=>pt/255):j===!1&&(at=!1),G!==void 0&&(J=G),nt!==void 0&&(mt=nt),this.device.beginRenderPass({framebuffer:f,parameters:{viewport:C,scissorRect:C},clearColor:at,clearDepth:J,clearStencil:mt}).end()}}const P={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:C});for(let L=0;L<e.length;L++){const j=e[L],G=w[L],{shouldDrawLayer:nt}=G;if(nt&&j.props.pickable&&P.pickableCount++,j.isComposite&&P.compositeCount++,j.isDrawable&&G.shouldDrawLayer){const{layerRenderIndex:at,shaderModuleProps:J,layerParameters:mt}=G;P.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,at),J.project&&(J.project.viewport=m),j.context.renderPass=t;try{j._drawLayer({renderPass:t,shaderModuleProps:J,uniforms:{layerIndex:at},parameters:mt})}catch(Mt){j.raiseError(Mt,`drawing ${j} to ${a}`)}}}return P}shouldDrawLayer(t){return!0}getShaderModuleProps(t,e,n){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,a){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let m=t.parent;for(;m;){if(!m.props.visible||!m.filterSubLayer(e))return!1;e.layer=m,m=m.parent}if(n){const l=e.layer.id;if(l in a||(a[l]=n(e)),!a[l])return!1}return t.activateViewport(e.viewport),!0}_getShaderModuleProps(t,e,n,a){const f=this.device.canvasContext.cssToDeviceRatio(),m=t.internalState?.propsInTransition||t.props,l={layer:m,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:f,modelMatrix:m.modelMatrix,coordinateSystem:m.coordinateSystem,coordinateOrigin:m.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(e)for(const w of e)JS(l,w.getShaderModuleProps?.(t,l));return JS(l,this.getShaderModuleProps(t,e,l),a)}}function AM(i=0,t={}){const e={},n=(a,f)=>{const m=a.props._offset,l=a.id,w=a.parent&&a.parent.id;let C;if(w&&!(w in t)&&n(a.parent,!1),w in e){const P=e[w]=e[w]||AM(t[w],t);C=P(a,f),e[l]=P}else Number.isFinite(m)?(C=m+(t[w]||0),e[l]=null):C=i;return f&&C>=i&&(i=C+1),t[l]=C,C};return n}function mU(i,{shaderModuleProps:t,target:e,viewport:n}){const a=t?.project?.devicePixelRatio??i.canvasContext.cssToDeviceRatio(),[,f]=i.canvasContext.getDrawingBufferSize(),m=e?e.height:f,l=n;return[l.x*a,m-(l.y+l.height)*a,l.width*a,l.height*a]}function JS(i,...t){for(const e of t)if(e)for(const n in e)i[n]?Object.assign(i[n],e[n]):i[n]=e[n];return i}class gU extends Hw{constructor(t,e){super(t,e);const n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),a=t.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:a})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){const e=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),a=t.viewports[0],f=a.width*n,m=a.height*n,l=[1,1,1,1];(f!==e.width||m!==e.height)&&e.resize({width:f,height:m}),super.render({...t,clearColor:l,target:e,pass:"shadow"})}getLayerParameters(t,e,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,e,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const _U={color:[255,255,255],intensity:1},tA=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],yU=[0,0,0,200/255];class EM{constructor(t={}){this.id="lighting-effect",this.shadowColor=yU,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:e,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(e),n._addDefaultShaderModule(KS),this.dummyShadowMap=e.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:e,viewports:n,onViewportActive:a,views:f}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let m=0;m<this.shadowPasses.length;m++)this.shadowPasses[m].render({layers:t,layerFilter:e,viewports:n,onViewportActive:a,views:f,shaderModuleProps:{shadow:{shadowLightId:m,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,e){const n=this.shadow?{project:e.project,shadowMaps:this.shadowPasses.map(m=>m.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},a={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(m=>m.getProjectedLight({layer:t})),pointLights:this.pointLights.map(m=>m.getProjectedLight({layer:t}))},f=t.props.material;return{shadow:n,lighting:a,phongMaterial:f,gouraudMaterial:f}}cleanup(t){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(KS))}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=new Eu().lookAt({eye:new Au(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new gU(t);this.shadowPasses[e]=n}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;!t&&e.length===0&&n.length===0&&(this.ambientLight=new cU(_U),this.directionalLights.push(new QS(tA[0]),new QS(tA[1])))}}class vU{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:n=1,type:a,padding:f=0,copy:m=!1,initialize:l=!1,maxCount:w}){const C=a||t&&t.constructor||Float32Array,P=e*n+f;if(ArrayBuffer.isView(t)){if(P<=t.length)return t;if(P*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new C(t.buffer,0,P)}let L=1/0;w&&(L=w*n+f);const j=this._allocate(C,P,l,L);return t&&m?j.set(t):l||j.fill(0,0,4),this._release(t),j}release(t){this._release(t)}_allocate(t,e,n,a){let f=Math.max(Math.ceil(e*this.opts.overAlloc),1);f>a&&(f=a);const m=this._pool,l=t.BYTES_PER_ELEMENT*f,w=m.findIndex(C=>C.byteLength>=l);if(w>=0){const C=new t(m.splice(w,1)[0],0,f);return n&&C.fill(0),C}return new t(f)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:a}=n,f=e.findIndex(m=>m.byteLength>=a);f<0?e.push(n):(f>0||e.length<this.opts.poolSize)&&e.splice(f,0,n),e.length>this.opts.poolSize&&e.shift()}}const Ey=new vU;function ey(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bU(i){return[i[12],i[13],i[14]]}function xU(i){return{left:_g(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:_g(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:_g(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:_g(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:_g(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:_g(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const eA=new Au;function _g(i,t,e,n){eA.set(i,t,e);const a=eA.len();return{distance:n/a,normal:new Au(-i/a,-t/a,-e/a)}}function wU(i){return i-Math.fround(i)}let Z_;function fx(i,t){const{size:e=1,startIndex:n=0}=t,a=t.endIndex!==void 0?t.endIndex:i.length,f=(a-n)/e;Z_=Ey.allocate(Z_,f,{type:Float32Array,size:e*2});let m=n,l=0;for(;m<a;){for(let w=0;w<e;w++){const C=i[m++];Z_[l+w]=C,Z_[l+w+e]=wU(C)}l+=e*2}return Z_.subarray(0,f*e*2)}function TU(i){let t=null,e=!1;for(const n of i)n&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const SU=Math.PI/180,AU=ey(),iA=[0,0,0],EU={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function CU({width:i,height:t,orthographic:e,fovyRadians:n,focalDistance:a,padding:f,near:m,far:l}){const w=i/t,C=e?new Eu().orthographic({fovy:n,aspect:w,focalDistance:a,near:m,far:l}):new Eu().perspective({fovy:n,aspect:w,near:m,far:l});if(f){const{left:P=0,right:L=0,top:j=0,bottom:G=0}=f,nt=qf((P+i-L)/2,0,i)-i/2,at=qf((j+t-G)/2,0,t)-t/2;C[8]-=nt*2/i,C[9]+=at*2/t}return C}class Ny{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||EU,this.focalDistance=t.focalDistance||1,this.position=t.position||iA,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Rl.WEB_MERCATOR:Rl.WEB_MERCATOR_AUTO_OFFSET:Rl.IDENTITY}equals(t){return t instanceof Ny?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Ay(t.projectionMatrix,this.projectionMatrix)&&Ay(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const n=this.projectPosition(t),a=TM(n,this.pixelProjectionMatrix),[f,m]=a,l=e?m:this.height-m;return t.length===2?[f,l]:[f,l,a[2]]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[a,f,m]=t,l=e?f:this.height-f,w=n&&n*this.distanceScales.unitsPerMeter[2],C=jw([a,l,m],this.pixelUnprojectionMatrix,w),[P,L,j]=this.unprojectPosition(C);return Number.isFinite(m)?[P,L,j]:Number.isFinite(n)?[P,L,n]:[P,L]}projectPosition(t){const[e,n]=this.projectFlat(t),a=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,n,a]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t),a=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,n,a]}projectFlat(t){if(this.isGeospatial){const e=Lb(t);return e[1]=qf(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?jg(t):t}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,0],e),a=this.unproject([this.width,0],e),f=this.unproject([0,this.height],e),m=this.unproject([this.width,this.height],e);return[Math.min(n[0],a[0],f[0],m[0]),Math.min(n[1],a[1],f[1],m[1]),Math.max(n[0],a[0],f[0],m[0]),Math.max(n[1],a[1],f[1],m[1])]}getDistanceScales(t){return t&&this.isGeospatial?g1({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:n=1,height:a=1}){return t<this.x+this.width&&this.x<t+n&&e<this.y+this.height&&this.y<e+a}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,xU(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=F6({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||g1({latitude:n,longitude:e}));const a=Math.pow(2,this.zoom);this.scale=a;const{position:f,modelMatrix:m}=t;let l=iA;if(f&&(l=m?new Eu(m).transformAsVector(f,[]):f),this.isGeospatial){const w=this.projectPosition([e,n,0]);this.center=new Au(l).scale(this.distanceScales.unitsPerMeter).add(w)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:e=AU,projectionMatrix:n=null,orthographic:a=!1,fovyRadians:f,fovy:m=75,near:l=.1,far:w=1e3,padding:C=null,focalDistance:P=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new Eu().multiplyRight(e).translate(new Au(this.center).negate()),this.projectionMatrix=n||CU({width:this.width,height:this.height,orthographic:a,fovyRadians:f||m*SU,focalDistance:P,padding:C,near:l,far:w});const L=ey();Dp(L,L,this.projectionMatrix),Dp(L,L,this.viewMatrix),this.viewProjectionMatrix=L,this.viewMatrixInverse=o1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=bU(this.viewMatrixInverse);const j=ey(),G=ey();Nw(j,j,[this.width/2,-this.height/2,1]),kb(j,j,[1,-1,0]),Dp(G,j,this.viewProjectionMatrix),this.pixelProjectionMatrix=G,this.pixelUnprojectionMatrix=o1(ey(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||on.warn("Pixel project matrix not invertible")()}}Ny.displayName="Viewport";class $g extends Ny{constructor(t={}){const{latitude:e=0,longitude:n=0,zoom:a=0,pitch:f=0,bearing:m=0,nearZMultiplier:l=.1,farZMultiplier:w=1.01,nearZ:C,farZ:P,orthographic:L=!1,projectionMatrix:j,repeat:G=!1,worldOffset:nt=0,position:at,padding:J,legacyMeterSizes:mt=!1}=t;let{width:Mt,height:pt,altitude:Pt=1.5}=t;const kt=Math.pow(2,a);Mt=Mt||1,pt=pt||1;let $t,ae=null;if(j)Pt=j[5]/2,$t=Fb(Pt);else{t.fovy?($t=t.fovy,Pt=wM($t)):$t=Fb(Pt);let le;if(J){const{top:Oe=0,bottom:Be=0}=J;le=[0,qf((Oe+pt-Be)/2,0,pt)-pt/2]}ae=z6({width:Mt,height:pt,scale:kt,center:at&&[0,0,at[2]*hx(e)],offset:le,pitch:f,fovy:$t,nearZMultiplier:l,farZMultiplier:w}),Number.isFinite(C)&&(ae.near=C),Number.isFinite(P)&&(ae.far=P)}let qt=N6({height:pt,pitch:f,bearing:m,scale:kt,altitude:Pt});nt&&(qt=new Eu().translate([512*nt,0,0]).multiplyLeft(qt)),super({...t,width:Mt,height:pt,viewMatrix:qt,longitude:n,latitude:e,zoom:a,...ae,fovy:$t,focalDistance:Pt}),this.latitude=e,this.longitude=n,this.zoom=a,this.pitch=f,this.bearing=m,this.altitude=Pt,this.fovy=$t,this.orthographic=L,this._subViewports=G?[]:null,this._pseudoMeters=mt,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let a=e;a<=n;a++){const f=a?new $g({...this,worldOffset:a}):this;this._subViewports.push(f)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t),a=(t[2]||0)*hx(t[1]);return[e,n,a]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t),a=(t[2]||0)/hx(n);return[e,n,a]}addMetersToLngLat(t,e){return xM(t,e)}panByPosition(t,e){const n=jw(e,this.pixelUnprojectionMatrix),a=this.projectFlat(t),f=CS([],a,vN([],n)),m=CS([],this.center,f),[l,w]=this.unprojectFlat(m);return{longitude:l,latitude:w}}getBounds(t={}){const e=j6(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:n,height:a}=this,{longitude:f,latitude:m,zoom:l}=U6({width:n,height:a,bounds:t,...e});return new $g({width:n,height:a,longitude:f,latitude:m,zoom:l})}}$g.displayName="WebMercatorViewport";const nA=[0,0,0];function dx(i,t,e=!1){const n=t.projectPosition(i);if(e&&t instanceof $g){const[a,f,m=0]=i,l=t.getDistanceScales([a,f]);n[2]=m*l.unitsPerMeter[2]}return n}function MU(i){const{viewport:t,modelMatrix:e,coordinateOrigin:n}=i;let{coordinateSystem:a,fromCoordinateSystem:f,fromCoordinateOrigin:m}=i;return a===fn.DEFAULT&&(a=t.isGeospatial?fn.LNGLAT:fn.CARTESIAN),f===void 0&&(f=a),m===void 0&&(m=n),{viewport:t,coordinateSystem:a,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:f,fromCoordinateOrigin:m}}function CM(i,{viewport:t,modelMatrix:e,coordinateSystem:n,coordinateOrigin:a,offsetMode:f}){let[m,l,w=0]=i;switch(e&&([m,l,w]=Ly([],[m,l,w,1],e)),n){case fn.LNGLAT:return dx([m,l,w],t,f);case fn.LNGLAT_OFFSETS:return dx([m+a[0],l+a[1],w+(a[2]||0)],t,f);case fn.METER_OFFSETS:return dx(xM(a,[m,l,w]),t,f);case fn.CARTESIAN:default:return t.isGeospatial?[m+a[0],l+a[1],w+a[2]]:t.projectPosition([m,l,w])}}function RU(i,t){const{viewport:e,coordinateSystem:n,coordinateOrigin:a,modelMatrix:f,fromCoordinateSystem:m,fromCoordinateOrigin:l}=MU(t),{autoOffset:w=!0}=t,{geospatialOrigin:C=nA,shaderCoordinateOrigin:P=nA,offsetMode:L=!1}=w?vM(e,n,a):{},j=CM(i,{viewport:e,modelMatrix:f,coordinateSystem:m,coordinateOrigin:l,offsetMode:L});if(L){const G=e.projectPosition(C||P);ON(j,j,G)}return j}let PU=1,IU=1;class MM{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:a=1,repeat:f=1}=t,m=PU++,l={time:0,delay:e,duration:n,rate:a,repeat:f};return this._setChannelTime(l,this.time),this.channels.set(m,l),m}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const a of e)this._setChannelTime(a,this.time);const n=this.animations.values();for(const a of n){const{animation:f,channel:m}=a;f.setTime(this.getTime(m))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=IU++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay,a=t.duration*t.repeat;n>=a?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}function DU(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function kU(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}let OU=0;class Ww{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:n1.stats.get(`animation-loop-${OU++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...Ww.defaultAnimationLoopProps,...t},t=this.props,!t.device)throw new Error("No device provided");this.stats=t.stats||new qb({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(t){this.props.onError(t),this._error=t}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const e=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=DU(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(kU(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const t=this.device?.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const e=t?.canvas,n=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:e,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:e,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[t,e]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const a=this.device?.getDefaultCanvasContext().canvas;return a&&a.clientHeight?n=a.clientWidth/a.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}const px={};function zy(i="id"){px[i]=px[i]||1;const t=px[i]++;return`${i}-${t}`}class rA{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||zy("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&Un.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}}function BU(i,t){if(t instanceof rA)return t;const e=LU(i,t),{attributes:n,bufferLayout:a}=FU(i,t);return new rA({topology:t.topology||"triangle-list",bufferLayout:a,vertexCount:t.vertexCount,indices:e,attributes:n})}function LU(i,t){if(!t.indices)return;const e=t.indices.value;return i.createBuffer({usage:Un.INDEX,data:e})}function FU(i,t){const e=[],n={};for(const[f,m]of Object.entries(t.attributes)){let l=f;switch(f){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(m){n[l]=i.createBuffer({data:m.value,id:`${f}-buffer`});const{value:w,size:C,normalized:P}=m;e.push({name:l,format:LL(w,C,P)})}}const a=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:e,vertexCount:a}}class qw{static defaultProps={...Ip.defaultProps};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new qw(t),t._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cachePipelines,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=t.props.debugFactories}createRenderPipeline(t){if(!this.cachingEnabled)return this.device.createRenderPipeline(t);const e={...Ip.defaultProps,...t},n=this._renderPipelineCache,a=this._hashRenderPipeline(e);let f=n[a]?.pipeline;return f?(n[a].useCount++,this.debug&&Se.warn(`${this}: ${n[a].pipeline} reused, count=${n[a].useCount}, (id=${t.id})`)()):(f=this.device.createRenderPipeline({...e,id:e.id?`${e.id}-cached`:zy("unnamed-cached")}),f.hash=a,n[a]={pipeline:f,useCount:1},this.debug&&Se.warn(`${this}: ${f} created, count=${n[a].useCount}`)()),f}createComputePipeline(t){if(!this.cachingEnabled)return this.device.createComputePipeline(t);const e={...Ab.defaultProps,...t},n=this._computePipelineCache,a=this._hashComputePipeline(e);let f=n[a]?.pipeline;return f?(n[a].useCount++,this.debug&&Se.warn(`${this}: ${n[a].pipeline} reused, count=${n[a].useCount}, (id=${t.id})`)()):(f=this.device.createComputePipeline({...e,id:e.id?`${e.id}-cached`:void 0}),f.hash=a,n[a]={pipeline:f,useCount:1},this.debug&&Se.warn(`${this}: ${f} created, count=${n[a].useCount}`)()),f}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._getCache(t),n=t.hash;e[n].useCount--,e[n].useCount===0?(this._destroyPipeline(t),this.debug&&Se.warn(`${this}: ${t} released and destroyed`)()):e[n].useCount<0?(Se.error(`${this}: ${t} released, useCount < 0, resetting`)(),e[n].useCount=0):this.debug&&Se.warn(`${this}: ${t} released, count=${e[n].useCount}`)()}_destroyPipeline(t){const e=this._getCache(t);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete e[t.hash],t.destroy(),!0}}_getCache(t){let e;if(t instanceof Ab&&(e=this._computePipelineCache),t instanceof Ip&&(e=this._renderPipelineCache),!e)throw new Error(`${this}`);if(!e[t.hash])throw new Error(`${this}: ${t} matched incorrect entry`);return e}_hashComputePipeline(t){const{type:e}=this.device,n=this._getHash(t.shader.source);return`${e}/C/${n}`}_hashRenderPipeline(t){const e=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,a="-",f=this._getHash(JSON.stringify(t.bufferLayout)),{type:m}=this.device;switch(m){case"webgl":return`${m}/R/${e}/${n}V${a}BL${f}`;case"webgpu":default:const l=this._getHash(JSON.stringify(t.parameters));return`${m}/R/${e}/${n}V${a}T${t.topology}P${l}BL${f}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}}class Xw{static defaultProps={...Yb.defaultProps};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new Xw(t),t._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cacheShaders,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=!0}createShader(t){if(!this.cachingEnabled)return this.device.createShader(t);const e=this._hashShader(t);let n=this._cache[e];if(n)n.useCount++,this.debug&&Se.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const a=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[e]=n={shader:a,useCount:1},this.debug&&Se.warn(`${this}: Created new shader ${a.id}`)()}return n.shader}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._hashShader(t),n=this._cache[e];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[e],n.shader.destroy(),this.debug&&Se.warn(`${this}: Releasing shader ${t.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${t.id} released too many times`);this.debug&&Se.warn(`${this}: Releasing shader ${t.id} count=${n.useCount}`)()}}_hashShader(t){return`${t.stage}:${t.source}`}}function NU(i,t){const e={},n="Values";if(i.attributes.length===0&&!i.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const a of i.attributes)if(a){const f=`${a.location} ${a.name}: ${a.type}`;e[`in ${f}`]={[n]:a.stepMode||"vertex"}}for(const a of i.varyings||[]){const f=`${a.location} ${a.name}`;e[`out ${f}`]={[n]:JSON.stringify(a)}}return e}let Is=null,mx=null;function zU(i,{id:t,minimap:e,opaque:n,top:a="0",left:f="0",rgbaScale:m=1}){Is||(Is=document.createElement("canvas"),Is.id=t,Is.title=t,Is.style.zIndex="100",Is.style.position="absolute",Is.style.top=a,Is.style.left=f,Is.style.border="blue 5px solid",Is.style.transform="scaleY(-1)",document.body.appendChild(Is),mx=Is.getContext("2d")),(Is.width!==i.width||Is.height!==i.height)&&(Is.width=i.width/2,Is.height=i.height/2,Is.style.width="400px",Is.style.height="400px");const l=i.device.readPixelsToArrayWebGL(i),w=mx?.createImageData(i.width,i.height);if(w){for(let P=0;P<l.length;P+=4)w.data[0+P+0]=l[P+0]*m,w.data[0+P+1]=l[P+1]*m,w.data[0+P+2]=l[P+2]*m,w.data[0+P+3]=n?255:l[P+3]*m;mx?.putImageData(w,0,0)}}function _1(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!_1(i[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const n=Object.keys(i),a=Object.keys(t);if(n.length!==a.length)return!1;for(const f of n)if(!t.hasOwnProperty(f)||!_1(i[f],t[f],e-1))return!1;return!0}return!1}class gx{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(e=>e.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(e=>e.attribute):[t.name]}mergeBufferLayouts(t,e){const n=[...t];for(const a of e){const f=n.findIndex(m=>m.name===a.name);f<0?n.push(a):n[f]=a}return n}getBufferIndex(t){const e=this.bufferLayouts.findIndex(n=>n.name===t);return e===-1&&Se.warn(`BufferLayout: Missing buffer for "${t}".`)(),e}}function UU(i,t){const e=Object.fromEntries(i.attributes.map(a=>[a.name,a.location])),n=t.slice();return n.sort((a,f)=>{const m=a.attributes?a.attributes.map(P=>P.attribute):[a.name],l=f.attributes?f.attributes.map(P=>P.attribute):[f.name],w=Math.min(...m.map(P=>e[P])),C=Math.min(...l.map(P=>e[P]));return w-C}),n}function VU(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function jU(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function $U(i){return VU(i)||jU(i)}function HU(i){return $U(i)||typeof i=="number"||typeof i=="boolean"}function WU(i){const t={bindings:{},uniforms:{}};return Object.keys(i).forEach(e=>{const n=i[e];HU(n)?t.uniforms[e]=n:t.bindings[e]=n}),t}class qU{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,e){Object.assign(this.options,e);const n=vw(Object.values(t).filter(a=>a.dependencies));for(const a of n)t[a.name]=a;Se.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[a,f]of Object.entries(t))this._addModule(f),f.name&&a!==f.name&&!this.options.disableWarnings&&Se.warn(`Module name: ${a} vs ${f.name}`)()}destroy(){}setProps(t){for(const e of Object.keys(t)){const n=e,a=t[n]||{},f=this.modules[n];if(!f){this.options.disableWarnings||Se.warn(`Module ${e} not found`)();continue}const m=this.moduleUniforms[n],l=this.moduleBindings[n],w=f.getUniforms?.(a,m)||a,{uniforms:C,bindings:P}=WU(w);this.moduleUniforms[n]={...m,...C},this.moduleBindings[n]={...l,...P}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const t={};for(const e of Object.values(this.moduleBindings))Object.assign(t,e);return t}getDebugTable(){const t={};for(const[e,n]of Object.entries(this.moduleUniforms))for(const[a,f]of Object.entries(n))t[`${e}.${a}`]={type:this.modules[e].uniformTypes?.[a],value:String(f)};return t}_addModule(t){const e=t.name;this.moduleUniforms[e]=t.defaultUniforms||{},this.moduleBindings[e]={}}}let XU="";async function ZU(i,t){const e=new Image;return e.crossOrigin="anonymous",e.src=i.startsWith("http")?i:XU+i,await e.decode(),t?await createImageBitmap(e,t):await createImageBitmap(e)}const GU=["+X","-X","+Y","-Y","+Z","-Z"],YU=["+X","-X","+Y","-Y","+Z","-Z"];class dy{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,e){this.device=t;const n=zy("async-texture");this.props={...dy.defaultProps,id:n,...e},this.id=this.props.id,e={...e},typeof e?.data=="string"&&e.dimension==="2d"&&(e.data=ZU(e.data)),e.mipmaps&&(e.mipLevels="auto"),this.ready=new Promise((a,f)=>{this.resolveReady=()=>{this.isReady=!0,a()},this.rejectReady=f}),this.initAsync(e)}async initAsync(t){const e=t.data,n=await RM(e).then(void 0,this.rejectReady);if(this.destroyed)return;const a=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!a)throw new Error("Texture size could not be determined");const f={...a,...t,data:void 0,mipLevels:1},m=this.device.getMipLevelCount(f.width,f.height);if(f.mipLevels=this.props.mipLevels==="auto"?m:Math.min(m,this.props.mipLevels),this.texture=this.device.createTexture(f),this.sampler=this.texture.sampler,this.view=this.texture.view,t.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),Se.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(t={}){this.texture.setSampler(t instanceof Lp?t:this.device.createSampler(t))}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){const e=this.texture;this.texture=e.clone(t),e.destroy()}return!0}isTextureLevelData(t){const e=t?.data;return ArrayBuffer.isView(e)}getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return this.getTextureDataSize(t[0]);if(this.device.isExternalImage(t))return this.device.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const n=Object.values(t)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}setTextureData(t){}_setTexture1DData(t,e){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(t,e=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(t);n.length>1&&this.props.mipmaps!==!1&&Se.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let a=0;a<n.length;a++){const f=n[a];this.device.isExternalImage(f)?this.texture.copyExternalImage({image:f,depth:e,mipLevel:a,flipY:!0}):this.texture.copyImageData({data:f.data,mipLevel:a})}}_setTexture3DData(t,e){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<e.length;n++)this._setTexture2DData(e[n],n)}_setTextureCubeData(t,e){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[n,a]of Object.entries(e)){const f=YU.indexOf(n);this._setTexture2DData(a,f)}}_setTextureArrayData(t,e){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<e.length;n++)this._setTexture2DData(e[n],n)}_setTextureCubeArrayData(t,e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(t,e,n,a=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Se.warn(`${this.id} has mipmap and multiple LODs.`)();const f=GU.indexOf(n);this._setTexture2DData(e,f)}_normalizeTextureData(t){const e=this.texture;let n;return ArrayBuffer.isView(t)?n=[{data:t,width:e.width,height:e.height}]:Array.isArray(t)?n=t:n=[t],n}static defaultProps={...ms.defaultProps,data:null,mipmaps:!1}}async function RM(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(RM));if(i&&typeof i=="object"&&i.constructor===Object){const t=i,e=await Promise.all(Object.values(t)),n=Object.keys(t),a={};for(let f=0;f<n.length;f++)a[n[f]]=e[f];return a}return i}const yp=2,KU=1e4;class zp{static defaultProps={...Ip.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Ap.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,e){this.props={...zp.defaultProps,...e},e=this.props,this.id=e.id||zy("model"),this.device=t,Object.assign(this.userData,e.userData);const n=Object.fromEntries(this.props.modules?.map(w=>[w.name,w])||[]),a=e.shaderInputs||new qU(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(a);const f=JU(t),m=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:w,getUniforms:C}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:f,...this.props,modules:m});this.source=w,this._getModuleUniforms=C,this.props.shaderLayout||=cN(this.source)}else{const{vs:w,fs:C,getUniforms:P}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:f,...this.props,modules:m});this.vs=w,this.fs=C,this._getModuleUniforms=P}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,e.geometry&&this.setGeometry(e.geometry),this.pipelineFactory=e.pipelineFactory||qw.getDefaultPipelineFactory(this.device),this.shaderFactory=e.shaderFactory||Xw.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in e&&(this.isInstanced=e.isInstanced),e.instanceCount&&this.setInstanceCount(e.instanceCount),e.vertexCount&&this.setVertexCount(e.vertexCount),e.indexBuffer&&this.setIndexBuffer(e.indexBuffer),e.attributes&&this.setAttributes(e.attributes),e.constantAttributes&&this.setConstantAttributes(e.constantAttributes),e.bindings&&this.setBindings(e.bindings),e.transformFeedback&&(this.transformFeedback=e.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){const e=this._areBindingsLoading();if(e)return Se.info(yp,`>>> DRAWING ABORTED ${this.id}: ${e} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const a=this._getBindings();this.pipeline.setBindings(a,{disableWarnings:this.props.disableWarnings});const{indexBuffer:f}=this.vertexArray,m=f?f.byteLength/(f.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:m,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){this._gpuGeometry?.destroy();const e=t&&BU(this.device,t);if(e){this.setTopology(e.topology||"triangle-list");const n=new gx(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(e.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(e)}this._gpuGeometry=e}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){const e=new gx(this.bufferLayout);this.bufferLayout=this._gpuGeometry?e.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){_1(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new kF(this.shaderInputs.modules);for(const[e,n]of Object.entries(this.shaderInputs.modules))if(QU(n)){const a=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=a}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,e){const n=e?.disableWarnings??this.props.disableWarnings;t.indices&&Se.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=UU(this.pipeline.shaderLayout,this.bufferLayout);const a=new gx(this.bufferLayout);for(const[f,m]of Object.entries(t)){const l=a.getBufferLayout(f);if(!l){n||Se.warn(`Model(${this.id}): Missing layout for buffer "${f}".`)();continue}const w=a.getAttributeNamesForBuffer(l);let C=!1;for(const P of w){const L=this._attributeInfos[P];if(L){const j=this.device.type==="webgpu"?a.getBufferIndex(L.bufferName):L.location;this.vertexArray.setBuffer(j,m),C=!0}}!C&&!n&&Se.warn(`Model(${this.id}): Ignoring buffer "${m.id}" for unknown attribute "${f}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,e){for(const[n,a]of Object.entries(t)){const f=this._attributeInfos[n];f?this.vertexArray.setConstantWebGL(f.location,a):(e?.disableWarnings??this.props.disableWarnings)||Se.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const t of Object.values(this.bindings))if(t instanceof dy&&!t.isReady)return t.id;return!1}_getBindings(){const t={};for(const[e,n]of Object.entries(this.bindings))n instanceof dy?n.isReady&&(t[e]=n.texture):t[e]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(const e of Object.values(this.bindings))e instanceof Gb?t=Math.max(t,e.texture.updateTimestamp):e instanceof Un||e instanceof ms?t=Math.max(t,e.updateTimestamp):e instanceof dy?t=e.texture?Math.max(t,e.texture.updateTimestamp):1/0:e instanceof Lp||(t=Math.max(t,e.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const e={...t.attributes};for(const[n]of Object.entries(e))!this.pipeline.shaderLayout.attributes.find(a=>a.name===n)&&n!=="positions"&&delete e[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(e,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,e=null;this.pipeline&&(Se.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,e=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let a=null;this.source?a=n:this.fs&&(a=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:a}),this._attributeInfos=kC(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),e&&this.shaderFactory.release(e)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const t=Se.level>3?0:KU;Se.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,Se.group(yp,`>>> DRAWING MODEL ${this.id}`,{collapsed:Se.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=NU(this.pipeline.shaderLayout,this.id);Se.table(yp,t)();const e=this.shaderInputs.getDebugTable();Se.table(yp,e)();const n=this._getAttributeDebugTable();Se.table(yp,this._attributeInfos)(),Se.table(yp,n)(),Se.groupEnd(yp)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){const e=this.device.props.debugFramebuffers;if(this._drawCount++,!e)return;const n=t.props.framebuffer;n&&zU(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[e,n]of Object.entries(this._attributeInfos)){const a=this.vertexArray.attributes[n.location];t[n.location]={name:e,type:n.shaderType,values:a?this._getBufferOrConstantValues(a,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:e}=this.vertexArray,n=e.indexType==="uint32"?new Uint32Array(e.debugData):new Uint16Array(e.debugData);t.indices={name:"indices",type:e.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,e){const n=xw(e);return(t instanceof Un?new n(t.debugData):t).toString()}}function QU(i){return!!(i.uniformTypes&&!t5(i.uniformTypes))}function JU(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function t5(i){for(const t in i)return!1;return!0}class Hg{device;model;transformFeedback;static defaultProps={...zp.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,e=Hg.defaultProps){if(!Hg.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new zp(this.device,{id:e.id||"buffer-transform-model",fs:e.fs||ML(),topology:e.topology||"point-list",varyings:e.outputs||e.varyings,...e}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:e.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const e=this.device.beginRenderPass(t);this.model.draw(e),e.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const e=this.getBuffer(t);if(!e)throw new Error("BufferTransform#getBuffer");if(e instanceof Un)return e.readAsync();const{buffer:n,byteOffset:a=0,byteLength:f=n.byteLength}=e;return n.readAsync(a,f)}}class Zw{id;topology;vertexCount;indices;attributes;userData={};constructor(t){const{attributes:e={},indices:n=null,vertexCount:a=null}=t;this.id=t.id||zy("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[f,m]of Object.entries(e)){const l=ArrayBuffer.isView(m)?{value:m}:m;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(f)}: must be typed array or object with value as typed array`);if((f==="POSITION"||f==="positions")&&!l.size&&(l.size=3),f==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[f]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,e){return this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const a of Object.values(t)){const{value:f,size:m,constant:l}=a;!l&&f&&m!==void 0&&m>=1&&(n=Math.min(n,f.length/m))}return n}}const e5={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class PM extends Hw{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:n,viewports:a,onViewportActive:f,pickingFBO:m,deviceRect:{x:l,y:w,width:C,height:P},cullRect:L,effects:j,pass:G="picking",pickZ:nt,shaderModuleProps:at}){this.pickZ=nt;const J=this._resetColorEncoder(nt),mt=[l,w,C,P],Mt=super.render({target:m,layers:t,layerFilter:e,views:n,viewports:a,onViewportActive:f,cullRect:L,effects:j?.filter(Pt=>Pt.useInPicking),pass:G,isPicking:!0,shaderModuleProps:at,clearColor:[0,0,0,0],colorMask:15,scissorRect:mt});return this._colorEncoderState=null,{decodePickingColor:J&&n5.bind(null,J),stats:Mt}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,e,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,e,n){const a={...t.props.parameters},{pickable:f,operation:m}=t.props;return!this._colorEncoderState||m.includes("terrain")?a.blend=!1:f&&m.includes("draw")&&(Object.assign(a,e5),a.blend=!0,a.blendColor=i5(this._colorEncoderState,t,n)),a}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function i5(i,t,e){const{byLayer:n,byAlpha:a}=i;let f,m=n.get(t);return m?(m.viewports.push(e),f=m.a):(f=n.size+1,f<=255?(m={a:f,layer:t,viewports:[e]},n.set(t,m),a[f]=m):(on.warn("Too many pickable layers, only picking the first 255")(),f=0)),[0,0,0,f/255]}function n5(i,t){const e=i.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const bg={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Nb=Symbol.for("component"),Gf=Symbol.for("propTypes"),_x=Symbol.for("deprecatedProps"),Og=Symbol.for("asyncPropDefaults"),Up=Symbol.for("asyncPropOriginal"),Xf=Symbol.for("asyncPropResolved");function Gw(i,t=()=>!0){return Array.isArray(i)?IM(i,t,[]):t(i)?[i]:[]}function IM(i,t,e){let n=-1;for(;++n<i.length;){const a=i[n];Array.isArray(a)?IM(a,t,e):t(a)&&e.push(a)}return e}function r5({target:i,source:t,start:e=0,count:n=1}){const a=t.length,f=n*a;let m=0;for(let l=e;m<a;m++)i[l++]=t[m];for(;m<f;)m<f-m?(i.copyWithin(e+m,e,e+m),m*=2):(i.copyWithin(e+m,e,e+f-m),m=f);return i}class s5{constructor(t,e,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let a=t;typeof t=="string"&&(a=xb(t)),a instanceof Promise?(this.isLoaded=!1,this._loader=a.then(f=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=f)}).catch(f=>{this._loadCount===n&&(this.isLoaded=!0,this._error=f||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const f of this._subscribers)f.onChange(this.getData())}}class a5{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:n=!1,persistent:a=!0}){let f=this._resources[t];f?f.setData(e,n):(f=new s5(t,e,this._context),this._resources[t]=f),f.persistent=a}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const n in e){const a=e[n],f=this._resources[a.resourceId];f&&f.unsubscribe(a)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:n,requestId:a="default"}){const{_resources:f,protocol:m}=this;t.startsWith(m)&&(t=t.replace(m,""),f[t]||this.add({resourceId:t,data:null,persistent:!1}));const l=f[t];if(this._track(n,a,l,e),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,a){const f=this._consumers,m=f[t]=f[t]||{};let l=m[e];const w=l&&l.resourceId&&this._resources[l.resourceId];w&&(w.unsubscribe(l),this.prune()),n&&(l?(l.onChange=a,l.resourceId=n.id):l={onChange:a,resourceId:n.id},m[e]=l,n.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const o5="layerManager.setLayers",l5="layerManager.activateViewport";class c5{constructor(t,e){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{na(l5,this,l),l&&(this.context.viewport=l)};const{deck:n,stats:a,viewport:f,timeline:m}=e||{};this.layers=[],this.resourceManager=new a5({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:sU(t?.info?.shadingLanguage||"glsl"),defaultShaderModules:[dz],renderPass:void 0,stats:a||new qb({id:"deck.gl"}),viewport:f||new Ny({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:m||new MM,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const a=n.getNeedsRedraw(t);e=e||a}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(n=>e.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){na(o5,this,e,t),this._lastRenderedLayers=t;const n=Gw(t,Boolean);for(const a of n)a.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:e}=this.context;e.find(n=>n.name===t.name)||(e.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:e}=this.context,n=e.findIndex(a=>a.name===t.name);n>=0&&(e.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,e,n){n.raiseError(e,`${t} of ${n}`)}_updateLayers(t,e){const n={};for(const m of t)n[m.id]?on.warn(`Multiple old layers with same id ${m.id}`)():n[m.id]=m;if(this._defaultShaderModulesChanged){for(const m of t)m.setNeedsUpdate(),m.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const a=[];this._updateSublayersRecursively(e,n,a),this._finalizeOldLayers(n);let f=!1;for(const m of a)if(m.hasUniformTransition()){f=`Uniform transition in ${m}`;break}this._needsUpdate=f,this.layers=a}_updateSublayersRecursively(t,e,n){for(const a of t){a.context=this.context;const f=e[a.id];f===null&&on.warn(`Multiple new layers with same id ${a.id}`)(),e[a.id]=null;let m=null;try{this._debug&&f!==a&&a.validateProps(),f?(this._transferLayerState(f,a),this._updateLayer(a)):this._initializeLayer(a),n.push(a),m=a.isComposite?a.getSubLayers():null}catch(l){this._handleError("matching",l,a)}m&&this._updateSublayersRecursively(m,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=bg.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=bg.MATCHED,e!==t&&(t.lifecycle=bg.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=bg.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=bg.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Pl(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!Pl(i[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const n=Object.keys(i),a=Object.keys(t);if(n.length!==a.length)return!1;for(const f of n)if(!t.hasOwnProperty(f)||!Pl(i[f],t[f],e-1))return!1;return!0}return!1}class u5{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),a={x:t[0],y:t[1]};for(let f=n.length-1;f>=0;--f){const m=n[f];if(m.containsPixel(a)){const l=t.slice();return l[0]-=m.x,l[1]-=m.y,m.unproject(l,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Gw(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Pl(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):on.warn("missing `viewState` or `initialViewState`")()}_createController(t,e){const n=e.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:f=>this.getView(t.id)?.makeViewport({viewState:f,width:this.width,height:this.height})})}_updateController(t,e,n,a){const f=t.controller;if(f&&n){const m={...e,...f,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!a||a.constructor!==f.type)&&(a=this._createController(t,m)),a&&a.setProps(m),a}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let a=t.length;a--;){const f=t[a],m=this.getViewState(f),l=f.makeViewport({viewState:m,width:this.width,height:this.height});let w=e[f.id];const C=!!f.controller;C&&!w&&(n=!0),(n||!C)&&w&&(w.finalize(),w=null),this.controllers[f.id]=this._updateController(f,m,l,w),l&&this._viewports.unshift(l)}for(const a in e){const f=e[a];f&&!this.controllers[a]&&f.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((n,a)=>!t[a].equals(e[a]))}}const h5=/([0-9]+\.?[0-9]*)(%|px)/;function Nf(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const t=h5.exec(i);if(t&&t.length>=3){const e=t[2]==="%",n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${i}`)}}function zf(i,t){return i.relative?Math.round(i.position*t):i.position}class Wg{constructor(t){const{id:e,x:n=0,y:a=0,width:f="100%",height:m="100%",padding:l=null}=t;this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Nf(n),this._y=Nf(a),this._width=Nf(f),this._height=Nf(m),this._padding=l&&{left:Nf(l.left||0),right:Nf(l.right||0),top:Nf(l.top||0),bottom:Nf(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&Pl(this.props,t.props,2)}clone(t){const e=this.constructor;return new e({...this.props,...t})}makeViewport({width:t,height:e,viewState:n}){n=this.filterViewState(n);const a=this.getDimensions({width:t,height:e});if(!a.height||!a.width)return null;const f=this.getViewportType(n);return new f({...n,...this.props,...a})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const n in this.props.viewState)n!=="id"&&(e[n]=this.props.viewState[n]);return e}return t}getDimensions({width:t,height:e}){const n={x:zf(this._x,t),y:zf(this._y,e),width:zf(this._width,t),height:zf(this._height,e)};return this._padding&&(n.padding={left:zf(this._padding.left,t),top:zf(this._padding.top,e),right:zf(this._padding.right,t),bottom:zf(this._padding.bottom,e)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Jb{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const sA=()=>{},y1={BREAK:1,SNAP_TO_END:2,IGNORE:3},f5=i=>i,d5=y1.BREAK;class p5{constructor(t){this._onTransitionUpdate=e=>{const{time:n,settings:{interpolator:a,startProps:f,endProps:m,duration:l,easing:w}}=e,C=w(n/l),P=a.interpolateProps(f,m,C);this.propsInTransition=this.getControllerState({...this.props,...P}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Jb(t.timeline),this.onViewStateChange=t.onViewStateChange||sA,this.onStateChange=t.onStateChange||sA}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let a=n;if(this.transition.inProgress){const{interruption:f,endProps:m}=this.transition.settings;a={...n,...f===y1.SNAP_TO_END?m:this.propsInTransition||n}}this._triggerTransition(a,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||e==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===y1.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const n=this.getControllerState(t),a=this.getControllerState(e).shortestPathFrom(n),f=e.transitionInterpolator,m=f.getDuration?f.getDuration(t,e):e.transitionDuration;if(m===0)return;const l=f.initializeProps(t,a);this.propsInTransition={};const w={duration:m,easing:e.transitionEasing||f5,interpolator:f,interruption:e.transitionInterruption||d5,startProps:l.start,endProps:l.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(w),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(e)}}}function ra(i,t){if(!i)throw new Error(t||"deck.gl: assertion failed.")}class m5{constructor(t){const{compare:e,extract:n,required:a}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=a}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!Ay(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},a={};for(const f of this._propsToExtract)(f in t||f in e)&&(n[f]=t[f],a[f]=e[f]);return this._checkRequiredProps(n),this._checkRequiredProps(a),{start:n,end:a}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const n=t[e];ra(Number.isFinite(n)||Array.isArray(n),`${e} is required for transition`)})}}const g5=["longitude","latitude","zoom","bearing","pitch"],_5=["longitude","latitude","zoom"];class DM extends m5{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:g5,required:_5},super(n.transitionProps),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:a,around:f}=this.opts;if(a&&f){const m=a(t),l=a(e),w=m.unproject(f);n.start.around=f,Object.assign(n.end,{around:l.project(w),aroundPosition:w,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const a={};for(const f of this._propsToExtract)a[f]=Db(t[f]||0,e[f]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const f=this.opts.makeViewport({...e,...a});Object.assign(a,f.panByPosition(e.aroundPosition,Db(t.around,e.around,n)))}return a}}const Ph={transitionDuration:0},y5=300,Gv=i=>1-(1-i)*(1-i),yg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},vp={};class v5{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new p5({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return e?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:a}=t;return[a.x-e,a.y-n]}isPointInBounds(t,e){const{width:n,height:a}=this.props;if(e&&e.handled)return!1;const f=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=a;return f&&e&&e.stopPropagation(),f}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?y5:0;const{scrollZoom:n=!0,dragPan:a=!0,dragRotate:f=!0,doubleClickZoom:m=!0,touchZoom:l=!0,touchRotate:w=!1,keyboard:C=!0}=t,P=!!this.onViewStateChange;this.toggleEvents(yg.WHEEL,P&&n),this.toggleEvents(yg.PAN,P),this.toggleEvents(yg.PINCH,P&&(l||w)),this.toggleEvents(yg.MULTI_PAN,P&&w),this.toggleEvents(yg.DOUBLE_CLICK,P&&m),this.toggleEvents(yg.KEYBOARD,P&&C),this.scrollZoom=n,this.dragPan=a,this.dragRotate=f,this.doubleClickZoom=m,this.touchZoom=l,this.touchRotate=w,this.keyboard=C}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(n=>{this._events[n]!==e&&(this._events[n]=e,e?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,e=null,n={}){const a={...t.getViewportProps(),...e},f=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),f){const m=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:m,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const a=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(a,Ph,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,Ph,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),a=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],f=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(f,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Gv},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,Ph,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),a=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],f=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(f,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Gv},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:a=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:f}=t;let m=2/(1+Math.exp(-Math.abs(f*n)));f<0&&m!==0&&(m=1/m);const l=a?{...this._getTransitionProps({around:e}),transitionDuration:250}:Ph,w=this.controllerState.zoom({pos:e,scale:m});return this.updateViewport(w,l,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,Ph,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,Ph,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),a=[n[0],n[1]+=t.velocityY*e/2],f=this.controllerState.rotate({pos:a});this.updateViewport(f,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Gv},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return vp._startPinchRotation=t.rotation,vp._lastPinchEvent=t,this.updateViewport(n,Ph,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,a=this.getCenter(t);e=e.zoom({pos:a,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:vp._startPinchRotation-n})}return this.updateViewport(e,Ph,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),vp._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=vp;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const a=this.getCenter(t);let f=this.controllerState.rotateEnd();const m=Math.log2(t.scale),l=(m-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),w=Math.pow(2,m+l*e/2);f=f.zoom({pos:a,scale:w}).zoomEnd(),this.updateViewport(f,{...this._getTransitionProps({around:a}),transitionDuration:e,transitionEasing:Gv},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const a=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(a,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return vp._startPinchRotation=null,vp._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),a=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(a,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:a,rotateSpeedX:f,rotateSpeedY:m}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let w;const C={};switch(t.srcEvent.code){case"Minus":w=e?l.zoomOut(n).zoomOut(n):l.zoomOut(n),C.isZooming=!0;break;case"Equal":w=e?l.zoomIn(n).zoomIn(n):l.zoomIn(n),C.isZooming=!0;break;case"ArrowLeft":e?(w=l.rotateLeft(f),C.isRotating=!0):(w=l.moveLeft(a),C.isPanning=!0);break;case"ArrowRight":e?(w=l.rotateRight(f),C.isRotating=!0):(w=l.moveRight(a),C.isPanning=!0);break;case"ArrowUp":e?(w=l.rotateUp(m),C.isRotating=!0):(w=l.moveUp(a),C.isPanning=!0);break;case"ArrowDown":e?(w=l.rotateDown(m),C.isRotating=!0):(w=l.moveDown(a),C.isPanning=!0);break;default:return!1}return this.updateViewport(w,this._getTransitionProps(),C),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?Ph:t?{...e,transitionInterpolator:new DM({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class b5{constructor(t,e){this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const aA=5,x5=1.2;class w5 extends b5{constructor(t){const{width:e,height:n,latitude:a,longitude:f,zoom:m,bearing:l=0,pitch:w=0,altitude:C=1.5,position:P=[0,0,0],maxZoom:L=20,minZoom:j=0,maxPitch:G=60,minPitch:nt=0,startPanLngLat:at,startZoomLngLat:J,startRotatePos:mt,startBearing:Mt,startPitch:pt,startZoom:Pt,normalize:kt=!0}=t;ra(Number.isFinite(f)),ra(Number.isFinite(a)),ra(Number.isFinite(m)),super({width:e,height:n,latitude:a,longitude:f,zoom:m,bearing:l,pitch:w,altitude:C,maxZoom:L,minZoom:j,maxPitch:G,minPitch:nt,normalize:kt,position:P},{startPanLngLat:at,startZoomLngLat:J,startRotatePos:mt,startBearing:Mt,startPitch:pt,startZoom:Pt}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const n=this.getState().startPanLngLat||this._unproject(e);if(!n)return this;const f=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(f)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:n=0}){const{startRotatePos:a,startBearing:f,startPitch:m}=this.getState();if(!a||f===void 0||m===void 0)return this;let l;return t?l=this._getNewRotation(t,a,m,f):l={bearing:f+e,pitch:m+n},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:n}){let{startZoom:a,startZoomLngLat:f}=this.getState();if(f||(a=this.getViewportProps().zoom,f=this._unproject(e)||this._unproject(t)),!f)return this;const{maxZoom:m,minZoom:l}=this.getViewportProps();let w=a+Math.log2(n);w=qf(w,l,m);const C=this.makeViewport({...this.getViewportProps(),zoom:w});return this._getUpdatedState({zoom:w,...C.panByPosition(f,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:a,longitude:f}=n;return Math.abs(a-e.bearing)>180&&(n.bearing=a<0?a+360:a-360),Math.abs(f-e.longitude)>180&&(n.longitude=f<0?f+360:f-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:a}=t;t.zoom=qf(a,n,e);const{maxPitch:f,minPitch:m,pitch:l}=t;t.pitch=qf(l,m,f);const{normalize:w=!0}=t;return w&&Object.assign(t,$6(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,a){const f=t[0]-e[0],m=t[1]-e[1],l=t[1],w=e[1],{width:C,height:P}=this.getViewportProps(),L=f/C;let j=0;m>0?Math.abs(P-w)>aA&&(j=m/(w-P)*x5):m<0&&w>aA&&(j=1-l/w),j=qf(j,-1,1);const{minPitch:G,maxPitch:nt}=this.getViewportProps(),at=a+180*L;let J=n;return j>0?J=n+j*(nt-n):j<0&&(J=n-j*(G-n)),{pitch:J,bearing:at}}}class T5 extends v5{constructor(){super(...arguments),this.ControllerState=w5,this.transition={transitionDuration:300,transitionInterpolator:new DM({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class kM extends Wg{constructor(t={}){super(t)}getViewportType(){return $g}get ControllerType(){return T5}}kM.displayName="MapView";const S5=new EM;function A5(i,t){const e=i.order??1/0,n=t.order??1/0;return e-n}class E5{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(n=>n.id===t.id)){const n=e.findIndex(a=>A5(a,t)>0);n<0?e.push(t):e.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Pl(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const a of this.effects)e[a.id]=a;const n=[];for(const a of t){const f=e[a.id];let m=a;f&&f!==a?f.setProps?(f.setProps(a.props),m=f):f.cleanup(this._context):f||a.setup(this._context),n.push(m),delete e[a.id]}for(const a in e)e[a].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(a=>a instanceof EM)||this._resolvedEffects.push(S5),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class C5 extends Hw{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const M5="deckRenderer.renderLayers";class R5{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new C5(t),this.pickLayersPass=new PM(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);const a=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const f=e.render({...n,target:a});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=t.clearCanvas===void 0?!0:t.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,na(M5,this,f,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,e=this.device.canvasContext.getDrawingBufferSize(),[n,a]=e;t.length===0&&[0,1].map(f=>{const m=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:a});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${f}`,colorAttachments:[m]}))});for(const f of t)f.resize(e)}_postRender(t,e){const{renderBuffers:n}=this,a={...e,inputBuffer:n[0],swapBuffer:n[1]};for(const f of t)if(f.postRender){a.target=f.id===this.lastPostProcessEffect?e.target:void 0;const m=f.postRender(a);a.inputBuffer=m,a.swapBuffer=m===n[0]?n[1]:n[0]}}}const P5={pickedColor:null,pickedObjectIndex:-1};function oA({pickedColors:i,decodePickingColor:t,deviceX:e,deviceY:n,deviceRadius:a,deviceRect:f}){const{x:m,y:l,width:w,height:C}=f;let P=a*a,L=-1,j=0;for(let G=0;G<C;G++){const nt=G+l-n,at=nt*nt;if(at>P)j+=4*w;else for(let J=0;J<w;J++){if(i[j+3]-1>=0){const Mt=J+m-e,pt=Mt*Mt+at;pt<=P&&(P=pt,L=j)}j+=4}}if(L>=0){const G=i.slice(L,L+4),nt=t(G);if(nt){const at=Math.floor(L/4/w),J=L/4-at*w;return{...nt,pickedColor:G,pickedX:m+J,pickedY:l+at}}on.error("Picked non-existent layer. Is picking buffer corrupt?")()}return P5}function lA({pickedColors:i,decodePickingColor:t}){const e=new Map;if(i){for(let n=0;n<i.length;n+=4)if(i[n+3]-1>=0){const f=i.slice(n,n+4),m=f.join(",");if(!e.has(m)){const l=t(f);l?e.set(m,{...l,color:f}):on.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function v1({pickInfo:i,viewports:t,pixelRatio:e,x:n,y:a,z:f}){let m=t[0];t.length>1&&(m=I5(i?.pickedViewports||t,{x:n,y:a}));let l;if(m){const w=[n-m.x,a-m.y];f!==void 0&&(w[2]=f),l=m.unproject(w)}return{color:null,layer:null,viewport:m,index:-1,picked:!1,x:n,y:a,pixel:[n,a],coordinate:l,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:e}}function cA(i){const{pickInfo:t,lastPickedInfo:e,mode:n,layers:a}=i,{pickedColor:f,pickedLayer:m,pickedObjectIndex:l}=t,w=m?[m]:[];if(n==="hover"){const L=e.index,j=e.layerId,G=m?m.props.id:null;if(G!==j||l!==L){if(G!==j){const nt=a.find(at=>at.props.id===j);nt&&w.unshift(nt)}e.layerId=G,e.index=l,e.info=null}}const C=v1(i),P=new Map;return P.set(null,C),w.forEach(L=>{let j={...C};L===m&&(j.color=f,j.index=l,j.picked=!0),j=b1({layer:L,info:j,mode:n});const G=j.layer;L===m&&n==="hover"&&(e.info=j),P.set(G.id,j),n==="hover"&&G.updateAutoHighlight(j)}),P}function b1({layer:i,info:t,mode:e}){for(;i&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=i,t=i.getPickingInfo({info:t,mode:e,sourceLayer:n}),i=i.parent}return t}function I5(i,t){for(let e=i.length-1;e>=0;e--){const n=i[e];if(n.containsPixel(t))return n}return i[0]}class D5{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new PM(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(t){return this._pickClosestObjectAsync(t)}pickObjectsAsync(t){return this._pickVisibleObjectsAsync(t)}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:n,viewports:a},f=this.lastPickedInfo.info){const m=f&&f.layer&&f.layer.id,l=f&&f.viewport&&f.viewport.id,w=m?n.find(j=>j.id===m):null,C=l&&a.find(j=>j.id===l)||a[0],P=C&&C.unproject([t-C.x,e-C.y]);return{...f,...{x:t,y:e,viewport:C,coordinate:P,layer:w}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return e.length?e:null}async _pickClosestObjectAsync({layers:t,views:e,viewports:n,x:a,y:f,radius:m=0,depth:l=1,mode:w="query",unproject3D:C,onViewportActive:P,effects:L}){const j=this.device.canvasContext.cssToDeviceRatio(),G=this._getPickable(t);if(!G||n.length===0)return{result:[],emptyInfo:v1({viewports:n,x:a,y:f,pixelRatio:j})};this._resizeBuffer();const nt=this.device.canvasContext.cssToDevicePixels([a,f],!0),at=[nt.x+Math.floor(nt.width/2),nt.y+Math.floor(nt.height/2)],J=Math.round(m*j),{width:mt,height:Mt}=this.pickingFBO,pt=this._getPickingRect({deviceX:at[0],deviceY:at[1],deviceRadius:J,deviceWidth:mt,deviceHeight:Mt}),Pt={x:a-m,y:f-m,width:m*2+1,height:m*2+1};let kt;const $t=[],ae=new Set;for(let qt=0;qt<l;qt++){let le;if(pt){const Be=this._drawAndSample({layers:G,views:e,viewports:n,onViewportActive:P,deviceRect:pt,cullRect:Pt,effects:L,pass:`picking:${w}`});le=oA({...Be,deviceX:at[0],deviceY:at[1],deviceRadius:J,deviceRect:pt})}else le={pickedColor:null,pickedObjectIndex:-1};let Oe;if(le.pickedLayer&&C&&this.depthFBO){const{pickedColors:Be}=this._drawAndSample({layers:[le.pickedLayer],views:e,viewports:n,onViewportActive:P,deviceRect:{x:le.pickedX,y:le.pickedY,width:1,height:1},cullRect:Pt,effects:L,pass:`picking:${w}:z`},!0);Be[3]&&(Oe=Be[0])}le.pickedLayer&&qt+1<l&&(ae.add(le.pickedLayer),le.pickedLayer.disablePickingIndex(le.pickedObjectIndex)),kt=cA({pickInfo:le,lastPickedInfo:this.lastPickedInfo,mode:w,layers:G,viewports:n,x:a,y:f,z:Oe,pixelRatio:j});for(const Be of kt.values())Be.layer&&$t.push(Be);if(!le.pickedColor)break}for(const qt of ae)qt.restorePickingColors();return{result:$t,emptyInfo:kt.get(null)}}_pickClosestObject({layers:t,views:e,viewports:n,x:a,y:f,radius:m=0,depth:l=1,mode:w="query",unproject3D:C,onViewportActive:P,effects:L}){const j=this.device.canvasContext.cssToDeviceRatio(),G=this._getPickable(t);if(!G||n.length===0)return{result:[],emptyInfo:v1({viewports:n,x:a,y:f,pixelRatio:j})};this._resizeBuffer();const nt=this.device.canvasContext.cssToDevicePixels([a,f],!0),at=[nt.x+Math.floor(nt.width/2),nt.y+Math.floor(nt.height/2)],J=Math.round(m*j),{width:mt,height:Mt}=this.pickingFBO,pt=this._getPickingRect({deviceX:at[0],deviceY:at[1],deviceRadius:J,deviceWidth:mt,deviceHeight:Mt}),Pt={x:a-m,y:f-m,width:m*2+1,height:m*2+1};let kt;const $t=[],ae=new Set;for(let qt=0;qt<l;qt++){let le;if(pt){const Be=this._drawAndSample({layers:G,views:e,viewports:n,onViewportActive:P,deviceRect:pt,cullRect:Pt,effects:L,pass:`picking:${w}`});le=oA({...Be,deviceX:at[0],deviceY:at[1],deviceRadius:J,deviceRect:pt})}else le={pickedColor:null,pickedObjectIndex:-1};let Oe;if(le.pickedLayer&&C&&this.depthFBO){const{pickedColors:Be}=this._drawAndSample({layers:[le.pickedLayer],views:e,viewports:n,onViewportActive:P,deviceRect:{x:le.pickedX,y:le.pickedY,width:1,height:1},cullRect:Pt,effects:L,pass:`picking:${w}:z`},!0);Be[3]&&(Oe=Be[0])}le.pickedLayer&&qt+1<l&&(ae.add(le.pickedLayer),le.pickedLayer.disablePickingIndex(le.pickedObjectIndex)),kt=cA({pickInfo:le,lastPickedInfo:this.lastPickedInfo,mode:w,layers:G,viewports:n,x:a,y:f,z:Oe,pixelRatio:j});for(const Be of kt.values())Be.layer&&$t.push(Be);if(!le.pickedColor)break}for(const qt of ae)qt.restorePickingColors();return{result:$t,emptyInfo:kt.get(null)}}async _pickVisibleObjectsAsync({layers:t,views:e,viewports:n,x:a,y:f,width:m=1,height:l=1,mode:w="query",maxObjects:C=null,onViewportActive:P,effects:L}){const j=this._getPickable(t);if(!j||n.length===0)return[];this._resizeBuffer();const G=this.device.canvasContext.cssToDeviceRatio(),nt=this.device.canvasContext.cssToDevicePixels([a,f],!0),at=nt.x,J=nt.y+nt.height,mt=this.device.canvasContext.cssToDevicePixels([a+m,f+l],!0),Mt=mt.x+mt.width,pt=mt.y,Pt={x:at,y:pt,width:Mt-at,height:J-pt},kt=this._drawAndSample({layers:j,views:e,viewports:n,onViewportActive:P,deviceRect:Pt,cullRect:{x:a,y:f,width:m,height:l},effects:L,pass:`picking:${w}`}),$t=lA(kt),ae=new Map,qt=[],le=Number.isFinite(C);for(let Oe=0;Oe<$t.length&&!(le&&qt.length>=C);Oe++){const Be=$t[Oe];let qe={color:Be.pickedColor,layer:null,index:Be.pickedObjectIndex,picked:!0,x:a,y:f,pixelRatio:G};qe=b1({layer:Be.pickedLayer,info:qe,mode:w});const ri=qe.layer.id;ae.has(ri)||ae.set(ri,new Set);const Ne=ae.get(ri),wi=qe.object??qe.index;Ne.has(wi)||(Ne.add(wi),qt.push(qe))}return qt}_pickVisibleObjects({layers:t,views:e,viewports:n,x:a,y:f,width:m=1,height:l=1,mode:w="query",maxObjects:C=null,onViewportActive:P,effects:L}){const j=this._getPickable(t);if(!j||n.length===0)return[];this._resizeBuffer();const G=this.device.canvasContext.cssToDeviceRatio(),nt=this.device.canvasContext.cssToDevicePixels([a,f],!0),at=nt.x,J=nt.y+nt.height,mt=this.device.canvasContext.cssToDevicePixels([a+m,f+l],!0),Mt=mt.x+mt.width,pt=mt.y,Pt={x:at,y:pt,width:Mt-at,height:J-pt},kt=this._drawAndSample({layers:j,views:e,viewports:n,onViewportActive:P,deviceRect:Pt,cullRect:{x:a,y:f,width:m,height:l},effects:L,pass:`picking:${w}`}),$t=lA(kt),ae=new Map,qt=[],le=Number.isFinite(C);for(let Oe=0;Oe<$t.length&&!(le&&qt.length>=C);Oe++){const Be=$t[Oe];let qe={color:Be.pickedColor,layer:null,index:Be.pickedObjectIndex,picked:!0,x:a,y:f,pixelRatio:G};qe=b1({layer:Be.pickedLayer,info:qe,mode:w});const ri=qe.layer.id;ae.has(ri)||ae.set(ri,new Set);const Ne=ae.get(ri),wi=qe.object??qe.index;Ne.has(wi)||(Ne.add(wi),qt.push(qe))}return qt}async _drawAndSampleAsync({layers:t,views:e,viewports:n,onViewportActive:a,deviceRect:f,cullRect:m,effects:l,pass:w},C=!1){const P=C?this.depthFBO:this.pickingFBO,L={layers:t,layerFilter:this.layerFilter,views:e,viewports:n,onViewportActive:a,pickingFBO:P,deviceRect:f,cullRect:m,effects:l,pass:w,pickZ:C,preRenderStats:{},isPicking:!0};for(const Mt of l)Mt.useInPicking&&(L.preRenderStats[Mt.id]=Mt.preRender(L));const{decodePickingColor:j}=this.pickLayersPass.render(L),{x:G,y:nt,width:at,height:J}=f,mt=new(C?Float32Array:Uint8Array)(at*J*4);return this.device.readPixelsToArrayWebGL(P,{sourceX:G,sourceY:nt,sourceWidth:at,sourceHeight:J,target:mt}),{pickedColors:mt,decodePickingColor:j}}_drawAndSample({layers:t,views:e,viewports:n,onViewportActive:a,deviceRect:f,cullRect:m,effects:l,pass:w},C=!1){const P=C?this.depthFBO:this.pickingFBO,L={layers:t,layerFilter:this.layerFilter,views:e,viewports:n,onViewportActive:a,pickingFBO:P,deviceRect:f,cullRect:m,effects:l,pass:w,pickZ:C,preRenderStats:{},isPicking:!0};for(const Mt of l)Mt.useInPicking&&(L.preRenderStats[Mt.id]=Mt.preRender(L));const{decodePickingColor:j}=this.pickLayersPass.render(L),{x:G,y:nt,width:at,height:J}=f,mt=new(C?Float32Array:Uint8Array)(at*J*4);return this.device.readPixelsToArrayWebGL(P,{sourceX:G,sourceY:nt,sourceWidth:at,sourceHeight:J,target:mt}),{pickedColors:mt,decodePickingColor:j}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:n,deviceWidth:a,deviceHeight:f}){const m=Math.max(0,t-n),l=Math.max(0,e-n),w=Math.min(a,t+n+1)-m,C=Math.min(f,e+n+1)-l;return w<=0||C<=0?null:{x:m,y:l,width:w,height:C}}}const k5={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},O5="top-left",uA="__root";class B5{constructor({deck:t,parentElement:e}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,e?.classList.add("deck-widget-container"),this.parentElement=e}getWidgets(){return this.resolvedWidgets}setProps(t){if(t.widgets&&!Pl(t.widgets,this.widgets,1)){const e=t.widgets.filter(Boolean);this._setWidgets(e)}}finalize(){for(const t of this.getWidgets())this._removeWidget(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(e=>e.id===t.id)||(this._addWidget(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}onRedraw({viewports:t,layers:e}){const n=t.reduce((a,f)=>(a[f.id]=f,a),{});for(const a of this.getWidgets()){const{viewId:f}=a;if(f){const m=n[f];m&&(a.onViewportChange&&a.onViewportChange(m),a.onRedraw?.({viewports:[m],layers:e}))}else{if(a.onViewportChange)for(const m of t)a.onViewportChange(m);a.onRedraw?.({viewports:t,layers:e})}}this.lastViewports=n,this._updateContainers()}onHover(t,e){for(const n of this.getWidgets()){const{viewId:a}=n;(!a||a===t.viewport?.id)&&n.onHover?.(t,e)}}onEvent(t,e){const n=d1[e.type];if(n)for(const a of this.getWidgets()){const{viewId:f}=a;(!f||f===t.viewport?.id)&&a[n]?.(t,e)}}_setWidgets(t){const e={};for(const n of this.resolvedWidgets)e[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)e[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){const a=e[n.id];a?a.viewId!==n.viewId||a.placement!==n.placement?(this._removeWidget(a),this._addWidget(n)):n!==a&&(a.setProps(n.props),n=a):this._addWidget(n),e[n.id]=null,this.resolvedWidgets.push(n)}for(const n in e){const a=e[n];a&&this._removeWidget(a)}this.widgets=t}_addWidget(t){const{viewId:e=null,placement:n=O5}=t;t.widgetManager=this,t.deck=this.deck,t.rootElement=t._onAdd({deck:this.deck,viewId:e}),t.rootElement&&this._getContainer(e,n).append(t.rootElement),t.updateHTML()}_removeWidget(t){t.onRemove?.(),t.rootElement&&t.rootElement.remove(),t.rootElement=void 0,t.deck=void 0,t.widgetManager=void 0}_getContainer(t,e){const n=t||uA;let a=this.containers[n];a||(a=document.createElement("div"),a.style.pointerEvents="none",a.style.position="absolute",a.style.overflow="hidden",this.parentElement?.append(a),this.containers[n]=a);let f=a.querySelector(`.${e}`);return f||(f=globalThis.document.createElement("div"),f.className=e,f.style.position="absolute",f.style.zIndex="2",Object.assign(f.style,k5[e]),a.append(f)),f}_updateContainers(){const t=this.deck.width,e=this.deck.height;for(const n in this.containers){const a=this.lastViewports[n]||null,f=n===uA||a,m=this.containers[n];f?(m.style.display="block",m.style.left=`${a?a.x:0}px`,m.style.top=`${a?a.y:0}px`,m.style.width=`${a?a.width:t}px`,m.style.height=`${a?a.height:e}px`):m.style.display="none"}}}function hA(i,t){t&&Object.entries(t).map(([e,n])=>{e.startsWith("--")?i.style.setProperty(e,n):i.style[e]=n})}function L5(i,t){t&&Object.keys(t).map(e=>{e.startsWith("--")?i.style.removeProperty(e):i.style[e]=""})}class Yw{constructor(t){this.viewId=null,this.props={...this.constructor.defaultProps,...t},this.id=this.props.id}setProps(t){const e=this.props,n=this.rootElement;n&&e.className!==t.className&&(e.className&&n.classList.remove(e.className),t.className&&n.classList.add(t.className)),n&&!Pl(e.style,t.style,1)&&(L5(n,e.style),hA(n,t.style)),Object.assign(this.props,t),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const t=["deck-widget",this.className,this.props.className],e=document.createElement("div");return t.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>e.classList.add(n)),hA(e,this.props.style),e}_onAdd(t){return this.onAdd(t)??this.onCreateRootElement()}onAdd(t){}onRemove(){}onViewportChange(t){}onRedraw(t){}onHover(t,e){}onClick(t,e){}onDrag(t,e){}onDragStart(t,e){}onDragEnd(t,e){}}Yw.defaultProps={id:"widget",style:{},className:""};const F5={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class OM extends Yw{constructor(t={}){super(t),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(t)}onCreateRootElement(){const t=document.createElement("div");return t.className=this.className,Object.assign(t.style,F5),t}onRenderHTML(t){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:e}=this,n=e&&e.props.getTooltip;if(!n)return;const a=n(t);this.lastViewport=t.viewport,this.setTooltip(a,t.x,t.y)}setTooltip(t,e,n){const a=this.rootElement;if(a){if(typeof t=="string")a.innerText=t;else if(t)t.text&&(a.innerText=t.text),t.html&&(a.innerHTML=t.html),t.className&&(a.className=t.className);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform=`translate(${e}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(a.style,t.style)}}}OM.defaultProps={...Yw.defaultProps};const N5="modulepreload",z5=function(i,t){return new URL(i,t).href},fA={},x1=function(t,e,n){let a=Promise.resolve();if(e&&e.length>0){let C=function(P){return Promise.all(P.map(L=>Promise.resolve(L).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};const m=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),w=l?.nonce||l?.getAttribute("nonce");a=C(e.map(P=>{if(P=z5(P,n),P in fA)return;fA[P]=!0;const L=P.endsWith(".css"),j=L?'[rel="stylesheet"]':"";if(n)for(let nt=m.length-1;nt>=0;nt--){const at=m[nt];if(at.href===P&&(!L||at.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${P}"]${j}`))return;const G=document.createElement("link");if(G.rel=L?"stylesheet":N5,L||(G.as="script"),G.crossOrigin="",G.href=P,w&&G.setAttribute("nonce",w),document.head.appendChild(G),L)return new Promise((nt,at)=>{G.addEventListener("load",nt),G.addEventListener("error",()=>at(new Error(`Unable to preload CSS for ${P}`)))})}))}function f(m){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=m,window.dispatchEvent(l),!l.defaultPrevented)throw m}return a.then(m=>{for(const l of m||[])l.status==="rejected"&&f(l.reason);return t().catch(f)})};var Cg;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Cg||(Cg={}));const U5={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},V5=i=>({drawBuffersWEBGL(t){return i.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),j5=i=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return i.createVertexArray()},deleteVertexArrayOES(t){return i.deleteVertexArray(t)},isVertexArrayOES(t){return i.isVertexArray(t)},bindVertexArrayOES(t){return i.bindVertexArray(t)}}),$5=i=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return i.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return i.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return i.vertexAttribDivisor(...t)}});function H5(i=!0){const t=HTMLCanvasElement.prototype;if(!i&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,n){if(e==="webgl"||e==="experimental-webgl"){const a=this.originalGetContext("webgl2",n);return a instanceof HTMLElement&&W5(a),a}return this.originalGetContext(e,n)}}function W5(i){i.getExtension("EXT_color_buffer_float");const t={...U5,WEBGL_disjoint_timer_query:i.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:V5(i),OES_vertex_array_object:j5(i),ANGLE_instanced_arrays:$5(i)},e=i.getExtension;i.getExtension=function(a){const f=e.call(i,a);return f||(a in t?t[a]:null)};const n=i.getSupportedExtensions;i.getSupportedExtensions=function(){return(n.apply(i)||[])?.concat(Object.keys(t))}}async function BM(i,t){const e=document.getElementsByTagName("head")[0];if(!e)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",i),new Promise((a,f)=>{n.onload=a,n.onerror=m=>f(new Error(`Unable to load script '${i}': ${m}`)),e.appendChild(n)})}const q5=1;let jo=null,dA=!1;const Kw={debugSpectorJS:Se.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function X5(i){if(!globalThis.SPECTOR)try{await BM(i.debugSpectorJSUrl||Kw.debugSpectorJSUrl)}catch(t){Se.warn(String(t))}}function Z5(i){if(i={...Kw,...i},!i.debugSpectorJS)return null;if(!jo&&globalThis.SPECTOR&&!globalThis.luma?.spector){Se.probe(q5,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;jo=new t,globalThis.luma&&(globalThis.luma.spector=jo)}if(!jo)return null;if(dA||(dA=!0,jo.spyCanvases(),jo?.onCaptureStarted.add(t=>Se.info("Spector capture started:",t)()),jo?.onCapture.add(t=>{Se.info("Spector capture complete:",t)(),jo?.getResultUI(),jo?.resultView.display(),jo?.resultView.addCapture(t)})),i.gl){const t=i.gl,e=t.device;jo?.startCapture(i.gl,500),t.device=e,new Promise(n=>setTimeout(n,2e3)).then(n=>{Se.info("Spector capture stopped after 2 seconds")(),jo?.stopCapture()})}return jo}const G5="https://unpkg.com/webgl-debug@2.0.1/index.js";function LM(i){return i.luma=i.luma||{},i.luma}async function Y5(){Vp()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await BM(G5))}function K5(i,t={}){return t.debugWebGL||t.traceWebGL?J5(i,t):Q5(i)}function Q5(i){const t=LM(i);return t.realContext?t.realContext:i}function J5(i,t){if(!globalThis.WebGLDebugUtils)return Se.warn("webgl-debug not loaded")(),i;const e=LM(i);if(e.debugContext)return e.debugContext;globalThis.WebGLDebugUtils.init({...Cg,...i});const n=globalThis.WebGLDebugUtils.makeDebugContext(i,tV.bind(null,t),eV.bind(null,t));for(const m in Cg)!(m in n)&&typeof Cg[m]=="number"&&(n[m]=Cg[m]);class a{}Object.setPrototypeOf(n,Object.getPrototypeOf(i)),Object.setPrototypeOf(a,n);const f=Object.create(a);return e.realContext=i,e.debugContext=f,f.debug=!0,f}function pA(i,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let e=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,t);return e=`${e.slice(0,100)}${e.length>100?"...":""}`,`gl.${i}(${e})`}function tV(i,t,e,n){n=Array.from(n).map(l=>l===void 0?"undefined":l);const a=globalThis.WebGLDebugUtils.glEnumToString(t),f=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,n),m=`${a} in gl.${e}(${f})`;Se.error(m)();debugger}function eV(i,t,e){let n="";Se.level>=1&&(n=pA(t,e),i.traceWebGL&&Se.log(1,n)());for(const a of e)if(a===void 0){n=n||pA(t,e);debugger}}const Yv=1;class iV extends JL{type="webgl";constructor(){super(),Bp.defaultProps={...Bp.defaultProps,...Kw}}enforceWebGL2(t){H5(t)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext&&Se.warn("WebGL1 is not supported",t)(),!1)}async attach(t,e={}){const{WebGLDevice:n}=await x1(async()=>{const{WebGLDevice:f}=await Promise.resolve().then(()=>PA);return{WebGLDevice:f}},void 0,import.meta.url);if(t instanceof n)return t;if(t?.device instanceof n)return t.device;if(!nV(t))throw new Error("Invalid WebGL2RenderingContext");const a=e.createCanvasContext===!0?{}:e.createCanvasContext;return new n({...e,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...a}})}async create(t={}){const{WebGLDevice:e}=await x1(async()=>{const{WebGLDevice:n}=await Promise.resolve().then(()=>PA);return{WebGLDevice:n}},void 0,import.meta.url);Se.groupCollapsed(Yv,"WebGLDevice created")();try{const n=[];(t.debugWebGL||t.debug)&&n.push(Y5()),t.debugSpectorJS&&n.push(X5(t));const a=await Promise.allSettled(n);for(const l of a)l.status==="rejected"&&Se.error(`Failed to initialize debug libraries ${l.reason}`)();const f=new e(t),m=`${f._reused?"Reusing":"Created"} device with WebGL2 ${f.props.debug?"debug ":""}context: ${f.info.vendor}, ${f.info.renderer} for canvas: ${f.canvasContext.id}`;return Se.probe(Yv,m)(),Se.table(Yv,f.info)(),f}finally{Se.groupEnd(Yv)()}}}function nV(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}const yx=new iV,Qw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Yr=(i,t,e)=>t?i.enable(e):i.disable(e),mA=(i,t,e)=>i.hint(e,t),$o=(i,t,e)=>i.pixelStorei(e,t),gA=(i,t,e)=>{const n=e===36006?36009:36008;return i.bindFramebuffer(n,t)},G_=(i,t,e)=>{const a={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[e];i.bindBuffer(a,t)};function vx(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}const rV={3042:Yr,32773:(i,t)=>i.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,t)=>i.clearColor(...t),3107:(i,t)=>i.colorMask(...t),2884:Yr,2885:(i,t)=>i.cullFace(t),2929:Yr,2931:(i,t)=>i.clearDepth(t),2932:(i,t)=>i.depthFunc(t),2928:(i,t)=>i.depthRange(...t),2930:(i,t)=>i.depthMask(t),3024:Yr,35723:mA,35725:(i,t)=>i.useProgram(t),36007:(i,t)=>i.bindRenderbuffer(36161,t),36389:(i,t)=>i.bindTransformFeedback?.(36386,t),34229:(i,t)=>i.bindVertexArray(t),36006:gA,36010:gA,34964:G_,36662:G_,36663:G_,35053:G_,35055:G_,2886:(i,t)=>i.frontFace(t),33170:mA,2849:(i,t)=>i.lineWidth(t),32823:Yr,32824:"polygonOffset",10752:"polygonOffset",35977:Yr,32926:Yr,32928:Yr,32938:"sampleCoverage",32939:"sampleCoverage",3089:Yr,3088:(i,t)=>i.scissor(...t),2960:Yr,2961:(i,t)=>i.clearStencil(t),2968:(i,t)=>i.stencilMaskSeparate(1028,t),36005:(i,t)=>i.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,t)=>i.viewport(...t),34383:Yr,10754:Yr,12288:Yr,12289:Yr,12290:Yr,12291:Yr,12292:Yr,12293:Yr,12294:Yr,12295:Yr,3333:$o,3317:$o,37440:$o,37441:$o,37443:$o,3330:$o,3332:$o,3331:$o,3314:$o,32878:$o,3316:$o,3315:$o,32877:$o,framebuffer:(i,t)=>{const e=t&&"handle"in t?t.handle:t;return i.bindFramebuffer(36160,e)},blend:(i,t)=>t?i.enable(3042):i.disable(3042),blendColor:(i,t)=>i.blendColor(...t),blendEquation:(i,t)=>{const e=typeof t=="number"?[t,t]:t;i.blendEquationSeparate(...e)},blendFunc:(i,t)=>{const e=t?.length===2?[...t,...t]:t;i.blendFuncSeparate(...e)},clearColor:(i,t)=>i.clearColor(...t),clearDepth:(i,t)=>i.clearDepth(t),clearStencil:(i,t)=>i.clearStencil(t),colorMask:(i,t)=>i.colorMask(...t),cull:(i,t)=>t?i.enable(2884):i.disable(2884),cullFace:(i,t)=>i.cullFace(t),depthTest:(i,t)=>t?i.enable(2929):i.disable(2929),depthFunc:(i,t)=>i.depthFunc(t),depthMask:(i,t)=>i.depthMask(t),depthRange:(i,t)=>i.depthRange(...t),dither:(i,t)=>t?i.enable(3024):i.disable(3024),derivativeHint:(i,t)=>{i.hint(35723,t)},frontFace:(i,t)=>i.frontFace(t),mipmapHint:(i,t)=>i.hint(33170,t),lineWidth:(i,t)=>i.lineWidth(t),polygonOffsetFill:(i,t)=>t?i.enable(32823):i.disable(32823),polygonOffset:(i,t)=>i.polygonOffset(...t),sampleCoverage:(i,t)=>i.sampleCoverage(t[0],t[1]||!1),scissorTest:(i,t)=>t?i.enable(3089):i.disable(3089),scissor:(i,t)=>i.scissor(...t),stencilTest:(i,t)=>t?i.enable(2960):i.disable(2960),stencilMask:(i,t)=>{t=vx(t)?t:[t,t];const[e,n]=t;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,n)},stencilFunc:(i,t)=>{t=vx(t)&&t.length===3?[...t,...t]:t;const[e,n,a,f,m,l]=t;i.stencilFuncSeparate(1028,e,n,a),i.stencilFuncSeparate(1029,f,m,l)},stencilOp:(i,t)=>{t=vx(t)&&t.length===3?[...t,...t]:t;const[e,n,a,f,m,l]=t;i.stencilOpSeparate(1028,e,n,a),i.stencilOpSeparate(1029,f,m,l)},viewport:(i,t)=>i.viewport(...t)};function wr(i,t,e){return t[i]!==void 0?t[i]:e[i]}const sV={blendEquation:(i,t,e)=>i.blendEquationSeparate(wr(32777,t,e),wr(34877,t,e)),blendFunc:(i,t,e)=>i.blendFuncSeparate(wr(32969,t,e),wr(32968,t,e),wr(32971,t,e),wr(32970,t,e)),polygonOffset:(i,t,e)=>i.polygonOffset(wr(32824,t,e),wr(10752,t,e)),sampleCoverage:(i,t,e)=>i.sampleCoverage(wr(32938,t,e),wr(32939,t,e)),stencilFuncFront:(i,t,e)=>i.stencilFuncSeparate(1028,wr(2962,t,e),wr(2967,t,e),wr(2963,t,e)),stencilFuncBack:(i,t,e)=>i.stencilFuncSeparate(1029,wr(34816,t,e),wr(36003,t,e),wr(36004,t,e)),stencilOpFront:(i,t,e)=>i.stencilOpSeparate(1028,wr(2964,t,e),wr(2965,t,e),wr(2966,t,e)),stencilOpBack:(i,t,e)=>i.stencilOpSeparate(1029,wr(34817,t,e),wr(34818,t,e),wr(34819,t,e))},_A={enable:(i,t)=>i({[t]:!0}),disable:(i,t)=>i({[t]:!1}),pixelStorei:(i,t,e)=>i({[t]:e}),hint:(i,t,e)=>i({[t]:e}),useProgram:(i,t)=>i({35725:t}),bindRenderbuffer:(i,t,e)=>i({36007:e}),bindTransformFeedback:(i,t,e)=>i({36389:e}),bindVertexArray:(i,t)=>i({34229:t}),bindFramebuffer:(i,t,e)=>{switch(t){case 36160:return i({36006:e,36010:e});case 36009:return i({36006:e});case 36008:return i({36010:e});default:return null}},bindBuffer:(i,t,e)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?i({[n]:e}):{valueChanged:!0}},blendColor:(i,t,e,n,a)=>i({32773:new Float32Array([t,e,n,a])}),blendEquation:(i,t)=>i({32777:t,34877:t}),blendEquationSeparate:(i,t,e)=>i({32777:t,34877:e}),blendFunc:(i,t,e)=>i({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(i,t,e,n,a)=>i({32969:t,32968:e,32971:n,32970:a}),clearColor:(i,t,e,n,a)=>i({3106:new Float32Array([t,e,n,a])}),clearDepth:(i,t)=>i({2931:t}),clearStencil:(i,t)=>i({2961:t}),colorMask:(i,t,e,n,a)=>i({3107:[t,e,n,a]}),cullFace:(i,t)=>i({2885:t}),depthFunc:(i,t)=>i({2932:t}),depthRange:(i,t,e)=>i({2928:new Float32Array([t,e])}),depthMask:(i,t)=>i({2930:t}),frontFace:(i,t)=>i({2886:t}),lineWidth:(i,t)=>i({2849:t}),polygonOffset:(i,t,e)=>i({32824:t,10752:e}),sampleCoverage:(i,t,e)=>i({32938:t,32939:e}),scissor:(i,t,e,n,a)=>i({3088:new Int32Array([t,e,n,a])}),stencilMask:(i,t)=>i({2968:t,36005:t}),stencilMaskSeparate:(i,t,e)=>i({[t===1028?2968:36005]:e}),stencilFunc:(i,t,e,n)=>i({2962:t,2967:e,2963:n,34816:t,36003:e,36004:n}),stencilFuncSeparate:(i,t,e,n,a)=>i({[t===1028?2962:34816]:e,[t===1028?2967:36003]:n,[t===1028?2963:36004]:a}),stencilOp:(i,t,e,n)=>i({2964:t,2965:e,2966:n,34817:t,34818:e,34819:n}),stencilOpSeparate:(i,t,e,n,a)=>i({[t===1028?2964:34817]:e,[t===1028?2965:34818]:n,[t===1028?2966:34819]:a}),viewport:(i,t,e,n,a)=>i({2978:[t,e,n,a]})},yu=(i,t)=>i.isEnabled(t),yA={3042:yu,2884:yu,2929:yu,3024:yu,32823:yu,32926:yu,32928:yu,3089:yu,2960:yu,35977:yu},aV=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Kg(i,t){if(lV(t))return;const e={};for(const a in t){const f=Number(a),m=rV[a];m&&(typeof m=="string"?e[m]=!0:m(i,t[a],f))}const n=i.state&&i.state.cache;if(n)for(const a in e){const f=sV[a];f(i,t,n)}}function FM(i,t=Qw){if(typeof t=="number"){const a=t,f=yA[a];return f?f(i,a):i.getParameter(a)}const e=Array.isArray(t)?t:Object.keys(t),n={};for(const a of e){const f=yA[a];n[a]=f?f(i,Number(a)):i.getParameter(Number(a))}return n}function oV(i){Kg(i,Qw)}function lV(i){for(const t in i)return!1;return!0}function cV(i,t){if(i===t)return!0;if(vA(i)&&vA(t)&&i.length===t.length){for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}return!1}function vA(i){return Array.isArray(i)||ArrayBuffer.isView(i)}class kp{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,e){this.gl=t,this.log=e?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];Kg(this.gl,t),this.stateStack.pop()}trackState(t,e){if(this.cache=e?.copyState?FM(t):Object.assign({},Qw),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,hV(t);for(const n in _A){const a=_A[n];uV(t,n,a)}bA(t,"getParameter"),bA(t,"isEnabled")}_updateCache(t){let e=!1,n;const a=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const f in t){const m=t[f],l=this.cache[f];cV(m,l)||(e=!0,n=l,a&&!(f in a)&&(a[f]=l),this.cache[f]=m)}return{valueChanged:e,oldValue:n}}}function bA(i,t){const e=i[t].bind(i);i[t]=function(a){if(a===void 0||aV.has(a))return e(a);const f=kp.get(i);return a in f.cache||(f.cache[a]=e(a)),f.enable?f.cache[a]:e(a)},Object.defineProperty(i[t],"name",{value:`${t}-from-cache`,configurable:!1})}function uV(i,t,e){if(!i[t])return;const n=i[t].bind(i);i[t]=function(...f){const m=kp.get(i),{valueChanged:l,oldValue:w}=e(m._updateCache,...f);return l&&n(...f),w},Object.defineProperty(i[t],"name",{value:`${t}-to-cache`,configurable:!1})}function hV(i){const t=i.useProgram.bind(i);i.useProgram=function(n){const a=kp.get(i);a.program!==n&&(t(n),a.program=n)}}function fV(i,t,e){let n="";const a={preserveDrawingBuffer:!0,...e};let f=null;if(f||=i.getContext("webgl2",a),a.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!f&&!e.failIfMajorPerformanceCaveat&&(a.failIfMajorPerformanceCaveat=!1,f=i.getContext("webgl2",a),f.luma||={},f.luma.softwareRenderer=!0),f||(f=i.getContext("webgl",{}),f&&(f=null,n||="Your browser only supports WebGL1")),!f)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:m,onContextRestored:l}=t;return i.addEventListener("webglcontextlost",w=>m(w),!1),i.addEventListener("webglcontextrestored",w=>l(w),!1),f.luma||={},f}function qg(i,t,e){return e[t]===void 0&&(e[t]=i.getExtension(t)||null),e[t]}function dV(i,t){const e=i.getParameter(7936),n=i.getParameter(7937);qg(i,"WEBGL_debug_renderer_info",t);const a=t.WEBGL_debug_renderer_info,f=i.getParameter(a?a.UNMASKED_VENDOR_WEBGL:7936),m=i.getParameter(a?a.UNMASKED_RENDERER_WEBGL:7937),l=f||e,w=m||n,C=i.getParameter(7938),P=NM(l,w),L=pV(l,w),j=mV(l,w);return{type:"webgl",gpu:P,gpuType:j,gpuBackend:L,vendor:l,renderer:w,version:C,shadingLanguage:"glsl",shadingLanguageVersion:300}}function NM(i,t){return/NVIDIA/i.exec(i)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(i)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(i)||/Apple/i.exec(t)?"apple":/AMD/i.exec(i)||/AMD/i.exec(t)||/ATI/i.exec(i)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(i)||/SwiftShader/i.exec(t)?"software":"unknown"}function pV(i,t){return/Metal/i.exec(i)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(i)||/ANGLE/i.exec(t)?"opengl":"unknown"}function mV(i,t){if(/SwiftShader/i.exec(i)||/SwiftShader/i.exec(t))return"cpu";switch(NM(i,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function zM(i){switch(i){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(i))}const iy="WEBGL_compressed_texture_s3tc",ny="WEBGL_compressed_texture_s3tc_srgb",Mg="EXT_texture_compression_rgtc",Rg="EXT_texture_compression_bptc",gV="WEBGL_compressed_texture_etc",_V="WEBGL_compressed_texture_astc",yV="WEBGL_compressed_texture_etc1",vV="WEBGL_compressed_texture_pvrtc",bV="WEBGL_compressed_texture_atc",xA="EXT_texture_norm16",wA="EXT_render_snorm",xV="EXT_color_buffer_float",Jw={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[wA],"norm16-renderable-webgl":[xA],"snorm16-renderable-webgl":[xA,wA],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[iy,ny,Mg,Rg],"texture-compression-bc5-webgl":[Mg],"texture-compression-bc7-webgl":[Rg],"texture-compression-etc2":[gV],"texture-compression-astc":[_V],"texture-compression-etc1-webgl":[yV],"texture-compression-pvrtc-webgl":[vV],"texture-compression-atc-webgl":[bV]};function wV(i){return i in Jw}function TV(i,t,e){return(Jw[t]||[]).every(a=>qg(i,a,e))}const tT={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:xV,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:iy},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ny},"bc1-rgba-unorm":{gl:33777,x:iy},"bc1-rgba-unorm-srgb":{gl:35916,x:ny},"bc2-rgba-unorm":{gl:33778,x:iy},"bc2-rgba-unorm-srgb":{gl:35918,x:ny},"bc3-rgba-unorm":{gl:33779,x:iy},"bc3-rgba-unorm-srgb":{gl:35919,x:ny},"bc4-r-unorm":{gl:36283,x:Mg},"bc4-r-snorm":{gl:36284,x:Mg},"bc5-rg-unorm":{gl:36285,x:Mg},"bc5-rg-snorm":{gl:36286,x:Mg},"bc6h-rgb-ufloat":{gl:36495,x:Rg},"bc6h-rgb-float":{gl:36494,x:Rg},"bc7-rgba-unorm":{gl:36492,x:Rg},"bc7-rgba-unorm-srgb":{gl:36493,x:Rg},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function SV(i,t,e){let n=t.create;const a=tT[t.format];return a?.gl===void 0&&(n=!1),a?.x&&(n=n&&!!qg(i,a.x,e)),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function UM(i){const t=tT[i],e=CV(i),n=Dg.getInfo(i);return n.compressed&&(t.dataFormat=e),{internalFormat:e,format:t?.dataFormat||EV(n.channels,n.integer,n.normalized,e),type:n.dataType?zM(n.dataType):t?.types?.[0]||5121,compressed:n.compressed||!1}}function AV(i){switch(Dg.getInfo(i).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${i}`)}}function EV(i,t,e,n){if(n===6408||n===6407)return n;switch(i){case"r":return t&&!e?36244:6403;case"rg":return t&&!e?33320:33319;case"rgb":return t&&!e?36248:6407;case"rgba":return t&&!e?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function CV(i){const e=tT[i]?.gl;if(e===void 0)throw new Error(`Unsupported texture format ${i}`);return e}const TA={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class MV extends KL{gl;extensions;testedFeatures=new Set;constructor(t,e,n){super([],n),this.gl=t,this.extensions=e,qg(t,"EXT_color_buffer_float",e)}*[Symbol.iterator](){const t=this.getFeatures();for(const e of t)this.has(e)&&(yield e);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),wV(t)&&TV(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(e=>e!=="polygon-mode-webgl");for(const e of t)this.has(e)}getFeatures(){return[...Object.keys(TA),...Object.keys(Jw)]}getWebGLFeature(t){const e=TA[t];return typeof e=="string"?!!qg(this.gl,e,this.extensions):!!e}}class RV extends YL{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class py extends Kb{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,e){super(t,e);const n=e.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const n=this.colorAttachments[e];if(n){const a=36064+e;this._attachTextureView(a,n)}}if(this.depthStencilAttachment){const e=AV(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(e!==36053)throw new Error(`Framebuffer ${IV(e)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,e){const{gl:n}=this.device,{texture:a}=e,f=e.props.baseMipLevel,m=e.props.baseArrayLayer;switch(n.bindTexture(a.glTarget,a.handle),a.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,a.handle,f,m);break;case 34067:const l=PV(m);n.framebufferTexture2D(36160,t,l,a.handle,f);break;case 3553:n.framebufferTexture2D(36160,t,3553,a.handle,f);break;default:throw new Error("Illegal texture type")}n.bindTexture(a.glTarget,null)}}function PV(i){return i<34069?i+34069:i}function IV(i){switch(i){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${i}`}}class DV extends Ep{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,e){super(e),this.device=t,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new py(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const bx={};function kV(i="id"){bx[i]=bx[i]||1;const t=bx[i]++;return`${i}-${t}`}class my extends Un{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(t,e={}){super(t,e),this.device=t,this.gl=this.device.gl;const n=typeof e=="object"?e.handle:void 0;this.handle=n||this.gl.createBuffer(),t._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=OV(this.props.usage),this.glUsage=BV(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,e.data?this._initWithData(e.data,e.byteOffset,e.byteLength):this._initWithByteLength(e.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(t,e=0,n=t.byteLength+e){const a=this.glTarget;this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,n,this.glUsage),this.gl.bufferSubData(a,e,t),this.gl.bindBuffer(a,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,e,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let e=t;t===0&&(e=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,e,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}write(t,e=0){const n=ArrayBuffer.isView(t)?t:new Uint8Array(t),a=36663;this.gl.bindBuffer(a,this.handle),this.gl.bufferSubData(a,e,n),this.gl.bindBuffer(a,null),this._setDebugData(t,e,t.byteLength)}async mapAndWriteAsync(t,e=0,n=this.byteLength-e){const a=new ArrayBuffer(n);await t(a,"copied"),this.write(a,e)}async readAsync(t=0,e){return this.readSyncWebGL(t,e)}async mapAndReadAsync(t,e=0,n){const a=await this.readAsync(e,n);return await t(a.buffer,"copied")}readSyncWebGL(t=0,e){e=e??this.byteLength-t;const n=new Uint8Array(e),a=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,a,e),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,e),n}}function OV(i){return i&Un.INDEX?34963:i&Un.VERTEX?34962:i&Un.UNIFORM?35345:34962}function BV(i){return i&Un.INDEX||i&Un.VERTEX?35044:i&Un.UNIFORM?35048:35044}function LV(i){const t=i.split(/\r?\n/),e=[];for(const n of t){if(n.length<=1)continue;const a=n.split(":");if(a.length===2){const[L,j]=a;e.push({message:j.trim(),type:SA(L),lineNum:0,linePos:0});continue}const[f,m,l,...w]=a;let C=parseInt(l,10);isNaN(C)&&(C=0);let P=parseInt(m,10);isNaN(P)&&(P=0),e.push({message:w.join(":").trim(),type:SA(f),lineNum:C,linePos:P})}return e}function SA(i){const t=["warning","error","info"],e=i.toLowerCase();return t.includes(e)?e:"info"}class FV extends Yb{device;handle;constructor(t,e){switch(super(t,e),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?LV(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:e}=this.device;if(e.shaderSource(this.handle,t),e.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Se.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Se.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async a=>await new Promise(f=>setTimeout(f,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function NV(i,t,e,n){if(jV(t))return n(i);const a=i;a.pushState();try{return zV(i,t),Kg(a.gl,e),n(i)}finally{a.popState()}}function zV(i,t){const e=i,{gl:n}=e;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(Op("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&i.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&i.features.has("provoking-vertex-webgl")){const f=e.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,m=Op("provokingVertex",t.provokingVertex,{first:36429,last:36430});f?.provokingVertexWEBGL(m)}if((t.polygonMode||t.polygonOffsetLine)&&i.features.has("polygon-mode-webgl")){if(t.polygonMode){const f=e.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,m=Op("polygonMode",t.polygonMode,{fill:6914,line:6913});f?.polygonModeWEBGL(1028,m),f?.polygonModeWEBGL(1029,m)}t.polygonOffsetLine&&n.enable(10754)}if(i.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(VV("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(w1("depthCompare",t.depthCompare))),t.stencilWriteMask){const a=t.stencilWriteMask;n.stencilMaskSeparate(1028,a),n.stencilMaskSeparate(1029,a)}if(t.stencilReadMask&&Se.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const a=t.stencilReadMask||4294967295,f=w1("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,f,0,a),n.stencilFuncSeparate(1029,f,0,a)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const a=xx("stencilPassOperation",t.stencilPassOperation),f=xx("stencilFailOperation",t.stencilFailOperation),m=xx("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,f,m,a),n.stencilOpSeparate(1029,f,m,a)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const a=AA("blendColorOperation",t.blendColorOperation||"add"),f=AA("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(a,f);const m=Kv("blendColorSrcFactor",t.blendColorSrcFactor||"one"),l=Kv("blendColorDstFactor",t.blendColorDstFactor||"zero"),w=Kv("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),C=Kv("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(m,l,w,C)}}function w1(i,t){return Op(i,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function xx(i,t){return Op(i,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function AA(i,t){return Op(i,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Kv(i,t,e="color"){return Op(i,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:e==="color"?32769:32771,"one-minus-constant":e==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function UV(i,t){return`Illegal parameter ${t} for ${i}`}function Op(i,t,e){if(!(t in e))throw new Error(UV(i,t));return e[t]}function VV(i,t){return t}function jV(i){let t=!0;for(const e in i){t=!1;break}return t}function VM(i){const t={};return i.addressModeU&&(t[10242]=wx(i.addressModeU)),i.addressModeV&&(t[10243]=wx(i.addressModeV)),i.addressModeW&&(t[32882]=wx(i.addressModeW)),i.magFilter&&(t[10240]=T1(i.magFilter)),(i.minFilter||i.mipmapFilter)&&(t[10241]=$V(i.minFilter||"linear",i.mipmapFilter)),i.lodMinClamp!==void 0&&(t[33082]=i.lodMinClamp),i.lodMaxClamp!==void 0&&(t[33083]=i.lodMaxClamp),i.type==="comparison-sampler"&&(t[34892]=34894),i.compare&&(t[34893]=w1("compare",i.compare)),i.maxAnisotropy&&(t[34046]=i.maxAnisotropy),t}function wx(i){switch(i){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function T1(i){switch(i){case"nearest":return 9728;case"linear":return 9729}}function $V(i,t="none"){if(!t)return T1(i);switch(t){case"none":return T1(i);case"nearest":switch(i){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(i){case"nearest":return 9986;case"linear":return 9987}}}class HV extends Lp{device;handle;parameters;constructor(t,e){super(t,e),this.device=t,this.parameters=VM(e),this.handle=e.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[e,n]of Object.entries(t)){const a=Number(e);switch(a){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,a,n);break;default:this.device.gl.samplerParameteri(this.handle,a,n);break}}}}function Cy(i,t,e){if(WV(t))return e(i);const{nocatch:n=!0}=t,a=kp.get(i);a.push(),Kg(i,t);let f;if(n)f=e(i),a.pop();else try{f=e(i)}finally{a.pop()}return f}function WV(i){for(const t in i)return!1;return!0}class Pg extends Gb{device;gl;handle;texture;constructor(t,e){super(t,{...ms.defaultProps,...e}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=e.texture}}class gy extends ms{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(t,e){super(t,e),this.device=t,this.gl=this.device.gl;const n=UM(this.props.format);this.glTarget=qV(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:a,width:f,height:m,depth:l,mipLevels:w,glTarget:C,glInternalFormat:P}=this;switch(a){case"2d":case"cube":this.gl.texStorage2D(C,w,P,f,m);break;case"2d-array":case"3d":this.gl.texStorage3D(C,w,P,f,m,l);break;default:throw new Error(a)}this.gl.bindTexture(this.glTarget,null),this._initializeData(e.data),this.setSampler(this.props.sampler),this.view=new Pg(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Pg(this.device,{...t,texture:this})}setSampler(t={}){super.setSampler(t);const e=VM(this.sampler.props);this._setSamplerParameters(e)}copyImageData(t){const e=this._normalizeCopyImageDataOptions(t),n=e.data,{width:a,height:f,depth:m}=this,{mipLevel:l=0,byteOffset:w=0,x:C=0,y:P=0,z:L=0}=e,{glFormat:j,glType:G,compressed:nt}=this,at=EA(this.glTarget,this.dimension,L);let J;if(!this.compressed){const{bytesPerPixel:Mt}=this.device.getTextureFormatInfo(this.format);if(Mt){if(e.bytesPerRow%Mt!==0)throw new Error(`bytesPerRow (${e.bytesPerRow}) must be a multiple of bytesPerPixel (${Mt}) for ${this.format}`);J=e.bytesPerRow/Mt}}const mt=this.compressed?{}:{...J!==void 0?{3314:J}:{},32878:e.rowsPerImage};this.gl.bindTexture(at,this.handle),Cy(this.gl,mt,()=>{switch(this.dimension){case"2d":case"cube":nt?this.gl.compressedTexSubImage2D(at,l,C,P,a,f,j,n,w):this.gl.texSubImage2D(at,l,C,P,a,f,j,G,n,w);break;case"2d-array":case"3d":nt?this.gl.compressedTexSubImage3D(at,l,C,P,L,a,f,m,j,n,w):this.gl.texSubImage3D(at,l,C,P,L,a,f,m,j,G,n,w);break;default:}}),this.gl.bindTexture(at,null)}copyExternalImage(t){const e=this._normalizeCopyExternalImageOptions(t);if(e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:a}=this,{image:f,depth:m,mipLevel:l,x:w,y:C,z:P,width:L,height:j}=e,G=EA(this.glTarget,this.dimension,m),nt=e.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),Cy(this.gl,nt,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(G,l,w,C,L,j,n,a,f);break;case"2d-array":case"3d":this.gl.texSubImage3D(G,l,w,C,P,L,j,m,n,a,f);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:e.width,height:e.height}}generateMipmapsWebGL(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Se.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){Se.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(t){Se.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[e,n]of Object.entries(t)){const a=Number(e),f=n;switch(a){case 33082:case 33083:this.gl.texParameterf(this.glTarget,a,f);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,a,f);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,a,f);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,a,f);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,a,f);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,this.handle),t}_unbind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,null),t}}function qV(i){switch(i){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(i)}function EA(i,t,e){return t==="cube"?34069+e:i}function XV(i){return KV[i]}function eT(i){return YV[i]}function ZV(i){return!!jM[i]}function GV(i){return jM[i]}const YV={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},jM={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},KV={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function QV(i,t){const e={attributes:[],bindings:[]};e.attributes=JV(i,t);const n=i8(i,t);for(const l of n){const w=l.uniforms.map(C=>({name:C.name,format:C.format,byteOffset:C.byteOffset,byteStride:C.byteStride,arrayLength:C.arrayLength}));e.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:w})}const a=e8(i,t);let f=0;for(const l of a)if(ZV(l.type)){const{viewDimension:w,sampleType:C}=GV(l.type);e.bindings.push({type:"texture",name:l.name,group:0,location:f,viewDimension:w,sampleType:C}),l.textureUnit=f,f+=1}a.length&&(e.uniforms=a);const m=t8(i,t);return m?.length&&(e.varyings=m),e}function JV(i,t){const e=[],n=i.getProgramParameter(t,35721);for(let a=0;a<n;a++){const f=i.getActiveAttrib(t,a);if(!f)throw new Error("activeInfo");const{name:m,type:l}=f,w=i.getAttribLocation(t,m);if(w>=0){const C=eT(l),P=/instance/i.test(m)?"instance":"vertex";e.push({name:m,location:w,stepMode:P,type:C})}}return e.sort((a,f)=>a.location-f.location),e}function t8(i,t){const e=[],n=i.getProgramParameter(t,35971);for(let a=0;a<n;a++){const f=i.getTransformFeedbackVarying(t,a);if(!f)throw new Error("activeInfo");const{name:m,type:l,size:w}=f,C=eT(l),{type:P,components:L}=DC(C);e.push({location:a,name:m,type:P,size:w*L})}return e.sort((a,f)=>a.location-f.location),e}function e8(i,t){const e=[],n=i.getProgramParameter(t,35718);for(let a=0;a<n;a++){const f=i.getActiveUniform(t,a);if(!f)throw new Error("activeInfo");const{name:m,size:l,type:w}=f,{name:C,isArray:P}=n8(m);let L=i.getUniformLocation(t,C);const j={location:L,name:C,size:l,type:w,isArray:P};if(e.push(j),j.size>1)for(let G=0;G<j.size;G++){const nt=`${C}[${G}]`;L=i.getUniformLocation(t,nt);const at={...j,name:nt,location:L};e.push(at)}}return e}function i8(i,t){const e=(f,m)=>i.getActiveUniformBlockParameter(t,f,m),n=[],a=i.getProgramParameter(t,35382);for(let f=0;f<a;f++){const m={name:i.getActiveUniformBlockName(t,f)||"",location:e(f,35391),byteLength:e(f,35392),vertex:e(f,35396),fragment:e(f,35398),uniformCount:e(f,35394),uniforms:[]},l=e(f,35395)||[],w=i.getActiveUniforms(t,l,35383),C=i.getActiveUniforms(t,l,35384),P=i.getActiveUniforms(t,l,35387),L=i.getActiveUniforms(t,l,35388);for(let j=0;j<m.uniformCount;++j){const G=i.getActiveUniform(t,l[j]);if(!G)throw new Error("activeInfo");const nt=eT(w[j]);m.uniforms.push({name:G.name,format:nt,type:w[j],arrayLength:C[j],byteOffset:P[j],byteStride:L[j]})}n.push(m)}return n.sort((f,m)=>f.location-m.location),n}function n8(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(i);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${i}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function r8(i,t,e,n){const a=i;let f=n;f===!0&&(f=1),f===!1&&(f=0);const m=typeof f=="number"?[f]:f;switch(e){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return i.uniform1i(t,n);case 5126:return i.uniform1fv(t,m);case 35664:return i.uniform2fv(t,m);case 35665:return i.uniform3fv(t,m);case 35666:return i.uniform4fv(t,m);case 5124:return i.uniform1iv(t,m);case 35667:return i.uniform2iv(t,m);case 35668:return i.uniform3iv(t,m);case 35669:return i.uniform4iv(t,m);case 35670:return i.uniform1iv(t,m);case 35671:return i.uniform2iv(t,m);case 35672:return i.uniform3iv(t,m);case 35673:return i.uniform4iv(t,m);case 5125:return a.uniform1uiv(t,m,1);case 36294:return a.uniform2uiv(t,m,2);case 36295:return a.uniform3uiv(t,m,3);case 36296:return a.uniform4uiv(t,m,4);case 35674:return i.uniformMatrix2fv(t,!1,m);case 35675:return i.uniformMatrix3fv(t,!1,m);case 35676:return i.uniformMatrix4fv(t,!1,m);case 35685:return a.uniformMatrix2x3fv(t,!1,m);case 35686:return a.uniformMatrix2x4fv(t,!1,m);case 35687:return a.uniformMatrix3x2fv(t,!1,m);case 35688:return a.uniformMatrix3x4fv(t,!1,m);case 35689:return a.uniformMatrix4x2fv(t,!1,m);case 35690:return a.uniformMatrix4x3fv(t,!1,m)}throw new Error("Illegal uniform")}function s8(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(i)}}function a8(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(i)}}const CA=4;class o8 extends Ip{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(t,e){super(t,e),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=e.vs,this.fs=e.fs;const{varyings:n,bufferMode:a=35981}=e;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,a)),this._linkShaders(),Se.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=QV(this.device.gl,this.handle),Se.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=e.shaderLayout?l8(this.introspectedLayout,e.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(t,e){for(const[n,a]of Object.entries(t)){const f=this.shaderLayout.bindings.find(m=>m.name===n)||this.shaderLayout.bindings.find(m=>m.name===`${n}Uniforms`);if(!f){const m=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");e?.disableWarnings||Se.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${m}`,a)();continue}switch(a||Se.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),f.type){case"uniform":if(!(a instanceof my)&&!(a.buffer instanceof my))throw new Error("buffer value");break;case"texture":if(!(a instanceof Pg||a instanceof gy||a instanceof py))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Se.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(f.type)}this.bindings[n]=a}}draw(t){const{renderPass:e,parameters:n=this.props.parameters,topology:a=this.props.topology,vertexArray:f,vertexCount:m,instanceCount:l,isInstanced:w=!1,firstVertex:C=0,transformFeedback:P}=t,L=s8(a),j=!!f.indexBuffer,G=f.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Se.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Se.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),f.bindBeforeRender(e),P&&P.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const nt=e;return NV(this.device,n,nt.glParameters,()=>{j&&w?this.device.gl.drawElementsInstanced(L,m||0,G,C,l||0):j?this.device.gl.drawElements(L,m||0,G,C):w?this.device.gl.drawArraysInstanced(L,C,m||0,l||0):this.device.gl.drawArrays(L,C,m||0),P&&P.end()}),f.unbindAfterRender(e),!0}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Se.time(CA,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Se.timeEnd(CA,`linkProgram for ${this.id}`)(),Se.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Se.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Se.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const e=this._getLinkStatus();this._reportLinkStatus(e)}async _reportLinkStatus(t){switch(t){case"success":return;default:const e=t==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${e} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${e} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${e} during ${t}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const t=async a=>await new Promise(f=>setTimeout(f,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const e of this.shaderLayout.bindings)!this.bindings[e.name]&&!this.bindings[e.name.replace(/Uniforms$/,"")]&&(Se.warn(`Binding ${e.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let e=0,n=0;for(const a of this.shaderLayout.bindings){const f=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!f)throw new Error(`No value for binding ${a.name} in ${this.id}`);switch(a.type){case"uniform":const{name:m}=a,l=t.getUniformBlockIndex(this.handle,m);if(l===4294967295)throw new Error(`Invalid uniform block name ${m}`);t.uniformBlockBinding(this.handle,n,l),f instanceof my?t.bindBufferBase(35345,n,f.handle):t.bindBufferRange(35345,n,f.buffer.handle,f.offset||0,f.size||f.buffer.byteLength-f.offset),n+=1;break;case"texture":if(!(f instanceof Pg||f instanceof gy||f instanceof py))throw new Error("texture");let w;if(f instanceof Pg)w=f.texture;else if(f instanceof gy)w=f;else if(f instanceof py&&f.colorAttachments[0]instanceof Pg)Se.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),w=f.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+e),t.bindTexture(w.glTarget,w.handle),e+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${a.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:e,location:n,type:a,textureUnit:f}=t,m=this.uniforms[e]??f;m!==void 0&&r8(this.device.gl,n,a,m)}}}function l8(i,t){const e={...i,attributes:i.attributes.map(n=>({...n}))};for(const n of t?.attributes||[]){const a=e.attributes.find(f=>f.name===n.name);a?(a.type=n.type||a.type,a.stepMode=n.stepMode||a.stepMode):Se.warn(`shader layout attribute ${n.name} not present in shader`)}return e}class c8 extends Aw{device;handle=null;commands=[];constructor(t){super(t,{}),this.device=t}_executeCommands(t=this.commands){for(const e of t)switch(e.name){case"copy-buffer-to-buffer":u8(this.device,e.options);break;case"copy-buffer-to-texture":h8(this.device,e.options);break;case"copy-texture-to-buffer":f8(this.device,e.options);break;case"copy-texture-to-texture":d8(this.device,e.options);break;default:throw new Error(e.name)}}}function u8(i,t){const e=t.sourceBuffer,n=t.destinationBuffer;i.gl.bindBuffer(36662,e.handle),i.gl.bindBuffer(36663,n.handle),i.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),i.gl.bindBuffer(36662,null),i.gl.bindBuffer(36663,null)}function h8(i,t){throw new Error("Not implemented")}function f8(i,t){const{sourceTexture:e,mipLevel:n=0,aspect:a="all",width:f=t.sourceTexture.width,height:m=t.sourceTexture.height,depthOrArrayLayers:l=0,origin:w=[0,0],destinationBuffer:C,byteOffset:P=0,bytesPerRow:L,rowsPerImage:j}=t;if(a!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||l!==0||L||j)throw new Error("not implemented");const{framebuffer:G,destroyFramebuffer:nt}=$M(e);let at;try{const J=C,mt=f||G.width,Mt=m||G.height,pt=UM(G.colorAttachments[0].texture.props.format),Pt=pt.format,kt=pt.type;i.gl.bindBuffer(35051,J.handle),at=i.gl.bindFramebuffer(36160,G.handle),i.gl.readPixels(w[0],w[1],mt,Mt,Pt,kt,P)}finally{i.gl.bindBuffer(35051,null),at!==void 0&&i.gl.bindFramebuffer(36160,at),nt&&G.destroy()}}function d8(i,t){const{sourceTexture:e,destinationMipLevel:n=0,origin:a=[0,0],destinationOrigin:f=[0,0],destinationTexture:m}=t;let{width:l=t.destinationTexture.width,height:w=t.destinationTexture.height}=t;const{framebuffer:C,destroyFramebuffer:P}=$M(e),[L,j]=a,[G,nt,at]=f,J=i.gl.bindFramebuffer(36160,C.handle);let mt,Mt;if(m instanceof gy)mt=m,l=Number.isFinite(l)?l:mt.width,w=Number.isFinite(w)?w:mt.height,mt._bind(0),Mt=mt.glTarget;else throw new Error("invalid destination");switch(Mt){case 3553:case 34067:i.gl.copyTexSubImage2D(Mt,n,G,nt,L,j,l,w);break;case 35866:case 32879:i.gl.copyTexSubImage3D(Mt,n,G,nt,at,L,j,l,w);break}mt&&mt._unbind(),i.gl.bindFramebuffer(36160,J),P&&C.destroy()}function $M(i){if(i instanceof ms){const{width:t,height:e,id:n}=i;return{framebuffer:i.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:e,colorAttachments:[i]}),destroyFramebuffer:!0}}return{framebuffer:i,destroyFramebuffer:!1}}const p8=[1,2,4,8];class m8 extends wp{device;handle=null;glParameters={};constructor(t,e){super(t,e),this.device=t;let n;if(!e?.parameters?.viewport)if(e?.framebuffer){const{width:f,height:m}=e.framebuffer;n=[0,0,f,m]}else{const[f,m]=t.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,f,m]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const a=this.props.framebuffer;if(this.props.framebuffer&&a?.handle){const f=this.props.framebuffer.colorAttachments.map((m,l)=>36064+l);this.device.gl.drawBuffers(f)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const e={...this.glParameters};e.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(e.depthMask=!this.props.depthReadOnly),e.stencilMask=this.props.stencilReadOnly?0:1,e[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(e.viewport=t.viewport.slice(0,4),e.depthRange=[t.viewport[4],t.viewport[5]]):e.viewport=t.viewport),t.scissorRect&&(e.scissorTest=!0,e.scissor=t.scissorRect),t.blendConstant&&(e.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=t.stencilReference),"colorMask"in t&&(e.colorMask=p8.map(n=>!!(n&t.colorMask))),this.glParameters=e,Kg(this.device.gl,e)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let e=0;this.props.clearColors&&this.props.clearColors.forEach((n,a)=>{n&&this.clearColorBuffer(a,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(e|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(e|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(e|=1024,t.clearStencil=this.props.clearStencil),e!==0&&Cy(this.device.gl,t,()=>{this.device.gl.clear(e)})}clearColorBuffer(t=0,e=[0,0,0,0]){Cy(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,e);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,e);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,e);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class MA extends Sw{device;handle=null;commandBuffer;constructor(t,e){super(t,e),this.device=t,this.commandBuffer=new c8(t)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(t){return new m8(this.device,t)}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,e,n){}}function g8(i){const{target:t,source:e,start:n=0,count:a=1}=i,f=e.length,m=a*f;let l=0;for(let w=n;l<f;l++)t[w++]=e[l];for(;l<m;)l<m-l?(t.copyWithin(n+l,n,n+l),l*=2):(t.copyWithin(n+l,n,n+m-l),l=m);return i.target}class iT extends Ew{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return OO()==="Chrome"}constructor(t,e){super(t,e),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const e=t;if(e&&e.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,e?e.handle:null),this.indexBuffer=e,this.device.gl.bindVertexArray(null)}setBuffer(t,e){const n=e;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:a,type:f,stride:m,offset:l,normalized:w,integer:C,divisor:P}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),C?this.device.gl.vertexAttribIPointer(t,a,f,m,l):this.device.gl.vertexAttribPointer(t,a,f,w,m,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,P||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,e){this._enable(t,!1),this.attributes[t]=e}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const e=this.attributes[t];ArrayBuffer.isView(e)&&this.device.setConstantAttributeWebGL(t,e)}}_getAccessor(t){const e=this.attributeInfos[t];if(!e)throw new Error(`Unknown attribute location ${t}`);const n=zM(e.bufferDataType);return{size:e.bufferComponents,type:n,stride:e.byteStride,offset:e.byteOffset,normalized:e.normalized,integer:e.integer,divisor:e.stepMode==="instance"?1:0}}_enable(t,e=!0){const a=iT.isConstantAttributeZeroSupported(this.device)||t!==0;(e||a)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),e?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,e){const n=_8(e),a=n.byteLength*t,f=n.length*t;if(this.buffer&&a!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${a} !== ${this.buffer.byteLength}.`);let m=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:a}),m||=!y8(n,this.bufferValue),m){const l=EF(e.constructor,f);g8({target:l,source:n,start:0,count:f}),this.buffer.write(l),this.bufferValue=e}return this.buffer}}function _8(i){return Array.isArray(i)?new Float32Array(i):i}function y8(i,t){if(!i||!t||i.length!==t.length||i.constructor!==t.constructor)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}class v8 extends Cw{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,e){super(t,e),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,e.buffers&&this.setBuffers(e.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(a8(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])})}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:a,byteLength:f,byteOffset:m}=this._getBufferRange(e);if(n<0){this.unusedBuffers[t]=a,Se.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:a,byteLength:f,byteOffset:m},this.bindOnUse||this._bindBuffer(n,a,m,f)}getBuffer(t){if(RA(t))return this.buffers[t]||null;const e=this._getVaryingIndex(t);return e>=0?this.buffers[e]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let e;return this._bound?e=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,e=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),e}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof my)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:e,byteOffset:n=0,byteLength:a=t.buffer.byteLength}=t;return{buffer:e,byteOffset:n,byteLength:a}}_getVaryingIndex(t){if(RA(t))return Number(t);for(const e of this.layout.varyings||[])if(t===e.name)return e.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:e,byteLength:n,byteOffset:a}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),e,a,n)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,e,n=0,a){const f=e&&e.handle;!f||a===void 0?this.gl.bindBufferBase(35982,t,f):this.gl.bindBufferRange(35982,t,f,n,a)}}function RA(i){return typeof i=="number"?Number.isInteger(i):/^\d+$/.test(i)}class b8 extends Mw{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,e){if(super(t,e),this.device=t,e.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,a)=>{const f=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(f)};requestAnimationFrame(f)}),this._pollingPromise}}function HM(i){switch(i){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function x8(i){switch(i){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function w8(i){return T8[i]}const T8={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function S8(i,t){const{sourceX:e=0,sourceY:n=0,sourceAttachment:a=0}=t||{};let{target:f=null,sourceWidth:m,sourceHeight:l,sourceDepth:w,sourceFormat:C,sourceType:P}=t||{};const{framebuffer:L,deleteFramebuffer:j}=WM(i),{gl:G,handle:nt}=L;m||=L.width,l||=L.height;const at=L.colorAttachments[a]?.texture;if(!at)throw new Error(`Invalid framebuffer attachment ${a}`);w=at?.depth||1,C||=at?.glFormat||6408,P||=at?.glType||5121,f=C8(f,P,C,m,l);const J=bw(f);P=P||XV(J);const mt=G.bindFramebuffer(36160,nt);return G.readBuffer(36064+a),G.readPixels(e,n,m,l,C,P,f),G.readBuffer(36064),G.bindFramebuffer(36160,mt||null),j&&L.destroy(),f}function A8(i,t){const{target:e,sourceX:n=0,sourceY:a=0,sourceFormat:f=6408,targetByteOffset:m=0}=t||{};let{sourceWidth:l,sourceHeight:w,sourceType:C}=t||{};const{framebuffer:P,deleteFramebuffer:L}=WM(i);l=l||P.width,w=w||P.height;const j=P;C=C||5121;let G=e;if(!G){const at=HM(f),J=x8(C),mt=m+l*w*at*J;G=j.device.createBuffer({byteLength:mt})}const nt=i.device.createCommandEncoder();return nt.copyTextureToBuffer({sourceTexture:i,width:l,height:w,origin:[n,a],destinationBuffer:G,byteOffset:m}),nt.destroy(),L&&P.destroy(),G}function WM(i){return i instanceof Kb?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:E8(i),deleteFramebuffer:!0}}function E8(i,t){const{device:e,width:n,height:a,id:f}=i;return e.createFramebuffer({...t,id:`framebuffer-for-${f}`,width:n,height:a,colorAttachments:[i]})}function C8(i,t,e,n,a,f){if(i)return i;t||=5121;const m=w8(t),l=xw(m),w=HM(e);return new l(n*a*w)}class S1 extends Bp{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(t){switch(t){case"unorm8x4-bgra":return!1;default:return!0}}constructor(t){super({...t,id:t.id||kV("webgl-device")});const e=Bp._getCanvasContextProps(t);if(!e)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=e.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new DV(this,e),this.lost=new Promise(P=>{this._resolveContextLost=P});const a={...t.webgl};e.alphaMode==="premultiplied"&&(a.premultipliedAlpha=!0),t.powerPreference!==void 0&&(a.powerPreference=t.powerPreference);const m=this.props._handle||fV(this.canvasContext.canvas,{onContextLost:P=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:P=>console.log("WebGL context restored")},a);if(!m)throw new Error("WebGL context creation failed");if(n=m.device,n){if(t._reuseDevices)return Se.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=m,this.gl=m,this.spectorJS=Z5({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=dV(this.gl,this._extensions),this.limits=new RV(this.gl),this.features=new MV(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new kp(this.gl,{log:(...P)=>Se.log(1,...P)()}).trackState(this.gl,{copyState:!1});const w=t.debugWebGL||t.debug,C=t.debugWebGL;w&&(this.gl=K5(this.gl,{debugWebGL:w,traceWebGL:C}),Se.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(Se.level=Math.max(Se.level,1))),this.commandEncoder=new MA(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const e=this._normalizeBufferProps(t);return new my(this,e)}createTexture(t){return new gy(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new HV(this,t)}createShader(t){return new FV(this,t)}createFramebuffer(t){return new py(this,t)}createVertexArray(t){return new iT(this,t)}createTransformFeedback(t){return new v8(this,t)}createQuerySet(t){return new b8(this,t)}createRenderPipeline(t){return new o8(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(t={}){return new MA(this,t)}submit(t){t||(t=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),t._executeCommands()}readPixelsToArrayWebGL(t,e){return S8(t,e)}readPixelsToBufferWebGL(t,e){return A8(t,e)}setParametersWebGL(t){Kg(this.gl,t)}getParametersWebGL(t){return FM(this.gl,t)}withParametersWebGL(t,e){return Cy(this.gl,t,e)}resetWebGL(){Se.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),oV(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return SV(this.gl,t,this._extensions)}loseDevice(){let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){kp.get(this.gl).push()}popState(){kp.get(this.gl).pop()}getGLKey(t,e){const n=Number(t);for(const a in this.gl)if(this.gl[a]===n)return`GL.${a}`;return e?.emptyIfUnknown?"":String(t)}getGLKeys(t){const e={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[a,f])=>(n[`${a}:${this.getGLKey(a,e)}`]=`${f}:${this.getGLKey(f,e)}`,n),{})}setConstantAttributeWebGL(t,e){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const a=this._constants[t];switch(a&&I8(a,e)&&Se.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=e,e.constructor){case Float32Array:M8(this,t,e);break;case Int32Array:R8(this,t,e);break;case Uint32Array:P8(this,t,e);break;default:throw new Error("constant")}}getExtension(t){return qg(this.gl,t,this._extensions),this._extensions}_setWebGLDebugMetadata(t,e,n){t.luma=e;const a={props:n.spector,id:n.spector.id};t.__SPECTOR_Metadata=a}}function M8(i,t,e){switch(e.length){case 1:i.gl.vertexAttrib1fv(t,e);break;case 2:i.gl.vertexAttrib2fv(t,e);break;case 3:i.gl.vertexAttrib3fv(t,e);break;case 4:i.gl.vertexAttrib4fv(t,e);break}}function R8(i,t,e){i.gl.vertexAttribI4iv(t,e)}function P8(i,t,e){i.gl.vertexAttribI4uiv(t,e)}function I8(i,t){if(!i||!t||i.length!==t.length||i.constructor!==t.constructor)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}const PA=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:S1},Symbol.toStringTag,{value:"Module"}));function Uf(){}const D8=({isDragging:i})=>i?"grabbing":"grab",qM={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Uf,onWebGLInitialized:Uf,onResize:Uf,onViewStateChange:Uf,onInteractionStateChange:Uf,onBeforeRender:Uf,onAfterRender:Uf,onLoad:Uf,onError:i=>on.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:D8,getTooltip:null,debug:!1,drawPickingColors:!1};class nT{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new qb({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:a}=this;if(n.type==="pointerleave")a.x=-1,a.y=-1,a.radius=0;else{if(n.leftButton||n.rightButton)return;{const f=n.offsetCenter;if(!f)return;a.x=f.x,a.y=f.y,a.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:a.x,y:a.y}),a.event=n},this._onEvent=n=>{const a=d1[n.type],f=n.offsetCenter;if(!a||!f||!this.layerManager)return;const m=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:f.x,y:f.y,layers:m,viewports:this.getViewports(f)},this._lastPointerDownInfo),{layer:w}=l,C=w&&(w[a]||w.props[a]),P=this.props[a];let L=!1;C&&(L=C.call(w,l,n)),L||(P?.(l,n),this.widgetManager.onEvent(l,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const a=n.offsetCenter,f=this._pick("pickObject","pickObject Time",{x:a.x,y:a.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=f.result[0]||f.emptyInfo},this.props={...qM,...t},t=this.props,t.viewState&&t.initialViewState&&on.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let e=this.device;!e&&t.gl&&(t.gl instanceof WebGLRenderingContext&&on.error("WebGL1 context not supported.")(),e=yx.attach(t.gl,this.props.deviceProps)),e||(e=this._createDevice(t)),this.animationLoop=this._createAnimationLoop(e,t),this.setProps(t),t._typedArrayManagerProps&&Ey.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&on.removed("onLayerHover","onHover")(),"onLayerClick"in t&&on.removed("onLayerClick","onClick")(),t.initialViewState&&!Pl(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);if(Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),t.device&&t.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==t.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),on.log(`recreating animation loop for new device! id=${t.device.id}`)(),this.animationLoop=this._createAnimationLoop(t.device,t),this.animationLoop.start()),this.animationLoop?.setProps(e),t.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=t.useDevicePixels;const n=this.device.canvasContext.canvas,a={target:n,contentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],devicePixelContentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],borderBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}]};this.device.canvasContext._handleResize([a])}this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e),this.widgetManager.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),a=this.layerManager.needsRedraw(t),f=this.effectManager.needsRedraw(t),m=this.deckRenderer.needsRedraw(t);return e=e||n||a||f||m,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return ra(this.viewManager),this.viewManager.views}getViewports(t){return ra(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,e,n){ra(this.deckPicker);const{stats:a}=this;a.get("Pick Count").incrementCount(),a.get(e).timeStart();const f=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return a.get(e).timeEnd(),f}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),ra(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",t.width&&typeof t.width=="number"&&(e.width=t.width),t.height&&typeof t.height=="number"&&(e.height=t.height),(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||e===0){const a=Number.isFinite(e)?`${e}px`:e;this.canvas.style.width=a}if(n||n===0){const a=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const e=t.clientWidth??t.width,n=t.clientHeight??t.height;(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.viewManager?.setProps({width:e,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:e,height:n}))}_createAnimationLoop(t,e){const{gl:n,onError:a}=e;return new Ww({device:t,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:f=>this._setDevice(f.device),onRender:this._onRenderFrame.bind(this),onError:a})}_createDevice(t){const e=this.props.deviceProps?.createCanvasContext,n=typeof e=="object"?e:void 0,a={adapters:[],...t.deviceProps};a.adapters.includes(yx)||a.adapters.push(yx);const f={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return n1.createDevice({_reuseDevices:!0,type:"webgl",...a,createCanvasContext:{...f,...n,canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,e=Array.isArray(t)?t:t?[t]:[new kM({id:"default-view"})];return e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:t}=this;if(t.event){const{result:e,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=e.length>0;let a=n,f=!1;for(const m of e)a=m,f=m.layer?.onHover(m,t.event)||f;f||(this.props.onHover?.(a,t.event),this.widgetManager.onHover(a,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const e=new MM;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new f6(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(WS).map(a=>{const[f,m,l,w]=WS[a],C=this.props.eventRecognizerOptions?.[a],P={...m,...C,event:a};return{recognizer:new f(P),recognizeWith:l,requestFailure:w}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in d1)this.eventManager.on(a,this._onEvent);this.viewManager=new u5({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new c5(this.device,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new E5({deck:this,device:this.device}),this.deckRenderer=new R5(this.device),this.deckPicker=new D5(this.device),this.widgetManager=new B5({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new OM),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{device:n,gl:a}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:a});const f={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e};this.deckRenderer?.renderLayers(f),f.pass==="screen"&&this.widgetManager.onRedraw({viewports:f.viewports,layers:f.layers}),this.props.onAfterRender({device:n,gl:a})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),on.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=n1.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}nT.defaultProps=qM;nT.VERSION=eL;function k8(i){switch(i){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return xw(i)}}const O8=bw;function Qv(i,t,e){const n=e==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:i,format:t.size>1?`${n}x${t.size}`:t.type,byteOffset:t.offset||0}}function Cp(i){return i.stride||i.size*i.bytesPerElement}function B8(i,t){return i.type===t.type&&i.size===t.size&&Cp(i)===Cp(t)&&(i.offset||0)===(t.offset||0)}function A1(i,t){t.offset&&on.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=Cp(i),n=t.vertexOffset!==void 0?t.vertexOffset:i.vertexOffset||0,a=t.elementOffset||0,f=n*e+a*i.bytesPerElement+(i.offset||0);return{...t,offset:f,stride:e}}function L8(i,t){const e=A1(i,t);return{high:e,low:{...e,offset:e.offset+i.size*4}}}class F8{constructor(t,e,n){this._buffer=null,this.device=t,this.id=e.id||"",this.size=e.size||1;const a=e.logicalType||e.type,f=a==="float64";let{defaultValue:m}=e;m=Number.isFinite(m)?[m]:m||new Array(this.size).fill(0);let l;f?l="float32":!a&&e.isIndexed?l="uint32":l=a||"float32";let w=k8(a||l);this.doublePrecision=f,f&&e.fp64===!1&&(w=Float32Array),this.value=null,this.settings={...e,defaultType:w,defaultValue:m,logicalType:a,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:w.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Cp(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ey.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,e=null){const n={};if(this.state.constant){const a=this.value;if(e){const f=A1(this.getAccessor(),e),m=f.offset/a.BYTES_PER_ELEMENT,l=f.size||this.size;n[t]=a.subarray(m,m+l)}else n[t]=a}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,e=null){const n=this.getAccessor(),a=[],f={name:this.id,byteStride:Cp(n),attributes:a};if(this.doublePrecision){const m=L8(n,e||{});a.push(Qv(t,{...n,...m.high},this.device.type),Qv(`${t}64Low`,{...n,...m.low},this.device.type))}else if(e){const m=A1(n,e);a.push(Qv(t,{...n,...m},this.device.type))}else a.push(Qv(t,n,this.device.type));return f}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:a}=this,f=n*a;if(e&&f&&e.length>=f){const m=new Array(a).fill(1/0),l=new Array(a).fill(-1/0);for(let w=0;w<f;)for(let C=0;C<a;C++){const P=e[w++];P<m[C]&&(m[C]=P),P>l[C]&&(l[C]=P)}t=[m,l]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof Un?n={buffer:t}:n=t;const a={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)a.type="float32";else{const m=O8(n.value);a.type=a.normalized?m.replace("int","norm"):m}a.bytesPerElement=n.value.BYTES_PER_ELEMENT,a.stride=Cp(a)}if(e.bounds=null,n.constant){let f=n.value;if(f=this._normalizeValue(f,[],0),this.settings.normalized&&(f=this.normalizeConstant(f)),!(!e.constant||!this._areValuesEqual(f,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=ArrayBuffer.isView(f)?f:new Float32Array(f)}else if(n.buffer){const f=n.buffer;e.externalBuffer=f,e.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let f=n.value;e.externalBuffer=null,e.constant=!1,this.value=f;let{buffer:m}=this;const l=Cp(a),w=(a.vertexOffset||0)*l;if(this.doublePrecision&&f instanceof Float64Array&&(f=fx(f,a)),this.settings.isIndexed){const P=this.settings.defaultType;f.constructor!==P&&(f=new P(f))}const C=f.byteLength+w+l*2;(!m||m.byteLength<C)&&(m=this._createBuffer(C)),m.write(f,w)}return this.setAccessor(a),!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:a}=t;this.buffer.write(this.doublePrecision&&e instanceof Float64Array?fx(e,{size:this.size,startIndex:n,endIndex:a}):e.subarray(n,a),n*e.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,e=!1){const{state:n}=this,a=n.allocatedValue,f=Ey.allocate(a,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=f;const{byteOffset:m}=this;let{buffer:l}=this;return(!l||l.byteLength<f.byteLength+m)&&(l=this._createBuffer(f.byteLength+m),e&&a&&l.write(a instanceof Float64Array?fx(a,this):a,m)),n.allocatedValue=f,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let a=!1;if(this.doublePrecision&&(a=e.BYTES_PER_ELEMENT<4),a)throw new Error(`Attribute ${this.id} does not support ${e.constructor.name}`);!(e instanceof n)&&this.settings.normalized&&!("normalized"in t)&&on.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(e=>e/255);case"unorm16":return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:a,size:f}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let m=f;for(;--m>=0;)e[n+m]=a[m];return e}switch(f){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:a[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:a[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:a[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:a[0];break;default:let m=f;for(;--m>=0;)e[n+m]=Number.isFinite(t[m])?t[m]:a[m]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let a=0;a<n;a++)if(t[a]!==e[a])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();const{isIndexed:e,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(e?Un.INDEX:Un.VERTEX)|Un.COPY_DST,indexType:e?n:void 0,byteLength:t}),this._buffer}}const IA=[],DA=[];function rT(i,t=0,e=1/0){let n=IA;const a={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?n=i:i.length>0&&(DA.length=i.length,n=DA):n=IA,(t>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,e),a.index=t-1),{iterable:n,objectInfo:a}}function XM(i){return i&&i[Symbol.asyncIterator]}function N8(i,t){const{size:e,stride:n,offset:a,startIndices:f,nested:m}=t,l=i.BYTES_PER_ELEMENT,w=n?n/l:e,C=a?a/l:0,P=Math.floor((i.length-C)/w);return(L,{index:j,target:G})=>{if(!f){const mt=j*w+C;for(let Mt=0;Mt<e;Mt++)G[Mt]=i[mt+Mt];return G}const nt=f[j],at=f[j+1]||P;let J;if(m){J=new Array(at-nt);for(let mt=nt;mt<at;mt++){const Mt=mt*w+C;G=new Array(e);for(let pt=0;pt<e;pt++)G[pt]=i[Mt+pt];J[mt-nt]=G}}else if(w===e)J=i.subarray(nt*e+C,at*e+C);else{J=new i.constructor((at-nt)*e);let mt=0;for(let Mt=nt;Mt<at;Mt++){const pt=Mt*w+C;for(let Pt=0;Pt<e;Pt++)J[mt++]=i[pt+Pt]}}return J}}const z8=[],hb=[[0,1/0]];function U8(i,t){if(i===hb||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return i;const e=[],n=i.length;let a=0;for(let f=0;f<n;f++){const m=i[f];m[1]<t[0]?(e.push(m),a=f+1):m[0]>t[1]?e.push(m):t=[Math.min(m[0],t[0]),Math.max(m[1],t[1])]}return e.splice(a,0,t),e}const V8={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function ZM(i,t){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const e=i.type||"interpolation";return{...V8[e],...t,...i,type:e}}class GM extends F8{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:hb}),this.constant=!1,this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var e;(e=this.state).layoutChanged||(e.layoutChanged=!B8(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,a=Array.isArray(e)?t[e.find(f=>t[f])]:t[e];return ZM(a,n)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:n=0,endRow:a=1/0}=e;this.state.updateRanges=U8(this.state.updateRanges,[n,a])}else this.state.updateRanges=hb}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=z8}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,e.updateRanges!==hb),!0):!1}updateBuffer({numInstances:t,data:e,props:n,context:a}){if(!this.needsUpdate())return!1;const{state:{updateRanges:f},settings:{update:m,noAlloc:l}}=this;let w=!0;if(m){for(const[C,P]of f)m.call(a,this,{data:e,startRow:C,endRow:P,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[C,P]of f){const L=Number.isFinite(C)?this.getVertexOffset(C):0,j=Number.isFinite(P)?this.getVertexOffset(P):l||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:L,endOffset:j})}this._checkAttributeArray()}else w=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),w}setConstantValue(t,e){const n=this.device.type==="webgpu";if(n||e===void 0||typeof e=="function"){if(n&&typeof e!="function"){const m=this._normalizeValue(e,[],0);this._areValuesEqual(m,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const a=this.settings.transform&&t?this.settings.transform.call(t,e):e;return this.setData({constant:!0,value:a})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:n,settings:a}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(a.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),a.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const m=t;ra(ArrayBuffer.isView(m.value),`invalid ${a.accessor}`);const l=!!m.size&&m.size!==this.size;return n.binaryAccessor=N8(m.value,{size:m.size||this.size,stride:m.stride,offset:m.offset,startIndices:e,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,e=super.getValue();if(!t)return e;for(const n in t)Object.assign(e,super.getValue(n,t[n]));return e}getBufferLayout(t){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:a}=this.settings;if(a==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=a??"vertex",!e)return n;for(const f in e){const m=super._getBufferLayout(f,e[f]);n.attributes.push(...m.attributes)}return n}_autoUpdater(t,{data:e,startRow:n,endRow:a,props:f,numInstances:m}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:w,value:C,size:P,startIndices:L}=t,{accessor:j,transform:G}=l;let nt=w.binaryAccessor||(typeof j=="function"?j:f[j]);typeof nt!="function"&&typeof j=="string"&&(nt=()=>f[j]),ra(typeof nt=="function",`accessor "${j}" is not a function`);let at=t.getVertexOffset(n);const{iterable:J,objectInfo:mt}=rT(e,n,a);for(const Mt of J){mt.index++;let pt=nt(Mt,mt);if(G&&(pt=G.call(this,pt)),L){const Pt=(mt.index<L.length-1?L[mt.index+1]:m)-L[mt.index];if(pt&&Array.isArray(pt[0])){let kt=at;for(const $t of pt)t._normalizeValue($t,C,kt),kt+=P}else pt&&pt.length>P?C.set(pt,at):(t._normalizeValue(pt,mt.target,0),r5({target:C,source:mt.target,start:at,count:Pt}));at+=Pt*P}else t._normalizeValue(pt,C,at),at+=P}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Tx(i){const{source:t,target:e,start:n=0,size:a,getData:f}=i,m=i.end||e.length,l=t.length,w=m-n;if(l>w){e.set(t.subarray(0,w),n);return}if(e.set(t,n),!f)return;let C=l;for(;C<w;){const P=f(C,t);for(let L=0;L<a;L++)e[n+C]=P[L]||0,C++}}function j8({source:i,target:t,size:e,getData:n,sourceStartIndices:a,targetStartIndices:f}){if(!a||!f)return Tx({source:i,target:t,size:e,getData:n}),t;let m=0,l=0;const w=n&&((P,L)=>n(P+l,L)),C=Math.min(a.length,f.length);for(let P=1;P<C;P++){const L=a[P]*e,j=f[P]*e;Tx({source:i.subarray(m,L),target:t,start:l,end:j,size:e,getData:w}),m=L,l=j}return l<t.length&&Tx({source:[],target:t,start:l,size:e,getData:w}),t}function $8(i){const{device:t,settings:e,value:n}=i,a=new GM(t,e);return a.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:e.normalized}),a}function YM(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${i}"`)}}function KM(i){switch(i){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function QM(i){i.push(i.shift())}function H8(i,t){const{doublePrecision:e,settings:n,value:a,size:f}=i,m=e&&a instanceof Float64Array?2:1;let l=0;const{shaderAttributes:w}=i.settings;if(w)for(const C of Object.values(w))l=Math.max(l,C.vertexOffset??0);return(n.noAlloc?a.length:(t+l)*f)*m}function JM({device:i,source:t,target:e}){return(!e||e.byteLength<t.byteLength)&&(e?.destroy(),e=i.createBuffer({byteLength:t.byteLength,usage:t.usage})),e}function tR({device:i,buffer:t,attribute:e,fromLength:n,toLength:a,fromStartIndices:f,getData:m=l=>l}){const l=e.doublePrecision&&e.value instanceof Float64Array?2:1,w=e.size*l,C=e.byteOffset,P=e.settings.bytesPerElement<4?C/e.settings.bytesPerElement*4:C,L=e.startIndices,j=f&&L,G=e.isConstant;if(!j&&t&&n>=a)return t;const nt=e.value instanceof Float64Array?Float32Array:e.value.constructor,at=G?e.value:new nt(e.getBuffer().readSyncWebGL(C,a*nt.BYTES_PER_ELEMENT).buffer);if(e.settings.normalized&&!G){const pt=m;m=(Pt,kt)=>e.normalizeConstant(pt(Pt,kt))}const J=G?(pt,Pt)=>m(at,Pt):(pt,Pt)=>m(at.subarray(pt+C,pt+C+w),Pt),mt=t?new Float32Array(t.readSyncWebGL(P,n*4).buffer):new Float32Array(0),Mt=new Float32Array(a);return j8({source:mt,target:Mt,sourceStartIndices:f,targetStartIndices:L,size:w,getData:J}),(!t||t.byteLength<Mt.byteLength+P)&&(t?.destroy(),t=i.createBuffer({byteLength:Mt.byteLength+P,usage:35050})),t.write(Mt,P),t}class eR{constructor({device:t,attribute:e,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Jb(n),this.attribute=e,this.attributeInTransition=$8(e),this.currentStartIndices=e.startIndices}get inProgress(){return this.transition.inProgress}start(t,e,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=H8(this.attribute,e),this.transition.start({...t,duration:n})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class W8 extends eR{constructor({device:t,attribute:e,timeline:n}){super({device:t,attribute:e,timeline:n}),this.type="interpolation",this.transform=G8(t,e)}start(t,e){const n=this.currentLength,a=this.currentStartIndices;if(super.start(t,e,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:f,attribute:m}=this;QM(f),f[0]=tR({device:this.device,buffer:f[0],attribute:m,fromLength:n,toLength:this.currentLength,fromStartIndices:a,getData:t.enter}),f[1]=JM({device:this.device,source:f[0],target:f[1]}),this.setBuffer(f[1]);const{transform:l}=this,w=l.model;let C=Math.floor(this.currentLength/m.size);iR(m)&&(C/=2),w.setVertexCount(C),m.isConstant?(w.setAttributes({aFrom:f[0]}),w.setConstantAttributes({aTo:m.value})):w.setAttributes({aFrom:f[0],aTo:m.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:f[1]})}onUpdate(){const{duration:t,easing:e}=this.settings,{time:n}=this.transition;let a=n/t;e&&(a=e(a));const{model:f}=this.transform,m={time:a};f.shaderInputs.setProps({interpolation:m}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const q8=`uniform interpolationUniforms {
  float time;
} interpolation;
`,kA={name:"interpolation",vs:q8,uniformTypes:{time:"f32"}},X8=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Z8=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function iR(i){return i.doublePrecision&&i.value instanceof Float64Array}function G8(i,t){const e=t.size,n=YM(e),a=KM(e),f=t.getBufferLayout();return iR(t)?new Hg(i,{vs:Z8,bufferLayout:[{name:"aFrom",byteStride:8*e,attributes:[{attribute:"aFrom",format:a,byteOffset:0},{attribute:"aFrom64Low",format:a,byteOffset:4*e}]},{name:"aTo",byteStride:8*e,attributes:[{attribute:"aTo",format:a,byteOffset:0},{attribute:"aTo64Low",format:a,byteOffset:4*e}]}],modules:[lz,kA],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:e},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Hg(i,{vs:X8,bufferLayout:[{name:"aFrom",format:a},{name:"aTo",format:f.attributes[0].format}],modules:[kA],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class Y8 extends eR{constructor({device:t,attribute:e,timeline:n}){super({device:t,attribute:e,timeline:n}),this.type="spring",this.texture=ij(t),this.framebuffer=nj(t,this.texture),this.transform=ej(t,e)}start(t,e){const n=this.currentLength,a=this.currentStartIndices;super.start(t,e);const{buffers:f,attribute:m}=this;for(let w=0;w<2;w++)f[w]=tR({device:this.device,buffer:f[w],attribute:m,fromLength:n,toLength:this.currentLength,fromStartIndices:a,getData:t.enter});f[2]=JM({device:this.device,source:f[0],target:f[2]}),this.setBuffer(f[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/m.size)),m.isConstant?l.setConstantAttributes({aTo:m.value}):l.setAttributes({aTo:m.getBuffer()})}onUpdate(){const{buffers:t,transform:e,framebuffer:n,transition:a}=this,f=this.settings;e.model.setAttributes({aPrev:t[0],aCur:t[1]}),e.transformFeedback.setBuffers({vNext:t[2]});const m={stiffness:f.stiffness,damping:f.damping};e.model.shaderInputs.setProps({spring:m}),e.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),QM(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||a.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const K8=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Q8={name:"spring",vs:K8,uniformTypes:{damping:"f32",stiffness:"f32"}},J8=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,tj=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function ej(i,t){const e=YM(t.size),n=KM(t.size);return new Hg(i,{vs:J8,fs:tj,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Q8],defines:{ATTRIBUTE_TYPE:e},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function ij(i){return i.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function nj(i,t){return i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const rj={interpolation:W8,spring:Y8};class sj{constructor(t,{id:e,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=e,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:n}){this.numInstances=n||1;for(const a in t){const f=t[a],m=f.getTransitionSetting(e);m&&this._updateAttribute(a,f,m)}for(const a in this.transitions){const f=t[a];(!f||!f.getTransitionSetting(e))&&this._removeTransition(a)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,e,n){const a=this.transitions[t];let f=!a||a.type!==n.type;if(f){a&&this._removeTransition(t);const m=rj[n.type];m?this.transitions[t]=new m({attribute:e,timeline:this.timeline,device:this.device}):(on.error(`unsupported transition type '${n.type}'`)(),f=!1)}(f||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const OA="attributeManager.invalidate",aj="attributeManager.updateStart",oj="attributeManager.updateEnd",lj="attribute.updateStart",cj="attribute.allocate",uj="attribute.updateEnd";class hj{constructor(t,{id:e="attribute-manager",stats:n,timeline:a}={}){this.mergeBoundsMemoized=Fy(TU),this.id=e,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new sj(t,{id:`${e}-transitions`,timeline:a}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);na(OA,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);na(OA,this,"all")}update({data:t,numInstances:e,startIndices:n=null,transitions:a,props:f={},buffers:m={},context:l={}}){let w=!1;na(aj,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const C in this.attributes){const P=this.attributes[C],L=P.settings.accessor;P.startIndices=n,P.numInstances=e,f[C]&&on.removed(`props.${C}`,`data.attributes.${C}`)(),P.setExternalBuffer(m[C])||P.setBinaryValue(typeof L=="string"?m[L]:void 0,t.startIndices)||typeof L=="string"&&!m[L]&&P.setConstantValue(l,f[L])||P.needsUpdate()&&(w=!0,this._updateAttribute({attribute:P,numInstances:e,data:t,props:f,context:l})),this.needsRedraw=this.needsRedraw||P.needsRedraw()}w&&na(oj,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:a})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const e=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:n}=this,a={...n.getAttributes()};for(const f in e){const m=e[f];m.needsRedraw(t)&&!n.hasAttribute(f)&&(a[f]=m)}return a}getBufferLayouts(t){return Object.values(this.getAttributes()).map(e=>e.getBufferLayout(t))}_add(t,e){for(const n in t){const a=t[n],f={...a,id:n,size:a.isIndexed&&1||a.size||1,...e};this.attributes[n]=new GM(this.device,f)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(a=>{t[a]||(t[a]=[]),t[a].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:a}=this,f=a[t];return f&&f.forEach(m=>{const l=n[m];l&&l.setNeedsUpdate(l.id,e)}),f}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(na(lj,e),e.constant){e.setConstantValue(t.context,e.value);return}e.allocate(n)&&na(cj,e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,na(uj,e,n))}}class fj extends Jb{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:a,easing:f}}=this,m=f(t/a);this._value=Db(e,n,m)}}const BA=1e-5;function LA(i,t,e,n,a){const f=t-i,l=(e-t)*a,w=-f*n;return l+w+f+t}function dj(i,t,e,n,a){if(Array.isArray(e)){const f=[];for(let m=0;m<e.length;m++)f[m]=LA(i[m],t[m],e[m],n,a);return f}return LA(i,t,e,n,a)}function FA(i,t){if(Array.isArray(i)){let e=0;for(let n=0;n<i.length;n++){const a=i[n]-t[n];e+=a*a}return Math.sqrt(e)}return Math.abs(i-t)}class pj extends Jb{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:a}=this.settings,{_prevValue:f=t,_currValue:m=t}=this;let l=dj(f,m,e,n,a);const w=FA(l,e),C=FA(l,m);w<BA&&C<BA&&(l=e,this.end()),this._prevValue=m,this._currValue=l}}const mj={interpolation:fj,spring:pj};class gj{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,a){const{transitions:f}=this;if(f.has(t)){const w=f.get(t),{value:C=w.settings.fromValue}=w;e=C,this.remove(t)}if(a=ZM(a),!a)return;const m=mj[a.type];if(!m){on.error(`unsupported transition type '${a.type}'`)();return}const l=new m(this.timeline);l.start({...a,fromValue:e,toValue:n}),f.set(t,l)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function _j(i){const t=i[Gf];for(const e in t){const n=t[e],{validate:a}=n;if(a&&!a(i[e],n))throw new Error(`Invalid prop ${e}: ${i[e]}`)}}function yj(i,t){const e=nR({newProps:i,oldProps:t,propTypes:i[Gf],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=bj(i,t);let a=!1;return n||(a=xj(i,t)),{dataChanged:n,propsChanged:e,updateTriggersChanged:a,extensionsChanged:wj(i,t),transitionsChanged:vj(i,t)}}function vj(i,t){if(!i.transitions)return!1;const e={},n=i[Gf];let a=!1;for(const f in i.transitions){const m=n[f],l=m&&m.type;(l==="number"||l==="color"||l==="array")&&E1(i[f],t[f],m)&&(e[f]=!0,a=!0)}return a?e:!1}function nR({newProps:i,oldProps:t,ignoreProps:e={},propTypes:n={},triggerName:a="props"}){if(t===i)return!1;if(typeof i!="object"||i===null)return`${a} changed shallowly`;if(typeof t!="object"||t===null)return`${a} changed shallowly`;for(const f of Object.keys(i))if(!(f in e)){if(!(f in t))return`${a}.${f} added`;const m=E1(i[f],t[f],n[f]);if(m)return`${a}.${f} ${m}`}for(const f of Object.keys(t))if(!(f in e)){if(!(f in i))return`${a}.${f} dropped`;if(!Object.hasOwnProperty.call(i,f)){const m=E1(i[f],t[f],n[f]);if(m)return`${a}.${f} ${m}`}}return!1}function E1(i,t,e){let n=e&&e.equal;return n&&!n(i,t,e)||!n&&(n=i&&t&&i.equals,n&&!n.call(i,t))?"changed deeply":!n&&t!==i?"changed shallowly":null}function bj(i,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:n,_dataDiff:a}=i;return n?n(i.data,t.data)||(e="Data comparator detected a change"):i.data!==t.data&&(e="A new data container was supplied"),e&&a&&(e=a(i.data,t.data)||e),e}function xj(i,t){if(t===null)return{all:!0};if("all"in i.updateTriggers&&NA(i,t,"all"))return{all:!0};const e={};let n=!1;for(const a in i.updateTriggers)a!=="all"&&NA(i,t,a)&&(e[a]=!0,n=!0);return n?e:!1}function wj(i,t){if(t===null)return!0;const e=t.extensions,{extensions:n}=i;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(let a=0;a<n.length;a++)if(!n[a].equals(e[a]))return!0;return!1}function NA(i,t,e){let n=i.updateTriggers[e];n=n??{};let a=t.updateTriggers[e];return a=a??{},nR({oldProps:a,newProps:n,triggerName:e})}const Tj="count(): argument not an object",Sj="count(): argument not a container";function Aj(i){if(!Cj(i))throw new Error(Tj);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(Ej(i))return Object.keys(i).length;throw new Error(Sj)}function Ej(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function Cj(i){return i!==null&&typeof i=="object"}function zA(i,t){if(!t)return i;const e={...i,...t};if("defines"in t&&(e.defines={...i.defines,...t.defines}),"modules"in t&&(e.modules=(i.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=e.modules.findIndex(a=>a.name==="project32");n>=0&&e.modules.splice(n,1)}if("inject"in t)if(!i.inject)e.inject=t.inject;else{const n={...i.inject};for(const a in t.inject)n[a]=(n[a]||"")+t.inject[a];e.inject=n}return e}const Mj={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},C1={};function Rj(i,t,e,n){if(e instanceof ms)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let a=null;e.compressed&&(a={minFilter:"linear",mipmapFilter:e.data.length>1?"nearest":"linear"});const{width:f,height:m}=e.data,l=t.createTexture({...e,sampler:{...Mj,...a,...n},mipLevels:t.getMipLevelCount(f,m)});return l.generateMipmapsWebGL(),C1[l.id]=i,l}function Pj(i,t){!t||!(t instanceof ms)||C1[t.id]===i&&(t.delete(),delete C1[t.id])}const Ij={boolean:{validate(i,t){return!0},equal(i,t,e){return!!i==!!t}},number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},color:{validate(i,t){return t.optional&&!i||M1(i)&&(i.length===3||i.length===4)},equal(i,t,e){return Pl(i,t,1)}},accessor:{validate(i,t){const e=zb(i);return e==="function"||e===zb(t.value)},equal(i,t,e){return typeof t=="function"?!0:Pl(i,t,1)}},array:{validate(i,t){return t.optional&&!i||M1(i)},equal(i,t,e){const{compare:n}=e,a=Number.isInteger(n)?n:n?1:0;return n?Pl(i,t,a):i===t}},object:{equal(i,t,e){if(e.ignore)return!0;const{compare:n}=e,a=Number.isInteger(n)?n:n?1:0;return n?Pl(i,t,a):i===t}},function:{validate(i,t){return t.optional&&!i||typeof i=="function"},equal(i,t,e){return!e.compare&&e.ignore!==!1||i===t}},data:{transform:(i,t,e)=>{if(!i)return i;const{dataTransform:n}=e.props;return n?n(i):typeof i.shape=="string"&&i.shape.endsWith("-table")&&Array.isArray(i.data)?i.data:i}},image:{transform:(i,t,e)=>{const n=e.context;return!n||!n.device?null:Rj(e.id,n.device,i,{...t.parameters,...e.props.textureParameters})},release:(i,t,e)=>{Pj(e.id,i)}}};function Dj(i){const t={},e={},n={};for(const[a,f]of Object.entries(i)){const m=f?.deprecatedFor;if(m)n[a]=Array.isArray(m)?m:[m];else{const l=kj(a,f);t[a]=l,e[a]=l.value}}return{propTypes:t,defaultProps:e,deprecatedProps:n}}function kj(i,t){switch(zb(t)){case"object":return Y_(i,t);case"array":return Y_(i,{type:"array",value:t,compare:!1});case"boolean":return Y_(i,{type:"boolean",value:t});case"number":return Y_(i,{type:"number",value:t});case"function":return Y_(i,{type:"function",value:t,compare:!0});default:return{name:i,type:"unknown",value:t}}}function Y_(i,t){return"type"in t?{name:i,...Ij[t.type],...t}:"value"in t?{name:i,type:zb(t.value),...t}:{name:i,type:"object",value:t}}function M1(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function zb(i){return M1(i)?"array":i===null?"null":typeof i}function Oj(i,t){let e;for(let f=t.length-1;f>=0;f--){const m=t[f];"extensions"in m&&(e=m.extensions)}const n=R1(i.constructor,e),a=Object.create(n);a[Nb]=i,a[Up]={},a[Xf]={};for(let f=0;f<t.length;++f){const m=t[f];for(const l in m)a[l]=m[l]}return Object.freeze(a),a}const Bj="_mergedDefaultProps";function R1(i,t){if(!(i instanceof t0.constructor))return{};let e=Bj;if(t)for(const a of t){const f=a.constructor;f&&(e+=`:${f.extensionName||f.name}`)}const n=rR(i,e);return n||(i[e]=Lj(i,t||[]))}function Lj(i,t){if(!i.prototype)return null;const n=Object.getPrototypeOf(i),a=R1(n),f=rR(i,"defaultProps")||{},m=Dj(f),l=Object.assign(Object.create(null),a,m.defaultProps),w=Object.assign(Object.create(null),a?.[Gf],m.propTypes),C=Object.assign(Object.create(null),a?.[_x],m.deprecatedProps);for(const P of t){const L=R1(P.constructor);L&&(Object.assign(l,L),Object.assign(w,L[Gf]),Object.assign(C,L[_x]))}return Fj(l,i),zj(l,w),Nj(l,C),l[Gf]=w,l[_x]=C,t.length===0&&!sT(i,"_propTypes")&&(i._propTypes=w),l}function Fj(i,t){const e=Vj(t);Object.defineProperties(i,{id:{writable:!0,value:e}})}function Nj(i,t){for(const e in t)Object.defineProperty(i,e,{enumerable:!1,set(n){const a=`${this.id}: ${e}`;for(const f of t[e])sT(this,f)||(this[f]=n);on.deprecated(a,t[e].join("/"))()}})}function zj(i,t){const e={},n={};for(const a in t){const f=t[a],{name:m,value:l}=f;f.async&&(e[m]=l,n[m]=Uj(m))}i[Og]=e,i[Up]={},Object.defineProperties(i,n)}function Uj(i){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||XM(t)?this[Up][i]=t:this[Xf][i]=t},get(){if(this[Xf]){if(i in this[Xf])return this[Xf][i]||this[Og][i];if(i in this[Up]){const t=this[Nb]&&this[Nb].internalState;if(t&&t.hasAsyncProp(i))return t.getAsyncProp(i)||this[Og][i]}}return this[Og][i]}}}function sT(i,t){return Object.prototype.hasOwnProperty.call(i,t)}function rR(i,t){return sT(i,t)&&i[t]}function Vj(i){const t=i.componentName;return t||on.warn(`${i.name}.componentName not specified`)(),t||i.name}let jj=0;class t0{constructor(...t){this.props=Oj(this,t),this.id=this.props.id,this.count=jj++}clone(t){const{props:e}=this,n={};for(const a in e[Og])a in e[Xf]?n[a]=e[Xf][a]:a in e[Up]&&(n[a]=e[Up][a]);return new this.constructor({...e,...n,...t})}}t0.componentName="Component";t0.defaultProps={};const $j=Object.freeze({});class Hj{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||$j}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[Nb]||this.component;const e=t[Xf]||{},n=t[Up]||t,a=t[Og]||{};for(const f in e){const m=e[f];this._createAsyncPropData(f,a[f]),this._updateAsyncProp(f,m),e[f]=this.getAsyncProp(f)}for(const f in n){const m=n[f];this._createAsyncPropData(f,a[f]),this._updateAsyncProp(f,m)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(XM(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e===n.resolvedValue||e===n.lastValue?!1:(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const a=this.asyncProps[t];a&&n>=a.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=e,a.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const a=n.pendingLoadCount;e.then(f=>{this.component&&(f=this._postProcessValue(n,f),this._setAsyncPropValue(t,f,a),this._onResolve(t,f))}).catch(f=>{this._onError(t,f)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const a=n.pendingLoadCount;let f=[],m=0;for await(const l of e){if(!this.component)return;const{dataTransform:w}=this.component.props;w?f=w(l,f):f=f.concat(l),Object.defineProperty(f,"__diff",{enumerable:!1,value:[{startRow:m,endRow:f.length}]}),m=f.length,this._setAsyncPropValue(t,f,a)}this._onResolve(t,f)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const a=this.component&&this.component.props[Gf];this.asyncProps[t]={type:a&&a[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class Wj extends Hj{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,a=n?.props.fetch;return a?a(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const a=n.props.onDataLoad;t==="data"&&a&&a(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,`loading ${t} of ${this.layer}`)}}const qj="layer.changeFlag",Xj="layer.initialize",Zj="layer.update",Gj="layer.finalize",Yj="layer.matched",UA=2**24-1,Kj=Object.freeze([]),Qj=Fy(({oldViewport:i,viewport:t})=>i.equals(t));let Cc=new Uint8ClampedArray(0);const Jj={data:{type:"data",value:Kj,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:t,layer:e,loaders:n,loadOptions:a,signal:f})=>{const{resourceManager:m}=e.context;a=a||e.getLoadOptions(),n=n||e.props.loaders,f&&(a={...a,fetch:{...a?.fetch,signal:f}});let l=m.contains(i);return!l&&!a&&(m.add({resourceId:i,data:xb(i,n),persistent:!1}),l=!0),l?m.subscribe({resourceId:i,onChange:w=>e.internalState?.reloadAsyncProp(t,w),consumerId:e.id,requestId:t}):xb(i,n,a)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:fn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Hp extends t0{constructor(){super(...arguments),this.internalState=null,this.lifecycle=bg.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){ra(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=CM(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[a,f,m]=TM(n,e.pixelProjectionMatrix);return t.length===2?[a,f]:[a,f,m]}unproject(t){return ra(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){ra(this.internalState);const n=this.internalState.viewport||this.context.viewport;return RU(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const e of this.getModels())e.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===fn.DEFAULT||t===fn.LNGLAT||t===fn.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){ra(t instanceof Uint8Array);const[e,n,a]=t;return e+n*256+a*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Aj(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=zA(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const e of this.props.extensions)t=zA(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const a of n)e.invalidateAll(a);else e.invalidateAll();if(e){const{props:a}=t,f=this.internalState.hasPickingBuffer,m=Number.isInteger(a.highlightedObjectIndex)||a.pickable||a.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(f!==m){this.internalState.hasPickingBuffer=m;const{pickingColors:l,instancePickingColors:w}=e.attributes,C=l||w;C&&(m&&C.constant&&(C.constant=!1,e.invalidate(C.id)),!C.value&&!m&&(C.constant=!0,C.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.destroy();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t.renderPass)}getPickingInfo({info:t,mode:e,sourceLayer:n}){const{index:a}=t;return a>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[a]),t}raiseError(t,e){e&&(t=new Error(`${e}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!Qj({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){let e=!1;for(const n in t)t[n].layoutChanged()&&(e=!0);for(const n of this.getModels())this._setModelAttributes(n,t,e)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),a=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:a,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const f=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(f)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const a in e)Object.defineProperty(n,a,{value:e[a]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const n=Math.floor(Cc.length/4);if(this.internalState.usesPickingColorCache=!0,n<e){e>UA&&on.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Cc=Ey.allocate(Cc,e,{size:4,copy:!0,maxCount:Math.max(e,UA)});const a=Math.floor(Cc.length/4),f=[0,0,0];for(let m=n;m<a;m++)this.encodePickingColor(m,f),Cc[m*4+0]=f[0],Cc[m*4+1]=f[1],Cc[m*4+2]=f[2],Cc[m*4+3]=0}t.value=Cc.subarray(0,e*4)}_setModelAttributes(t,e,n=!1){if(!Object.keys(e).length)return;if(n){const l=this.getAttributeManager();t.setBufferLayout(l.getBufferLayouts(t)),e=l.getAttributes()}const a=t.userData?.excludeAttributes||{},f={},m={};for(const l in e){if(a[l])continue;const w=e[l].getValue();for(const C in w){const P=w[C];P instanceof Un?e[l].settings.isIndexed?t.setIndexBuffer(P):f[C]=P:P&&(m[C]=P)}}t.setAttributes(f),t.setConstantAttributes(m)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:a}=this.getAttributeManager().attributes,f=n||a,m=f&&e.attributes&&e.attributes[f.id];if(m&&m.value){const l=m.value,w=this.encodePickingColor(t);for(let C=0;C<e.length;C++){const P=f.getVertexOffset(C);l[P]===w[0]&&l[P+1]===w[1]&&l[P+2]===w[2]&&this._disablePickingIndex(C)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,a=e||n;if(!a)return;const f=a.getVertexOffset(t),m=a.getVertexOffset(t+1);a.buffer.write(new Uint8Array(m-f),f)}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Cc.buffer&&(n.value=Cc.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){ra(!this.internalState),ra(Number.isFinite(this.props.coordinateSystem)),na(Xj,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Wj({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(on.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new gj(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){na(Yj,this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(na(Zj,this,t),!t)return;const e=this.props,n=this.context,a=this.internalState,f=n.viewport,m=this._updateUniformTransition();a.propsInTransition=m,n.viewport=a.viewport||f,this.props=m;try{const l=this._getUpdateParams(),w=this.getModels();if(n.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const P of this.props.extensions)P.updateState.call(this,l,P);this.setNeedsRedraw(),this._updateAttributes();const C=this.getModels()[0]!==w[0];this._postUpdate(l,C)}finally{n.viewport=f,this.props=e,this._clearChangeFlags(),a.needsUpdate=!1,a.resetOldProps()}}_finalize(){na(Gj,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:e=null,uniforms:n={},parameters:a={}}){this._updateAttributeTransition();const f=this.props,m=this.context;this.props=this.internalState.propsInTransition||f;try{e&&this.setShaderModuleProps(e);const{getPolygonOffset:l}=this.props,w=l&&l(n)||[0,0];m.device instanceof S1&&m.device.setParametersWebGL({polygonOffset:w});for(const C of this.getModels())C.device.type==="webgpu"?C.setParameters({...C.parameters,...a}):C.setParameters(a);if(m.device instanceof S1)m.device.withParametersWebGL(a,()=>{const C={renderPass:t,shaderModuleProps:e,uniforms:n,parameters:a,context:m};for(const P of this.props.extensions)P.draw.call(this,C,P);this.draw(C)});else{const C={renderPass:t,shaderModuleProps:e,uniforms:n,parameters:a,context:m};for(const P of this.props.extensions)P.draw.call(this,C,P);this.draw(C)}}finally{this.props=f}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const a in t)if(t[a]){let f=!1;switch(a){case"dataChanged":const m=t[a],l=e[a];m&&Array.isArray(l)&&(e.dataChanged=Array.isArray(m)?l.concat(m):m,f=!0);default:e[a]||(e[a]=t[a],f=!0)}f&&na(qj,this,a,t)}const n=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=yj(t,e);if(n.updateTriggersChanged)for(const a in n.updateTriggersChanged)n.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(n.transitionsChanged)for(const a in n.transitionsChanged)this.internalState.uniformTransitions.add(a,e[a],t[a],t.transitions?.[a]);return this.setChangeFlags(n)}validateProps(){_j(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(e.highlightColor=n(t)),this.setShaderModuleProps({picking:e}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new hj(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:a}=t,f=this.state.model;f?.isInstanced&&f.setInstanceCount(this.getNumInstances());const{autoHighlight:m,highlightedObjectIndex:l,highlightColor:w}=n;if(e||a.autoHighlight!==m||a.highlightedObjectIndex!==l||a.highlightColor!==w){const C={};Array.isArray(w)&&(C.highlightColor=w),(e||a.autoHighlight!==m||l!==a.highlightedObjectIndex)&&(C.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:C})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),a=n?n.getNeedsRedraw(t):!1;if(e=e||a,e)for(const f of this.props.extensions)f.onNeedsRedraw.call(this,f);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Hp.defaultProps=Jj;Hp.layerName="Layer";const t7="compositeLayer.renderLayers";class sR extends Hp{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id&&(t.object=e.__source.object,t.index=e.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(n,a)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,a)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:n,visible:a,parameters:f,getPolygonOffset:m,highlightedObjectIndex:l,autoHighlight:w,highlightColor:C,coordinateSystem:P,coordinateOrigin:L,wrapLongitude:j,positionFormat:G,modelMatrix:nt,extensions:at,fetch:J,operation:mt,_subLayerProps:Mt}=this.props,pt={id:"",updateTriggers:{},opacity:e,pickable:n,visible:a,parameters:f,getPolygonOffset:m,highlightedObjectIndex:l,autoHighlight:w,highlightColor:C,coordinateSystem:P,coordinateOrigin:L,wrapLongitude:j,positionFormat:G,modelMatrix:nt,extensions:at,fetch:J,operation:mt},Pt=Mt&&t.id&&Mt[t.id],kt=Pt&&Pt.updateTriggers,$t=t.id||"sublayer";if(Pt){const ae=this.props[Gf],qt=t.type?t.type._propTypes:{};for(const le in Pt){const Oe=qt[le]||ae[le];Oe&&Oe.type==="accessor"&&(Pt[le]=this.getSubLayerAccessor(Pt[le]))}}Object.assign(pt,t,Pt),pt.id=`${this.props.id}-${$t}`,pt.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...kt};for(const ae of at){const qt=ae.getSubLayerProps.call(this,ae);qt&&Object.assign(pt,qt,{updateTriggers:Object.assign(pt.updateTriggers,qt.updateTriggers)})}return pt}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const a=!n||this.needsUpdate();if(a){const f=this.renderLayers();n=Gw(f,Boolean),this.internalState.subLayers=n}na(t7,this,a,n);for(const f of n)f.parent=this}}sR.layerName="CompositeLayer";const e7=typeof window<"u"?me.useLayoutEffect:me.useEffect;function Ub(i,t){for(;i;){if(i===t)return!0;i=Object.getPrototypeOf(i)}return!1}const i7={position:"absolute",zIndex:-1};function aR(i,t){if(typeof i=="function")return i(t);if(Array.isArray(i))return i.map(e=>aR(e,t));if(e0(i)){if(n7(i))return t.style=i7,me.cloneElement(i,t);if(r7(i))return me.cloneElement(i,t)}return i}function e0(i){return i&&typeof i=="object"&&"type"in i||!1}function n7(i){return i.props?.mapStyle}function r7(i){const t=i.type;return t&&t.deckGLViewProps}function P1(i){if(typeof i=="function")return me.createElement(Wg,{},i);if(Array.isArray(i))return i.map(P1);if(e0(i)){if(i.type===me.Fragment)return P1(i.props.children);if(Ub(i.type,Wg))return i}return i}function s7({children:i,layers:t=[],views:e=null}){const n=[],a=[],f={};return me.Children.forEach(P1(i),m=>{if(e0(m)){const l=m.type;if(Ub(l,Hp)){const w=a7(l,m.props);a.push(w)}else n.push(m);if(Ub(l,Wg)&&l!==Wg&&m.props.id){const w=new l(m.props);f[w.id]=w}}else m&&n.push(m)}),Object.keys(f).length>0&&(Array.isArray(e)?e.forEach(m=>{f[m.id]=m}):e&&(f[e.id]=e),e=Object.values(f)),t=a.length>0?[...a,...t]:t,{layers:t,children:n,views:e}}function a7(i,t){const e={},n=i.defaultProps||{};for(const a in t)n[a]!==t[a]&&(e[a]=t[a]);return new i(e)}const o7=me.createContext();function l7({children:i,deck:t,ContextProvider:e=o7.Provider}){const{viewManager:n}=t||{};if(!n||!n.views.length)return[];const a={},f=n.views[0].id;for(const m of i){let l=f,w=m;e0(m)&&Ub(m.type,Wg)&&(l=m.props.id||f,w=m.props.children);const C=n.getViewport(l),P=n.getViewState(l);if(C){P.padding=C.padding;const{x:L,y:j,width:G,height:nt}=C;w=aR(w,{x:L,y:j,width:G,height:nt,viewport:C,viewState:P}),a[l]||(a[l]={viewport:C,children:[]}),a[l].children.push(w)}}return Object.keys(a).map(m=>{const{viewport:l,children:w}=a[m],{x:C,y:P,width:L,height:j}=l,G={position:"absolute",left:C,top:P,width:L,height:j},nt=`view-${m}`,at=me.createElement("div",{key:nt,id:nt,style:G},...w),J={deck:t,viewport:l,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:Mt=>{Mt.viewId=m,t._onViewStateChange(Mt)},widgets:[]},mt=`view-${m}-context`;return me.createElement(e,{key:mt,value:J},at)})}const c7={mixBlendMode:null};function u7({width:i,height:t,style:e}){const n={position:"absolute",zIndex:0,left:0,top:0,width:i,height:t},a={left:0,top:0};if(e)for(const f in e)f in c7?a[f]=e[f]:n[f]=e[f];return{containerStyle:n,canvasStyle:a}}function h7(i){return{get deck(){return i.deck},pickObject:t=>i.deck.pickObject(t),pickMultipleObjects:t=>i.deck.pickMultipleObjects(t),pickObjects:t=>i.deck.pickObjects(t)}}function oR(i){i.redrawReason&&(i.deck._drawLayers(i.redrawReason),i.redrawReason=null)}function f7(i,t,e){const n=new t({...e,_customRender:e.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:a=>{i.redrawReason=a;const f=n.getViewports();i.lastRenderedViewports!==f?i.forceUpdate():oR(i)}});return n}function d7(i,t){const[e,n]=me.useState(0),f=me.useRef({control:null,version:e,forceUpdate:()=>n(kt=>kt+1)}).current,m=me.useRef(null),l=me.useRef(null),w=me.useMemo(()=>s7(i),[i.layers,i.views,i.children]);let C=!0;const P=kt=>C&&i.viewState?(f.viewStateUpdateRequested=kt,null):(f.viewStateUpdateRequested=null,i.onViewStateChange?.(kt)),L=kt=>{C?f.interactionStateUpdateRequested=kt:(f.interactionStateUpdateRequested=null,i.onInteractionStateChange?.(kt))},j=me.useMemo(()=>{const kt={widgets:[],...i,style:null,width:"100%",height:"100%",parent:m.current,canvas:l.current,layers:w.layers,views:w.views,onViewStateChange:P,onInteractionStateChange:L};return delete kt._customRender,f.deck&&f.deck.setProps(kt),kt},[i]);me.useEffect(()=>{const kt=i.Deck||nT;return f.deck=f7(f,kt,{...j,parent:m.current,canvas:l.current}),()=>f.deck?.finalize()},[]),e7(()=>{oR(f);const{viewStateUpdateRequested:kt,interactionStateUpdateRequested:$t}=f;kt&&P(kt),$t&&L($t),f.deck?.isInitialized&&f.deck.redraw("Initial render")}),me.useImperativeHandle(t,()=>h7(f),[]);const G=f.deck&&f.deck.isInitialized?f.deck.getViewports():void 0,{ContextProvider:nt,width:at="100%",height:J="100%",id:mt,style:Mt}=i,{containerStyle:pt,canvasStyle:Pt}=me.useMemo(()=>u7({width:at,height:J,style:Mt}),[at,J,Mt]);if(!f.viewStateUpdateRequested&&f.lastRenderedViewports===G||f.version!==e){f.lastRenderedViewports=G,f.version=e;const kt=l7({children:w.children,deck:f.deck,ContextProvider:nt}),$t=me.createElement("canvas",{key:"canvas",id:mt||"deckgl-overlay",ref:l,style:Pt});f.control=me.createElement("div",{id:`${mt||"deckgl"}-wrapper`,ref:m,style:pt},[$t,kt])}return C=!1,f.control}const k$=me.forwardRef(d7),VA=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,p7={name:"icon",vs:VA,fs:VA,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},m7=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,g7=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,_7=1024,y7=4,jA=()=>{},$A={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},v7={x:0,y:0,width:0,height:0};function b7(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function x7(i,t,e,n){const a=Math.min(e/t.width,n/t.height),f=Math.floor(t.width*a),m=Math.floor(t.height*a);return a===1?{image:t,width:f,height:m}:(i.canvas.height=m,i.canvas.width=f,i.clearRect(0,0,f,m),i.drawImage(t,0,0,t.width,t.height,0,0,f,m),{image:i.canvas,width:f,height:m})}function My(i){return i&&(i.id||i.url)}function w7(i,t,e,n){const{width:a,height:f,device:m}=i,l=m.createTexture({format:"rgba8unorm",width:t,height:e,sampler:n,mipLevels:m.getMipLevelCount(t,e)}),w=m.createCommandEncoder();return w.copyTextureToTexture({sourceTexture:i,destinationTexture:l,width:a,height:f}),w.finish(),l.generateMipmapsWebGL(),i.destroy(),l}function HA(i,t,e){for(let n=0;n<t.length;n++){const{icon:a,xOffset:f}=t[n],m=My(a);i[m]={...a,x:f,y:e}}}function T7({icons:i,buffer:t,mapping:e={},xOffset:n=0,yOffset:a=0,rowHeight:f=0,canvasWidth:m}){let l=[];for(let w=0;w<i.length;w++){const C=i[w],P=My(C);if(!e[P]){const{height:L,width:j}=C;n+j+t>m&&(HA(e,l,a),n=0,a=f+a+t,f=0,l=[]),l.push({icon:C,xOffset:n}),n=n+j+t,f=Math.max(f,L)}}return l.length>0&&HA(e,l,a),{mapping:e,rowHeight:f,xOffset:n,yOffset:a,canvasWidth:m,canvasHeight:b7(f+a+t)}}function S7(i,t,e){if(!i||!t)return null;e=e||{};const n={},{iterable:a,objectInfo:f}=rT(i);for(const m of a){f.index++;const l=t(m,f),w=My(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!n[w]&&(!e[w]||l.url!==e[w].url)&&(n[w]={...l,source:m,sourceIndex:f.index})}return n}class A7{constructor(t,{onUpdate:e=jA,onError:n=jA}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=y7,this._canvasWidth=_7,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=e,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?My(t):t;return this._mapping[e]||v7}setProps({loadOptions:t,autoPacking:e,iconAtlas:n,iconMapping:a,textureParameters:f}){t&&(this._loadOptions=t),e!==void 0&&(this._autoPacking=e),a&&(this._mapping=a),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),f&&(this._samplerParameters=f)}get isLoaded(){return this._pendingCount===0}packIcons(t,e){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(S7(t,e,this._mapping)||{});if(n.length>0){const{mapping:a,xOffset:f,yOffset:m,rowHeight:l,canvasHeight:w}=T7({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=a,this._xOffset=f,this._yOffset=m,this._canvasHeight=w,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||$A,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=w7(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||$A)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n),this._texture?.generateMipmapsWebGL()}}_loadIcons(t){const e=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of t)this._pendingCount++,xb(n.url,this._loadOptions).then(a=>{const f=My(n),m=this._mapping[f],{x:l,y:w,width:C,height:P}=m,{image:L,width:j,height:G}=x7(e,a,C,P);this._texture?.copyExternalImage({image:L,x:l+(C-j)/2,y:w+(P-G)/2,width:j,height:G}),m.width=j,m.height=G,this._texture?.generateMipmapsWebGL(),this.onUpdate()}).catch(a=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:a})}).finally(()=>{this._pendingCount--})}}const lR=[0,0,0,255],E7={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:i=>i.position},getIcon:{type:"accessor",value:i=>i.icon},getColor:{type:"accessor",value:lR},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class aT extends Hp{getShaders(){return super.getShaders({vs:m7,fs:g7,modules:[Uw,$w,p7]})}initializeState(){this.state={iconManager:new A7(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:lR},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:a}=t,f=this.getAttributeManager(),{iconAtlas:m,iconMapping:l,data:w,getIcon:C,textureParameters:P}=e,{iconManager:L}=this.state;if(typeof m=="string")return;const j=m||this.internalState.isAsyncPropLoading("iconAtlas");L.setProps({loadOptions:e.loadOptions,autoPacking:!j,iconAtlas:m,iconMapping:j?l:null,textureParameters:P}),j?n.iconMapping!==e.iconMapping&&f.invalidate("getIcon"):(a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getIcon))&&L.packIcons(w,C),a.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),f.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeBasis:n,sizeMinPixels:a,sizeMaxPixels:f,sizeUnits:m,billboard:l,alphaCutoff:w}=this.props,{iconManager:C}=this.state,P=C.getTexture();if(P){const L=this.state.model,j={iconsTexture:P,iconsTextureDim:[P.width,P.height],sizeUnits:Jf[m],sizeScale:e,sizeBasis:n==="height"?1:0,sizeMinPixels:a,sizeMaxPixels:f,billboard:l,alphaCutoff:w};L.shaderInputs.setProps({icon:j}),L.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new zp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Zw({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){const e=this.getCurrentLayer()?.props.onIconError;e?e(t):on.error(t.error.message)()}getInstanceOffset(t){const{width:e,height:n,anchorX:a=e/2,anchorY:f=n/2}=this.state.iconManager.getIconMapping(t);return[e/2-a,n/2-f]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:e,y:n,width:a,height:f}=this.state.iconManager.getIconMapping(t);return[e,n,a,f]}}aT.defaultProps=E7;aT.layerName="IconLayer";const WA=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,C7={name:"scatterplot",vs:WA,fs:WA,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},M7=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,R7=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,P7=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,qA=[0,0,0,255],I7={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:qA},getLineColor:{type:"accessor",value:qA},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class cR extends Hp{getShaders(){return super.getShaders({vs:M7,fs:R7,source:P7,modules:[Uw,mz,$w,C7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:e,radiusScale:n,radiusMinPixels:a,radiusMaxPixels:f,stroked:m,filled:l,billboard:w,antialiasing:C,lineWidthUnits:P,lineWidthScale:L,lineWidthMinPixels:j,lineWidthMaxPixels:G}=this.props,nt={stroked:m,filled:l,billboard:w,antialiasing:C,radiusUnits:Jf[e],radiusScale:n,radiusMinPixels:a,radiusMaxPixels:f,lineWidthUnits:Jf[P],lineWidthScale:L,lineWidthMinPixels:j,lineWidthMaxPixels:G},at=this.state.model;at.shaderInputs.setProps({scatterplot:nt}),this.context.device.type==="webgpu"&&(at.instanceCount=this.props.data.length),at.draw(this.context.renderPass)}_getModel(){const t=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new zp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Zw({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0,parameters:t})}}cR.defaultProps=I7;cR.layerName="ScatterplotLayer";const XA=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,D7={name:"sdf",vs:XA,fs:XA,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},k7=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Sx=192/256,ZA=[],O7={getIconOffsets:{type:"accessor",value:i=>i.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class oT extends aT{getShaders(){const t=super.getShaders();return{...t,modules:[...t.modules,D7],fs:k7}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:n,target:a})=>this.encodePickingColor(n,a)}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;let{outlineColor:a}=e;a!==n.outlineColor&&(a=a.map(f=>f/255),a[3]=Number.isFinite(a[3])?a[3]:1,this.setState({outlineColor:a})),!e.sdf&&e.outlineWidth&&on.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:e,smoothing:n,outlineWidth:a}=this.props,{outlineColor:f}=this.state,m=a?Math.max(n,Sx*(1-a)):-1,l=this.state.model,w={buffer:Sx,outlineBuffer:m,gamma:n,enabled:!!e,outlineColor:f};if(l.shaderInputs.setProps({sdf:w}),super.draw(t),e&&a){const{iconManager:C}=this.state;C.getTexture()&&(l.shaderInputs.setProps({sdf:{...w,outlineBuffer:Sx}}),l.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(e=>super.getInstanceOffset(e)):ZA}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(e=>super.getInstanceIconFrame(e)):ZA}}oT.defaultProps=O7;oT.layerName="MultiIconLayer";const _y=1e20;class B7{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:f="sans-serif",fontWeight:m="normal",fontStyle:l="normal",lang:w=null}={}){this.buffer=e,this.cutoff=a,this.radius=n,this.lang=w;const C=this.size=t+e*4,P=this._createCanvas(C),L=this.ctx=P.getContext("2d",{willReadFrequently:!0});L.font=`${l} ${m} ${t}px ${f}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:f,actualBoundingBoxRight:m}=this.ctx.measureText(t),l=Math.ceil(n),w=0,C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-f))),P=Math.min(this.size-this.buffer,l+Math.ceil(a)),L=C+2*this.buffer,j=P+2*this.buffer,G=Math.max(L*j,0),nt=new Uint8ClampedArray(G),at={data:nt,width:L,height:j,glyphWidth:C,glyphHeight:P,glyphTop:l,glyphLeft:w,glyphAdvance:e};if(C===0||P===0)return at;const{ctx:J,buffer:mt,gridInner:Mt,gridOuter:pt}=this;this.lang&&(J.lang=this.lang),J.clearRect(mt,mt,C,P),J.fillText(t,mt,mt+l);const Pt=J.getImageData(mt,mt,C,P);pt.fill(_y,0,G),Mt.fill(0,0,G);for(let kt=0;kt<P;kt++)for(let $t=0;$t<C;$t++){const ae=Pt.data[4*(kt*C+$t)+3]/255;if(ae===0)continue;const qt=(kt+mt)*L+$t+mt;if(ae===1)pt[qt]=0,Mt[qt]=_y;else{const le=.5-ae;pt[qt]=le>0?le*le:0,Mt[qt]=le<0?le*le:0}}GA(pt,0,0,L,j,L,this.f,this.v,this.z),GA(Mt,mt,mt,C,P,L,this.f,this.v,this.z);for(let kt=0;kt<G;kt++){const $t=Math.sqrt(pt[kt])-Math.sqrt(Mt[kt]);nt[kt]=Math.round(255-255*($t/this.radius+this.cutoff))}return at}}function GA(i,t,e,n,a,f,m,l,w){for(let C=t;C<t+n;C++)YA(i,e*f+C,f,a,m,l,w);for(let C=e;C<e+a;C++)YA(i,C*f+t,1,n,m,l,w)}function YA(i,t,e,n,a,f,m){f[0]=0,m[0]=-_y,m[1]=_y,a[0]=i[t];for(let l=1,w=0,C=0;l<n;l++){a[l]=i[t+l*e];const P=l*l;do{const L=f[w];C=(a[l]-a[L]+P-L*L)/(l-L)/2}while(C<=m[w]&&--w>-1);w++,f[w]=l,m[w]=C,m[w+1]=_y}for(let l=0,w=0;l<n;l++){for(;m[w+1]<l;)w++;const C=f[w],P=l-C;i[t+l*e]=a[C]+P*P}}const L7=32,F7=[];function N7(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function z7({characterSet:i,getFontWidth:t,fontHeight:e,buffer:n,maxCanvasWidth:a,mapping:f={},xOffset:m=0,yOffset:l=0}){let w=0,C=m;const P=e+n*2;for(const L of i)if(!f[L]){const j=t(L);C+j+n*2>a&&(C=0,w++),f[L]={x:C+n,y:l+w*P+n,width:j,height:P,layoutWidth:j,layoutHeight:e},C+=j+n*2}return{mapping:f,xOffset:C,yOffset:l+w*P,canvasHeight:N7(l+(w+1)*P)}}function uR(i,t,e,n){let a=0;for(let f=t;f<e;f++){const m=i[f];a+=n[m]?.layoutWidth||0}return a}function hR(i,t,e,n,a,f){let m=t,l=0;for(let w=t;w<e;w++){const C=uR(i,w,w+1,a);l+C>n&&(m<w&&f.push(w),m=w,l=0),l+=C}return l}function U7(i,t,e,n,a,f){let m=t,l=t,w=t,C=0;for(let P=t;P<e;P++)if((i[P]===" "||i[P+1]===" "||P+1===e)&&(w=P+1),w>l){let L=uR(i,l,w,a);C+L>n&&(m<l&&(f.push(l),m=l,C=0),L>n&&(L=hR(i,l,w,n,a,f),m=f[f.length-1])),l=w,C+=L}return C}function V7(i,t,e,n,a=0,f){f===void 0&&(f=i.length);const m=[];return t==="break-all"?hR(i,a,f,e,n,m):U7(i,a,f,e,n,m),m}function j7(i,t,e,n,a,f){let m=0,l=0;for(let w=t;w<e;w++){const C=i[w],P=n[C];P?(l||(l=P.layoutHeight),a[w]=m+P.layoutWidth/2,m+=P.layoutWidth):(on.warn(`Missing character: ${C} (${C.codePointAt(0)})`)(),a[w]=m,m+=L7)}f[0]=m,f[1]=l}function $7(i,t,e,n,a){const f=Array.from(i),m=f.length,l=new Array(m),w=new Array(m),C=new Array(m),P=(e==="break-word"||e==="break-all")&&isFinite(n)&&n>0,L=[0,0],j=[0,0];let G=0,nt=0,at=0;for(let J=0;J<=m;J++){const mt=f[J];if((mt===`
`||J===m)&&(at=J),at>nt){const Mt=P?V7(f,e,n,a,nt,at):F7;for(let pt=0;pt<=Mt.length;pt++){const Pt=pt===0?nt:Mt[pt-1],kt=pt<Mt.length?Mt[pt]:at;j7(f,Pt,kt,a,l,j);for(let $t=Pt;$t<kt;$t++){const ae=f[$t],qt=a[ae]?.layoutOffsetY||0;w[$t]=G+j[1]/2+qt,C[$t]=j[0]}G=G+j[1]*t,L[0]=Math.max(L[0],j[0])}nt=at}mt===`
`&&(l[nt]=0,w[nt]=0,C[nt]=0,nt++)}return L[1]=G,{x:l,y:w,rowWidth:C,size:L}}function H7({value:i,length:t,stride:e,offset:n,startIndices:a,characterSet:f}){const m=i.BYTES_PER_ELEMENT,l=e?e/m:1,w=n?n/m:0,C=a[t]||Math.ceil((i.length-w)/l),P=f&&new Set,L=new Array(t);let j=i;if(l>1||w>0){const G=i.constructor;j=new G(C);for(let nt=0;nt<C;nt++)j[nt]=i[nt*l+w]}for(let G=0;G<t;G++){const nt=a[G],at=a[G+1]||C,J=j.subarray(nt,at);L[G]=String.fromCodePoint.apply(null,J),P&&J.forEach(P.add,P)}if(P)for(const G of P)f.add(String.fromCodePoint(G));return{texts:L,characterCount:C}}class fR{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const e=this._order.indexOf(t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}function W7(){const i=[];for(let t=32;t<128;t++)i.push(String.fromCharCode(t));return i}const Bg={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:W7(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},KA=1024,QA=.9,JA=1.2,dR=3;let Vb=new fR(dR);function q7(i,t){let e;typeof t=="string"?e=new Set(Array.from(t)):e=new Set(t);const n=Vb.get(i);if(!n)return e;for(const a in n.mapping)e.has(a)&&e.delete(a);return e}function X7(i,t){for(let e=0;e<i.length;e++)t.data[4*e+3]=i[e]}function tE(i,t,e,n){i.font=`${n} ${e}px ${t}`,i.fillStyle="#000",i.textBaseline="alphabetic",i.textAlign="left"}function Z7(i){on.assert(Number.isFinite(i)&&i>=dR,"Invalid cache limit"),Vb=new fR(i)}class G7{constructor(){this.props={...Bg}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:e}=this.props;return(t*JA+e*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const e=q7(this._key,this.props.characterSet),n=Vb.get(this._key);if(n&&e.size===0){this._atlas!==n&&(this._atlas=n);return}const a=this._generateFontAtlas(e,n);this._atlas=a,Vb.set(this._key,a)}_generateFontAtlas(t,e){const{fontFamily:n,fontWeight:a,fontSize:f,buffer:m,sdf:l,radius:w,cutoff:C}=this.props;let P=e&&e.data;P||(P=document.createElement("canvas"),P.width=KA);const L=P.getContext("2d",{willReadFrequently:!0});tE(L,n,f,a);const{mapping:j,canvasHeight:G,xOffset:nt,yOffset:at}=z7({getFontWidth:J=>L.measureText(J).width,fontHeight:f*JA,buffer:m,characterSet:t,maxCanvasWidth:KA,...e&&{mapping:e.mapping,xOffset:e.xOffset,yOffset:e.yOffset}});if(P.height!==G){const J=L.getImageData(0,0,P.width,P.height);P.height=G,L.putImageData(J,0,0)}if(tE(L,n,f,a),l){const J=new B7({fontSize:f,buffer:m,radius:w,cutoff:C,fontFamily:n,fontWeight:`${a}`});for(const mt of t){const{data:Mt,width:pt,height:Pt,glyphTop:kt}=J.draw(mt);j[mt].width=pt,j[mt].layoutOffsetY=f*QA-kt;const $t=L.createImageData(pt,Pt);X7(Mt,$t),L.putImageData($t,j[mt].x,j[mt].y)}}else for(const J of t)L.fillText(J,j[J].x,j[J].y+m+f*QA);return{xOffset:nt,yOffset:at,mapping:j,data:P,width:P.width,height:P.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:n,buffer:a,sdf:f,radius:m,cutoff:l}=this.props;return f?`${t} ${e} ${n} ${a} ${m} ${l}`:`${t} ${e} ${n} ${a}`}}const eE=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,Y7={name:"textBackground",vs:eE,fs:eE,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},K7=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Q7=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,J7={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:i=>i.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class lT extends Hp{getShaders(){return super.getShaders({vs:K7,fs:Q7,modules:[Uw,$w,Y7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);const{changeFlags:e}=t;e.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:e,sizeScale:n,sizeUnits:a,sizeMinPixels:f,sizeMaxPixels:m,getLineWidth:l}=this.props;let{padding:w,borderRadius:C}=this.props;w.length<4&&(w=[w[0],w[1],w[0],w[1]]),Array.isArray(C)||(C=[C,C,C,C]);const P=this.state.model,L={billboard:e,stroked:!!l,borderRadius:C,padding:w,sizeUnits:Jf[a],sizeScale:n,sizeMinPixels:f,sizeMaxPixels:m};P.shaderInputs.setProps({textBackground:L}),P.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,0,1,1,1];return new zp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Zw({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}lT.defaultProps=J7;lT.layerName="TextBackgroundLayer";const iE={start:1,middle:0,end:-1},nE={top:1,center:0,bottom:-1},Ax=[0,0,0,255],t9=1,e9={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ax},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Bg.characterSet},fontFamily:Bg.fontFamily,fontWeight:Bg.fontWeight,lineHeight:t9,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ax},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:i=>i.text},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:Ax},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class pR extends sR{constructor(){super(...arguments),this.getBoundingRect=(t,e)=>{let{size:[n,a]}=this.transformParagraph(t,e);const{fontSize:f}=this.state.fontAtlasManager.props;n/=f,a/=f;const{getTextAnchor:m,getAlignmentBaseline:l}=this.props,w=iE[typeof m=="function"?m(t,e):m],C=nE[typeof l=="function"?l(t,e):l];return[(w-1)*n/2,(C-1)*a/2,n,a]},this.getIconOffsets=(t,e)=>{const{getTextAnchor:n,getAlignmentBaseline:a}=this.props,{x:f,y:m,rowWidth:l,size:[w,C]}=this.transformParagraph(t,e),P=iE[typeof n=="function"?n(t,e):n],L=nE[typeof a=="function"?a(t,e):a],j=f.length,G=new Array(j*2);let nt=0;for(let at=0;at<j;at++){const J=(1-P)*(w-l[at])/2;G[nt++]=(P-1)*w/2+J+f[at],G[nt++]=(L-1)*C/2+m[at]}return G}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new G7},this.props.maxWidth>0&&on.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:e,oldProps:n,changeFlags:a}=t;(a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||e.lineHeight!==n.lineHeight||e.wordBreak!==n.wordBreak||e.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:e,fontWeight:n}=this.props,{fontAtlasManager:a,characterSet:f}=this.state,m={...t,characterSet:f,fontFamily:e,fontWeight:n};if(!a.mapping)return a.setProps(m),!0;for(const l in m)if(m[l]!==a.props[l])return a.setProps(m),!0;return!1}_updateText(){const{data:t,characterSet:e}=this.props,n=t.attributes?.getText;let{getText:a}=this.props,f=t.startIndices,m;const l=e==="auto"&&new Set;if(n&&f){const{texts:w,characterCount:C}=H7({...ArrayBuffer.isView(n)?{value:n}:n,length:t.length,startIndices:f,characterSet:l});m=C,a=(P,{index:L})=>w[L]}else{const{iterable:w,objectInfo:C}=rT(t);f=[0],m=0;for(const P of w){C.index++;const L=Array.from(a(P,C)||"");l&&L.forEach(l.add,l),m+=L.length,f.push(m)}}this.setState({getText:a,startIndices:f,numInstances:m,characterSet:l||e})}transformParagraph(t,e){const{fontAtlasManager:n}=this.state,a=n.mapping,f=this.state.getText,{wordBreak:m,lineHeight:l,maxWidth:w}=this.props,C=f(t,e)||"";return $7(C,l,m,w*n.props.fontSize,a)}renderLayers(){const{startIndices:t,numInstances:e,getText:n,fontAtlasManager:{scale:a,atlas:f,mapping:m},styleVersion:l}=this.state,{data:w,_dataDiff:C,getPosition:P,getColor:L,getSize:j,getAngle:G,getPixelOffset:nt,getBackgroundColor:at,getBorderColor:J,getBorderWidth:mt,backgroundBorderRadius:Mt,backgroundPadding:pt,background:Pt,billboard:kt,fontSettings:$t,outlineWidth:ae,outlineColor:qt,sizeScale:le,sizeUnits:Oe,sizeMinPixels:Be,sizeMaxPixels:qe,transitions:ri,updateTriggers:Ne}=this.props,wi=this.getSubLayerClass("characters",oT),ne=this.getSubLayerClass("background",lT);return[Pt&&new ne({getFillColor:at,getLineColor:J,getLineWidth:mt,borderRadius:Mt,padding:pt,getPosition:P,getSize:j,getAngle:G,getPixelOffset:nt,billboard:kt,sizeScale:le,sizeUnits:Oe,sizeMinPixels:Be,sizeMaxPixels:qe,transitions:ri&&{getPosition:ri.getPosition,getAngle:ri.getAngle,getSize:ri.getSize,getFillColor:ri.getBackgroundColor,getLineColor:ri.getBorderColor,getLineWidth:ri.getBorderWidth,getPixelOffset:ri.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Ne.getPosition,getAngle:Ne.getAngle,getSize:Ne.getSize,getFillColor:Ne.getBackgroundColor,getLineColor:Ne.getBorderColor,getLineWidth:Ne.getBorderWidth,getPixelOffset:Ne.getPixelOffset,getBoundingRect:{getText:Ne.getText,getTextAnchor:Ne.getTextAnchor,getAlignmentBaseline:Ne.getAlignmentBaseline,styleVersion:l}}}),{data:w.attributes&&w.attributes.background?{length:w.length,attributes:w.attributes.background}:w,_dataDiff:C,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new wi({sdf:$t.sdf,smoothing:Number.isFinite($t.smoothing)?$t.smoothing:Bg.smoothing,outlineWidth:ae/($t.radius||Bg.radius),outlineColor:qt,iconAtlas:f,iconMapping:m,getPosition:P,getColor:L,getSize:j,getAngle:G,getPixelOffset:nt,billboard:kt,sizeScale:le*a,sizeUnits:Oe,sizeMinPixels:Be*a,sizeMaxPixels:qe*a,transitions:ri&&{getPosition:ri.getPosition,getAngle:ri.getAngle,getColor:ri.getColor,getSize:ri.getSize,getPixelOffset:ri.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Ne.getText,getPosition:Ne.getPosition,getAngle:Ne.getAngle,getColor:Ne.getColor,getSize:Ne.getSize,getPixelOffset:Ne.getPixelOffset,getIconOffsets:{getTextAnchor:Ne.getTextAnchor,getAlignmentBaseline:Ne.getAlignmentBaseline,styleVersion:l}}}),{data:w,_dataDiff:C,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){Z7(t)}}pR.defaultProps=e9;pR.layerName="TextLayer";const i9=me.createContext(null);function n9(i,t){const e=Array.isArray(i)?i[0]:i?i.x:0,n=Array.isArray(i)?i[1]:i?i.y:0,a=Array.isArray(t)?t[0]:t?t.x:0,f=Array.isArray(t)?t[1]:t?t.y:0;return e===a&&n===f}function bu(i,t){if(i===t)return!0;if(!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;e++)if(!bu(i[e],t[e]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const e=Object.keys(i),n=Object.keys(t);if(e.length!==n.length)return!1;for(const a of e)if(!t.hasOwnProperty(a)||!bu(i[a],t[a]))return!1;return!0}return!1}function rE(i){return{longitude:i.center.lng,latitude:i.center.lat,zoom:i.zoom,pitch:i.pitch,bearing:i.bearing,padding:i.padding}}function sE(i,t){const e=t.viewState||t,n={};if("longitude"in e&&"latitude"in e&&(e.longitude!==i.center.lng||e.latitude!==i.center.lat)){const a=i.center.constructor;n.center=new a(e.longitude,e.latitude)}return"zoom"in e&&e.zoom!==i.zoom&&(n.zoom=e.zoom),"bearing"in e&&e.bearing!==i.bearing&&(n.bearing=e.bearing),"pitch"in e&&e.pitch!==i.pitch&&(n.pitch=e.pitch),e.padding&&i.padding&&!bu(e.padding,i.padding)&&(n.padding=e.padding),n}const r9=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function aE(i){if(!i)return null;if(typeof i=="string"||("toJS"in i&&(i=i.toJS()),!i.layers))return i;const t={};for(const n of i.layers)t[n.id]=n;const e=i.layers.map(n=>{let a=null;"interactive"in n&&(a=Object.assign({},n),delete a.interactive);const f=t[n.ref];if(f){a=a||Object.assign({},n),delete a.ref;for(const m of r9)m in f&&(a[m]=f[m])}return a||n});return{...i,layers:e}}const oE={version:8,sources:{},layers:[]},lE={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},cE={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},uE={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},s9=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],a9=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Xg{constructor(t,e,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=a=>{const f=this.props[uE[a.type]];f?f(a):a.type==="error"&&console.error(a.error)},this._onCameraEvent=a=>{if(this._internalUpdate)return;a.viewState=this._propsedCameraUpdate||rE(this._map.transform);const f=this.props[cE[a.type]];f&&f(a)},this._onCameraUpdate=a=>this._internalUpdate?a:(this._propsedCameraUpdate=rE(a),sE(a,this.props)),this._onPointerEvent=a=>{(a.type==="mousemove"||a.type==="mouseout")&&this._updateHover(a);const f=this.props[lE[a.type]];f&&(this.props.interactiveLayerIds&&a.type!=="mouseover"&&a.type!=="mouseout"&&(a.features=this._hoveredFeatures||this._queryRenderedFeatures(a.point)),f(a),delete a.features)},this._MapClass=t,this.props=e,this._initialize(n)}get map(){return this._map}setProps(t){const e=this.props;this.props=t;const n=this._updateSettings(t,e),a=this._updateSize(t),f=this._updateViewState(t);this._updateStyle(t,e),this._updateStyleComponents(t),this._updateHandlers(t,e),(n||a||f&&!this._map.isMoving())&&this.redraw()}static reuse(t,e){const n=Xg.savedMaps.pop();if(!n)return null;const a=n.map,f=a.getContainer();for(e.className=f.className;f.childNodes.length>0;)e.appendChild(f.childNodes[0]);a._container=e;const m=a._resizeObserver;m&&(m.disconnect(),m.observe(e)),n.setProps({...t,styleDiffing:!1}),a.resize();const{initialViewState:l}=t;return l&&(l.bounds?a.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):n._updateViewState(l)),a.isStyleLoaded()?a.fire("load"):a.once("style.load",()=>a.fire("load")),a._update(),n}_initialize(t){const{props:e}=this,{mapStyle:n=oE}=e,a={...e,...e.initialViewState,container:t,style:aE(n)},f=a.initialViewState||a.viewState||a;if(Object.assign(a,{center:[f.longitude||0,f.latitude||0],zoom:f.zoom||0,pitch:f.pitch||0,bearing:f.bearing||0}),e.gl){const l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=l,e.gl)}const m=new this._MapClass(a);f.padding&&m.setPadding(f.padding),e.cursor&&(m.getCanvas().style.cursor=e.cursor),m.transformCameraUpdate=this._onCameraUpdate,m.on("style.load",()=>{this._styleComponents={light:m.getLight(),sky:m.getSky(),projection:m.getProjection?.(),terrain:m.getTerrain()},this._updateStyleComponents(this.props)}),m.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const l in lE)m.on(l,this._onPointerEvent);for(const l in cE)m.on(l,this._onCameraEvent);for(const l in uE)m.on(l,this._onEvent);this._map=m}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Xg.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_updateSize(t){const{viewState:e}=t;if(e){const n=this._map;if(e.width!==n.transform.width||e.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(t){const e=this._map,n=e.transform;if(!e.isMoving()){const f=sE(n,t);if(Object.keys(f).length>0)return this._internalUpdate=!0,e.jumpTo(f),this._internalUpdate=!1,!0}return!1}_updateSettings(t,e){const n=this._map;let a=!1;for(const f of s9)f in t&&!bu(t[f],e[f])&&(a=!0,n[`set${f[0].toUpperCase()}${f.slice(1)}`]?.call(n,t[f]));return a}_updateStyle(t,e){if(t.cursor!==e.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==e.mapStyle){const{mapStyle:n=oE,styleDiffing:a=!0}=t,f={diff:a};"localIdeographFontFamily"in t&&(f.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(aE(n),f)}}_updateStyleComponents({light:t,projection:e,sky:n,terrain:a}){const f=this._map,m=this._styleComponents;f.style._loaded&&(t&&!bu(t,m.light)&&(m.light=t,f.setLight(t)),e&&!bu(e,m.projection)&&e!==m.projection?.type&&(m.projection=typeof e=="string"?{type:e}:e,f.setProjection?.(m.projection)),n&&!bu(n,m.sky)&&(m.sky=n,f.setSky(n)),a!==void 0&&!bu(a,m.terrain)&&(!a||f.getSource(a.source))&&(m.terrain=a,f.setTerrain(a)))}_updateHandlers(t,e){const n=this._map;for(const a of a9){const f=t[a]??!0,m=e[a]??!0;bu(f,m)||(f?n[a].enable(f):n[a].disable())}}_queryRenderedFeatures(t){const e=this._map,{interactiveLayerIds:n=[]}=this.props;try{return e.queryRenderedFeatures(t,{layers:n.filter(e.getLayer.bind(e))})}catch{return[]}}_updateHover(t){const{props:e}=this;if(e.interactiveLayerIds&&(e.onMouseMove||e.onMouseEnter||e.onMouseLeave)){const a=t.type,f=this._hoveredFeatures?.length>0,m=this._queryRenderedFeatures(t.point),l=m.length>0;!l&&f&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=m,l&&!f&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=a}else this._hoveredFeatures=null}}Xg.savedMaps=[];const o9=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function l9(i){if(!i)return null;const t=i.map,e={getMap:()=>t};for(const n of c9(t))!(n in e)&&!o9.includes(n)&&(e[n]=t[n].bind(t));return e}function c9(i){const t=new Set;let e=i;for(;e;){for(const n of Object.getOwnPropertyNames(e))n[0]!=="_"&&typeof i[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&t.add(n);e=Object.getPrototypeOf(e)}return Array.from(t)}const u9=typeof document<"u"?me.useLayoutEffect:me.useEffect;function h9(i,t){const{RTLTextPlugin:e,maxParallelImageRequests:n,workerCount:a,workerUrl:f}=t;if(e&&i.getRTLTextPluginStatus&&i.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:m,lazy:l=!0}=typeof e=="string"?{pluginUrl:e}:e;i.setRTLTextPlugin(m,w=>{w&&console.error(w)},l)}n!==void 0&&i.setMaxParallelImageRequests(n),a!==void 0&&i.setWorkerCount(a),f!==void 0&&i.setWorkerUrl(f)}const i0=me.createContext(null);function f9(i,t){const e=me.useContext(i9),[n,a]=me.useState(null),f=me.useRef(),{current:m}=me.useRef({mapLib:null,map:null});me.useEffect(()=>{const C=i.mapLib;let P=!0,L;return Promise.resolve(C||x1(()=>Promise.resolve().then(()=>S9),void 0,import.meta.url)).then(j=>{if(!P)return;if(!j)throw new Error("Invalid mapLib");const G="Map"in j?j:j.default;if(!G.Map)throw new Error("Invalid mapLib");h9(G,i),i.reuseMaps&&(L=Xg.reuse(i,f.current)),L||(L=new Xg(G.Map,i,f.current)),m.map=l9(L),m.mapLib=G,a(L),e?.onMapMount(m.map,i.id)}).catch(j=>{const{onError:G}=i;G?G({type:"error",target:null,originalEvent:null,error:j}):console.error(j)}),()=>{P=!1,L&&(e?.onMapUnmount(i.id),i.reuseMaps?L.recycle():L.destroy())}},[]),u9(()=>{n&&n.setProps(i)}),me.useImperativeHandle(t,()=>m.map,[n]);const l=me.useMemo(()=>({position:"relative",width:"100%",height:"100%",...i.style}),[i.style]),w={height:"100%"};return me.createElement("div",{id:i.id,ref:f,style:l},n&&me.createElement(i0.Provider,{value:m},me.createElement("div",{"mapboxgl-children":"",style:w},i.children)))}const O$=me.forwardRef(f9);var mR=vE();const d9=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Nh(i,t){if(!i||!t)return;const e=i.style;for(const n in t){const a=t[n];Number.isFinite(a)&&!d9.test(n)?e[n]=`${a}px`:e[n]=a}}function gR(i,t){if(i===t)return null;const e=hE(i),n=hE(t),a=[];for(const f of n)e.has(f)||a.push(f);for(const f of e)n.has(f)||a.push(f);return a.length===0?null:a}function hE(i){return new Set(i?i.trim().split(/\s+/):[])}me.memo(me.forwardRef((i,t)=>{const{map:e,mapLib:n}=me.useContext(i0),a=me.useRef({props:i}),f=me.useMemo(()=>{let mt=!1;me.Children.forEach(i.children,Pt=>{Pt&&(mt=!0)});const Mt={...i,element:mt?document.createElement("div"):void 0},pt=new n.Marker(Mt);return pt.setLngLat([i.longitude,i.latitude]),pt.getElement().addEventListener("click",Pt=>{a.current.props.onClick?.({type:"click",target:pt,originalEvent:Pt})}),pt.on("dragstart",Pt=>{const kt=Pt;kt.lngLat=f.getLngLat(),a.current.props.onDragStart?.(kt)}),pt.on("drag",Pt=>{const kt=Pt;kt.lngLat=f.getLngLat(),a.current.props.onDrag?.(kt)}),pt.on("dragend",Pt=>{const kt=Pt;kt.lngLat=f.getLngLat(),a.current.props.onDragEnd?.(kt)}),pt},[]);me.useEffect(()=>(f.addTo(e.getMap()),()=>{f.remove()}),[]);const{longitude:m,latitude:l,offset:w,style:C,draggable:P=!1,popup:L=null,rotation:j=0,rotationAlignment:G="auto",pitchAlignment:nt="auto"}=i;me.useEffect(()=>{Nh(f.getElement(),C)},[C]),me.useImperativeHandle(t,()=>f,[]);const at=a.current.props;(f.getLngLat().lng!==m||f.getLngLat().lat!==l)&&f.setLngLat([m,l]),w&&!n9(f.getOffset(),w)&&f.setOffset(w),f.isDraggable()!==P&&f.setDraggable(P),f.getRotation()!==j&&f.setRotation(j),f.getRotationAlignment()!==G&&f.setRotationAlignment(G),f.getPitchAlignment()!==nt&&f.setPitchAlignment(nt),f.getPopup()!==L&&f.setPopup(L);const J=gR(at.className,i.className);if(J)for(const mt of J)f.toggleClassName(mt);return a.current.props=i,mR.createPortal(i.children,f.getElement())}));me.memo(me.forwardRef((i,t)=>{const{map:e,mapLib:n}=me.useContext(i0),a=me.useMemo(()=>document.createElement("div"),[]),f=me.useRef({props:i}),m=me.useMemo(()=>{const l={...i},w=new n.Popup(l);return w.setLngLat([i.longitude,i.latitude]),w.once("open",C=>{f.current.props.onOpen?.(C)}),w},[]);if(me.useEffect(()=>{const l=w=>{f.current.props.onClose?.(w)};return m.on("close",l),m.setDOMContent(a).addTo(e.getMap()),()=>{m.off("close",l),m.isOpen()&&m.remove()}},[]),me.useEffect(()=>{Nh(m.getElement(),i.style)},[i.style]),me.useImperativeHandle(t,()=>m,[]),m.isOpen()){const l=f.current.props;(m.getLngLat().lng!==i.longitude||m.getLngLat().lat!==i.latitude)&&m.setLngLat([i.longitude,i.latitude]),i.offset&&!bu(l.offset,i.offset)&&m.setOffset(i.offset),(l.anchor!==i.anchor||l.maxWidth!==i.maxWidth)&&(m.options.anchor=i.anchor,m.setMaxWidth(i.maxWidth));const w=gR(l.className,i.className);if(w)for(const C of w)m.toggleClassName(C);f.current.props=i}return mR.createPortal(i.children,a)}));function Wp(i,t,e,n){const a=me.useContext(i0),f=me.useMemo(()=>i(a),[]);return me.useEffect(()=>{const m=t,l=null,w=typeof t=="function"?t:null,{map:C}=a;return C.hasControl(f)||(C.addControl(f,m?.position),l&&l(a)),()=>{w&&w(a),C.hasControl(f)&&C.removeControl(f)}},[]),f}function p9(i){const t=Wp(({mapLib:e})=>new e.AttributionControl(i),{position:i.position});return me.useEffect(()=>{Nh(t._container,i.style)},[i.style]),null}me.memo(p9);function m9(i){const t=Wp(({mapLib:e})=>new e.FullscreenControl({container:i.containerId&&document.getElementById(i.containerId)}),{position:i.position});return me.useEffect(()=>{Nh(t._controlContainer,i.style)},[i.style]),null}me.memo(m9);function g9(i,t){const e=me.useRef({props:i}),n=Wp(({mapLib:a})=>{const f=new a.GeolocateControl(i),m=f._setupUI;return f._setupUI=()=>{f._container.hasChildNodes()||m()},f.on("geolocate",l=>{e.current.props.onGeolocate?.(l)}),f.on("error",l=>{e.current.props.onError?.(l)}),f.on("outofmaxbounds",l=>{e.current.props.onOutOfMaxBounds?.(l)}),f.on("trackuserlocationstart",l=>{e.current.props.onTrackUserLocationStart?.(l)}),f.on("trackuserlocationend",l=>{e.current.props.onTrackUserLocationEnd?.(l)}),f},{position:i.position});return e.current.props=i,me.useImperativeHandle(t,()=>n,[]),me.useEffect(()=>{Nh(n._container,i.style)},[i.style]),null}me.memo(me.forwardRef(g9));function _9(i){const t=Wp(({mapLib:e})=>new e.NavigationControl(i),{position:i.position});return me.useEffect(()=>{Nh(t._container,i.style)},[i.style]),null}me.memo(_9);function y9(i){const t=Wp(({mapLib:f})=>new f.ScaleControl(i),{position:i.position}),e=me.useRef(i),n=e.current;e.current=i;const{style:a}=i;return i.maxWidth!==void 0&&i.maxWidth!==n.maxWidth&&(t.options.maxWidth=i.maxWidth),i.unit!==void 0&&i.unit!==n.unit&&t.setUnit(i.unit),me.useEffect(()=>{Nh(t._container,a)},[a]),null}me.memo(y9);function v9(i){const t=Wp(({mapLib:e})=>new e.TerrainControl(i),{position:i.position});return me.useEffect(()=>{Nh(t._container,i.style)},[i.style]),null}me.memo(v9);function b9(i){const t=Wp(({mapLib:e})=>new e.LogoControl(i),{position:i.position});return me.useEffect(()=>{Nh(t._container,i.style)},[i.style]),null}me.memo(b9);var fb={exports:{}};var x9=fb.exports,fE;function w9(){return fE||(fE=1,(function(i,t){(function(e,n){i.exports=n()})(x9,(function(){var e={},n={};function a(m,l,w){if(n[m]=w,m==="index"){var C="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",P={};return n.shared(P),n.index(e,P),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([C],{type:"text/javascript"}))),e}}a("shared",["exports"],(function(m){function l(u,r,o,p){return new(o||(o=Promise))((function(g,v){function x(D){try{R(p.next(D))}catch(B){v(B)}}function E(D){try{R(p.throw(D))}catch(B){v(B)}}function R(D){var B;D.done?g(D.value):(B=D.value,B instanceof o?B:new o((function(N){N(B)}))).then(x,E)}R((p=p.apply(u,r||[])).next())}))}function w(u,r){this.x=u,this.y=r}function C(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var P,L;typeof SuppressedError=="function"&&SuppressedError,w.prototype={clone(){return new w(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,r){return this.clone()._rotateAround(u,r)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const r=u.x-this.x,o=u.y-this.y;return r*r+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,r){return Math.atan2(this.x*r-this.y*u,this.x*u+this.y*r)},_matMult(u){const r=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=r,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const r=Math.cos(u),o=Math.sin(u),p=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=p,this},_rotateAround(u,r){const o=Math.cos(u),p=Math.sin(u),g=r.y+p*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-p*(this.y-r.y),this.y=g,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:w},w.convert=function(u){if(u instanceof w)return u;if(Array.isArray(u))return new w(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new w(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};var j=(function(){if(L)return P;function u(r,o,p,g){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=p,this.p2y=g}return L=1,P=u,u.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,g=0;g<8;g++){var v=this.sampleCurveX(p)-r;if(Math.abs(v)<o)return p;var x=this.sampleCurveDerivativeX(p);if(Math.abs(x)<1e-6)break;p-=v/x}var E=0,R=1;for(p=r,g=0;g<20&&(v=this.sampleCurveX(p),!(Math.abs(v-r)<o));g++)r>v?E=p:R=p,p=.5*(R-E)+E;return p},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},P})(),G=C(j);let nt,at;function J(){return nt==null&&(nt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),nt}function mt(){if(at==null&&(at=!1,J())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let p=0;p<25;p++){const g=4*p;r.fillStyle=`rgb(${g},${g+1},${g+2})`,r.fillRect(p%5,Math.floor(p/5),1,1)}const o=r.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&o[p]!==p){at=!0;break}}}return at||!1}var Mt=1e-6,pt=typeof Float32Array<"u"?Float32Array:Array;function Pt(){var u=new pt(9);return pt!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function kt(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function $t(){var u=new pt(3);return pt!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function ae(u){var r=u[0],o=u[1],p=u[2];return Math.sqrt(r*r+o*o+p*p)}function qt(u,r,o){var p=new pt(3);return p[0]=u,p[1]=r,p[2]=o,p}function le(u,r,o){return u[0]=r[0]+o[0],u[1]=r[1]+o[1],u[2]=r[2]+o[2],u}function Oe(u,r,o){return u[0]=r[0]*o,u[1]=r[1]*o,u[2]=r[2]*o,u}function Be(u,r,o){var p=r[0],g=r[1],v=r[2],x=o[0],E=o[1],R=o[2];return u[0]=g*R-v*E,u[1]=v*x-p*R,u[2]=p*E-g*x,u}var qe,ri=ae;function Ne(u,r,o){var p=r[0],g=r[1],v=r[2],x=r[3];return u[0]=o[0]*p+o[4]*g+o[8]*v+o[12]*x,u[1]=o[1]*p+o[5]*g+o[9]*v+o[13]*x,u[2]=o[2]*p+o[6]*g+o[10]*v+o[14]*x,u[3]=o[3]*p+o[7]*g+o[11]*v+o[15]*x,u}function wi(){var u=new pt(4);return pt!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function ne(u,r,o,p){var g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",v=Math.PI/360;r*=v,p*=v,o*=v;var x=Math.sin(r),E=Math.cos(r),R=Math.sin(o),D=Math.cos(o),B=Math.sin(p),N=Math.cos(p);switch(g){case"xyz":u[0]=x*D*N+E*R*B,u[1]=E*R*N-x*D*B,u[2]=E*D*B+x*R*N,u[3]=E*D*N-x*R*B;break;case"xzy":u[0]=x*D*N-E*R*B,u[1]=E*R*N-x*D*B,u[2]=E*D*B+x*R*N,u[3]=E*D*N+x*R*B;break;case"yxz":u[0]=x*D*N+E*R*B,u[1]=E*R*N-x*D*B,u[2]=E*D*B-x*R*N,u[3]=E*D*N+x*R*B;break;case"yzx":u[0]=x*D*N+E*R*B,u[1]=E*R*N+x*D*B,u[2]=E*D*B-x*R*N,u[3]=E*D*N-x*R*B;break;case"zxy":u[0]=x*D*N-E*R*B,u[1]=E*R*N+x*D*B,u[2]=E*D*B+x*R*N,u[3]=E*D*N-x*R*B;break;case"zyx":u[0]=x*D*N-E*R*B,u[1]=E*R*N+x*D*B,u[2]=E*D*B-x*R*N,u[3]=E*D*N+x*R*B;break;default:throw new Error("Unknown angle order "+g)}return u}function we(){var u=new pt(2);return pt!=Float32Array&&(u[0]=0,u[1]=0),u}function ye(u,r){var o=new pt(2);return o[0]=u,o[1]=r,o}$t(),qe=new pt(4),pt!=Float32Array&&(qe[0]=0,qe[1]=0,qe[2]=0,qe[3]=0),$t(),qt(1,0,0),qt(0,1,0),wi(),wi(),Pt(),we();const Ue=8192;function mi(u,r,o){return r*(Ue/(u.tileSize*Math.pow(2,o-u.tileID.overscaledZ)))}function Dt(u,r){return(u%r+r)%r}function he(u,r,o){return u*(1-o)+r*o}function Ce(u){if(u<=0)return 0;if(u>=1)return 1;const r=u*u,o=r*u;return 4*(u<.5?o:3*(u-r)+o-.75)}function Me(u,r,o,p){const g=new G(u,r,o,p);return v=>g.solve(v)}const ei=Me(.25,.1,.25,1);function ii(u,r,o){return Math.min(o,Math.max(r,u))}function Je(u,r,o){const p=o-r,g=((u-r)%p+p)%p+r;return g===r?o:g}function zi(u,...r){for(const o of r)for(const p in o)u[p]=o[p];return u}let Ui=1;function Ar(u,r,o){const p={};for(const g in u)p[g]=r.call(this,u[g],g,u);return p}function gs(u,r,o){const p={};for(const g in u)r.call(this,u[g],g,u)&&(p[g]=u[g]);return p}function ar(u){return Array.isArray(u)?u.map(ar):typeof u=="object"&&u?Ar(u,ar):u}const Dc={};function $i(u){Dc[u]||(typeof console<"u"&&console.warn(u),Dc[u]=!0)}function Ds(u,r,o){return(o.y-u.y)*(r.x-u.x)>(r.y-u.y)*(o.x-u.x)}function $s(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let wn=null;function aa(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Hs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function qo(u,r,o,p,g){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(u,{timestamp:0});try{const x=v?.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const E=x.startsWith("BGR"),R=new Uint8ClampedArray(p*g*4);if(yield v.copyTo(R,(function(D,B,N,V,$){const W=4*Math.max(-B,0),Z=(Math.max(0,N)-N)*V*4+W,K=4*V,it=Math.max(0,B),yt=Math.max(0,N);return{rect:{x:it,y:yt,width:Math.min(D.width,B+V)-it,height:Math.min(D.height,N+$)-yt},layout:[{offset:Z,stride:K}]}})(u,r,o,p,g)),E)for(let D=0;D<R.length;D+=4){const B=R[D];R[D]=R[D+2],R[D+2]=B}return R}finally{v.close()}}))}let Pa,Ia;function Xo(u,r,o,p){return u.addEventListener(r,o,p),{unsubscribe:()=>{u.removeEventListener(r,o,p)}}}function or(u){return u*Math.PI/180}function _s(u){return u/Math.PI*180}const kc={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Oc={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Da="AbortError";function Bc(){return new Error(Da)}const so={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Lc(u){return so.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Fl="global-dispatcher";class ts extends Error{constructor(r,o,p,g){super(`AJAXError: ${o} (${r}): ${p}`),this.status=r,this.statusText=o,this.url=p,this.body=g}}const yn=()=>$s(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ct=function(u,r){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=Lc(u.url);if(p)return p(u,r);if($s(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Fl},r)}if(!(/^file:/.test(o=u.url)||/^file:/.test(yn())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,g){return l(this,void 0,void 0,(function*(){const v=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:yn(),signal:g.signal});let x,E;p.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");try{x=yield fetch(v)}catch(D){throw new ts(0,D.message,p.url,new Blob)}if(!x.ok){const D=yield x.blob();throw new ts(x.status,x.statusText,p.url,D)}E=p.type==="arrayBuffer"||p.type==="image"?x.arrayBuffer():p.type==="json"?x.json():x.text();const R=yield E;if(g.signal.aborted)throw Bc();return{data:R,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}}))})(u,r);if($s(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Fl},r)}var o;return(function(p,g){return new Promise(((v,x)=>{var E;const R=new XMLHttpRequest;R.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(R.responseType="arraybuffer");for(const D in p.headers)R.setRequestHeader(D,p.headers[D]);p.type==="json"&&(R.responseType="text",!((E=p.headers)===null||E===void 0)&&E.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=p.credentials==="include",R.onerror=()=>{x(new Error(R.statusText))},R.onload=()=>{if(!g.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let D=R.response;if(p.type==="json")try{D=JSON.parse(R.response)}catch(B){return void x(B)}v({data:D,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const D=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});x(new ts(R.status,R.statusText,p.url,D))}},g.signal.addEventListener("abort",(()=>{R.abort(),x(Bc())})),R.send(p.body)}))})(u,r)};function Q(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const r=new URL(u),o=window.location;return r.protocol===o.protocol&&r.host===o.host}function tt(u,r,o){o[u]&&o[u].indexOf(r)!==-1||(o[u]=o[u]||[],o[u].push(r))}function rt(u,r,o){if(o&&o[u]){const p=o[u].indexOf(r);p!==-1&&o[u].splice(p,1)}}class bt{constructor(r,o={}){zi(this,o),this.type=r}}class wt extends bt{constructor(r,o={}){super("error",zi({error:r},o))}}class Ft{on(r,o){return this._listeners=this._listeners||{},tt(r,o,this._listeners),{unsubscribe:()=>{this.off(r,o)}}}off(r,o){return rt(r,o,this._listeners),rt(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},tt(r,o,this._oneTimeListeners),this):new Promise((p=>this.once(r,p)))}fire(r,o){typeof r=="string"&&(r=new bt(r,o||{}));const p=r.type;if(this.listens(p)){r.target=this;const g=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of g)E.call(this,r);const v=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of v)rt(p,E,this._oneTimeListeners),E.call(this,r);const x=this._eventedParent;x&&(zi(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof wt&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}var ut={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ot=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Kt(u,r){const o={};for(const p in u)p!=="ref"&&(o[p]=u[p]);return Ot.forEach((p=>{p in r&&(o[p]=r[p])})),o}function te(u,r){if(Array.isArray(u)){if(!Array.isArray(r)||u.length!==r.length)return!1;for(let o=0;o<u.length;o++)if(!te(u[o],r[o]))return!1;return!0}if(typeof u=="object"&&u!==null&&r!==null){if(typeof r!="object"||Object.keys(u).length!==Object.keys(r).length)return!1;for(const o in u)if(!te(u[o],r[o]))return!1;return!0}return u===r}function ie(u,r){u.push(r)}function De(u,r,o){ie(o,{command:"addSource",args:[u,r[u]]})}function He(u,r,o){ie(r,{command:"removeSource",args:[u]}),o[u]=!0}function si(u,r,o,p){He(u,o,p),De(u,r,o)}function Mn(u,r,o){let p;for(p in u[o])if(Object.prototype.hasOwnProperty.call(u[o],p)&&p!=="data"&&!te(u[o][p],r[o][p]))return!1;for(p in r[o])if(Object.prototype.hasOwnProperty.call(r[o],p)&&p!=="data"&&!te(u[o][p],r[o][p]))return!1;return!0}function gi(u,r,o,p,g,v){u=u||{},r=r||{};for(const x in u)Object.prototype.hasOwnProperty.call(u,x)&&(te(u[x],r[x])||o.push({command:v,args:[p,x,r[x],g]}));for(const x in r)Object.prototype.hasOwnProperty.call(r,x)&&!Object.prototype.hasOwnProperty.call(u,x)&&(te(u[x],r[x])||o.push({command:v,args:[p,x,r[x],g]}))}function Bi(u){return u.id}function Qi(u,r){return u[r.id]=r,u}class xe{constructor(r,o,p,g){this.message=(r?`${r}: `:"")+p,g&&(this.identifier=g),o!=null&&o.__line__&&(this.line=o.__line__)}}function Ji(u,...r){for(const o of r)for(const p in o)u[p]=o[p];return u}class tn extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}class Vn{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[p,g]of o)this.bindings[p]=g}concat(r){return new Vn(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Li={kind:"null"},fe={kind:"number"},Re={kind:"string"},We={kind:"boolean"},Ur={kind:"color"},Nl={kind:"projectionDefinition"},gr={kind:"object"},ni={kind:"value"},ks={kind:"collator"},Zo={kind:"formatted"},oa={kind:"padding"},Vr={kind:"colorArray"},la={kind:"numberArray"},ca={kind:"resolvedImage"},Rn={kind:"variableAnchorOffsetCollection"};function ys(u,r){return{kind:"array",itemType:u,N:r}}function en(u){if(u.kind==="array"){const r=en(u.itemType);return typeof u.N=="number"?`array<${r}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${r}>`}return u.kind}const zl=[Li,fe,Re,We,Ur,Nl,Zo,gr,ys(ni),oa,la,Vr,ca,Rn];function es(u,r){if(r.kind==="error")return null;if(u.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!es(u.itemType,r.itemType))&&(typeof u.N!="number"||u.N===r.N))return null}else{if(u.kind===r.kind)return null;if(u.kind==="value"){for(const o of zl)if(!es(o,r))return null}}return`Expected ${en(u)} but found ${en(r)} instead.`}function Cu(u,r){return r.some((o=>o.kind===u.kind))}function vn(u,r){return r.some((o=>o==="null"?u===null:o==="array"?Array.isArray(u):o==="object"?u&&!Array.isArray(u)&&typeof u=="object":o===typeof u))}function ao(u,r){return u.kind==="array"&&r.kind==="array"?u.itemType.kind===r.itemType.kind&&typeof u.N=="number":u.kind===r.kind}const id=.96422,oo=.82521,Fc=4/29,vs=6/29,Os=3*vs*vs,nd=vs*vs*vs,t_=Math.PI/180,zh=180/Math.PI;function rd(u){return(u%=360)<0&&(u+=360),u}function Mu([u,r,o,p]){let g,v;const x=bs((.2225045*(u=sd(u))+.7168786*(r=sd(r))+.0606169*(o=sd(o)))/1);u===r&&r===o?g=v=x:(g=bs((.4360747*u+.3850649*r+.1430804*o)/id),v=bs((.0139322*u+.0971045*r+.7141733*o)/oo));const E=116*x-16;return[E<0?0:E,500*(g-x),200*(x-v),p]}function sd(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function bs(u){return u>nd?Math.pow(u,1/3):u/Os+Fc}function Uh([u,r,o,p]){let g=(u+16)/116,v=isNaN(r)?g:g+r/500,x=isNaN(o)?g:g-o/200;return g=1*Ru(g),v=id*Ru(v),x=oo*Ru(x),[Vh(3.1338561*v-1.6168667*g-.4906146*x),Vh(-.9787684*v+1.9161415*g+.033454*x),Vh(.0719453*v-.2289914*g+1.4052427*x),p]}function Vh(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Ru(u){return u>vs?u*u*u:Os*(u-Fc)}const Ul=Object.hasOwn||function(u,r){return Object.prototype.hasOwnProperty.call(u,r)};function ka(u,r){return Ul(u,r)?u[r]:void 0}function Pu(u){return parseInt(u.padEnd(2,u),16)/255}function Vl(u,r){return Oa(r?u/100:u,0,1)}function Oa(u,r,o){return Math.min(Math.max(r,u),o)}function ad(u){return!u.some(Number.isNaN)}const qp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ba(u,r,o){return u+o*(r-u)}function jl(u,r,o){return u.map(((p,g)=>Ba(p,r[g],o)))}class bi{constructor(r,o,p,g=1,v=!0){this.r=r,this.g=o,this.b=p,this.a=g,v||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[r,o,p,g]))}static parse(r){if(r instanceof bi)return r;if(typeof r!="string")return;const o=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=ka(qp,p);if(g){const[x,E,R]=g;return[x/255,E/255,R/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const x=p.length<6?1:2;let E=1;return[Pu(p.slice(E,E+=x)),Pu(p.slice(E,E+=x)),Pu(p.slice(E,E+=x)),Pu(p.slice(E,E+x)||"ff")]}if(p.startsWith("rgb")){const x=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[E,R,D,B,N,V,$,W,Z,K,it,yt]=x,lt=[B||" ",$||" ",K].join("");if(lt==="  "||lt==="  /"||lt===",,"||lt===",,,"){const ft=[D,V,Z].join(""),At=ft==="%%%"?100:ft===""?255:0;if(At){const It=[Oa(+R/At,0,1),Oa(+N/At,0,1),Oa(+W/At,0,1),it?Vl(+it,yt):1];if(ad(It))return It}}return}}const v=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,E,R,D,B,N,V,$,W]=v,Z=[R||" ",B||" ",V].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const K=[+E,Oa(+D,0,100),Oa(+N,0,100),$?Vl(+$,W):1];if(ad(K))return(function([it,yt,lt,ft]){function At(It){const Xt=(It+it/30)%12,pe=yt*Math.min(lt,1-lt);return lt-pe*Math.max(-1,Math.min(Xt-3,9-Xt,1))}return it=rd(it),yt/=100,lt/=100,[At(0),At(8),At(4),ft]})(K)}}})(r);return o?new bi(...o,!1):void 0}get rgb(){const{r,g:o,b:p,a:g}=this,v=g||1/0;return this.overwriteGetter("rgb",[r/v,o/v,p/v,g])}get hcl(){return this.overwriteGetter("hcl",(function(r){const[o,p,g,v]=Mu(r),x=Math.sqrt(p*p+g*g);return[Math.round(1e4*x)?rd(Math.atan2(g,p)*zh):NaN,x,o,v]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Mu(this.rgb))}overwriteGetter(r,o){return Object.defineProperty(this,r,{value:o}),o}toString(){const[r,o,p,g]=this.rgb;return`rgba(${[r,o,p].map((v=>Math.round(255*v))).join(",")},${g})`}static interpolate(r,o,p,g="rgb"){switch(g){case"rgb":{const[v,x,E,R]=jl(r.rgb,o.rgb,p);return new bi(v,x,E,R,!1)}case"hcl":{const[v,x,E,R]=r.hcl,[D,B,N,V]=o.hcl;let $,W;if(isNaN(v)||isNaN(D))isNaN(v)?isNaN(D)?$=NaN:($=D,E!==1&&E!==0||(W=B)):($=v,N!==1&&N!==0||(W=x));else{let lt=D-v;D>v&&lt>180?lt-=360:D<v&&v-D>180&&(lt+=360),$=v+p*lt}const[Z,K,it,yt]=(function([lt,ft,At,It]){return lt=isNaN(lt)?0:lt*t_,Uh([At,Math.cos(lt)*ft,Math.sin(lt)*ft,It])})([$,W??Ba(x,B,p),Ba(E,N,p),Ba(R,V,p)]);return new bi(Z,K,it,yt,!1)}case"lab":{const[v,x,E,R]=Uh(jl(r.lab,o.lab,p));return new bi(v,x,E,R,!1)}}}}bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1);class is{constructor(r,o,p){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const hi=["bottom","center","top"];class La{constructor(r,o,p,g,v,x){this.text=r,this.image=o,this.scale=p,this.fontStack=g,this.textColor=v,this.verticalAlign=x}}class Bn{constructor(r){this.sections=r}static fromString(r){return new Bn([new La(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof Bn?r:Bn.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}}class jn{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof jn)return r;if(typeof r=="number")return new jn([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const o of r)if(typeof o!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new jn(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){return new jn(jl(r.values,o.values,p))}}class $n{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof $n)return r;if(typeof r=="number")return new $n([r]);if(Array.isArray(r)){for(const o of r)if(typeof o!="number")return;return new $n(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){return new $n(jl(r.values,o.values,p))}}class Kn{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Kn)return r;if(typeof r=="string"){const p=bi.parse(r);return p?new Kn([p]):void 0}if(!Array.isArray(r))return;const o=[];for(const p of r){if(typeof p!="string")return;const g=bi.parse(p);if(!g)return;o.push(g)}return new Kn(o)}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p,g="rgb"){const v=[];if(r.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let x=0;x<r.values.length;x++)v.push(bi.interpolate(r.values[x],o.values[x],p,g));return new Kn(v)}}class Zi extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const Iu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class lr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof lr)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let o=0;o<r.length;o+=2){const p=r[o],g=r[o+1];if(typeof p!="string"||!Iu.has(p)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new lr(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){const g=r.values,v=o.values;if(g.length!==v.length)throw new Zi(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${o.toString()}`);const x=[];for(let E=0;E<g.length;E+=2){if(g[E]!==v[E])throw new Zi(`Cannot interpolate values containing mismatched anchors. from[${E}]: ${g[E]}, to[${E}]: ${v[E]}`);x.push(g[E]);const[R,D]=g[E+1],[B,N]=v[E+1];x.push([Ba(R,B,p),Ba(D,N,p)])}return new lr(x)}}class Ln{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ln({name:r,available:!1}):null}}class _r{constructor(r,o,p){this.from=r,this.to=o,this.transition=p}static interpolate(r,o,p){return new _r(r,o,p)}static parse(r){return r instanceof _r?r:Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"?new _r(r[0],r[1],r[2]):typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number"?new _r(r.from,r.to,r.transition):typeof r=="string"?new _r(r,r,1):void 0}}function Nc(u,r,o,p){return typeof u=="number"&&u>=0&&u<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,r,o,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,r,o,p]:[u,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ns(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof _r||u instanceof bi||u instanceof is||u instanceof Bn||u instanceof jn||u instanceof $n||u instanceof Kn||u instanceof lr||u instanceof Ln)return!0;if(Array.isArray(u)){for(const r of u)if(!ns(r))return!1;return!0}if(typeof u=="object"){for(const r in u)if(!ns(u[r]))return!1;return!0}return!1}function nn(u){if(u===null)return Li;if(typeof u=="string")return Re;if(typeof u=="boolean")return We;if(typeof u=="number")return fe;if(u instanceof bi)return Ur;if(u instanceof _r)return Nl;if(u instanceof is)return ks;if(u instanceof Bn)return Zo;if(u instanceof jn)return oa;if(u instanceof $n)return la;if(u instanceof Kn)return Vr;if(u instanceof lr)return Rn;if(u instanceof Ln)return ca;if(Array.isArray(u)){const r=u.length;let o;for(const p of u){const g=nn(p);if(o){if(o===g)continue;o=ni;break}o=g}return ys(o||ni,r)}return gr}function lo(u){const r=typeof u;return u===null?"":r==="string"||r==="number"||r==="boolean"?String(u):u instanceof bi||u instanceof _r||u instanceof Bn||u instanceof jn||u instanceof $n||u instanceof Kn||u instanceof lr||u instanceof Ln?u.toString():JSON.stringify(u)}class co{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ns(r[1]))return o.error("invalid value");const p=r[1];let g=nn(p);const v=o.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new co(g,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Go={string:Re,number:fe,boolean:We,object:gr};class Er{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let p,g=1;const v=r[0];if(v==="array"){let E,R;if(r.length>2){const D=r[1];if(typeof D!="string"||!(D in Go)||D==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);E=Go[D],g++}else E=ni;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);R=r[2],g++}p=ys(E,R)}else{if(!Go[v])throw new Error(`Types doesn't contain name = ${v}`);p=Go[v]}const x=[];for(;g<r.length;g++){const E=o.parse(r[g],g,ni);if(!E)return null;x.push(E)}return new Er(p,x)}evaluate(r){for(let o=0;o<this.args.length;o++){const p=this.args[o].evaluate(r);if(!es(this.type,nn(p)))return p;if(o===this.args.length-1)throw new Zi(`Expected value to be of type ${en(this.type)}, but found ${en(nn(p))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const ln={"to-boolean":We,"to-color":Ur,"to-number":fe,"to-string":Re};class Pn{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const p=r[0];if(!ln[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return o.error("Expected one argument.");const g=ln[p],v=[];for(let x=1;x<r.length;x++){const E=o.parse(r[x],x,ni);if(!E)return null;v.push(E)}return new Pn(g,v)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let o,p;for(const g of this.args){if(o=g.evaluate(r),p=null,o instanceof bi)return o;if(typeof o=="string"){const v=r.parseColor(o);if(v)return v}else if(Array.isArray(o)&&(p=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Nc(o[0],o[1],o[2],o[3]),!p))return new bi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Zi(p||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const p of this.args){o=p.evaluate(r);const g=jn.parse(o);if(g)return g}throw new Zi(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(const p of this.args){o=p.evaluate(r);const g=$n.parse(o);if(g)return g}throw new Zi(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(const p of this.args){o=p.evaluate(r);const g=Kn.parse(o);if(g)return g}throw new Zi(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const p of this.args){o=p.evaluate(r);const g=lr.parse(o);if(g)return g}throw new Zi(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const p of this.args){if(o=p.evaluate(r),o===null)return 0;const g=Number(o);if(!isNaN(g))return g}throw new Zi(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Bn.fromString(lo(this.args[0].evaluate(r)));case"resolvedImage":return Ln.fromString(lo(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return lo(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const _i=["Unknown","Point","LineString","Polygon"];class oi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_i[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let o=this._parseColorCache.get(r);return o||(o=bi.parse(r),this._parseColorCache.set(r,o)),o}}class Fa{constructor(r,o,p=[],g,v=new Vn,x=[]){this.registry=r,this.path=p,this.key=p.map((E=>`[${E}]`)).join(""),this.scope=v,this.errors=x,this.expectedType=g,this._isConstant=o}parse(r,o,p,g,v={}){return o?this.concat(o,p,g)._parse(r,v):this._parse(r,v)}_parse(r,o){function p(g,v,x){return x==="assert"?new Er(v,[g]):x==="coerce"?new Pn(v,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let x=v.parse(r,this);if(!x)return null;if(this.expectedType){const E=this.expectedType,R=x.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||R.kind!=="value"){if(E.kind==="projectionDefinition"&&["string","array"].includes(R.kind)||["color","formatted","resolvedImage"].includes(E.kind)&&["value","string"].includes(R.kind)||["padding","numberArray"].includes(E.kind)&&["value","number","array"].includes(R.kind)||E.kind==="colorArray"&&["value","string","array"].includes(R.kind)||E.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(R.kind))x=p(x,E,o.typeAnnotation||"coerce");else if(this.checkSubtype(E,R))return null}else x=p(x,E,o.typeAnnotation||"assert")}if(!(x instanceof co)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const E=new oi;try{x=new co(x.type,x.evaluate(E))}catch(R){return this.error(R.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,p){const g=typeof r=="number"?this.path.concat(r):this.path,v=p?this.scope.concat(p):this.scope;return new Fa(this.registry,this._isConstant,g,o||null,v,this.errors)}error(r,...o){const p=`${this.key}${o.map((g=>`[${g}]`)).join("")}`;this.errors.push(new tn(p,r))}checkSubtype(r,o){const p=es(r,o);return p&&this.error(p),p}}class Ei{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let v=1;v<r.length-1;v+=2){const x=r[v];if(typeof x!="string")return o.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return o.error("Variable names must contain only alphanumeric characters or '_'.",v);const E=o.parse(r[v+1],v+1);if(!E)return null;p.push([x,E])}const g=o.parse(r[r.length-1],r.length-1,o.expectedType,p);return g?new Ei(p,g):null}outputDefined(){return this.result.outputDefined()}}class Yo{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const p=r[1];return o.scope.has(p)?new Yo(p,o.scope.get(p)):o.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Bs{constructor(r,o,p){this.type=r,this.index=o,this.input=p}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,fe),g=o.parse(r[2],2,ys(o.expectedType||ni));return p&&g?new Bs(g.type.itemType,p,g):null}evaluate(r){const o=this.index.evaluate(r),p=this.input.evaluate(r);if(o<0)throw new Zi(`Array index out of bounds: ${o} < 0.`);if(o>=p.length)throw new Zi(`Array index out of bounds: ${o} > ${p.length-1}.`);if(o!==Math.floor(o))throw new Zi(`Array index must be an integer, but found ${o} instead.`);return p[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class uo{constructor(r,o){this.type=We,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,ni),g=o.parse(r[2],2,ni);return p&&g?Cu(p.type,[We,Re,fe,Li,ni])?new uo(p,g):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${en(p.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!vn(o,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${en(nn(o))} instead.`);if(!vn(p,["string","array"]))throw new Zi(`Expected second argument to be of type array or string, but found ${en(nn(p))} instead.`);return p.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Na{constructor(r,o,p){this.type=fe,this.needle=r,this.haystack=o,this.fromIndex=p}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 2 or 3 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,ni),g=o.parse(r[2],2,ni);if(!p||!g)return null;if(!Cu(p.type,[We,Re,fe,Li,ni]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${en(p.type)} instead`);if(r.length===4){const v=o.parse(r[3],3,fe);return v?new Na(p,g,v):null}return new Na(p,g)}evaluate(r){const o=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!vn(o,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${en(nn(o))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(r)),vn(p,["string"])){const v=p.indexOf(o,g);return v===-1?-1:[...p.slice(0,v)].length}if(vn(p,["array"]))return p.indexOf(o,g);throw new Zi(`Expected second argument to be of type array or string, but found ${en(nn(p))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Du{constructor(r,o,p,g,v,x){this.inputType=r,this.type=o,this.input=p,this.cases=g,this.outputs=v,this.otherwise=x}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let p,g;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);const v={},x=[];for(let D=2;D<r.length-1;D+=2){let B=r[D];const N=r[D+1];Array.isArray(B)||(B=[B]);const V=o.concat(D);if(B.length===0)return V.error("Expected at least one branch label.");for(const W of B){if(typeof W!="number"&&typeof W!="string")return V.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return V.error("Numeric branch labels must be integer values.");if(p){if(V.checkSubtype(p,nn(W)))return null}else p=nn(W);if(v[String(W)]!==void 0)return V.error("Branch labels must be unique.");v[String(W)]=x.length}const $=o.parse(N,D,g);if(!$)return null;g=g||$.type,x.push($)}const E=o.parse(r[1],1,ni);if(!E)return null;const R=o.parse(r[r.length-1],r.length-1,g);return R?E.type.kind!=="value"&&o.concat(1).checkSubtype(p,E.type)?null:new Du(p,g,E,v,x,R):null}evaluate(r){const o=this.input.evaluate(r);return(nn(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}}class ku{constructor(r,o,p){this.type=r,this.branches=o,this.otherwise=p}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const g=[];for(let x=1;x<r.length-1;x+=2){const E=o.parse(r[x],x,We);if(!E)return null;const R=o.parse(r[x+1],x+1,p);if(!R)return null;g.push([E,R]),p=p||R.type}const v=o.parse(r[r.length-1],r.length-1,p);if(!v)return null;if(!p)throw new Error("Can't infer output type");return new ku(p,g,v)}evaluate(r){for(const[o,p]of this.branches)if(o.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,p]of this.branches)r(o),r(p);r(this.otherwise)}outputDefined(){return this.branches.every((([r,o])=>o.outputDefined()))&&this.otherwise.outputDefined()}}class Ou{constructor(r,o,p,g){this.type=r,this.input=o,this.beginIndex=p,this.endIndex=g}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 2 or 3 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,ni),g=o.parse(r[2],2,fe);if(!p||!g)return null;if(!Cu(p.type,[ys(ni),Re,ni]))return o.error(`Expected first argument to be of type array or string, but found ${en(p.type)} instead`);if(r.length===4){const v=o.parse(r[3],3,fe);return v?new Ou(p.type,p,g,v):null}return new Ou(p.type,p,g)}evaluate(r){const o=this.input.evaluate(r),p=this.beginIndex.evaluate(r);let g;if(this.endIndex&&(g=this.endIndex.evaluate(r)),vn(o,["string"]))return[...o].slice(p,g).join("");if(vn(o,["array"]))return o.slice(p,g);throw new Zi(`Expected first argument to be of type array or string, but found ${en(nn(o))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function jh(u,r){const o=u.length-1;let p,g,v=0,x=o,E=0;for(;v<=x;)if(E=Math.floor((v+x)/2),p=u[E],g=u[E+1],p<=r){if(E===o||r<g)return E;v=E+1}else{if(!(p>r))throw new Zi("Input is not a number.");x=E-1}return 0}class Ko{constructor(r,o,p){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const p=o.parse(r[1],1,fe);if(!p)return null;const g=[];let v=null;o.expectedType&&o.expectedType.kind!=="value"&&(v=o.expectedType);for(let x=1;x<r.length;x+=2){const E=x===1?-1/0:r[x],R=r[x+1],D=x,B=x+1;if(typeof E!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=E)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const N=o.parse(R,B,v);if(!N)return null;v=v||N.type,g.push([E,N])}return new Ko(v,p,g)}evaluate(r){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(r);const g=this.input.evaluate(r);if(g<=o[0])return p[0].evaluate(r);const v=o.length;return g>=o[v-1]?p[v-1].evaluate(r):p[jh(o,g)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function Xp(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var za,Cr,$h=(function(){if(Cr)return za;function u(r,o,p,g){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=p,this.p2y=g}return Cr=1,za=u,u.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,g=0;g<8;g++){var v=this.sampleCurveX(p)-r;if(Math.abs(v)<o)return p;var x=this.sampleCurveDerivativeX(p);if(Math.abs(x)<1e-6)break;p-=v/x}var E=0,R=1;for(p=r,g=0;g<20&&(v=this.sampleCurveX(p),!(Math.abs(v-r)<o));g++)r>v?E=p:R=p,p=.5*(R-E)+E;return p},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},za})(),Zp=Xp($h);class yr{constructor(r,o,p,g,v){this.type=r,this.operator=o,this.interpolation=p,this.input=g,this.labels=[],this.outputs=[];for(const[x,E]of v)this.labels.push(x),this.outputs.push(E)}static interpolationFactor(r,o,p,g){let v=0;if(r.name==="exponential")v=Qn(o,r.base,p,g);else if(r.name==="linear")v=Qn(o,1,p,g);else if(r.name==="cubic-bezier"){const x=r.controlPoints;v=new Zp(x[0],x[1],x[2],x[3]).solve(Qn(o,1,p,g))}return v}static parse(r,o){let[p,g,v,...x]=r;if(!Array.isArray(g)||g.length===0)return o.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some((B=>typeof B!="number"||B<0||B>1)))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(v=o.parse(v,2,fe),!v)return null;const E=[];let R=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||o.expectedType==Vr?o.expectedType&&o.expectedType.kind!=="value"&&(R=o.expectedType):R=Ur;for(let D=0;D<x.length;D+=2){const B=x[D],N=x[D+1],V=D+3,$=D+4;if(typeof B!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(E.length&&E[E.length-1][0]>=B)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const W=o.parse(N,$,R);if(!W)return null;R=R||W.type,E.push([B,W])}return ao(R,fe)||ao(R,Nl)||ao(R,Ur)||ao(R,oa)||ao(R,la)||ao(R,Vr)||ao(R,Rn)||ao(R,ys(fe))?new yr(R,p,g,v,E):o.error(`Type ${en(R)} is not interpolatable.`)}evaluate(r){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(r);const g=this.input.evaluate(r);if(g<=o[0])return p[0].evaluate(r);const v=o.length;if(g>=o[v-1])return p[v-1].evaluate(r);const x=jh(o,g),E=yr.interpolationFactor(this.interpolation,g,o[x],o[x+1]),R=p[x].evaluate(r),D=p[x+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ba(R,D,E);case"color":return bi.interpolate(R,D,E);case"padding":return jn.interpolate(R,D,E);case"colorArray":return Kn.interpolate(R,D,E);case"numberArray":return $n.interpolate(R,D,E);case"variableAnchorOffsetCollection":return lr.interpolate(R,D,E);case"array":return jl(R,D,E);case"projectionDefinition":return _r.interpolate(R,D,E)}case"interpolate-hcl":switch(this.type.kind){case"color":return bi.interpolate(R,D,E,"hcl");case"colorArray":return Kn.interpolate(R,D,E,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return bi.interpolate(R,D,E,"lab");case"colorArray":return Kn.interpolate(R,D,E,"lab")}}}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function Qn(u,r,o,p){const g=p-o,v=u-o;return g===0?0:r===1?v/g:(Math.pow(r,v)-1)/(Math.pow(r,g)-1)}const ua={color:bi.interpolate,number:Ba,padding:jn.interpolate,numberArray:$n.interpolate,colorArray:Kn.interpolate,variableAnchorOffsetCollection:lr.interpolate,array:jl};class zc{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let p=null;const g=o.expectedType;g&&g.kind!=="value"&&(p=g);const v=[];for(const E of r.slice(1)){const R=o.parse(E,1+v.length,p,void 0,{typeAnnotation:"omit"});if(!R)return null;p=p||R.type,v.push(R)}if(!p)throw new Error("No output type");const x=g&&v.some((E=>es(g,E.type)));return new zc(x?ni:p,v)}evaluate(r){let o,p=null,g=0;for(const v of this.args)if(g++,p=v.evaluate(r),p&&p instanceof Ln&&!p.available&&(o||(o=p.name),p=null,g===this.args.length&&(p=o)),p!==null)break;return p}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}function od(u,r){return u==="=="||u==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Hh(u,r,o,p){return p.compare(r,o)===0}function ha(u,r,o){const p=u!=="=="&&u!=="!=";return class _R{constructor(v,x,E){this.type=We,this.lhs=v,this.rhs=x,this.collator=E,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const E=v[0];let R=x.parse(v[1],1,ni);if(!R)return null;if(!od(E,R.type))return x.concat(1).error(`"${E}" comparisons are not supported for type '${en(R.type)}'.`);let D=x.parse(v[2],2,ni);if(!D)return null;if(!od(E,D.type))return x.concat(2).error(`"${E}" comparisons are not supported for type '${en(D.type)}'.`);if(R.type.kind!==D.type.kind&&R.type.kind!=="value"&&D.type.kind!=="value")return x.error(`Cannot compare types '${en(R.type)}' and '${en(D.type)}'.`);p&&(R.type.kind==="value"&&D.type.kind!=="value"?R=new Er(D.type,[R]):R.type.kind!=="value"&&D.type.kind==="value"&&(D=new Er(R.type,[D])));let B=null;if(v.length===4){if(R.type.kind!=="string"&&D.type.kind!=="string"&&R.type.kind!=="value"&&D.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(B=x.parse(v[3],3,ks),!B)return null}return new _R(R,D,B)}evaluate(v){const x=this.lhs.evaluate(v),E=this.rhs.evaluate(v);if(p&&this.hasUntypedArgument){const R=nn(x),D=nn(E);if(R.kind!==D.kind||R.kind!=="string"&&R.kind!=="number")throw new Zi(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${R.kind}, ${D.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const R=nn(x),D=nn(E);if(R.kind!=="string"||D.kind!=="string")return r(v,x,E)}return this.collator?o(v,x,E,this.collator.evaluate(v)):r(v,x,E)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Wh=ha("==",(function(u,r,o){return r===o}),Hh),ld=ha("!=",(function(u,r,o){return r!==o}),(function(u,r,o,p){return!Hh(0,r,o,p)})),Gp=ha("<",(function(u,r,o){return r<o}),(function(u,r,o,p){return p.compare(r,o)<0})),Yp=ha(">",(function(u,r,o){return r>o}),(function(u,r,o,p){return p.compare(r,o)>0})),qh=ha("<=",(function(u,r,o){return r<=o}),(function(u,r,o,p){return p.compare(r,o)<=0})),Xh=ha(">=",(function(u,r,o){return r>=o}),(function(u,r,o,p){return p.compare(r,o)>=0}));class xs{constructor(r,o,p){this.type=ks,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return o.error("Collator options argument must be an object.");const g=o.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,We);if(!g)return null;const v=o.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,We);if(!v)return null;let x=null;return p.locale&&(x=o.parse(p.locale,1,Re),!x)?null:new xs(g,v,x)}evaluate(r){return new is(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class Zh{constructor(r,o,p,g,v){this.type=Re,this.number=r,this.locale=o,this.currency=p,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const p=o.parse(r[1],1,fe);if(!p)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return o.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=o.parse(g.locale,1,Re),!v))return null;let x=null;if(g.currency&&(x=o.parse(g.currency,1,Re),!x))return null;let E=null;if(g["min-fraction-digits"]&&(E=o.parse(g["min-fraction-digits"],1,fe),!E))return null;let R=null;return g["max-fraction-digits"]&&(R=o.parse(g["max-fraction-digits"],1,fe),!R)?null:new Zh(p,v,x,E,R)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class $l{constructor(r){this.type=Zo,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return o.error("First argument must be an image or text section.");const g=[];let v=!1;for(let x=1;x<=r.length-1;++x){const E=r[x];if(v&&typeof E=="object"&&!Array.isArray(E)){v=!1;let R=null;if(E["font-scale"]&&(R=o.parse(E["font-scale"],1,fe),!R))return null;let D=null;if(E["text-font"]&&(D=o.parse(E["text-font"],1,ys(Re)),!D))return null;let B=null;if(E["text-color"]&&(B=o.parse(E["text-color"],1,Ur),!B))return null;let N=null;if(E["vertical-align"]){if(typeof E["vertical-align"]=="string"&&!hi.includes(E["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${E["vertical-align"]}' instead.`);if(N=o.parse(E["vertical-align"],1,Re),!N)return null}const V=g[g.length-1];V.scale=R,V.font=D,V.textColor=B,V.verticalAlign=N}else{const R=o.parse(r[x],1,ni);if(!R)return null;const D=R.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:R,scale:null,font:null,textColor:null,verticalAlign:null})}}return new $l(g)}evaluate(r){return new Bn(this.sections.map((o=>{const p=o.content.evaluate(r);return nn(p)===ca?new La("",p,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(r):null):new La(lo(p),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null,o.verticalAlign?o.verticalAlign.evaluate(r):null)})))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor),o.verticalAlign&&r(o.verticalAlign)}outputDefined(){return!1}}class cd{constructor(r){this.type=ca,this.input=r}static parse(r,o){if(r.length!==2)return o.error("Expected two arguments.");const p=o.parse(r[1],1,Re);return p?new cd(p):o.error("No image name provided.")}evaluate(r){const o=this.input.evaluate(r),p=Ln.fromString(o);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(o)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}}class Bu{constructor(r){this.type=fe,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=o.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${en(p.type)} instead.`):new Bu(p):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new Zi(`Expected value to be of type string or array, but found ${en(nn(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Ua=8192;function ud(u,r){const o=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(o*g*Ua),Math.round(p*g*Ua)]}function Hl(u,r){const o=Math.pow(2,r.z);return[(g=(u[0]/Ua+r.x)/o,360*g-180),(p=(u[1]/Ua+r.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,g}function Lu(u,r){u[0]=Math.min(u[0],r[0]),u[1]=Math.min(u[1],r[1]),u[2]=Math.max(u[2],r[0]),u[3]=Math.max(u[3],r[1])}function ho(u,r){return!(u[0]<=r[0]||u[2]>=r[2]||u[1]<=r[1]||u[3]>=r[3])}function Kp(u,r,o){const p=u[0]-r[0],g=u[1]-r[1],v=u[0]-o[0],x=u[1]-o[1];return p*x-v*g==0&&p*v<=0&&g*x<=0}function Uc(u,r,o,p){return(g=[p[0]-o[0],p[1]-o[1]])[0]*(v=[r[0]-u[0],r[1]-u[1]])[1]-g[1]*v[0]!=0&&!(!Jp(u,r,o,p)||!Jp(o,p,u,r));var g,v}function hd(u,r,o){for(const p of o)for(let g=0;g<p.length-1;++g)if(Uc(u,r,p[g],p[g+1]))return!0;return!1}function Wl(u,r,o=!1){let p=!1;for(const E of r)for(let R=0;R<E.length-1;R++){if(Kp(u,E[R],E[R+1]))return o;(v=E[R])[1]>(g=u)[1]!=(x=E[R+1])[1]>g[1]&&g[0]<(x[0]-v[0])*(g[1]-v[1])/(x[1]-v[1])+v[0]&&(p=!p)}var g,v,x;return p}function ql(u,r){for(const o of r)if(Wl(u,o))return!0;return!1}function Qp(u,r){for(const o of u)if(!Wl(o,r))return!1;for(let o=0;o<u.length-1;++o)if(hd(u[o],u[o+1],r))return!1;return!0}function e_(u,r){for(const o of r)if(Qp(u,o))return!0;return!1}function Jp(u,r,o,p){const g=p[0]-o[0],v=p[1]-o[1],x=(u[0]-o[0])*v-g*(u[1]-o[1]),E=(r[0]-o[0])*v-g*(r[1]-o[1]);return x>0&&E<0||x<0&&E>0}function Gh(u,r,o){const p=[];for(let g=0;g<u.length;g++){const v=[];for(let x=0;x<u[g].length;x++){const E=ud(u[g][x],o);Lu(r,E),v.push(E)}p.push(v)}return p}function fd(u,r,o){const p=[];for(let g=0;g<u.length;g++){const v=Gh(u[g],r,o);p.push(v)}return p}function Xl(u,r,o,p){if(u[0]<o[0]||u[0]>o[2]){const g=.5*p;let v=u[0]-o[0]>g?-p:o[0]-u[0]>g?p:0;v===0&&(v=u[0]-o[2]>g?-p:o[2]-u[0]>g?p:0),u[0]+=v}Lu(r,u)}function Zl(u,r,o,p){const g=Math.pow(2,p.z)*Ua,v=[p.x*Ua,p.y*Ua],x=[];for(const E of u)for(const R of E){const D=[R.x+v[0],R.y+v[1]];Xl(D,r,o,g),x.push(D)}return x}function dd(u,r,o,p){const g=Math.pow(2,p.z)*Ua,v=[p.x*Ua,p.y*Ua],x=[];for(const R of u){const D=[];for(const B of R){const N=[B.x+v[0],B.y+v[1]];Lu(r,N),D.push(N)}x.push(D)}if(r[2]-r[0]<=g/2){(E=r)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const R of x)for(const D of R)Xl(D,r,o,g)}var E;return x}class Va{constructor(r,o){this.type=We,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ns(r[1])){const p=r[1];if(p.type==="FeatureCollection"){const g=[];for(const v of p.features){const{type:x,coordinates:E}=v.geometry;x==="Polygon"&&g.push(E),x==="MultiPolygon"&&g.push(...E)}if(g.length)return new Va(p,{type:"MultiPolygon",coordinates:g})}else if(p.type==="Feature"){const g=p.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Va(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Va(p,p)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(o,p){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(p.type==="Polygon"){const E=Gh(p.coordinates,v,x),R=Zl(o.geometry(),g,v,x);if(!ho(g,v))return!1;for(const D of R)if(!Wl(D,E))return!1}if(p.type==="MultiPolygon"){const E=fd(p.coordinates,v,x),R=Zl(o.geometry(),g,v,x);if(!ho(g,v))return!1;for(const D of R)if(!ql(D,E))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(o,p){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(p.type==="Polygon"){const E=Gh(p.coordinates,v,x),R=dd(o.geometry(),g,v,x);if(!ho(g,v))return!1;for(const D of R)if(!Qp(D,E))return!1}if(p.type==="MultiPolygon"){const E=fd(p.coordinates,v,x),R=dd(o.geometry(),g,v,x);if(!ho(g,v))return!1;for(const D of R)if(!e_(D,E))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pd=class{constructor(u=[],r=(o,p)=>o<p?-1:o>p?1:0){if(this.data=u,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:r,compare:o}=this,p=r[u];for(;u>0;){const g=u-1>>1,v=r[g];if(o(p,v)>=0)break;r[u]=v,u=g}r[u]=p}_down(u){const{data:r,compare:o}=this,p=this.length>>1,g=r[u];for(;u<p;){let v=1+(u<<1);const x=v+1;if(x<this.length&&o(r[x],r[v])<0&&(v=x),o(r[v],g)>=0)break;r[u]=r[v],u=v}r[u]=g}};function md(u,r,o=0,p=u.length-1,g=Vc){for(;p>o;){if(p-o>600){const R=p-o+1,D=r-o+1,B=Math.log(R),N=.5*Math.exp(2*B/3),V=.5*Math.sqrt(B*N*(R-N)/R)*(D-R/2<0?-1:1);md(u,r,Math.max(o,Math.floor(r-D*N/R+V)),Math.min(p,Math.floor(r+(R-D)*N/R+V)),g)}const v=u[r];let x=o,E=p;for(Gl(u,o,r),g(u[p],v)>0&&Gl(u,o,p);x<E;){for(Gl(u,x,E),x++,E--;g(u[x],v)<0;)x++;for(;g(u[E],v)>0;)E--}g(u[o],v)===0?Gl(u,o,E):(E++,Gl(u,E,p)),E<=r&&(o=E+1),r<=E&&(p=E-1)}}function Gl(u,r,o){const p=u[r];u[r]=u[o],u[o]=p}function Vc(u,r){return u<r?-1:u>r?1:0}function jc(u,r){if(u.length<=1)return[u];const o=[];let p,g;for(const v of u){const x=em(v);x!==0&&(v.area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(p&&o.push(p),p=[v]):p.push(v))}if(p&&o.push(p),r>1)for(let v=0;v<o.length;v++)o[v].length<=r||(md(o[v],r,1,o[v].length-1,tm),o[v]=o[v].slice(0,r));return o}function tm(u,r){return r.area-u.area}function em(u){let r=0;for(let o,p,g=0,v=u.length,x=v-1;g<v;x=g++)o=u[g],p=u[x],r+=(p.x-o.x)*(o.y+p.y);return r}const im=1/298.257223563,Yh=im*(2-im),gd=Math.PI/180;class _d{constructor(r){const o=6378.137*gd*1e3,p=Math.cos(r*gd),g=1/(1-Yh*(1-p*p)),v=Math.sqrt(g);this.kx=o*v*p,this.ky=o*v*g*(1-Yh)}distance(r,o){const p=this.wrap(r[0]-o[0])*this.kx,g=(r[1]-o[1])*this.ky;return Math.sqrt(p*p+g*g)}pointOnLine(r,o){let p,g,v,x,E=1/0;for(let R=0;R<r.length-1;R++){let D=r[R][0],B=r[R][1],N=this.wrap(r[R+1][0]-D)*this.kx,V=(r[R+1][1]-B)*this.ky,$=0;N===0&&V===0||($=(this.wrap(o[0]-D)*this.kx*N+(o[1]-B)*this.ky*V)/(N*N+V*V),$>1?(D=r[R+1][0],B=r[R+1][1]):$>0&&(D+=N/this.kx*$,B+=V/this.ky*$)),N=this.wrap(o[0]-D)*this.kx,V=(o[1]-B)*this.ky;const W=N*N+V*V;W<E&&(E=W,p=D,g=B,v=R,x=$)}return{point:[p,g],index:v,t:Math.max(0,Math.min(1,x))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function nm(u,r){return r[0]-u[0]}function Mr(u){return u[1]-u[0]+1}function ws(u,r){return u[1]>=u[0]&&u[1]<r}function Kh(u,r){if(u[0]>u[1])return[null,null];const o=Mr(u);if(r){if(o===2)return[u,null];const g=Math.floor(o/2);return[[u[0],u[0]+g],[u[0]+g,u[1]]]}if(o===1)return[u,null];const p=Math.floor(o/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}function Qh(u,r){if(!ws(r,u.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let p=r[0];p<=r[1];++p)Lu(o,u[p]);return o}function Jh(u){const r=[1/0,1/0,-1/0,-1/0];for(const o of u)for(const p of o)Lu(r,p);return r}function tf(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Fu(u,r,o){if(!tf(u)||!tf(r))return NaN;let p=0,g=0;return u[2]<r[0]&&(p=r[0]-u[2]),u[0]>r[2]&&(p=u[0]-r[2]),u[1]>r[3]&&(g=u[1]-r[3]),u[3]<r[1]&&(g=r[1]-u[3]),o.distance([0,0],[p,g])}function Yl(u,r,o){const p=o.pointOnLine(r,u);return o.distance(u,p.point)}function Qo(u,r,o,p,g){const v=Math.min(Yl(u,[o,p],g),Yl(r,[o,p],g)),x=Math.min(Yl(o,[u,r],g),Yl(p,[u,r],g));return Math.min(v,x)}function yd(u,r,o,p,g){if(!ws(r,u.length)||!ws(p,o.length))return 1/0;let v=1/0;for(let x=r[0];x<r[1];++x){const E=u[x],R=u[x+1];for(let D=p[0];D<p[1];++D){const B=o[D],N=o[D+1];if(Uc(E,R,B,N))return 0;v=Math.min(v,Qo(E,R,B,N,g))}}return v}function Mi(u,r,o,p,g){if(!ws(r,u.length)||!ws(p,o.length))return NaN;let v=1/0;for(let x=r[0];x<=r[1];++x)for(let E=p[0];E<=p[1];++E)if(v=Math.min(v,g.distance(u[x],o[E])),v===0)return v;return v}function vd(u,r,o){if(Wl(u,r,!0))return 0;let p=1/0;for(const g of r){const v=g[0],x=g[g.length-1];if(v!==x&&(p=Math.min(p,Yl(u,[x,v],o)),p===0))return p;const E=o.pointOnLine(g,u);if(p=Math.min(p,o.distance(u,E.point)),p===0)return p}return p}function rm(u,r,o,p){if(!ws(r,u.length))return NaN;for(let v=r[0];v<=r[1];++v)if(Wl(u[v],o,!0))return 0;let g=1/0;for(let v=r[0];v<r[1];++v){const x=u[v],E=u[v+1];for(const R of o)for(let D=0,B=R.length,N=B-1;D<B;N=D++){const V=R[N],$=R[D];if(Uc(x,E,V,$))return 0;g=Math.min(g,Qo(x,E,V,$,p))}}return g}function Jo(u,r){for(const o of u)for(const p of o)if(Wl(p,r,!0))return!0;return!1}function $c(u,r,o,p=1/0){const g=Jh(u),v=Jh(r);if(p!==1/0&&Fu(g,v,o)>=p)return p;if(ho(g,v)){if(Jo(u,r))return 0}else if(Jo(r,u))return 0;let x=1/0;for(const E of u)for(let R=0,D=E.length,B=D-1;R<D;B=R++){const N=E[B],V=E[R];for(const $ of r)for(let W=0,Z=$.length,K=Z-1;W<Z;K=W++){const it=$[K],yt=$[W];if(Uc(N,V,it,yt))return 0;x=Math.min(x,Qo(N,V,it,yt,o))}}return x}function ef(u,r,o,p,g,v){if(!v)return;const x=Fu(Qh(p,v),g,o);x<r&&u.push([x,v,[0,0]])}function Nu(u,r,o,p,g,v,x){if(!v||!x)return;const E=Fu(Qh(p,v),Qh(g,x),o);E<r&&u.push([E,v,x])}function ja(u,r,o,p,g=1/0){let v=Math.min(p.distance(u[0],o[0][0]),g);if(v===0)return v;const x=new pd([[0,[0,u.length-1],[0,0]]],nm),E=Jh(o);for(;x.length>0;){const R=x.pop();if(R[0]>=v)continue;const D=R[1],B=r?50:100;if(Mr(D)<=B){if(!ws(D,u.length))return NaN;if(r){const N=rm(u,D,o,p);if(isNaN(N)||N===0)return N;v=Math.min(v,N)}else for(let N=D[0];N<=D[1];++N){const V=vd(u[N],o,p);if(v=Math.min(v,V),v===0)return 0}}else{const N=Kh(D,r);ef(x,v,p,u,E,N[0]),ef(x,v,p,u,E,N[1])}}return v}function zu(u,r,o,p,g,v=1/0){let x=Math.min(v,g.distance(u[0],o[0]));if(x===0)return x;const E=new pd([[0,[0,u.length-1],[0,o.length-1]]],nm);for(;E.length>0;){const R=E.pop();if(R[0]>=x)continue;const D=R[1],B=R[2],N=r?50:100,V=p?50:100;if(Mr(D)<=N&&Mr(B)<=V){if(!ws(D,u.length)&&ws(B,o.length))return NaN;let $;if(r&&p)$=yd(u,D,o,B,g),x=Math.min(x,$);else if(r&&!p){const W=u.slice(D[0],D[1]+1);for(let Z=B[0];Z<=B[1];++Z)if($=Yl(o[Z],W,g),x=Math.min(x,$),x===0)return x}else if(!r&&p){const W=o.slice(B[0],B[1]+1);for(let Z=D[0];Z<=D[1];++Z)if($=Yl(u[Z],W,g),x=Math.min(x,$),x===0)return x}else $=Mi(u,D,o,B,g),x=Math.min(x,$)}else{const $=Kh(D,r),W=Kh(B,p);Nu(E,x,g,u,o,$[0],W[0]),Nu(E,x,g,u,o,$[0],W[1]),Nu(E,x,g,u,o,$[1],W[0]),Nu(E,x,g,u,o,$[1],W[1])}}return x}function nf(u){return u.type==="MultiPolygon"?u.coordinates.map((r=>({type:"Polygon",coordinates:r}))):u.type==="MultiLineString"?u.coordinates.map((r=>({type:"LineString",coordinates:r}))):u.type==="MultiPoint"?u.coordinates.map((r=>({type:"Point",coordinates:r}))):[u]}class tl{constructor(r,o){this.type=fe,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ns(r[1])){const p=r[1];if(p.type==="FeatureCollection")return new tl(p,p.features.map((g=>nf(g.geometry))).flat());if(p.type==="Feature")return new tl(p,nf(p.geometry));if("type"in p&&"coordinates"in p)return new tl(p,nf(p))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(o,p){const g=o.geometry(),v=g.flat().map((R=>Hl([R.x,R.y],o.canonical)));if(g.length===0)return NaN;const x=new _d(v[0][1]);let E=1/0;for(const R of p){switch(R.type){case"Point":E=Math.min(E,zu(v,!1,[R.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,zu(v,!1,R.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,ja(v,!1,R.coordinates,x,E))}if(E===0)return E}return E})(r,this.geometries);if(r.geometryType()==="LineString")return(function(o,p){const g=o.geometry(),v=g.flat().map((R=>Hl([R.x,R.y],o.canonical)));if(g.length===0)return NaN;const x=new _d(v[0][1]);let E=1/0;for(const R of p){switch(R.type){case"Point":E=Math.min(E,zu(v,!0,[R.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,zu(v,!0,R.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,ja(v,!0,R.coordinates,x,E))}if(E===0)return E}return E})(r,this.geometries);if(r.geometryType()==="Polygon")return(function(o,p){const g=o.geometry();if(g.length===0||g[0].length===0)return NaN;const v=jc(g,0).map((R=>R.map((D=>D.map((B=>Hl([B.x,B.y],o.canonical))))))),x=new _d(v[0][0][0][1]);let E=1/0;for(const R of p)for(const D of v){switch(R.type){case"Point":E=Math.min(E,ja([R.coordinates],!1,D,x,E));break;case"LineString":E=Math.min(E,ja(R.coordinates,!0,D,x,E));break;case"Polygon":E=Math.min(E,$c(D,R.coordinates,x,E))}if(E===0)return E}return E})(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Uu{constructor(r){this.type=ni,this.key=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=r[1];return p==null?o.error("Global state property must be defined."):typeof p!="string"?o.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new Uu(p)}evaluate(r){var o;const p=(o=r.globals)===null||o===void 0?void 0:o.globalState;return p&&Object.keys(p).length!==0?ka(p,this.key):null}eachChild(){}outputDefined(){return!1}}const Hc={"==":Wh,"!=":ld,">":Yp,"<":Gp,">=":Xh,"<=":qh,array:Er,at:Bs,boolean:Er,case:ku,coalesce:zc,collator:xs,format:$l,image:cd,in:uo,"index-of":Na,interpolate:yr,"interpolate-hcl":yr,"interpolate-lab":yr,length:Bu,let:Ei,literal:co,match:Du,number:Er,"number-format":Zh,object:Er,slice:Ou,step:Ko,string:Er,"to-boolean":Pn,"to-color":Pn,"to-number":Pn,"to-string":Pn,var:Yo,within:Va,distance:tl,"global-state":Uu};class Ws{constructor(r,o,p,g){this.name=r,this.type=o,this._evaluate=p,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,o){const p=r[0],g=Ws.definitions[p];if(!g)return o.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=x.filter((([D])=>!Array.isArray(D)||D.length===r.length-1));let R=null;for(const[D,B]of E){R=new Fa(o.registry,Kl,o.path,null,o.scope);const N=[];let V=!1;for(let $=1;$<r.length;$++){const W=r[$],Z=Array.isArray(D)?D[$-1]:D.type,K=R.parse(W,1+N.length,Z);if(!K){V=!0;break}N.push(K)}if(!V)if(Array.isArray(D)&&D.length!==N.length)R.error(`Expected ${D.length} arguments, but found ${N.length} instead.`);else{for(let $=0;$<N.length;$++){const W=Array.isArray(D)?D[$]:D.type,Z=N[$];R.concat($+1).checkSubtype(W,Z.type)}if(R.errors.length===0)return new Ws(p,v,B,N)}}if(E.length===1)o.errors.push(...R.errors);else{const D=(E.length?E:x).map((([N])=>{return V=N,Array.isArray(V)?`(${V.map(en).join(", ")})`:`(${en(V.type)}...)`;var V})).join(" | "),B=[];for(let N=1;N<r.length;N++){const V=o.parse(r[N],1+B.length);if(!V)return null;B.push(en(V.type))}o.error(`Expected arguments of type ${D}, but found (${B.join(", ")}) instead.`)}return null}static register(r,o){Ws.definitions=o;for(const p in o)r[p]=Ws}}function bd(u,[r,o,p,g]){r=r.evaluate(u),o=o.evaluate(u),p=p.evaluate(u);const v=g?g.evaluate(u):1,x=Nc(r,o,p,v);if(x)throw new Zi(x);return new bi(r/255,o/255,p/255,v,!1)}function xd(u,r){return u in r}function Vu(u,r){const o=r[u];return o===void 0?null:o}function Rr(u){return{type:u}}function Kl(u){if(u instanceof Yo)return Kl(u.boundExpression);if(u instanceof Ws&&u.name==="error"||u instanceof xs||u instanceof Va||u instanceof tl||u instanceof Uu)return!1;const r=u instanceof Pn||u instanceof Er;let o=!0;return u.eachChild((p=>{o=r?o&&Kl(p):o&&p instanceof co})),!!o&&rs(u)&&Wc(u,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function rs(u){if(u instanceof Ws&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Va||u instanceof tl)return!1;let r=!0;return u.eachChild((o=>{r&&!rs(o)&&(r=!1)})),r}function $a(u){if(u instanceof Ws&&u.name==="feature-state")return!1;let r=!0;return u.eachChild((o=>{r&&!$a(o)&&(r=!1)})),r}function Wc(u,r){if(u instanceof Ws&&r.indexOf(u.name)>=0)return!1;let o=!0;return u.eachChild((p=>{o&&!Wc(p,r)&&(o=!1)})),o}function ju(u){return{result:"success",value:u}}function fo(u){return{result:"error",value:u}}function el(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function il(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function rf(u){return!!u.expression&&u.expression.interpolated}function pi(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function po(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)&&nn(u)===gr}function i_(u){return u}function Ts(u,r){const o=u.stops&&typeof u.stops[0][0]=="object",p=o||!(o||u.property!==void 0),g=u.type||(rf(r)?"exponential":"interval"),v=(function(B){switch(B.type){case"color":return bi.parse;case"padding":return jn.parse;case"numberArray":return $n.parse;case"colorArray":return Kn.parse;default:return null}})(r);if(v&&((u=Ji({},u)).stops&&(u.stops=u.stops.map((B=>[B[0],v(B[1])]))),u.default=v(u.default?u.default:r.default)),u.colorSpace&&(x=u.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var x;const E=(function(B){switch(B){case"exponential":return $u;case"interval":return sm;case"categorical":return fa;case"identity":return Jl;default:throw new Error(`Unknown function type "${B}"`)}})(g);let R,D;if(g==="categorical"){R=Object.create(null);for(const B of u.stops)R[B[0]]=B[1];D=typeof u.stops[0][0]}if(o){const B={},N=[];for(let W=0;W<u.stops.length;W++){const Z=u.stops[W],K=Z[0].zoom;B[K]===void 0&&(B[K]={zoom:K,type:u.type,property:u.property,default:u.default,stops:[]},N.push(K)),B[K].stops.push([Z[0].value,Z[1]])}const V=[];for(const W of N)V.push([B[W].zoom,Ts(B[W],r)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:yr.interpolationFactor.bind(void 0,$),zoomStops:V.map((W=>W[0])),evaluate:({zoom:W},Z)=>$u({stops:V,base:u.base},r,W).evaluate(W,Z)}}if(p){const B=g==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:B,interpolationFactor:yr.interpolationFactor.bind(void 0,B),zoomStops:u.stops.map((N=>N[0])),evaluate:({zoom:N})=>E(u,r,N,R,D)}}return{kind:"source",evaluate(B,N){const V=N&&N.properties?N.properties[u.property]:void 0;return V===void 0?Ql(u.default,r.default):E(u,r,V,R,D)}}}function Ql(u,r,o){return u!==void 0?u:r!==void 0?r:o!==void 0?o:void 0}function fa(u,r,o,p,g){return Ql(typeof o===g?p[o]:void 0,u.default,r.default)}function sm(u,r,o){if(pi(o)!=="number")return Ql(u.default,r.default);const p=u.stops.length;if(p===1||o<=u.stops[0][0])return u.stops[0][1];if(o>=u.stops[p-1][0])return u.stops[p-1][1];const g=jh(u.stops.map((v=>v[0])),o);return u.stops[g][1]}function $u(u,r,o){const p=u.base!==void 0?u.base:1;if(pi(o)!=="number")return Ql(u.default,r.default);const g=u.stops.length;if(g===1||o<=u.stops[0][0])return u.stops[0][1];if(o>=u.stops[g-1][0])return u.stops[g-1][1];const v=jh(u.stops.map((B=>B[0])),o),x=(function(B,N,V,$){const W=$-V,Z=B-V;return W===0?0:N===1?Z/W:(Math.pow(N,Z)-1)/(Math.pow(N,W)-1)})(o,p,u.stops[v][0],u.stops[v+1][0]),E=u.stops[v][1],R=u.stops[v+1][1],D=ua[r.type]||i_;return typeof E.evaluate=="function"?{evaluate(...B){const N=E.evaluate.apply(void 0,B),V=R.evaluate.apply(void 0,B);if(N!==void 0&&V!==void 0)return D(N,V,x,u.colorSpace)}}:D(E,R,x,u.colorSpace)}function Jl(u,r,o){switch(r.type){case"color":o=bi.parse(o);break;case"formatted":o=Bn.fromString(o.toString());break;case"resolvedImage":o=Ln.fromString(o.toString());break;case"padding":o=jn.parse(o);break;case"colorArray":o=Kn.parse(o);break;case"numberArray":o=$n.parse(o);break;default:pi(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0)}return Ql(o,u.default,r.default)}Ws.register(Hc,{error:[{kind:"error"},[Re],(u,[r])=>{throw new Zi(r.evaluate(u))}],typeof:[Re,[ni],(u,[r])=>en(nn(r.evaluate(u)))],"to-rgba":[ys(fe,4),[Ur],(u,[r])=>{const[o,p,g,v]=r.evaluate(u).rgb;return[255*o,255*p,255*g,v]}],rgb:[Ur,[fe,fe,fe],bd],rgba:[Ur,[fe,fe,fe,fe],bd],has:{type:We,overloads:[[[Re],(u,[r])=>xd(r.evaluate(u),u.properties())],[[Re,gr],(u,[r,o])=>xd(r.evaluate(u),o.evaluate(u))]]},get:{type:ni,overloads:[[[Re],(u,[r])=>Vu(r.evaluate(u),u.properties())],[[Re,gr],(u,[r,o])=>Vu(r.evaluate(u),o.evaluate(u))]]},"feature-state":[ni,[Re],(u,[r])=>Vu(r.evaluate(u),u.featureState||{})],properties:[gr,[],u=>u.properties()],"geometry-type":[Re,[],u=>u.geometryType()],id:[ni,[],u=>u.id()],zoom:[fe,[],u=>u.globals.zoom],"heatmap-density":[fe,[],u=>u.globals.heatmapDensity||0],elevation:[fe,[],u=>u.globals.elevation||0],"line-progress":[fe,[],u=>u.globals.lineProgress||0],accumulated:[ni,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[fe,Rr(fe),(u,r)=>{let o=0;for(const p of r)o+=p.evaluate(u);return o}],"*":[fe,Rr(fe),(u,r)=>{let o=1;for(const p of r)o*=p.evaluate(u);return o}],"-":{type:fe,overloads:[[[fe,fe],(u,[r,o])=>r.evaluate(u)-o.evaluate(u)],[[fe],(u,[r])=>-r.evaluate(u)]]},"/":[fe,[fe,fe],(u,[r,o])=>r.evaluate(u)/o.evaluate(u)],"%":[fe,[fe,fe],(u,[r,o])=>r.evaluate(u)%o.evaluate(u)],ln2:[fe,[],()=>Math.LN2],pi:[fe,[],()=>Math.PI],e:[fe,[],()=>Math.E],"^":[fe,[fe,fe],(u,[r,o])=>Math.pow(r.evaluate(u),o.evaluate(u))],sqrt:[fe,[fe],(u,[r])=>Math.sqrt(r.evaluate(u))],log10:[fe,[fe],(u,[r])=>Math.log(r.evaluate(u))/Math.LN10],ln:[fe,[fe],(u,[r])=>Math.log(r.evaluate(u))],log2:[fe,[fe],(u,[r])=>Math.log(r.evaluate(u))/Math.LN2],sin:[fe,[fe],(u,[r])=>Math.sin(r.evaluate(u))],cos:[fe,[fe],(u,[r])=>Math.cos(r.evaluate(u))],tan:[fe,[fe],(u,[r])=>Math.tan(r.evaluate(u))],asin:[fe,[fe],(u,[r])=>Math.asin(r.evaluate(u))],acos:[fe,[fe],(u,[r])=>Math.acos(r.evaluate(u))],atan:[fe,[fe],(u,[r])=>Math.atan(r.evaluate(u))],min:[fe,Rr(fe),(u,r)=>Math.min(...r.map((o=>o.evaluate(u))))],max:[fe,Rr(fe),(u,r)=>Math.max(...r.map((o=>o.evaluate(u))))],abs:[fe,[fe],(u,[r])=>Math.abs(r.evaluate(u))],round:[fe,[fe],(u,[r])=>{const o=r.evaluate(u);return o<0?-Math.round(-o):Math.round(o)}],floor:[fe,[fe],(u,[r])=>Math.floor(r.evaluate(u))],ceil:[fe,[fe],(u,[r])=>Math.ceil(r.evaluate(u))],"filter-==":[We,[Re,ni],(u,[r,o])=>u.properties()[r.value]===o.value],"filter-id-==":[We,[ni],(u,[r])=>u.id()===r.value],"filter-type-==":[We,[Re],(u,[r])=>u.geometryType()===r.value],"filter-<":[We,[Re,ni],(u,[r,o])=>{const p=u.properties()[r.value],g=o.value;return typeof p==typeof g&&p<g}],"filter-id-<":[We,[ni],(u,[r])=>{const o=u.id(),p=r.value;return typeof o==typeof p&&o<p}],"filter->":[We,[Re,ni],(u,[r,o])=>{const p=u.properties()[r.value],g=o.value;return typeof p==typeof g&&p>g}],"filter-id->":[We,[ni],(u,[r])=>{const o=u.id(),p=r.value;return typeof o==typeof p&&o>p}],"filter-<=":[We,[Re,ni],(u,[r,o])=>{const p=u.properties()[r.value],g=o.value;return typeof p==typeof g&&p<=g}],"filter-id-<=":[We,[ni],(u,[r])=>{const o=u.id(),p=r.value;return typeof o==typeof p&&o<=p}],"filter->=":[We,[Re,ni],(u,[r,o])=>{const p=u.properties()[r.value],g=o.value;return typeof p==typeof g&&p>=g}],"filter-id->=":[We,[ni],(u,[r])=>{const o=u.id(),p=r.value;return typeof o==typeof p&&o>=p}],"filter-has":[We,[ni],(u,[r])=>r.value in u.properties()],"filter-has-id":[We,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[We,[ys(Re)],(u,[r])=>r.value.indexOf(u.geometryType())>=0],"filter-id-in":[We,[ys(ni)],(u,[r])=>r.value.indexOf(u.id())>=0],"filter-in-small":[We,[Re,ys(ni)],(u,[r,o])=>o.value.indexOf(u.properties()[r.value])>=0],"filter-in-large":[We,[Re,ys(ni)],(u,[r,o])=>(function(p,g,v,x){for(;v<=x;){const E=v+x>>1;if(g[E]===p)return!0;g[E]>p?x=E-1:v=E+1}return!1})(u.properties()[r.value],o.value,0,o.value.length-1)],all:{type:We,overloads:[[[We,We],(u,[r,o])=>r.evaluate(u)&&o.evaluate(u)],[Rr(We),(u,r)=>{for(const o of r)if(!o.evaluate(u))return!1;return!0}]]},any:{type:We,overloads:[[[We,We],(u,[r,o])=>r.evaluate(u)||o.evaluate(u)],[Rr(We),(u,r)=>{for(const o of r)if(o.evaluate(u))return!0;return!1}]]},"!":[We,[We],(u,[r])=>!r.evaluate(u)],"is-supported-script":[We,[Re],(u,[r])=>{const o=u.globals&&u.globals.isSupportedScript;return!o||o(r.evaluate(u))}],upcase:[Re,[Re],(u,[r])=>r.evaluate(u).toUpperCase()],downcase:[Re,[Re],(u,[r])=>r.evaluate(u).toLowerCase()],concat:[Re,Rr(ni),(u,r)=>r.map((o=>lo(o.evaluate(u)))).join("")],"resolved-locale":[Re,[ks],(u,[r])=>r.evaluate(u).resolvedLocale()]});class qc{constructor(r,o,p){this.expression=r,this._warningHistory={},this._evaluator=new oi,this._defaultValue=o?(function(g){if(g.type==="color"&&po(g.default))return new bi(0,0,0,0);switch(g.type){case"color":return bi.parse(g.default)||null;case"padding":return jn.parse(g.default)||null;case"numberArray":return $n.parse(g.default)||null;case"colorArray":return Kn.parse(g.default)||null;case"variableAnchorOffsetCollection":return lr.parse(g.default)||null;case"projectionDefinition":return _r.parse(g.default)||null;default:return g.default===void 0?null:g.default}})(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this._globalState=p}evaluateWithoutErrorHandling(r,o,p,g,v,x){return this._globalState&&(r=Pr(r,this._globalState)),this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=p,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(r,o,p,g,v,x){this._globalState&&(r=Pr(r,this._globalState)),this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=p||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Zi(`Expected value to be one of ${Object.keys(this._enumValues).map((R=>JSON.stringify(R))).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Hu(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Hc}function Xc(u,r,o){const p=new Fa(Hc,Kl,[],r?(function(v){const x={color:Ur,string:Re,number:fe,enum:Re,boolean:We,formatted:Zo,padding:oa,numberArray:la,colorArray:Vr,projectionDefinition:Nl,resolvedImage:ca,variableAnchorOffsetCollection:Rn};return v.type==="array"?ys(x[v.value]||ni,v.length):x[v.type]})(r):void 0),g=p.parse(u,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?ju(new qc(g,r,o)):fo(p.errors)}class nl{constructor(r,o,p){this.kind=r,this._styleExpression=o,this.isStateDependent=r!=="constant"&&!$a(o.expression),this.globalStateRefs=rl(o.expression),this._globalState=p}evaluateWithoutErrorHandling(r,o,p,g,v,x){return this._globalState&&(r=Pr(r,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(r,o,p,g,v,x)}evaluate(r,o,p,g,v,x){return this._globalState&&(r=Pr(r,this._globalState)),this._styleExpression.evaluate(r,o,p,g,v,x)}}class ss{constructor(r,o,p,g,v){this.kind=r,this.zoomStops=p,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!$a(o.expression),this.globalStateRefs=rl(o.expression),this.interpolationType=g,this._globalState=v}evaluateWithoutErrorHandling(r,o,p,g,v,x){return this._globalState&&(r=Pr(r,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(r,o,p,g,v,x)}evaluate(r,o,p,g,v,x){return this._globalState&&(r=Pr(r,this._globalState)),this._styleExpression.evaluate(r,o,p,g,v,x)}interpolationFactor(r,o,p){return this.interpolationType?yr.interpolationFactor(this.interpolationType,r,o,p):0}}function tc(u,r,o){const p=Xc(u,r,o);if(p.result==="error")return p;const g=p.value.expression,v=rs(g);if(!v&&!el(r))return fo([new tn("","data expressions not supported")]);const x=Wc(g,["zoom"]);if(!x&&!il(r))return fo([new tn("","zoom expressions not supported")]);const E=ec(g);return E||x?E instanceof tn?fo([E]):E instanceof yr&&!rf(r)?fo([new tn("",'"interpolate" expressions cannot be used with this property')]):ju(E?new ss(v?"camera":"composite",p.value,E.labels,E instanceof yr?E.interpolation:void 0,o):new nl(v?"constant":"source",p.value,o)):fo([new tn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mo{constructor(r,o){this._parameters=r,this._specification=o,Ji(this,Ts(this._parameters,this._specification))}static deserialize(r){return new mo(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ec(u){let r=null;if(u instanceof Ei)r=ec(u.result);else if(u instanceof zc){for(const o of u.args)if(r=ec(o),r)break}else(u instanceof Ko||u instanceof yr)&&u.input instanceof Ws&&u.input.name==="zoom"&&(r=u);return r instanceof tn||u.eachChild((o=>{const p=ec(o);p instanceof tn?r=p:!r&&p?r=new tn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new tn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}function rl(u,r=new Set){return u instanceof Uu&&r.add(u.key),u.eachChild((o=>{rl(o,r)})),r}function Pr(u,r){const{zoom:o,heatmapDensity:p,elevation:g,lineProgress:v,isSupportedScript:x,accumulated:E}=u??{};return{zoom:o,heatmapDensity:p,elevation:g,lineProgress:v,isSupportedScript:x,accumulated:E,globalState:r}}function as(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const r of u.slice(1))if(!as(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const go={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ss(u,r){if(u==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};as(u)||(u=Zc(u));const o=Xc(u,go,r);if(o.result==="error")throw new Error(o.value.map((p=>`${p.key}: ${p.message}`)).join(", "));return{filter:(p,g,v)=>o.value.evaluate(p,g,{},v),needGeometry:da(u),getGlobalStateRefs:()=>rl(o.value.expression)}}function Ha(u,r){return u<r?-1:u>r?1:0}function da(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let r=1;r<u.length;r++)if(da(u[r]))return!0;return!1}function Zc(u){if(!u)return!0;const r=u[0];return u.length<=1?r!=="any":r==="=="?Gc(u[1],u[2],"=="):r==="!="?Jn(Gc(u[1],u[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Gc(u[1],u[2],r):r==="any"?(o=u.slice(1),["any"].concat(o.map(Zc))):r==="all"?["all"].concat(u.slice(1).map(Zc)):r==="none"?["all"].concat(u.slice(1).map(Zc).map(Jn)):r==="in"?sf(u[1],u.slice(2)):r==="!in"?Jn(sf(u[1],u.slice(2))):r==="has"?wd(u[1]):r!=="!has"||Jn(wd(u[1]));var o}function Gc(u,r,o){switch(u){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,u,r]}}function sf(u,r){if(r.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((o=>typeof o!=typeof r[0]))?["filter-in-large",u,["literal",r.sort(Ha)]]:["filter-in-small",u,["literal",r]]}}function wd(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Jn(u){return["!",u]}function cn(u){const r=typeof u;if(r==="number"||r==="boolean"||r==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let g="[";for(const v of u)g+=`${cn(v)},`;return`${g}]`}const o=Object.keys(u).sort();let p="{";for(let g=0;g<o.length;g++)p+=`${JSON.stringify(o[g])}:${cn(u[o[g]])},`;return`${p}}`}function Ri(u){let r="";for(const o of Ot)r+=`/${cn(u[o])}`;return r}function Wa(u){const r=u.value;return r?[new xe(u.key,r,"constants have been deprecated as of v8")]:[]}function Ii(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function pa(u){if(Array.isArray(u))return u.map(pa);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const r={};for(const o in u)r[o]=pa(u[o]);return r}return Ii(u)}function Hn(u){const r=u.key,o=u.value,p=u.valueSpec||{},g=u.objectElementValidators||{},v=u.style,x=u.styleSpec,E=u.validateSpec;let R=[];const D=pi(o);if(D!=="object")return[new xe(r,o,`object expected, ${D} found`)];for(const B in o){const N=B.split(".")[0],V=ka(p,N)||p["*"];let $;if(ka(g,N))$=g[N];else if(ka(p,N))$=E;else if(g["*"])$=g["*"];else{if(!p["*"]){R.push(new xe(r,o[B],`unknown property "${B}"`));continue}$=E}R=R.concat($({key:(r&&`${r}.`)+B,value:o[B],valueSpec:V,style:v,styleSpec:x,object:o,objectKey:B,validateSpec:E},o))}for(const B in p)g[B]||p[B].required&&p[B].default===void 0&&o[B]===void 0&&R.push(new xe(r,o,`missing required property "${B}"`));return R}function Yc(u){const r=u.value,o=u.valueSpec,p=u.style,g=u.styleSpec,v=u.key,x=u.arrayElementValidator||u.validateSpec;if(pi(r)!=="array")return[new xe(v,r,`array expected, ${pi(r)} found`)];if(o.length&&r.length!==o.length)return[new xe(v,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new xe(v,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let E={type:o.value,values:o.values};g.$version<7&&(E.function=o.function),pi(o.value)==="object"&&(E=o.value);let R=[];for(let D=0;D<r.length;D++)R=R.concat(x({array:r,arrayIndex:D,value:r[D],valueSpec:E,validateSpec:u.validateSpec,style:p,styleSpec:g,key:`${v}[${D}]`}));return R}function sl(u){const r=u.key,o=u.value,p=u.valueSpec;let g=pi(o);return g==="number"&&o!=o&&(g="NaN"),g!=="number"?[new xe(r,o,`number expected, ${g} found`)]:"minimum"in p&&o<p.minimum?[new xe(r,o,`${o} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&o>p.maximum?[new xe(r,o,`${o} is greater than the maximum value ${p.maximum}`)]:[]}function ic(u){const r=u.valueSpec,o=Ii(u.value.type);let p,g,v,x={};const E=o!=="categorical"&&u.value.property===void 0,R=!E,D=pi(u.value.stops)==="array"&&pi(u.value.stops[0])==="array"&&pi(u.value.stops[0][0])==="object",B=Hn({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function($){if(o==="identity")return[new xe($.key,$.value,'identity function may not have a "stops" property')];let W=[];const Z=$.value;return W=W.concat(Yc({key:$.key,value:Z,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:N})),pi(Z)==="array"&&Z.length===0&&W.push(new xe($.key,Z,"array must have at least one stop")),W},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:r,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return o==="identity"&&E&&B.push(new xe(u.key,u.value,'missing required property "property"')),o==="identity"||u.value.stops||B.push(new xe(u.key,u.value,'missing required property "stops"')),o==="exponential"&&u.valueSpec.expression&&!rf(u.valueSpec)&&B.push(new xe(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(R&&!el(u.valueSpec)?B.push(new xe(u.key,u.value,"property functions not supported")):E&&!il(u.valueSpec)&&B.push(new xe(u.key,u.value,"zoom functions not supported"))),o!=="categorical"&&!D||u.value.property!==void 0||B.push(new xe(u.key,u.value,'"property" property is required')),B;function N($){let W=[];const Z=$.value,K=$.key;if(pi(Z)!=="array")return[new xe(K,Z,`array expected, ${pi(Z)} found`)];if(Z.length!==2)return[new xe(K,Z,`array length 2 expected, length ${Z.length} found`)];if(D){if(pi(Z[0])!=="object")return[new xe(K,Z,`object expected, ${pi(Z[0])} found`)];if(Z[0].zoom===void 0)return[new xe(K,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new xe(K,Z,"object stop key must have value")];if(v&&v>Ii(Z[0].zoom))return[new xe(K,Z[0].zoom,"stop zoom values must appear in ascending order")];Ii(Z[0].zoom)!==v&&(v=Ii(Z[0].zoom),g=void 0,x={}),W=W.concat(Hn({key:`${K}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:sl,value:V}}))}else W=W.concat(V({key:`${K}[0]`,value:Z[0],validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},Z));return Hu(pa(Z[1]))?W.concat([new xe(`${K}[1]`,Z[1],"expressions are not allowed in function stops.")]):W.concat($.validateSpec({key:`${K}[1]`,value:Z[1],valueSpec:r,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function V($,W){const Z=pi($.value),K=Ii($.value),it=$.value!==null?$.value:W;if(p){if(Z!==p)return[new xe($.key,it,`${Z} stop domain type must match previous stop domain type ${p}`)]}else p=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new xe($.key,it,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&o!=="categorical"){let yt=`number expected, ${Z} found`;return el(r)&&o===void 0&&(yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xe($.key,it,yt)]}return o!=="categorical"||Z!=="number"||isFinite(K)&&Math.floor(K)===K?o!=="categorical"&&Z==="number"&&g!==void 0&&K<g?[new xe($.key,it,"stop domain values must appear in ascending order")]:(g=K,o==="categorical"&&K in x?[new xe($.key,it,"stop domain values must be unique")]:(x[K]=!0,[])):[new xe($.key,it,`integer expected, found ${K}`)]}}function qs(u){const r=(u.expressionContext==="property"?tc:Xc)(pa(u.value),u.valueSpec);if(r.result==="error")return r.value.map((p=>new xe(`${u.key}${p.key}`,u.value,p.message)));const o=r.value.expression||r.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!o.outputDefined())return[new xe(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!$a(o))return[new xe(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!$a(o))return[new xe(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Wc(o,["zoom","feature-state"]))return[new xe(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!rs(o))return[new xe(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wu(u){const r=u.key,o=u.value,p=pi(o);return p!=="string"?[new xe(r,o,`color expected, ${p} found`)]:bi.parse(String(o))?[]:[new xe(r,o,`color expected, "${o}" found`)]}function _o(u){const r=u.key,o=u.value,p=u.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(Ii(o))===-1&&g.push(new xe(r,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(Ii(o))===-1&&g.push(new xe(r,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function qu(u){return as(pa(u.value))?qs(Ji({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):al(u)}function al(u){const r=u.value,o=u.key;if(pi(r)!=="array")return[new xe(o,r,`array expected, ${pi(r)} found`)];const p=u.styleSpec;let g,v=[];if(r.length<1)return[new xe(o,r,"filter array must have at least 1 element")];switch(v=v.concat(_o({key:`${o}[0]`,value:r[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ii(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Ii(r[1])==="$type"&&v.push(new xe(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new xe(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=pi(r[1]),g!=="string"&&v.push(new xe(`${o}[1]`,r[1],`string expected, ${g} found`)));for(let x=2;x<r.length;x++)g=pi(r[x]),Ii(r[1])==="$type"?v=v.concat(_o({key:`${o}[${x}]`,value:r[x],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new xe(`${o}[${x}]`,r[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)v=v.concat(al({key:`${o}[${x}]`,value:r[x],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":g=pi(r[1]),r.length!==2?v.push(new xe(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new xe(`${o}[1]`,r[1],`string expected, ${g} found`))}return v}function ma(u,r){const o=u.key,p=u.validateSpec,g=u.style,v=u.styleSpec,x=u.value,E=u.objectKey,R=v[`${r}_${u.layerType}`];if(!R)return[];const D=E.match(/^(.*)-transition$/);if(r==="paint"&&D&&R[D[1]]&&R[D[1]].transition)return p({key:o,value:x,valueSpec:v.transition,style:g,styleSpec:v});const B=u.valueSpec||R[E];if(!B)return[new xe(o,x,`unknown property "${E}"`)];let N;if(pi(x)==="string"&&el(B)&&!B.tokens&&(N=/^{([^}]+)}$/.exec(x)))return[new xe(o,x,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const V=[];return u.layerType==="symbol"&&E==="text-font"&&po(pa(x))&&Ii(x.type)==="identity"&&V.push(new xe(o,x,'"text-font" does not support identity functions')),V.concat(p({key:u.key,value:x,valueSpec:B,style:g,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:E}))}function qa(u){return ma(u,"paint")}function Ls(u){return ma(u,"layout")}function af(u){let r=[];const o=u.value,p=u.key,g=u.style,v=u.styleSpec;if(pi(o)!=="object")return[new xe(p,o,`object expected, ${pi(o)} found`)];o.type||o.ref||r.push(new xe(p,o,'either "type" or "ref" is required'));let x=Ii(o.type);const E=Ii(o.ref);if(o.id){const R=Ii(o.id);for(let D=0;D<u.arrayIndex;D++){const B=g.layers[D];Ii(B.id)===R&&r.push(new xe(p,o.id,`duplicate layer id "${o.id}", previously used at line ${B.id.__line__}`))}}if("ref"in o){let R;["type","source","source-layer","filter","layout"].forEach((D=>{D in o&&r.push(new xe(p,o[D],`"${D}" is prohibited for ref layers`))})),g.layers.forEach((D=>{Ii(D.id)===E&&(R=D)})),R?R.ref?r.push(new xe(p,o.ref,"ref cannot reference another ref layer")):x=Ii(R.type):r.push(new xe(p,o.ref,`ref layer "${E}" not found`))}else if(x!=="background")if(o.source){const R=g.sources&&g.sources[o.source],D=R&&Ii(R.type);R?D==="vector"&&x==="raster"?r.push(new xe(p,o.source,`layer "${o.id}" requires a raster source`)):D!=="raster-dem"&&x==="hillshade"||D!=="raster-dem"&&x==="color-relief"?r.push(new xe(p,o.source,`layer "${o.id}" requires a raster-dem source`)):D==="raster"&&x!=="raster"?r.push(new xe(p,o.source,`layer "${o.id}" requires a vector source`)):D!=="vector"||o["source-layer"]?D==="raster-dem"&&x!=="hillshade"&&x!=="color-relief"?r.push(new xe(p,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):x!=="line"||!o.paint||!o.paint["line-gradient"]||D==="geojson"&&R.lineMetrics||r.push(new xe(p,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new xe(p,o,`layer "${o.id}" must specify a "source-layer"`)):r.push(new xe(p,o.source,`source "${o.source}" not found`))}else r.push(new xe(p,o,'missing required property "source"'));return r=r.concat(Hn({key:p,value:o,valueSpec:v.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:o.type,valueSpec:v.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:o,objectKey:"type"}),filter:qu,layout:R=>Hn({layer:o,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":D=>Ls(Ji({layerType:x},D))}}),paint:R=>Hn({layer:o,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":D=>qa(Ji({layerType:x},D))}})}})),r}function Xa(u){const r=u.value,o=u.key,p=pi(r);return p!=="string"?[new xe(o,r,`string expected, ${p} found`)]:[]}const ol={promoteId:function({key:u,value:r}){if(pi(r)==="string")return Xa({key:u,value:r});{const o=[];for(const p in r)o.push(...Xa({key:`${u}.${p}`,value:r[p]}));return o}}};function Xu(u){const r=u.value,o=u.key,p=u.styleSpec,g=u.style,v=u.validateSpec;if(!r.type)return[new xe(o,r,'"type" is required')];const x=Ii(r.type);let E;switch(x){case"vector":case"raster":return E=Hn({key:o,value:r,valueSpec:p[`source_${x.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:ol,validateSpec:v}),E;case"raster-dem":return E=(function(R){var D;const B=(D=R.sourceName)!==null&&D!==void 0?D:"",N=R.value,V=R.styleSpec,$=V.source_raster_dem,W=R.style;let Z=[];const K=pi(N);if(N===void 0)return Z;if(K!=="object")return Z.push(new xe("source_raster_dem",N,`object expected, ${K} found`)),Z;const it=Ii(N.encoding)==="custom",yt=["redFactor","greenFactor","blueFactor","baseShift"],lt=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const ft in N)!it&&yt.includes(ft)?Z.push(new xe(ft,N[ft],`In "${B}": "${ft}" is only valid when "encoding" is set to "custom". ${lt} encoding found`)):$[ft]?Z=Z.concat(R.validateSpec({key:ft,value:N[ft],valueSpec:$[ft],validateSpec:R.validateSpec,style:W,styleSpec:V})):Z.push(new xe(ft,N[ft],`unknown property "${ft}"`));return Z})({sourceName:o,value:r,style:u.style,styleSpec:p,validateSpec:v}),E;case"geojson":if(E=Hn({key:o,value:r,valueSpec:p.source_geojson,style:g,styleSpec:p,validateSpec:v,objectElementValidators:ol}),r.cluster)for(const R in r.clusterProperties){const[D,B]=r.clusterProperties[R],N=typeof D=="string"?[D,["accumulated"],["get",R]]:D;E.push(...qs({key:`${o}.${R}.map`,value:B,expressionContext:"cluster-map"})),E.push(...qs({key:`${o}.${R}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return E;case"video":return Hn({key:o,value:r,valueSpec:p.source_video,style:g,validateSpec:v,styleSpec:p});case"image":return Hn({key:o,value:r,valueSpec:p.source_image,style:g,validateSpec:v,styleSpec:p});case"canvas":return[new xe(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _o({key:`${o}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function yo(u){const r=u.value,o=u.styleSpec,p=o.light,g=u.style;let v=[];const x=pi(r);if(r===void 0)return v;if(x!=="object")return v=v.concat([new xe("light",r,`object expected, ${x} found`)]),v;for(const E in r){const R=E.match(/^(.*)-transition$/);v=v.concat(R&&p[R[1]]&&p[R[1]].transition?u.validateSpec({key:E,value:r[E],valueSpec:o.transition,validateSpec:u.validateSpec,style:g,styleSpec:o}):p[E]?u.validateSpec({key:E,value:r[E],valueSpec:p[E],validateSpec:u.validateSpec,style:g,styleSpec:o}):[new xe(E,r[E],`unknown property "${E}"`)])}return v}function cr(u){const r=u.value,o=u.styleSpec,p=o.sky,g=u.style,v=pi(r);if(r===void 0)return[];if(v!=="object")return[new xe("sky",r,`object expected, ${v} found`)];let x=[];for(const E in r)x=x.concat(p[E]?u.validateSpec({key:E,value:r[E],valueSpec:p[E],style:g,styleSpec:o}):[new xe(E,r[E],`unknown property "${E}"`)]);return x}function vo(u){const r=u.value,o=u.styleSpec,p=o.terrain,g=u.style;let v=[];const x=pi(r);if(r===void 0)return v;if(x!=="object")return v=v.concat([new xe("terrain",r,`object expected, ${x} found`)]),v;for(const E in r)v=v.concat(p[E]?u.validateSpec({key:E,value:r[E],valueSpec:p[E],validateSpec:u.validateSpec,style:g,styleSpec:o}):[new xe(E,r[E],`unknown property "${E}"`)]);return v}function Td(u){let r=[];const o=u.value,p=u.key;if(Array.isArray(o)){const g=[],v=[];for(const x in o)o[x].id&&g.includes(o[x].id)&&r.push(new xe(p,o,`all the sprites' ids must be unique, but ${o[x].id} is duplicated`)),g.push(o[x].id),o[x].url&&v.includes(o[x].url)&&r.push(new xe(p,o,`all the sprites' URLs must be unique, but ${o[x].url} is duplicated`)),v.push(o[x].url),r=r.concat(Hn({key:`${p}[${x}]`,value:o[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return r}return Xa({key:p,value:o})}function am(u){return r=u.value,r&&r.constructor===Object?[]:[new xe(u.key,u.value,`object expected, ${pi(u.value)} found`)];var r}const om={"*":()=>[],array:Yc,boolean:function(u){const r=u.value,o=u.key,p=pi(r);return p!=="boolean"?[new xe(o,r,`boolean expected, ${p} found`)]:[]},number:sl,color:Wu,constants:Wa,enum:_o,filter:qu,function:ic,layer:af,object:Hn,source:Xu,light:yo,sky:cr,terrain:vo,projection:function(u){const r=u.value,o=u.styleSpec,p=o.projection,g=u.style,v=pi(r);if(r===void 0)return[];if(v!=="object")return[new xe("projection",r,`object expected, ${v} found`)];let x=[];for(const E in r)x=x.concat(p[E]?u.validateSpec({key:E,value:r[E],valueSpec:p[E],style:g,styleSpec:o}):[new xe(E,r[E],`unknown property "${E}"`)]);return x},projectionDefinition:function(u){const r=u.key;let o=u.value;o=o instanceof String?o.valueOf():o;const p=pi(o);return p!=="array"||(function(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"})(o)||(function(g){return!!["interpolate","step","literal"].includes(g[0])})(o)?["array","string"].includes(p)?[]:[new xe(r,o,`projection expected, invalid type "${p}" found`)]:[new xe(r,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:Xa,formatted:function(u){return Xa(u).length===0?[]:qs(u)},resolvedImage:function(u){return Xa(u).length===0?[]:qs(u)},padding:function(u){const r=u.key,o=u.value;if(pi(o)==="array"){if(o.length<1||o.length>4)return[new xe(r,o,`padding requires 1 to 4 values; ${o.length} values found`)];const p={type:"number"};let g=[];for(let v=0;v<o.length;v++)g=g.concat(u.validateSpec({key:`${r}[${v}]`,value:o[v],validateSpec:u.validateSpec,valueSpec:p}));return g}return sl({key:r,value:o,valueSpec:{}})},numberArray:function(u){const r=u.key,o=u.value;if(pi(o)==="array"){const p={type:"number"};if(o.length<1)return[new xe(r,o,"array length at least 1 expected, length 0 found")];let g=[];for(let v=0;v<o.length;v++)g=g.concat(u.validateSpec({key:`${r}[${v}]`,value:o[v],validateSpec:u.validateSpec,valueSpec:p}));return g}return sl({key:r,value:o,valueSpec:{}})},colorArray:function(u){const r=u.key,o=u.value;if(pi(o)==="array"){if(o.length<1)return[new xe(r,o,"array length at least 1 expected, length 0 found")];let p=[];for(let g=0;g<o.length;g++)p=p.concat(Wu({key:`${r}[${g}]`,value:o[g]}));return p}return Wu({key:r,value:o})},variableAnchorOffsetCollection:function(u){const r=u.key,o=u.value,p=pi(o),g=u.styleSpec;if(p!=="array"||o.length<1||o.length%2!=0)return[new xe(r,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<o.length;x+=2)v=v.concat(_o({key:`${r}[${x}]`,value:o[x],valueSpec:g.layout_symbol["text-anchor"]})),v=v.concat(Yc({key:`${r}[${x+1}]`,value:o[x+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:g}));return v},sprite:Td,state:am};function of(u){const r=u.value,o=u.valueSpec,p=u.styleSpec;return u.validateSpec=of,o.expression&&po(Ii(r))?ic(u):o.expression&&Hu(pa(r))?qs(u):o.type&&om[o.type]?om[o.type](u):Hn(Ji({},u,{valueSpec:o.type?p[o.type]:o}))}function Wn(u){const r=u.value,o=u.key,p=Xa(u);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new xe(o,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new xe(o,r,'"glyphs" url must include a "{range}" token'))),p}function As(u,r=ut){let o=[];return o=o.concat(of({key:"",value:u,valueSpec:r.$root,styleSpec:r,style:u,validateSpec:of,objectElementValidators:{glyphs:Wn,"*":()=>[]}})),u.constants&&(o=o.concat(Wa({key:"constants",value:u.constants}))),Za(o)}function ur(u){return function(r){return u(Object.assign({},r,{validateSpec:of}))}}function Za(u){return[].concat(u).sort(((r,o)=>r.line-o.line))}function bn(u){return function(...r){return Za(u.apply(this,r))}}As.source=bn(ur(Xu)),As.sprite=bn(ur(Td)),As.glyphs=bn(ur(Wn)),As.light=bn(ur(yo)),As.sky=bn(ur(cr)),As.terrain=bn(ur(vo)),As.state=bn(ur(am)),As.layer=bn(ur(af)),As.filter=bn(ur(qu)),As.paintProperty=bn(ur(qa)),As.layoutProperty=bn(ur(Ls));const Ga=ut,Xs=As,n_=Xs.light,lm=Xs.sky,Zu=Xs.paintProperty,Sd=Xs.layoutProperty;function Ya(u,r){let o=!1;if(r&&r.length)for(const p of r)u.fire(new wt(new Error(p.message))),o=!0;return o}class nc{constructor(r,o,p){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const x=new Int32Array(this.arrayBuffer);r=x[0],this.d=(o=x[1])+2*(p=x[2]);for(let R=0;R<this.d*this.d;R++){const D=x[3+R],B=x[3+R+1];g.push(D===B?null:x.subarray(D,B))}const E=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],E),this.bboxes=x.subarray(E),this.insert=this._insertReadonly}else{this.d=o+2*p;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=r,this.padding=p,this.scale=o/r,this.uid=0;const v=p/o*r;this.min=-v,this.max=r+v}insert(r,o,p,g,v){this._forEachCell(o,p,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,o,p,g,v,x){this.cells[v].push(x)}query(r,o,p,g,v){const x=this.min,E=this.max;if(r<=x&&o<=x&&E<=p&&E<=g&&!v)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(r,o,p,g,this._queryCell,R,{},v),R}}_queryCell(r,o,p,g,v,x,E,R){const D=this.cells[v];if(D!==null){const B=this.keys,N=this.bboxes;for(let V=0;V<D.length;V++){const $=D[V];if(E[$]===void 0){const W=4*$;(R?R(N[W+0],N[W+1],N[W+2],N[W+3]):r<=N[W+2]&&o<=N[W+3]&&p>=N[W+0]&&g>=N[W+1])?(E[$]=!0,x.push(B[$])):E[$]=!1}}}}_forEachCell(r,o,p,g,v,x,E,R){const D=this._convertToCellCoord(r),B=this._convertToCellCoord(o),N=this._convertToCellCoord(p),V=this._convertToCellCoord(g);for(let $=D;$<=N;$++)for(let W=B;W<=V;W++){const Z=this.d*W+$;if((!R||R(this._convertFromCellCoord($),this._convertFromCellCoord(W),this._convertFromCellCoord($+1),this._convertFromCellCoord(W+1)))&&v.call(this,r,o,p,g,Z,x,E,R))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,o=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const g=new Int32Array(o+p+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=o;for(let x=0;x<r.length;x++){const E=r[x];g[3+x]=v,g.set(E,v),v+=E.length}return g[3+r.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+r.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(r,o){const p=r.toArrayBuffer();return o&&o.push(p),{buffer:p}}static deserialize(r){return new nc(r.buffer)}}const Es={};function Ie(u,r,o={}){if(Es[u])throw new Error(`${u} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:u,writeable:!1}),Es[u]={klass:r,omit:o.omit||[],shallow:o.shallow||[]}}Ie("Object",Object),Ie("Set",Set),Ie("TransferableGridIndex",nc),Ie("Color",bi),Ie("Error",Error),Ie("AJAXError",ts),Ie("ResolvedImage",Ln),Ie("StylePropertyFunction",mo),Ie("StyleExpression",qc,{omit:["_evaluator"]}),Ie("ZoomDependentExpression",ss),Ie("ZoomConstantExpression",nl),Ie("CompoundExpression",Ws,{omit:["_evaluate"]});for(const u in Hc)Hc[u]._classRegistryKey||Ie(`Expression_${u}`,Hc[u]);function ga(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Gu(u){return u.$name||u.constructor._classRegistryKey}function Yu(u){return!(function(r){if(r===null||typeof r!="object")return!1;const o=Gu(r);return!(!o||o==="Object")})(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||ga(u)||aa(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function ll(u,r){if(Yu(u))return(ga(u)||aa(u))&&r&&r.push(u),ArrayBuffer.isView(u)&&r&&r.push(u.buffer),u instanceof ImageData&&r&&r.push(u.data.buffer),u;if(Array.isArray(u)){const v=[];for(const x of u)v.push(ll(x,r));return v}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const o=Gu(u);if(!o)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!Es[o])throw new Error(`${o} is not registered.`);const{klass:p}=Es[o],g=p.serialize?p.serialize(u,r):{};if(p.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in u){if(!u.hasOwnProperty(v)||Es[o].omit.indexOf(v)>=0)continue;const x=u[v];g[v]=Es[o].shallow.indexOf(v)>=0?x:ll(x,r)}u instanceof Error&&(g.message=u.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(g.$name=o),g}function Ka(u){if(Yu(u))return u;if(Array.isArray(u))return u.map(Ka);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const r=Gu(u)||"Object";if(!Es[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:o}=Es[r];if(!o)throw new Error(`can't deserialize unregistered class ${r}`);if(o.deserialize)return o.deserialize(u);const p=Object.create(o.prototype);for(const g of Object.keys(u)){if(g==="$name")continue;const v=u[g];p[g]=Es[r].shallow.indexOf(g)>=0?v:Ka(v)}return p}class lf{constructor(){this.first=!0}update(r,o){const p=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=o),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=p,!0))}}function rc(u){return/[\u02EA\u02EB\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(u))}function Zs(u){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD806[\uDEB0-\uDEBF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(u))}function cf(u){for(const r of u)if(Zs(r.charCodeAt(0)))return!0;return!1}function uf(u){for(const r of u)if(!Ku(r.charCodeAt(0)))return!1;return!0}function Qa(u){const r=u.map((o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}})).filter((o=>o));return new RegExp(r.join("|"),"u")}const Kc=Qa(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ku(u){return!Kc.test(String.fromCodePoint(u))}function sc(u){return!(Zs(u)||(r=u,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]/gim.test(String.fromCodePoint(r))));var r}const Qu=Qa(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ju(u){return Qu.test(String.fromCodePoint(u))}function cl(u,r){return!(!r&&Ju(u)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(u)))}function cm(u){for(const r of u)if(Ju(r.charCodeAt(0)))return!0;return!1}const jr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){if(jr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(u,r){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(u.pluginStatus!=="loading")return this.setState(u),u;const o=u.pluginURL,p=new Promise((v=>{this.loadScriptResolve=v}));r(o);const g=new Promise((v=>setTimeout((()=>v()),this.TIMEOUT)));if(yield Promise.race([p,g]),this.isParsed()){const v={pluginStatus:"loaded",pluginURL:o};return this.setState(v),v}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)}))}};class Hi{constructor(r,o){this.isSupportedScript=hf,this.zoom=r,o?(this.now=o.now||0,this.fadeDuration=o.fadeDuration||0,this.zoomHistory=o.zoomHistory||new lf,this.transition=o.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lf,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,o=r-Math.floor(r),p=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*o}}}function hf(u){return(function(r,o){for(const p of r)if(!cl(p.charCodeAt(0),o))return!1;return!0})(u,jr.getRTLTextPluginStatus()==="loaded")}class _a{constructor(r,o,p){this.property=r,this.value=o,this.expression=(function(g,v,x){if(po(g))return new mo(g,v);if(Hu(g)){const E=tc(g,v,x);if(E.result==="error")throw new Error(E.value.map((R=>`${R.key}: ${R.message}`)).join(", "));return E.value}{let E=g;return v.type==="color"&&typeof g=="string"?E=bi.parse(g):v.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?v.type!=="numberArray"||typeof g!="number"&&!Array.isArray(g)?v.type!=="colorArray"||typeof g!="string"&&!Array.isArray(g)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(g)?E=lr.parse(g):v.type==="projectionDefinition"&&typeof g=="string"&&(E=_r.parse(g)):E=Kn.parse(g):E=$n.parse(g):E=jn.parse(g),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>E}}})(o===void 0?r.specification.default:o,r.specification,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(r,o,p){return this.property.possiblyEvaluate(this,r,o,p)}}class ya{constructor(r,o){this.property=r,this.value=new _a(r,void 0,o)}transitioned(r,o){return new ff(this.property,this.value,o,zi({},r.transition,this.transition),r.now)}untransitioned(){return new ff(this.property,this.value,null,{},0)}}class ac{constructor(r,o){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._globalState=o}getValue(r){return ar(this._values[r].value.value)}setValue(r,o){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ya(this._values[r].property,this._globalState)),this._values[r].value=new _a(this._values[r].property,o===null?void 0:ar(o),this._globalState)}getTransition(r){return ar(this._values[r].transition)}setTransition(r,o){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ya(this._values[r].property,this._globalState)),this._values[r].transition=ar(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(r[o]=p);const g=this.getTransition(o);g!==void 0&&(r[`${o}-transition`]=g)}return r}transitioned(r,o){const p=new df(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].transitioned(r,o._values[g]);return p}untransitioned(){const r=new df(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class ff{constructor(r,o,p,g,v){this.property=r,this.value=o,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=p)}possiblyEvaluate(r,o,p){const g=r.now||0,v=this.value.possiblyEvaluate(r,o,p),x=this.prior;if(x){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return x.possiblyEvaluate(r,o,p);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,o,p),v,Ce(E))}}return v}}class df{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,p){const g=new Jc(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,o,p);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Qc{constructor(r,o){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._globalState=o}hasValue(r){return this._values[r].value!==void 0}getValue(r){return ar(this._values[r].value)}setValue(r,o){this._values[r]=new _a(this._values[r].property,o===null?void 0:ar(o),this._globalState)}serialize(){const r={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(r[o]=p)}return r}possiblyEvaluate(r,o,p){const g=new Jc(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,o,p);return g}}class os{constructor(r,o,p){this.property=r,this.value=o,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,p,g){return this.property.evaluate(this.value,this.parameters,r,o,p,g)}}class Jc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ze{constructor(r){this.specification=r}possiblyEvaluate(r,o){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(o)}interpolate(r,o,p){const g=ua[this.specification.type];return g?g(r,o,p):r}}class je{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,p,g){return new os(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(o,null,{},p,g)}:r.expression,o)}interpolate(r,o,p){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new os(this,{kind:"constant",value:void 0},r.parameters);const g=ua[this.specification.type];if(g){const v=g(r.value.value,o.value.value,p);return new os(this,{kind:"constant",value:v},r.parameters)}return r}evaluate(r,o,p,g,v,x){return r.kind==="constant"?r.value:r.evaluate(o,p,g,v,x)}}class ul extends je{possiblyEvaluate(r,o,p,g){if(r.value===void 0)return new os(this,{kind:"constant",value:void 0},o);if(r.expression.kind==="constant"){const v=r.expression.evaluate(o,null,{},p,g),x=r.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,E=this._calculate(x,x,x,o);return new os(this,{kind:"constant",value:E},o)}if(r.expression.kind==="camera"){const v=this._calculate(r.expression.evaluate({zoom:o.zoom-1}),r.expression.evaluate({zoom:o.zoom}),r.expression.evaluate({zoom:o.zoom+1}),o);return new os(this,{kind:"constant",value:v},o)}return new os(this,r.expression,o)}evaluate(r,o,p,g,v,x){if(r.kind==="source"){const E=r.evaluate(o,p,g,v,x);return this._calculate(E,E,E,o)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(o.zoom)-1},p,g),r.evaluate({zoom:Math.floor(o.zoom)},p,g),r.evaluate({zoom:Math.floor(o.zoom)+1},p,g),o):r.value}_calculate(r,o,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:o}:{from:p,to:o}}interpolate(r){return r}}class th{constructor(r){this.specification=r}possiblyEvaluate(r,o,p,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const v=r.expression.evaluate(o,null,{},p,g);return this._calculate(v,v,v,o)}return this._calculate(r.expression.evaluate(new Hi(Math.floor(o.zoom-1),o)),r.expression.evaluate(new Hi(Math.floor(o.zoom),o)),r.expression.evaluate(new Hi(Math.floor(o.zoom+1),o)),o)}}_calculate(r,o,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:o}:{from:p,to:o}}interpolate(r){return r}}class tu{constructor(r){this.specification=r}possiblyEvaluate(r,o,p,g){return!!r.expression.evaluate(o,null,{},p,g)}interpolate(){return!1}}class Ir{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in r){const p=r[o];p.specification.overridable&&this.overridableProperties.push(o);const g=this.defaultPropertyValues[o]=new _a(p,void 0,void 0),v=this.defaultTransitionablePropertyValues[o]=new ya(p,void 0);this.defaultTransitioningPropertyValues[o]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=g.possiblyEvaluate({})}}}Ie("DataDrivenProperty",je),Ie("DataConstantProperty",ze),Ie("CrossFadedDataDrivenProperty",ul),Ie("CrossFadedProperty",th),Ie("ColorRampProperty",tu);const ls="-transition";class In extends Ft{constructor(r,o,p){if(super(),this.id=r.id,this.type=r.type,this._globalState=p,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter,this._featureFilter=Ss(r.filter,p)),o.layout&&(this._unevaluatedLayout=new Qc(o.layout,p)),o.paint)){this._transitionablePaint=new ac(o.paint,p);for(const g in r.paint)this.setPaintProperty(g,r.paint[g],{validate:!1});for(const g in r.layout)this.setLayoutProperty(g,r.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Jc(o.paint)}}setFilter(r){this.filter=r,this._featureFilter=Ss(r,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}getLayoutAffectingGlobalStateRefs(){const r=new Set;if(this._unevaluatedLayout)for(const o in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[o];for(const g of p.getGlobalStateRefs())r.add(g)}for(const o of this._featureFilter.getGlobalStateRefs())r.add(o);return r}getPaintAffectingGlobalStateRefs(){var r;const o=new globalThis.Map;if(this._transitionablePaint)for(const p in this._transitionablePaint._values){const g=this._transitionablePaint._values[p].value;for(const v of g.getGlobalStateRefs()){const x=(r=o.get(v))!==null&&r!==void 0?r:[];x.push({name:p,value:g.value}),o.set(v,x)}}return o}setLayoutProperty(r,o,p={}){o!=null&&this._validate(Sd,`layers.${this.id}.layout.${r}`,r,o,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,o):this.visibility=o)}getPaintProperty(r){return r.endsWith(ls)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o,p={}){if(o!=null&&this._validate(Zu,`layers.${this.id}.paint.${r}`,r,o,p))return!1;if(r.endsWith(ls))return this._transitionablePaint.setTransition(r.slice(0,-11),o||void 0),!1;{const g=this._transitionablePaint._values[r],v=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(r,o),this._handleSpecialPaintPropertyUpdate(r);const R=this._transitionablePaint._values[r].value;return R.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(r,E,R)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,o,p){return!1}isHidden(r,o=!1){return!!(this.minzoom&&r<(o?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),gs(r,((o,p)=>!(o===void 0||p==="layout"&&!Object.keys(o).length||p==="paint"&&!Object.keys(o).length)))}_validate(r,o,p,g,v={}){return(!v||v.validate!==!1)&&Ya(this,r.call(Xs,{key:o,layerType:this.type,objectKey:p,value:g,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof os&&el(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}let Ja;var Ad={get paint(){return Ja=Ja||new Ir({"raster-opacity":new ze(ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new ze(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ze(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ze(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new ze(ut.paint_raster["raster-saturation"]),"raster-contrast":new ze(ut.paint_raster["raster-contrast"]),"raster-resampling":new ze(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new ze(ut.paint_raster["raster-fade-duration"])})}};class um extends In{constructor(r,o){super(r,Ad,o)}}const hl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Dr{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&(r.isTransferred=!0,o.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wi(u,r=1){let o=0,p=0;return{members:u.map((g=>{const v=hl[g.type].BYTES_PER_ELEMENT,x=o=to(o,Math.max(r,v)),E=g.components||1;return p=Math.max(p,v),o+=v*E,{name:g.name,type:g.type,components:E,offset:x}})),size:to(o,Math.max(p,r)),alignment:r}}function to(u,r){return Math.ceil(u/r)*r}class ci extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const g=2*r;return this.int16[g+0]=o,this.int16[g+1]=p,r}}ci.prototype.bytesPerElement=4,Ie("StructArrayLayout2i4",ci);class Vi extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,p)}emplace(r,o,p,g){const v=3*r;return this.int16[v+0]=o,this.int16[v+1]=p,this.int16[v+2]=g,r}}Vi.prototype.bytesPerElement=6,Ie("StructArrayLayout3i6",Vi);class Dn extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p,g)}emplace(r,o,p,g,v){const x=4*r;return this.int16[x+0]=o,this.int16[x+1]=p,this.int16[x+2]=g,this.int16[x+3]=v,r}}Dn.prototype.bytesPerElement=8,Ie("StructArrayLayout4i8",Dn);class eu extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,g,v,x)}emplace(r,o,p,g,v,x,E){const R=6*r;return this.int16[R+0]=o,this.int16[R+1]=p,this.int16[R+2]=g,this.int16[R+3]=v,this.int16[R+4]=x,this.int16[R+5]=E,r}}eu.prototype.bytesPerElement=12,Ie("StructArrayLayout2i4i12",eu);class fl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,g,v,x)}emplace(r,o,p,g,v,x,E){const R=4*r,D=8*r;return this.int16[R+0]=o,this.int16[R+1]=p,this.uint8[D+4]=g,this.uint8[D+5]=v,this.uint8[D+6]=x,this.uint8[D+7]=E,r}}fl.prototype.bytesPerElement=8,Ie("StructArrayLayout2i4ub8",fl);class kr extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const g=2*r;return this.float32[g+0]=o,this.float32[g+1]=p,r}}kr.prototype.bytesPerElement=8,Ie("StructArrayLayout2f8",kr);class oc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x,E,R,D,B){const N=this.length;return this.resize(N+1),this.emplace(N,r,o,p,g,v,x,E,R,D,B)}emplace(r,o,p,g,v,x,E,R,D,B,N){const V=10*r;return this.uint16[V+0]=o,this.uint16[V+1]=p,this.uint16[V+2]=g,this.uint16[V+3]=v,this.uint16[V+4]=x,this.uint16[V+5]=E,this.uint16[V+6]=R,this.uint16[V+7]=D,this.uint16[V+8]=B,this.uint16[V+9]=N,r}}oc.prototype.bytesPerElement=20,Ie("StructArrayLayout10ui20",oc);class bo extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x,E,R){const D=this.length;return this.resize(D+1),this.emplace(D,r,o,p,g,v,x,E,R)}emplace(r,o,p,g,v,x,E,R,D){const B=8*r;return this.uint16[B+0]=o,this.uint16[B+1]=p,this.uint16[B+2]=g,this.uint16[B+3]=v,this.uint16[B+4]=x,this.uint16[B+5]=E,this.uint16[B+6]=R,this.uint16[B+7]=D,r}}bo.prototype.bytesPerElement=16,Ie("StructArrayLayout8ui16",bo);class xo extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x,E,R,D,B,N,V){const $=this.length;return this.resize($+1),this.emplace($,r,o,p,g,v,x,E,R,D,B,N,V)}emplace(r,o,p,g,v,x,E,R,D,B,N,V,$){const W=12*r;return this.int16[W+0]=o,this.int16[W+1]=p,this.int16[W+2]=g,this.int16[W+3]=v,this.uint16[W+4]=x,this.uint16[W+5]=E,this.uint16[W+6]=R,this.uint16[W+7]=D,this.int16[W+8]=B,this.int16[W+9]=N,this.int16[W+10]=V,this.int16[W+11]=$,r}}xo.prototype.bytesPerElement=24,Ie("StructArrayLayout4i4ui4i24",xo);class eh extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,p)}emplace(r,o,p,g){const v=3*r;return this.float32[v+0]=o,this.float32[v+1]=p,this.float32[v+2]=g,r}}eh.prototype.bytesPerElement=12,Ie("StructArrayLayout3f12",eh);class Tn extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}Tn.prototype.bytesPerElement=4,Ie("StructArrayLayout1ul4",Tn);class dl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x,E,R,D){const B=this.length;return this.resize(B+1),this.emplace(B,r,o,p,g,v,x,E,R,D)}emplace(r,o,p,g,v,x,E,R,D,B){const N=10*r,V=5*r;return this.int16[N+0]=o,this.int16[N+1]=p,this.int16[N+2]=g,this.int16[N+3]=v,this.int16[N+4]=x,this.int16[N+5]=E,this.uint32[V+3]=R,this.uint16[N+8]=D,this.uint16[N+9]=B,r}}dl.prototype.bytesPerElement=20,Ie("StructArrayLayout6i1ul2ui20",dl);class wo extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,g,v,x)}emplace(r,o,p,g,v,x,E){const R=6*r;return this.int16[R+0]=o,this.int16[R+1]=p,this.int16[R+2]=g,this.int16[R+3]=v,this.int16[R+4]=x,this.int16[R+5]=E,r}}wo.prototype.bytesPerElement=12,Ie("StructArrayLayout2i2i2i12",wo);class pf extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v){const x=this.length;return this.resize(x+1),this.emplace(x,r,o,p,g,v)}emplace(r,o,p,g,v,x){const E=4*r,R=8*r;return this.float32[E+0]=o,this.float32[E+1]=p,this.float32[E+2]=g,this.int16[R+6]=v,this.int16[R+7]=x,r}}pf.prototype.bytesPerElement=16,Ie("StructArrayLayout2f1f2i16",pf);class ih extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,g,v,x)}emplace(r,o,p,g,v,x,E){const R=16*r,D=4*r,B=8*r;return this.uint8[R+0]=o,this.uint8[R+1]=p,this.float32[D+1]=g,this.float32[D+2]=v,this.int16[B+6]=x,this.int16[B+7]=E,r}}ih.prototype.bytesPerElement=16,Ie("StructArrayLayout2ub2f2i16",ih);class pl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,p)}emplace(r,o,p,g){const v=3*r;return this.uint16[v+0]=o,this.uint16[v+1]=p,this.uint16[v+2]=g,r}}pl.prototype.bytesPerElement=6,Ie("StructArrayLayout3ui6",pl);class nh extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x,E,R,D,B,N,V,$,W,Z,K,it){const yt=this.length;return this.resize(yt+1),this.emplace(yt,r,o,p,g,v,x,E,R,D,B,N,V,$,W,Z,K,it)}emplace(r,o,p,g,v,x,E,R,D,B,N,V,$,W,Z,K,it,yt){const lt=24*r,ft=12*r,At=48*r;return this.int16[lt+0]=o,this.int16[lt+1]=p,this.uint16[lt+2]=g,this.uint16[lt+3]=v,this.uint32[ft+2]=x,this.uint32[ft+3]=E,this.uint32[ft+4]=R,this.uint16[lt+10]=D,this.uint16[lt+11]=B,this.uint16[lt+12]=N,this.float32[ft+7]=V,this.float32[ft+8]=$,this.uint8[At+36]=W,this.uint8[At+37]=Z,this.uint8[At+38]=K,this.uint32[ft+10]=it,this.int16[lt+22]=yt,r}}nh.prototype.bytesPerElement=48,Ie("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",nh);class rh extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,g,v,x,E,R,D,B,N,V,$,W,Z,K,it,yt,lt,ft,At,It,Xt,pe,ue,_e,Pe,Ae){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,r,o,p,g,v,x,E,R,D,B,N,V,$,W,Z,K,it,yt,lt,ft,At,It,Xt,pe,ue,_e,Pe,Ae)}emplace(r,o,p,g,v,x,E,R,D,B,N,V,$,W,Z,K,it,yt,lt,ft,At,It,Xt,pe,ue,_e,Pe,Ae,Ee){const se=32*r,Ye=16*r;return this.int16[se+0]=o,this.int16[se+1]=p,this.int16[se+2]=g,this.int16[se+3]=v,this.int16[se+4]=x,this.int16[se+5]=E,this.int16[se+6]=R,this.int16[se+7]=D,this.uint16[se+8]=B,this.uint16[se+9]=N,this.uint16[se+10]=V,this.uint16[se+11]=$,this.uint16[se+12]=W,this.uint16[se+13]=Z,this.uint16[se+14]=K,this.uint16[se+15]=it,this.uint16[se+16]=yt,this.uint16[se+17]=lt,this.uint16[se+18]=ft,this.uint16[se+19]=At,this.uint16[se+20]=It,this.uint16[se+21]=Xt,this.uint16[se+22]=pe,this.uint32[Ye+12]=ue,this.float32[Ye+13]=_e,this.float32[Ye+14]=Pe,this.uint16[se+30]=Ae,this.uint16[se+31]=Ee,r}}rh.prototype.bytesPerElement=64,Ie("StructArrayLayout8i15ui1ul2f2ui64",rh);class lc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}lc.prototype.bytesPerElement=4,Ie("StructArrayLayout1f4",lc);class Or extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,p)}emplace(r,o,p,g){const v=3*r;return this.uint16[6*r+0]=o,this.float32[v+1]=p,this.float32[v+2]=g,r}}Or.prototype.bytesPerElement=12,Ie("StructArrayLayout1ui2f12",Or);class T extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,p)}emplace(r,o,p,g){const v=4*r;return this.uint32[2*r+0]=o,this.uint16[v+2]=p,this.uint16[v+3]=g,r}}T.prototype.bytesPerElement=8,Ie("StructArrayLayout1ul2ui8",T);class s extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const g=2*r;return this.uint16[g+0]=o,this.uint16[g+1]=p,r}}s.prototype.bytesPerElement=4,Ie("StructArrayLayout2ui4",s);class h extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}h.prototype.bytesPerElement=2,Ie("StructArrayLayout1ui2",h);class _ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p,g)}emplace(r,o,p,g,v){const x=4*r;return this.float32[x+0]=o,this.float32[x+1]=p,this.float32[x+2]=g,this.float32[x+3]=v,r}}_.prototype.bytesPerElement=16,Ie("StructArrayLayout4f16",_);class b extends Dr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new w(this.anchorPointX,this.anchorPointY)}}b.prototype.size=20;class A extends dl{get(r){return new b(this,r)}}Ie("CollisionBoxArray",A);class M extends Dr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}M.prototype.size=48;class k extends nh{get(r){return new M(this,r)}}Ie("PlacedSymbolArray",k);class O extends Dr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}O.prototype.size=64;class z extends rh{get(r){return new O(this,r)}}Ie("SymbolInstanceArray",z);class U extends lc{getoffsetX(r){return this.float32[1*r+0]}}Ie("GlyphOffsetArray",U);class q extends Vi{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Ie("SymbolLineVertexArray",q);class H extends Dr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}H.prototype.size=12;class Y extends Or{get(r){return new H(this,r)}}Ie("TextAnchorOffsetArray",Y);class et extends Dr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}et.prototype.size=8;class ot extends T{get(r){return new et(this,r)}}Ie("FeatureIndexArray",ot);class ct extends ci{}class ht extends ci{}class _t extends ci{}class Tt extends eu{}class gt extends fl{}class St extends kr{}class Et extends oc{}class xt extends bo{}class Bt extends xo{}class Gt extends eh{}class Ht extends Tn{}class Wt extends wo{}class Yt extends ih{}class ve extends pl{}class Te extends s{}const ce=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ke}=ce;class Ve{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,o,p,g){const v=this.segments[this.segments.length-1];return r>Ve.MAX_VERTEX_ARRAY_LENGTH&&$i(`Max vertices per segment is ${Ve.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ve.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!v||v.vertexLength+r>Ve.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g?this.createNewSegment(o,p,g):v}createNewSegment(r,o,p){const g={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(g.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(r,o,p){return this.prepareSegment(0,r,o,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,p,g){return new Ve([{vertexOffset:r,primitiveOffset:o,vertexLength:p,primitiveLength:g,vaos:{},sortKey:0}])}}function Fi(u,r){return 256*(u=ii(Math.floor(u),0,255))+ii(Math.floor(r),0,255)}Ve.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ie("SegmentVector",Ve);const dn=Wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),rn=Wi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var pn,Gi,qn,Yi={exports:{}},tr={exports:{}},kn={exports:{}},Xn=(function(){if(qn)return Yi.exports;qn=1;var u=(pn||(pn=1,tr.exports=function(o,p){var g,v,x,E,R,D,B,N;for(v=o.length-(g=3&o.length),x=p,R=3432918353,D=461845907,N=0;N<v;)B=255&o.charCodeAt(N)|(255&o.charCodeAt(++N))<<8|(255&o.charCodeAt(++N))<<16|(255&o.charCodeAt(++N))<<24,++N,x=27492+(65535&(E=5*(65535&(x=(x^=B=(65535&(B=(B=(65535&B)*R+(((B>>>16)*R&65535)<<16)&4294967295)<<15|B>>>17))*D+(((B>>>16)*D&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(B=0,g){case 3:B^=(255&o.charCodeAt(N+2))<<16;case 2:B^=(255&o.charCodeAt(N+1))<<8;case 1:x^=B=(65535&(B=(B=(65535&(B^=255&o.charCodeAt(N)))*R+(((B>>>16)*R&65535)<<16)&4294967295)<<15|B>>>17))*D+(((B>>>16)*D&65535)<<16)&4294967295}return x^=o.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),tr.exports),r=(Gi||(Gi=1,kn.exports=function(o,p){for(var g,v=o.length,x=p^v,E=0;v>=4;)g=1540483477*(65535&(g=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(g>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),v-=4,++E;switch(v){case 3:x^=(255&o.charCodeAt(E+2))<<16;case 2:x^=(255&o.charCodeAt(E+1))<<8;case 1:x=1540483477*(65535&(x^=255&o.charCodeAt(E)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),kn.exports);return Yi.exports=u,Yi.exports.murmur3=u,Yi.exports.murmur2=r,Yi.exports})(),vr=C(Xn);class va{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,o,p,g){this.ids.push(To(r)),this.positions.push(o,p,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=To(r);let p=0,g=this.ids.length-1;for(;p<g;){const x=p+g>>1;this.ids[x]>=o?g=x:p=x+1}const v=[];for(;this.ids[p]===o;)v.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return v}static serialize(r,o){const p=new Float64Array(r.ids),g=new Uint32Array(r.positions);return So(p,g,0,p.length-1),o&&o.push(p.buffer,g.buffer),{ids:p,positions:g}}static deserialize(r){const o=new va;return o.ids=r.ids,o.positions=r.positions,o.indexed=!0,o}}function To(u){const r=+u;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:vr(String(u))}function So(u,r,o,p){for(;o<p;){const g=u[o+p>>1];let v=o-1,x=p+1;for(;;){do v++;while(u[v]<g);do x--;while(u[x]>g);if(v>=x)break;ba(u,v,x),ba(r,3*v,3*x),ba(r,3*v+1,3*x+1),ba(r,3*v+2,3*x+2)}x-o<p-x?(So(u,r,o,x),o=x+1):(So(u,r,x+1,p),p=x)}}function ba(u,r,o){const p=u[r];u[r]=u[o],u[o]=p}Ie("FeaturePositionMap",va);class Fs{constructor(r,o){this.gl=r.gl,this.location=o}}class ml extends Fs{constructor(r,o){super(r,o),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Ao extends Fs{constructor(r,o){super(r,o),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Cs extends Fs{constructor(r,o){super(r,o),this.current=bi.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Eo=new Float32Array(16);function Co(u){return[Fi(255*u.r,255*u.g),Fi(255*u.b,255*u.a)]}class Mo{constructor(r,o,p){this.value=r,this.uniformNames=o.map((g=>`u_${g}`)),this.type=p}setUniform(r,o,p){r.set(p.constantOr(this.value))}getBinding(r,o,p){return this.type==="color"?new Cs(r,o):new ml(r,o)}}class mn{constructor(r,o){this.uniformNames=o.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=r.tlbr}setConstantDashPositions(r,o){this.dashTo=[0,r.y,r.height,r.width],this.dashFrom=[0,o.y,o.height,o.width]}setUniform(r,o,p,g){let v=null;g==="u_pattern_to"?v=this.patternTo:g==="u_pattern_from"?v=this.patternFrom:g==="u_dasharray_to"?v=this.dashTo:g==="u_dasharray_from"?v=this.dashFrom:g==="u_pixel_ratio_to"?v=this.pixelRatioTo:g==="u_pixel_ratio_from"&&(v=this.pixelRatioFrom),v!==null&&r.set(v)}getBinding(r,o,p){return p.substr(0,9)==="u_pattern"||p.substr(0,12)==="u_dasharray_"?new Ao(r,o):new ml(r,o)}}class qi{constructor(r,o,p,g){this.expression=r,this.type=p,this.maxValue=0,this.paintVertexAttributes=o.map((v=>({name:`a_${v}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new g}populatePaintArray(r,o,p){const g=this.paintVertexArray.length,v=this.expression.evaluate(new Hi(0,p),o,{},p.canonical,[],p.formattedSection);this.paintVertexArray.resize(r),this._setPaintValue(g,r,v)}updatePaintArray(r,o,p,g,v){const x=this.expression.evaluate(new Hi(0,v),p,g);this._setPaintValue(r,o,x)}_setPaintValue(r,o,p){if(this.type==="color"){const g=Co(p);for(let v=r;v<o;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=r;g<o;g++)this.paintVertexArray.emplace(g,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sn{constructor(r,o,p,g,v,x){this.expression=r,this.uniformNames=o.map((E=>`u_${E}_t`)),this.type=p,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=o.map((E=>({name:`a_${E}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new x}populatePaintArray(r,o,p){const g=this.expression.evaluate(new Hi(this.zoom,p),o,{},p.canonical,[],p.formattedSection),v=this.expression.evaluate(new Hi(this.zoom+1,p),o,{},p.canonical,[],p.formattedSection),x=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(x,r,g,v)}updatePaintArray(r,o,p,g,v){const x=this.expression.evaluate(new Hi(this.zoom,v),p,g),E=this.expression.evaluate(new Hi(this.zoom+1,v),p,g);this._setPaintValue(r,o,x,E)}_setPaintValue(r,o,p,g){if(this.type==="color"){const v=Co(p),x=Co(g);for(let E=r;E<o;E++)this.paintVertexArray.emplace(E,v[0],v[1],x[0],x[1])}else{for(let v=r;v<o;v++)this.paintVertexArray.emplace(v,p,g);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o){const p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=ii(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,o,p){return new ml(r,o)}}class sn{constructor(r,o,p,g,v,x){this.expression=r,this.type=o,this.useIntegerZoom=p,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,o,p){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,this.getPositionIds(o),p)}updatePaintArray(r,o,p,g,v){this._setPaintValues(r,o,this.getPositionIds(p),v)}_setPaintValues(r,o,p,g){const v=this.getPositions(g);if(!v||!p)return;const x=v[p.min],E=v[p.mid],R=v[p.max];if(x&&E&&R)for(let D=r;D<o;D++)this.emplace(this.zoomInPaintVertexArray,D,E,x),this.emplace(this.zoomOutPaintVertexArray,D,E,R)}upload(r){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const o=this.getVertexAttributes();this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,o,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,o,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ed extends sn{getPositions(r){return r.imagePositions}getPositionIds(r){return r.patterns&&r.patterns[this.layerId]}getVertexAttributes(){return dn.members}emplace(r,o,p,g){r.emplace(o,p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],g.tlbr[0],g.tlbr[1],g.tlbr[2],g.tlbr[3],p.pixelRatio,g.pixelRatio)}}class Cd extends sn{getPositions(r){return r.dashPositions}getPositionIds(r){return r.dashes&&r.dashes[this.layerId]}getVertexAttributes(){return rn.members}emplace(r,o,p,g){r.emplace(o,0,p.y,p.height,p.width,0,g.y,g.height,g.width)}}class iu{constructor(r,o,p){this.binders={},this._buffers=[];const g=[];for(const v in r.paint._values){if(!p(v))continue;const x=r.paint.get(v);if(!(x instanceof os&&el(x.property.specification)))continue;const E=Md(v,r.type),R=x.value,D=x.property.specification.type,B=x.property.useIntegerZoom,N=x.property.specification["property-type"],V=N==="cross-faded"||N==="cross-faded-data-driven";if(R.kind==="constant")this.binders[v]=V?new mn(R.value,E):new Mo(R.value,E,D),g.push(`/u_${v}`);else if(R.kind==="source"||V){const $=Rd(v,D,"source");this.binders[v]=V?v==="line-dasharray"?new Cd(R,D,B,o,$,r.id):new Ed(R,D,B,o,$,r.id):new qi(R,E,D,$),g.push(`/a_${v}`)}else{const $=Rd(v,D,"composite");this.binders[v]=new Sn(R,E,D,B,o,$),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof qi||o instanceof Sn?o.maxValue:0}populatePaintArrays(r,o,p){for(const g in this.binders){const v=this.binders[g];(v instanceof qi||v instanceof Sn||v instanceof sn)&&v.populatePaintArray(r,o,p)}}setConstantPatternPositions(r,o){for(const p in this.binders){const g=this.binders[p];g instanceof mn&&g.setConstantPatternPositions(r,o)}}setConstantDashPositions(r,o){for(const p in this.binders){const g=this.binders[p];g instanceof mn&&g.setConstantDashPositions(r,o)}}updatePaintArrays(r,o,p,g,v){let x=!1;for(const E in r){const R=o.getPositions(E);for(const D of R){const B=p.feature(D.index);for(const N in this.binders){const V=this.binders[N];if((V instanceof qi||V instanceof Sn||V instanceof sn)&&V.expression.isStateDependent===!0){const $=g.paint.get(N);V.expression=$.value,V.updatePaintArray(D.start,D.end,B,r[E],v),x=!0}}}}return x}defines(){const r=[];for(const o in this.binders){const p=this.binders[o];(p instanceof Mo||p instanceof mn)&&r.push(...p.uniformNames.map((g=>`#define HAS_UNIFORM_${g}`)))}return r}getBinderAttributes(){const r=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof qi||p instanceof Sn)for(let g=0;g<p.paintVertexAttributes.length;g++)r.push(p.paintVertexAttributes[g].name);else if(p instanceof sn){const g=p.getVertexAttributes();for(const v of g)r.push(v.name)}}return r}getBinderUniforms(){const r=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof Mo||p instanceof mn||p instanceof Sn)for(const g of p.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,o){const p=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof Mo||v instanceof mn||v instanceof Sn){for(const x of v.uniformNames)if(o[x]){const E=v.getBinding(r,o[x],x);p.push({name:x,property:g,binding:E})}}}return p}setUniforms(r,o,p,g){for(const{name:v,property:x,binding:E}of o)this.binders[x].setUniform(E,g,p.get(x),v)}updatePaintBuffers(r){this._buffers=[];for(const o in this.binders){const p=this.binders[o];if(r&&p instanceof sn){const g=r.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(p instanceof qi||p instanceof Sn)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(r){for(const o in this.binders){const p=this.binders[o];(p instanceof qi||p instanceof Sn||p instanceof sn)&&p.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof qi||o instanceof Sn||o instanceof sn)&&o.destroy()}}}class gl{constructor(r,o,p=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new iu(g,o,p);this.needsUpload=!1,this._featureMap=new va,this._bufferOffset=0}populatePaintArrays(r,o,p,g){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(r,o,g);o.id!==void 0&&this._featureMap.add(o.id,p,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,p,g){for(const v of p)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,o,v,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function Md(u,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${r}-`,"").replace(/-/g,"_")]}function Rd(u,r,o){const p={color:{source:kr,composite:_},number:{source:lc,composite:kr}},g=(function(v){return{"line-pattern":{source:Et,composite:Et},"fill-pattern":{source:Et,composite:Et},"fill-extrusion-pattern":{source:Et,composite:Et},"line-dasharray":{source:xt,composite:xt}}[v]})(u);return g&&g[o]||p[r][o]}Ie("ConstantBinder",Mo),Ie("CrossFadedConstantBinder",mn),Ie("SourceExpressionBinder",qi),Ie("CrossFadedPatternBinder",Ed),Ie("CrossFadedDasharrayBinder",Cd),Ie("CompositeExpressionBinder",Sn),Ie("ProgramConfiguration",iu,{omit:["_buffers"]}),Ie("ProgramConfigurationSet",gl);const xa=Math.pow(2,14)-1,sh=-xa-1;function Ro(u){const r=Ue/u.extent,o=u.loadGeometry();for(let p=0;p<o.length;p++){const g=o[p];for(let v=0;v<g.length;v++){const x=g[v],E=Math.round(x.x*r),R=Math.round(x.y*r);x.x=ii(E,sh,xa),x.y=ii(R,sh,xa),(E<x.x||E>x.x+1||R<x.y||R>x.y+1)&&$i("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function Po(u,r){return{type:u.type,id:u.id,properties:u.properties,geometry:r?Ro(u):[]}}const eo=-32768;function Pd(u,r,o,p,g){u.emplaceBack(eo+8*r+p,eo+8*o+g)}class nu{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasDependencies=!1,this.layoutVertexArray=new ht,this.indexArray=new ve,this.segments=new Ve,this.programConfigurations=new gl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){const g=this.layers[0],v=[];let x=null,E=!1,R=g.type==="heatmap";if(g.type==="circle"){const B=g;x=B.layout.get("circle-sort-key"),E=!x.isConstant(),R=R||B.paint.get("circle-pitch-alignment")==="map"}const D=R?o.subdivisionGranularity.circle:1;for(const{feature:B,id:N,index:V,sourceLayerIndex:$}of r){const W=this.layers[0]._featureFilter.needGeometry,Z=Po(B,W);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),Z,p))continue;const K=E?x.evaluate(Z,{},p):void 0,it={id:N,properties:B.properties,type:B.type,sourceLayerIndex:$,index:V,geometry:W?Z.geometry:Ro(B),patterns:{},sortKey:K};v.push(it)}E&&v.sort(((B,N)=>B.sortKey-N.sortKey));for(const B of v){const{geometry:N,index:V,sourceLayerIndex:$}=B,W=r[V].feature;this.addFeature(B,N,V,p,D),o.featureIndex.insert(W,N,V,$,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ke),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,p,g,v=1){let x;switch(v){case 1:x=[0,7];break;case 3:x=[0,2,5,7];break;case 5:x=[0,1,3,4,6,7];break;case 7:x=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${v}; valid values are 1, 3, 5, 7.`)}const E=x.length;for(const R of o)for(const D of R){const B=D.x,N=D.y;if(B<0||B>=Ue||N<0||N>=Ue)continue;const V=this.segments.prepareSegment(E*E,this.layoutVertexArray,this.indexArray,r.sortKey),$=V.vertexLength;for(let W=0;W<E;W++)for(let Z=0;Z<E;Z++)Pd(this.layoutVertexArray,B,N,x[Z],x[W]);for(let W=0;W<E-1;W++)for(let Z=0;Z<E-1;Z++){const K=$+W*E+Z,it=$+(W+1)*E+Z;this.indexArray.emplaceBack(K,it+1,K+1),this.indexArray.emplaceBack(K,it,it+1)}V.vertexLength+=E*E,V.primitiveLength+=(E-1)*(E-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{imagePositions:{},canonical:g})}}function r_(u,r){for(let o=0;o<u.length;o++)if(er(r,u[o]))return!0;for(let o=0;o<r.length;o++)if(er(u,r[o]))return!0;return!!hm(u,r)}function ah(u,r,o){return!!er(u,r)||!!o_(r,u,o)}function s_(u,r){if(u.length===1)return hr(r,u[0]);for(let o=0;o<r.length;o++){const p=r[o];for(let g=0;g<p.length;g++)if(er(u,p[g]))return!0}for(let o=0;o<u.length;o++)if(hr(r,u[o]))return!0;for(let o=0;o<r.length;o++)if(hm(u,r[o]))return!0;return!1}function a_(u,r,o){if(u.length>1){if(hm(u,r))return!0;for(let p=0;p<r.length;p++)if(o_(r[p],u,o))return!0}for(let p=0;p<u.length;p++)if(o_(u[p],r,o))return!0;return!1}function hm(u,r){if(u.length===0||r.length===0)return!1;for(let o=0;o<u.length-1;o++){const p=u[o],g=u[o+1];for(let v=0;v<r.length-1;v++)if(Uy(p,g,r[v],r[v+1]))return!0}return!1}function Uy(u,r,o,p){return Ds(u,o,p)!==Ds(r,o,p)&&Ds(u,r,o)!==Ds(u,r,p)}function o_(u,r,o){const p=o*o;if(r.length===1)return u.distSqr(r[0])<p;for(let g=1;g<r.length;g++)if(fm(u,r[g-1],r[g])<p)return!0;return!1}function fm(u,r,o){const p=r.distSqr(o);if(p===0)return u.distSqr(r);const g=((u.x-r.x)*(o.x-r.x)+(u.y-r.y)*(o.y-r.y))/p;return u.distSqr(g<0?r:g>1?o:o.sub(r)._mult(g)._add(r))}function hr(u,r){let o,p,g,v=!1;for(let x=0;x<u.length;x++){o=u[x];for(let E=0,R=o.length-1;E<o.length;R=E++)p=o[E],g=o[R],p.y>r.y!=g.y>r.y&&r.x<(g.x-p.x)*(r.y-p.y)/(g.y-p.y)+p.x&&(v=!v)}return v}function er(u,r){let o=!1;for(let p=0,g=u.length-1;p<u.length;g=p++){const v=u[p],x=u[g];v.y>r.y!=x.y>r.y&&r.x<(x.x-v.x)*(r.y-v.y)/(x.y-v.y)+v.x&&(o=!o)}return o}function Vy(u,r,o){const p=o[0],g=o[2];if(u.x<p.x&&r.x<p.x||u.x>g.x&&r.x>g.x||u.y<p.y&&r.y<p.y||u.y>g.y&&r.y>g.y)return!1;const v=Ds(u,r,o[0]);return v!==Ds(u,r,o[1])||v!==Ds(u,r,o[2])||v!==Ds(u,r,o[3])}function oh(u,r,o){const p=r.paint.get(u).value;return p.kind==="constant"?p.value:o.programConfigurations.get(r.id).getMaxValue(u)}function Id(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Dd(u,r,o,p,g){if(!r[0]&&!r[1])return u;const v=w.convert(r)._mult(g);o==="viewport"&&v._rotate(-p);const x=[];for(let E=0;E<u.length;E++)x.push(u[E].sub(v));return x}function kd({queryGeometry:u,size:r},o){return ah(u,o,r)}function jy({queryGeometry:u,size:r,transform:o,unwrappedTileID:p,getElevation:g},v){return ah(u,v,r*(o.projectTileCoordinates(v.x,v.y,p,g).signedDistanceFromCamera/o.cameraToCenterDistance))}function dm({queryGeometry:u,size:r,transform:o,unwrappedTileID:p,getElevation:g},v){const x=o.projectTileCoordinates(v.x,v.y,p,g).signedDistanceFromCamera,E=r*(o.cameraToCenterDistance/x);return ah(u,mf(v,o,p,g),E)}function $y({queryGeometry:u,size:r,transform:o,unwrappedTileID:p,getElevation:g},v){return ah(u,mf(v,o,p,g),r)}function Hy({queryGeometry:u,size:r,transform:o,unwrappedTileID:p,getElevation:g,pitchAlignment:v="map",pitchScale:x="map"},E){const R=v==="map"?x==="map"?kd:jy:x==="map"?dm:$y,D={queryGeometry:u,size:r,transform:o,unwrappedTileID:p,getElevation:g};for(const B of E)for(const N of B)if(R(D,N))return!0;return!1}function mf(u,r,o,p){const g=r.projectTileCoordinates(u.x,u.y,o,p).point;return new w((.5*g.x+.5)*r.width,(.5*-g.y+.5)*r.height)}let pm,l_;Ie("CircleBucket",nu,{omit:["layers"]});var Wy={get paint(){return l_=l_||new Ir({"circle-radius":new je(ut.paint_circle["circle-radius"]),"circle-color":new je(ut.paint_circle["circle-color"]),"circle-blur":new je(ut.paint_circle["circle-blur"]),"circle-opacity":new je(ut.paint_circle["circle-opacity"]),"circle-translate":new ze(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new ze(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ze(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ze(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new je(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new je(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new je(ut.paint_circle["circle-stroke-opacity"])})},get layout(){return pm=pm||new Ir({"circle-sort-key":new je(ut.layout_circle["circle-sort-key"])})}};class qy extends In{constructor(r,o){super(r,Wy,o)}createBucket(r){return new nu(r)}queryRadius(r){const o=r;return oh("circle-radius",this,o)+oh("circle-stroke-width",this,o)+Id(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:g,transform:v,pixelsToTileUnits:x,unwrappedTileID:E,getElevation:R}){const D=Dd(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-v.bearingInRadians,x),B=this.paint.get("circle-radius").evaluate(o,p)+this.paint.get("circle-stroke-width").evaluate(o,p),N=this.paint.get("circle-pitch-scale"),V=this.paint.get("circle-pitch-alignment");let $,W;return V==="map"?($=D,W=B*x):($=(function(Z,K,it,yt){return Z.map((lt=>mf(lt,K,it,yt)))})(D,v,E,R),W=B),Hy({queryGeometry:$,size:W,transform:v,unwrappedTileID:E,getElevation:R,pitchAlignment:V,pitchScale:N},g)}}class mm extends nu{}let gm;Ie("HeatmapBucket",mm,{omit:["layers"]});var c_={get paint(){return gm=gm||new Ir({"heatmap-radius":new je(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new je(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ze(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tu(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ze(ut.paint_heatmap["heatmap-opacity"])})}};function _m(u,{width:r,height:o},p,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*o*p)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*o*p}`)}else g=new Uint8Array(r*o*p);return u.width=r,u.height=o,u.data=g,u}function ym(u,{width:r,height:o},p){if(r===u.width&&o===u.height)return;const g=_m({},{width:r,height:o},p);gf(u,g,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,r),height:Math.min(u.height,o)},p),u.width=r,u.height=o,u.data=g.data}function gf(u,r,o,p,g,v){if(g.width===0||g.height===0)return r;if(g.width>u.width||g.height>u.height||o.x>u.width-g.width||o.y>u.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||p.x>r.width-g.width||p.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=u.data,E=r.data;if(x===E)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<g.height;R++){const D=((o.y+R)*u.width+o.x)*v,B=((p.y+R)*r.width+p.x)*v;for(let N=0;N<g.width*v;N++)E[B+N]=x[D+N]}return r}class lh{constructor(r,o){_m(this,r,1,o)}resize(r){ym(this,r,1)}clone(){return new lh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,p,g,v){gf(r,o,p,g,v,1)}}class Ms{constructor(r,o){_m(this,r,4,o)}resize(r){ym(this,r,4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ms({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,p,g,v){gf(r,o,p,g,v,4)}setPixel(r,o,p){const g=4*(r*this.width+o);this.data[g+0]=Math.round(255*p.r/p.a),this.data[g+1]=Math.round(255*p.g/p.a),this.data[g+2]=Math.round(255*p.b/p.a),this.data[g+3]=Math.round(255*p.a)}}function vm(u){const r={},o=u.resolution||256,p=u.clips?u.clips.length:1,g=u.image||new Ms({width:o,height:p});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const v=(x,E,R)=>{r[u.evaluationKey]=R;const D=u.expression.evaluate(r);g.setPixel(x/4/o,E/4,D)};if(u.clips)for(let x=0,E=0;x<p;++x,E+=4*o)for(let R=0,D=0;R<o;R++,D+=4){const B=R/(o-1),{start:N,end:V}=u.clips[x];v(E,D,N*(1-B)+V*B)}else for(let x=0,E=0;x<o;x++,E+=4)v(0,E,x/(o-1));return g}Ie("AlphaImage",lh),Ie("RGBAImage",Ms);const bm="big-fb";class cc extends In{createBucket(r){return new mm(r)}constructor(r,o){super(r,c_,o),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(bm)&&this.heatmapFbos.delete(bm)}queryRadius(r){return oh("heatmap-radius",this,r)}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:g,transform:v,pixelsToTileUnits:x,unwrappedTileID:E,getElevation:R}){return Hy({queryGeometry:r,size:this.paint.get("heatmap-radius").evaluate(o,p)*x,transform:v,unwrappedTileID:E,getElevation:R},g)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xm;var n0={get paint(){return xm=xm||new Ir({"hillshade-illumination-direction":new ze(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ze(ut.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ze(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ze(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ze(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ze(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ze(ut.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ze(ut.paint_hillshade["hillshade-method"])})}};class Xy extends In{constructor(r,o){super(r,n0,o),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let r=this.paint.get("hillshade-illumination-direction").values,o=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,g=this.paint.get("hillshade-shadow-color").values;const v=Math.max(r.length,o.length,p.length,g.length);r=r.concat(Array(v-r.length).fill(r.at(-1))),o=o.concat(Array(v-o.length).fill(o.at(-1))),p=p.concat(Array(v-p.length).fill(p.at(-1))),g=g.concat(Array(v-g.length).fill(g.at(-1)));const x=o.map(or);return{directionRadians:r.map(or),altitudeRadians:x,shadowColor:g,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let _l;var u_={get paint(){return _l=_l||new Ir({"color-relief-opacity":new ze(ut["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new tu(ut["paint_color-relief"]["color-relief-color"])})}};class wm{constructor(r,o,p,g){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(o,g)}update(r,o,p){const{width:g,height:v}=r,x=!(this.size&&this.size[0]===g&&this.size[1]===v||p),{context:E}=this,{gl:R}=E;if(this.useMipmap=!!(o&&o.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[g,v],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||aa(r)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,r):R.texImage2D(R.TEXTURE_2D,0,this.format,g,v,0,this.format,R.UNSIGNED_BYTE,r.data);else{const{x:D,y:B}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||aa(r)?R.texSubImage2D(R.TEXTURE_2D,0,D,B,R.RGBA,R.UNSIGNED_BYTE,r):R.texSubImage2D(R.TEXTURE_2D,0,D,B,g,v,R.RGBA,R.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D),E.pixelStoreUnpackFlipY.setDefault(),E.pixelStoreUnpack.setDefault(),E.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(r,o,p){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),r!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||r),this.filter=r),o!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Od{constructor(r,o,p,g=1,v=1,x=1,E=0){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void $i(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const R=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=v,this.blueFactor=x,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<R;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(R,D)]=this.data[this._idx(R-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,R)]=this.data[this._idx(D,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<R;D++)for(let B=0;B<R;B++){const N=this.get(D,B);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(r,o){const p=new Uint8Array(this.data.buffer),g=4*this._idx(r,o);return this.unpack(p[g],p[g+1],p[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}unpack(r,o,p){return r*this.redFactor+o*this.greenFactor+p*this.blueFactor-this.baseShift}pack(r){return _f(r,this.getUnpackVector())}getPixels(){return new Ms({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,o,p){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=o*this.dim,v=o*this.dim+this.dim,x=p*this.dim,E=p*this.dim+this.dim;switch(o){case-1:g=v-1;break;case 1:v=g+1}switch(p){case-1:x=E-1;break;case 1:E=x+1}const R=-o*this.dim,D=-p*this.dim;for(let B=x;B<E;B++)for(let N=g;N<v;N++)this.data[this._idx(N,B)]=r.data[this._idx(N+R,B+D)]}}function _f(u,r){const o=r[0],p=r[1],g=r[2],v=r[3],x=Math.min(o,p,g),E=Math.round((u+v)/x);return{r:Math.floor(E*x/o)%256,g:Math.floor(E*x/p)%256,b:Math.floor(E*x/g)%256}}Ie("DEMData",Od);class On extends In{constructor(r,o){super(r,u_,o)}_createColorRamp(r){const o={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof nl&&p._styleExpression.expression instanceof yr){this.colorRampExpression=p;const x=p._styleExpression.expression;o.elevationStops=x.labels,o.colorStops=[];for(const E of o.elevationStops)o.colorStops.push(x.evaluate({globals:{elevation:E}}))}if(o.elevationStops.length<1&&(o.elevationStops=[0],o.colorStops=[bi.transparent]),o.elevationStops.length<2&&(o.elevationStops.push(o.elevationStops[0]+1),o.colorStops.push(o.colorStops[0])),o.elevationStops.length<=r)return o;const g={elevationStops:[],colorStops:[]},v=(o.elevationStops.length-1)/(r-1);for(let x=0;x<o.elevationStops.length-.5;x+=v)g.elevationStops.push(o.elevationStops[Math.round(x)]),g.colorStops.push(o.colorStops[Math.round(x)]);return $i(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${r}, provided: ${o.elevationStops.length}`),g}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(r,o,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const g=this._createColorRamp(o),v=new Ms({width:g.colorStops.length,height:1}),x=new Ms({width:g.colorStops.length,height:1});for(let E=0;E<g.elevationStops.length;E++){const R=_f(g.elevationStops[E],p);x.setPixel(0,E,new bi(R.r/255,R.g/255,R.b/255,1)),v.setPixel(0,E,g.colorStops[E])}return this.colorRampTextures={elevationTexture:new wm(r,x,r.gl.RGBA),colorTexture:new wm(r,v,r.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const r0=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:s0}=r0;function Bd(u,r,o){const p=o.patternDependencies;let g=!1;for(const v of r){const x=v.paint.get(`${u}-pattern`);x.isConstant()||(g=!0);const E=x.constantOr(null);E&&(g=!0,p[E.to]=!0,p[E.from]=!0)}return g}function ch(u,r,o,p,g){const{zoom:v}=p,x=g.patternDependencies;for(const E of r){const R=E.paint.get(`${u}-pattern`).value;if(R.kind!=="constant"){let D=R.evaluate({zoom:v-1},o,{},g.availableImages),B=R.evaluate({zoom:v},o,{},g.availableImages),N=R.evaluate({zoom:v+1},o,{},g.availableImages);D=D&&D.name?D.name:D,B=B&&B.name?B.name:B,N=N&&N.name?N.name:N,x[D]=!0,x[B]=!0,x[N]=!0,o.patterns[E.id]={min:D,mid:B,max:N}}}return o}function uc(u,r,o,p,g){let v;if(g===(function(x,E,R,D){let B=0;for(let N=E,V=R-D;N<R;N+=D)B+=(x[V]-x[N])*(x[N+1]+x[V+1]),V=N;return B})(u,r,o,p)>0)for(let x=r;x<o;x+=p)v=bl(x/p|0,u[x],u[x+1],v);else for(let x=o-p;x>=r;x-=p)v=bl(x/p|0,u[x],u[x+1],v);return v&&Zn(v,v.next)&&(bf(v),v=v.next),v}function ru(u,r){if(!u)return u;r||(r=u);let o,p=u;do if(o=!1,p.steiner||!Zn(p,p.next)&&Nn(p.prev,p,p.next)!==0)p=p.next;else{if(bf(p),p=r=p.prev,p===p.next)break;o=!0}while(o||p!==r);return r}function yf(u,r,o,p,g,v,x){if(!u)return;!x&&v&&(function(R,D,B,N){let V=R;do V.z===0&&(V.z=vf(V.x,V.y,D,B,N)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==R);V.prevZ.nextZ=null,V.prevZ=null,(function($){let W,Z=1;do{let K,it=$;$=null;let yt=null;for(W=0;it;){W++;let lt=it,ft=0;for(let It=0;It<Z&&(ft++,lt=lt.nextZ,lt);It++);let At=Z;for(;ft>0||At>0&&lt;)ft!==0&&(At===0||!lt||it.z<=lt.z)?(K=it,it=it.nextZ,ft--):(K=lt,lt=lt.nextZ,At--),yt?yt.nextZ=K:$=K,K.prevZ=yt,yt=K;it=lt}yt.nextZ=null,Z*=2}while(W>1)})(V)})(u,p,g,v);let E=u;for(;u.prev!==u.next;){const R=u.prev,D=u.next;if(v?yl(u,p,g,v):Ld(u))r.push(R.i,u.i,D.i),bf(u),u=D.next,E=D.next;else if((u=D)===E){x?x===1?yf(u=Zy(ru(u),r),r,o,p,g,v,2):x===2&&h_(u,r,o,p,g,v):yf(ru(u),r,o,p,g,v,1);break}}}function Ld(u){const r=u.prev,o=u,p=u.next;if(Nn(r,o,p)>=0)return!1;const g=r.x,v=o.x,x=p.x,E=r.y,R=o.y,D=p.y,B=Math.min(g,v,x),N=Math.min(E,R,D),V=Math.max(g,v,x),$=Math.max(E,R,D);let W=p.next;for(;W!==r;){if(W.x>=B&&W.x<=V&&W.y>=N&&W.y<=$&&Fn(g,E,v,R,x,D,W.x,W.y)&&Nn(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function yl(u,r,o,p){const g=u.prev,v=u,x=u.next;if(Nn(g,v,x)>=0)return!1;const E=g.x,R=v.x,D=x.x,B=g.y,N=v.y,V=x.y,$=Math.min(E,R,D),W=Math.min(B,N,V),Z=Math.max(E,R,D),K=Math.max(B,N,V),it=vf($,W,r,o,p),yt=vf(Z,K,r,o,p);let lt=u.prevZ,ft=u.nextZ;for(;lt&&lt.z>=it&&ft&&ft.z<=yt;){if(lt.x>=$&&lt.x<=Z&&lt.y>=W&&lt.y<=K&&lt!==g&&lt!==x&&Fn(E,B,R,N,D,V,lt.x,lt.y)&&Nn(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,ft.x>=$&&ft.x<=Z&&ft.y>=W&&ft.y<=K&&ft!==g&&ft!==x&&Fn(E,B,R,N,D,V,ft.x,ft.y)&&Nn(ft.prev,ft,ft.next)>=0))return!1;ft=ft.nextZ}for(;lt&&lt.z>=it;){if(lt.x>=$&&lt.x<=Z&&lt.y>=W&&lt.y<=K&&lt!==g&&lt!==x&&Fn(E,B,R,N,D,V,lt.x,lt.y)&&Nn(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;ft&&ft.z<=yt;){if(ft.x>=$&&ft.x<=Z&&ft.y>=W&&ft.y<=K&&ft!==g&&ft!==x&&Fn(E,B,R,N,D,V,ft.x,ft.y)&&Nn(ft.prev,ft,ft.next)>=0)return!1;ft=ft.nextZ}return!0}function Zy(u,r){let o=u;do{const p=o.prev,g=o.next.next;!Zn(p,g)&&Ky(p,o,o.next,g)&&gn(p,g)&&gn(g,p)&&(r.push(p.i,o.i,g.i),bf(o),bf(o.next),o=u=g),o=o.next}while(o!==u);return ru(o)}function h_(u,r,o,p,g,v){let x=u;do{let E=x.next.next;for(;E!==x.prev;){if(x.i!==E.i&&p_(x,E)){let R=Ns(x,E);return x=ru(x,x.next),R=ru(R,R.next),yf(x,r,o,p,g,v,0),void yf(R,r,o,p,g,v,0)}E=E.next}x=x.next}while(x!==u)}function Gy(u,r){let o=u.x-r.x;return o===0&&(o=u.y-r.y,o===0)&&(o=(u.next.y-u.y)/(u.next.x-u.x)-(r.next.y-r.y)/(r.next.x-r.x)),o}function f_(u,r){const o=(function(g,v){let x=v;const E=g.x,R=g.y;let D,B=-1/0;if(Zn(g,x))return x;do{if(Zn(g,x.next))return x.next;if(R<=x.y&&R>=x.next.y&&x.next.y!==x.y){const Z=x.x+(R-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(Z<=E&&Z>B&&(B=Z,D=x.x<x.next.x?x:x.next,Z===E))return D}x=x.next}while(x!==v);if(!D)return null;const N=D,V=D.x,$=D.y;let W=1/0;x=D;do{if(E>=x.x&&x.x>=V&&E!==x.x&&vl(R<$?E:B,R,V,$,R<$?B:E,R,x.x,x.y)){const Z=Math.abs(R-x.y)/(E-x.x);gn(x,g)&&(Z<W||Z===W&&(x.x>D.x||x.x===D.x&&d_(D,x)))&&(D=x,W=Z)}x=x.next}while(x!==N);return D})(u,r);if(!o)return r;const p=Ns(o,u);return ru(p,p.next),ru(o,o.next)}function d_(u,r){return Nn(u.prev,u,r.prev)<0&&Nn(r.next,u,u.next)<0}function vf(u,r,o,p,g){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-o)*g|0)|u<<8))|u<<4))|u<<2))|u<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Yy(u){let r=u,o=u;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==u);return o}function vl(u,r,o,p,g,v,x,E){return(g-x)*(r-E)>=(u-x)*(v-E)&&(u-x)*(p-E)>=(o-x)*(r-E)&&(o-x)*(v-E)>=(g-x)*(p-E)}function Fn(u,r,o,p,g,v,x,E){return!(u===x&&r===E)&&vl(u,r,o,p,g,v,x,E)}function p_(u,r){return u.next.i!==r.i&&u.prev.i!==r.i&&!(function(o,p){let g=o;do{if(g.i!==o.i&&g.next.i!==o.i&&g.i!==p.i&&g.next.i!==p.i&&Ky(g,g.next,o,p))return!0;g=g.next}while(g!==o);return!1})(u,r)&&(gn(u,r)&&gn(r,u)&&(function(o,p){let g=o,v=!1;const x=(o.x+p.x)/2,E=(o.y+p.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&x<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==o);return v})(u,r)&&(Nn(u.prev,u,r.prev)||Nn(u,r.prev,r))||Zn(u,r)&&Nn(u.prev,u,u.next)>0&&Nn(r.prev,r,r.next)>0)}function Nn(u,r,o){return(r.y-u.y)*(o.x-r.x)-(r.x-u.x)*(o.y-r.y)}function Zn(u,r){return u.x===r.x&&u.y===r.y}function Ky(u,r,o,p){const g=Nd(Nn(u,r,o)),v=Nd(Nn(u,r,p)),x=Nd(Nn(o,p,u)),E=Nd(Nn(o,p,r));return g!==v&&x!==E||!(g!==0||!Fd(u,o,r))||!(v!==0||!Fd(u,p,r))||!(x!==0||!Fd(o,u,p))||!(E!==0||!Fd(o,r,p))}function Fd(u,r,o){return r.x<=Math.max(u.x,o.x)&&r.x>=Math.min(u.x,o.x)&&r.y<=Math.max(u.y,o.y)&&r.y>=Math.min(u.y,o.y)}function Nd(u){return u>0?1:u<0?-1:0}function gn(u,r){return Nn(u.prev,u,u.next)<0?Nn(u,r,u.next)>=0&&Nn(u,u.prev,r)>=0:Nn(u,r,u.prev)<0||Nn(u,u.next,r)<0}function Ns(u,r){const o=Tm(u.i,u.x,u.y),p=Tm(r.i,r.x,r.y),g=u.next,v=r.prev;return u.next=r,r.prev=u,o.next=g,g.prev=o,p.next=o,o.prev=p,v.next=p,p.prev=v,p}function bl(u,r,o,p){const g=Tm(u,r,o);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function bf(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Tm(u,r,o){return{i:u,x:r,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class uh{constructor(r,o){if(o>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=o}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class Sm{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}Sm.noSubdivision=new Sm({fill:new uh(0,0),line:new uh(0,0),tile:new uh(0,0),stencil:new uh(0,0),circle:1}),Ie("SubdivisionGranularityExpression",uh),Ie("SubdivisionGranularitySetting",Sm);const hc=-32768,$r=32767;class Io{constructor(r,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=Ue/r,this._canonical=o}_getKey(r,o){return(r+=32768)<<16|o+32768}_vertexToIndex(r,o){if(r<-32768||o<-32768||r>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(r),g=0|Math.round(o),v=this._getKey(p,g);if(this._vertexDictionary.has(v))return this._vertexDictionary.get(v);const x=this._vertexBuffer.length/2;return this._vertexDictionary.set(v,x),this._vertexBuffer.push(p,g),x}_subdivideTrianglesScanline(r){if(this._granularity<2)return(function(g,v){const x=[];for(let E=0;E<v.length;E+=3){const R=v[E],D=v[E+1],B=v[E+2],N=g[2*R],V=g[2*R+1];(g[2*D]-N)*(g[2*B+1]-V)-(g[2*D+1]-V)*(g[2*B]-N)>0?(x.push(R),x.push(B),x.push(D)):(x.push(R),x.push(D),x.push(B))}return x})(this._vertexBuffer,r);const o=[],p=r.length;for(let g=0;g<p;g+=3){const v=[r[g+0],r[g+1],r[g+2]],x=[this._vertexBuffer[2*r[g+0]+0],this._vertexBuffer[2*r[g+0]+1],this._vertexBuffer[2*r[g+1]+0],this._vertexBuffer[2*r[g+1]+1],this._vertexBuffer[2*r[g+2]+0],this._vertexBuffer[2*r[g+2]+1]];let E=1/0,R=1/0,D=-1/0,B=-1/0;for(let Z=0;Z<3;Z++){const K=x[2*Z],it=x[2*Z+1];E=Math.min(E,K),D=Math.max(D,K),R=Math.min(R,it),B=Math.max(B,it)}if(E===D||R===B)continue;const N=Math.floor(E/this._granularityCellSize),V=Math.ceil(D/this._granularityCellSize),$=Math.floor(R/this._granularityCellSize),W=Math.ceil(B/this._granularityCellSize);if(N!==V||$!==W)for(let Z=$;Z<W;Z++){const K=this._scanlineGenerateVertexRingForCellRow(Z,x,v);Qy(this._vertexBuffer,K,o)}else o.push(...v)}return o}_scanlineGenerateVertexRingForCellRow(r,o,p){const g=r*this._granularityCellSize,v=g+this._granularityCellSize,x=[];for(let E=0;E<3;E++){const R=o[2*E],D=o[2*E+1],B=o[2*(E+1)%6],N=o[(2*(E+1)+1)%6],V=o[2*(E+2)%6],$=o[(2*(E+2)+1)%6],W=B-R,Z=N-D,K=W===0,it=Z===0,yt=(g-D)/Z,lt=(v-D)/Z,ft=Math.min(yt,lt),At=Math.max(yt,lt);if(!it&&(ft>=1||At<=0)||it&&(D<g||D>v)){N>=g&&N<=v&&x.push(p[(E+1)%3]);continue}!it&&ft>0&&x.push(this._vertexToIndex(R+W*ft,D+Z*ft));const It=R+W*Math.max(ft,0),Xt=R+W*Math.min(At,1);K||this._generateIntraEdgeVertices(x,R,D,B,N,It,Xt),!it&&At<1&&x.push(this._vertexToIndex(R+W*At,D+Z*At)),(it||N>=g&&N<=v)&&x.push(p[(E+1)%3]),!it&&(N<=g||N>=v)&&this._generateInterEdgeVertices(x,R,D,B,N,V,$,Xt,g,v)}return x}_generateIntraEdgeVertices(r,o,p,g,v,x,E){const R=g-o,D=v-p,B=D===0,N=B?Math.min(o,g):Math.min(x,E),V=B?Math.max(o,g):Math.max(x,E),$=Math.floor(N/this._granularityCellSize)+1,W=Math.ceil(V/this._granularityCellSize)-1;if(B?o<g:x<E)for(let Z=$;Z<=W;Z++){const K=Z*this._granularityCellSize;r.push(this._vertexToIndex(K,p+D*(K-o)/R))}else for(let Z=W;Z>=$;Z--){const K=Z*this._granularityCellSize;r.push(this._vertexToIndex(K,p+D*(K-o)/R))}}_generateInterEdgeVertices(r,o,p,g,v,x,E,R,D,B){const N=v-p,V=x-g,$=E-v,W=(D-v)/$,Z=(B-v)/$,K=Math.min(W,Z),it=Math.max(W,Z),yt=g+V*K;let lt=Math.floor(Math.min(yt,R)/this._granularityCellSize)+1,ft=Math.ceil(Math.max(yt,R)/this._granularityCellSize)-1,At=R<yt;const It=$===0;if(It&&(E===D||E===B))return;if(It||K>=1||it<=0){const pe=p-E,ue=x+(o-x)*Math.min((D-E)/pe,(B-E)/pe);lt=Math.floor(Math.min(ue,R)/this._granularityCellSize)+1,ft=Math.ceil(Math.max(ue,R)/this._granularityCellSize)-1,At=R<ue}const Xt=N>0?B:D;if(At)for(let pe=lt;pe<=ft;pe++)r.push(this._vertexToIndex(pe*this._granularityCellSize,Xt));else for(let pe=ft;pe>=lt;pe--)r.push(this._vertexToIndex(pe*this._granularityCellSize,Xt))}_generateOutline(r){const o=[];for(const p of r){const g=br(p,this._granularity,!0),v=this._pointArrayToIndices(g),x=[];for(let E=1;E<v.length;E++)x.push(v[E-1]),x.push(v[E]);o.push(x)}return o}_handlePoles(r){let o=!1,p=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(o||p)&&this._fillPoles(r,o,p)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let o=0;o<r.length;o+=2){const p=r[o+1];p===hc&&(r[o+1]=-32767),p===$r&&(r[o+1]=32766)}}_generatePoleQuad(r,o,p,g,v,x){g>v!=(x===hc)?(r.push(o),r.push(p),r.push(this._vertexToIndex(g,x)),r.push(p),r.push(this._vertexToIndex(v,x)),r.push(this._vertexToIndex(g,x))):(r.push(p),r.push(o),r.push(this._vertexToIndex(g,x)),r.push(this._vertexToIndex(v,x)),r.push(p),r.push(this._vertexToIndex(g,x)))}_fillPoles(r,o,p){const g=this._vertexBuffer,v=Ue,x=r.length;for(let E=2;E<x;E+=3){const R=r[E-2],D=r[E-1],B=r[E],N=g[2*R],V=g[2*R+1],$=g[2*D],W=g[2*D+1],Z=g[2*B],K=g[2*B+1];o&&(V===0&&W===0&&this._generatePoleQuad(r,R,D,N,$,hc),W===0&&K===0&&this._generatePoleQuad(r,D,B,$,Z,hc),K===0&&V===0&&this._generatePoleQuad(r,B,R,Z,N,hc)),p&&(V===v&&W===v&&this._generatePoleQuad(r,R,D,N,$,$r),W===v&&K===v&&this._generatePoleQuad(r,D,B,$,Z,$r),K===v&&V===v&&this._generatePoleQuad(r,B,R,Z,N,$r))}}_initializeVertices(r){for(let o=0;o<r.length;o+=2)this._vertexToIndex(r[o],r[o+1])}subdividePolygonInternal(r,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:g}=(function(E){const R=[],D=[];for(const B of E)if(B.length!==0){B!==E[0]&&R.push(D.length/2);for(let N=0;N<B.length;N++)D.push(B[N].x),D.push(B[N].y)}return{flattened:D,holeIndices:R}})(r);let v;this._initializeVertices(p);try{const E=(function(D,B,N=2){const V=B&&B.length,$=V?B[0]*N:D.length;let W=uc(D,0,$,N,!0);const Z=[];if(!W||W.next===W.prev)return Z;let K,it,yt;if(V&&(W=(function(lt,ft,At,It){const Xt=[];for(let pe=0,ue=ft.length;pe<ue;pe++){const _e=uc(lt,ft[pe]*It,pe<ue-1?ft[pe+1]*It:lt.length,It,!1);_e===_e.next&&(_e.steiner=!0),Xt.push(Yy(_e))}Xt.sort(Gy);for(let pe=0;pe<Xt.length;pe++)At=f_(Xt[pe],At);return At})(D,B,W,N)),D.length>80*N){K=D[0],it=D[1];let lt=K,ft=it;for(let At=N;At<$;At+=N){const It=D[At],Xt=D[At+1];It<K&&(K=It),Xt<it&&(it=Xt),It>lt&&(lt=It),Xt>ft&&(ft=Xt)}yt=Math.max(lt-K,ft-it),yt=yt!==0?32767/yt:0}return yf(W,Z,N,K,it,yt,0),Z})(p,g),R=this._convertIndices(p,E);v=this._subdivideTrianglesScanline(R)}catch(E){console.error(E)}let x=[];return o&&(x=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(v),{verticesFlattened:this._vertexBuffer,indicesTriangles:v,indicesLineList:x}}_convertIndices(r,o){const p=[];for(let g=0;g<o.length;g++)p.push(this._vertexToIndex(r[2*o[g]],r[2*o[g]+1]));return p}_pointArrayToIndices(r){const o=[];for(let p=0;p<r.length;p++){const g=r[p];o.push(this._vertexToIndex(g.x,g.y))}return o}}function m_(u,r,o,p=!0){return new Io(o,r).subdividePolygonInternal(u,p)}function br(u,r,o=!1){if(!u||u.length<1)return[];if(u.length<2)return[];const p=u[0],g=u[u.length-1],v=o&&(p.x!==g.x||p.y!==g.y);if(r<2)return v?[...u,u[0]]:[...u];const x=Math.floor(Ue/r),E=[];E.push(new w(u[0].x,u[0].y));const R=u.length,D=v?R:R-1;for(let B=0;B<D;B++){const N=u[B],V=B<R-1?u[B+1]:u[0],$=N.x,W=N.y,Z=V.x,K=V.y,it=$!==Z,yt=W!==K;if(!it&&!yt)continue;const lt=Z-$,ft=K-W,At=Math.abs(lt),It=Math.abs(ft);let Xt=$,pe=W;for(;;){const _e=lt>0?(Math.floor(Xt/x)+1)*x:(Math.ceil(Xt/x)-1)*x,Pe=ft>0?(Math.floor(pe/x)+1)*x:(Math.ceil(pe/x)-1)*x,Ae=Math.abs(Xt-_e),Ee=Math.abs(pe-Pe),se=Math.abs(Xt-Z),Ye=Math.abs(pe-K),Xe=it?Ae/At:Number.POSITIVE_INFINITY,Ge=yt?Ee/It:Number.POSITIVE_INFINITY;if((se<=Ae||!it)&&(Ye<=Ee||!yt))break;if(Xe<Ge&&it||!yt){Xt=_e,pe+=ft*Xe;const Fe=new w(Xt,Math.round(pe));E[E.length-1].x===Fe.x&&E[E.length-1].y===Fe.y||E.push(Fe)}else{Xt+=lt*Ge,pe=Pe;const Fe=new w(Math.round(Xt),pe);E[E.length-1].x===Fe.x&&E[E.length-1].y===Fe.y||E.push(Fe)}}const ue=new w(Z,K);E[E.length-1].x===ue.x&&E[E.length-1].y===ue.y||E.push(ue)}return E}function Qy(u,r,o){if(r.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,g=u[2*r[0]];for(let R=1;R<r.length;R++){const D=u[2*r[R]];D<g&&(g=D,p=R)}const v=r.length;let x=p,E=(x+1)%v;for(;;){const R=x-1>=0?x-1:v-1,D=(E+1)%v,B=u[2*r[R]],N=u[2*r[D]],V=u[2*r[x]],$=u[2*r[x]+1],W=u[2*r[E]+1];let Z=!1;if(B<N)Z=!0;else if(B>N)Z=!1;else{const K=W-$,it=-(u[2*r[E]]-V),yt=$<W?1:-1;((B-V)*K+(u[2*r[R]+1]-$)*it)*yt>((N-V)*K+(u[2*r[D]+1]-$)*it)*yt&&(Z=!0)}if(Z){const K=r[R],it=r[x],yt=r[E];K!==it&&K!==yt&&it!==yt&&o.push(yt,it,K),x--,x<0&&(x=v-1)}else{const K=r[D],it=r[x],yt=r[E];K!==it&&K!==yt&&it!==yt&&o.push(yt,it,K),E++,E>=v&&(E=0)}if(R===D)break}}function xl(u,r,o,p,g,v,x,E,R){const D=g.length/2,B=x&&E&&R;if(D<Ve.MAX_VERTEX_ARRAY_LENGTH){const N=r.prepareSegment(D,o,p),V=N.vertexLength;for(let Z=0;Z<v.length;Z+=3)p.emplaceBack(V+v[Z],V+v[Z+1],V+v[Z+2]);let $,W;N.vertexLength+=D,N.primitiveLength+=v.length/3,B&&(W=x.prepareSegment(D,o,E),$=W.vertexLength,W.vertexLength+=D);for(let Z=0;Z<g.length;Z+=2)u(g[Z],g[Z+1]);if(B)for(let Z=0;Z<R.length;Z++){const K=R[Z];for(let it=1;it<K.length;it+=2)E.emplaceBack($+K[it-1],$+K[it]);W.primitiveLength+=K.length/2}}else(function(N,V,$,W,Z,K){const it=[];for(let It=0;It<W.length/2;It++)it.push(-1);const yt={count:0};let lt=0,ft=N.getOrCreateLatestSegment(V,$),At=ft.vertexLength;for(let It=2;It<Z.length;It+=3){const Xt=Z[It-2],pe=Z[It-1],ue=Z[It];let _e=it[Xt]<lt,Pe=it[pe]<lt,Ae=it[ue]<lt;ft.vertexLength+((_e?1:0)+(Pe?1:0)+(Ae?1:0))>Ve.MAX_VERTEX_ARRAY_LENGTH&&(ft=N.createNewSegment(V,$),lt=yt.count,_e=!0,Pe=!0,Ae=!0,At=0);const Ee=Do(it,W,K,yt,Xt,_e,ft),se=Do(it,W,K,yt,pe,Pe,ft),Ye=Do(it,W,K,yt,ue,Ae,ft);$.emplaceBack(At+Ee-lt,At+se-lt,At+Ye-lt),ft.primitiveLength++}})(r,o,p,g,v,u),B&&(function(N,V,$,W,Z,K){const it=[];for(let It=0;It<W.length/2;It++)it.push(-1);const yt={count:0};let lt=0,ft=N.getOrCreateLatestSegment(V,$),At=ft.vertexLength;for(let It=0;It<Z.length;It++){const Xt=Z[It];for(let pe=1;pe<Z[It].length;pe+=2){const ue=Xt[pe-1],_e=Xt[pe];let Pe=it[ue]<lt,Ae=it[_e]<lt;ft.vertexLength+((Pe?1:0)+(Ae?1:0))>Ve.MAX_VERTEX_ARRAY_LENGTH&&(ft=N.createNewSegment(V,$),lt=yt.count,Pe=!0,Ae=!0,At=0);const Ee=Do(it,W,K,yt,ue,Pe,ft),se=Do(it,W,K,yt,_e,Ae,ft);$.emplaceBack(At+Ee-lt,At+se-lt),ft.primitiveLength++}}})(x,o,E,g,R,u),r.forceNewSegmentOnNextPrepare(),x?.forceNewSegmentOnNextPrepare()}function Do(u,r,o,p,g,v,x){if(v){const E=p.count;return o(r[2*g],r[2*g+1]),u[g]=p.count,p.count++,x.vertexLength++,E}return u[g]}class ko{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new _t,this.indexArray=new ve,this.indexArray2=new Te,this.programConfigurations=new gl(r.layers,r.zoom),this.segments=new Ve,this.segments2=new Ve,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.hasDependencies=Bd("fill",this.layers,o);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),x=[];for(const{feature:E,id:R,index:D,sourceLayerIndex:B}of r){const N=this.layers[0]._featureFilter.needGeometry,V=Po(E,N);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),V,p))continue;const $=v?g.evaluate(V,{},p,o.availableImages):void 0,W={id:R,properties:E.properties,type:E.type,sourceLayerIndex:B,index:D,geometry:N?V.geometry:Ro(E),patterns:{},sortKey:$};x.push(W)}v&&x.sort(((E,R)=>E.sortKey-R.sortKey));for(const E of x){const{geometry:R,index:D,sourceLayerIndex:B}=E;if(this.hasDependencies){const N=ch("fill",this.layers,E,{zoom:this.zoom},o);this.patternFeatures.push(N)}else this.addFeature(E,R,D,p,{},o.subdivisionGranularity);o.featureIndex.insert(r[D].feature,R,D,B,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,{imagePositions:p})}addFeatures(r,o,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,o,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,s0),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,o,p,g,v,x){for(const E of jc(o,500)){const R=m_(E,g,x.fill.getGranularityForZoomLevel(g.z)),D=this.layoutVertexArray;xl(((B,N)=>{D.emplaceBack(B,N)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles,this.segments2,this.indexArray2,R.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{imagePositions:v,canonical:g})}}let Am,Em;Ie("FillBucket",ko,{omit:["layers","patternFeatures"]});var Oo={get paint(){return Em=Em||new Ir({"fill-antialias":new ze(ut.paint_fill["fill-antialias"]),"fill-opacity":new je(ut.paint_fill["fill-opacity"]),"fill-color":new je(ut.paint_fill["fill-color"]),"fill-outline-color":new je(ut.paint_fill["fill-outline-color"]),"fill-translate":new ze(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new ze(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new ul(ut.paint_fill["fill-pattern"])})},get layout(){return Am=Am||new Ir({"fill-sort-key":new je(ut.layout_fill["fill-sort-key"])})}};class Jy extends In{constructor(r,o){super(r,Oo,o)}recalculate(r,o){super.recalculate(r,o);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new ko(r)}queryRadius(){return Id(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:o,transform:p,pixelsToTileUnits:g}){return s_(Dd(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,g),o)}isTileClipped(){return!0}}const xf=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),zd=Wi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ud}=xf;class Bo{constructor(r,o,p,g,v){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=g,this._values=v,r.readFields(tv,this,o)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos,p=[];let g,v=1,x=0,E=0,R=0;for(;r.pos<o;){if(x<=0){const D=r.readVarint();v=7&D,x=D>>3}if(x--,v===1||v===2)E+=r.readSVarint(),R+=r.readSVarint(),v===1&&(g&&p.push(g),g=[]),g&&g.push(new w(E,R));else{if(v!==7)throw new Error(`unknown command ${v}`);g&&g.push(g[0].clone())}}return g&&p.push(g),p}bbox(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos;let p=1,g=0,v=0,x=0,E=1/0,R=-1/0,D=1/0,B=-1/0;for(;r.pos<o;){if(g<=0){const N=r.readVarint();p=7&N,g=N>>3}if(g--,p===1||p===2)v+=r.readSVarint(),x+=r.readSVarint(),v<E&&(E=v),v>R&&(R=v),x<D&&(D=x),x>B&&(B=x);else if(p!==7)throw new Error(`unknown command ${p}`)}return[E,D,R,B]}toGeoJSON(r,o,p){const g=this.extent*Math.pow(2,p),v=this.extent*r,x=this.extent*o,E=this.loadGeometry();function R(V){return[360*(V.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(V.y+x)/g)*Math.PI))-90]}function D(V){return V.map(R)}let B;if(this.type===1){const V=[];for(const W of E)V.push(W[0]);const $=D(V);B=V.length===1?{type:"Point",coordinates:$[0]}:{type:"MultiPoint",coordinates:$}}else if(this.type===2){const V=E.map(D);B=V.length===1?{type:"LineString",coordinates:V[0]}:{type:"MultiLineString",coordinates:V}}else{if(this.type!==3)throw new Error("unknown feature type");{const V=(function(W){const Z=W.length;if(Z<=1)return[W];const K=[];let it,yt;for(let lt=0;lt<Z;lt++){const ft=ev(W[lt]);ft!==0&&(yt===void 0&&(yt=ft<0),yt===ft<0?(it&&K.push(it),it=[W[lt]]):it&&it.push(W[lt]))}return it&&K.push(it),K})(E),$=[];for(const W of V)$.push(W.map(D));B=$.length===1?{type:"Polygon",coordinates:$[0]}:{type:"MultiPolygon",coordinates:$}}}const N={type:"Feature",geometry:B,properties:this.properties};return this.id!=null&&(N.id=this.id),N}}function tv(u,r,o){u===1?r.id=o.readVarint():u===2?(function(p,g){const v=p.readVarint()+p.pos;for(;p.pos<v;){const x=g._keys[p.readVarint()],E=g._values[p.readVarint()];g.properties[x]=E}})(o,r):u===3?r.type=o.readVarint():u===4&&(r._geometry=o.pos)}function ev(u){let r=0;for(let o,p,g=0,v=u.length,x=v-1;g<v;x=g++)o=u[g],p=u[x],r+=(p.x-o.x)*(o.y+p.y);return r}Bo.types=["Unknown","Point","LineString","Polygon"];class wf{constructor(r,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(iv,this,o),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const o=this._pbf.readVarint()+this._pbf.pos;return new Bo(this._pbf,o,this.extent,this._keys,this._values)}}function iv(u,r,o){u===15?r.version=o.readVarint():u===1?r.name=o.readString():u===5?r.extent=o.readVarint():u===2?r._features.push(o.pos):u===3?r._keys.push(o.readString()):u===4&&r._values.push((function(p){let g=null;const v=p.readVarint()+p.pos;for(;p.pos<v;){const x=p.readVarint()>>3;g=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}if(g==null)throw new Error("unknown feature value");return g})(o))}class Vd{constructor(r,o){this.layers=r.readFields(nv,{},o)}}function nv(u,r,o){if(u===3){const p=new wf(o,o.readVarint()+o.pos);p.length&&(r[p.name]=p)}}const g_=Math.pow(2,13);function jd(u,r,o,p,g,v,x,E){u.emplaceBack(r,o,2*Math.floor(p*g_)+x,g*g_*2,v*g_*2,Math.round(E))}class ji{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasDependencies=!1,this.layoutVertexArray=new Tt,this.centroidVertexArray=new ct,this.indexArray=new ve,this.programConfigurations=new gl(r.layers,r.zoom),this.segments=new Ve,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.features=[],this.hasDependencies=Bd("fill-extrusion",this.layers,o);for(const{feature:g,id:v,index:x,sourceLayerIndex:E}of r){const R=this.layers[0]._featureFilter.needGeometry,D=Po(g,R);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),D,p))continue;const B={id:v,sourceLayerIndex:E,index:x,geometry:R?D.geometry:Ro(g),properties:g.properties,type:g.type,patterns:{}};this.hasDependencies?this.features.push(ch("fill-extrusion",this.layers,B,{zoom:this.zoom},o)):this.addFeature(B,B.geometry,x,p,{},o.subdivisionGranularity),o.featureIndex.insert(g,B.geometry,x,E,this.index,!0)}}addFeatures(r,o,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,o,p,r.subdivisionGranularity)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ud),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,zd.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,o,p,g,v,x){for(const E of jc(o,500)){const R={x:0,y:0,sampleCount:0},D=this.layoutVertexArray.length;this.processPolygon(R,g,r,E,x);const B=this.layoutVertexArray.length-D,N=Math.floor(R.x/R.sampleCount),V=Math.floor(R.y/R.sampleCount);for(let $=0;$<B;$++)this.centroidVertexArray.emplaceBack(N,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{imagePositions:v,canonical:g})}processPolygon(r,o,p,g,v){if(g.length<1||ki(g[0]))return;for(const N of g)N.length!==0&&xn(r,N);const x={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},E=v.fill.getGranularityForZoomLevel(o.z),R=Bo.types[p.type]==="Polygon";for(const N of g){if(N.length===0||ki(N))continue;const V=br(N,E,R);this._generateSideFaces(V,x)}if(!R)return;const D=m_(g,o,E,!1),B=this.layoutVertexArray;xl(((N,V)=>{jd(B,N,V,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles)}_generateSideFaces(r,o){let p=0;for(let g=1;g<r.length;g++){const v=r[g],x=r[g-1];if(Di(v,x))continue;o.segment.vertexLength+4>Ve.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const E=v.sub(x)._perp()._unit(),R=x.dist(v);p+R>32768&&(p=0),jd(this.layoutVertexArray,v.x,v.y,E.x,E.y,0,0,p),jd(this.layoutVertexArray,v.x,v.y,E.x,E.y,0,1,p),p+=R,jd(this.layoutVertexArray,x.x,x.y,E.x,E.y,0,0,p),jd(this.layoutVertexArray,x.x,x.y,E.x,E.y,0,1,p);const D=o.segment.vertexLength;this.indexArray.emplaceBack(D,D+2,D+1),this.indexArray.emplaceBack(D+1,D+2,D+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function xn(u,r){for(let o=0;o<r.length;o++){const p=r[o];o===r.length-1&&r[0].x===p.x&&r[0].y===p.y||(u.x+=p.x,u.y+=p.y,u.sampleCount++)}}function Di(u,r){return u.x===r.x&&(u.x<0||u.x>Ue)||u.y===r.y&&(u.y<0||u.y>Ue)}function ki(u){return u.every((r=>r.x<0))||u.every((r=>r.x>Ue))||u.every((r=>r.y<0))||u.every((r=>r.y>Ue))}let an;Ie("FillExtrusionBucket",ji,{omit:["layers","features"]});var wa={get paint(){return an=an||new Ir({"fill-extrusion-opacity":new ze(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new je(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ze(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ze(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ul(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new je(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new je(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ze(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class su extends In{constructor(r,o){super(r,wa,o)}createBucket(r){return new ji(r)}queryRadius(){return Id(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:g,transform:v,pixelsToTileUnits:x,pixelPosMatrix:E}){const R=Dd(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-v.bearingInRadians,x),D=this.paint.get("fill-extrusion-height").evaluate(o,p),B=this.paint.get("fill-extrusion-base").evaluate(o,p),N=(function($,W){const Z=[];for(const K of $){const it=[K.x,K.y,0,1];Ne(it,it,W),Z.push(new w(it[0]/it[3],it[1]/it[3]))}return Z})(R,E),V=(function($,W,Z,K){const it=[],yt=[],lt=K[8]*W,ft=K[9]*W,At=K[10]*W,It=K[11]*W,Xt=K[8]*Z,pe=K[9]*Z,ue=K[10]*Z,_e=K[11]*Z;for(const Pe of $){const Ae=[],Ee=[];for(const se of Pe){const Ye=se.x,Xe=se.y,Ge=K[0]*Ye+K[4]*Xe+K[12],Fe=K[1]*Ye+K[5]*Xe+K[13],Ti=K[2]*Ye+K[6]*Xe+K[14],Yn=K[3]*Ye+K[7]*Xe+K[15],Fr=Ti+At,Ps=Yn+It,zo=Ge+Xt,Ea=Fe+pe,cs=Ti+ue,zn=Yn+_e,qr=new w((Ge+lt)/Ps,(Fe+ft)/Ps);qr.z=Fr/Ps,Ae.push(qr);const us=new w(zo/zn,Ea/zn);us.z=cs/zn,Ee.push(us)}it.push(Ae),yt.push(Ee)}return[it,yt]})(g,B,D,E);return(function($,W,Z){let K=1/0;s_(Z,W)&&(K=Cm(Z,W[0]));for(let it=0;it<W.length;it++){const yt=W[it],lt=$[it];for(let ft=0;ft<yt.length-1;ft++){const At=yt[ft],It=[At,yt[ft+1],lt[ft+1],lt[ft],At];r_(Z,It)&&(K=Math.min(K,Cm(Z,It)))}}return K!==1/0&&K})(V[0],V[1],N)}}function wl(u,r){return u.x*r.x+u.y*r.y}function Cm(u,r){if(u.length===1){let o=0;const p=r[o++];let g;for(;!g||p.equals(g);)if(g=r[o++],!g)return 1/0;for(;o<r.length;o++){const v=r[o],x=u[0],E=g.sub(p),R=v.sub(p),D=x.sub(p),B=wl(E,E),N=wl(E,R),V=wl(R,R),$=wl(D,E),W=wl(D,R),Z=B*V-N*N,K=(V*$-N*W)/Z,it=(B*W-N*$)/Z,yt=p.z*(1-K-it)+g.z*K+v.z*it;if(isFinite(yt))return yt}return 1/0}{let o=1/0;for(const p of r)o=Math.min(o,p.z);return o}}const fc=Wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ir}=fc,au=Wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:hh}=au,__=Math.cos(Math.PI/180*37.5),Gs=Math.pow(2,14)/.5;class ou{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((o=>{this.gradients[o.id]={}})),this.layoutVertexArray=new gt,this.layoutVertexArray2=new St,this.indexArray=new ve,this.programConfigurations=new gl(r.layers,r.zoom),this.segments=new Ve,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.hasDependencies=Bd("line",this.layers,o)||this.hasLineDasharray(this.layers);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),x=[];for(const{feature:E,id:R,index:D,sourceLayerIndex:B}of r){const N=this.layers[0]._featureFilter.needGeometry,V=Po(E,N);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),V,p))continue;const $=v?g.evaluate(V,{},p):void 0,W={id:R,properties:E.properties,type:E.type,sourceLayerIndex:B,index:D,geometry:N?V.geometry:Ro(E),patterns:{},dashes:{},sortKey:$};x.push(W)}v&&x.sort(((E,R)=>E.sortKey-R.sortKey));for(const E of x){const{geometry:R,index:D,sourceLayerIndex:B}=E;this.hasDependencies?(Bd("line",this.layers,o)?ch("line",this.layers,E,{zoom:this.zoom},o):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,E,this.zoom,o),this.patternFeatures.push(E)):this.addFeature(E,R,D,p,{},{},o.subdivisionGranularity),o.featureIndex.insert(r[D].feature,R,D,B,this.index)}}update(r,o,p,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,{imagePositions:p,dashPositions:g})}addFeatures(r,o,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,p,g,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,hh)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ir),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,o,p,g,v,x,E){const R=this.layers[0].layout,D=R.get("line-join").evaluate(r,{}),B=R.get("line-cap"),N=R.get("line-miter-limit"),V=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const $ of o)this.addLine($,r,D,B,N,V,g,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{imagePositions:v,dashPositions:x,canonical:g})}addLine(r,o,p,g,v,x,E,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=br(r,E?R.line.getGranularityForZoomLevel(E.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let lt=0;lt<r.length-1;lt++)this.totalDistance+=r[lt].dist(r[lt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=Bo.types[o.type]==="Polygon";let B=r.length;for(;B>=2&&r[B-1].equals(r[B-2]);)B--;let N=0;for(;N<B-1&&r[N].equals(r[N+1]);)N++;if(B<(D?3:2))return;p==="bevel"&&(v=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let W,Z,K,it,yt;this.e1=this.e2=-1,D&&(W=r[B-2],yt=r[N].sub(W)._unit()._perp());for(let lt=N;lt<B;lt++){if(K=lt===B-1?D?r[N+1]:void 0:r[lt+1],K&&r[lt].equals(K))continue;yt&&(it=yt),W&&(Z=W),W=r[lt],yt=K?K.sub(W)._unit()._perp():it,it=it||yt;let ft=it.add(yt);ft.x===0&&ft.y===0||ft._unit();const At=it.x*yt.x+it.y*yt.y,It=ft.x*yt.x+ft.y*yt.y,Xt=It!==0?1/It:1/0,pe=2*Math.sqrt(2-2*It),ue=It<__&&Z&&K,_e=it.x*yt.y-it.y*yt.x>0;if(ue&&lt>N){const Ee=W.dist(Z);if(Ee>2*V){const se=W.sub(W.sub(Z)._mult(V/Ee)._round());this.updateDistance(Z,se),this.addCurrentVertex(se,it,0,0,$),Z=se}}const Pe=Z&&K;let Ae=Pe?p:D?"butt":g;if(Pe&&Ae==="round"&&(Xt<x?Ae="miter":Xt<=2&&(Ae="fakeround")),Ae==="miter"&&Xt>v&&(Ae="bevel"),Ae==="bevel"&&(Xt>2&&(Ae="flipbevel"),Xt<v&&(Ae="miter")),Z&&this.updateDistance(Z,W),Ae==="miter")ft._mult(Xt),this.addCurrentVertex(W,ft,0,0,$);else if(Ae==="flipbevel"){if(Xt>100)ft=yt.mult(-1);else{const Ee=Xt*it.add(yt).mag()/it.sub(yt).mag();ft._perp()._mult(Ee*(_e?-1:1))}this.addCurrentVertex(W,ft,0,0,$),this.addCurrentVertex(W,ft.mult(-1),0,0,$)}else if(Ae==="bevel"||Ae==="fakeround"){const Ee=-Math.sqrt(Xt*Xt-1),se=_e?Ee:0,Ye=_e?0:Ee;if(Z&&this.addCurrentVertex(W,it,se,Ye,$),Ae==="fakeround"){const Xe=Math.round(180*pe/Math.PI/20);for(let Ge=1;Ge<Xe;Ge++){let Fe=Ge/Xe;if(Fe!==.5){const Yn=Fe-.5;Fe+=Fe*Yn*(Fe-1)*((1.0904+At*(At*(3.55645-1.43519*At)-3.2452))*Yn*Yn+(.848013+At*(.215638*At-1.06021)))}const Ti=yt.sub(it)._mult(Fe)._add(it)._unit()._mult(_e?-1:1);this.addHalfVertex(W,Ti.x,Ti.y,!1,_e,0,$)}}K&&this.addCurrentVertex(W,yt,-se,-Ye,$)}else if(Ae==="butt")this.addCurrentVertex(W,ft,0,0,$);else if(Ae==="square"){const Ee=Z?1:-1;this.addCurrentVertex(W,ft,Ee,Ee,$)}else Ae==="round"&&(Z&&(this.addCurrentVertex(W,it,0,0,$),this.addCurrentVertex(W,it,1,1,$,!0)),K&&(this.addCurrentVertex(W,yt,-1,-1,$,!0),this.addCurrentVertex(W,yt,0,0,$)));if(ue&&lt<B-1){const Ee=W.dist(K);if(Ee>2*V){const se=W.add(K.sub(W)._mult(V/Ee)._round());this.updateDistance(W,se),this.addCurrentVertex(se,yt,0,0,$),W=se}}}}addCurrentVertex(r,o,p,g,v,x=!1){const E=o.y*g-o.x,R=-o.y-o.x*g;this.addHalfVertex(r,o.x+o.y*p,o.y-o.x*p,x,!1,p,v),this.addHalfVertex(r,E,R,x,!0,-g,v),this.distance>Gs/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,o,p,g,v,x))}addHalfVertex({x:r,y:o},p,g,v,x,E,R){const D=.5*(this.lineClips?this.scaledDistance*(Gs-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(v?1:0),(o<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const B=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,B,this.e2),R.primitiveLength++),x?this.e2=B:this.e1=B}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,o){this.distance+=r.dist(o),this.updateScaledDistance()}hasLineDasharray(r){for(const o of r){const p=o.paint.get("line-dasharray");if(p&&!p.isConstant())return!0}return!1}addLineDashDependencies(r,o,p,g){for(const v of r){const x=v.paint.get("line-dasharray");if(!x||x.value.kind==="constant")continue;const E=v.layout.get("line-cap")==="round",R={dasharray:x.value.evaluate({zoom:p-1},o,{}),round:E},D={dasharray:x.value.evaluate({zoom:p},o,{}),round:E},B={dasharray:x.value.evaluate({zoom:p+1},o,{}),round:E},N=`${R.dasharray.join(",")},${R.round}`,V=`${D.dasharray.join(",")},${D.round}`,$=`${B.dasharray.join(",")},${B.round}`;g.dashDependencies[N]=R,g.dashDependencies[V]=D,g.dashDependencies[$]=B,o.dashes[v.id]={min:N,mid:V,max:$}}}}let Tf,zs;Ie("LineBucket",ou,{omit:["layers","patternFeatures"]});var Mm={get paint(){return zs=zs||new Ir({"line-opacity":new je(ut.paint_line["line-opacity"]),"line-color":new je(ut.paint_line["line-color"]),"line-translate":new ze(ut.paint_line["line-translate"]),"line-translate-anchor":new ze(ut.paint_line["line-translate-anchor"]),"line-width":new je(ut.paint_line["line-width"]),"line-gap-width":new je(ut.paint_line["line-gap-width"]),"line-offset":new je(ut.paint_line["line-offset"]),"line-blur":new je(ut.paint_line["line-blur"]),"line-dasharray":new ul(ut.paint_line["line-dasharray"]),"line-pattern":new ul(ut.paint_line["line-pattern"]),"line-gradient":new tu(ut.paint_line["line-gradient"])})},get layout(){return Tf=Tf||new Ir({"line-cap":new ze(ut.layout_line["line-cap"]),"line-join":new je(ut.layout_line["line-join"]),"line-miter-limit":new ze(ut.layout_line["line-miter-limit"]),"line-round-limit":new ze(ut.layout_line["line-round-limit"]),"line-sort-key":new je(ut.layout_line["line-sort-key"])})}};class Rm extends je{possiblyEvaluate(r,o){return o=new Hi(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(r,o)}evaluate(r,o,p,g){return o=zi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(r,o,p,g)}}let $d;class Pm extends In{constructor(r,o){super(r,Mm,o),this.gradientVersion=0,$d||($d=new Rm(Mm.paint.properties["line-width"].specification),$d.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(o)&&o._styleExpression.expression instanceof Ko,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,o){super.recalculate(r,o),this.paint._values["line-floorwidth"]=$d.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new ou(r)}queryRadius(r){const o=r,p=Hd(oh("line-width",this,o),oh("line-gap-width",this,o)),g=oh("line-offset",this,o);return p/2+Math.abs(g)+Id(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:g,transform:v,pixelsToTileUnits:x}){const E=Dd(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-v.bearingInRadians,x),R=x/2*Hd(this.paint.get("line-width").evaluate(o,p),this.paint.get("line-gap-width").evaluate(o,p)),D=this.paint.get("line-offset").evaluate(o,p);return D&&(g=(function(B,N){const V=[];for(let $=0;$<B.length;$++){const W=B[$],Z=[];for(let K=0;K<W.length;K++){const it=W[K-1],yt=W[K],lt=W[K+1],ft=K===0?new w(0,0):yt.sub(it)._unit()._perp(),At=K===W.length-1?new w(0,0):lt.sub(yt)._unit()._perp(),It=ft._add(At)._unit(),Xt=It.x*At.x+It.y*At.y;Xt!==0&&It._mult(1/Xt),Z.push(It._mult(N)._add(yt))}V.push(Z)}return V})(g,D*x)),(function(B,N,V){for(let $=0;$<N.length;$++){const W=N[$];if(B.length>=3){for(let Z=0;Z<W.length;Z++)if(er(B,W[Z]))return!0}if(a_(B,W,V))return!0}return!1})(E,g,R)}isTileClipped(){return!0}}function Hd(u,r){return r>0?r+2*u:u}const lu=Wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Br=Wi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cu=Wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fh=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dc=Wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function y_(u,r,o){return u.sections.forEach((p=>{p.text=(function(g,v,x){const E=v.layout.get("text-transform").evaluate(x,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),jr.applyArabicShaping&&(g=jr.applyArabicShaping(g)),g})(p.text,r,o)})),u}Wi([{name:"triangle",components:3,type:"Uint16"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wi([{type:"Float32",name:"offsetX"}]),Wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const dh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var fr=24;const ph=4294967296,Im=1/ph,Ys=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Dm{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,o,p=this.length){for(;this.pos<p;){const g=this.readVarint(),v=g>>3,x=this.pos;this.type=7&g,r(v,o,this),this.pos===x&&this.skip(g)}return o}readMessage(r,o){return this.readFields(r,o,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*ph;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*ph;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const o=this.buf;let p,g;return g=o[this.pos++],p=127&g,g<128?p:(g=o[this.pos++],p|=(127&g)<<7,g<128?p:(g=o[this.pos++],p|=(127&g)<<14,g<128?p:(g=o[this.pos++],p|=(127&g)<<21,g<128?p:(g=o[this.pos],p|=(15&g)<<28,(function(v,x,E){const R=E.buf;let D,B;if(B=R[E.pos++],D=(112&B)>>4,B<128||(B=R[E.pos++],D|=(127&B)<<3,B<128)||(B=R[E.pos++],D|=(127&B)<<10,B<128)||(B=R[E.pos++],D|=(127&B)<<17,B<128)||(B=R[E.pos++],D|=(127&B)<<24,B<128)||(B=R[E.pos++],D|=(1&B)<<31,B<128))return Lr(v,D,x);throw new Error("Expected varint not more than 10 bytes")})(p,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,o=this.pos;return this.pos=r,r-o>=12&&Ys?Ys.decode(this.buf.subarray(o,r)):(function(p,g,v){let x="",E=g;for(;E<v;){const R=p[E];let D,B,N,V=null,$=R>239?4:R>223?3:R>191?2:1;if(E+$>v)break;$===1?R<128&&(V=R):$===2?(D=p[E+1],(192&D)==128&&(V=(31&R)<<6|63&D,V<=127&&(V=null))):$===3?(D=p[E+1],B=p[E+2],(192&D)==128&&(192&B)==128&&(V=(15&R)<<12|(63&D)<<6|63&B,(V<=2047||V>=55296&&V<=57343)&&(V=null))):$===4&&(D=p[E+1],B=p[E+2],N=p[E+3],(192&D)==128&&(192&B)==128&&(192&N)==128&&(V=(15&R)<<18|(63&D)<<12|(63&B)<<6|63&N,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,$=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),E+=$}return x})(this.buf,o,r)}readBytes(){const r=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,r);return this.pos=r,o}readPackedVarint(r=[],o){const p=this.readPackedEnd();for(;this.pos<p;)r.push(this.readVarint(o));return r}readPackedSVarint(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const o=7&r;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(r,o){this.writeVarint(r<<3|o)}realloc(r){let o=this.length||16;for(;o<this.pos+r;)o*=2;if(o!==this.length){const p=new Uint8Array(o);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Im),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Im),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(o,p){let g,v;if(o>=0?(g=o%4294967296|0,v=o/4294967296|0):(g=~(-o%4294967296),v=~(-o/4294967296),4294967295^g?g=g+1|0:(g=0,v=v+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(x,E,R){R.buf[R.pos++]=127&x|128,x>>>=7,R.buf[R.pos++]=127&x|128,x>>>=7,R.buf[R.pos++]=127&x|128,x>>>=7,R.buf[R.pos++]=127&x|128,R.buf[R.pos]=127&(x>>>=7)})(g,0,p),(function(x,E){const R=(7&x)<<4;E.buf[E.pos++]|=R|((x>>>=3)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x)))))})(v,p)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const o=this.pos;this.pos=(function(g,v,x){for(let E,R,D=0;D<v.length;D++){if(E=v.charCodeAt(D),E>55295&&E<57344){if(!R){E>56319||D+1===v.length?(g[x++]=239,g[x++]=191,g[x++]=189):R=E;continue}if(E<56320){g[x++]=239,g[x++]=191,g[x++]=189,R=E;continue}E=R-55296<<10|E-56320|65536,R=null}else R&&(g[x++]=239,g[x++]=191,g[x++]=189,R=null);E<128?g[x++]=E:(E<2048?g[x++]=E>>6|192:(E<65536?g[x++]=E>>12|224:(g[x++]=E>>18|240,g[x++]=E>>12&63|128),g[x++]=E>>6&63|128),g[x++]=63&E|128)}return x})(this.buf,r,this.pos);const p=this.pos-o;p>=128&&v_(o,p,this),this.pos=o-1,this.writeVarint(p),this.pos+=p}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const o=r.length;this.writeVarint(o),this.realloc(o);for(let p=0;p<o;p++)this.buf[this.pos++]=r[p]}writeRawMessage(r,o){this.pos++;const p=this.pos;r(o,this);const g=this.pos-p;g>=128&&v_(p,g,this),this.pos=p-1,this.writeVarint(g),this.pos+=g}writeMessage(r,o,p){this.writeTag(r,2),this.writeRawMessage(o,p)}writePackedVarint(r,o){o.length&&this.writeMessage(r,rv,o)}writePackedSVarint(r,o){o.length&&this.writeMessage(r,a0,o)}writePackedBoolean(r,o){o.length&&this.writeMessage(r,b_,o)}writePackedFloat(r,o){o.length&&this.writeMessage(r,uu,o)}writePackedDouble(r,o){o.length&&this.writeMessage(r,km,o)}writePackedFixed32(r,o){o.length&&this.writeMessage(r,Sf,o)}writePackedSFixed32(r,o){o.length&&this.writeMessage(r,sv,o)}writePackedFixed64(r,o){o.length&&this.writeMessage(r,av,o)}writePackedSFixed64(r,o){o.length&&this.writeMessage(r,ov,o)}writeBytesField(r,o){this.writeTag(r,2),this.writeBytes(o)}writeFixed32Field(r,o){this.writeTag(r,5),this.writeFixed32(o)}writeSFixed32Field(r,o){this.writeTag(r,5),this.writeSFixed32(o)}writeFixed64Field(r,o){this.writeTag(r,1),this.writeFixed64(o)}writeSFixed64Field(r,o){this.writeTag(r,1),this.writeSFixed64(o)}writeVarintField(r,o){this.writeTag(r,0),this.writeVarint(o)}writeSVarintField(r,o){this.writeTag(r,0),this.writeSVarint(o)}writeStringField(r,o){this.writeTag(r,2),this.writeString(o)}writeFloatField(r,o){this.writeTag(r,5),this.writeFloat(o)}writeDoubleField(r,o){this.writeTag(r,1),this.writeDouble(o)}writeBooleanField(r,o){this.writeVarintField(r,+o)}}function Lr(u,r,o){return o?4294967296*r+(u>>>0):4294967296*(r>>>0)+(u>>>0)}function v_(u,r,o){const p=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));o.realloc(p);for(let g=o.pos-1;g>=u;g--)o.buf[g+p]=o.buf[g]}function rv(u,r){for(let o=0;o<u.length;o++)r.writeVarint(u[o])}function a0(u,r){for(let o=0;o<u.length;o++)r.writeSVarint(u[o])}function uu(u,r){for(let o=0;o<u.length;o++)r.writeFloat(u[o])}function km(u,r){for(let o=0;o<u.length;o++)r.writeDouble(u[o])}function b_(u,r){for(let o=0;o<u.length;o++)r.writeBoolean(u[o])}function Sf(u,r){for(let o=0;o<u.length;o++)r.writeFixed32(u[o])}function sv(u,r){for(let o=0;o<u.length;o++)r.writeSFixed32(u[o])}function av(u,r){for(let o=0;o<u.length;o++)r.writeFixed64(u[o])}function ov(u,r){for(let o=0;o<u.length;o++)r.writeSFixed64(u[o])}function lv(u,r,o){u===1&&o.readMessage(Om,r)}function Om(u,r,o){if(u===3){const{id:p,bitmap:g,width:v,height:x,left:E,top:R,advance:D}=o.readMessage(x_,{});r.push({id:p,bitmap:new lh({width:v+6,height:x+6},g),metrics:{width:v,height:x,left:E,top:R,advance:D}})}}function x_(u,r,o){u===1?r.id=o.readVarint():u===2?r.bitmap=o.readBytes():u===3?r.width=o.readVarint():u===4?r.height=o.readVarint():u===5?r.left=o.readSVarint():u===6?r.top=o.readSVarint():u===7&&(r.advance=o.readVarint())}function cv(u){let r=0,o=0;for(const x of u)r+=x.w*x.h,o=Math.max(o,x.w);u.sort(((x,E)=>E.h-x.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let g=0,v=0;for(const x of u)for(let E=p.length-1;E>=0;E--){const R=p[E];if(!(x.w>R.w||x.h>R.h)){if(x.x=R.x,x.y=R.y,v=Math.max(v,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===R.w&&x.h===R.h){const D=p.pop();D&&E<p.length&&(p[E]=D)}else x.h===R.h?(R.x+=x.w,R.w-=x.w):x.w===R.w?(R.y+=x.h,R.h-=x.h):(p.push({x:R.x+x.w,y:R.y,w:R.w-x.w,h:x.h}),R.y+=x.h,R.h-=x.h);break}}return{w:g,h:v,fill:r/(g*v)||0}}class w_{constructor(r,{pixelRatio:o,version:p,stretchX:g,stretchY:v,content:x,textFitWidth:E,textFitHeight:R}){this.paddedRect=r,this.pixelRatio=o,this.stretchX=g,this.stretchY=v,this.content=x,this.version=p,this.textFitWidth=E,this.textFitHeight=R}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class uv{constructor(r,o){const p={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(r,p,v),this.addImages(o,g,v);const{w:x,h:E}=cv(v),R=new Ms({width:x||1,height:E||1});for(const D in r){const B=r[D],N=p[D].paddedRect;Ms.copy(B.data,R,{x:0,y:0},{x:N.x+1,y:N.y+1},B.data)}for(const D in o){const B=o[D],N=g[D].paddedRect,V=N.x+1,$=N.y+1,W=B.data.width,Z=B.data.height;Ms.copy(B.data,R,{x:0,y:0},{x:V,y:$},B.data),Ms.copy(B.data,R,{x:0,y:Z-1},{x:V,y:$-1},{width:W,height:1}),Ms.copy(B.data,R,{x:0,y:0},{x:V,y:$+Z},{width:W,height:1}),Ms.copy(B.data,R,{x:W-1,y:0},{x:V-1,y:$},{width:1,height:Z}),Ms.copy(B.data,R,{x:0,y:0},{x:V+W,y:$},{width:1,height:Z})}this.image=R,this.iconPositions=p,this.patternPositions=g}addImages(r,o,p){for(const g in r){const v=r[g],x={x:0,y:0,w:v.data.width+2,h:v.data.height+2};p.push(x),o[g]=new w_(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,o){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in r.updatedImages)this.patchUpdatedImage(this.iconPositions[p],r.getImage(p),o),this.patchUpdatedImage(this.patternPositions[p],r.getImage(p),o)}patchUpdatedImage(r,o,p){if(!r||!o||r.version===o.version)return;r.version=o.version;const[g,v]=r.tl;p.update(o.data,void 0,{x:g,y:v})}}var pc;Ie("ImagePosition",w_),Ie("ImageAtlas",uv),m.at=void 0,(pc=m.at||(m.at={}))[pc.none=0]="none",pc[pc.horizontal=1]="horizontal",pc[pc.vertical=2]="vertical",pc[pc.horizontalOnly=3]="horizontalOnly";class Af{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(r,o,p){const g=new Af;return g.scale=r||1,g.fontStack=o,g.verticalAlign=p||"bottom",g}static forImage(r,o){const p=new Af;return p.imageName=r,p.verticalAlign=o||"bottom",p}}class Lo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o){const p=new Lo;for(let g=0;g<r.sections.length;g++){const v=r.sections[g];v.image?p.addImageSection(v):p.addTextSection(v,o)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=(function(r){let o="";for(let p=0;p<r.length;p++){const g=r.charCodeAt(p+1)||null,v=r.charCodeAt(p-1)||null;o+=g&&sc(g)&&!dh[r[p+1]]||v&&sc(v)&&!dh[r[p-1]]||!dh[r[p]]?r[p]:dh[r[p]]}return o})(this.text)}trim(){let r=0;for(let p=0;p<this.text.length&&Wd[this.text.charCodeAt(p)];p++)r++;let o=this.text.length;for(let p=this.text.length-1;p>=0&&p>=r&&Wd[this.text.charCodeAt(p)];p--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const p=new Lo;return p.text=this.text.substring(r,o),p.sectionIndex=this.sectionIndex.slice(r,o),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,o)=>Math.max(r,this.sections[o].scale)),0)}getMaxImageSize(r){let o=0,p=0;for(let g=0;g<this.length();g++){const v=this.getSection(g);if(v.imageName){const x=r[v.imageName];if(!x)continue;const E=x.displaySize;o=Math.max(o,E[0]),p=Math.max(p,E[1])}}return{maxImageWidth:o,maxImageHeight:p}}addTextSection(r,o){this.text+=r.text,this.sections.push(Af.forText(r.scale,r.fontStack||o,r.verticalAlign));const p=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(p)}addImageSection(r){const o=r.image?r.image.name:"";if(o.length===0)return void $i("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Af.forImage(o,r.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):$i("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function mh(u,r,o,p,g,v,x,E,R,D,B,N,V,$,W){const Z=Lo.fromFeature(u,g);let K;N===m.at.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:it,processStyledBidirectionalText:yt}=jr;if(it&&Z.sections.length===1){K=[];const At=it(Z.toString(),Bm(Z,D,v,r,p,$));for(const It of At){const Xt=new Lo;Xt.text=It,Xt.sections=Z.sections;for(let pe=0;pe<It.length;pe++)Xt.sectionIndex.push(0);K.push(Xt)}}else if(yt){K=[];const At=yt(Z.text,Z.sectionIndex,Bm(Z,D,v,r,p,$));for(const It of At){const Xt=new Lo;Xt.text=It[0],Xt.sectionIndex=It[1],Xt.sections=Z.sections,K.push(Xt)}}else K=(function(At,It){const Xt=[],pe=At.text;let ue=0;for(const _e of It)Xt.push(At.substring(ue,_e)),ue=_e;return ue<pe.length&&Xt.push(At.substring(ue,pe.length)),Xt})(Z,Bm(Z,D,v,r,p,$));const lt=[],ft={positionedLines:lt,text:Z.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:N,iconsInText:!1,verticalizable:!1};return(function(At,It,Xt,pe,ue,_e,Pe,Ae,Ee,se,Ye,Xe){let Ge=0,Fe=0,Ti=0,Yn=0;const Fr=Ae==="right"?1:Ae==="left"?0:.5,Ps=fr/Xe;let zo=0;for(const zn of ue){zn.trim();const qr=zn.getMaxScale(),us={positionedGlyphs:[],lineOffset:0};At.positionedLines[zo]=us;const hs=us.positionedGlyphs;let Qs=0;if(!zn.length()){Fe+=_e,++zo;continue}const Uo=E_(pe,zn,Ps);for(let Ca=0;Ca<zn.length();Ca++){const Nr=zn.getSection(Ca),Zr=zn.getSectionIndex(Ca),Gr=zn.getCharCode(Ca),xr=mv(Ee,Ye,Gr);let An;if(Nr.imageName){if(At.iconsInText=!0,Nr.scale=Nr.scale*Ps,An=l0(Nr,xr,qr,Uo,pe),!An)continue;Qs=Math.max(Qs,An.imageOffset)}else if(An=o0(Nr,Gr,xr,Uo,It,Xt),!An)continue;const{rect:Tc,metrics:lg,baselineOffset:Sc}=An;hs.push({glyph:Gr,imageName:Nr.imageName,x:Ge,y:Fe+Sc+-17,vertical:xr,scale:Nr.scale,fontStack:Nr.fontStack,sectionIndex:Zr,metrics:lg,rect:Tc}),xr?(At.verticalizable=!0,Ge+=(Nr.imageName?lg.advance:fr)*Nr.scale+se):Ge+=lg.advance*Nr.scale+se}hs.length!==0&&(Ti=Math.max(Ge-se,Ti),c0(hs,0,hs.length-1,Fr)),Ge=0,us.lineOffset=Math.max(Qs,(qr-1)*fr);const Xr=_e*qr+Qs;Fe+=Xr,Yn=Math.max(Xr,Yn),++zo}const{horizontalAlign:Ea,verticalAlign:cs}=Ki(Pe);(function(zn,qr,us,hs,Qs,Uo,Xr,Ca,Nr){const Zr=(qr-us)*Qs;let Gr=0;Gr=Uo!==Xr?-Ca*hs- -17:-hs*Nr*Xr+.5*Xr;for(const xr of zn)for(const An of xr.positionedGlyphs)An.x+=Zr,An.y+=Gr})(At.positionedLines,Fr,Ea,cs,Ti,Yn,_e,Fe,ue.length),At.top+=-cs*Fe,At.bottom=At.top+Fe,At.left+=-Ea*Ti,At.right=At.left+Ti})(ft,r,o,p,K,x,E,R,N,D,V,W),!(function(At){for(const It of At)if(It.positionedGlyphs.length!==0)return!1;return!0})(lt)&&ft}const Wd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},fv={40:!0};function T_(u,r,o,p,g,v){if(r.imageName){const x=p[r.imageName];return x?x.displaySize[0]*r.scale*fr/v+g:0}{const x=o[r.fontStack],E=x&&x[u];return E?E.metrics.advance*r.scale+g:0}}function S_(u,r,o,p){const g=Math.pow(u-r,2);return p?u<r?g/2:2*g:g+Math.abs(o)*o}function dv(u,r,o){let p=0;return u===10&&(p-=1e4),o&&(p+=150),u!==40&&u!==65288||(p+=50),r!==41&&r!==65289||(p+=50),p}function qd(u,r,o,p,g,v){let x=null,E=S_(r,o,g,v);for(const R of p){const D=S_(r-R.x,o,g,v)+R.badness;D<=E&&(x=R,E=D)}return{index:u,x:r,priorBreak:x,badness:E}}function A_(u){return u?A_(u.priorBreak).concat(u.index):[]}function Bm(u,r,o,p,g,v){if(!u)return[];const x=[],E=(function(B,N,V,$,W,Z){let K=0;for(let it=0;it<B.length();it++){const yt=B.getSection(it);K+=T_(B.getCharCode(it),yt,$,W,N,Z)}return K/Math.max(1,Math.ceil(K/V))})(u,r,o,p,g,v),R=u.text.indexOf("")>=0;let D=0;for(let B=0;B<u.length();B++){const N=u.getSection(B),V=u.getCharCode(B);if(Wd[V]||(D+=T_(V,N,p,g,r,v)),B<u.length()-1){const $=rc(V);(hv[V]||$||N.imageName||B!==u.length()-2&&fv[u.getCharCode(B+1)])&&x.push(qd(B+1,D,E,x,dv(V,u.getCharCode(B+1),$&&R),!1))}}return A_(qd(u.length(),D,E,x,0,!0))}function Ki(u){let r=.5,o=.5;switch(u){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function E_(u,r,o){const p=r.getMaxScale()*fr,{maxImageWidth:g,maxImageHeight:v}=r.getMaxImageSize(u),x=Math.max(p,v*o);return{verticalLineContentWidth:Math.max(p,g*o),horizontalLineContentHeight:x}}function pv(u){switch(u){case"top":return 0;case"center":return .5;default:return 1}}function mv(u,r,o){return!(u===m.at.horizontal||!r&&!Zs(o)||r&&(Wd[o]||(p=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function o0(u,r,o,p,g,v){const x=v[u.fontStack],E=(function(D,B,N,V){if(D&&D.rect)return D;const $=B[N.fontStack],W=$&&$[V];return W?{rect:null,metrics:W.metrics}:null})(x&&x[r],g,u,r);if(E===null)return null;let R;if(o)R=p.verticalLineContentWidth-u.scale*fr;else{const D=pv(u.verticalAlign);R=(p.horizontalLineContentHeight-u.scale*fr)*D}return{rect:E.rect,metrics:E.metrics,baselineOffset:R}}function l0(u,r,o,p,g){const v=g[u.imageName];if(!v)return null;const x=v.paddedRect,E=v.displaySize,R={width:E[0],height:E[1],left:1,top:-3,advance:r?E[1]:E[0]};let D;if(r)D=p.verticalLineContentWidth-E[1]*u.scale;else{const B=pv(u.verticalAlign);D=(p.horizontalLineContentHeight-E[1]*u.scale)*B}return{rect:x,metrics:R,baselineOffset:D,imageOffset:(r?E[0]:E[1])*u.scale-fr*o}}function c0(u,r,o,p){if(p===0)return;const g=u[o],v=(u[o].x+g.metrics.advance*g.scale)*p;for(let x=r;x<=o;x++)u[x].x-=v}function Lm(u,r,o){const{horizontalAlign:p,verticalAlign:g}=Ki(o),v=r[0]-u.displaySize[0]*p,x=r[1]-u.displaySize[1]*g;return{image:u,top:x,bottom:x+u.displaySize[1],left:v,right:v+u.displaySize[0]}}function gh(u){var r,o;let p=u.left,g=u.top,v=u.right-p,x=u.bottom-g;const E=(r=u.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",R=(o=u.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",D=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(R==="proportional"){if(E==="stretchOnly"&&v/x<D||E==="proportional"){const B=Math.ceil(x*D);p*=B/v,v=B}}else if(E==="proportional"&&R==="stretchOnly"&&D!==0&&v/x>D){const B=Math.ceil(v/D);g*=B/x,x=B}return{x1:p,y1:g,x2:p+v,y2:g+x}}function Fm(u,r,o,p,g,v){const x=u.image;let E;if(x.content){const K=x.content,it=x.pixelRatio||1;E=[K[0]/it,K[1]/it,x.displaySize[0]-K[2]/it,x.displaySize[1]-K[3]/it]}const R=r.left*v,D=r.right*v;let B,N,V,$;o==="width"||o==="both"?($=g[0]+R-p[3],N=g[0]+D+p[1]):($=g[0]+(R+D-x.displaySize[0])/2,N=$+x.displaySize[0]);const W=r.top*v,Z=r.bottom*v;return o==="height"||o==="both"?(B=g[1]+W-p[0],V=g[1]+Z+p[2]):(B=g[1]+(W+Z-x.displaySize[1])/2,V=B+x.displaySize[1]),{image:x,top:B,right:N,bottom:V,left:$,collisionPadding:E}}const io=128,Tl=32640;function mc(u,r){const{expression:o}=r;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Hi(u+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:g}=o;let v=0;for(;v<p.length&&p[v]<=u;)v++;v=Math.max(0,v-1);let x=v;for(;x<p.length&&p[x]<u+1;)x++;x=Math.min(p.length-1,x);const E=p[v],R=p[x];return o.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:R,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:R,minSize:o.evaluate(new Hi(E)),maxSize:o.evaluate(new Hi(R)),interpolationType:g}}}function no(u,r,o){let p="never";const g=u.get(r);return g?p=g:u.get(o)&&(p="always"),p}const Xd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nm(u,r,o,p,g,v,x,E,R,D,B,N,V){const $=E?Math.min(Tl,Math.round(E[0])):0,W=E?Math.min(Tl,Math.round(E[1])):0;u.emplaceBack(r,o,Math.round(32*p),Math.round(32*g),v,x,($<<1)+(R?1:0),W,16*D,16*B,256*N,256*V)}function zm(u,r,o){u.emplaceBack(r.x,r.y,o),u.emplaceBack(r.x,r.y,o),u.emplaceBack(r.x,r.y,o),u.emplaceBack(r.x,r.y,o)}function gv(u){for(const r of u.sections)if(cm(r.text))return!0;return!1}class Um{constructor(r){this.layoutVertexArray=new Bt,this.indexArray=new ve,this.programConfigurations=r,this.segments=new Ve,this.dynamicLayoutVertexArray=new Gt,this.opacityVertexArray=new Ht,this.hasVisibleVertices=!1,this.placedSymbolArray=new k}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,o,p,g){this.isEmpty()||(p&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,lu.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Br.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Xd,!0),this.opacityVertexBuffer.itemSize=1),(p||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ie("SymbolBuffers",Um);class Vm{constructor(r,o,p){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new p,this.segments=new Ve,this.collisionVertexArray=new Yt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,cu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ie("CollisionBuffers",Vm);class Ef{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((x=>x.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mc(this.zoom,o["text-size"]),this.iconSizeData=mc(this.zoom,o["icon-size"]);const p=this.layers[0].layout,g=p.get("symbol-sort-key"),v=p.get("symbol-z-order");this.canOverlap=no(p,"text-overlap","text-allow-overlap")!=="never"||no(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((x=>m.at[x]))),this.stateDependentLayerIds=this.layers.filter((x=>x.isStateDependent())).map((x=>x.id)),this.sourceID=r.sourceID}createArrays(){this.text=new Um(new gl(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new Um(new gl(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new U,this.lineVertexArray=new q,this.symbolInstances=new z,this.textAnchorOffsets=new Y}calculateGlyphDependencies(r,o,p,g,v){for(let x=0;x<r.length;x++)if(o[r.charCodeAt(x)]=!0,(p||g)&&v){const E=dh[r.charAt(x)];E&&(o[E.charCodeAt(0)]=!0)}}populate(r,o,p){const g=this.layers[0],v=g.layout,x=v.get("text-font"),E=v.get("text-field"),R=v.get("icon-image"),D=(E.value.kind!=="constant"||E.value.value instanceof Bn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),B=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,N=v.get("symbol-sort-key");if(this.features=[],!D&&!B)return;const V=o.iconDependencies,$=o.glyphDependencies,W=o.availableImages,Z=new Hi(this.zoom);for(const{feature:K,id:it,index:yt,sourceLayerIndex:lt}of r){const ft=g._featureFilter.needGeometry,At=Po(K,ft);if(!g._featureFilter.filter(Z,At,p))continue;let It,Xt;if(ft||(At.geometry=Ro(K)),D){const ue=g.getValueAndResolveTokens("text-field",At,p,W),_e=Bn.factory(ue),Pe=this.hasRTLText=this.hasRTLText||gv(_e);(!Pe||jr.getRTLTextPluginStatus()==="unavailable"||Pe&&jr.isParsed())&&(It=y_(_e,g,At))}if(B){const ue=g.getValueAndResolveTokens("icon-image",At,p,W);Xt=ue instanceof Ln?ue:Ln.fromString(ue)}if(!It&&!Xt)continue;const pe=this.sortFeaturesByKey?N.evaluate(At,{},p):void 0;if(this.features.push({id:it,text:It,icon:Xt,index:yt,sourceLayerIndex:lt,geometry:At.geometry,properties:K.properties,type:Bo.types[K.type],sortKey:pe}),Xt&&(V[Xt.name]=!0),It){const ue=x.evaluate(At,{},p).join(","),_e=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.at.vertical)>=0;for(const Pe of It.sections)if(Pe.image)V[Pe.image.name]=!0;else{const Ae=cf(It.toString()),Ee=Pe.fontStack||ue,se=$[Ee]=$[Ee]||{};this.calculateGlyphDependencies(Pe.text,se,_e,this.allowVerticalPlacement,Ae)}}}v.get("symbol-placement")==="line"&&(this.features=(function(K){const it={},yt={},lt=[];let ft=0;function At(ue){lt.push(K[ue]),ft++}function It(ue,_e,Pe){const Ae=yt[ue];return delete yt[ue],yt[_e]=Ae,lt[Ae].geometry[0].pop(),lt[Ae].geometry[0]=lt[Ae].geometry[0].concat(Pe[0]),Ae}function Xt(ue,_e,Pe){const Ae=it[_e];return delete it[_e],it[ue]=Ae,lt[Ae].geometry[0].shift(),lt[Ae].geometry[0]=Pe[0].concat(lt[Ae].geometry[0]),Ae}function pe(ue,_e,Pe){const Ae=Pe?_e[0][_e[0].length-1]:_e[0][0];return`${ue}:${Ae.x}:${Ae.y}`}for(let ue=0;ue<K.length;ue++){const _e=K[ue],Pe=_e.geometry,Ae=_e.text?_e.text.toString():null;if(!Ae){At(ue);continue}const Ee=pe(Ae,Pe),se=pe(Ae,Pe,!0);if(Ee in yt&&se in it&&yt[Ee]!==it[se]){const Ye=Xt(Ee,se,Pe),Xe=It(Ee,se,lt[Ye].geometry);delete it[Ee],delete yt[se],yt[pe(Ae,lt[Xe].geometry,!0)]=Xe,lt[Ye].geometry=null}else Ee in yt?It(Ee,se,Pe):se in it?Xt(Ee,se,Pe):(At(ue),it[Ee]=ft-1,yt[se]=ft-1)}return lt.filter((ue=>ue.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((K,it)=>K.sortKey-it.sortKey))}update(r,o,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,o,this.layers,{imagePositions:p}),this.icon.programConfigurations.updatePaintArrays(r,o,this.layers,{imagePositions:p}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const p=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(o[r.segment+1]),v=r.dist(o[r.segment]);const x={};for(let E=r.segment+1;E<o.length;E++)x[E]={x:o[E].x,y:o[E].y,tileUnitDistanceFromAnchor:g},E<o.length-1&&(g+=o[E+1].dist(o[E]));for(let E=r.segment||0;E>=0;E--)x[E]={x:o[E].x,y:o[E].y,tileUnitDistanceFromAnchor:v},E>0&&(v+=o[E-1].dist(o[E]));for(let E=0;E<o.length;E++){const R=x[E];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(r,o,p,g,v,x,E,R,D,B,N,V){const $=r.indexArray,W=r.layoutVertexArray,Z=r.segments.prepareSegment(4*o.length,W,$,this.canOverlap?x.sortKey:void 0),K=this.glyphOffsetArray.length,it=Z.vertexLength,yt=this.allowVerticalPlacement&&E===m.at.vertical?Math.PI/2:0,lt=x.text&&x.text.sections;for(let ft=0;ft<o.length;ft++){const{tl:At,tr:It,bl:Xt,br:pe,tex:ue,pixelOffsetTL:_e,pixelOffsetBR:Pe,minFontScaleX:Ae,minFontScaleY:Ee,glyphOffset:se,isSDF:Ye,sectionIndex:Xe}=o[ft],Ge=Z.vertexLength,Fe=se[1];Nm(W,R.x,R.y,At.x,Fe+At.y,ue.x,ue.y,p,Ye,_e.x,_e.y,Ae,Ee),Nm(W,R.x,R.y,It.x,Fe+It.y,ue.x+ue.w,ue.y,p,Ye,Pe.x,_e.y,Ae,Ee),Nm(W,R.x,R.y,Xt.x,Fe+Xt.y,ue.x,ue.y+ue.h,p,Ye,_e.x,Pe.y,Ae,Ee),Nm(W,R.x,R.y,pe.x,Fe+pe.y,ue.x+ue.w,ue.y+ue.h,p,Ye,Pe.x,Pe.y,Ae,Ee),zm(r.dynamicLayoutVertexArray,R,yt),$.emplaceBack(Ge,Ge+2,Ge+1),$.emplaceBack(Ge+1,Ge+2,Ge+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(se[0]),ft!==o.length-1&&Xe===o[ft+1].sectionIndex||r.programConfigurations.populatePaintArrays(W.length,x,x.index,{imagePositions:{},canonical:V,formattedSection:lt&&lt[Xe]})}r.placedSymbolArray.emplaceBack(R.x,R.y,K,this.glyphOffsetArray.length-K,it,D,B,R.segment,p?p[0]:0,p?p[1]:0,g[0],g[1],E,0,!1,0,N)}_addCollisionDebugVertex(r,o,p,g,v,x){return o.emplaceBack(0,0),r.emplaceBack(p.x,p.y,g,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(r,o,p,g,v,x,E){const R=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),D=R.vertexLength,B=v.layoutVertexArray,N=v.collisionVertexArray,V=E.anchorX,$=E.anchorY;this._addCollisionDebugVertex(B,N,x,V,$,new w(r,o)),this._addCollisionDebugVertex(B,N,x,V,$,new w(p,o)),this._addCollisionDebugVertex(B,N,x,V,$,new w(p,g)),this._addCollisionDebugVertex(B,N,x,V,$,new w(r,g)),R.vertexLength+=4;const W=v.indexArray;W.emplaceBack(D,D+1),W.emplaceBack(D+1,D+2),W.emplaceBack(D+2,D+3),W.emplaceBack(D+3,D),R.primitiveLength+=4}addDebugCollisionBoxes(r,o,p,g){for(let v=r;v<o;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vm(Wt,fh.members,Te),this.iconCollisionBox=new Vm(Wt,fh.members,Te);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(r,o,p,g,v,x,E,R,D){const B={};for(let N=o;N<p;N++){const V=r.get(N);B.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.textFeatureIndex=V.featureIndex;break}for(let N=g;N<v;N++){const V=r.get(N);B.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.verticalTextFeatureIndex=V.featureIndex;break}for(let N=x;N<E;N++){const V=r.get(N);B.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.iconFeatureIndex=V.featureIndex;break}for(let N=R;N<D;N++){const V=r.get(N);B.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.verticalIconFeatureIndex=V.featureIndex;break}return B}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const p=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,o){const p=r.placedSymbolArray.get(o),g=p.vertexStartIndex+4*p.numGlyphs;for(let v=p.vertexStartIndex;v<g;v+=4)r.indexArray.emplaceBack(v,v+2,v+1),r.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),p=Math.cos(r),g=[],v=[],x=[];for(let E=0;E<this.symbolInstances.length;++E){x.push(E);const R=this.symbolInstances.get(E);g.push(0|Math.round(o*R.anchorX+p*R.anchorY)),v.push(R.featureIndex)}return x.sort(((E,R)=>g[E]-g[R]||v[R]-v[E])),x}addToSortKeyRanges(r,o){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===o?p.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const p=this.symbolInstances.get(o);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((g,v,x)=>{g>=0&&x.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let jm,C_;Ie("SymbolBucket",Ef,{omit:["layers","collisionBoxArray","features","compareText"]}),Ef.MAX_GLYPHS=65535,Ef.addDynamicAttributes=zm;var $m={get paint(){return C_=C_||new Ir({"icon-opacity":new je(ut.paint_symbol["icon-opacity"]),"icon-color":new je(ut.paint_symbol["icon-color"]),"icon-halo-color":new je(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new je(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new je(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new ze(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new ze(ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new je(ut.paint_symbol["text-opacity"]),"text-color":new je(ut.paint_symbol["text-color"],{runtimeType:Ur,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new je(ut.paint_symbol["text-halo-color"]),"text-halo-width":new je(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new je(ut.paint_symbol["text-halo-blur"]),"text-translate":new ze(ut.paint_symbol["text-translate"]),"text-translate-anchor":new ze(ut.paint_symbol["text-translate-anchor"])})},get layout(){return jm=jm||new Ir({"symbol-placement":new ze(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new ze(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ze(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new je(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ze(ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ze(ut.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ze(ut.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ze(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new ze(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ze(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new je(ut.layout_symbol["icon-size"]),"icon-text-fit":new ze(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ze(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new je(ut.layout_symbol["icon-image"]),"icon-rotate":new je(ut.layout_symbol["icon-rotate"]),"icon-padding":new je(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new ze(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new je(ut.layout_symbol["icon-offset"]),"icon-anchor":new je(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ze(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ze(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ze(ut.layout_symbol["text-rotation-alignment"]),"text-field":new je(ut.layout_symbol["text-field"]),"text-font":new je(ut.layout_symbol["text-font"]),"text-size":new je(ut.layout_symbol["text-size"]),"text-max-width":new je(ut.layout_symbol["text-max-width"]),"text-line-height":new ze(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new je(ut.layout_symbol["text-letter-spacing"]),"text-justify":new je(ut.layout_symbol["text-justify"]),"text-radial-offset":new je(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ze(ut.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new je(ut.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new je(ut.layout_symbol["text-anchor"]),"text-max-angle":new ze(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new ze(ut.layout_symbol["text-writing-mode"]),"text-rotate":new je(ut.layout_symbol["text-rotate"]),"text-padding":new ze(ut.layout_symbol["text-padding"]),"text-keep-upright":new ze(ut.layout_symbol["text-keep-upright"]),"text-transform":new je(ut.layout_symbol["text-transform"]),"text-offset":new je(ut.layout_symbol["text-offset"]),"text-allow-overlap":new ze(ut.layout_symbol["text-allow-overlap"]),"text-overlap":new ze(ut.layout_symbol["text-overlap"]),"text-ignore-placement":new ze(ut.layout_symbol["text-ignore-placement"]),"text-optional":new ze(ut.layout_symbol["text-optional"])})}};class _v{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:Li,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ie("FormatSectionOverride",_v,{omit:["defaultValue"]});class Cf extends In{constructor(r,o){super(r,$m,o)}recalculate(r,o){if(super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const g=[];for(const v of p)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,o,p,g){const v=this.layout.get(r).evaluate(o,{},p,g),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||Hu(x.value)||!v?v:(function(E,R){return R.replace(/{([^{}]+)}/g,((D,B)=>E&&B in E?String(E[B]):""))})(o.properties,v)}createBucket(r){return new Ef(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of $m.paint.overridableProperties){if(!Cf.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),p=new _v(o),g=new qc(p,o.property.specification);let v=null;v=o.value.kind==="constant"||o.value.kind==="source"?new nl("source",g):new ss("composite",g,o.value.zoomStops),this.paint._values[r]=new os(o.property,v,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,p){return!(!this.layout||o.isDataDriven()||p.isDataDriven())&&Cf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const p=r.get("text-field"),g=$m.paint.properties[o];let v=!1;const x=E=>{for(const R of E)if(g.overrides&&g.overrides.hasOverride(R))return void(v=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Bn)x(p.value.value.sections);else if(p.value.kind==="source"||p.value.kind==="composite"){const E=D=>{v||(D instanceof co&&nn(D.value)===Zo?x(D.value.sections):D instanceof $l?x(D.sections):D.eachChild(E))},R=p.value;R._styleExpression&&E(R._styleExpression.expression)}return v}}let Hm;var u0={get paint(){return Hm=Hm||new Ir({"background-color":new ze(ut.paint_background["background-color"]),"background-pattern":new th(ut.paint_background["background-pattern"]),"background-opacity":new ze(ut.paint_background["background-opacity"])})}};class h0 extends In{constructor(r,o){super(r,u0,o)}}class Zd extends In{constructor(r,o){super(r,{},o),this.onAdd=p=>{this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},this.onRemove=p=>{this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class f0{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const yv={once:!0},Ci=63710088e-1;class Sl{constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sl(Je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,p=this.lat*o,g=r.lat*o,v=Math.sin(p)*Math.sin(g)+Math.cos(p)*Math.cos(g)*Math.cos((r.lng-this.lng)*o);return Ci*Math.acos(Math.min(v,1))}static convert(r){if(r instanceof Sl)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Sl(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Sl(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Gd=2*Math.PI*Ci;function Wm(u){return Gd*Math.cos(u*Math.PI/180)}function M_(u){return(180+u)/360}function qm(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Mf(u,r){return u/Wm(r)}function Yd(u){return 360*u-180}function Xm(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function R_(u,r){return u*Wm(Xm(r))}class Kd{constructor(r,o,p=0){this.x=+r,this.y=+o,this.z=+p}static fromLngLat(r,o=0){const p=Sl.convert(r);return new Kd(M_(p.lng),qm(p.lat),Mf(o,p.lat))}toLngLat(){return new Sl(Yd(this.x),Xm(this.y))}toAltitude(){return R_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gd*(r=Xm(this.y),1/Math.cos(r*Math.PI/180));var r}}function vv(u,r,o){var p=2*Math.PI*6378137/256/Math.pow(2,o);return[u*p-2*Math.PI*6378137/2,r*p-2*Math.PI*6378137/2]}class Zm{constructor(r,o,p){if(!(function(g,v,x){return!(g<0||g>25||x<0||x>=Math.pow(2,g)||v<0||v>=Math.pow(2,g))})(r,o,p))throw new Error(`x=${o}, y=${p}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=o,this.y=p,this.key=hu(0,r,r,o,p)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,o,p){const g=(x=this.y,E=this.z,R=vv(256*(v=this.x),256*(x=Math.pow(2,E)-x-1),E),D=vv(256*(v+1),256*(x+1),E),R[0]+","+R[1]+","+D[0]+","+D[1]);var v,x,E,R,D;const B=(function(N,V,$){let W,Z="";for(let K=N;K>0;K--)W=1<<K-1,Z+=(V&W?1:0)+($&W?2:0);return Z})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,B).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const o=this.z-r.z;return o>0&&r.x===this.x>>o&&r.y===this.y>>o}getTilePoint(r){const o=Math.pow(2,this.z);return new w((r.x*o-this.x)*Ue,(r.y*o-this.y)*Ue)}toString(){return`${this.z}/${this.x}/${this.y}`}}class P_{constructor(r,o){this.wrap=r,this.canonical=o,this.key=hu(r,o.z,o.z,o.x,o.y)}}class Ai{constructor(r,o,p,g,v){if(this.terrainRttPosMatrix32f=null,r<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${p}`);this.overscaledZ=r,this.wrap=o,this.canonical=new Zm(p,+g,+v),this.key=hu(o,r,p,g,v)}clone(){return new Ai(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-r;return r>this.canonical.z?new Ai(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ai(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(r,o){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-r;return r>this.canonical.z?hu(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y):hu(this.wrap*+o,r,r,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(r){if(r.wrap!==this.wrap||this.overscaledZ-r.overscaledZ<=0)return!1;if(r.overscaledZ===0)return this.overscaledZ>0;const o=this.canonical.z-r.canonical.z;return!(o<0)&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new Ai(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,p=2*this.canonical.x,g=2*this.canonical.y;return[new Ai(o,this.wrap,o,p,g),new Ai(o,this.wrap,o,p+1,g),new Ai(o,this.wrap,o,p,g+1),new Ai(o,this.wrap,o,p+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ai(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ai(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new P_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Kd(r.x-this.wrap,r.y))}}function hu(u,r,o,p,g){(u*=2)<0&&(u=-1*u-1);const v=1<<o;return(v*v*u+v*g+p).toString(36)+o.toString(36)+r.toString(36)}function dr(u,r){return r?u.properties[r]:u.id}Ie("CanonicalTileID",Zm),Ie("OverscaledTileID",Ai,{omit:["terrainRttPosMatrix32f"]});class _h{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(r){return this.minX=Math.min(this.minX,r.x),this.minY=Math.min(this.minY,r.y),this.maxX=Math.max(this.maxX,r.x),this.maxY=Math.max(this.maxY,r.y),this}expandBy(r){return this.minX-=r,this.minY-=r,this.maxX+=r,this.maxY+=r,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(r){return this.expandBy(-r)}map(r){const o=new _h;return o.extend(r(new w(this.minX,this.minY))),o.extend(r(new w(this.maxX,this.minY))),o.extend(r(new w(this.minX,this.maxY))),o.extend(r(new w(this.maxX,this.maxY))),o}static fromPoints(r){const o=new _h;for(const p of r)o.extend(p);return o}contains(r){return r.x>=this.minX&&r.x<=this.maxX&&r.y>=this.minY&&r.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(r){return!this.empty()&&!r.empty()&&r.minX>=this.minX&&r.maxX<=this.maxX&&r.minY>=this.minY&&r.maxY<=this.maxY}intersects(r){return!this.empty()&&!r.empty()&&r.minX<=this.maxX&&r.maxX>=this.minX&&r.minY<=this.maxY&&r.maxY>=this.minY}}class I_{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const p=r[o];this._stringToNumber[p]=o,this._numberToString[o]=p}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class bv{constructor(r,o,p,g,v){this.type="Feature",this._vectorTileFeature=r,r._z=o,r._x=p,r._y=g,this.properties=r.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(r[o]=this[o]);return r}}class fu{_name;dataBuffer;nullabilityBuffer;_size;constructor(r,o,p){this._name=r,this.dataBuffer=o,typeof p=="number"?this._size=p:(this.nullabilityBuffer=p,this._size=p.size())}getValue(r){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(r)?null:this.getValueFromBuffer(r)}has(r){return this.nullabilityBuffer&&this.nullabilityBuffer.get(r)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Rf extends fu{}class Pf extends Rf{getValueFromBuffer(r){return this.dataBuffer[r]}}class Gm extends Rf{getValueFromBuffer(r){return this.dataBuffer[r]}}class D_ extends fu{delta;constructor(r,o,p,g){super(r,o,g),this.delta=p}}class Qd extends D_{constructor(r,o,p,g){super(r,Int32Array.of(o),p,g)}getValueFromBuffer(r){return this.dataBuffer[0]+r*this.delta}}class Jd extends fu{constructor(r,o,p){super(r,Int32Array.of(o),p)}getValueFromBuffer(r){return this.dataBuffer[0]}}class d0{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(r,o,p,g,v=4096){this._name=r,this._geometryVector=o,this._idVector=p,this._propertyVectors=g,this._extent=v}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(r){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((o=>[o.name,o])))),this.propertyVectorsMap.get(r)}*[Symbol.iterator](){const r=this.geometryVector[Symbol.iterator]();let o=0;for(;o<this.numFeatures;){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const g=r?.next().value,v={};for(const x of this.propertyVectors){if(!x)continue;const E=x.name,R=x.getValue(o);R!==null&&(v[E]=R)}o++,yield{id:p,geometry:g,properties:v}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const r=[],o=this.geometryVector.getGeometries();for(let p=0;p<this.numFeatures;p++){let g;this.idVector&&(g=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(p)):this.idVector.getValue(p));const v={coordinates:o[p],type:this.geometryVector.geometryType(p)},x={};for(const E of this.propertyVectors){if(!E)continue;const R=E.name,D=E.getValue(p);D!==null&&(x[R]=D)}r.push({id:g,geometry:v,properties:x})}return r}containsMaxSaveIntegerValues(r){return r instanceof Pf||r instanceof Jd&&r instanceof Qd||r instanceof Gm}}class xv{value;constructor(r){this.value=r}get(){return this.value}set(r){this.value=r}increment(){return this.value++}add(r){this.value+=r}}var Hr,yi,gc,Fo,Ks,Us,pr,nr,wv,Ta;(function(u){u.PRESENT="PRESENT",u.DATA="DATA",u.OFFSET="OFFSET",u.LENGTH="LENGTH"})(Hr||(Hr={}));class Ym{_dictionaryType;_offsetType;_lengthType;constructor(r,o,p){this._dictionaryType=r,this._offsetType=o,this._lengthType=p}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Gn(u,r,o){const p=new Int32Array(o);let g=0,v=r.get();for(let x=0;x<p.length;x++){let E=u[v++],R=127&E;E<128||(E=u[v++],R|=(127&E)<<7,E<128||(E=u[v++],R|=(127&E)<<14,E<128||(E=u[v++],R|=(127&E)<<21,E<128||(E=u[v++],R|=(15&E)<<28)))),p[g++]=R}return r.set(v),p}function If(u,r,o){const p=new BigInt64Array(o);for(let g=0;g<p.length;g++)p[g]=Tv(u,r);return p}function p0(u,r){let o,p;return p=u[r.get()],r.increment(),o=127&p,p<128?o:(p=u[r.get()],r.increment(),o|=(127&p)<<7,p<128?o:(p=u[r.get()],r.increment(),o|=(127&p)<<14,p<128?o:(p=u[r.get()],r.increment(),o|=(127&p)<<21,p<128?o:(p=u[r.get()],o|=(15&p)<<28,(function(g,v,x){let E,R;if(R=v[x.get()],x.increment(),E=(112&R)>>4,R<128||(R=v[x.get()],x.increment(),E|=(127&R)<<3,R<128)||(R=v[x.get()],x.increment(),E|=(127&R)<<10,R<128)||(R=v[x.get()],x.increment(),E|=(127&R)<<17,R<128)||(R=v[x.get()],x.increment(),E|=(127&R)<<24,R<128)||(R=v[x.get()],x.increment(),E|=(1&R)<<31,R<128))return 4294967296*E+(g>>>0);throw new Error("Expected varint not more than 10 bytes")})(o,u,r)))))}function Sa(u,r,o,p){throw new Error("FastPFor is not implemented yet.")}function _c(u){return u>>>1^-(1&u)}function yh(u){return u>>1n^-(1n&u)}function Tv(u,r){let o=0n,p=0,g=r.get();for(;g<u.length;){const v=u[g++];if(o|=BigInt(127&v)<<BigInt(p),!(128&v))break;if(p+=7,p>=64)throw new Error("Varint too long")}return r.set(g),o}function k_(u,r,o){const p=new Int32Array(o);let g=0;for(let v=0;v<r;v++){const x=u[v];p.fill(u[v+r],g,g+x),g+=x}return p}function Df(u,r,o){const p=new BigInt64Array(o);let g=0;for(let v=0;v<r;v++){const x=Number(u[v]);p.fill(u[v+r],g,g+x),g+=x}return p}function Aa(u,r,o){const p=new Float64Array(o);let g=0;for(let v=0;v<r;v++){const x=u[v];p.fill(u[v+r],g,g+x),g+=x}return p}function Km(u){const r=u.length/4*4;let o=1;if(r>=4)for(let p=u[0];o<r-4;o+=4)p=u[o]+=p,p=u[o+1]+=p,p=u[o+2]+=p,p=u[o+3]+=p;for(;o!=u.length;)u[o]+=u[o-1],++o}function tp(u){u[0]=u[0]>>>1^-(1&u[0]),u[1]=u[1]>>>1^-(1&u[1]);const r=u.length/4*4;let o=2;if(r>=4)for(;o<r-4;o+=4){const p=u[o],g=u[o+1],v=u[o+2],x=u[o+3];u[o]=(p>>>1^-(1&p))+u[o-2],u[o+1]=(g>>>1^-(1&g))+u[o-1],u[o+2]=(v>>>1^-(1&v))+u[o],u[o+3]=(x>>>1^-(1&x))+u[o+1]}for(;o!=u.length;o+=2)u[o]=(u[o]>>>1^-(1&u[o]))+u[o-2],u[o+1]=(u[o+1]>>>1^-(1&u[o+1]))+u[o-1]}function Rs(u,r,o){return Math.min(o,Math.max(r,u))}(function(u){u.NONE="NONE",u.DELTA="DELTA",u.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",u.RLE="RLE",u.MORTON="MORTON",u.PDE="PDE"})(yi||(yi={})),(function(u){u.NONE="NONE",u.FAST_PFOR="FAST_PFOR",u.VARINT="VARINT",u.ALP="ALP"})(gc||(gc={})),(function(u){u.NONE="NONE",u.SINGLE="SINGLE",u.SHARED="SHARED",u.VERTEX="VERTEX",u.MORTON="MORTON",u.FSST="FSST"})(Fo||(Fo={})),(function(u){u.VERTEX="VERTEX",u.INDEX="INDEX",u.STRING="STRING",u.KEY="KEY"})(Ks||(Ks={})),(function(u){u.VAR_BINARY="VAR_BINARY",u.GEOMETRIES="GEOMETRIES",u.PARTS="PARTS",u.RINGS="RINGS",u.TRIANGLES="TRIANGLES",u.SYMBOL="SYMBOL",u.DICTIONARY="DICTIONARY"})(Us||(Us={}));class vh{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(r,o,p,g,v,x,E){this._physicalStreamType=r,this._logicalStreamType=o,this._logicalLevelTechnique1=p,this._logicalLevelTechnique2=g,this._physicalLevelTechnique=v,this._numValues=x,this._byteLength=E}static decode(r,o){const p=r[o.get()],g=Object.values(Hr)[p>>4];let v=null;switch(g){case Hr.DATA:v=new Ym(Object.values(Fo)[15&p]);break;case Hr.OFFSET:v=new Ym(null,Object.values(Ks)[15&p]);break;case Hr.LENGTH:v=new Ym(null,null,Object.values(Us)[15&p])}o.increment();const x=r[o.get()],E=Object.values(yi)[x>>5],R=Object.values(yi)[x>>2&7],D=Object.values(gc)[3&x];o.increment();const B=Gn(r,o,2);return new vh(g,v,E,R,D,B[0],B[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class Qm extends vh{num_bits;coordinate_shift;constructor(r,o,p,g,v,x,E,R,D){super(r,o,p,g,v,x,E),this.num_bits=R,this.coordinate_shift=D}static decode(r,o){const p=vh.decode(r,o),g=Gn(r,o,2);return new Qm(p.physicalStreamType,p.logicalStreamType,p.logicalLevelTechnique1,p.logicalLevelTechnique2,p.physicalLevelTechnique,p.numValues,p.byteLength,g[0],g[1])}static decodePartial(r,o,p){const g=Gn(o,p,2);return new Qm(r.physicalStreamType,r.logicalStreamType,r.logicalLevelTechnique1,r.logicalLevelTechnique2,r.physicalLevelTechnique,r.numValues,r.byteLength,g[0],g[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class Al extends vh{_runs;_numRleValues;constructor(r,o,p,g,v,x,E,R,D){super(r,o,p,g,v,x,E),this._runs=R,this._numRleValues=D}static decode(r,o){const p=vh.decode(r,o),g=Gn(r,o,2);return new Al(p.physicalStreamType,p.logicalStreamType,p.logicalLevelTechnique1,p.logicalLevelTechnique2,p.physicalLevelTechnique,p.numValues,p.byteLength,g[0],g[1])}static decodePartial(r,o,p){const g=Gn(o,p,2);return new Al(r.physicalStreamType,r.logicalStreamType,r.logicalLevelTechnique1,r.logicalLevelTechnique2,r.physicalLevelTechnique,r.numValues,r.byteLength,g[0],g[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class Wr{static decode(r,o){const p=vh.decode(r,o);return p.logicalLevelTechnique1===yi.MORTON?Qm.decodePartial(p,r,o):yi.RLE!==p.logicalLevelTechnique1&&yi.RLE!==p.logicalLevelTechnique2||gc.NONE===p.physicalLevelTechnique?p:Al.decodePartial(p,r,o)}}(function(u){u[u.FLAT=0]="FLAT",u[u.CONST=1]="CONST",u[u.SEQUENCE=2]="SEQUENCE",u[u.DICTIONARY=3]="DICTIONARY",u[u.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(pr||(pr={}));class No{values;_size;constructor(r,o){this.values=r,this._size=o}get(r){const o=Math.floor(r/8);return(this.values[o]>>r%8&1)==1}set(r,o){const p=Math.floor(r/8);this.values[p]=this.values[p]|(o?1:0)<<r%8}getInt(r){const o=Math.floor(r/8);return this.values[o]>>r%8&1}size(){return this._size}getBuffer(){return this.values}}class li{constructor(){}static decodeIntStream(r,o,p,g,v){const x=li.decodePhysicalLevelTechnique(r,o,p);return this.decodeIntBuffer(x,p,g,v)}static decodeLengthStreamToOffsetBuffer(r,o,p){const g=li.decodePhysicalLevelTechnique(r,o,p);return this.decodeLengthToOffsetBuffer(g,p)}static decodePhysicalLevelTechnique(r,o,p){const g=p.physicalLevelTechnique;if(g===gc.FAST_PFOR)return Sa();if(g===gc.VARINT)return Gn(r,o,p.numValues);if(g===gc.NONE){const v=o.get();o.add(p.byteLength);const x=r.subarray(v,o.get());return new Int32Array(x)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(r,o,p,g){const v=li.decodePhysicalLevelTechnique(r,o,p);if(v.length===1){const x=v[0];return g?_c(x):x}return g?(function(x){return _c(x[1])})(v):(function(x){return x[1]})(v)}static decodeSequenceIntStream(r,o,p){return(function(g){if(g.length==2){const v=_c(g[1]);return[v,v]}return[_c(g[2]),_c(g[3])]})(li.decodePhysicalLevelTechnique(r,o,p))}static decodeSequenceLongStream(r,o,p){return(function(g){if(g.length==2){const v=yh(g[1]);return[v,v]}return[yh(g[2]),yh(g[3])]})(If(r,o,p.numValues))}static decodeLongStream(r,o,p,g){const v=If(r,o,p.numValues);return this.decodeLongBuffer(v,p,g)}static decodeLongFloat64Stream(r,o,p,g){const v=(function(x,E,R){const D=new Float64Array(E);for(let B=0;B<E;B++)D[B]=p0(x,R);return D})(r,p.numValues,o);return this.decodeFloat64Buffer(v,p,g)}static decodeConstLongStream(r,o,p,g){const v=If(r,o,p.numValues);if(v.length===1){const x=v[0];return g?yh(x):x}return g?(function(x){return yh(x[1])})(v):(function(x){return x[1]})(v)}static decodeIntBuffer(r,o,p,g){switch(o.logicalLevelTechnique1){case yi.DELTA:return o.logicalLevelTechnique2===yi.RLE?(function(v,x,E){const R=new Int32Array(E);let D=0,B=0;for(let N=0;N<x;N++){const V=v[N],$=_c(v[N+x]);for(let W=0;W<V;W++)B+=$,R[D++]=B}return R})(r,o.runs,o.numRleValues):((function(v){v[0]=v[0]>>>1^-(1&v[0]);const x=v.length/4*4;let E=1;if(x>=4)for(;E<x-4;E+=4){const R=v[E],D=v[E+1],B=v[E+2],N=v[E+3];v[E]=(R>>>1^-(1&R))+v[E-1],v[E+1]=(D>>>1^-(1&D))+v[E],v[E+2]=(B>>>1^-(1&B))+v[E+1],v[E+3]=(N>>>1^-(1&N))+v[E+2]}for(;E!=v.length;++E)v[E]=(v[E]>>>1^-(1&v[E]))+v[E-1]})(r),r);case yi.RLE:return(function(v,x,E){return E?(function(R,D,B){const N=new Int32Array(B);let V=0;for(let $=0;$<D;$++){const W=R[$];let Z=R[$+D];Z=Z>>>1^-(1&Z),N.fill(Z,V,V+W),V+=W}return N})(v,x.runs,x.numRleValues):k_(v,x.runs,x.numRleValues)})(r,o,p);case yi.MORTON:return Km(r),r;case yi.COMPONENTWISE_DELTA:return g?((function(v,x,E,R){let D=v[0]>>>1^-(1&v[0]),B=v[1]>>>1^-(1&v[1]);v[0]=Rs(Math.round(D*x),E,R),v[1]=Rs(Math.round(B*x),E,R);const N=v.length/16;let V=2;if(N>=4)for(;V<N-4;V+=4){const $=v[V],W=v[V+1],Z=($>>>1^-(1&$))+D,K=(W>>>1^-(1&W))+B;v[V]=Rs(Math.round(Z*x),E,R),v[V+1]=Rs(Math.round(K*x),E,R);const it=v[V+2],yt=v[V+3];D=(it>>>1^-(1&it))+Z,B=(yt>>>1^-(1&yt))+K,v[V+2]=Rs(Math.round(D*x),E,R),v[V+3]=Rs(Math.round(B*x),E,R)}for(;V!=v.length;V+=2)D+=v[V]>>>1^-(1&v[V]),B+=v[V+1]>>>1^-(1&v[V+1]),v[V]=Rs(Math.round(D*x),E,R),v[V+1]=Rs(Math.round(B*x),E,R)})(r,g.scale,g.min,g.max),r):(tp(r),r);case yi.NONE:return p&&(function(v){for(let x=0;x<v.length;x++){const E=v[x];v[x]=E>>>1^-(1&E)}})(r),r;default:throw new Error(`The specified Logical level technique is not supported: ${o.logicalLevelTechnique1}`)}}static decodeLongBuffer(r,o,p){switch(o.logicalLevelTechnique1){case yi.DELTA:return o.logicalLevelTechnique2===yi.RLE?(function(g,v,x){const E=new BigInt64Array(x);let R=0,D=0n;for(let B=0;B<v;B++){const N=Number(g[B]),V=yh(g[B+v]);for(let $=0;$<N;$++)D+=V,E[R++]=D}return E})(r,o.runs,o.numRleValues):((function(g){g[0]=g[0]>>1n^-(1n&g[0]);const v=g.length/4*4;let x=1;if(v>=4)for(;x<v-4;x+=4){const E=g[x],R=g[x+1],D=g[x+2],B=g[x+3];g[x]=(E>>1n^-(1n&E))+g[x-1],g[x+1]=(R>>1n^-(1n&R))+g[x],g[x+2]=(D>>1n^-(1n&D))+g[x+1],g[x+3]=(B>>1n^-(1n&B))+g[x+2]}for(;x!=g.length;++x)g[x]=(g[x]>>1n^-(1n&g[x]))+g[x-1]})(r),r);case yi.RLE:return(function(g,v,x){return x?(function(E,R,D){const B=new BigInt64Array(D);let N=0;for(let V=0;V<R;V++){const $=Number(E[V]);let W=E[V+R];W=W>>1n^-(1n&W),B.fill(W,N,N+$),N+=$}return B})(g,v.runs,v.numRleValues):Df(g,v.runs,v.numRleValues)})(r,o,p);case yi.NONE:return p&&(function(g){for(let v=0;v<g.length;v++){const x=g[v];g[v]=x>>1n^-(1n&x)}})(r),r;default:throw new Error(`The specified Logical level technique is not supported: ${o.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(r,o,p){switch(o.logicalLevelTechnique1){case yi.DELTA:return o.logicalLevelTechnique2===yi.RLE&&(r=Aa(r,o.runs,o.numRleValues)),(function(g){g[0]=g[0]%2==1?(g[0]+1)/-2:g[0]/2;const v=g.length/4*4;let x=1;if(v>=4)for(;x<v-4;x+=4){const E=g[x],R=g[x+1],D=g[x+2],B=g[x+3];g[x]=(E%2==1?(E+1)/-2:E/2)+g[x-1],g[x+1]=(R%2==1?(R+1)/-2:R/2)+g[x],g[x+2]=(D%2==1?(D+1)/-2:D/2)+g[x+1],g[x+3]=(B%2==1?(B+1)/-2:B/2)+g[x+2]}for(;x!=g.length;++x)g[x]=(g[x]%2==1?(g[x]+1)/-2:g[x]/2)+g[x-1]})(r),r;case yi.RLE:return(function(g,v,x){return x?(function(E,R,D){const B=new Float64Array(D);let N=0;for(let V=0;V<R;V++){const $=E[V];let W=E[V+R];W=W%2==1?(W+1)/-2:W/2,B.fill(W,N,N+$),N+=$}return B})(g,v.runs,v.numRleValues):Aa(g,v.runs,v.numRleValues)})(r,o,p);case yi.NONE:return p&&(function(g){for(let v=0;v<g.length;v++){const x=g[v];g[v]=x%2==1?(x+1)/-2:x/2}})(r),r;default:throw new Error(`The specified Logical level technique is not supported: ${o.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(r,o){if(o.logicalLevelTechnique1===yi.DELTA&&o.logicalLevelTechnique2===yi.NONE)return(function(p){const g=new Int32Array(p.length+1);g[0]=0,g[1]=_c(p[0]);let v=g[1],x=2;for(;x!=g.length;++x){const E=p[x-1];v+=E>>>1^-(1&E),g[x]=g[x-1]+v}return g})(r);if(o.logicalLevelTechnique1===yi.RLE&&o.logicalLevelTechnique2===yi.NONE)return(function(p,g,v){const x=new Int32Array(v+1);x[0]=0;let E=1,R=x[0];for(let D=0;D<g;D++){const B=p[D],N=p[D+g];for(let V=E;V<E+B;V++)x[V]=N+R,R=x[V];E+=B}return x})(r,o.runs,o.numRleValues);if(o.logicalLevelTechnique1===yi.NONE&&o.logicalLevelTechnique2===yi.NONE){(function(g){let v=0;for(let x=0;x<g.length;x++)g[x]+=v,v=g[x]})(r);const p=new Int32Array(o.numValues+1);return p[0]=0,p.set(r,1),p}if(o.logicalLevelTechnique1===yi.DELTA&&o.logicalLevelTechnique2===yi.RLE){const p=(function(g,v,x){const E=new Int32Array(x+1);E[0]=0;let R=1,D=E[0];for(let B=0;B<v;B++){const N=g[B];let V=g[B+v];V=V>>>1^-(1&V);for(let $=R;$<R+N;$++)E[$]=V+D,D=E[$];R+=N}return E})(r,o.runs,o.numRleValues);return Km(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(r,o,p,g,v){const x=p.physicalLevelTechnique===gc.FAST_PFOR?Sa():Gn(r,o,p.numValues);return this.decodeNullableIntBuffer(x,p,g,v)}static decodeNullableLongStream(r,o,p,g,v){const x=If(r,o,p.numValues);return this.decodeNullableLongBuffer(x,p,g,v)}static decodeNullableIntBuffer(r,o,p,g){switch(o.logicalLevelTechnique1){case yi.DELTA:return o.logicalLevelTechnique2===yi.RLE&&(r=k_(r,o.runs,o.numRleValues)),(function(v,x){const E=new Int32Array(v.size());let R=0;v.get(0)?(E[0]=v.get(0)?x[0]>>>1^-(1&x[0]):0,R=1):E[0]=0;let D=1;for(;D!=E.length;++D)E[D]=v.get(D)?E[D-1]+(x[R]>>>1^-(1&x[R++])):E[D-1];return E})(g,r);case yi.RLE:return(function(v,x,E,R){const D=x;return E?(function(B,N,V){const $=new Int32Array(B.size());let W=0;for(let Z=0;Z<V;Z++){const K=N[Z];let it=N[Z+V];it=it>>>1^-(1&it);for(let yt=W;yt<W+K;yt++)B.get(yt)?$[yt]=it:($[yt]=0,W++);W+=K}return $})(R,v,D.runs):(function(B,N,V){const $=new Int32Array(B.size());let W=0;for(let Z=0;Z<V;Z++){const K=N[Z],it=N[Z+V];for(let yt=W;yt<W+K;yt++)B.get(yt)?$[yt]=it:($[yt]=0,W++);W+=K}return $})(R,v,D.runs)})(r,o,p,g);case yi.MORTON:return Km(r),r;case yi.COMPONENTWISE_DELTA:return tp(r),r;case yi.NONE:return r=p?(function(v,x){const E=new Int32Array(v.size());let R=0,D=0;for(;D!=E.length;++D)if(v.get(D)){const B=x[R++];E[D]=B>>>1^-(1&B)}else E[D]=0;return E})(g,r):(function(v,x){const E=new Int32Array(v.size());let R=0,D=0;for(;D!=E.length;++D)E[D]=v.get(D)?x[R++]:0;return E})(g,r),r;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(r,o,p,g){switch(o.logicalLevelTechnique1){case yi.DELTA:return o.logicalLevelTechnique2===yi.RLE&&(r=Df(r,o.runs,o.numRleValues)),(function(v,x){const E=new BigInt64Array(v.size());let R=0;v.get(0)?(E[0]=v.get(0)?x[0]>>1n^-(1n&x[0]):0n,R=1):E[0]=0n;let D=1;for(;D!=E.length;++D)E[D]=v.get(D)?E[D-1]+(x[R]>>1n^-(1n&x[R++])):E[D-1];return E})(g,r);case yi.RLE:return(function(v,x,E,R){const D=x;return E?(function(B,N,V){const $=new BigInt64Array(B.size());let W=0;for(let Z=0;Z<V;Z++){const K=Number(N[Z]);let it=N[Z+V];it=it>>1n^-(1n&it);for(let yt=W;yt<W+K;yt++)B.get(yt)?$[yt]=it:($[yt]=0n,W++);W+=K}return $})(R,v,D.runs):(function(B,N,V){const $=new BigInt64Array(B.size());let W=0;for(let Z=0;Z<V;Z++){const K=Number(N[Z]),it=N[Z+V];for(let yt=W;yt<W+K;yt++)B.get(yt)?$[yt]=it:($[yt]=0n,W++);W+=K}return $})(R,v,D.runs)})(r,o,p,g);case yi.NONE:return r=p?(function(v,x){const E=new BigInt64Array(v.size());let R=0,D=0;for(;D!=E.length;++D)if(v.get(D)){const B=x[R++];E[D]=B>>1n^-(1n&B)}else E[D]=0n;return E})(g,r):(function(v,x){const E=new BigInt64Array(v.size());let R=0,D=0;for(;D!=E.length;++D)E[D]=v.get(D)?x[R++]:0n;return E})(g,r),r;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(r,o,p,g){const v=r.logicalLevelTechnique1;if(v===yi.RLE)return r.runs===1?pr.CONST:pr.FLAT;const x=o instanceof No?o.size():o;if(v===yi.DELTA&&r.logicalLevelTechnique2===yi.RLE){const E=r.runs,R=2;if(r.numRleValues!==x)return pr.FLAT;if(E===1)return pr.SEQUENCE;if(E===2){const D=g.get();let B;if(r.physicalLevelTechnique===gc.VARINT)B=Gn(p,g,4);else{const N=g.get();B=new Int32Array(p.buffer,p.byteOffset+N,4)}if(g.set(D),B[2]===R&&B[3]===R)return pr.SEQUENCE}}return r.numValues===1?pr.CONST:pr.FLAT}}class Sv extends Rf{getValueFromBuffer(r){return this.dataBuffer[r]}}class Av extends D_{constructor(r,o,p,g){super(r,BigInt64Array.of(o),p,g)}getValueFromBuffer(r){return this.dataBuffer[0]+BigInt(r)*this.delta}}class kf{_geometryOffsets;_partOffsets;_ringOffsets;constructor(r,o,p){this._geometryOffsets=r,this._partOffsets=o,this._ringOffsets=p}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class m0{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(r,o){this._coordinateShift=r<0?Math.abs(r):0,this.tileExtent=o+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=r,this.maxBound=o}validateCoordinates(r){if(r.x<this.minBound||r.y<this.minBound||r.x>this.maxBound||r.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class Of extends m0{encode(r){this.validateCoordinates(r);const o=r.x+this._coordinateShift,p=r.y+this._coordinateShift;let g=0;for(let v=0;v<this._numBits;v++)g|=(o&1<<v)<<v|(p&1<<v)<<v+1;return g}decode(r){return{x:this.decodeMorton(r)-this._coordinateShift,y:this.decodeMorton(r>>1)-this._coordinateShift}}decodeMorton(r){let o=0;for(let p=0;p<this._numBits;p++)o|=(r&1<<2*p)>>p;return o}static decode(r,o,p){return{x:Of.decodeMorton(r,o)-p,y:Of.decodeMorton(r>>1,o)-p}}static decodeMorton(r,o){let p=0;for(let g=0;g<o;g++)p|=(r&1<<2*g)>>g;return p}}(function(u){u[u.POINT=0]="POINT",u[u.LINESTRING=1]="LINESTRING",u[u.POLYGON=2]="POLYGON",u[u.MULTIPOINT=3]="MULTIPOINT",u[u.MULTILINESTRING=4]="MULTILINESTRING",u[u.MULTIPOLYGON=5]="MULTIPOLYGON"})(nr||(nr={})),(function(u){u[u.POINT=0]="POINT",u[u.LINESTRING=1]="LINESTRING",u[u.POLYGON=2]="POLYGON"})(wv||(wv={})),(function(u){u[u.MORTON=0]="MORTON",u[u.VEC_2=1]="VEC_2",u[u.VEC_3=2]="VEC_3"})(Ta||(Ta={}));class Ev{createPoint(r){return[[r]]}createMultiPoint(r){return r.map((o=>[o]))}createLineString(r){return[r]}createMultiLineString(r){return r}createPolygon(r,o){return[r,...o]}createMultiPolygon(r){return r.flat()}}function bh(u){const r=new Array(u.numGeometries);let o=1,p=1,g=1,v=0;const x=new Ev;let E=0,R=0;const D=u.mortonSettings,B=u.topologyVector,N=B.geometryOffsets,V=B.partOffsets,$=B.ringOffsets,W=u.vertexOffsets,Z=u.containsPolygonGeometry(),K=u.vertexBuffer;for(let it=0;it<u.numGeometries;it++){const yt=u.geometryType(it);if(yt===nr.POINT){if(W&&W.length!==0)if(u.vertexBufferType===Ta.VEC_2){const lt=2*W[R++],ft=new w(K[lt],K[lt+1]);r[v++]=x.createPoint(ft)}else{const lt=W[R++],ft=Of.decode(K[lt],D.numBits,D.coordinateShift),At=new w(ft.x,ft.y);r[v++]=x.createPoint(At)}else{const lt=new w(K[E++],K[E++]);r[v++]=x.createPoint(lt)}N&&g++,V&&o++,$&&p++}else if(yt===nr.MULTIPOINT){const lt=N[g]-N[g-1];g++;const ft=new Array(lt);if(W&&W.length!==0){for(let At=0;At<lt;At++){const It=2*W[R++];ft[At]=new w(K[It],K[It+1])}r[v++]=x.createMultiPoint(ft)}else{for(let At=0;At<lt;At++){const It=K[E++],Xt=K[E++];ft[At]=new w(It,Xt)}r[v++]=x.createMultiPoint(ft)}}else if(yt===nr.LINESTRING){let lt,ft=0;Z?(ft=$[p]-$[p-1],p++):ft=V[o]-V[o-1],o++,W&&W.length!==0?(lt=u.vertexBufferType===Ta.VEC_2?xh(K,W,R,ft,!1):tg(K,W,R,ft,!1,D),R+=ft):(lt=pu(K,E,ft,!1),E+=2*ft),r[v++]=x.createLineString(lt),N&&g++}else if(yt===nr.POLYGON){const lt=V[o]-V[o-1];o++;const ft=new Array(lt-1);let At=$[p]-$[p-1];if(p++,W&&W.length!==0){const It=u.vertexBufferType===Ta.VEC_2?ep(K,W,R,At):Jm(K,W,R,At,0,D);R+=At;for(let Xt=0;Xt<ft.length;Xt++)At=$[p]-$[p-1],p++,ft[Xt]=u.vertexBufferType===Ta.VEC_2?ep(K,W,R,At):Jm(K,W,R,At,0,D),R+=At;r[v++]=x.createPolygon(It,ft)}else{const It=du(K,E,At);E+=2*At;for(let Xt=0;Xt<ft.length;Xt++)At=$[p]-$[p-1],p++,ft[Xt]=du(K,E,At),E+=2*At;r[v++]=x.createPolygon(It,ft)}N&&g++}else if(yt===nr.MULTILINESTRING){const lt=N[g]-N[g-1];g++;const ft=new Array(lt);if(W&&W.length!==0){for(let At=0;At<lt;At++){let It=0;Z?(It=$[p]-$[p-1],p++):It=V[o]-V[o-1],o++;const Xt=u.vertexBufferType===Ta.VEC_2?xh(K,W,R,It,!1):tg(K,W,R,It,!1,D);ft[At]=Xt,R+=It}r[v++]=x.createMultiLineString(ft)}else{for(let At=0;At<lt;At++){let It=0;Z?(It=$[p]-$[p-1],p++):It=V[o]-V[o-1],o++,ft[At]=pu(K,E,It,!1),E+=2*It}r[v++]=x.createMultiLineString(ft)}}else{if(yt!==nr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const lt=N[g]-N[g-1];g++;const ft=new Array(lt);let At=0;if(W&&W.length!==0){for(let It=0;It<lt;It++){const Xt=V[o]-V[o-1];o++;const pe=new Array(Xt-1);At=$[p]-$[p-1],p++;const ue=u.vertexBufferType===Ta.VEC_2?ep(K,W,R,At):Jm(K,W,R,At,0,D);R+=At;for(let _e=0;_e<pe.length;_e++)At=$[p]-$[p-1],p++,pe[_e]=u.vertexBufferType===Ta.VEC_2?ep(K,W,R,At):Jm(K,W,R,At,0,D),R+=At;ft[It]=x.createPolygon(ue,pe)}r[v++]=x.createMultiPolygon(ft)}else{for(let It=0;It<lt;It++){const Xt=V[o]-V[o-1];o++;const pe=new Array(Xt-1);At=$[p]-$[p-1],p++;const ue=du(K,E,At);E+=2*At;for(let _e=0;_e<pe.length;_e++){const Pe=$[p]-$[p-1];p++,pe[_e]=du(K,E,Pe),E+=2*Pe}ft[It]=x.createPolygon(ue,pe)}r[v++]=x.createMultiPolygon(ft)}}}}return r}function du(u,r,o){return pu(u,r,o,!0)}function ep(u,r,o,p){return xh(u,r,o,p,!0)}function Jm(u,r,o,p,g,v){return tg(u,r,o,p,!0,v)}function pu(u,r,o,p){const g=new Array(p?o+1:o);for(let v=0;v<2*o;v+=2)g[v/2]=new w(u[r+v],u[r+v+1]);return p&&(g[g.length-1]=g[0]),g}function xh(u,r,o,p,g){const v=new Array(g?p+1:p);for(let x=0;x<2*p;x+=2){const E=2*r[o+x/2];v[x/2]=new w(u[E],u[E+1])}return g&&(v[v.length-1]=v[0]),v}function tg(u,r,o,p,g,v){const x=new Array(g?p+1:p);for(let E=0;E<p;E++){const R=Of.decode(u[r[o+E]],v.numBits,v.coordinateShift);x[E]=new w(R.x,R.y)}return g&&(x[x.length-1]=x[0]),x}class ip{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(r,o,p,g,v){this._vertexBufferType=r,this._topologyVector=o,this._vertexOffsets=p,this._vertexBuffer=g,this._mortonSettings=v}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const r=bh(this);let o=0;for(;o<this.numGeometries;)yield{coordinates:r[o],type:this.geometryType(o)},o++}getSimpleEncodedVertex(r){const o=this.vertexOffsets?2*this.vertexOffsets[r]:2*r;return[this.vertexBuffer[o],this.vertexBuffer[o+1]]}getVertex(r){if(this.vertexOffsets&&this.mortonSettings){const p=Of.decode(this.vertexBuffer[this.vertexOffsets[r]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[p.x,p.y]}const o=this.vertexOffsets?2*this.vertexOffsets[r]:2*r;return[this.vertexBuffer[o],this.vertexBuffer[o+1]]}getGeometries(){return bh(this)}get mortonSettings(){return this._mortonSettings}}class wh extends ip{_numGeometries;_geometryType;constructor(r,o,p,g,v,x,E){super(p,g,v,x,E),this._numGeometries=r,this._geometryType=o}static createMortonEncoded(r,o,p,g,v,x){return new wh(r,o,Ta.MORTON,p,g,v,x)}static create(r,o,p,g,v){return new wh(r,o,Ta.VEC_2,p,g,v)}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===nr.POLYGON||this._geometryType===nr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Th extends ip{_geometryTypes;constructor(r,o,p,g,v,x){super(r,p,g,v,x),this._geometryTypes=o}static createMortonEncoded(r,o,p,g,v){return new Th(Ta.MORTON,r,o,p,g,v)}static create(r,o,p,g){return new Th(Ta.VEC_2,r,o,p,g)}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let r=0;r<this.numGeometries;r++)if(this.geometryType(r)===nr.POLYGON||this.geometryType(r)===nr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class np{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(r,o,p,g){this._triangleOffsets=r,this._indexBuffer=o,this._vertexBuffer=p,this._topologyVector=g}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const r=new Array(this.numGeometries),o=this._topologyVector,p=o.partOffsets,g=o.ringOffsets,v=o.geometryOffsets;let x=0,E=1,R=1,D=1;for(let B=0;B<this.numGeometries;B++)switch(this.geometryType(B)){case nr.POLYGON:{const N=p[E]-p[E-1];E++;const V=[];for(let $=0;$<N;$++){const W=g[R]-g[R-1];R++;const Z=[];for(let K=0;K<W;K++){const it=this._vertexBuffer[x++],yt=this._vertexBuffer[x++];Z.push(new w(it,yt))}Z.length>0&&Z.push(Z[0]),V.push(Z)}r[B]=V,v&&D++}break;case nr.MULTIPOLYGON:{const N=v[D]-v[D-1];D++;const V=[];for(let $=0;$<N;$++){const W=p[E]-p[E-1];E++;for(let Z=0;Z<W;Z++){const K=g[R]-g[R-1];R++;const it=[];for(let yt=0;yt<K;yt++){const lt=this._vertexBuffer[x++],ft=this._vertexBuffer[x++];it.push(new w(lt,ft))}it.length>0&&it.push(it[0]),V.push(it)}}r[B]=V}}return r}[Symbol.iterator](){return null}}class rp extends np{_numGeometries;_geometryType;constructor(r,o,p,g,v,x){super(p,g,v,x),this._numGeometries=r,this._geometryType=o}static create(r,o,p,g,v,x){return new rp(r,o,p,g,v,x)}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class sp extends np{_geometryTypes;constructor(r,o,p,g,v){super(o,p,g,v),this._geometryTypes=r}static create(r,o,p,g,v){return new sp(r,o,p,g,v)}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function g0(u,r,o,p,g){const v=Wr.decode(u,o);let x=null,E=null,R=null,D=null,B=null,N=null,V=null,$=null;if(li.getVectorType(v,p,u,o)===pr.CONST){const Z=li.decodeConstIntStream(u,o,v,!1);for(let K=0;K<r-1;K++){const it=Wr.decode(u,o);switch(it.physicalStreamType){case Hr.LENGTH:switch(it.logicalStreamType.lengthType){case Us.GEOMETRIES:x=li.decodeLengthStreamToOffsetBuffer(u,o,it);break;case Us.PARTS:E=li.decodeLengthStreamToOffsetBuffer(u,o,it);break;case Us.RINGS:R=li.decodeLengthStreamToOffsetBuffer(u,o,it);break;case Us.TRIANGLES:V=li.decodeLengthStreamToOffsetBuffer(u,o,it)}break;case Hr.OFFSET:switch(it.logicalStreamType.offsetType){case Ks.VERTEX:D=li.decodeIntStream(u,o,it,!1);break;case Ks.INDEX:$=li.decodeIntStream(u,o,it,!1)}break;case Hr.DATA:if(Fo.VERTEX===it.logicalStreamType.dictionaryType)B=li.decodeIntStream(u,o,it,!0,g);else{const yt=it;N={numBits:yt.numBits(),coordinateShift:yt.coordinateShift()},B=li.decodeIntStream(u,o,it,!1,g)}}}if($!==null){if(x!=null||E!=null){const K=new kf(x,E,R);return rp.create(p,Z,V,$,B,K)}return rp.create(p,Z,V,$,B)}return N===null?wh.create(p,Z,new kf(x,E,R),D,B):wh.createMortonEncoded(p,Z,new kf(x,E,R),D,B,N)}const W=li.decodeIntStream(u,o,v,!1);for(let Z=0;Z<r-1;Z++){const K=Wr.decode(u,o);switch(K.physicalStreamType){case Hr.LENGTH:switch(K.logicalStreamType.lengthType){case Us.GEOMETRIES:x=li.decodeIntStream(u,o,K,!1);break;case Us.PARTS:E=li.decodeIntStream(u,o,K,!1);break;case Us.RINGS:R=li.decodeIntStream(u,o,K,!1);break;case Us.TRIANGLES:V=li.decodeLengthStreamToOffsetBuffer(u,o,K)}break;case Hr.OFFSET:switch(K.logicalStreamType.offsetType){case Ks.VERTEX:D=li.decodeIntStream(u,o,K,!1);break;case Ks.INDEX:$=li.decodeIntStream(u,o,K,!1)}break;case Hr.DATA:if(Fo.VERTEX===K.logicalStreamType.dictionaryType)B=li.decodeIntStream(u,o,K,!0,g);else{const it=K;N={numBits:it.numBits(),coordinateShift:it.coordinateShift()},B=li.decodeIntStream(u,o,K,!1,g)}}}return $!==null&&E===null?sp.create(W,V,$,B):(x!==null?(x=eg(W,x,2),E!==null&&R!==null?(E=Cv(W,x,E,!1),R=(function(Z,K,it,yt){const lt=new Int32Array(it[it.length-1]+1);let ft=0;lt[0]=ft;let At=1,It=1,Xt=0;for(let pe=0;pe<Z.length;pe++){const ue=Z[pe],_e=K[pe+1]-K[pe];if(ue!==0&&ue!==3)for(let Pe=0;Pe<_e;Pe++){const Ae=it[At]-it[At-1];At++;for(let Ee=0;Ee<Ae;Ee++)ft=lt[It++]=ft+yt[Xt++]}else for(let Pe=0;Pe<_e;Pe++)lt[It++]=++ft,At++}return lt})(W,x,E,R)):E!==null&&(E=(function(Z,K,it){const yt=new Int32Array(K[K.length-1]+1);let lt=0;yt[0]=lt;let ft=1,At=0;for(let It=0;It<Z.length;It++){const Xt=Z[It],pe=K[It+1]-K[It];if(Xt===4||Xt===1)for(let ue=0;ue<pe;ue++)lt=yt[ft++]=lt+it[At++];else for(let ue=0;ue<pe;ue++)yt[ft++]=++lt}return yt})(W,x,E))):E!==null&&R!==null?(E=eg(W,E,1),R=Cv(W,E,R,!0)):E!==null&&(E=eg(W,E,0)),$!==null?sp.create(W,V,$,B,new kf(x,E,R)):N===null?Th.create(W,new kf(x,E,R),D,B):Th.createMortonEncoded(W,new kf(x,E,R),D,B,N))}function eg(u,r,o){const p=new Int32Array(u.length+1);let g=0;p[0]=g;let v=0;for(let x=0;x<u.length;x++)g=p[x+1]=g+(u[x]>o?r[v++]:1);return p}function Cv(u,r,o,p){const g=new Int32Array(r[r.length-1]+1);let v=0;g[0]=v;let x=1,E=0;for(let R=0;R<u.length;R++){const D=u[R],B=r[R+1]-r[R];if(D===5||D===2||p&&(D===4||D===1))for(let N=0;N<B;N++)v=g[x++]=v+o[E++];else for(let N=0;N<B;N++)g[x++]=++v}return g}class O_ extends fu{dataVector;constructor(r,o,p){super(r,o.getBuffer(),p),this.dataVector=o}getValueFromBuffer(r){return this.dataVector.get(r)}}class _0 extends Rf{getValueFromBuffer(r){return this.dataBuffer[r]}}class ap extends fu{constructor(r,o,p){super(r,BigInt64Array.of(o),p)}getValueFromBuffer(r){return this.dataBuffer[0]}}function ig(u,r,o){for(let p=0;p<u;p++){const g=Wr.decode(r,o);o.add(g.byteLength)}}function mu(u,r,o){return Mv(u,Math.ceil(r/8),o)}function Mv(u,r,o){const p=new Uint8Array(r);let g=0;for(;g<r;){const v=u[o.increment()];if(v<=127){const x=v+3,E=u[o.increment()],R=g+x;p.fill(E,g,R),g=R}else{const x=256-v;for(let E=0;E<x;E++)p[g++]=u[o.increment()]}}return p}const op=new TextDecoder;function B_(u,r,o){return o-r>=12?op.decode(u.subarray(r,o)):(function(p,g,v){let x="",E=g;for(;E<v;){const R=p[E];let D,B,N,V=null,$=R>239?4:R>223?3:R>191?2:1;if(E+$>v)break;$===1?R<128&&(V=R):$===2?(D=p[E+1],(192&D)==128&&(V=(31&R)<<6|63&D,V<=127&&(V=null))):$===3?(D=p[E+1],B=p[E+2],(192&D)==128&&(192&B)==128&&(V=(15&R)<<12|(63&D)<<6|63&B,(V<=2047||V>=55296&&V<=57343)&&(V=null))):$===4&&(D=p[E+1],B=p[E+2],N=p[E+3],(192&D)==128&&(192&B)==128&&(192&N)==128&&(V=(15&R)<<18|(63&D)<<12|(63&B)<<6|63&N,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,$=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),E+=$}return x})(u,r,o)}class ng extends fu{offsetBuffer;constructor(r,o,p,g){super(r,p,g),this.offsetBuffer=o}}class L_ extends ng{textEncoder;constructor(r,o,p,g){super(r,o,p,g??o.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(r){return B_(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class Sh extends ng{indexBuffer;textEncoder;constructor(r,o,p,g,v){super(r,p,g,v??o.length),this.indexBuffer=o,this.indexBuffer=o,this.textEncoder=new TextEncoder}getValueFromBuffer(r){const o=this.indexBuffer[r];return B_(this.dataBuffer,this.offsetBuffer[o],this.offsetBuffer[o+1])}}class F_ extends ng{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(r,o,p,g,v,x,E){super(r,p,g,E),this.indexBuffer=o,this.symbolOffsetBuffer=v,this.symbolTableBuffer=x,this.textEncoder=new TextEncoder}getValueFromBuffer(r){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(p,g,v){const x=[],E=new Array(g.length).fill(0);for(let R=1;R<g.length;R++)E[R]=E[R-1]+g[R-1];for(let R=0;R<v.length;R++)if(v[R]===255)x.push(v[++R]);else{const D=g[v[R]],B=E[v[R]];for(let N=0;N<D;N++)x.push(p[B+N])}return new Uint8Array(x)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const o=this.indexBuffer[r];return B_(this.decodedDictionary,this.offsetBuffer[o],this.offsetBuffer[o+1])}offsetToLengthBuffer(r){const o=new Uint32Array(r.length-1);let p=r[0];for(let g=1;g<r.length;g++){const v=r[g];o[g-1]=v-p,p=v}return o}}class Ah{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(r,o,p,g,v){let x=null,E=null,R=null,D=null,B=null,N=null,V=null,$=null;for(let W=0;W<g;W++){const Z=Wr.decode(o,p);if(Z.byteLength!==0)switch(Z.physicalStreamType){case Hr.PRESENT:{const K=mu(o,Z.numValues,p);N=new No(K,Z.numValues);break}case Hr.OFFSET:E=v!=null||N!=null?li.decodeNullableIntStream(o,p,Z,!1,v??N):li.decodeIntStream(o,p,Z,!1);break;case Hr.LENGTH:{const K=li.decodeLengthStreamToOffsetBuffer(o,p,Z);Us.DICTIONARY===Z.logicalStreamType.lengthType?x=K:Us.SYMBOL===Z.logicalStreamType.lengthType?D=K:V=K;break}case Hr.DATA:{const K=o.subarray(p.get(),p.get()+Z.byteLength);p.add(Z.byteLength);const it=Z.logicalStreamType.dictionaryType;Fo.FSST===it?B=K:Fo.SINGLE===it||Fo.SHARED===it?R=K:Fo.NONE===it&&($=K);break}}}return this.decodeFsstDictionaryVector(r,B,E,x,R,D,v??N)??this.decodeDictionaryVector(r,R,E,x,v??N)??this.decodePlainStringVector(r,V,$,E,v??N)}static decodeFsstDictionaryVector(r,o,p,g,v,x,E){return o?new F_(r,p,g,v,x,o,E):null}static decodeDictionaryVector(r,o,p,g,v){return o?v?new Sh(r,p,g,o,v):new Sh(r,p,g,o):null}static decodePlainStringVector(r,o,p,g,v){if(!o||!p)return null;if(g)return v?new Sh(r,g,o,p,v):new Sh(r,g,o,p);if(v&&v.size()!==o.length-1){const x=new Int32Array(v.size());let E=0;for(let R=0;R<v.size();R++)x[R]=v.get(R)?E++:0;return new Sh(r,x,o,p,v)}return v?new L_(r,o,p,v):new L_(r,o,p)}static decodeSharedDictionary(r,o,p,g,v){let x=null,E=null,R=null,D=null,B=!1;for(;!B;){const W=Wr.decode(r,o);switch(W.physicalStreamType){case Hr.LENGTH:Us.DICTIONARY===W.logicalStreamType.lengthType?x=li.decodeLengthStreamToOffsetBuffer(r,o,W):R=li.decodeLengthStreamToOffsetBuffer(r,o,W);break;case Hr.DATA:Fo.SINGLE===W.logicalStreamType.dictionaryType||Fo.SHARED===W.logicalStreamType.dictionaryType?(E=r.subarray(o.get(),o.get()+W.byteLength),B=!0):D=r.subarray(o.get(),o.get()+W.byteLength),o.add(W.byteLength)}}const N=p.complexType.children,V=[];let $=0;for(const W of N){const Z=Gn(r,o,1)[0];if(Z==0)continue;const K=`${p.name}${W.name===Ah.ROOT_COLUMN_NAME?"":Ah.NESTED_COLUMN_SEPARATOR+W.name}`;if(v&&!v.has(K)){ig(Z,r,o);continue}if(Z!==2||W.type!=="scalarField"||W.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const it=Wr.decode(r,o),yt=mu(r,it.numValues,o),lt=Wr.decode(r,o),ft=(lt instanceof Al?lt.numRleValues:lt.numValues)!==g?li.decodeNullableIntStream(r,o,lt,!1,new No(yt,it.numValues)):li.decodeIntStream(r,o,lt,!1);V[$++]=D?new F_(K,ft,x,E,R,D,new No(yt,it.numValues)):new Sh(K,ft,x,E,new No(yt,it.numValues))}return V}}function Rv(u,r,o,p,g,v){return o.type==="scalarType"?(function(x,E,R,D,B,N){let V=null,$=0;if(x===0)return null;if(N.nullable){const Z=Wr.decode(E,R);$=Z.numValues;const K=R.get(),it=mu(E,$,R);R.set(K+Z.byteLength),V=new No(it,Z.numValues)}const W=V??D;switch(B.physicalType){case 4:case 3:return(function(Z,K,it,yt,lt){const ft=Wr.decode(Z,K),At=li.getVectorType(ft,lt,Z,K),It=yt.physicalType===3;if(At===pr.FLAT){const Xt=Bf(lt)?li.decodeNullableIntStream(Z,K,ft,It,lt):li.decodeIntStream(Z,K,ft,It);return new Pf(it.name,Xt,lt)}if(At===pr.SEQUENCE){const Xt=li.decodeSequenceIntStream(Z,K,ft);return new Qd(it.name,Xt[0],Xt[1],ft.numRleValues)}{const Xt=li.decodeConstIntStream(Z,K,ft,It);return new Jd(it.name,Xt,lt)}})(E,R,N,B,W);case 9:return Ah.decode(N.name,E,R,N.nullable?x-1:x,V);case 0:return(function(Z,K,it,yt,lt){const ft=Wr.decode(Z,K),At=ft.numValues,It=K.get(),Xt=Bf(lt)?(function(ue,_e,Pe,Ae){const Ee=Mv(ue,Math.ceil(_e/8),Pe),se=new No(Ee,_e),Ye=Ae.size(),Xe=new No(new Uint8Array(Ye),Ye);let Ge=0;for(let Fe=0;Fe<Ae.size();Fe++){const Ti=!!Ae.get(Fe)&&se.get(Ge++);Xe.set(Fe,Ti)}return Xe.getBuffer()})(Z,At,K,lt):mu(Z,At,K);K.set(It+ft.byteLength);const pe=new No(Xt,At);return new O_(it.name,pe,lt)})(E,R,N,0,W);case 6:case 5:return(function(Z,K,it,yt,lt){const ft=Wr.decode(Z,K),At=li.getVectorType(ft,yt,Z,K),It=lt.physicalType===5;if(At===pr.FLAT){const Xt=Bf(yt)?li.decodeNullableLongStream(Z,K,ft,It,yt):li.decodeLongStream(Z,K,ft,It);return new Sv(it.name,Xt,yt)}if(At===pr.SEQUENCE){const Xt=li.decodeSequenceLongStream(Z,K,ft);return new Av(it.name,Xt[0],Xt[1],ft.numRleValues)}{const Xt=li.decodeConstLongStream(Z,K,ft,It);return new ap(it.name,Xt,yt)}})(E,R,N,W,B);case 7:return(function(Z,K,it,yt){const lt=Wr.decode(Z,K),ft=Bf(yt)?(function(At,It,Xt,pe){const ue=It.get(),_e=ue+pe*Float32Array.BYTES_PER_ELEMENT,Pe=new Uint8Array(At.subarray(ue,_e)).buffer,Ae=new Float32Array(Pe);It.set(_e);const Ee=Xt.size(),se=new Float32Array(Ee);let Ye=0;for(let Xe=0;Xe<Ee;Xe++)se[Xe]=Xt.get(Xe)?Ae[Ye++]:0;return se})(Z,K,yt,lt.numValues):(function(At,It,Xt){const pe=It.get(),ue=pe+Xt*Float32Array.BYTES_PER_ELEMENT,_e=new Uint8Array(At.subarray(pe,ue)).buffer,Pe=new Float32Array(_e);return It.set(ue),Pe})(Z,K,lt.numValues);return new _0(it.name,ft,yt)})(E,R,N,W);case 8:return(function(Z,K,it,yt){const lt=Wr.decode(Z,K),ft=Bf(yt)?(function(At,It,Xt,pe){const ue=It.get(),_e=ue+pe*Float64Array.BYTES_PER_ELEMENT,Pe=new Uint8Array(At.subarray(ue,_e)).buffer,Ae=new Float64Array(Pe);It.set(_e);const Ee=Xt.size(),se=new Float64Array(Ee);let Ye=0;for(let Xe=0;Xe<Ee;Xe++)se[Xe]=Xt.get(Xe)?Ae[Ye++]:0;return se})(Z,K,yt,lt.numValues):(function(At,It,Xt){const pe=It.get(),ue=pe+Xt*Float64Array.BYTES_PER_ELEMENT,_e=new Uint8Array(At.subarray(pe,ue)).buffer,Pe=new Float64Array(_e);return It.set(ue),Pe})(Z,K,lt.numValues);return new Gm(it.name,ft,yt)})(E,R,N,W);default:throw new Error(`The specified data type for the field is currently not supported: ${B}`)}})(p,u,r,g,o.scalarType,o):p!=1?null:Ah.decodeSharedDictionary(u,r,o,g,v)}function Bf(u){return u instanceof No}class Eh{static decodeColumnType(r){switch(r){case 0:case 1:case 2:case 3:{const o={};o.nullable=!!(1&r),o.columnScope=0;const p={};return p.physicalType=r>1?6:4,p.type="physicalType",o.scalarType=p,o.type="scalarType",o}case 4:{const o={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:0};return o.type="complexType",o.complexType=p,o}case 30:{const o={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:1};return o.type="complexType",o.complexType=p,o}default:return this.mapScalarType(r)}}static columnTypeHasName(r){return r>=10}static columnTypeHasChildren(r){return r===30}static hasStreamCount(r){if(r.name==="id")return!1;if(r.type==="scalarType"){const o=r.scalarType;if(o.type==="physicalType")switch(o.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(o.type==="logicalType")return!1}else if(r.type==="complexType"){const o=r.complexType;if(o.type==="physicalType")switch(o.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",r),!1}static mapScalarType(r){let o=null;switch(r){case 10:case 11:o=0;break;case 12:case 13:o=1;break;case 14:case 15:o=2;break;case 16:case 17:o=3;break;case 18:case 19:o=4;break;case 20:case 21:o=5;break;case 22:case 23:o=6;break;case 24:case 25:o=7;break;case 26:case 27:o=8;break;case 28:case 29:o=9;break;default:return null}const p={};p.nullable=!!(1&r),p.columnScope=0;const g={type:"physicalType"};return g.physicalType=o,p.type="scalarType",p.scalarType=g,p}}const y0=new TextDecoder;function Pv(u,r){const o=Gn(u,r,1)[0];if(o===0)return"";const p=r.get(),g=u.subarray(p,p+o);return r.add(o),y0.decode(g)}function rg(u,r){const o=Gn(u,r,1)[0]>>>0,p=!!(4&o),g=!!(2&o),v=Gn(u,r,1)[0]>>>0,x={};if(1&o&&(x.nullable=!0),g){const E={};if(p?(E.type="logicalType",E.logicalType=v):(E.type="physicalType",E.physicalType=v),8&o){const R=Gn(u,r,1)[0]>>>0;E.children=new Array(R);for(let D=0;D<R;D++)E.children[D]=rg(u,r)}x.type="complexField",x.complexField=E}else{const E={};p?(E.type="logicalType",E.logicalType=v):(E.type="physicalType",E.physicalType=v),x.type="scalarField",x.scalarField=E}return x}function N_(u,r){const o=Gn(u,r,1)[0]>>>0,p=Eh.decodeColumnType(o);if(!p)throw new Error(`Unsupported column type code: ${o}`);if(Eh.columnTypeHasName(o)?p.name=Pv(u,r):o>=0&&o<=3?p.name="id":o===4&&(p.name="geometry"),Eh.columnTypeHasChildren(o)){const g=Gn(u,r,1)[0]>>>0,v=p.complexType;v.children=new Array(g);for(let x=0;x<g;x++)v.children[x]=rg(u,r)}return p}function sg(u,r){const o={featureTables:[]},p={};p.name=Pv(u,r);const g=Gn(u,r,1)[0]>>>0,v=Gn(u,r,1)[0]>>>0;p.columns=new Array(v);for(let x=0;x<v;x++)p.columns[x]=N_(u,r);return o.featureTables.push(p),[o,g]}function z_(u,r,o,p,g,v,x=!1){const E=r.scalarType.physicalType,R=li.getVectorType(g,v,u,o);if(E===4)switch(R){case pr.FLAT:{const D=li.decodeIntStream(u,o,g,!1);return new Pf(p,D,v)}case pr.SEQUENCE:{const D=li.decodeSequenceIntStream(u,o,g);return new Qd(p,D[0],D[1],g.numRleValues)}case pr.CONST:{const D=li.decodeConstIntStream(u,o,g,!1);return new Jd(p,D,v)}}else switch(R){case pr.FLAT:{if(x){const B=li.decodeLongFloat64Stream(u,o,g,!1);return new Gm(p,B,v)}const D=li.decodeLongStream(u,o,g,!1);return new Sv(p,D,v)}case pr.SEQUENCE:{const D=li.decodeSequenceLongStream(u,o,g);return new Av(p,D[0],D[1],g.numRleValues)}case pr.CONST:{const D=li.decodeConstLongStream(u,o,g,!1);return new ap(p,D,v)}}throw new Error("Vector type not supported for id column.")}class Iv{constructor(r,o){var p;switch(this._featureData=r,this.properties=this._featureData.properties||{},(p=this._featureData.geometry)===null||p===void 0?void 0:p.type){case nr.POINT:case nr.MULTIPOINT:this.type=1;break;case nr.LINESTRING:case nr.MULTILINESTRING:this.type=2;break;case nr.POLYGON:case nr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=o,this.id=Number(this._featureData.id)}projectPoint(r,o,p,g){return[360*(r.x+o)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(r.y+p)/g)*Math.PI))-90]}projectLine(r,o,p,g){return r.map((v=>this.projectPoint(v,o,p,g)))}toGeoJSON(r,o,p){const g=this.extent*Math.pow(2,p),v=this.extent*r,x=this.extent*o,E=this.loadGeometry();let R;switch(this.type){case 1:{const B=[];for(const V of E)B.push(V[0]);const N=this.projectLine(B,v,x,g);R=B.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N};break}case 2:{const B=E.map((N=>this.projectLine(N,v,x,g)));R=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B};break}case 3:{const B=jc(E),N=[];for(const V of B)N.push(V.map(($=>this.projectLine($,v,x,g))));R=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N};break}default:throw new Error(`unknown feature type: ${this.type}`)}const D={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(D.id=this.id),D}loadGeometry(){const r=[];for(const o of this._featureData.geometry.coordinates){const p=[];for(const g of o)p.push(new w(g.x,g.y));r.push(p)}return r}bbox(){return[0,0,0,0]}}class U_{constructor(r){this.features=[],this.featureTable=r,this.name=r.name,this.extent=r.extent,this.version=2,this.features=r.getFeatures(),this.length=this.features.length}feature(r){return new Iv(this.features[r],this.extent)}}class yc{constructor(r){this.layers={};const o=(function(p,g,v=!0){const x=new xv(0),E=[];for(;x.get()<p.length;){const R=Gn(p,x,1)[0]>>>0,D=x.get()+R;if(D>p.length)throw new Error(`Block overruns tile: ${D} > ${p.length}`);if(Gn(p,x,1)[0]>>>0!=1){x.set(D);continue}const B=sg(p,x),N=B[1],V=B[0].featureTables[0];let $=null,W=null;const Z=[];let K=0;for(const yt of V.columns){const lt=yt.name;if(lt==="id"){let ft=null;if(yt.nullable){const It=Wr.decode(p,x),Xt=x.get(),pe=mu(p,It.numValues,x);x.set(Xt+It.byteLength),ft=new No(pe,It.numValues)}const At=Wr.decode(p,x);K=At.getDecompressedCount(),$=z_(p,yt,x,lt,At,ft??K,v)}else if(lt==="geometry"){const ft=Gn(p,x,1)[0];if(K===0){const At=x.get();K=Wr.decode(p,x).getDecompressedCount(),x.set(At)}W=g0(p,ft,x,K,g)}else{const ft=Eh.hasStreamCount(yt)?Gn(p,x,1)[0]:1;if(ft===0&&yt.type==="scalarType")continue;const At=Rv(p,x,yt,ft,K,void 0);At&&(Array.isArray(At)?Z.push(...At):Z.push(At))}}const it=new d0(V.name,W,$,Z,N);E.push(it),x.set(D)}return E})(new Uint8Array(r));this.layers=o.reduce(((p,g)=>Object.assign(Object.assign({},p),{[g.name]:new U_(g)})),{})}}class vc{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new nc(Ue,16,0),this.grid3D=new nc(Ue,16,0),this.featureIndexArray=new ot,this.promoteId=o}insert(r,o,p,g,v,x){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,g,v);const R=x?this.grid3D:this.grid;for(let D=0;D<o.length;D++){const B=o[D],N=[1/0,1/0,-1/0,-1/0];for(let V=0;V<B.length;V++){const $=B[V];N[0]=Math.min(N[0],$.x),N[1]=Math.min(N[1],$.y),N[2]=Math.max(N[2],$.x),N[3]=Math.max(N[3],$.y)}N[0]<Ue&&N[1]<Ue&&N[2]>=0&&N[3]>=0&&R.insert(E,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Vd(new Dm(this.rawTileData)).layers:new yc(this.rawTileData).layers,this.sourceLayerCoder=new I_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,o,p,g){this.loadVTLayers();const v=r.params,x=Ue/r.tileSize/r.scale,E=Ss(v.filter,v.globalState),R=r.queryGeometry,D=r.queryPadding*x,B=_h.fromPoints(R),N=this.grid.query(B.minX-D,B.minY-D,B.maxX+D,B.maxY+D),V=_h.fromPoints(r.cameraQueryGeometry).expandBy(D),$=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,((K,it,yt,lt)=>(function(ft,At,It,Xt,pe){for(const _e of ft)if(At<=_e.x&&It<=_e.y&&Xt>=_e.x&&pe>=_e.y)return!0;const ue=[new w(At,It),new w(At,pe),new w(Xt,pe),new w(Xt,It)];if(ft.length>2){for(const _e of ue)if(er(ft,_e))return!0}for(let _e=0;_e<ft.length-1;_e++)if(Vy(ft[_e],ft[_e+1],ue))return!0;return!1})(r.cameraQueryGeometry,K-D,it-D,yt+D,lt+D)));for(const K of $)N.push(K);N.sort(lp);const W={};let Z;for(let K=0;K<N.length;K++){const it=N[K];if(it===Z)continue;Z=it;const yt=this.featureIndexArray.get(it);let lt=null;this.loadMatchingFeature(W,yt.bucketIndex,yt.sourceLayerIndex,yt.featureIndex,E,v.layers,v.availableImages,o,p,g,((ft,At,It)=>(lt||(lt=Ro(ft)),At.queryIntersectsFeature({queryGeometry:R,feature:ft,featureState:It,geometry:lt,zoom:this.z,transform:r.transform,pixelsToTileUnits:x,pixelPosMatrix:r.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:r.getElevation}))))}return W}loadMatchingFeature(r,o,p,g,v,x,E,R,D,B,N){const V=this.bucketLayerIDs[o];if(x&&!V.some((K=>x.has(K))))return;const $=this.sourceLayerCoder.decode(p),W=this.vtLayers[$].feature(g);if(v.needGeometry){const K=Po(W,!0);if(!v.filter(new Hi(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!v.filter(new Hi(this.tileID.overscaledZ),W))return;const Z=this.getId(W,$);for(let K=0;K<V.length;K++){const it=V[K];if(x&&!x.has(it))continue;const yt=R[it];if(!yt)continue;let lt={};Z&&B&&(lt=B.getState(yt.sourceLayer||"_geojsonTileLayer",Z));const ft=zi({},D[it]);ft.paint=bc(ft.paint,yt.paint,W,lt,E),ft.layout=bc(ft.layout,yt.layout,W,lt,E);const At=!N||N(W,yt,lt);if(!At)continue;const It=new bv(W,this.z,this.x,this.y,Z);It.layer=ft;let Xt=r[it];Xt===void 0&&(Xt=r[it]=[]),Xt.push({featureIndex:g,feature:It,intersectionZ:At})}}lookupSymbolFeatures(r,o,p,g,v,x,E,R){const D={};this.loadVTLayers();const B=Ss(v.filterSpec,v.globalState);for(const N of r)this.loadMatchingFeature(D,p,g,N,B,x,E,R,o);return D}hasLayer(r){for(const o of this.bucketLayerIDs)for(const p of o)if(r===p)return!0;return!1}getId(r,o){var p;let g=r.id;return this.promoteId&&(g=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof g=="boolean"&&(g=Number(g)),g===void 0&&(!((p=r.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(g=Number(r.properties.cluster_id))),g}}function bc(u,r,o,p,g){return Ar(u,((v,x)=>{const E=r instanceof Jc?r.get(x):null;return E&&E.evaluate?E.evaluate(o,p,g):E}))}function lp(u,r){return r-u}function Lf(u,r,o,p,g){const v=[];for(let x=0;x<u.length;x++){const E=u[x];let R;for(let D=0;D<E.length-1;D++){let B=E[D],N=E[D+1];B.x<r&&N.x<r||(B.x<r?B=new w(r,B.y+(r-B.x)/(N.x-B.x)*(N.y-B.y))._round():N.x<r&&(N=new w(r,B.y+(r-B.x)/(N.x-B.x)*(N.y-B.y))._round()),B.y<o&&N.y<o||(B.y<o?B=new w(B.x+(o-B.y)/(N.y-B.y)*(N.x-B.x),o)._round():N.y<o&&(N=new w(B.x+(o-B.y)/(N.y-B.y)*(N.x-B.x),o)._round()),B.x>=p&&N.x>=p||(B.x>=p?B=new w(p,B.y+(p-B.x)/(N.x-B.x)*(N.y-B.y))._round():N.x>=p&&(N=new w(p,B.y+(p-B.x)/(N.x-B.x)*(N.y-B.y))._round()),B.y>=g&&N.y>=g||(B.y>=g?B=new w(B.x+(g-B.y)/(N.y-B.y)*(N.x-B.x),g)._round():N.y>=g&&(N=new w(B.x+(g-B.y)/(N.y-B.y)*(N.x-B.x),g)._round()),R&&B.equals(R[R.length-1])||(R=[B],v.push(R)),R.push(N)))))}}return v}function xc(u,r,o,p,g){switch(r){case 1:return(function(v,x,E,R){const D=[];for(const B of v)for(const N of B){const V=R===0?N.x:N.y;V>=x&&V<=E&&D.push([N])}return D})(u,o,p,g);case 2:return V_(u,o,p,g,!1);case 3:return V_(u,o,p,g,!0)}return[]}function v0(u,r,o,p,g){const v=p===0?cp:b0;let x=[];const E=[];for(let B=0;B<u.length-1;B++){const N=u[B],V=u[B+1],$=p===0?N.x:N.y,W=p===0?V.x:V.y;let Z=!1;$<r?W>r&&x.push(v(N,V,r)):$>o?W<o&&x.push(v(N,V,o)):x.push(N),W<r&&$>=r&&(x.push(v(N,V,r)),Z=!0),W>o&&$<=o&&(x.push(v(N,V,o)),Z=!0),!g&&Z&&(E.push(x),x=[])}const R=u.length-1,D=p===0?u[R].x:u[R].y;return D>=r&&D<=o&&x.push(u[R]),g&&x.length>0&&!x[0].equals(x[x.length-1])&&x.push(new w(x[0].x,x[0].y)),x.length>0&&E.push(x),E}function V_(u,r,o,p,g){const v=[];for(const x of u){const E=v0(x,r,o,p,g);E.length>0&&v.push(...E)}return v}function cp(u,r,o){return new w(o,u.y+(o-u.x)/(r.x-u.x)*(r.y-u.y))}function b0(u,r,o){return new w(u.x+(o-u.y)/(r.y-u.y)*(r.x-u.x),o)}Ie("FeatureIndex",vc,{omit:["rawTileData","sourceLayerCoder"]});class wc extends w{constructor(r,o,p,g){super(r,o),this.angle=p,g!==void 0&&(this.segment=g)}clone(){return new wc(this.x,this.y,this.angle,this.segment)}}function up(u,r,o,p,g){if(r.segment===void 0||o===0)return!0;let v=r,x=r.segment+1,E=0;for(;E>-o/2;){if(x--,x<0)return!1;E-=u[x].dist(v),v=u[x]}E+=u[x].dist(u[x+1]),x++;const R=[];let D=0;for(;E<o/2;){const B=u[x],N=u[x+1];if(!N)return!1;let V=u[x-1].angleTo(B)-B.angleTo(N);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:E,angleDelta:V}),D+=V;E-R[0].distance>p;)D-=R.shift().angleDelta;if(D>g)return!1;x++,E+=B.dist(N)}return!0}function j_(u){let r=0;for(let o=0;o<u.length-1;o++)r+=u[o].dist(u[o+1]);return r}function Dv(u,r,o){return u?.6*r*o:0}function hp(u,r){return Math.max(u?u.right-u.left:0,r?r.right-r.left:0)}function ag(u,r,o,p,g,v){const x=Dv(o,g,v),E=hp(o,p)*v;let R=0;const D=j_(u)/2;for(let B=0;B<u.length-1;B++){const N=u[B],V=u[B+1],$=N.dist(V);if(R+$>D){const W=(D-R)/$,Z=ua.number(N.x,V.x,W),K=ua.number(N.y,V.y,W),it=new wc(Z,K,V.angleTo(N),B);return it._round(),!x||up(u,it,E,x,r)?it:void 0}R+=$}}function kv(u,r,o,p,g,v,x,E,R){const D=Dv(p,v,x),B=hp(p,g),N=B*x,V=u[0].x===0||u[0].x===R||u[0].y===0||u[0].y===R;return r-N<r/4&&(r=N+r/4),Ch(u,V?r/2*E%r:(B/2+2*v)*x*E%r,r,D,o,N,V,!1,R)}function Ch(u,r,o,p,g,v,x,E,R){const D=v/2,B=j_(u);let N=0,V=r-o,$=[];for(let W=0;W<u.length-1;W++){const Z=u[W],K=u[W+1],it=Z.dist(K),yt=K.angleTo(Z);for(;V+o<N+it;){V+=o;const lt=(V-N)/it,ft=ua.number(Z.x,K.x,lt),At=ua.number(Z.y,K.y,lt);if(ft>=0&&ft<R&&At>=0&&At<R&&V-D>=0&&V+D<=B){const It=new wc(ft,At,yt,W);It._round(),p&&!up(u,It,v,p,g)||$.push(It)}}N+=it}return E||$.length||x||($=Ch(u,N/2,o,p,g,v,x,!0,R)),$}function $_(u,r,o,p){const g=[],v=u.image,x=v.pixelRatio,E=v.paddedRect.w-2,R=v.paddedRect.h-2;let D={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const B=v.stretchX||[[0,E]],N=v.stretchY||[[0,R]],V=(se,Ye)=>se+Ye[1]-Ye[0],$=B.reduce(V,0),W=N.reduce(V,0),Z=E-$,K=R-W;let it=0,yt=$,lt=0,ft=W,At=0,It=Z,Xt=0,pe=K;if(v.content&&p){const se=v.content,Ye=se[2]-se[0],Xe=se[3]-se[1];(v.textFitWidth||v.textFitHeight)&&(D=gh(u)),it=Ff(B,0,se[0]),lt=Ff(N,0,se[1]),yt=Ff(B,se[0],se[2]),ft=Ff(N,se[1],se[3]),At=se[0]-it,Xt=se[1]-lt,It=Ye-yt,pe=Xe-ft}const ue=D.x1,_e=D.y1,Pe=D.x2-ue,Ae=D.y2-_e,Ee=(se,Ye,Xe,Ge)=>{const Fe=dp(se.stretch-it,yt,Pe,ue),Ti=og(se.fixed-At,It,se.stretch,$),Yn=dp(Ye.stretch-lt,ft,Ae,_e),Fr=og(Ye.fixed-Xt,pe,Ye.stretch,W),Ps=dp(Xe.stretch-it,yt,Pe,ue),zo=og(Xe.fixed-At,It,Xe.stretch,$),Ea=dp(Ge.stretch-lt,ft,Ae,_e),cs=og(Ge.fixed-Xt,pe,Ge.stretch,W),zn=new w(Fe,Yn),qr=new w(Ps,Yn),us=new w(Ps,Ea),hs=new w(Fe,Ea),Qs=new w(Ti/x,Fr/x),Uo=new w(zo/x,cs/x),Xr=r*Math.PI/180;if(Xr){const Zr=Math.sin(Xr),Gr=Math.cos(Xr),xr=[Gr,-Zr,Zr,Gr];zn._matMult(xr),qr._matMult(xr),hs._matMult(xr),us._matMult(xr)}const Ca=se.stretch+se.fixed,Nr=Ye.stretch+Ye.fixed;return{tl:zn,tr:qr,bl:hs,br:us,tex:{x:v.paddedRect.x+1+Ca,y:v.paddedRect.y+1+Nr,w:Xe.stretch+Xe.fixed-Ca,h:Ge.stretch+Ge.fixed-Nr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qs,pixelOffsetBR:Uo,minFontScaleX:It/x/Pe,minFontScaleY:pe/x/Ae,isSDF:o}};if(p&&(v.stretchX||v.stretchY)){const se=fp(B,Z,$),Ye=fp(N,K,W);for(let Xe=0;Xe<se.length-1;Xe++){const Ge=se[Xe],Fe=se[Xe+1];for(let Ti=0;Ti<Ye.length-1;Ti++)g.push(Ee(Ge,Ye[Ti],Fe,Ye[Ti+1]))}}else g.push(Ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:R+1}));return g}function Ff(u,r,o){let p=0;for(const g of u)p+=Math.max(r,Math.min(o,g[1]))-Math.max(r,Math.min(o,g[0]));return p}function fp(u,r,o){const p=[{fixed:-1,stretch:0}];for(const[g,v]of u){const x=p[p.length-1];p.push({fixed:g-x.stretch,stretch:x.stretch}),p.push({fixed:g-x.stretch,stretch:x.stretch+(v-g)})}return p.push({fixed:r+1,stretch:o}),p}function dp(u,r,o,p){return u/r*o+p}function og(u,r,o,p){return u-r*o/p}Ie("Anchor",wc);class Mh{constructor(r,o,p,g,v,x,E,R,D,B){var N;if(this.boxStartIndex=r.length,D){let V=x.top,$=x.bottom;const W=x.collisionPadding;W&&(V-=W[1],$+=W[3]);let Z=$-V;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const V=!((N=x.image)===null||N===void 0)&&N.content&&(x.image.textFitWidth||x.image.textFitHeight)?gh(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};V.y1=V.y1*E-R[0],V.y2=V.y2*E+R[2],V.x1=V.x1*E-R[3],V.x2=V.x2*E+R[1];const $=x.collisionPadding;if($&&(V.x1-=$[0]*E,V.y1-=$[1]*E,V.x2+=$[2]*E,V.y2+=$[3]*E),B){const W=new w(V.x1,V.y1),Z=new w(V.x2,V.y1),K=new w(V.x1,V.y2),it=new w(V.x2,V.y2),yt=B*Math.PI/180;W._rotate(yt),Z._rotate(yt),K._rotate(yt),it._rotate(yt),V.x1=Math.min(W.x,Z.x,K.x,it.x),V.x2=Math.max(W.x,Z.x,K.x,it.x),V.y1=Math.min(W.y,Z.y,K.y,it.y),V.y2=Math.max(W.y,Z.y,K.y,it.y)}r.emplaceBack(o.x,o.y,V.x1,V.y1,V.x2,V.y2,p,g,v)}this.boxEndIndex=r.length}}class c{constructor(r=[],o=(p,g)=>p<g?-1:p>g?1:0){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:p}=this,g=o[r];for(;r>0;){const v=r-1>>1,x=o[v];if(p(g,x)>=0)break;o[r]=x,r=v}o[r]=g}_down(r){const{data:o,compare:p}=this,g=this.length>>1,v=o[r];for(;r<g;){let x=1+(r<<1);const E=x+1;if(E<this.length&&p(o[E],o[x])<0&&(x=E),p(o[x],v)>=0)break;o[r]=o[x],r=x}o[r]=v}}function d(u,r=1,o=!1){const p=_h.fromPoints(u[0]),g=Math.min(p.width(),p.height());let v=g/2;const x=new c([],y),{minX:E,minY:R,maxX:D,maxY:B}=p;if(g===0)return new w(E,R);for(let $=E;$<D;$+=g)for(let W=R;W<B;W+=g)x.push(new S($+v,W+v,v,u));let N=(function($){let W=0,Z=0,K=0;const it=$[0];for(let yt=0,lt=it.length,ft=lt-1;yt<lt;ft=yt++){const At=it[yt],It=it[ft],Xt=At.x*It.y-It.x*At.y;Z+=(At.x+It.x)*Xt,K+=(At.y+It.y)*Xt,W+=3*Xt}return new S(Z/W,K/W,0,$)})(u),V=x.length;for(;x.length;){const $=x.pop();($.d>N.d||!N.d)&&(N=$,o&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,V)),$.max-N.d<=r||(v=$.h/2,x.push(new S($.p.x-v,$.p.y-v,v,u)),x.push(new S($.p.x+v,$.p.y-v,v,u)),x.push(new S($.p.x-v,$.p.y+v,v,u)),x.push(new S($.p.x+v,$.p.y+v,v,u)),V+=4)}return o&&(console.log(`num probes: ${V}`),console.log(`best distance: ${N.d}`)),N.p}function y(u,r){return r.max-u.max}function S(u,r,o,p){this.p=new w(u,r),this.h=o,this.d=(function(g,v){let x=!1,E=1/0;for(let R=0;R<v.length;R++){const D=v[R];for(let B=0,N=D.length,V=N-1;B<N;V=B++){const $=D[B],W=D[V];$.y>g.y!=W.y>g.y&&g.x<(W.x-$.x)*(g.y-$.y)/(W.y-$.y)+$.x&&(x=!x),E=Math.min(E,fm(g,$,W))}}return(x?1:-1)*Math.sqrt(E)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var I;m.aJ=void 0,(I=m.aJ||(m.aJ={}))[I.center=1]="center",I[I.left=2]="left",I[I.right=3]="right",I[I.top=4]="top",I[I.bottom=5]="bottom",I[I["top-left"]=6]="top-left",I[I["top-right"]=7]="top-right",I[I["bottom-left"]=8]="bottom-left",I[I["bottom-right"]=9]="bottom-right";const F=Number.POSITIVE_INFINITY;function X(u,r){return r[1]!==F?(function(o,p,g){let v=0,x=0;switch(p=Math.abs(p),g=Math.abs(g),o){case"top-right":case"top-left":case"top":x=g-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-g}switch(o){case"top-right":case"bottom-right":case"right":v=-p;break;case"top-left":case"bottom-left":case"left":v=p}return[v,x]})(u,r[0],r[1]):(function(o,p){let g=0,v=0;p<0&&(p=0);const x=p/Math.SQRT2;switch(o){case"top-right":case"top-left":v=x-7;break;case"bottom-right":case"bottom-left":v=7-x;break;case"bottom":v=7-p;break;case"top":v=p-7}switch(o){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=p;break;case"right":g=-p}return[g,v]})(u,r[0])}function st(u,r,o){var p;const g=u.layout,v=(p=g.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(r,{},o);if(v){const E=v.values,R=[];for(let D=0;D<E.length;D+=2){const B=R[D]=E[D],N=E[D+1].map((V=>V*fr));B.startsWith("top")?N[1]-=7:B.startsWith("bottom")&&(N[1]+=7),R[D+1]=N}return new lr(R)}const x=g.get("text-variable-anchor");if(x){let E;E=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(r,{},o)*fr,F]:g.get("text-offset").evaluate(r,{},o).map((D=>D*fr));const R=[];for(const D of x)R.push(D,X(D,E));return new lr(R)}return null}function Rt(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jt(u,r,o,p,g,v,x,E,R,D,B,N){let V=v.textMaxSize.evaluate(r,{});V===void 0&&(V=x);const $=u.layers[0].layout,W=$.get("icon-offset").evaluate(r,{},B),Z=ge(o.horizontal),K=x/24,it=u.tilePixelRatio*K,yt=u.tilePixelRatio*V/24,lt=u.tilePixelRatio*E,ft=u.tilePixelRatio*$.get("symbol-spacing"),At=$.get("text-padding")*u.tilePixelRatio,It=(function(Xe,Ge,Fe,Ti=1){const Yn=Xe.get("icon-padding").evaluate(Ge,{},Fe),Fr=Yn&&Yn.values;return[Fr[0]*Ti,Fr[1]*Ti,Fr[2]*Ti,Fr[3]*Ti]})($,r,B,u.tilePixelRatio),Xt=$.get("text-max-angle")/180*Math.PI,pe=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",ue=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",_e=$.get("symbol-placement"),Pe=ft/2,Ae=$.get("icon-text-fit");let Ee;p&&Ae!=="none"&&(u.allowVerticalPlacement&&o.vertical&&(Ee=Fm(p,o.vertical,Ae,$.get("icon-text-fit-padding"),W,K)),Z&&(p=Fm(p,Z,Ae,$.get("icon-text-fit-padding"),W,K)));const se=B?N.line.getGranularityForZoomLevel(B.z):1,Ye=(Xe,Ge)=>{Ge.x<0||Ge.x>=Ue||Ge.y<0||Ge.y>=Ue||(function(Fe,Ti,Yn,Fr,Ps,zo,Ea,cs,zn,qr,us,hs,Qs,Uo,Xr,Ca,Nr,Zr,Gr,xr,An,Tc,lg,Sc,kR){const cg=Fe.addToLineVertexArray(Ti,Yn);let pp,ug,hg,fg,uT=0,hT=0,fT=0,dT=0,x0=-1,w0=-1;const Rh={};let pT=vr("");if(Fe.allowVerticalPlacement&&Fr.vertical){const Vs=cs.layout.get("text-rotate").evaluate(An,{},Sc)+90;hg=new Mh(zn,Ti,qr,us,hs,Fr.vertical,Qs,Uo,Xr,Vs),Ea&&(fg=new Mh(zn,Ti,qr,us,hs,Ea,Nr,Zr,Xr,Vs))}if(Ps){const Vs=cs.layout.get("icon-rotate").evaluate(An,{}),Vo=cs.layout.get("icon-text-fit")!=="none",mp=$_(Ps,Vs,lg,Vo),Ec=Ea?$_(Ea,Vs,lg,Vo):void 0;ug=new Mh(zn,Ti,qr,us,hs,Ps,Nr,Zr,!1,Vs),uT=4*mp.length;const gp=Fe.iconSizeData;let gu=null;gp.kind==="source"?(gu=[io*cs.layout.get("icon-size").evaluate(An,{})],gu[0]>Tl&&$i(`${Fe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):gp.kind==="composite"&&(gu=[io*Tc.compositeIconSizes[0].evaluate(An,{},Sc),io*Tc.compositeIconSizes[1].evaluate(An,{},Sc)],(gu[0]>Tl||gu[1]>Tl)&&$i(`${Fe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Fe.addSymbols(Fe.icon,mp,gu,xr,Gr,An,m.at.none,Ti,cg.lineStartIndex,cg.lineLength,-1,Sc),x0=Fe.icon.placedSymbolArray.length-1,Ec&&(hT=4*Ec.length,Fe.addSymbols(Fe.icon,Ec,gu,xr,Gr,An,m.at.vertical,Ti,cg.lineStartIndex,cg.lineLength,-1,Sc),w0=Fe.icon.placedSymbolArray.length-1)}const mT=Object.keys(Fr.horizontal);for(const Vs of mT){const Vo=Fr.horizontal[Vs];if(!pp){pT=vr(Vo.text);const Ec=cs.layout.get("text-rotate").evaluate(An,{},Sc);pp=new Mh(zn,Ti,qr,us,hs,Vo,Qs,Uo,Xr,Ec)}const mp=Vo.positionedLines.length===1;if(fT+=oe(Fe,Ti,Vo,zo,cs,Xr,An,Ca,cg,Fr.vertical?m.at.horizontal:m.at.horizontalOnly,mp?mT:[Vs],Rh,x0,Tc,Sc),mp)break}Fr.vertical&&(dT+=oe(Fe,Ti,Fr.vertical,zo,cs,Xr,An,Ca,cg,m.at.vertical,["vertical"],Rh,w0,Tc,Sc));const OR=pp?pp.boxStartIndex:Fe.collisionBoxArray.length,BR=pp?pp.boxEndIndex:Fe.collisionBoxArray.length,LR=hg?hg.boxStartIndex:Fe.collisionBoxArray.length,FR=hg?hg.boxEndIndex:Fe.collisionBoxArray.length,NR=ug?ug.boxStartIndex:Fe.collisionBoxArray.length,zR=ug?ug.boxEndIndex:Fe.collisionBoxArray.length,UR=fg?fg.boxStartIndex:Fe.collisionBoxArray.length,VR=fg?fg.boxEndIndex:Fe.collisionBoxArray.length;let Ac=-1;const Ov=(Vs,Vo)=>Vs&&Vs.circleDiameter?Math.max(Vs.circleDiameter,Vo):Vo;Ac=Ov(pp,Ac),Ac=Ov(hg,Ac),Ac=Ov(ug,Ac),Ac=Ov(fg,Ac);const gT=Ac>-1?1:0;gT&&(Ac*=kR/fr),Fe.glyphOffsetArray.length>=Ef.MAX_GLYPHS&&$i("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),An.sortKey!==void 0&&Fe.addToSortKeyRanges(Fe.symbolInstances.length,An.sortKey);const jR=st(cs,An,Sc),[$R,HR]=(function(Vs,Vo){const mp=Vs.length,Ec=Vo?.values;if(Ec?.length>0)for(let gp=0;gp<Ec.length;gp+=2){const gu=Ec[gp+1];Vs.emplaceBack(m.aJ[Ec[gp]],gu[0],gu[1])}return[mp,Vs.length]})(Fe.textAnchorOffsets,jR);Fe.symbolInstances.emplaceBack(Ti.x,Ti.y,Rh.right>=0?Rh.right:-1,Rh.center>=0?Rh.center:-1,Rh.left>=0?Rh.left:-1,Rh.vertical||-1,x0,w0,pT,OR,BR,LR,FR,NR,zR,UR,VR,qr,fT,dT,uT,hT,gT,0,Qs,Ac,$R,HR)})(u,Ge,Xe,o,p,g,Ee,u.layers[0],u.collisionBoxArray,r.index,r.sourceLayerIndex,u.index,it,[At,At,At,At],pe,R,lt,It,ue,W,r,v,D,B,x)};if(_e==="line")for(const Xe of Lf(r.geometry,0,0,Ue,Ue)){const Ge=br(Xe,se),Fe=kv(Ge,ft,Xt,o.vertical||Z,p,24,yt,u.overscaling,Ue);for(const Ti of Fe)Z&&ee(u,Z.text,Pe,Ti)||Ye(Ge,Ti)}else if(_e==="line-center"){for(const Xe of r.geometry)if(Xe.length>1){const Ge=br(Xe,se),Fe=ag(Ge,Xt,o.vertical||Z,p,24,yt);Fe&&Ye(Ge,Fe)}}else if(r.type==="Polygon")for(const Xe of jc(r.geometry,0)){const Ge=d(Xe,16);Ye(br(Xe[0],se,!0),new wc(Ge.x,Ge.y,0))}else if(r.type==="LineString")for(const Xe of r.geometry){const Ge=br(Xe,se);Ye(Ge,new wc(Ge[0].x,Ge[0].y,0))}else if(r.type==="Point")for(const Xe of r.geometry)for(const Ge of Xe)Ye([Ge],new wc(Ge.x,Ge.y,0))}function oe(u,r,o,p,g,v,x,E,R,D,B,N,V,$,W){const Z=(function(yt,lt,ft,At,It,Xt,pe,ue){const _e=At.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,Pe=[];for(const Ae of lt.positionedLines)for(const Ee of Ae.positionedGlyphs){if(!Ee.rect)continue;const se=Ee.rect||{};let Ye=4,Xe=!0,Ge=1,Fe=0;const Ti=(It||ue)&&Ee.vertical,Yn=Ee.metrics.advance*Ee.scale/2;if(ue&&lt.verticalizable&&(Fe=Ae.lineOffset/2-(Ee.imageName?-(fr-Ee.metrics.width*Ee.scale)/2:(Ee.scale-1)*fr)),Ee.imageName){const Zr=pe[Ee.imageName];Xe=Zr.sdf,Ge=Zr.pixelRatio,Ye=1/Ge}const Fr=It?[Ee.x+Yn,Ee.y]:[0,0];let Ps=It?[0,0]:[Ee.x+Yn+ft[0],Ee.y+ft[1]-Fe],zo=[0,0];Ti&&(zo=Ps,Ps=[0,0]);const Ea=Ee.metrics.isDoubleResolution?2:1,cs=(Ee.metrics.left-Ye)*Ee.scale-Yn+Ps[0],zn=(-Ee.metrics.top-Ye)*Ee.scale+Ps[1],qr=cs+se.w/Ea*Ee.scale/Ge,us=zn+se.h/Ea*Ee.scale/Ge,hs=new w(cs,zn),Qs=new w(qr,zn),Uo=new w(cs,us),Xr=new w(qr,us);if(Ti){const Zr=new w(-Yn,Yn- -17),Gr=-Math.PI/2,xr=12-Yn,An=new w(22-xr,-(Ee.imageName?xr:0)),Tc=new w(...zo);hs._rotateAround(Gr,Zr)._add(An)._add(Tc),Qs._rotateAround(Gr,Zr)._add(An)._add(Tc),Uo._rotateAround(Gr,Zr)._add(An)._add(Tc),Xr._rotateAround(Gr,Zr)._add(An)._add(Tc)}if(_e){const Zr=Math.sin(_e),Gr=Math.cos(_e),xr=[Gr,-Zr,Zr,Gr];hs._matMult(xr),Qs._matMult(xr),Uo._matMult(xr),Xr._matMult(xr)}const Ca=new w(0,0),Nr=new w(0,0);Pe.push({tl:hs,tr:Qs,bl:Uo,br:Xr,tex:se,writingMode:lt.writingMode,glyphOffset:Fr,sectionIndex:Ee.sectionIndex,isSDF:Xe,pixelOffsetTL:Ca,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return Pe})(0,o,E,g,v,x,p,u.allowVerticalPlacement),K=u.textSizeData;let it=null;K.kind==="source"?(it=[io*g.layout.get("text-size").evaluate(x,{})],it[0]>Tl&&$i(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(it=[io*$.compositeTextSizes[0].evaluate(x,{},W),io*$.compositeTextSizes[1].evaluate(x,{},W)],(it[0]>Tl||it[1]>Tl)&&$i(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),u.addSymbols(u.text,Z,it,E,v,x,D,r,R.lineStartIndex,R.lineLength,V,W);for(const yt of B)N[yt]=u.text.placedSymbolArray.length-1;return 4*Z.length}function ge(u){for(const r in u)return u[r];return null}function ee(u,r,o,p){const g=u.compareText;if(r in g){const v=g[r];for(let x=v.length-1;x>=0;x--)if(p.dist(v[x])<o)return!0}else g[r]=[];return g[r].push(p),!1}const re=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $e{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,p]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=p>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const v=re[15&p];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(r,2,1),[E]=new Uint32Array(r,4,1);return new $e(E,x,v,r)}constructor(r,o=64,p=Float64Array,g){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const v=re.indexOf(this.ArrayType),x=2*r*this.ArrayType.BYTES_PER_ELEMENT,E=r*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-E%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${p}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+E+R,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+x+E+R),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+E+R,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=o,p}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return ai(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,p,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:E}=this,R=[0,v.length-1,0],D=[];for(;R.length;){const B=R.pop()||0,N=R.pop()||0,V=R.pop()||0;if(N-V<=E){for(let K=V;K<=N;K++){const it=x[2*K],yt=x[2*K+1];it>=r&&it<=p&&yt>=o&&yt<=g&&D.push(v[K])}continue}const $=V+N>>1,W=x[2*$],Z=x[2*$+1];W>=r&&W<=p&&Z>=o&&Z<=g&&D.push(v[$]),(B===0?r<=W:o<=Z)&&(R.push(V),R.push($-1),R.push(1-B)),(B===0?p>=W:g>=Z)&&(R.push($+1),R.push(N),R.push(1-B))}return D}within(r,o,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:x}=this,E=[0,g.length-1,0],R=[],D=p*p;for(;E.length;){const B=E.pop()||0,N=E.pop()||0,V=E.pop()||0;if(N-V<=x){for(let K=V;K<=N;K++)Qt(v[2*K],v[2*K+1],r,o)<=D&&R.push(g[K]);continue}const $=V+N>>1,W=v[2*$],Z=v[2*$+1];Qt(W,Z,r,o)<=D&&R.push(g[$]),(B===0?r-p<=W:o-p<=Z)&&(E.push(V),E.push($-1),E.push(1-B)),(B===0?r+p>=W:o+p>=Z)&&(E.push($+1),E.push(N),E.push(1-B))}return R}}function ai(u,r,o,p,g,v){if(g-p<=o)return;const x=p+g>>1;un(u,r,x,p,g,v),ai(u,r,o,p,x-1,1-v),ai(u,r,o,x+1,g,1-v)}function un(u,r,o,p,g,v){for(;g>p;){if(g-p>600){const D=g-p+1,B=o-p+1,N=Math.log(D),V=.5*Math.exp(2*N/3),$=.5*Math.sqrt(N*V*(D-V)/D)*(B-D/2<0?-1:1);un(u,r,o,Math.max(p,Math.floor(o-B*V/D+$)),Math.min(g,Math.floor(o+(D-B)*V/D+$)),v)}const x=r[2*o+v];let E=p,R=g;for(Vt(u,r,p,o),r[2*g+v]>x&&Vt(u,r,p,g);E<R;){for(Vt(u,r,E,R),E++,R--;r[2*E+v]<x;)E++;for(;r[2*R+v]>x;)R--}r[2*p+v]===x?Vt(u,r,p,R):(R++,Vt(u,r,R,g)),R<=o&&(p=R+1),o<=R&&(g=R-1)}}function Vt(u,r,o,p){Lt(u,o,p),Lt(r,2*o,2*p),Lt(r,2*o+1,2*p+1)}function Lt(u,r,o){const p=u[r];u[r]=u[o],u[o]=p}function Qt(u,r,o,p){const g=u-o,v=r-p;return g*g+v*v}var de;m.cB=void 0,(de=m.cB||(m.cB={})).create="create",de.load="load",de.fullLoad="fullLoad";let ti=null,Ni=[];const Ze=1e3/60,vi="loadTime",Pi="fullLoadTime",Xi={mark(u){performance.mark(u)},frame(u){const r=u;ti!=null&&Ni.push(r-ti),ti=r},clearMetrics(){ti=null,Ni=[],performance.clearMeasures(vi),performance.clearMeasures(Pi);for(const u in m.cB)performance.clearMarks(m.cB[u])},getPerformanceMetrics(){performance.measure(vi,m.cB.create,m.cB.load),performance.measure(Pi,m.cB.create,m.cB.fullLoad);const u=performance.getEntriesByName(vi)[0].duration,r=performance.getEntriesByName(Pi)[0].duration,o=Ni.length,p=1/(Ni.reduce(((v,x)=>v+x),0)/o/1e3),g=Ni.filter((v=>v>Ze)).reduce(((v,x)=>v+(x-Ze)/Ze),0);return{loadTime:u,fullLoadTime:r,fps:p,percentDroppedFrames:g/(o+g)*100,totalFrames:o}}};m.$=qo,m.A=pt,m.B=Xs,m.C=function([u,r,o]){return r+=90,r*=Math.PI/180,o*=Math.PI/180,{x:u*Math.cos(r)*Math.sin(o),y:u*Math.sin(r)*Math.sin(o),z:u*Math.cos(o)}},m.D=ze,m.E=Ft,m.F=ua,m.G=Hi,m.H=lm,m.I=w_,m.J=function(u){if(wn==null){const r=u.navigator?u.navigator.userAgent:null;wn=!!u.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return wn},m.K=class{constructor(u,r){this.target=u,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new f0((()=>this.process())),this.subscription=Xo(this.target,"message",(o=>this.receive(o)),!1),this.globalScope=$s(self)?u:window}registerMessageHandler(u,r){this.messageHandlers[u]=r}unregisterMessageHandler(u){delete this.messageHandlers[u]}sendAsync(u,r){return new Promise(((o,p)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10),v=r?Xo(r.signal,"abort",(()=>{v?.unsubscribe(),delete this.resolveRejects[g];const R={id:g,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(R)}),yv):null;this.resolveRejects[g]={resolve:R=>{v?.unsubscribe(),o(R)},reject:R=>{v?.unsubscribe(),p(R)}};const x=[],E=Object.assign(Object.assign({},u),{id:g,sourceMapId:this.mapId,origin:location.origin,data:ll(u.data,x)});this.target.postMessage(E,{transfer:x})}))}receive(u){const r=u.data,o=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[o];const p=this.abortControllers[o];return delete this.abortControllers[o],void(p&&p.abort())}if($s(self)||r.mustQueue)return this.tasks[o]=r,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,r)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),r=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(u,r)}processTask(u,r){return l(this,void 0,void 0,(function*(){if(r.type==="<response>"){const g=this.resolveRejects[u];return delete this.resolveRejects[u],g?void(r.error?g.reject(Ka(r.error)):g.resolve(Ka(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=Ka(r.data),p=new AbortController;this.abortControllers[u]=p;try{const g=yield this.messageHandlers[r.type](r.sourceMapId,o,p);this.completeTask(u,null,g)}catch(g){this.completeTask(u,g)}}))}completeTask(u,r,o){const p=[];delete this.abortControllers[u];const g={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?ll(r):null,data:ll(o,p)};this.target.postMessage(g,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.L=Fl,m.M=function(){var u=new pt(16);return pt!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},m.N=function(u,r,o){var p,g,v,x,E,R,D,B,N,V,$,W,Z=o[0],K=o[1],it=o[2];return r===u?(u[12]=r[0]*Z+r[4]*K+r[8]*it+r[12],u[13]=r[1]*Z+r[5]*K+r[9]*it+r[13],u[14]=r[2]*Z+r[6]*K+r[10]*it+r[14],u[15]=r[3]*Z+r[7]*K+r[11]*it+r[15]):(g=r[1],v=r[2],x=r[3],E=r[4],R=r[5],D=r[6],B=r[7],N=r[8],V=r[9],$=r[10],W=r[11],u[0]=p=r[0],u[1]=g,u[2]=v,u[3]=x,u[4]=E,u[5]=R,u[6]=D,u[7]=B,u[8]=N,u[9]=V,u[10]=$,u[11]=W,u[12]=p*Z+E*K+N*it+r[12],u[13]=g*Z+R*K+V*it+r[13],u[14]=v*Z+D*K+$*it+r[14],u[15]=x*Z+B*K+W*it+r[15]),u},m.O=function(u,r,o){var p=o[0],g=o[1],v=o[2];return u[0]=r[0]*p,u[1]=r[1]*p,u[2]=r[2]*p,u[3]=r[3]*p,u[4]=r[4]*g,u[5]=r[5]*g,u[6]=r[6]*g,u[7]=r[7]*g,u[8]=r[8]*v,u[9]=r[9]*v,u[10]=r[10]*v,u[11]=r[11]*v,u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15],u},m.P=w,m.Q=function(u,r,o){var p=r[0],g=r[1],v=r[2],x=r[3],E=r[4],R=r[5],D=r[6],B=r[7],N=r[8],V=r[9],$=r[10],W=r[11],Z=r[12],K=r[13],it=r[14],yt=r[15],lt=o[0],ft=o[1],At=o[2],It=o[3];return u[0]=lt*p+ft*E+At*N+It*Z,u[1]=lt*g+ft*R+At*V+It*K,u[2]=lt*v+ft*D+At*$+It*it,u[3]=lt*x+ft*B+At*W+It*yt,u[4]=(lt=o[4])*p+(ft=o[5])*E+(At=o[6])*N+(It=o[7])*Z,u[5]=lt*g+ft*R+At*V+It*K,u[6]=lt*v+ft*D+At*$+It*it,u[7]=lt*x+ft*B+At*W+It*yt,u[8]=(lt=o[8])*p+(ft=o[9])*E+(At=o[10])*N+(It=o[11])*Z,u[9]=lt*g+ft*R+At*V+It*K,u[10]=lt*v+ft*D+At*$+It*it,u[11]=lt*x+ft*B+At*W+It*yt,u[12]=(lt=o[12])*p+(ft=o[13])*E+(At=o[14])*N+(It=o[15])*Z,u[13]=lt*g+ft*R+At*V+It*K,u[14]=lt*v+ft*D+At*$+It*it,u[15]=lt*x+ft*B+At*W+It*yt,u},m.R=Ms,m.S=function(u,r){const o={};for(let p=0;p<r.length;p++){const g=r[p];g in u&&(o[g]=u[g])}return o},m.T=wm,m.U=Sl,m.V=Je,m.W=qm,m.X=M_,m.Y=J,m.Z=mt,m._=l,m.a=so,m.a$=function(u,r){return u[0]*r[0]+u[1]*r[1]+u[2]*r[2]},m.a0=Ai,m.a1=Yd,m.a2=Xm,m.a3=Ue,m.a4=function(u,r){var o,p,g,v,x;if(!u)return r??{};if(!r)return u;let E=Object.assign({},u);if(r.removeAll&&(E={removeAll:!0}),r.remove){const R=new Set(r.remove);E.add&&(E.add=E.add.filter((B=>!R.has(B.id)))),E.update&&(E.update=E.update.filter((B=>!R.has(B.id))));const D=new Set(((o=u.add)!==null&&o!==void 0?o:[]).map((B=>B.id)));r.remove=r.remove.filter((B=>!D.has(B)))}if(r.remove){const R=new Set(E.remove?E.remove.concat(r.remove):r.remove);E.remove=Array.from(R.values())}if(r.add){const R=E.add?E.add.concat(r.add):r.add,D=new Map(R.map((B=>[B.id,B])));E.add=Array.from(D.values())}if(r.update){const R=new Map((p=E.update)===null||p===void 0?void 0:p.map((D=>[D.id,D])));for(const D of r.update){const B=(g=R.get(D.id))!==null&&g!==void 0?g:{id:D.id};D.newGeometry&&(B.newGeometry=D.newGeometry),D.addOrUpdateProperties&&(B.addOrUpdateProperties=((v=B.addOrUpdateProperties)!==null&&v!==void 0?v:[]).concat(D.addOrUpdateProperties)),D.removeProperties&&(B.removeProperties=((x=B.removeProperties)!==null&&x!==void 0?x:[]).concat(D.removeProperties)),D.removeAllProperties&&(B.removeAllProperties=!0),R.set(D.id,B)}E.update=Array.from(R.values())}return E.remove&&E.add&&(E.remove=E.remove.filter((R=>E.add.findIndex((D=>D.id===R))===-1))),E},m.a5=Kd,m.a6=_h,m.a7=25,m.a8=Zm,m.a9=u=>{const r=window.document.createElement("video");return r.muted=!0,new Promise((o=>{r.onloadstart=()=>{o(r)};for(const p of u){const g=window.document.createElement("source");Q(p)||(r.crossOrigin="Anonymous"),g.src=p,r.appendChild(g)}}))},m.aA=zm,m.aB=Ne,m.aC=function(u,r,o,p){const g=r.y-u.y,v=r.x-u.x,x=p.y-o.y,E=p.x-o.x,R=x*v-E*g;if(R===0)return null;const D=(E*(u.y-o.y)-x*(u.x-o.x))/R;return new w(u.x+D*v,u.y+D*g)},m.aD=Lf,m.aE=r_,m.aF=function(u){let r=1/0,o=1/0,p=-1/0,g=-1/0;for(const v of u)r=Math.min(r,v.x),o=Math.min(o,v.y),p=Math.max(p,v.x),g=Math.max(g,v.y);return[r,o,p,g]},m.aG=fr,m.aH=mi,m.aI=function(u,r,o,p,g=!1){if(!o[0]&&!o[1])return[0,0];const v=g?p==="map"?-u.bearingInRadians:0:p==="viewport"?u.bearingInRadians:0;if(v){const x=Math.sin(v),E=Math.cos(v);o=[o[0]*E-o[1]*x,o[0]*x+o[1]*E]}return[g?o[0]:mi(r,o[0],u.zoom),g?o[1]:mi(r,o[1],u.zoom)]},m.aK=no,m.aL=Rt,m.aM=Ki,m.aN=$e,m.aO=Wi,m.aP=Sm,m.aQ=ct,m.aR=Ve,m.aS=ve,m.aT=_s,m.aU=R_,m.aV=Oe,m.aW=le,m.aX=function(u){var r=new pt(3);return r[0]=u[0],r[1]=u[1],r[2]=u[2],r},m.aY=function(u,r,o){return u[0]=r[0]-o[0],u[1]=r[1]-o[1],u[2]=r[2]-o[2],u},m.aZ=function(u,r){var o=r[0],p=r[1],g=r[2],v=o*o+p*p+g*g;return v>0&&(v=1/Math.sqrt(v)),u[0]=r[0]*v,u[1]=r[1]*v,u[2]=r[2]*v,u},m.a_=Be,m.aa=xe,m.ab=function(){return Ui++},m.ac=A,m.ad=Ef,m.ae=Ss,m.af=Po,m.ag=bv,m.ah=function(u){const r={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((o,p,g,v)=>{const x=g||v;return r[p]=!x||x.toLowerCase(),""})),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r},m.ai=ii,m.aj=85.051129,m.ak=or,m.al=function(u){return Math.pow(2,u)},m.am=kt,m.an=Mf,m.ao=function(u){return Math.log(u)/Math.LN2},m.ap=function(u){var r=u[0],o=u[1];return r*r+o*o},m.aq=class{constructor(u,r){this.max=u,this.onRemove=r,this.reset()}reset(){for(const u in this.data)for(const r of this.data[u])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(u,r,o){const p=u.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:r,timeout:void 0};if(o!==void 0&&(g.timeout=setTimeout((()=>{this.remove(u,g)}),o)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(u){return u.wrapped().key in this.data}getAndRemove(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null}_getAndRemoveByKey(u){const r=this.data[u].shift();return r.timeout&&clearTimeout(r.timeout),this.data[u].length===0&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),r.value}getByKey(u){const r=this.data[u];return r?r[0].value:null}get(u){return this.has(u)?this.data[u.wrapped().key][0].value:null}remove(u,r){if(!this.has(u))return this;const o=u.wrapped().key,p=r===void 0?0:this.data[o].indexOf(r),g=this.data[o][p];return this.data[o].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(g.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(u){for(this.max=u;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(u){const r=[];for(const o in this.data)for(const p of this.data[o])u(p.value)||r.push(p);for(const o of r)this.remove(o.value.tileID,o)}},m.ar=function(u){if(!u.length)return new Set;const r=Math.max(...u.map((R=>R.canonical.z)));let o=1/0,p=-1/0,g=1/0,v=-1/0;const x=[];for(const R of u){const{x:D,y:B,z:N}=R.canonical,V=Math.pow(2,r-N),$=D*V,W=B*V;x.push({id:R,x:$,y:W}),$<o&&(o=$),$>p&&(p=$),W<g&&(g=W),W>v&&(v=W)}const E=new Set;for(const R of x)R.x!==o&&R.x!==p&&R.y!==g&&R.y!==v||E.add(R.id);return E},m.as=function(u,r){let o=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:x}=u,E=g?ii(yr.interpolationFactor(g,r,v,x),0,1):0;u.kind==="camera"?p=ua.number(u.minSize,u.maxSize,E):o=E}return{uSizeT:o,uSize:p}},m.au=function(u,{uSize:r,uSizeT:o},{lowerSize:p,upperSize:g}){return u.kind==="source"?p/io:u.kind==="composite"?ua.number(p/io,g/io,o):r},m.av=function(u,r){var o=r[0],p=r[1],g=r[2],v=r[3],x=r[4],E=r[5],R=r[6],D=r[7],B=r[8],N=r[9],V=r[10],$=r[11],W=r[12],Z=r[13],K=r[14],it=r[15],yt=o*E-p*x,lt=o*R-g*x,ft=o*D-v*x,At=p*R-g*E,It=p*D-v*E,Xt=g*D-v*R,pe=B*Z-N*W,ue=B*K-V*W,_e=B*it-$*W,Pe=N*K-V*Z,Ae=N*it-$*Z,Ee=V*it-$*K,se=yt*Ee-lt*Ae+ft*Pe+At*_e-It*ue+Xt*pe;return se?(u[0]=(E*Ee-R*Ae+D*Pe)*(se=1/se),u[1]=(g*Ae-p*Ee-v*Pe)*se,u[2]=(Z*Xt-K*It+it*At)*se,u[3]=(V*It-N*Xt-$*At)*se,u[4]=(R*_e-x*Ee-D*ue)*se,u[5]=(o*Ee-g*_e+v*ue)*se,u[6]=(K*ft-W*Xt-it*lt)*se,u[7]=(B*Xt-V*ft+$*lt)*se,u[8]=(x*Ae-E*_e+D*pe)*se,u[9]=(p*_e-o*Ae-v*pe)*se,u[10]=(W*It-Z*ft+it*yt)*se,u[11]=(N*ft-B*It-$*yt)*se,u[12]=(E*ue-x*Pe-R*pe)*se,u[13]=(o*Pe-p*ue+g*pe)*se,u[14]=(Z*lt-W*At-K*yt)*se,u[15]=(B*At-N*lt+V*yt)*se,u):null},m.aw=we,m.ax=function(u){var r=u[0],o=u[1];return Math.sqrt(r*r+o*o)},m.ay=function(u){return u[0]=0,u[1]=0,u},m.az=function(u,r,o){return u[0]=r[0]*o,u[1]=r[1]*o,u},m.b=aa,m.b$=function(u,r){var o=Math.sin(r),p=Math.cos(r);return u[0]=p,u[1]=o,u[2]=0,u[3]=-o,u[4]=p,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},m.b0=function(u,r,o){return u[0]=r[0]*o[0],u[1]=r[1]*o[1],u[2]=r[2]*o[2],u[3]=r[3]*o[3],u},m.b1=ae,m.b2=function(u,r,o){const p=r[0]*o[0]+r[1]*o[1]+r[2]*o[2];return p===0?null:(-(u[0]*o[0]+u[1]*o[1]+u[2]*o[2])-o[3])/p},m.b3=ri,m.b4=function(u,r,o){return u[0]=r[0]*o,u[1]=r[1]*o,u[2]=r[2]*o,u[3]=r[3]*o,u},m.b5=function(u,r){return u[0]*r[0]+u[1]*r[1]+u[2]*r[2]+u[3]},m.b6=P_,m.b7=hu,m.b8=function(u,r,o,p,g){var v=1/Math.tan(r/2);if(u[0]=v/o,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=v,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,g!=null&&g!==1/0){var x=1/(p-g);u[10]=(g+p)*x,u[14]=2*g*p*x}else u[10]=-1,u[14]=-2*p;return u},m.b9=function(u){var r=new pt(16);return r[0]=u[0],r[1]=u[1],r[2]=u[2],r[3]=u[3],r[4]=u[4],r[5]=u[5],r[6]=u[6],r[7]=u[7],r[8]=u[8],r[9]=u[9],r[10]=u[10],r[11]=u[11],r[12]=u[12],r[13]=u[13],r[14]=u[14],r[15]=u[15],r},m.bA=function(u,r,o,p){var g=[],v=[];return g[0]=r[0]-o[0],g[1]=r[1]-o[1],g[2]=r[2]-o[2],v[0]=g[0]*Math.cos(p)-g[1]*Math.sin(p),v[1]=g[0]*Math.sin(p)+g[1]*Math.cos(p),v[2]=g[2],u[0]=v[0]+o[0],u[1]=v[1]+o[1],u[2]=v[2]+o[2],u},m.bB=function(u,r,o,p){var g=[],v=[];return g[0]=r[0]-o[0],g[1]=r[1]-o[1],g[2]=r[2]-o[2],v[0]=g[0],v[1]=g[1]*Math.cos(p)-g[2]*Math.sin(p),v[2]=g[1]*Math.sin(p)+g[2]*Math.cos(p),u[0]=v[0]+o[0],u[1]=v[1]+o[1],u[2]=v[2]+o[2],u},m.bC=function(u,r,o,p){var g=[],v=[];return g[0]=r[0]-o[0],g[1]=r[1]-o[1],g[2]=r[2]-o[2],v[0]=g[2]*Math.sin(p)+g[0]*Math.cos(p),v[1]=g[1],v[2]=g[2]*Math.cos(p)-g[0]*Math.sin(p),u[0]=v[0]+o[0],u[1]=v[1]+o[1],u[2]=v[2]+o[2],u},m.bD=function(u,r,o){var p=Math.sin(o),g=Math.cos(o),v=r[0],x=r[1],E=r[2],R=r[3],D=r[8],B=r[9],N=r[10],V=r[11];return r!==u&&(u[4]=r[4],u[5]=r[5],u[6]=r[6],u[7]=r[7],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[0]=v*g-D*p,u[1]=x*g-B*p,u[2]=E*g-N*p,u[3]=R*g-V*p,u[8]=v*p+D*g,u[9]=x*p+B*g,u[10]=E*p+N*g,u[11]=R*p+V*g,u},m.bE=function(u,r){const o=Dt(u,360),p=Dt(r,360),g=p-o,v=p>o?g-360:g+360;return Math.abs(g)<Math.abs(v)?g:v},m.bF=function(u){return u[0]=0,u[1]=0,u[2]=0,u},m.bG=function(u,r,o,p){const g=Math.sqrt(u*u+r*r),v=Math.sqrt(o*o+p*p);u/=g,r/=g,o/=v,p/=v;const x=Math.acos(u*o+r*p);return-r*o+u*p>0?x:-x},m.bH=function(u,r){const o=Dt(u,2*Math.PI),p=Dt(r,2*Math.PI);return Math.min(Math.abs(o-p),Math.abs(o-p+2*Math.PI),Math.abs(o-p-2*Math.PI))},m.bI=function(){const u={},r=ut.$version;for(const o in ut.$root){const p=ut.$root[o];if(p.required){let g=null;g=o==="version"?r:p.type==="array"?[]:{},g!=null&&(u[o]=g)}}return u},m.bJ=yn,m.bK=lf,m.bL=function u(r,o){if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(let p=0;p<r.length;p++)if(!u(r[p],o[p]))return!1;return!0}if(typeof r=="object"&&r!==null&&o!==null){if(typeof o!="object"||Object.keys(r).length!==Object.keys(o).length)return!1;for(const p in r)if(!u(r[p],o[p]))return!1;return!0}return r===o},m.bM=function(u){u=u.slice();const r=Object.create(null);for(let o=0;o<u.length;o++)r[u[o].id]=u[o];for(let o=0;o<u.length;o++)"ref"in u[o]&&(u[o]=Kt(u[o],r[u[o].ref]));return u},m.bN=function(u,r){if(u.type==="custom")return new Zd(u,r);switch(u.type){case"background":return new h0(u,r);case"circle":return new qy(u,r);case"color-relief":return new On(u,r);case"fill":return new Jy(u,r);case"fill-extrusion":return new su(u,r);case"heatmap":return new cc(u,r);case"hillshade":return new Xy(u,r);case"line":return new Pm(u,r);case"raster":return new um(u,r);case"symbol":return new Cf(u,r)}},m.bO=u=>u.type==="raster",m.bP=ar,m.bQ=function(u,r){if(!u)return[{command:"setStyle",args:[r]}];let o=[];try{if(!te(u.version,r.version))return[{command:"setStyle",args:[r]}];te(u.center,r.center)||o.push({command:"setCenter",args:[r.center]}),te(u.state,r.state)||o.push({command:"setGlobalState",args:[r.state]}),te(u.centerAltitude,r.centerAltitude)||o.push({command:"setCenterAltitude",args:[r.centerAltitude]}),te(u.zoom,r.zoom)||o.push({command:"setZoom",args:[r.zoom]}),te(u.bearing,r.bearing)||o.push({command:"setBearing",args:[r.bearing]}),te(u.pitch,r.pitch)||o.push({command:"setPitch",args:[r.pitch]}),te(u.roll,r.roll)||o.push({command:"setRoll",args:[r.roll]}),te(u.sprite,r.sprite)||o.push({command:"setSprite",args:[r.sprite]}),te(u.glyphs,r.glyphs)||o.push({command:"setGlyphs",args:[r.glyphs]}),te(u.transition,r.transition)||o.push({command:"setTransition",args:[r.transition]}),te(u.light,r.light)||o.push({command:"setLight",args:[r.light]}),te(u.terrain,r.terrain)||o.push({command:"setTerrain",args:[r.terrain]}),te(u.sky,r.sky)||o.push({command:"setSky",args:[r.sky]}),te(u.projection,r.projection)||o.push({command:"setProjection",args:[r.projection]});const p={},g=[];(function(x,E,R,D){let B;for(B in E=E||{},x=x||{})Object.prototype.hasOwnProperty.call(x,B)&&(Object.prototype.hasOwnProperty.call(E,B)||He(B,R,D));for(B in E)Object.prototype.hasOwnProperty.call(E,B)&&(Object.prototype.hasOwnProperty.call(x,B)?te(x[B],E[B])||(x[B].type==="geojson"&&E[B].type==="geojson"&&Mn(x,E,B)?ie(R,{command:"setGeoJSONSourceData",args:[B,E[B].data]}):si(B,E,R,D)):De(B,E,R))})(u.sources,r.sources,g,p);const v=[];u.layers&&u.layers.forEach((x=>{"source"in x&&p[x.source]?o.push({command:"removeLayer",args:[x.id]}):v.push(x)})),o=o.concat(g),(function(x,E,R){E=E||[];const D=(x=x||[]).map(Bi),B=E.map(Bi),N=x.reduce(Qi,{}),V=E.reduce(Qi,{}),$=D.slice(),W=Object.create(null);let Z,K,it,yt,lt;for(let ft=0,At=0;ft<D.length;ft++)Z=D[ft],Object.prototype.hasOwnProperty.call(V,Z)?At++:(ie(R,{command:"removeLayer",args:[Z]}),$.splice($.indexOf(Z,At),1));for(let ft=0,At=0;ft<B.length;ft++)Z=B[B.length-1-ft],$[$.length-1-ft]!==Z&&(Object.prototype.hasOwnProperty.call(N,Z)?(ie(R,{command:"removeLayer",args:[Z]}),$.splice($.lastIndexOf(Z,$.length-At),1)):At++,yt=$[$.length-ft],ie(R,{command:"addLayer",args:[V[Z],yt]}),$.splice($.length-ft,0,Z),W[Z]=!0);for(let ft=0;ft<B.length;ft++)if(Z=B[ft],K=N[Z],it=V[Z],!W[Z]&&!te(K,it))if(te(K.source,it.source)&&te(K["source-layer"],it["source-layer"])&&te(K.type,it.type)){for(lt in gi(K.layout,it.layout,R,Z,null,"setLayoutProperty"),gi(K.paint,it.paint,R,Z,null,"setPaintProperty"),te(K.filter,it.filter)||ie(R,{command:"setFilter",args:[Z,it.filter]}),te(K.minzoom,it.minzoom)&&te(K.maxzoom,it.maxzoom)||ie(R,{command:"setLayerZoomRange",args:[Z,it.minzoom,it.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?gi(K[lt],it[lt],R,Z,lt.slice(6),"setPaintProperty"):te(K[lt],it[lt])||ie(R,{command:"setLayerProperty",args:[Z,lt,it[lt]]}));for(lt in it)Object.prototype.hasOwnProperty.call(it,lt)&&!Object.prototype.hasOwnProperty.call(K,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?gi(K[lt],it[lt],R,Z,lt.slice(6),"setPaintProperty"):te(K[lt],it[lt])||ie(R,{command:"setLayerProperty",args:[Z,lt,it[lt]]}))}else ie(R,{command:"removeLayer",args:[Z]}),yt=$[$.lastIndexOf(Z)+1],ie(R,{command:"addLayer",args:[it,yt]})})(v,r.layers,o)}catch(p){console.warn("Unable to compute style diff:",p),o=[{command:"setStyle",args:[r]}]}return o},m.bR=function(u){const r=[],o=u.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),u.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},m.bS=Ar,m.bT=gs,m.bU=class extends Fs{constructor(u,r){super(u,r),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},m.bV=Cs,m.bW=class extends Fs{constructor(u,r){super(u,r),this.current=Eo}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let r=1;r<16;r++)if(u[r]!==this.current[r]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},m.bX=Ao,m.bY=class extends Fs{constructor(u,r){super(u,r),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},m.bZ=class extends Fs{constructor(u,r){super(u,r),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},m.b_=Pt,m.ba=function(u,r,o){var p=Math.sin(o),g=Math.cos(o),v=r[0],x=r[1],E=r[2],R=r[3],D=r[4],B=r[5],N=r[6],V=r[7];return r!==u&&(u[8]=r[8],u[9]=r[9],u[10]=r[10],u[11]=r[11],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[0]=v*g+D*p,u[1]=x*g+B*p,u[2]=E*g+N*p,u[3]=R*g+V*p,u[4]=D*g-v*p,u[5]=B*g-x*p,u[6]=N*g-E*p,u[7]=V*g-R*p,u},m.bb=function(u,r,o){var p=Math.sin(o),g=Math.cos(o),v=r[4],x=r[5],E=r[6],R=r[7],D=r[8],B=r[9],N=r[10],V=r[11];return r!==u&&(u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[3],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[4]=v*g+D*p,u[5]=x*g+B*p,u[6]=E*g+N*p,u[7]=R*g+V*p,u[8]=D*g-v*p,u[9]=B*g-x*p,u[10]=N*g-E*p,u[11]=V*g-R*p,u},m.bc=function(){const u=new Float32Array(16);return kt(u),u},m.bd=function(){const u=new Float64Array(16);return kt(u),u},m.be=function(){return new Float64Array(16)},m.bf=function(u,r,o){const p=new Float64Array(4);return ne(p,u,r-90,o),p},m.bg=function(u,r,o,p){var g,v,x,E,R,D=r[0],B=r[1],N=r[2],V=r[3],$=o[0],W=o[1],Z=o[2],K=o[3];return(v=D*$+B*W+N*Z+V*K)<0&&(v=-v,$=-$,W=-W,Z=-Z,K=-K),1-v>Mt?(g=Math.acos(v),x=Math.sin(g),E=Math.sin((1-p)*g)/x,R=Math.sin(p*g)/x):(E=1-p,R=p),u[0]=E*D+R*$,u[1]=E*B+R*W,u[2]=E*N+R*Z,u[3]=E*V+R*K,u},m.bh=function(u){const r=new Float64Array(9);var o,p,g,v,x,E,R,D,B,N,V,$,W,Z,K,it,yt,lt;N=(g=(p=u)[0])*(R=g+g),V=(v=p[1])*R,W=(x=p[2])*R,Z=x*(D=v+v),it=(E=p[3])*R,yt=E*D,lt=E*(B=x+x),(o=r)[0]=1-($=v*D)-(K=x*B),o[3]=V-lt,o[6]=W+yt,o[1]=V+lt,o[4]=1-N-K,o[7]=Z-it,o[2]=W-yt,o[5]=Z+it,o[8]=1-N-$;const ft=_s(-Math.asin(ii(r[2],-1,1)));let At,It;return Math.hypot(r[5],r[8])<.001?(At=0,It=-_s(Math.atan2(r[3],r[4]))):(At=_s(r[5]===0&&r[8]===0?0:Math.atan2(r[5],r[8])),It=_s(r[1]===0&&r[0]===0?0:Math.atan2(r[1],r[0]))),{roll:At,pitch:ft+90,bearing:It}},m.bi=function(u,r){return u.roll==r.roll&&u.pitch==r.pitch&&u.bearing==r.bearing},m.bj=bi,m.bk=ml,m.bl=hc,m.bm=$r,m.bn=uh,m.bo=he,m.bp=Ce,m.bq=_r,m.br=function(u,r,o,p,g){return he(p,g,ii((u-r)/(o-r),0,1))},m.bs=Dt,m.bt=function(){return new Float64Array(3)},m.bu=function(u,r,o,p){return u[0]=r[0]+o[0]*p,u[1]=r[1]+o[1]*p,u[2]=r[2]+o[2]*p,u},m.bv=ne,m.bw=function(u,r,o){var p=o[0],g=o[1],v=o[2],x=o[3],E=r[0],R=r[1],D=r[2],B=g*D-v*R,N=v*E-p*D,V=p*R-g*E;return u[0]=E+x*(B+=B)+g*(V+=V)-v*(N+=N),u[1]=R+x*N+v*B-p*V,u[2]=D+x*V+p*N-g*B,u},m.bx=function(u,r,o){const p=(g=[u[0],u[1],u[2],r[0],r[1],r[2],o[0],o[1],o[2]])[0]*((B=g[8])*(x=g[4])-(E=g[5])*(D=g[7]))+g[1]*(-B*(v=g[3])+E*(R=g[6]))+g[2]*(D*v-x*R);var g,v,x,E,R,D,B;if(p===0)return null;const N=Be([],[r[0],r[1],r[2]],[o[0],o[1],o[2]]),V=Be([],[o[0],o[1],o[2]],[u[0],u[1],u[2]]),$=Be([],[u[0],u[1],u[2]],[r[0],r[1],r[2]]),W=Oe([],N,-u[3]);return le(W,W,Oe([],V,-r[3])),le(W,W,Oe([],$,-o[3])),Oe(W,W,1/p),W},m.by=Ci,m.bz=function(){return new Float64Array(4)},m.c=Bc,m.c$=function(u,r){const o=new Map;if(u!=null)if(u.type==="Feature")o.set(dr(u,r),u);else for(const p of u.features)o.set(dr(p,r),p);return o},m.c0=function(u,r,o){var p=r[0],g=r[1],v=r[2];return u[0]=p*o[0]+g*o[3]+v*o[6],u[1]=p*o[1]+g*o[4]+v*o[7],u[2]=p*o[2]+g*o[5]+v*o[8],u},m.c1=function(u,r,o,p,g,v,x){var E=1/(r-o),R=1/(p-g),D=1/(v-x);return u[0]=-2*E,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*R,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*D,u[11]=0,u[12]=(r+o)*E,u[13]=(g+p)*R,u[14]=(x+v)*D,u[15]=1,u},m.c2=class extends Fs{constructor(u,r){super(u,r),this.current=new Array}set(u){if(u!=this.current){this.current=u;const r=new Float32Array(4*u.length);for(let o=0;o<u.length;o++)r[4*o]=u[o].r,r[4*o+1]=u[o].g,r[4*o+2]=u[o].b,r[4*o+3]=u[o].a;this.gl.uniform4fv(this.location,r)}}},m.c3=class extends Fs{constructor(u,r){super(u,r),this.current=new Array}set(u){if(u!=this.current){this.current=u;const r=new Float32Array(u);this.gl.uniform1fv(this.location,r)}}},m.c4=class extends pf{},m.c5=dc,m.c6=class extends pl{},m.c7=bm,m.c8=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},m.c9=vm,m.cA=Xi,m.cC=function(u){return u.message===Da},m.cD=ts,m.cE=function(u,r){so.REGISTERED_PROTOCOLS[u]=r},m.cF=function(u){delete so.REGISTERED_PROTOCOLS[u]},m.cG=function(u,r){const o={};for(let g=0;g<u.length;g++){const v=r&&r[u[g].id]||Ri(u[g]);r&&(r[u[g].id]=v);let x=o[v];x||(x=o[v]=[]),x.push(u[g])}const p=[];for(const g in o)p.push(o[g]);return p},m.cH=Ie,m.cI=I_,m.cJ=vc,m.cK=uv,m.cL=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Ue/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const r=u.bucket.layers[0],o=r.layout,p=r._unevaluatedLayout._values,g={layoutIconSize:p["icon-size"].possiblyEvaluate(new Hi(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Hi(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Hi(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:B}=u.bucket.textSizeData;g.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Hi(D),u.canonical),p["text-size"].possiblyEvaluate(new Hi(B),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:B}=u.bucket.iconSizeData;g.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Hi(D),u.canonical),p["icon-size"].possiblyEvaluate(new Hi(B),u.canonical)]}const v=o.get("text-line-height")*fr,x=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",E=o.get("text-keep-upright"),R=o.get("text-size");for(const D of u.bucket.features){const B=o.get("text-font").evaluate(D,{},u.canonical).join(","),N=R.evaluate(D,{},u.canonical),V=g.layoutTextSize.evaluate(D,{},u.canonical),$=g.layoutIconSize.evaluate(D,{},u.canonical),W={horizontal:{},vertical:void 0},Z=D.text;let K,it=[0,0];if(Z){const ft=Z.toString(),At=o.get("text-letter-spacing").evaluate(D,{},u.canonical)*fr,It=uf(ft)?At:0,Xt=o.get("text-anchor").evaluate(D,{},u.canonical),pe=st(r,D,u.canonical);if(!pe){const Ae=o.get("text-radial-offset").evaluate(D,{},u.canonical);it=Ae?X(Xt,[Ae*fr,F]):o.get("text-offset").evaluate(D,{},u.canonical).map((Ee=>Ee*fr))}let ue=x?"center":o.get("text-justify").evaluate(D,{},u.canonical);const _e=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(D,{},u.canonical)*fr:1/0,Pe=()=>{u.bucket.allowVerticalPlacement&&cf(ft)&&(W.vertical=mh(Z,u.glyphMap,u.glyphPositions,u.imagePositions,B,_e,v,Xt,"left",It,it,m.at.vertical,!0,V,N))};if(!x&&pe){const Ae=new Set;if(ue==="auto")for(let se=0;se<pe.values.length;se+=2)Ae.add(Rt(pe.values[se]));else Ae.add(ue);let Ee=!1;for(const se of Ae)if(!W.horizontal[se])if(Ee)W.horizontal[se]=W.horizontal[0];else{const Ye=mh(Z,u.glyphMap,u.glyphPositions,u.imagePositions,B,_e,v,"center",se,It,it,m.at.horizontal,!1,V,N);Ye&&(W.horizontal[se]=Ye,Ee=Ye.positionedLines.length===1)}Pe()}else{ue==="auto"&&(ue=Rt(Xt));const Ae=mh(Z,u.glyphMap,u.glyphPositions,u.imagePositions,B,_e,v,Xt,ue,It,it,m.at.horizontal,!1,V,N);Ae&&(W.horizontal[ue]=Ae),Pe(),cf(ft)&&x&&E&&(W.vertical=mh(Z,u.glyphMap,u.glyphPositions,u.imagePositions,B,_e,v,Xt,ue,It,it,m.at.vertical,!1,V,N))}}let yt=!1;if(D.icon&&D.icon.name){const ft=u.imageMap[D.icon.name];ft&&(K=Lm(u.imagePositions[D.icon.name],o.get("icon-offset").evaluate(D,{},u.canonical),o.get("icon-anchor").evaluate(D,{},u.canonical)),yt=!!ft.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=yt:u.bucket.sdfIcons!==yt&&$i("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ft.pixelRatio!==u.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const lt=ge(W.horizontal)||W.vertical;u.bucket.iconsInText=!!lt&&lt.iconsInText,(lt||K)&&Jt(u.bucket,D,W,K,u.imageMap,g,V,$,it,yt,u.canonical,u.subdivisionGranularity)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},m.cM=ko,m.cN=ji,m.cO=ou,m.cP=wf,m.cQ=Dm,m.cR=Bo,m.cS=function(u,r,o,p,g,v){let x=xc(u,r,o,g,0);return x=xc(x,r,p,v,1),x},m.cT=class{constructor(u){this.maxEntries=u,this.map=new Map}get(u){const r=this.map.get(u);return r!==void 0&&(this.map.delete(u),this.map.set(u,r)),r}set(u,r){if(this.map.has(u))this.map.delete(u);else if(this.map.size>=this.maxEntries){const o=this.map.keys().next().value;this.map.delete(o)}this.map.set(u,r)}clear(){this.map.clear()}},m.cU=Vd,m.cV=yc,m.cW=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},m.cX=function(u,r,o,p,g){return l(this,void 0,void 0,(function*(){if(mt())try{return yield qo(u,r,o,p,g)}catch{}return(function(v,x,E,R,D){const B=v.width,N=v.height;Pa&&Ia||(Pa=new OffscreenCanvas(B,N),Ia=Pa.getContext("2d",{willReadFrequently:!0})),Pa.width=B,Pa.height=N,Ia.drawImage(v,0,0,B,N);const V=Ia.getImageData(x,E,R,D);return Ia.clearRect(0,0,B,N),V.data})(u,r,o,p,g)}))},m.cY=Od,m.cZ=C,m.c_=Xc,m.ca=function(u,r,o){var p=r[0],g=r[1],v=r[2],x=o[3]*p+o[7]*g+o[11]*v+o[15];return u[0]=(o[0]*p+o[4]*g+o[8]*v+o[12])/(x=x||1),u[1]=(o[1]*p+o[5]*g+o[9]*v+o[13])/x,u[2]=(o[2]*p+o[6]*g+o[10]*v+o[14])/x,u},m.cb=class extends Dn{},m.cc=class extends h{},m.cd=function(u,r){return u[0]===r[0]&&u[1]===r[1]&&u[2]===r[2]&&u[3]===r[3]&&u[4]===r[4]&&u[5]===r[5]&&u[6]===r[6]&&u[7]===r[7]&&u[8]===r[8]&&u[9]===r[9]&&u[10]===r[10]&&u[11]===r[11]&&u[12]===r[12]&&u[13]===r[13]&&u[14]===r[14]&&u[15]===r[15]},m.ce=function(u,r){var o=u[0],p=u[1],g=u[2],v=u[3],x=u[4],E=u[5],R=u[6],D=u[7],B=u[8],N=u[9],V=u[10],$=u[11],W=u[12],Z=u[13],K=u[14],it=u[15],yt=r[0],lt=r[1],ft=r[2],At=r[3],It=r[4],Xt=r[5],pe=r[6],ue=r[7],_e=r[8],Pe=r[9],Ae=r[10],Ee=r[11],se=r[12],Ye=r[13],Xe=r[14],Ge=r[15];return Math.abs(o-yt)<=Mt*Math.max(1,Math.abs(o),Math.abs(yt))&&Math.abs(p-lt)<=Mt*Math.max(1,Math.abs(p),Math.abs(lt))&&Math.abs(g-ft)<=Mt*Math.max(1,Math.abs(g),Math.abs(ft))&&Math.abs(v-At)<=Mt*Math.max(1,Math.abs(v),Math.abs(At))&&Math.abs(x-It)<=Mt*Math.max(1,Math.abs(x),Math.abs(It))&&Math.abs(E-Xt)<=Mt*Math.max(1,Math.abs(E),Math.abs(Xt))&&Math.abs(R-pe)<=Mt*Math.max(1,Math.abs(R),Math.abs(pe))&&Math.abs(D-ue)<=Mt*Math.max(1,Math.abs(D),Math.abs(ue))&&Math.abs(B-_e)<=Mt*Math.max(1,Math.abs(B),Math.abs(_e))&&Math.abs(N-Pe)<=Mt*Math.max(1,Math.abs(N),Math.abs(Pe))&&Math.abs(V-Ae)<=Mt*Math.max(1,Math.abs(V),Math.abs(Ae))&&Math.abs($-Ee)<=Mt*Math.max(1,Math.abs($),Math.abs(Ee))&&Math.abs(W-se)<=Mt*Math.max(1,Math.abs(W),Math.abs(se))&&Math.abs(Z-Ye)<=Mt*Math.max(1,Math.abs(Z),Math.abs(Ye))&&Math.abs(K-Xe)<=Mt*Math.max(1,Math.abs(K),Math.abs(Xe))&&Math.abs(it-Ge)<=Mt*Math.max(1,Math.abs(it),Math.abs(Ge))},m.cf=function(u,r){return u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[3],u[4]=r[4],u[5]=r[5],u[6]=r[6],u[7]=r[7],u[8]=r[8],u[9]=r[9],u[10]=r[10],u[11]=r[11],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15],u},m.cg=u=>u.type==="symbol",m.ch=u=>u.type==="circle",m.ci=u=>u.type==="heatmap",m.cj=u=>u.type==="line",m.ck=u=>u.type==="fill",m.cl=u=>u.type==="fill-extrusion",m.cm=u=>u.type==="hillshade",m.cn=u=>u.type==="color-relief",m.co=u=>u.type==="background",m.cp=u=>u.type==="custom",m.cq=Me,m.cr=function(u,r,o){const p=ye(r.x-o.x,r.y-o.y),g=ye(u.x-o.x,u.y-o.y);var v,x;return _s(Math.atan2(p[0]*g[1]-p[1]*g[0],(v=p)[0]*(x=g)[0]+v[1]*x[1]))},m.cs=ei,m.ct=function(u,r){return Oc[r]&&(u instanceof MouseEvent||u instanceof WheelEvent)},m.cu=function(u,r){return kc[r]&&"touches"in u},m.cv=function(u){return kc[u]||Oc[u]},m.cw=function(u,r,o){var p=r[0],g=r[1];return u[0]=o[0]*p+o[4]*g+o[12],u[1]=o[1]*p+o[5]*g+o[13],u},m.cx=function(u,r){const{x:o,y:p}=Kd.fromLngLat(r);return!(u<0||u>25||p<0||p>=1||o<0||o>=1)},m.cy=function(u,r){return u[0]=r[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=r[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=r[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},m.cz=class extends Vi{},m.d=Q,m.d0=function(u,r){if(u==null)return!0;if(u.type==="Feature")return dr(u,r)!=null;if(u.type==="FeatureCollection"){const o=new Set;for(const p of u.features){const g=dr(p,r);if(g==null||o.has(g))return!1;o.add(g)}return!0}return!1},m.d1=function(u,r,o){var p,g,v,x;if(r.removeAll&&u.clear(),r.remove)for(const E of r.remove)u.delete(E);if(r.add)for(const E of r.add){const R=dr(E,o);R!=null&&u.set(R,E)}if(r.update)for(const E of r.update){let R=u.get(E.id);if(R==null)continue;const D=!E.removeAllProperties&&(((p=E.removeProperties)===null||p===void 0?void 0:p.length)>0||((g=E.addOrUpdateProperties)===null||g===void 0?void 0:g.length)>0);if((E.newGeometry||E.removeAllProperties||D)&&(R=Object.assign({},R),u.set(E.id,R),D&&(R.properties=Object.assign({},R.properties))),E.newGeometry&&(R.geometry=E.newGeometry),E.removeAllProperties)R.properties={};else if(((v=E.removeProperties)===null||v===void 0?void 0:v.length)>0)for(const B of E.removeProperties)Object.prototype.hasOwnProperty.call(R.properties,B)&&delete R.properties[B];if(((x=E.addOrUpdateProperties)===null||x===void 0?void 0:x.length)>0)for(const{key:B,value:N}of E.addOrUpdateProperties)R.properties[B]=N}},m.d2=jr,m.e=zi,m.f=u=>l(void 0,void 0,void 0,(function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(r)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),m.g=Lc,m.h=u=>new Promise(((r,o)=>{const p=new Image;p.onload=()=>{r(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=Hs}))},p.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(g):Hs})),m.i=$s,m.j=(u,r)=>Ct(zi(u,{type:"json"}),r),m.k=wt,m.l=bt,m.m=Ct,m.n=(u,r)=>Ct(zi(u,{type:"arrayBuffer"}),r),m.o=function(u){return new Dm(u).readFields(lv,[])},m.p=cv,m.q=function(u){return/[\u1100-\u11FF\u3000-\u30FF\u3131-\u318E\u31F0-\u321E\u3260-\u327E\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFF\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFF00-\uFFEF]|\uD81B[\uDFE4\uDFF2-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(u))},m.r=lh,m.s=Xo,m.t=Ir,m.u=ut,m.v=Ga,m.w=$i,m.x=ac,m.y=n_,m.z=Ya})),a("worker",["./shared"],(function(m){class l{constructor(Q,tt){this.keyCache={},Q&&this.replace(Q,tt)}replace(Q,tt){this._layerConfigs={},this._layers={},this.update(Q,[],tt)}update(Q,tt,rt){for(const wt of Q){this._layerConfigs[wt.id]=wt;const Ft=this._layers[wt.id]=m.bN(wt,rt);Ft._featureFilter=m.ae(Ft.filter,rt),this.keyCache[wt.id]&&delete this.keyCache[wt.id]}for(const wt of tt)delete this.keyCache[wt],delete this._layerConfigs[wt],delete this._layers[wt];this.familiesBySource={};const bt=m.cG(Object.values(this._layerConfigs),this.keyCache);for(const wt of bt){const Ft=wt.map((De=>this._layers[De.id])),ut=Ft[0];if(ut.visibility==="none")continue;const Ot=ut.source||"";let Kt=this.familiesBySource[Ot];Kt||(Kt=this.familiesBySource[Ot]={});const te=ut.sourceLayer||"_geojsonTileLayer";let ie=Kt[te];ie||(ie=Kt[te]=[]),ie.push(Ft)}}}class w{constructor(Q){const tt={},rt=[];for(const ut in Q){const Ot=Q[ut],Kt=tt[ut]={};for(const te in Ot){const ie=Ot[+te];if(!ie||ie.bitmap.width===0||ie.bitmap.height===0)continue;const De={x:0,y:0,w:ie.bitmap.width+2,h:ie.bitmap.height+2};rt.push(De),Kt[te]={rect:De,metrics:ie.metrics}}}const{w:bt,h:wt}=m.p(rt),Ft=new m.r({width:bt||1,height:wt||1});for(const ut in Q){const Ot=Q[ut];for(const Kt in Ot){const te=Ot[+Kt];if(!te||te.bitmap.width===0||te.bitmap.height===0)continue;const ie=tt[ut][Kt].rect;m.r.copy(te.bitmap,Ft,{x:0,y:0},{x:ie.x+1,y:ie.y+1},te.bitmap)}}this.image=Ft,this.positions=tt}}m.cH("GlyphAtlas",w);class C{constructor(Q){this.tileID=new m.a0(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[]}parse(Q,tt,rt,bt,wt){return m._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Q,this.collisionBoxArray=new m.ac;const Ft=new m.cI(Object.keys(Q.layers).sort()),ut=new m.cJ(this.tileID,this.promoteId);ut.bucketLayerIDs=[];const Ot={},Kt={featureIndex:ut,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:rt,subdivisionGranularity:wt},te=tt.familiesBySource[this.source];for(const Re in te){const We=Q.layers[Re];if(!We)continue;We.version===1&&m.w(`Vector tile source "${this.source}" layer "${Re}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ur=Ft.encode(Re),Nl=[];for(let gr=0;gr<We.length;gr++){const ni=We.feature(gr),ks=ut.getId(ni,Re);Nl.push({feature:ni,id:ks,index:gr,sourceLayerIndex:Ur})}for(const gr of te[Re]){const ni=gr[0];ni.source!==this.source&&m.w(`layer.source = ${ni.source} does not equal this.source = ${this.source}`),ni.isHidden(this.zoom,!0)||(P(gr,this.zoom,rt),(Ot[ni.id]=ni.createBucket({index:ut.bucketLayerIDs.length,layers:gr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ur,sourceID:this.source})).populate(Nl,Kt,this.tileID.canonical),ut.bucketLayerIDs.push(gr.map((ks=>ks.id))))}}const ie=m.bS(Kt.glyphDependencies,(Re=>Object.keys(Re).map(Number)));this.inFlightDependencies.forEach((Re=>Re?.abort())),this.inFlightDependencies=[];let De=Promise.resolve({});if(Object.keys(ie).length){const Re=new AbortController;this.inFlightDependencies.push(Re),De=bt.sendAsync({type:"GG",data:{stacks:ie,source:this.source,tileID:this.tileID,type:"glyphs"}},Re)}const He=Object.keys(Kt.iconDependencies);let si=Promise.resolve({});if(He.length){const Re=new AbortController;this.inFlightDependencies.push(Re),si=bt.sendAsync({type:"GI",data:{icons:He,source:this.source,tileID:this.tileID,type:"icons"}},Re)}const Mn=Object.keys(Kt.patternDependencies);let gi=Promise.resolve({});if(Mn.length){const Re=new AbortController;this.inFlightDependencies.push(Re),gi=bt.sendAsync({type:"GI",data:{icons:Mn,source:this.source,tileID:this.tileID,type:"patterns"}},Re)}const Bi=Kt.dashDependencies;let Qi=Promise.resolve({});if(Object.keys(Bi).length){const Re=new AbortController;this.inFlightDependencies.push(Re),Qi=bt.sendAsync({type:"GDA",data:{dashes:Bi}},Re)}const[xe,Ji,tn,Vn]=yield Promise.all([De,si,gi,Qi]),Li=new w(xe),fe=new m.cK(Ji,tn);for(const Re in Ot){const We=Ot[Re];We instanceof m.ad?(P(We.layers,this.zoom,rt),m.cL({bucket:We,glyphMap:xe,glyphPositions:Li.positions,imageMap:Ji,imagePositions:fe.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Kt.subdivisionGranularity})):We.hasDependencies&&(We instanceof m.cM||We instanceof m.cN||We instanceof m.cO)&&(P(We.layers,this.zoom,rt),We.addFeatures(Kt,this.tileID.canonical,fe.patternPositions,Vn))}return this.status="done",{buckets:Object.values(Ot).filter((Re=>!Re.isEmpty())),featureIndex:ut,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Li.image,imageAtlas:fe,dashPositions:Vn,glyphMap:this.returnDependencies?xe:null,iconMap:this.returnDependencies?Ji:null,glyphPositions:this.returnDependencies?Li.positions:null}}))}}function P(Ct,Q,tt){const rt=new m.G(Q);for(const bt of Ct)bt.recalculate(rt,tt)}class L extends m.cR{constructor(Q,tt){super(new m.cQ,0,tt,[],[]),this.feature=Q,this.type=Q.type,this.properties=Q.tags?Q.tags:{},"id"in Q&&(typeof Q.id=="string"?this.id=parseInt(Q.id,10):typeof Q.id!="number"||isNaN(Q.id)||(this.id=Q.id))}loadGeometry(){const Q=[],tt=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const rt of tt){const bt=[];for(const wt of rt)bt.push(new m.P(wt[0],wt[1]));Q.push(bt)}return Q}}class j extends m.cP{constructor(Q,tt){super(new m.cQ),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=tt?tt.version:1,this.extent=tt?tt.extent:4096,this.length=Q.length,this.features=Q}feature(Q){return new L(this.features[Q],this.extent)}}function G(Ct,Q){Q.writeVarintField(15,Ct.version||1),Q.writeStringField(1,Ct.name||""),Q.writeVarintField(5,Ct.extent||4096);const tt={keys:[],values:[],keycache:{},valuecache:{}};for(let wt=0;wt<Ct.length;wt++)tt.feature=Ct.feature(wt),Q.writeMessage(2,nt,tt);const rt=tt.keys;for(const wt of rt)Q.writeStringField(3,wt);const bt=tt.values;for(const wt of bt)Q.writeMessage(4,pt,wt)}function nt(Ct,Q){if(!Ct.feature)return;const tt=Ct.feature;tt.id!==void 0&&Q.writeVarintField(1,tt.id),Q.writeMessage(2,at,Ct),Q.writeVarintField(3,tt.type),Q.writeMessage(4,Mt,tt)}function at(Ct,Q){for(const tt in Ct.feature?.properties){let rt=Ct.feature.properties[tt],bt=Ct.keycache[tt];if(rt===null)continue;bt===void 0&&(Ct.keys.push(tt),bt=Ct.keys.length-1,Ct.keycache[tt]=bt),Q.writeVarint(bt),typeof rt!="string"&&typeof rt!="boolean"&&typeof rt!="number"&&(rt=JSON.stringify(rt));const wt=typeof rt+":"+rt;let Ft=Ct.valuecache[wt];Ft===void 0&&(Ct.values.push(rt),Ft=Ct.values.length-1,Ct.valuecache[wt]=Ft),Q.writeVarint(Ft)}}function J(Ct,Q){return(Q<<3)+(7&Ct)}function mt(Ct){return Ct<<1^Ct>>31}function Mt(Ct,Q){const tt=Ct.loadGeometry(),rt=Ct.type;let bt=0,wt=0;for(const Ft of tt){let ut=1;rt===1&&(ut=Ft.length),Q.writeVarint(J(1,ut));const Ot=rt===3?Ft.length-1:Ft.length;for(let Kt=0;Kt<Ot;Kt++){Kt===1&&rt!==1&&Q.writeVarint(J(2,Ot-1));const te=Ft[Kt].x-bt,ie=Ft[Kt].y-wt;Q.writeVarint(mt(te)),Q.writeVarint(mt(ie)),bt+=te,wt+=ie}Ct.type===3&&Q.writeVarint(J(7,1))}}function pt(Ct,Q){const tt=typeof Ct;tt==="string"?Q.writeStringField(1,Ct):tt==="boolean"?Q.writeBooleanField(7,Ct):tt==="number"&&(Ct%1!=0?Q.writeDoubleField(3,Ct):Ct<0?Q.writeSVarintField(6,Ct):Q.writeVarintField(5,Ct))}class Pt extends m.cR{constructor(Q,tt,rt,bt,wt){super(new m.cQ,0,wt,[],[]),this.type=Q,this.properties=rt||{},this.extent=wt,this.pointsArray=tt,this.id=bt}loadGeometry(){return this.pointsArray.map((Q=>Q.map((tt=>new m.P(tt.x,tt.y)))))}}class kt extends m.cP{constructor(Q,tt,rt){super(new m.cQ),this.version=2,this._myFeatures=Q,this.name=tt,this.length=Q.length,this.extent=rt}feature(Q){return this._myFeatures[Q]}}class $t{constructor(){this.layers={}}addLayer(Q){this.layers[Q.name]=Q}}function ae(Ct){let Q=(function(tt){const rt=new m.cQ;return(function(bt,wt){for(const Ft in bt.layers)wt.writeMessage(3,G,bt.layers[Ft])})(tt,rt),rt.finish()})(Ct);return Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),{vectorTile:Ct,rawData:Q.buffer}}function qt(Ct,Q,tt){const{extent:rt}=Ct,bt=Math.pow(2,tt.z-Q.z),wt=(tt.x-Q.x*bt)*rt,Ft=(tt.y-Q.y*bt)*rt,ut=[];for(let Ot=0;Ot<Ct.length;Ot++){const Kt=Ct.feature(Ot);let te=Kt.loadGeometry();for(const De of te)for(const He of De)He.x=He.x*bt-wt,He.y=He.y*bt-Ft;const ie=128;te=m.cS(te,Kt.type,-ie,-ie,rt+ie,rt+ie),te.length!==0&&ut.push(new Pt(Kt.type,te,Kt.properties,Kt.id,rt))}return new kt(ut,Ct.name,rt)}class le{constructor(Q,tt,rt){this.actor=Q,this.layerIndex=tt,this.availableImages=rt,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new m.cT(1e3)}loadVectorTile(Q,tt){return m._(this,void 0,void 0,(function*(){const rt=yield m.n(Q.request,tt);try{return{vectorTile:Q.encoding!=="mlt"?new m.cU(new m.cQ(rt.data)):new m.cV(rt.data),rawData:rt.data,cacheControl:rt.cacheControl,expires:rt.expires}}catch(bt){const wt=new Uint8Array(rt.data);let Ft=`Unable to parse the tile at ${Q.request.url}, `;throw Ft+=wt[0]===31&&wt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${bt.message}`,new Error(Ft)}}))}loadTile(Q){return m._(this,void 0,void 0,(function*(){const{uid:tt,overzoomParameters:rt}=Q;rt&&(Q.request=rt.overzoomRequest);const bt=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new m.cW(Q.request),wt=new C(Q);this.loading[tt]=wt;const Ft=new AbortController;wt.abort=Ft;try{const ut=yield this.loadVectorTile(Q,Ft);if(delete this.loading[tt],!ut)return null;if(rt){const De=this._getOverzoomTile(Q,ut.vectorTile);ut.rawData=De.rawData,ut.vectorTile=De.vectorTile}const Ot=ut.rawData,Kt={};ut.expires&&(Kt.expires=ut.expires),ut.cacheControl&&(Kt.cacheControl=ut.cacheControl);const te={};if(bt){const De=bt.finish();De&&(te.resourceTiming=JSON.parse(JSON.stringify(De)))}wt.vectorTile=ut.vectorTile;const ie=wt.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);this.loaded[tt]=wt,this.fetching[tt]={rawTileData:Ot,cacheControl:Kt,resourceTiming:te};try{const De=yield ie;return m.e({rawTileData:Ot.slice(0),encoding:Q.encoding},De,Kt,te)}finally{delete this.fetching[tt]}}catch(ut){throw delete this.loading[tt],wt.status="done",this.loaded[tt]=wt,ut}}))}_getOverzoomTile(Q,tt){const{tileID:rt,source:bt,overzoomParameters:wt}=Q,{maxZoomTileID:Ft}=wt,ut=`${Ft.key}_${rt.key}`,Ot=this.overzoomedTileResultCache.get(ut);if(Ot)return Ot;const Kt=new $t,te=this.layerIndex.familiesBySource[bt];for(const De in te){const He=tt.layers[De];if(!He)continue;const si=qt(He,Ft,rt.canonical);si.length>0&&Kt.addLayer(si)}const ie=ae(Kt);return this.overzoomedTileResultCache.set(ut,ie),ie}reloadTile(Q){return m._(this,void 0,void 0,(function*(){const tt=Q.uid;if(!this.loaded||!this.loaded[tt])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const rt=this.loaded[tt];if(rt.showCollisionBoxes=Q.showCollisionBoxes,rt.status==="parsing"){const bt=yield rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);let wt;if(this.fetching[tt]){const{rawTileData:Ft,cacheControl:ut,resourceTiming:Ot}=this.fetching[tt];delete this.fetching[tt],wt=m.e({rawTileData:Ft.slice(0),encoding:Q.encoding},bt,ut,Ot)}else wt=bt;return wt}if(rt.status==="done"&&rt.vectorTile)return rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity)}))}abortTile(Q){return m._(this,void 0,void 0,(function*(){const tt=this.loading,rt=Q.uid;tt&&tt[rt]&&tt[rt].abort&&(tt[rt].abort.abort(),delete tt[rt])}))}removeTile(Q){return m._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Q.uid]&&delete this.loaded[Q.uid]}))}}class Oe{constructor(){this.loaded={}}loadTile(Q){return m._(this,void 0,void 0,(function*(){const{uid:tt,encoding:rt,rawImageData:bt,redFactor:wt,greenFactor:Ft,blueFactor:ut,baseShift:Ot}=Q,Kt=bt.width+2,te=bt.height+2,ie=m.b(bt)?new m.R({width:Kt,height:te},yield m.cX(bt,-1,-1,Kt,te)):bt,De=new m.cY(tt,ie,rt,wt,Ft,ut,Ot);return this.loaded=this.loaded||{},this.loaded[tt]=De,De}))}removeTile(Q){const tt=this.loaded,rt=Q.uid;tt&&tt[rt]&&delete tt[rt]}}var Be,qe,ri=(function(){if(qe)return Be;function Ct(tt,rt){if(tt.length!==0){Q(tt[0],rt);for(var bt=1;bt<tt.length;bt++)Q(tt[bt],!rt)}}function Q(tt,rt){for(var bt=0,wt=0,Ft=0,ut=tt.length,Ot=ut-1;Ft<ut;Ot=Ft++){var Kt=(tt[Ft][0]-tt[Ot][0])*(tt[Ot][1]+tt[Ft][1]),te=bt+Kt;wt+=Math.abs(bt)>=Math.abs(Kt)?bt-te+Kt:Kt-te+bt,bt=te}bt+wt>=0!=!!rt&&tt.reverse()}return qe=1,Be=function tt(rt,bt){var wt,Ft=rt&&rt.type;if(Ft==="FeatureCollection")for(wt=0;wt<rt.features.length;wt++)tt(rt.features[wt],bt);else if(Ft==="GeometryCollection")for(wt=0;wt<rt.geometries.length;wt++)tt(rt.geometries[wt],bt);else if(Ft==="Feature")tt(rt.geometry,bt);else if(Ft==="Polygon")Ct(rt.coordinates,bt);else if(Ft==="MultiPolygon")for(wt=0;wt<rt.coordinates.length;wt++)Ct(rt.coordinates[wt],bt);return rt}})(),Ne=m.cZ(ri);const wi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ct=>Ct},ne=Math.fround||(we=new Float32Array(1),Ct=>(we[0]=+Ct,we[0]));var we;class ye{constructor(Q){this.options=Object.assign(Object.create(wi),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:tt,minZoom:rt,maxZoom:bt}=this.options;tt&&console.time("total time");const wt=`prepare ${Q.length} points`;tt&&console.time(wt),this.points=Q;const Ft=[];for(let Ot=0;Ot<Q.length;Ot++){const Kt=Q[Ot];if(!Kt.geometry)continue;const[te,ie]=Kt.geometry.coordinates,De=ne(Dt(te)),He=ne(he(ie));Ft.push(De,He,1/0,Ot,-1,1),this.options.reduce&&Ft.push(0)}let ut=this.trees[bt+1]=this._createTree(Ft);tt&&console.timeEnd(wt);for(let Ot=bt;Ot>=rt;Ot--){const Kt=+Date.now();ut=this.trees[Ot]=this._createTree(this._cluster(ut,Ot)),tt&&console.log("z%d: %d clusters in %dms",Ot,ut.numItems,+Date.now()-Kt)}return tt&&console.timeEnd("total time"),this}getClusters(Q,tt){let rt=((Q[0]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,Q[1]));let wt=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Ft=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)rt=-180,wt=180;else if(rt>wt){const ie=this.getClusters([rt,bt,180,Ft],tt),De=this.getClusters([-180,bt,wt,Ft],tt);return ie.concat(De)}const ut=this.trees[this._limitZoom(tt)],Ot=ut.range(Dt(rt),he(Ft),Dt(wt),he(bt)),Kt=ut.data,te=[];for(const ie of Ot){const De=this.stride*ie;te.push(Kt[De+5]>1?Ue(Kt,De,this.clusterProps):this.points[Kt[De+3]])}return te}getChildren(Q){const tt=this._getOriginId(Q),rt=this._getOriginZoom(Q),bt="No cluster with the specified id.",wt=this.trees[rt];if(!wt)throw new Error(bt);const Ft=wt.data;if(tt*this.stride>=Ft.length)throw new Error(bt);const ut=this.options.radius/(this.options.extent*Math.pow(2,rt-1)),Ot=wt.within(Ft[tt*this.stride],Ft[tt*this.stride+1],ut),Kt=[];for(const te of Ot){const ie=te*this.stride;Ft[ie+4]===Q&&Kt.push(Ft[ie+5]>1?Ue(Ft,ie,this.clusterProps):this.points[Ft[ie+3]])}if(Kt.length===0)throw new Error(bt);return Kt}getLeaves(Q,tt,rt){const bt=[];return this._appendLeaves(bt,Q,tt=tt||10,rt=rt||0,0),bt}getTile(Q,tt,rt){const bt=this.trees[this._limitZoom(Q)],wt=Math.pow(2,Q),{extent:Ft,radius:ut}=this.options,Ot=ut/Ft,Kt=(rt-Ot)/wt,te=(rt+1+Ot)/wt,ie={features:[]};return this._addTileFeatures(bt.range((tt-Ot)/wt,Kt,(tt+1+Ot)/wt,te),bt.data,tt,rt,wt,ie),tt===0&&this._addTileFeatures(bt.range(1-Ot/wt,Kt,1,te),bt.data,wt,rt,wt,ie),tt===wt-1&&this._addTileFeatures(bt.range(0,Kt,Ot/wt,te),bt.data,-1,rt,wt,ie),ie.features.length?ie:null}getClusterExpansionZoom(Q){let tt=this._getOriginZoom(Q)-1;for(;tt<=this.options.maxZoom;){const rt=this.getChildren(Q);if(tt++,rt.length!==1)break;Q=rt[0].properties.cluster_id}return tt}_appendLeaves(Q,tt,rt,bt,wt){const Ft=this.getChildren(tt);for(const ut of Ft){const Ot=ut.properties;if(Ot&&Ot.cluster?wt+Ot.point_count<=bt?wt+=Ot.point_count:wt=this._appendLeaves(Q,Ot.cluster_id,rt,bt,wt):wt<bt?wt++:Q.push(ut),Q.length===rt)break}return wt}_createTree(Q){const tt=new m.aN(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let rt=0;rt<Q.length;rt+=this.stride)tt.add(Q[rt],Q[rt+1]);return tt.finish(),tt.data=Q,tt}_addTileFeatures(Q,tt,rt,bt,wt,Ft){for(const ut of Q){const Ot=ut*this.stride,Kt=tt[Ot+5]>1;let te,ie,De;if(Kt)te=mi(tt,Ot,this.clusterProps),ie=tt[Ot],De=tt[Ot+1];else{const Mn=this.points[tt[Ot+3]];te=Mn.properties;const[gi,Bi]=Mn.geometry.coordinates;ie=Dt(gi),De=he(Bi)}const He={type:1,geometry:[[Math.round(this.options.extent*(ie*wt-rt)),Math.round(this.options.extent*(De*wt-bt))]],tags:te};let si;si=Kt||this.options.generateId?tt[Ot+3]:this.points[tt[Ot+3]].id,si!==void 0&&(He.id=si),Ft.features.push(He)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,tt){const{radius:rt,extent:bt,reduce:wt,minPoints:Ft}=this.options,ut=rt/(bt*Math.pow(2,tt)),Ot=Q.data,Kt=[],te=this.stride;for(let ie=0;ie<Ot.length;ie+=te){if(Ot[ie+2]<=tt)continue;Ot[ie+2]=tt;const De=Ot[ie],He=Ot[ie+1],si=Q.within(Ot[ie],Ot[ie+1],ut),Mn=Ot[ie+5];let gi=Mn;for(const Bi of si){const Qi=Bi*te;Ot[Qi+2]>tt&&(gi+=Ot[Qi+5])}if(gi>Mn&&gi>=Ft){let Bi,Qi=De*Mn,xe=He*Mn,Ji=-1;const tn=(ie/te<<5)+(tt+1)+this.points.length;for(const Vn of si){const Li=Vn*te;if(Ot[Li+2]<=tt)continue;Ot[Li+2]=tt;const fe=Ot[Li+5];Qi+=Ot[Li]*fe,xe+=Ot[Li+1]*fe,Ot[Li+4]=tn,wt&&(Bi||(Bi=this._map(Ot,ie,!0),Ji=this.clusterProps.length,this.clusterProps.push(Bi)),wt(Bi,this._map(Ot,Li)))}Ot[ie+4]=tn,Kt.push(Qi/gi,xe/gi,1/0,tn,-1,gi),wt&&Kt.push(Ji)}else{for(let Bi=0;Bi<te;Bi++)Kt.push(Ot[ie+Bi]);if(gi>1)for(const Bi of si){const Qi=Bi*te;if(!(Ot[Qi+2]<=tt)){Ot[Qi+2]=tt;for(let xe=0;xe<te;xe++)Kt.push(Ot[Qi+xe])}}}}return Kt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,tt,rt){if(Q[tt+5]>1){const Ft=this.clusterProps[Q[tt+6]];return rt?Object.assign({},Ft):Ft}const bt=this.points[Q[tt+3]].properties,wt=this.options.map(bt);return rt&&wt===bt?Object.assign({},wt):wt}}function Ue(Ct,Q,tt){return{type:"Feature",id:Ct[Q+3],properties:mi(Ct,Q,tt),geometry:{type:"Point",coordinates:[(rt=Ct[Q],360*(rt-.5)),Ce(Ct[Q+1])]}};var rt}function mi(Ct,Q,tt){const rt=Ct[Q+5],bt=rt>=1e4?`${Math.round(rt/1e3)}k`:rt>=1e3?Math.round(rt/100)/10+"k":rt,wt=Ct[Q+6],Ft=wt===-1?{}:Object.assign({},tt[wt]);return Object.assign(Ft,{cluster:!0,cluster_id:Ct[Q+3],point_count:rt,point_count_abbreviated:bt})}function Dt(Ct){return Ct/360+.5}function he(Ct){const Q=Math.sin(Ct*Math.PI/180),tt=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return tt<0?0:tt>1?1:tt}function Ce(Ct){const Q=(180-360*Ct)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function Me(Ct,Q,tt,rt){let bt=rt;const wt=Q+(tt-Q>>1);let Ft,ut=tt-Q;const Ot=Ct[Q],Kt=Ct[Q+1],te=Ct[tt],ie=Ct[tt+1];for(let De=Q+3;De<tt;De+=3){const He=ei(Ct[De],Ct[De+1],Ot,Kt,te,ie);if(He>bt)Ft=De,bt=He;else if(He===bt){const si=Math.abs(De-wt);si<ut&&(Ft=De,ut=si)}}bt>rt&&(Ft-Q>3&&Me(Ct,Q,Ft,rt),Ct[Ft+2]=bt,tt-Ft>3&&Me(Ct,Ft,tt,rt))}function ei(Ct,Q,tt,rt,bt,wt){let Ft=bt-tt,ut=wt-rt;if(Ft!==0||ut!==0){const Ot=((Ct-tt)*Ft+(Q-rt)*ut)/(Ft*Ft+ut*ut);Ot>1?(tt=bt,rt=wt):Ot>0&&(tt+=Ft*Ot,rt+=ut*Ot)}return Ft=Ct-tt,ut=Q-rt,Ft*Ft+ut*ut}function ii(Ct,Q,tt,rt){const bt={id:Ct??null,type:Q,geometry:tt,tags:rt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")Je(bt,tt);else if(Q==="Polygon")Je(bt,tt[0]);else if(Q==="MultiLineString")for(const wt of tt)Je(bt,wt);else if(Q==="MultiPolygon")for(const wt of tt)Je(bt,wt[0]);return bt}function Je(Ct,Q){for(let tt=0;tt<Q.length;tt+=3)Ct.minX=Math.min(Ct.minX,Q[tt]),Ct.minY=Math.min(Ct.minY,Q[tt+1]),Ct.maxX=Math.max(Ct.maxX,Q[tt]),Ct.maxY=Math.max(Ct.maxY,Q[tt+1])}function zi(Ct,Q,tt,rt){if(!Q.geometry)return;const bt=Q.geometry.coordinates;if(bt&&bt.length===0)return;const wt=Q.geometry.type,Ft=Math.pow(tt.tolerance/((1<<tt.maxZoom)*tt.extent),2);let ut=[],Ot=Q.id;if(tt.promoteId?Ot=Q.properties[tt.promoteId]:tt.generateId&&(Ot=rt||0),wt==="Point")Ui(bt,ut);else if(wt==="MultiPoint")for(const Kt of bt)Ui(Kt,ut);else if(wt==="LineString")Ar(bt,ut,Ft,!1);else if(wt==="MultiLineString"){if(tt.lineMetrics){for(const Kt of bt)ut=[],Ar(Kt,ut,Ft,!1),Ct.push(ii(Ot,"LineString",ut,Q.properties));return}gs(bt,ut,Ft,!1)}else if(wt==="Polygon")gs(bt,ut,Ft,!0);else{if(wt!=="MultiPolygon"){if(wt==="GeometryCollection"){for(const Kt of Q.geometry.geometries)zi(Ct,{id:Ot,geometry:Kt,properties:Q.properties},tt,rt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Kt of bt){const te=[];gs(Kt,te,Ft,!0),ut.push(te)}}Ct.push(ii(Ot,wt,ut,Q.properties))}function Ui(Ct,Q){Q.push(ar(Ct[0]),Dc(Ct[1]),0)}function Ar(Ct,Q,tt,rt){let bt,wt,Ft=0;for(let Ot=0;Ot<Ct.length;Ot++){const Kt=ar(Ct[Ot][0]),te=Dc(Ct[Ot][1]);Q.push(Kt,te,0),Ot>0&&(Ft+=rt?(bt*te-Kt*wt)/2:Math.sqrt(Math.pow(Kt-bt,2)+Math.pow(te-wt,2))),bt=Kt,wt=te}const ut=Q.length-3;Q[2]=1,Me(Q,0,ut,tt),Q[ut+2]=1,Q.size=Math.abs(Ft),Q.start=0,Q.end=Q.size}function gs(Ct,Q,tt,rt){for(let bt=0;bt<Ct.length;bt++){const wt=[];Ar(Ct[bt],wt,tt,rt),Q.push(wt)}}function ar(Ct){return Ct/360+.5}function Dc(Ct){const Q=Math.sin(Ct*Math.PI/180),tt=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return tt<0?0:tt>1?1:tt}function $i(Ct,Q,tt,rt,bt,wt,Ft,ut){if(rt/=Q,wt>=(tt/=Q)&&Ft<rt)return Ct;if(Ft<tt||wt>=rt)return null;const Ot=[];for(const Kt of Ct){const te=Kt.geometry;let ie=Kt.type;const De=bt===0?Kt.minX:Kt.minY,He=bt===0?Kt.maxX:Kt.maxY;if(De>=tt&&He<rt){Ot.push(Kt);continue}if(He<tt||De>=rt)continue;let si=[];if(ie==="Point"||ie==="MultiPoint")Ds(te,si,tt,rt,bt);else if(ie==="LineString")$s(te,si,tt,rt,bt,!1,ut.lineMetrics);else if(ie==="MultiLineString")aa(te,si,tt,rt,bt,!1);else if(ie==="Polygon")aa(te,si,tt,rt,bt,!0);else if(ie==="MultiPolygon")for(const Mn of te){const gi=[];aa(Mn,gi,tt,rt,bt,!0),gi.length&&si.push(gi)}if(si.length){if(ut.lineMetrics&&ie==="LineString"){for(const Mn of si)Ot.push(ii(Kt.id,ie,Mn,Kt.tags));continue}ie!=="LineString"&&ie!=="MultiLineString"||(si.length===1?(ie="LineString",si=si[0]):ie="MultiLineString"),ie!=="Point"&&ie!=="MultiPoint"||(ie=si.length===3?"Point":"MultiPoint"),Ot.push(ii(Kt.id,ie,si,Kt.tags))}}return Ot.length?Ot:null}function Ds(Ct,Q,tt,rt,bt){for(let wt=0;wt<Ct.length;wt+=3){const Ft=Ct[wt+bt];Ft>=tt&&Ft<=rt&&Hs(Q,Ct[wt],Ct[wt+1],Ct[wt+2])}}function $s(Ct,Q,tt,rt,bt,wt,Ft){let ut=wn(Ct);const Ot=bt===0?qo:Pa;let Kt,te,ie=Ct.start;for(let gi=0;gi<Ct.length-3;gi+=3){const Bi=Ct[gi],Qi=Ct[gi+1],xe=Ct[gi+2],Ji=Ct[gi+3],tn=Ct[gi+4],Vn=bt===0?Bi:Qi,Li=bt===0?Ji:tn;let fe=!1;Ft&&(Kt=Math.sqrt(Math.pow(Bi-Ji,2)+Math.pow(Qi-tn,2))),Vn<tt?Li>tt&&(te=Ot(ut,Bi,Qi,Ji,tn,tt),Ft&&(ut.start=ie+Kt*te)):Vn>rt?Li<rt&&(te=Ot(ut,Bi,Qi,Ji,tn,rt),Ft&&(ut.start=ie+Kt*te)):Hs(ut,Bi,Qi,xe),Li<tt&&Vn>=tt&&(te=Ot(ut,Bi,Qi,Ji,tn,tt),fe=!0),Li>rt&&Vn<=rt&&(te=Ot(ut,Bi,Qi,Ji,tn,rt),fe=!0),!wt&&fe&&(Ft&&(ut.end=ie+Kt*te),Q.push(ut),ut=wn(Ct)),Ft&&(ie+=Kt)}let De=Ct.length-3;const He=Ct[De],si=Ct[De+1],Mn=bt===0?He:si;Mn>=tt&&Mn<=rt&&Hs(ut,He,si,Ct[De+2]),De=ut.length-3,wt&&De>=3&&(ut[De]!==ut[0]||ut[De+1]!==ut[1])&&Hs(ut,ut[0],ut[1],ut[2]),ut.length&&Q.push(ut)}function wn(Ct){const Q=[];return Q.size=Ct.size,Q.start=Ct.start,Q.end=Ct.end,Q}function aa(Ct,Q,tt,rt,bt,wt){for(const Ft of Ct)$s(Ft,Q,tt,rt,bt,wt,!1)}function Hs(Ct,Q,tt,rt){Ct.push(Q,tt,rt)}function qo(Ct,Q,tt,rt,bt,wt){const Ft=(wt-Q)/(rt-Q);return Hs(Ct,wt,tt+(bt-tt)*Ft,1),Ft}function Pa(Ct,Q,tt,rt,bt,wt){const Ft=(wt-tt)/(bt-tt);return Hs(Ct,Q+(rt-Q)*Ft,wt,1),Ft}function Ia(Ct,Q){const tt=[];for(let rt=0;rt<Ct.length;rt++){const bt=Ct[rt],wt=bt.type;let Ft;if(wt==="Point"||wt==="MultiPoint"||wt==="LineString")Ft=Xo(bt.geometry,Q);else if(wt==="MultiLineString"||wt==="Polygon"){Ft=[];for(const ut of bt.geometry)Ft.push(Xo(ut,Q))}else if(wt==="MultiPolygon"){Ft=[];for(const ut of bt.geometry){const Ot=[];for(const Kt of ut)Ot.push(Xo(Kt,Q));Ft.push(Ot)}}tt.push(ii(bt.id,wt,Ft,bt.tags))}return tt}function Xo(Ct,Q){const tt=[];tt.size=Ct.size,Ct.start!==void 0&&(tt.start=Ct.start,tt.end=Ct.end);for(let rt=0;rt<Ct.length;rt+=3)tt.push(Ct[rt]+Q,Ct[rt+1],Ct[rt+2]);return tt}function or(Ct,Q){if(Ct.transformed)return Ct;const tt=1<<Ct.z,rt=Ct.x,bt=Ct.y;for(const wt of Ct.features){const Ft=wt.geometry,ut=wt.type;if(wt.geometry=[],ut===1)for(let Ot=0;Ot<Ft.length;Ot+=2)wt.geometry.push(_s(Ft[Ot],Ft[Ot+1],Q,tt,rt,bt));else for(let Ot=0;Ot<Ft.length;Ot++){const Kt=[];for(let te=0;te<Ft[Ot].length;te+=2)Kt.push(_s(Ft[Ot][te],Ft[Ot][te+1],Q,tt,rt,bt));wt.geometry.push(Kt)}}return Ct.transformed=!0,Ct}function _s(Ct,Q,tt,rt,bt,wt){return[Math.round(tt*(Ct*rt-bt)),Math.round(tt*(Q*rt-wt))]}function kc(Ct,Q,tt,rt,bt){const wt=Q===bt.maxZoom?0:bt.tolerance/((1<<Q)*bt.extent),Ft={features:[],numPoints:0,numSimplified:0,numFeatures:Ct.length,source:null,x:tt,y:rt,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ut of Ct)Oc(Ft,ut,wt,bt);return Ft}function Oc(Ct,Q,tt,rt){const bt=Q.geometry,wt=Q.type,Ft=[];if(Ct.minX=Math.min(Ct.minX,Q.minX),Ct.minY=Math.min(Ct.minY,Q.minY),Ct.maxX=Math.max(Ct.maxX,Q.maxX),Ct.maxY=Math.max(Ct.maxY,Q.maxY),wt==="Point"||wt==="MultiPoint")for(let ut=0;ut<bt.length;ut+=3)Ft.push(bt[ut],bt[ut+1]),Ct.numPoints++,Ct.numSimplified++;else if(wt==="LineString")Da(Ft,bt,Ct,tt,!1,!1);else if(wt==="MultiLineString"||wt==="Polygon")for(let ut=0;ut<bt.length;ut++)Da(Ft,bt[ut],Ct,tt,wt==="Polygon",ut===0);else if(wt==="MultiPolygon")for(let ut=0;ut<bt.length;ut++){const Ot=bt[ut];for(let Kt=0;Kt<Ot.length;Kt++)Da(Ft,Ot[Kt],Ct,tt,!0,Kt===0)}if(Ft.length){let ut=Q.tags||null;if(wt==="LineString"&&rt.lineMetrics){ut={};for(const Kt in Q.tags)ut[Kt]=Q.tags[Kt];ut.mapbox_clip_start=bt.start/bt.size,ut.mapbox_clip_end=bt.end/bt.size}const Ot={geometry:Ft,type:wt==="Polygon"||wt==="MultiPolygon"?3:wt==="LineString"||wt==="MultiLineString"?2:1,tags:ut};Q.id!==null&&(Ot.id=Q.id),Ct.features.push(Ot)}}function Da(Ct,Q,tt,rt,bt,wt){const Ft=rt*rt;if(rt>0&&Q.size<(bt?Ft:rt))return void(tt.numPoints+=Q.length/3);const ut=[];for(let Ot=0;Ot<Q.length;Ot+=3)(rt===0||Q[Ot+2]>Ft)&&(tt.numSimplified++,ut.push(Q[Ot],Q[Ot+1])),tt.numPoints++;bt&&(function(Ot,Kt){let te=0;for(let ie=0,De=Ot.length,He=De-2;ie<De;He=ie,ie+=2)te+=(Ot[ie]-Ot[He])*(Ot[ie+1]+Ot[He+1]);if(te>0===Kt)for(let ie=0,De=Ot.length;ie<De/2;ie+=2){const He=Ot[ie],si=Ot[ie+1];Ot[ie]=Ot[De-2-ie],Ot[ie+1]=Ot[De-1-ie],Ot[De-2-ie]=He,Ot[De-1-ie]=si}})(ut,wt),Ct.push(ut)}const Bc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class so{constructor(Q,tt){const rt=(tt=this.options=(function(wt,Ft){for(const ut in Ft)wt[ut]=Ft[ut];return wt})(Object.create(Bc),tt)).debug;if(rt&&console.time("preprocess data"),tt.maxZoom<0||tt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(tt.promoteId&&tt.generateId)throw new Error("promoteId and generateId cannot be used together.");let bt=(function(wt,Ft){const ut=[];if(wt.type==="FeatureCollection")for(let Ot=0;Ot<wt.features.length;Ot++)zi(ut,wt.features[Ot],Ft,Ot);else zi(ut,wt.type==="Feature"?wt:{geometry:wt},Ft);return ut})(Q,tt);this.tiles={},this.tileCoords=[],rt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",tt.indexMaxZoom,tt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),bt=(function(wt,Ft){const ut=Ft.buffer/Ft.extent;let Ot=wt;const Kt=$i(wt,1,-1-ut,ut,0,-1,2,Ft),te=$i(wt,1,1-ut,2+ut,0,-1,2,Ft);return(Kt||te)&&(Ot=$i(wt,1,-ut,1+ut,0,-1,2,Ft)||[],Kt&&(Ot=Ia(Kt,1).concat(Ot)),te&&(Ot=Ot.concat(Ia(te,-1)))),Ot})(bt,tt),bt.length&&this.splitTile(bt,0,0,0),rt&&(bt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,tt,rt,bt,wt,Ft,ut){const Ot=[Q,tt,rt,bt],Kt=this.options,te=Kt.debug;for(;Ot.length;){bt=Ot.pop(),rt=Ot.pop(),tt=Ot.pop(),Q=Ot.pop();const ie=1<<tt,De=Lc(tt,rt,bt);let He=this.tiles[De];if(!He&&(te>1&&console.time("creation"),He=this.tiles[De]=kc(Q,tt,rt,bt,Kt),this.tileCoords.push({z:tt,x:rt,y:bt}),te)){te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",tt,rt,bt,He.numFeatures,He.numPoints,He.numSimplified),console.timeEnd("creation"));const fe=`z${tt}`;this.stats[fe]=(this.stats[fe]||0)+1,this.total++}if(He.source=Q,wt==null){if(tt===Kt.indexMaxZoom||He.numPoints<=Kt.indexMaxPoints)continue}else{if(tt===Kt.maxZoom||tt===wt)continue;if(wt!=null){const fe=wt-tt;if(rt!==Ft>>fe||bt!==ut>>fe)continue}}if(He.source=null,Q.length===0)continue;te>1&&console.time("clipping");const si=.5*Kt.buffer/Kt.extent,Mn=.5-si,gi=.5+si,Bi=1+si;let Qi=null,xe=null,Ji=null,tn=null,Vn=$i(Q,ie,rt-si,rt+gi,0,He.minX,He.maxX,Kt),Li=$i(Q,ie,rt+Mn,rt+Bi,0,He.minX,He.maxX,Kt);Q=null,Vn&&(Qi=$i(Vn,ie,bt-si,bt+gi,1,He.minY,He.maxY,Kt),xe=$i(Vn,ie,bt+Mn,bt+Bi,1,He.minY,He.maxY,Kt),Vn=null),Li&&(Ji=$i(Li,ie,bt-si,bt+gi,1,He.minY,He.maxY,Kt),tn=$i(Li,ie,bt+Mn,bt+Bi,1,He.minY,He.maxY,Kt),Li=null),te>1&&console.timeEnd("clipping"),Ot.push(Qi||[],tt+1,2*rt,2*bt),Ot.push(xe||[],tt+1,2*rt,2*bt+1),Ot.push(Ji||[],tt+1,2*rt+1,2*bt),Ot.push(tn||[],tt+1,2*rt+1,2*bt+1)}}getTile(Q,tt,rt){Q=+Q,tt=+tt,rt=+rt;const bt=this.options,{extent:wt,debug:Ft}=bt;if(Q<0||Q>24)return null;const ut=1<<Q,Ot=Lc(Q,tt=tt+ut&ut-1,rt);if(this.tiles[Ot])return or(this.tiles[Ot],wt);Ft>1&&console.log("drilling down to z%d-%d-%d",Q,tt,rt);let Kt,te=Q,ie=tt,De=rt;for(;!Kt&&te>0;)te--,ie>>=1,De>>=1,Kt=this.tiles[Lc(te,ie,De)];return Kt&&Kt.source?(Ft>1&&(console.log("found parent tile z%d-%d-%d",te,ie,De),console.time("drilling down")),this.splitTile(Kt.source,te,ie,De,Q,tt,rt),Ft>1&&console.timeEnd("drilling down"),this.tiles[Ot]?or(this.tiles[Ot],wt):null):null}}function Lc(Ct,Q,tt){return 32*((1<<Ct)*tt+Q)+Ct}class Fl extends le{constructor(Q,tt,rt,bt=ts){super(Q,tt,rt),this._dataUpdateable=new Map,this._createGeoJSONIndex=bt}loadVectorTile(Q,tt){return m._(this,void 0,void 0,(function*(){const rt=Q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const bt=this._geoJSONIndex.getTile(rt.z,rt.x,rt.y);return bt?ae(new j(bt.features,{version:2,extent:m.a3})):null}))}loadData(Q){return m._(this,void 0,void 0,(function*(){var tt;(tt=this._pendingRequest)===null||tt===void 0||tt.abort();const rt=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new m.cW(Q.request);this._pendingRequest=new AbortController;try{(!this._pendingData||Q.request||Q.data||Q.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Q,this._pendingRequest));const bt=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(bt,Q),this.loaded={};const wt={data:bt};if(rt){const Ft=rt.finish();Ft&&(wt.resourceTiming={},wt.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Ft)))}return wt}catch(bt){if(delete this._pendingRequest,m.cC(bt))return{abandoned:!0};throw bt}}))}getData(){return m._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Q){const tt=this.loaded;return tt&&tt[Q.uid]?super.reloadTile(Q):this.loadTile(Q)}loadAndProcessGeoJSON(Q,tt){return m._(this,void 0,void 0,(function*(){let rt=yield this.loadGeoJSON(Q,tt);if(delete this._pendingRequest,typeof rt!="object")throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(Ne(rt,!0),Q.filter){const bt=m.c_(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(bt.result==="error")throw new Error(bt.value.map((Ft=>`${Ft.key}: ${Ft.message}`)).join(", "));rt={type:"FeatureCollection",features:rt.features.filter((Ft=>bt.value.evaluate({zoom:0},Ft)))}}return rt}))}loadGeoJSON(Q,tt){return m._(this,void 0,void 0,(function*(){const{promoteId:rt}=Q;if(Q.request){const bt=yield m.j(Q.request,tt);return this._dataUpdateable=m.d0(bt.data,rt)?m.c$(bt.data,rt):void 0,bt.data}if(typeof Q.data=="string")try{const bt=JSON.parse(Q.data);return this._dataUpdateable=m.d0(bt,rt)?m.c$(bt,rt):void 0,bt}catch{throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`)}if(!Q.dataDiff)throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Q.source}`);return m.d1(this._dataUpdateable,Q.dataDiff,rt),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Q){return m._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Q){return this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId)}getClusterChildren(Q){return this._geoJSONIndex.getChildren(Q.clusterId)}getClusterLeaves(Q){return this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset)}}function ts(Ct,Q){return Q.cluster?new ye((function({superclusterOptions:tt,clusterProperties:rt}){if(!rt||!tt)return tt;const bt={},wt={},Ft={accumulated:null,zoom:0},ut={properties:null},Ot=Object.keys(rt);for(const Kt of Ot){const[te,ie]=rt[Kt],De=m.c_(ie),He=m.c_(typeof te=="string"?[te,["accumulated"],["get",Kt]]:te);bt[Kt]=De.value,wt[Kt]=He.value}return tt.map=Kt=>{ut.properties=Kt;const te={};for(const ie of Ot)te[ie]=bt[ie].evaluate(Ft,ut);return te},tt.reduce=(Kt,te)=>{ut.properties=te;for(const ie of Ot)Ft.accumulated=Kt[ie],Kt[ie]=wt[ie].evaluate(Ft,ut)},tt})(Q)).load(Ct.features):(function(tt,rt){return new so(tt,rt)})(Ct,Q.geojsonVtOptions)}class yn{constructor(Q){this.self=Q,this.actor=new m.K(Q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(tt,rt)=>{if(this.externalWorkerSourceTypes[tt])throw new Error(`Worker source with name "${tt}" already registered.`);this.externalWorkerSourceTypes[tt]=rt},this.self.addProtocol=m.cE,this.self.removeProtocol=m.cF,this.self.registerRTLTextPlugin=tt=>{m.d2.setMethods(tt)},this.actor.registerMessageHandler("LDT",((tt,rt)=>this._getDEMWorkerSource(tt,rt.source).loadTile(rt))),this.actor.registerMessageHandler("RDT",((tt,rt)=>m._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(tt,rt.source).removeTile(rt)})))),this.actor.registerMessageHandler("GCEZ",((tt,rt)=>m._(this,void 0,void 0,(function*(){return this._getWorkerSource(tt,rt.type,rt.source).getClusterExpansionZoom(rt)})))),this.actor.registerMessageHandler("GCC",((tt,rt)=>m._(this,void 0,void 0,(function*(){return this._getWorkerSource(tt,rt.type,rt.source).getClusterChildren(rt)})))),this.actor.registerMessageHandler("GCL",((tt,rt)=>m._(this,void 0,void 0,(function*(){return this._getWorkerSource(tt,rt.type,rt.source).getClusterLeaves(rt)})))),this.actor.registerMessageHandler("LD",((tt,rt)=>this._getWorkerSource(tt,rt.type,rt.source).loadData(rt))),this.actor.registerMessageHandler("GD",((tt,rt)=>this._getWorkerSource(tt,rt.type,rt.source).getData())),this.actor.registerMessageHandler("LT",((tt,rt)=>this._getWorkerSource(tt,rt.type,rt.source).loadTile(rt))),this.actor.registerMessageHandler("RT",((tt,rt)=>this._getWorkerSource(tt,rt.type,rt.source).reloadTile(rt))),this.actor.registerMessageHandler("AT",((tt,rt)=>this._getWorkerSource(tt,rt.type,rt.source).abortTile(rt))),this.actor.registerMessageHandler("RMT",((tt,rt)=>this._getWorkerSource(tt,rt.type,rt.source).removeTile(rt))),this.actor.registerMessageHandler("RS",((tt,rt)=>m._(this,void 0,void 0,(function*(){if(!this.workerSources[tt]||!this.workerSources[tt][rt.type]||!this.workerSources[tt][rt.type][rt.source])return;const bt=this.workerSources[tt][rt.type][rt.source];delete this.workerSources[tt][rt.type][rt.source],bt.removeSource!==void 0&&bt.removeSource(rt)})))),this.actor.registerMessageHandler("RM",(tt=>m._(this,void 0,void 0,(function*(){delete this.layerIndexes[tt],delete this.availableImages[tt],delete this.workerSources[tt],delete this.demWorkerSources[tt],this.globalStates.delete(tt)})))),this.actor.registerMessageHandler("SR",((tt,rt)=>m._(this,void 0,void 0,(function*(){this.referrer=rt})))),this.actor.registerMessageHandler("SRPS",((tt,rt)=>this._syncRTLPluginState(tt,rt))),this.actor.registerMessageHandler("IS",((tt,rt)=>m._(this,void 0,void 0,(function*(){this.self.importScripts(rt)})))),this.actor.registerMessageHandler("SI",((tt,rt)=>this._setImages(tt,rt))),this.actor.registerMessageHandler("UL",((tt,rt)=>m._(this,void 0,void 0,(function*(){this._getLayerIndex(tt).update(rt.layers,rt.removedIds,this._getGlobalState(tt))})))),this.actor.registerMessageHandler("UGS",((tt,rt)=>m._(this,void 0,void 0,(function*(){const bt=this._getGlobalState(tt);for(const wt in rt)bt[wt]=rt[wt]})))),this.actor.registerMessageHandler("SL",((tt,rt)=>m._(this,void 0,void 0,(function*(){this._getLayerIndex(tt).replace(rt,this._getGlobalState(tt))}))))}_getGlobalState(Q){let tt=this.globalStates.get(Q);return tt||(tt={},this.globalStates.set(Q,tt)),tt}_setImages(Q,tt){return m._(this,void 0,void 0,(function*(){this.availableImages[Q]=tt;for(const rt in this.workerSources[Q]){const bt=this.workerSources[Q][rt];for(const wt in bt)bt[wt].availableImages=tt}}))}_syncRTLPluginState(Q,tt){return m._(this,void 0,void 0,(function*(){return yield m.d2.syncState(tt,this.self.importScripts)}))}_getAvailableImages(Q){let tt=this.availableImages[Q];return tt||(tt=[]),tt}_getLayerIndex(Q){let tt=this.layerIndexes[Q];return tt||(tt=this.layerIndexes[Q]=new l),tt}_getWorkerSource(Q,tt,rt){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][tt]||(this.workerSources[Q][tt]={}),!this.workerSources[Q][tt][rt]){const bt={sendAsync:(wt,Ft)=>(wt.targetMapId=Q,this.actor.sendAsync(wt,Ft))};switch(tt){case"vector":this.workerSources[Q][tt][rt]=new le(bt,this._getLayerIndex(Q),this._getAvailableImages(Q));break;case"geojson":this.workerSources[Q][tt][rt]=new Fl(bt,this._getLayerIndex(Q),this._getAvailableImages(Q));break;default:this.workerSources[Q][tt][rt]=new this.externalWorkerSourceTypes[tt](bt,this._getLayerIndex(Q),this._getAvailableImages(Q))}}return this.workerSources[Q][tt][rt]}_getDEMWorkerSource(Q,tt){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][tt]||(this.demWorkerSources[Q][tt]=new Oe),this.demWorkerSources[Q][tt]}}return m.i(self)&&(self.worker=new yn(self)),yn})),a("index",["exports","./shared"],(function(m,l){var w="5.12.0";function C(){var T=new l.A(4);return l.A!=Float32Array&&(T[1]=0,T[2]=0),T[0]=1,T[3]=1,T}let P,L,j;const G={frame(T,s,h){const _=requestAnimationFrame((A=>{b(),s(A)})),{unsubscribe:b}=l.s(T.signal,"abort",(()=>{b(),cancelAnimationFrame(_),h(l.c())}),!1)},frameAsync(T){return new Promise(((s,h)=>{this.frame(T,s,h)}))},getImageData(T,s=0){return this.getImageCanvasContext(T).getImageData(-s,-s,T.width+2*s,T.height+2*s)},getImageCanvasContext(T){const s=window.document.createElement("canvas"),h=s.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return s.width=T.width,s.height=T.height,h.drawImage(T,0,0,T.width,T.height),h},resolveURL:T=>(P||(P=document.createElement("a")),P.href=T,P.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return j!==void 0?j:!!matchMedia&&(L==null&&(L=matchMedia("(prefers-reduced-motion: reduce)")),L.matches)},set prefersReducedMotion(T){j=T}},nt=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(T){this._frozenAt=T}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function at(){return nt.getCurrentTime()}class J{static testProp(s){if(!J.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in J.docStyle)return s[h];return s[0]}static create(s,h,_){const b=window.document.createElement(s);return h!==void 0&&(b.className=h),_&&_.appendChild(b),b}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){J.docStyle&&J.selectProp&&(J.userSelect=J.docStyle[J.selectProp],J.docStyle[J.selectProp]="none")}static enableDrag(){J.docStyle&&J.selectProp&&(J.docStyle[J.selectProp]=J.userSelect)}static setTransform(s,h){s.style[J.transformProp]=h}static addEventListener(s,h,_,b={}){s.addEventListener(h,_,"passive"in b?b:b.capture)}static removeEventListener(s,h,_,b={}){s.removeEventListener(h,_,"passive"in b?b:b.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",J.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",J.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",J.suppressClickInternal,!0)}),0)}static getScale(s){const h=s.getBoundingClientRect();return{x:h.width/s.offsetWidth||1,y:h.height/s.offsetHeight||1,boundingClientRect:h}}static getPoint(s,h,_){const b=h.boundingClientRect;return new l.P((_.clientX-b.left)/h.x-s.clientLeft,(_.clientY-b.top)/h.y-s.clientTop)}static mousePos(s,h){const _=J.getScale(s);return J.getPoint(s,_,h)}static touchPos(s,h){const _=[],b=J.getScale(s);for(let A=0;A<h.length;A++)_.push(J.getPoint(s,b,h[A]));return _}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}static sanitize(s){const h=new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),_=h.querySelectorAll("script");for(const b of _)b.remove();return J.clean(h),h.innerHTML}static isPossiblyDangerous(s,h){const _=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(s)||!_.includes("javascript:")&&!_.includes("data:"))||!!s.startsWith("on")||void 0}static clean(s){const h=s.children;for(const _ of h)J.removeAttributes(_),J.clean(_)}static removeAttributes(s){for(const{name:h,value:_}of s.attributes)J.isPossiblyDangerous(h,_)&&s.removeAttribute(h)}}J.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,J.selectProp=J.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),J.transformProp=J.testProp(["transform","WebkitTransform"]);const mt={supported:!1,testSupport:function(T){!Pt&&pt&&(kt?$t(T):Mt=T)}};let Mt,pt,Pt=!1,kt=!1;function $t(T){const s=T.createTexture();T.bindTexture(T.TEXTURE_2D,s);try{if(T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,pt),T.isContextLost())return;mt.supported=!0}catch{}T.deleteTexture(s),Pt=!0}var ae;typeof document<"u"&&(pt=document.createElement("img"),pt.onload=()=>{Mt&&$t(Mt),Mt=null,kt=!0},pt.onerror=()=>{Pt=!0,Mt=null},pt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(T){let s,h,_,b;T.resetRequestQueue=()=>{s=[],h=0,_=0,b={}},T.addThrottleControl=O=>{const z=_++;return b[z]=O,z},T.removeThrottleControl=O=>{delete b[O],M()},T.getImage=(O,z,U=!0)=>new Promise(((q,H)=>{mt.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),l.e(O,{type:"image"}),s.push({abortController:z,requestParameters:O,supportImageRefresh:U,state:"queued",onError:Y=>{H(Y)},onSuccess:Y=>{q(Y)}}),M()}));const A=O=>l._(this,void 0,void 0,(function*(){O.state="running";const{requestParameters:z,supportImageRefresh:U,onError:q,onSuccess:H,abortController:Y}=O,et=U===!1&&!l.i(self)&&!l.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce(((ht,_t)=>ht&&_t==="accept"),!0));h++;const ot=et?k(z,Y):l.m(z,Y);try{const ht=yield ot;delete O.abortController,O.state="completed",ht.data instanceof HTMLImageElement||l.b(ht.data)?H(ht):ht.data&&H({data:yield(ct=ht.data,typeof createImageBitmap=="function"?l.f(ct):l.h(ct)),cacheControl:ht.cacheControl,expires:ht.expires})}catch(ht){delete O.abortController,q(ht)}finally{h--,M()}var ct})),M=()=>{const O=(()=>{for(const z of Object.keys(b))if(b[z]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=h;z<O&&s.length>0;z++){const U=s.shift();U.abortController.signal.aborted?z--:A(U)}},k=(O,z)=>new Promise(((U,q)=>{const H=new Image,Y=O.url,et=O.credentials;et&&et==="include"?H.crossOrigin="use-credentials":(et&&et==="same-origin"||!l.d(Y))&&(H.crossOrigin="anonymous"),z.signal.addEventListener("abort",(()=>{H.src="",q(l.c())})),H.fetchPriority="high",H.onload=()=>{H.onerror=H.onload=null,U({data:H})},H.onerror=()=>{H.onerror=H.onload=null,z.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},H.src=Y}))})(ae||(ae={})),ae.resetRequestQueue();class qt{constructor(s){this._transformRequestFn=s??null}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function le(T){const s=[];if(typeof T=="string")s.push({id:"default",url:T});else if(T&&T.length>0){const h=[];for(const{id:_,url:b}of T){const A=`${_}${b}`;h.indexOf(A)===-1&&(h.push(A),s.push({id:_,url:b}))}}return s}function Oe(T,s,h){try{const _=new URL(T);return _.pathname+=`${s}${h}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${T}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Be(T){const{userImage:s}=T;return!!(s&&s.render&&s.render())&&(T.data.replace(new Uint8Array(s.data.buffer)),!0)}class qe extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const s of Object.keys(this.images))this.removeImage(s);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,promiseResolve:_}of this.requestors)_(this._getImagesForIds(h));this.requestors=[]}}getImage(s){const h=this.images[s];if(h&&!h.data&&h.spriteData){const _=h.spriteData;h.data=new l.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),h.spriteData=null}return h}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let _=!0;const b=h.data||h.spriteData;return this._validateStretch(h.stretchX,b&&b.width)||(this.fire(new l.k(new Error(`Image "${s}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,b&&b.height)||(this.fire(new l.k(new Error(`Image "${s}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new l.k(new Error(`Image "${s}" has invalid "content" value`))),_=!1),_}_validateStretch(s,h){if(!s)return!0;let _=0;for(const b of s){if(b[0]<_||b[1]<b[0]||h<b[1])return!1;_=b[1]}return!0}_validateContent(s,h){if(!s)return!0;if(s.length!==4)return!1;const _=h.spriteData,b=_&&_.width||h.data.width,A=_&&_.height||h.data.height;return!(s[0]<0||b<s[0]||s[1]<0||A<s[1]||s[2]<0||b<s[2]||s[3]<0||A<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,h,_=!0){const b=this.getImage(s);if(_&&(b.data.width!==h.data.width||b.data.height!==h.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=b.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise(((h,_)=>{let b=!0;if(!this.isLoaded())for(const A of s)this.images[A]||(b=!1);this.isLoaded()||b?h(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:h})}))}_getImagesForIds(s){const h={};for(const _ of s){let b=this.getImage(_);b||(this.fire(new l.l("styleimagemissing",{id:_})),b=this.getImage(_)),b?h[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,textFitWidth:b.textFitWidth,textFitHeight:b.textFitHeight,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:l.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],_=this.getImage(s);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},A=new l.I(b,_);this.patterns[s]={bin:b,position:A}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const A in this.patterns)s.push(this.patterns[A].bin);const{w:h,h:_}=l.p(s),b=this.atlasImage;b.resize({width:h||1,height:_||1});for(const A in this.patterns){const{bin:M}=this.patterns[A],k=M.x+1,O=M.y+1,z=this.getImage(A).data,U=z.width,q=z.height;l.R.copy(z,b,{x:0,y:0},{x:k,y:O},{width:U,height:q}),l.R.copy(z,b,{x:0,y:q-1},{x:k,y:O-1},{width:U,height:1}),l.R.copy(z,b,{x:0,y:0},{x:k,y:O+q},{width:U,height:1}),l.R.copy(z,b,{x:U-1,y:0},{x:k-1,y:O},{width:1,height:q}),l.R.copy(z,b,{x:0,y:0},{x:k+U,y:O},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.getImage(h);_||l.w(`Image with ID: "${h}" was not found`),Be(_)&&this.updateImage(h,_)}}cloneImages(){const s={};for(const h in this.images){const _=this.images[h];s[h]=Object.assign(Object.assign({},_),{data:_.data?_.data.clone():null})}return s}}const ri=1e20;function Ne(T,s,h,_,b,A,M,k,O){for(let z=s;z<s+_;z++)wi(T,h*A+z,A,b,M,k,O);for(let z=h;z<h+b;z++)wi(T,z*A+s,1,_,M,k,O)}function wi(T,s,h,_,b,A,M){A[0]=0,M[0]=-ri,M[1]=ri,b[0]=T[s];for(let k=1,O=0,z=0;k<_;k++){b[k]=T[s+k*h];const U=k*k;do{const q=A[O];z=(b[k]-b[q]+U-q*q)/(k-q)/2}while(z<=M[O]&&--O>-1);O++,A[O]=k,M[O]=z,M[O+1]=ri}for(let k=0,O=0;k<_;k++){for(;M[O+1]<k;)O++;const z=A[O],U=k-z;T[s+k*h]=b[z]+U*U}}const ne=l.v.layout_symbol["text-font"].default.join(",");class we{constructor(s,h,_){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={},this.lang=_}setURL(s){this.url=s}getGlyphs(s){return l._(this,void 0,void 0,(function*(){const h=[];for(const A in s)for(const M of s[A])h.push(this._getAndCacheGlyphsPromise(A,M));const _=yield Promise.all(h),b={};for(const{stack:A,id:M,glyph:k}of _)b[A]||(b[A]={}),b[A][M]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return b}))}_getAndCacheGlyphsPromise(s,h){return l._(this,void 0,void 0,(function*(){let _=this.entries[s];_||(_=this.entries[s]={glyphs:{},requests:{},ranges:{}});let b=_.glyphs[h];return b!==void 0?{stack:s,id:h,glyph:b}:!this.url||this._charUsesLocalIdeographFontFamily(h)?(b=_.glyphs[h]=this._drawGlyph(_,s,h),{stack:s,id:h,glyph:b}):yield this._downloadAndCacheRangePromise(s,h)}))}_downloadAndCacheRangePromise(s,h){return l._(this,void 0,void 0,(function*(){const _=Math.floor(h/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");const b=this.entries[s];if(b.ranges[_])return{stack:s,id:h,glyph:null};if(!b.requests[_]){const A=we.loadGlyphRange(s,_,this.url,this.requestManager);b.requests[_]=A}try{const A=yield b.requests[_];for(const M in A)b.glyphs[+M]=A[+M];return b.ranges[_]=!0,{stack:s,id:h,glyph:A[h]||null}}catch(A){const M=b.glyphs[h]=this._drawGlyph(b,s,h);return this._warnOnMissingGlyphRange(M,_,h,A),{stack:s,id:h,glyph:M}}}))}_warnOnMissingGlyphRange(s,h,_,b){const A=256*h,M=A+255,k=_.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${h}, ${A}-${M}. Rendering codepoint U+${k} locally instead. ${b}`)}_charUsesLocalIdeographFontFamily(s){return!!this.localIdeographFontFamily&&l.q(s)}_drawGlyph(s,h,_){const b=h===ne&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(_),A=b?"ideographTinySDF":"tinySDF";s[A]||(s[A]=this._createTinySDF(b?this.localIdeographFontFamily:h));const M=s[A].draw(String.fromCharCode(_));return{id:_,bitmap:new l.r({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(s){const h=s?s.split(","):[];h.push("sans-serif");const _=h.map((b=>/[-\w]+/.test(b)?b:`'${CSS.escape(b)}'`)).join(",");return new we.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:this._fontWeight(h[0]),fontStyle:this._fontStyle(h[0]),lang:this.lang})}_fontStyle(s){return/italic/i.test(s)?"italic":/oblique/i.test(s)?"oblique":"normal"}_fontWeight(s){const h={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let _;for(const[b,A]of Object.entries(h))new RegExp(`\\b${b}\\b`,"i").test(s)&&(_=`${A}`);return _}destroy(){for(const s in this.entries){const h=this.entries[s];h.tinySDF&&(h.tinySDF=null),h.ideographTinySDF&&(h.ideographTinySDF=null),h.glyphs={},h.requests={},h.ranges={}}this.entries={}}}we.loadGlyphRange=function(T,s,h,_){return l._(this,void 0,void 0,(function*(){const b=256*s,A=b+255,M=_.transformRequest(h.replace("{fontstack}",T).replace("{range}",`${b}-${A}`),"Glyphs"),k=yield l.n(M,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${s}, ${b}-${A}`);const O={};for(const z of l.o(k.data))O[z.id]=z;return O}))},we.TinySDF=class{constructor({fontSize:T=24,buffer:s=3,radius:h=8,cutoff:_=.25,fontFamily:b="sans-serif",fontWeight:A="normal",fontStyle:M="normal",lang:k=null}={}){this.buffer=s,this.cutoff=_,this.radius=h,this.lang=k;const O=this.size=T+4*s,z=this._createCanvas(O),U=this.ctx=z.getContext("2d",{willReadFrequently:!0});U.font=`${M} ${A} ${T}px ${b}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(T){const s=document.createElement("canvas");return s.width=s.height=T,s}draw(T){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:_,actualBoundingBoxLeft:b,actualBoundingBoxRight:A}=this.ctx.measureText(T),M=Math.ceil(h),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(A-b))),O=Math.min(this.size-this.buffer,M+Math.ceil(_)),z=k+2*this.buffer,U=O+2*this.buffer,q=Math.max(z*U,0),H=new Uint8ClampedArray(q),Y={data:H,width:z,height:U,glyphWidth:k,glyphHeight:O,glyphTop:M,glyphLeft:0,glyphAdvance:s};if(k===0||O===0)return Y;const{ctx:et,buffer:ot,gridInner:ct,gridOuter:ht}=this;this.lang&&(et.lang=this.lang),et.clearRect(ot,ot,k,O),et.fillText(T,ot,ot+M);const _t=et.getImageData(ot,ot,k,O);ht.fill(ri,0,q),ct.fill(0,0,q);for(let Tt=0;Tt<O;Tt++)for(let gt=0;gt<k;gt++){const St=_t.data[4*(Tt*k+gt)+3]/255;if(St===0)continue;const Et=(Tt+ot)*z+gt+ot;if(St===1)ht[Et]=0,ct[Et]=ri;else{const xt=.5-St;ht[Et]=xt>0?xt*xt:0,ct[Et]=xt<0?xt*xt:0}}Ne(ht,0,0,z,U,z,this.f,this.v,this.z),Ne(ct,ot,ot,k,O,z,this.f,this.v,this.z);for(let Tt=0;Tt<q;Tt++){const gt=Math.sqrt(ht[Tt])-Math.sqrt(ct[Tt]);H[Tt]=Math.round(255-255*(gt/this.radius+this.cutoff))}return Y}};class ye{constructor(){this.specification=l.u.light.position}possiblyEvaluate(s,h){return l.C(s.expression.evaluate(h))}interpolate(s,h,_){return{x:l.F.number(s.x,h.x,_),y:l.F.number(s.y,h.y,_),z:l.F.number(s.z,h.z,_)}}}let Ue;class mi extends l.E{constructor(s){super(),Ue=Ue||new l.t({anchor:new l.D(l.u.light.anchor),position:new ye,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(Ue,void 0),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.y,s,h))for(const _ in s){const b=s[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,_){return(!_||_.validate!==!1)&&l.z(this,s.call(l.B,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const Dt=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class he extends l.E{constructor(s){super(),this._transitionable=new l.x(Dt,void 0),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.G(0))}setSky(s,h={}){if(!this._validate(l.H,s,h)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in s){const b=s[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,_={}){return _?.validate!==!1&&l.z(this,s.call(l.B,l.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class Ce{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const _=s.join(",")+String(h);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(s,h)),this.dashEntry[_]}getDashRanges(s,h,_){const b=[];let A=s.length%2==1?-s[s.length-1]*_:0,M=s[0]*_,k=!0;b.push({left:A,right:M,isDash:k,zeroLength:s[0]===0});let O=s[0];for(let z=1;z<s.length;z++){k=!k;const U=s[z];A=O*_,O+=U,M=O*_,b.push({left:A,right:M,isDash:k,zeroLength:U===0})}return b}addRoundDash(s,h,_){const b=h/2;for(let A=-_;A<=_;A++){const M=this.width*(this.nextRow+_+A);let k=0,O=s[k];for(let z=0;z<this.width;z++){z/O.right>1&&(O=s[++k]);const U=Math.abs(z-O.left),q=Math.abs(z-O.right),H=Math.min(U,q);let Y;const et=A/_*(b+1);if(O.isDash){const ot=b-Math.abs(et);Y=Math.sqrt(H*H+ot*ot)}else Y=b-Math.sqrt(H*H+et*et);this.data[M+z]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(s){for(let k=s.length-1;k>=0;--k){const O=s[k],z=s[k+1];O.zeroLength?s.splice(k,1):z&&z.isDash===O.isDash&&(z.left=O.left,s.splice(k,1))}const h=s[0],_=s[s.length-1];h.isDash===_.isDash&&(h.left=_.left-this.width,_.right=h.right+this.width);const b=this.width*this.nextRow;let A=0,M=s[A];for(let k=0;k<this.width;k++){k/M.right>1&&(M=s[++A]);const O=Math.abs(k-M.left),z=Math.abs(k-M.right),U=Math.min(O,z);this.data[b+k]=Math.max(0,Math.min(255,(M.isDash?U:-U)+128))}}addDash(s,h){const _=h?7:0,b=2*_+1;if(this.nextRow+b>this.height)return l.w("LineAtlas out of space"),null;let A=0;for(let k=0;k<s.length;k++)A+=s[k];if(A!==0){const k=this.width/A,O=this.getDashRanges(s,this.width,k);h?this.addRoundDash(O,k,_):this.addRegularDash(O)}const M={y:this.nextRow+_,height:2*_,width:A};return this.nextRow+=b,this.dirty=!0,M}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Me="maplibre_preloaded_worker_pool";class ei{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<ei.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach((h=>{h.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Me]}numActive(){return Object.keys(this.active).length}}const ii=Math.floor(G.hardwareConcurrency/2);let Je,zi;function Ui(){return Je||(Je=new ei),Je}ei.workerCount=l.J(globalThis)?Math.max(Math.min(ii,3),1):1;class Ar{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=h;const _=this.workerPool.acquire(h);for(let b=0;b<_.length;b++){const A=new l.K(_[b],h);A.name=`Worker ${b}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h){const _=[];for(const b of this.actors)_.push(b.sendAsync({type:s,data:h}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach((h=>{h.remove()})),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,h){for(const _ of this.actors)_.registerMessageHandler(s,h)}unregisterMessageHandler(s){for(const h of this.actors)h.unregisterMessageHandler(s)}}function gs(){return zi||(zi=new Ar(Ui(),l.L),zi.registerMessageHandler("GR",((T,s,h)=>l.m(s,h)))),zi}function ar(T,s){const h=l.M();return l.N(h,h,[1,1,0]),l.O(h,h,[.5*T.width,.5*T.height,1]),T.calculatePosMatrix?l.Q(h,h,T.calculatePosMatrix(s.toUnwrapped())):h}function Dc(T,s,h,_,b,A,M){var k;const O=(function(H,Y,et){if(H)for(const ot of H){const ct=Y[ot];if(ct&&ct.source===et&&ct.type==="fill-extrusion")return!0}else for(const ot in Y){const ct=Y[ot];if(ct.source===et&&ct.type==="fill-extrusion")return!0}return!1})((k=b?.layers)!==null&&k!==void 0?k:null,s,T.id),z=A.maxPitchScaleFactor(),U=T.tilesIn(_,z,O);U.sort($i);const q=[];for(const H of U)q.push({wrappedTileID:H.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(s,h,T.getState(),H.queryGeometry,H.cameraQueryGeometry,H.scale,b,A,z,ar(A,H.tileID),M?(Y,et)=>M(H.tileID,Y,et):void 0)});return(function(H,Y){for(const et in H)for(const ot of H[et])Ds(ot,Y);return H})((function(H){const Y={},et={};for(const ot of H){const ct=ot.queryResults,ht=ot.wrappedTileID,_t=et[ht]=et[ht]||{};for(const Tt in ct){const gt=ct[Tt],St=_t[Tt]=_t[Tt]||{},Et=Y[Tt]=Y[Tt]||[];for(const xt of gt)St[xt.featureIndex]||(St[xt.featureIndex]=!0,Et.push(xt))}}return Y})(q),T)}function $i(T,s){const h=T.tileID,_=s.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Ds(T,s){const h=T.feature,_=s.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=_}function $s(T,s,h){return l._(this,void 0,void 0,(function*(){let _=T;if(T.url?_=(yield l.j(s.transformRequest(T.url,"Source"),h)).data:yield G.frameAsync(h),!_)return null;const b=l.S(l.e(_,T),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(b.vectorLayerIds=_.vector_layers.map((A=>A.id))),b}))}class wn{constructor(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof l.U?new l.U(s.lng,s.lat):l.U.convert(s),this}setSouthWest(s){return this._sw=s instanceof l.U?new l.U(s.lng,s.lat):l.U.convert(s),this}extend(s){const h=this._sw,_=this._ne;let b,A;if(s instanceof l.U)b=s,A=s;else{if(!(s instanceof wn))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(wn.convert(s)):this.extend(l.U.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(l.U.convert(s)):this;if(b=s._sw,A=s._ne,!b||!A)return this}return h||_?(h.lng=Math.min(b.lng,h.lng),h.lat=Math.min(b.lat,h.lat),_.lng=Math.max(A.lng,_.lng),_.lat=Math.max(A.lat,_.lat)):(this._sw=new l.U(b.lng,b.lat),this._ne=new l.U(A.lng,A.lat)),this}getCenter(){return new l.U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.U(this.getWest(),this.getNorth())}getSouthEast(){return new l.U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:h,lat:_}=l.U.convert(s);let b=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&b}intersects(s){if((s=wn.convert(s)).getNorth()<this.getSouth()||s.getSouth()>this.getNorth())return!1;const h=l.V(this.getWest(),-180,180),_=l.V(this.getEast(),-180,180),b=l.V(s.getWest(),-180,180),A=l.V(s.getEast(),-180,180),M=h>_,k=b>A;return!(!M||!k)||(M?A>=h||b<=_:k?_>=b||h<=A:!(b>_||A<h))}static convert(s){return s instanceof wn?s:s&&new wn(s)}static fromLngLat(s,h=0){const _=360*h/40075017,b=_/Math.cos(Math.PI/180*s.lat);return new wn(new l.U(s.lng-b,s.lat-_),new l.U(s.lng+b,s.lat+_))}adjustAntiMeridian(){const s=new l.U(this._sw.lng,this._sw.lat),h=new l.U(this._ne.lng,this._ne.lat);return new wn(s,s.lng>h.lng?new l.U(h.lng+360,h.lat):h)}}class aa{constructor(s,h,_){this.bounds=wn.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),_=Math.floor(l.X(this.bounds.getWest())*h),b=Math.floor(l.W(this.bounds.getNorth())*h),A=Math.ceil(l.X(this.bounds.getEast())*h),M=Math.ceil(l.W(this.bounds.getSouth())*h);return s.x>=_&&s.x<A&&s.y>=b&&s.y<M}}class Hs extends l.E{constructor(s,h,_,b){if(super(),this.id=s,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.S(h,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield $s(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),s&&(l.e(this,s),s.bounds&&(this.tileBounds=new aa(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,this.fire(new l.k(s))}}))}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(s){return l._(this,void 0,void 0,(function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(h,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(s)};_.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise(((A,M)=>{s.reloadPromise={resolve:A,reject:M}}))}else s.actor=this.dispatcher.getActor(),b="LT";s.abortController=new AbortController;try{const A=yield s.actor.sendAsync({type:b,data:_},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,A)}catch(A){if(delete s.abortController,s.aborted)return;if(A&&A.status!==404)throw A;this._afterTileLoadWorkerResponse(s,null)}}))}_getOverzoomParameters(s){if(s.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const h=s.tileID.scaledTo(this.maxzoom).canonical,_=h.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:h,overzoomRequest:this.map._requestManager.transformRequest(_,"Tile")}}_afterTileLoadWorkerResponse(s,h){if(h&&h.resourceTiming&&(s.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&s.setExpiryData(h),s.loadVectorData(h,this.map.painter),s.reloadPromise){const _=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(_.resolve).catch(_.reject)}}abortTile(s){return l._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class qo extends l.E{constructor(s,h,_,b){super(),this.id=s,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},h),l.e(this,l.S(h,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(s=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const h=yield $s(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,h&&(l.e(this,h),h.bounds&&(this.tileBounds=new aa(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:s})))}catch(h){this._tileJSONRequest=null,this._loaded=!0,this.fire(new l.k(h))}}))}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load(!0)}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}serialize(){return l.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return l._(this,void 0,void 0,(function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const _=yield ae.getImage(this.map._requestManager.transformRequest(h,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&s.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const b=this.map.painter.context,A=b.gl,M=_.data;s.texture=this.map.painter.getTileTexture(M.width),s.texture?s.texture.update(M,{useMipmap:!0}):(s.texture=new l.T(b,M,A.RGBA,{useMipmap:!0}),s.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(_){if(delete s.abortController,s.aborted)s.state="unloaded";else if(_)throw s.state="errored",_}}))}abortTile(s){return l._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)}))}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)}))}hasTransition(){return!1}}class Pa extends qo{constructor(s,h,_,b){super(s,h,_,b),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(s){return l._(this,void 0,void 0,(function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(h,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const b=yield ae.getImage(_,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(b&&b.data){const A=b.data;this.map._refreshExpiredTiles&&(b.cacheControl||b.expires)&&s.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const M=l.b(A)&&l.Y()?A:yield this.readImageNow(A),k={type:this.type,uid:s.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const O=yield s.actor.sendAsync({type:"LDT",data:k});s.dem=O,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(b){if(delete s.abortController,s.aborted)s.state="unloaded";else if(b)throw s.state="errored",b}}))}readImageNow(s){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.Z()){const h=s.width+2,_=s.height+2;try{return new l.R({width:h,height:_},yield l.$(s,-1,-1,h,_))}catch{}}return G.getImageData(s,1)}))}_getNeighboringTiles(s){const h=s.canonical,_=Math.pow(2,h.z),b=(h.x-1+_)%_,A=h.x===0?s.wrap-1:s.wrap,M=(h.x+1+_)%_,k=h.x+1===_?s.wrap+1:s.wrap,O={};return O[new l.a0(s.overscaledZ,A,h.z,b,h.y).key]={backfilled:!1},O[new l.a0(s.overscaledZ,k,h.z,M,h.y).key]={backfilled:!1},h.y>0&&(O[new l.a0(s.overscaledZ,A,h.z,b,h.y-1).key]={backfilled:!1},O[new l.a0(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},O[new l.a0(s.overscaledZ,k,h.z,M,h.y-1).key]={backfilled:!1}),h.y+1<_&&(O[new l.a0(s.overscaledZ,A,h.z,b,h.y+1).key]={backfilled:!1},O[new l.a0(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},O[new l.a0(s.overscaledZ,k,h.z,M,h.y+1).key]={backfilled:!1}),O}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))}))}}function Ia(T){return T.type==="GeometryCollection"?T.geometries.map((s=>s.coordinates)).flat(1/0):T.coordinates.flat(1/0)}function Xo(T){const s=new wn;let h;switch(T.type){case"FeatureCollection":h=T.features.map((_=>Ia(_.geometry))).flat(1/0);break;case"Feature":h=Ia(T.geometry);break;default:h=Ia(T)}if(h.length==0)return s;for(let _=0;_<h.length-1;_+=2)s.extend([h[_],h[_+1]]);return s}class or extends l.E{constructor(s,h,_,b){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:h.data},this.actor=_.getActor(),this.setEventedParent(b),this._data=h.data,this._options=l.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:l.a3,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(h.clusterMaxZoom),minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.a3,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(s){return s*(l.a3/this.tileSize)}_getClusterMaxZoom(s){const h=s?Math.round(s):this.maxzoom-1;return Number.isInteger(s)||s===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${s}" rounded to "${h}"`),h}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._pendingWorkerUpdate={data:s},this._updateWorkerData(),this}updateData(s){return this._pendingWorkerUpdate.diff=l.a4(this._pendingWorkerUpdate.diff,s),this._updateWorkerData(),this}getData(){return l._(this,void 0,void 0,(function*(){const s=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return Xo(yield this.getData())}))}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(s.clusterRadius)),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(s.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,h,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:h,offset:_}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:s,diff:h}=this._pendingWorkerUpdate,_=l.e({type:this.type},this.workerOptions);s?(typeof s=="string"?(_.request=this.map._requestManager.transformRequest(G.resolveURL(s),"Source"),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(s),this._pendingWorkerUpdate.data=void 0):h&&(_.dataDiff=h,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const b=yield this.actor.sendAsync({type:"LD",data:_});if(this._isUpdatingWorker=!1,this._removed||b.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));this._data=b.data;let A=null;b.resourceTiming&&b.resourceTiming[this.id]&&(A=b.resourceTiming[this.id].slice(0));const M={dataType:"source"};this._collectResourceTiming&&A&&A.length>0&&l.e(M,{resourceTiming:A}),this.fire(new l.l("data",Object.assign(Object.assign({},M),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},M),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(h)})))}catch(b){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(b))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_getShouldReloadTileOptions(s){if(!s||s.removeAll)return;const{add:h=[],update:_=[],remove:b=[]}=s||{},A=new Set([..._.map((M=>M.id)),...b]);return{nextBounds:[..._.map((M=>M.newGeometry)),...h.map((M=>M.geometry))].map((M=>Xo(M))),prevIds:A}}shouldReloadTile(s,{nextBounds:h,prevIds:_}){const b=s.latestFeatureIndex.loadVTLayers();for(let O=0;O<s.latestFeatureIndex.featureIndexArray.length;O++){const z=s.latestFeatureIndex.featureIndexArray.get(O),U=b._geojsonTileLayer.feature(z.featureIndex);if(_.has(U.id))return!0}const{buffer:A,extent:M}=this.workerOptions.geojsonVtOptions,k=(function({x:O,y:z,z:U},q=0){const H=l.a1((O-q)/Math.pow(2,U)),Y=l.a2((z+1+q)/Math.pow(2,U)),et=l.a1((O+1+q)/Math.pow(2,U)),ot=l.a2((z-q)/Math.pow(2,U));return new wn([H,Y],[et,ot])})(s.tileID.canonical,A/M);for(const O of h)if(k.intersects(O))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(s){return l._(this,void 0,void 0,(function*(){const h=s.actor?"RT":"LT";s.actor=this.actor;const _={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};s.abortController=new AbortController;const b=yield this.actor.sendAsync({type:h,data:_},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(b,this.map.painter,h==="RT")}))}abortTile(s){return l._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0}))}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class _s extends l.E{constructor(s,h,_,b){super(),this.flippedWindingOrder=!1,this.id=s,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}load(s){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield ae.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,s&&(this.coordinates=s),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new l.k(h))}}))}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const h=s.map(l.a5.fromLngLat);var _;return this.tileID=(function(b){const A=l.a6.fromPoints(b),M=A.width(),k=A.height(),O=Math.max(M,k),z=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),U=Math.pow(2,z);return new l.a8(z,Math.floor((A.minX+A.maxX)/2*U),Math.floor((A.minY+A.maxY)/2*U))})(h),this.terrainTileRanges=this._getOverlappingTileRanges(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map((b=>this.tileID.getTilePoint(b)._round())),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.texture||(this.texture=new l.T(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,_=!0)}_&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(s){const{minX:h,minY:_,maxX:b,maxY:A}=l.a6.fromPoints(s),M={};for(let k=0;k<=l.a7;k++){const O=Math.pow(2,k),z=Math.floor(h*O),U=Math.floor(_*O),q=Math.floor(b*O),H=Math.floor(A*O);M[k]={minTileX:z,minTileY:U,maxTileX:q,maxTileY:H}}return M}}class kc extends _s{constructor(s,h,_,b){super(s,h,_,b),this.roundZoom=!0,this.type="video",this.options=h}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield l.a9(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new l.k(h))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new l.k(new l.aa(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,_=!0)}_&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Oc extends _s{constructor(s,h,_,b){super(s,h,_,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some((A=>!Array.isArray(A)||A.length!==2||A.some((M=>typeof M!="number"))))||this.fire(new l.k(new l.aa(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.aa(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.k(new l.aa(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.aa(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.aa(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,_=h.gl;this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.T(h,this.canvas,_.RGBA,{premultiply:!0});let b=!1;for(const A in this.tiles){const M=this.tiles[A];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,b=!0)}b&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Da={},Bc=T=>{switch(T){case"geojson":return or;case"image":return _s;case"raster":return qo;case"raster-dem":return Pa;case"vector":return Hs;case"video":return kc;case"canvas":return Oc}return Da[T]},so="RTLPluginLoaded";class Lc extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=gs()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch((h=>{throw this.status="error",h}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return l._(this,arguments,void 0,(function*(h,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=G.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(so))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Fl=null;function ts(){return Fl||(Fl=new Lc),Fl}var yn,Ct;(function(T){T[T.Base=0]="Base",T[T.Parent=1]="Parent"})(yn||(yn={})),(function(T){T[T.Departing=0]="Departing",T[T.Incoming=1]="Incoming"})(Ct||(Ct={}));class Q{constructor(s,h){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=s,this.uid=l.ab(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(s){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(s||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:s,fadingDirection:h,fadingParentID:_,fadeEndTime:b}){this.resetFadeLogic(),this.fadingRole=s,this.fadingDirection=h,this.fadingParentID=_,this.fadeEndTime=b}setSelfFadeLogic(s){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=s}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=at(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,h,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData,this.latestFeatureIndex.encoding=s.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=(function(b,A){const M={};if(!A)return M;for(const k of b){const O=k.layerIds.map((z=>A.getLayer(z))).filter(Boolean);if(O.length!==0){k.layers=O,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map((z=>O.filter((U=>U.id===z))[0])));for(const z of O)M[z.id]=k}}return M})(s.buckets,h?.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const A=this.buckets[b];if(A instanceof l.ad){if(this.hasSymbolBuckets=!0,!_)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const A=this.buckets[b];if(A instanceof l.ad&&A.hasRTLText){this.hasRTLText=!0,ts().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const A=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(b).queryRadius(A))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),this.dashPositions=s.dashPositions}else this.collisionBoxArray=new l.ac}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,_,b,A,M,k,O,z,U,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:A,scale:M,tileSize:this.tileSize,pixelPosMatrix:U,transform:O,params:k,queryPadding:this.queryPadding*z,getElevation:q},s,h,_):{}}querySourceFeatures(s,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const b=_.loadVTLayers(),A=h&&h.sourceLayer?h.sourceLayer:"",M=b._geojsonTileLayer||b[A];if(!M)return;const k=l.ae(h?.filter,h?.globalState),{z:O,x:z,y:U}=this.tileID.canonical,q={z:O,x:z,y:U};for(let H=0;H<M.length;H++){const Y=M.feature(H);if(k.needGeometry){const ct=l.af(Y,!0);if(!k.filter(new l.G(this.tileID.overscaledZ),ct,this.tileID.canonical))continue}else if(!k.filter(new l.G(this.tileID.overscaledZ),Y))continue;const et=_.getId(Y,A),ot=new l.ag(Y,O,z,U,et);ot.tile=q,s.push(ot)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const _=l.ah(s.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const _=Date.now();let b=!1;if(this.expirationTime>_)b=!1;else if(h)if(this.expirationTime<h)b=!0;else{const A=this.expirationTime-h;A?this.expirationTime=_+Math.max(A,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!h.style.hasLayer(b))continue;const A=this.buckets[b],M=A.layers[0].sourceLayer||"_geojsonTileLayer",k=_[M],O=s[M];if(!k||!O||Object.keys(O).length===0)continue;A.update(O,k,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const z=h&&h.style&&h.style.getLayer(b);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(A)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<at()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(s){this.symbolFadeHoldUntil=at()+s}setDependencies(s,h){const _={};for(const b of h)_[b]=!0;this.dependencies[s]=_}hasDependency(s,h){for(const _ of s){const b=this.dependencies[_];if(b){for(const A of h)if(b[A])return!0}}return!1}}class tt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,_){const b=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][b]=this.stateChanges[s][b]||{},l.e(this.stateChanges[s][b],_),this.deletedStates[s]===null){this.deletedStates[s]={};for(const A in this.state[s])A!==b&&(this.deletedStates[s][A]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][b]===null){this.deletedStates[s][b]={};for(const A in this.state[s][b])_[A]||(this.deletedStates[s][b][A]=null)}else for(const A in _)this.deletedStates[s]&&this.deletedStates[s][b]&&this.deletedStates[s][b][A]===null&&delete this.deletedStates[s][b][A]}removeFeatureState(s,h,_){if(this.deletedStates[s]===null)return;const b=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},_&&h!==void 0)this.deletedStates[s][b]!==null&&(this.deletedStates[s][b]=this.deletedStates[s][b]||{},this.deletedStates[s][b][_]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][b])for(_ in this.deletedStates[s][b]={},this.stateChanges[s][b])this.deletedStates[s][b][_]=null;else this.deletedStates[s][b]=null;else this.deletedStates[s]=null}getState(s,h){const _=String(h),b=l.e({},(this.state[s]||{})[_],(this.stateChanges[s]||{})[_]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const A=this.deletedStates[s][h];if(A===null)return{};for(const M in A)delete b[M]}return b}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const _={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const A={};for(const M in this.stateChanges[b])this.state[b][M]||(this.state[b][M]={}),l.e(this.state[b][M],this.stateChanges[b][M]),A[M]=this.state[b][M];_[b]=A}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const A={};if(this.deletedStates[b]===null)for(const M in this.state[b])A[M]={},this.state[b][M]={};else for(const M in this.deletedStates[b]){if(this.deletedStates[b][M]===null)this.state[b][M]={};else for(const k of Object.keys(this.deletedStates[b][M]))delete this.state[b][M][k];A[M]=this.state[b][M]}_[b]=_[b]||{},l.e(_[b],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const b in s)s[b].setFeatureState(_,h)}}const rt=89.25;function bt(T,s){const h=l.ai(s.lat,-l.aj,l.aj);return new l.P(l.X(s.lng)*T,l.W(h)*T)}function wt(T,s){return new l.a5(s.x/T,s.y/T).toLngLat()}function Ft(T){return T.cameraToCenterDistance*Math.min(.85*Math.tan(l.ak(90-T.pitch)),Math.tan(l.ak(rt-T.pitch)))}function ut(T,s){const h=T.canonical,_=s/l.al(h.z),b=h.x+Math.pow(2,h.z)*T.wrap,A=l.am(new Float64Array(16));return l.N(A,A,[b*_,h.y*_,0]),l.O(A,A,[_/l.a3,_/l.a3,1]),A}function Ot(T,s,h,_,b){const A=l.a5.fromLngLat(T,s),M=b*l.an(1,T.lat),k=M*Math.cos(l.ak(h)),O=Math.sqrt(M*M-k*k),z=O*Math.sin(l.ak(-_)),U=O*Math.cos(l.ak(-_));return new l.a5(A.x+z,A.y+U,A.z+k)}function Kt(T,s,h){const _=s.intersectsFrustum(T);if(!h||_===0)return _;const b=s.intersectsPlane(h);return b===0?0:_===2&&b===2?2:1}function te(T,s,h){let _=0;const b=(h-s)/10;for(let A=0;A<10;A++)_+=b*Math.pow(Math.cos(s+(A+.5)/10*(h-s)),T);return _}function ie(T,s){return function(h,_,b,A,M){const k=2*((T-1)/l.ao(Math.cos(l.ak(rt-M))/Math.cos(l.ak(rt)))-1),O=Math.acos(b/A),z=2*te(k-1,0,l.ak(M/2)),U=Math.min(l.ak(rt),O+l.ak(M/2)),q=te(k-1,Math.min(U,O-l.ak(M/2)),U),H=Math.atan(_/b),Y=Math.hypot(_,b);let et=h;return et+=l.ao(A/Y/Math.max(.5,Math.cos(l.ak(M/2)))),et+=k*l.ao(Math.cos(H))/2,et-=l.ao(Math.max(1,q/z/s))/2,et}}const De=ie(9.314,3);function He(T,s){const h=(s.roundZoom?Math.round:Math.floor)(T.zoom+l.ao(T.tileSize/s.tileSize));return Math.max(0,h)}function si(T,s){const h=T.getCameraFrustum(),_=T.getClippingPlane(),b=T.screenPointToMercatorCoordinate(T.getCameraPoint()),A=l.a5.fromLngLat(T.center,T.elevation);b.z=A.z+Math.cos(T.pitchInRadians)*T.cameraToCenterDistance/T.worldSize;const M=T.getCoveringTilesDetailsProvider(),k=M.allowVariableZoom(T,s),O=He(T,s),z=s.minzoom||0,U=s.maxzoom!==void 0?s.maxzoom:T.maxZoom,q=Math.min(Math.max(0,O),U),H=Math.pow(2,q),Y=[H*b.x,H*b.y,0],et=[H*A.x,H*A.y,0],ot=Math.hypot(A.x-b.x,A.y-b.y),ct=Math.abs(A.z-b.z),ht=Math.hypot(ot,ct),_t=St=>({zoom:0,x:0,y:0,wrap:St,fullyVisible:!1}),Tt=[],gt=[];if(T.renderWorldCopies&&M.allowWorldCopies())for(let St=1;St<=3;St++)Tt.push(_t(-St)),Tt.push(_t(St));for(Tt.push(_t(0));Tt.length>0;){const St=Tt.pop(),Et=St.x,xt=St.y;let Bt=St.fullyVisible;const Gt={x:Et,y:xt,z:St.zoom},Ht=M.getTileBoundingVolume(Gt,St.wrap,T.elevation,s);if(!Bt){const Te=Kt(h,Ht,_);if(Te===0)continue;Bt=Te===2}const Wt=M.distanceToTile2d(b.x,b.y,Gt,Ht);let Yt=O;k&&(Yt=(s.calculateTileZoom||De)(T.zoom+l.ao(T.tileSize/s.tileSize),Wt,ct,ht,T.fov)),Yt=(s.roundZoom?Math.round:Math.floor)(Yt),Yt=Math.max(0,Yt);const ve=Math.min(Yt,U);if(St.wrap=M.getWrap(A,Gt,St.wrap),St.zoom>=ve){if(St.zoom<z)continue;const Te=q-St.zoom,ce=Y[0]-.5-(Et<<Te),ke=Y[1]-.5-(xt<<Te),Ve=s.reparseOverscaled?Math.max(St.zoom,Yt):St.zoom;gt.push({tileID:new l.a0(St.zoom===U?Ve:St.zoom,St.wrap,St.zoom,Et,xt),distanceSq:l.ap([et[0]-.5-Et,et[1]-.5-xt]),tileDistanceToCamera:Math.sqrt(ce*ce+ke*ke)})}else for(let Te=0;Te<4;Te++)Tt.push({zoom:St.zoom+1,x:(Et<<1)+Te%2,y:(xt<<1)+(Te>>1),wrap:St.wrap,fullyVisible:Bt})}return gt.sort(((St,Et)=>St.distanceSq-Et.distanceSq)).map((St=>St.tileID))}const Mn=l.a6.fromPoints([new l.P(0,0),new l.P(l.a3,l.a3)]);class gi extends l.E{constructor(s,h,_){super(),this.id=s,this.dispatcher=_,this.on("data",(b=>this._dataHandler(b))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((b,A,M,k)=>{const O=new(Bc(A.type))(b,A,M,k);if(O.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${O.id}`);return O})(s,h,_,this),this._tiles={},this._cache=new l.aq(0,(b=>this._unloadTile(b))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new tt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h,_){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,h,_)}catch(b){s.state="errored",b.status!==404?this._source.fire(new l.k(b,{tile:s})):this.update(this.transform,this.terrain)}}))}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new l.l("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(s),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((s=>s.tileID)).sort(Bi).map((s=>s.key))}getRenderableIds(s){const h=[];for(const _ in this._tiles)this._isIdRenderable(_,s)&&h.push(this._tiles[_]);return s?h.sort(((_,b)=>{const A=_.tileID,M=b.tileID,k=new l.P(A.canonical.x,A.canonical.y)._rotate(-this.transform.bearingInRadians),O=new l.P(M.canonical.x,M.canonical.y)._rotate(-this.transform.bearingInRadians);return A.overscaledZ-M.overscaledZ||O.y-k.y||O.x-k.x})).map((_=>_.tileID.key)):h.map((_=>_.tileID)).sort(Bi).map((_=>_.key))}hasRenderableParent(s){const h=s.overscaledZ-1;if(h>=this._source.minzoom){const _=this.getLoadedTile(s.scaledTo(h));if(_)return this._isIdRenderable(_.tileID.key)}return!1}_isIdRenderable(s,h=!1){var _;return(_=this._tiles[s])===null||_===void 0?void 0:_.isRenderable(h)}reload(s,h=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const _ in this._tiles)h&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[_],h)||(s?this._reloadTile(_,"expired"):this._tiles[_].state!=="errored"&&this._reloadTile(_,"reloading"))}}_reloadTile(s,h){return l._(this,void 0,void 0,(function*(){const _=this._tiles[s];_&&(_.state!=="loading"&&(_.state=h),yield this._loadTile(_,s,h))}))}_tileLoaded(s,h,_){s.timeAdded=at(),s.selfFading&&(s.fadeEndTime=s.timeAdded+this._rasterFadeDuration),_==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let b=0;b<h.length;b++){const A=h[b];if(s.neighboringTiles&&s.neighboringTiles[A]){const M=this.getTileByID(A);_(s,M),_(M,s)}}function _(b,A){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let M=A.tileID.canonical.x-b.tileID.canonical.x;const k=A.tileID.canonical.y-b.tileID.canonical.y,O=Math.pow(2,b.tileID.canonical.z),z=A.tileID.key;M===0&&k===0||Math.abs(k)>1||(Math.abs(M)>1&&(Math.abs(M+O)===1?M+=O:Math.abs(M-O)===1&&(M-=O)),A.dem&&b.dem&&(b.dem.backfillBorder(A.dem,M,k),b.neighboringTiles&&b.neighboringTiles[z]&&(b.neighboringTiles[z].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h){const _=Object.values(s),b=this._getLoadedDescendents(_),A={};for(const M of _){const k=b[M.key];if(!k?.length){A[M.key]=M;continue}const O=M.overscaledZ+gi.maxUnderzooming,z=k.filter((H=>H.tileID.overscaledZ<=O));if(!z.length){A[M.key]=M;continue}const U=Math.min(...z.map((H=>H.tileID.overscaledZ))),q=z.filter((H=>H.tileID.overscaledZ===U)).map((H=>H.tileID));for(const H of q)h[H.key]=H;this._areDescendentsComplete(q,U,M.overscaledZ)||(A[M.key]=M)}return A}_getLoadedDescendents(s){var h;const _={};for(const b in this._tiles){const A=this._tiles[b];if(A.hasData())for(const M of s)A.tileID.isChildOf(M)&&(_[h=M.key]||(_[h]=[])).push(A)}return _}_areDescendentsComplete(s,h,_){return s.length===1&&s[0].isOverscaled()?s[0].overscaledZ===h:Math.pow(4,h-_)===s.length}getLoadedTile(s){const h=this._tiles[s.key];return h?.hasData()?h:null}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,_=Math.ceil(s.height/this._source.tileSize)+1,b=Math.floor(h*_*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(A)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const _={};for(const b in this._tiles){const A=this._tiles[b];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),_[A.tileID.key]=A}this._tiles=_,this._resetTileReloadTimers()}}update(s,h){if(!this._sourceLoaded||this._paused)return;let _;this.transform=s,this.terrain=h,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?_=s.getVisibleUnwrappedCoordinates(this._source.tileID).map((O=>new l.a0(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y))):(_=si(s,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?s.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter((O=>this._source.hasTile(O))))):_=[],this.usedForTerrain&&(_=this._addTerrainIdealTiles(_));const b=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=He(s,this._source),M=this._updateRetainedTiles(_,A),k=Qi(this._source.type);k&&this._rasterFadeDuration>0&&!h&&this._updateFadingTiles(_,M),k?this._cleanUpRasterTiles(M):this._cleanUpVectorTiles(M)}_cleanUpRasterTiles(s){for(const h in this._tiles)s[h]||this._removeTile(h)}_cleanUpVectorTiles(s){for(const h in this._tiles){const _=this._tiles[h];s[h]?_.clearSymbolFadeHold():_.hasSymbolBuckets?_.holdingForSymbolFade()?_.symbolFadeFinished()&&this._removeTile(h):_.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(h)}}_addTerrainIdealTiles(s){const h=[];for(const _ of s)if(_.canonical.z>this._source.minzoom){const b=_.scaledTo(_.canonical.z-1);h.push(b);const A=_.scaledTo(Math.max(this._source.minzoom,Math.min(_.canonical.z,5)));h.push(A)}return s.concat(h)}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForSymbolFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){var _;const b={},A={},M=Math.max(h-gi.maxOverzooming,this._source.minzoom);let k={};for(const O of s){const z=this._addTile(O);b[O.key]=O,z.hasData()||(k[O.key]=O)}k=this._retainLoadedChildren(k,b);for(const O in k){const z=k[O];let U=this._tiles[O],q=U?.wasRequested();for(let H=z.overscaledZ-1;H>=M;--H){const Y=z.scaledTo(H);if(A[Y.key])break;if(A[Y.key]=!0,U=this.getTile(Y),!U&&q&&(U=this._addTile(Y)),U){const et=U.hasData();if((et||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||q)&&(b[Y.key]=Y),q=U.wasRequested(),et)break}}}return b}_updateFadingTiles(s,h){const _=at(),b=l.ar(s);for(const A of s){const M=this._tiles[A.key];M.fadingDirection!==Ct.Departing&&M.fadeOpacity!==0||M.resetFadeLogic(),this._updateFadingAncestor(M,h,_)||this._updateFadingDescendents(M,h,_)||this._updateFadingEdge(M,b,_)||M.resetFadeLogic()}}_updateFadingAncestor(s,h,_){if(!s.hasData())return!1;const{tileID:b,fadingRole:A,fadingDirection:M,fadingParentID:k}=s;if(A===yn.Base&&M===Ct.Incoming&&k)return h[k.key]=k,!0;const O=Math.max(b.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let z=b.overscaledZ-1;z>=O;z--){const U=b.scaledTo(z),q=this.getLoadedTile(U);if(q)return s.setCrossFadeLogic({fadingRole:yn.Base,fadingDirection:Ct.Incoming,fadingParentID:q.tileID,fadeEndTime:_+this._rasterFadeDuration}),q.setCrossFadeLogic({fadingRole:yn.Parent,fadingDirection:Ct.Departing,fadeEndTime:_+this._rasterFadeDuration}),h[U.key]=U,!0}return!1}_updateFadingDescendents(s,h,_){if(!s.hasData())return!1;const b=s.tileID.children(this._source.maxzoom);let A=this._updateFadingChildren(s,b,h,_);if(A)return!0;for(const M of b){const k=M.children(this._source.maxzoom);this._updateFadingChildren(s,k,h,_)&&(A=!0)}return A}_updateFadingChildren(s,h,_,b){if(h[0].overscaledZ>=this._source.maxzoom)return!1;let A=!1;for(const M of h){const k=this.getLoadedTile(M);if(!k)continue;const{fadingRole:O,fadingDirection:z,fadingParentID:U}=k;O===yn.Base&&z===Ct.Departing&&U||(k.setCrossFadeLogic({fadingRole:yn.Base,fadingDirection:Ct.Departing,fadingParentID:s.tileID,fadeEndTime:b+this._rasterFadeDuration}),s.setCrossFadeLogic({fadingRole:yn.Parent,fadingDirection:Ct.Incoming,fadeEndTime:b+this._rasterFadeDuration})),_[M.key]=M,A=!0}return A}_updateFadingEdge(s,h,_){const b=s.tileID;return!!s.selfFading||!s.hasData()&&!!h.has(b)&&(s.setSelfFadeLogic(_+this._rasterFadeDuration),!0)}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(h.resetFadeLogic(),this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null));const _=h;return h||(h=new Q(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,s.key,h.state)),h.uses++,this._tiles[s.key]=h,_||this._source.fire(new l.l("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){this._clearTileReloadTimer(s);const _=h.getExpiryTimeout();_&&(this._timers[s]=setTimeout((()=>{this._reloadTile(s,"expired"),delete this._timers[s]}),_))}_clearTileReloadTimer(s){const h=this._timers[s];h&&(clearTimeout(h),delete this._timers[s])}_resetTileReloadTimers(){for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(s,this._tiles[s])}refreshTiles(s){for(const h in this._tiles)(this._isIdRenderable(h)||this._tiles[h].state=="errored")&&s.some((_=>_.equals(this._tiles[h].tileID.canonical)))&&this._reloadTile(h,"expired")}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._clearTileReloadTimer(s),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(s){s.dataType==="source"&&(s.sourceDataType!=="metadata"?s.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(s.sourceDataChanged,s.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,_){const b=[],A=this.transform;if(!A)return b;const M=A.getCoveringTilesDetailsProvider().allowWorldCopies(),k=_?A.getCameraQueryGeometry(s):s,O=Y=>A.screenPointToMercatorCoordinate(Y,this.terrain),z=this.transformBbox(s,O,!M),U=this.transformBbox(k,O,!M),q=this.getIds(),H=l.a6.fromPoints(U);for(let Y=0;Y<q.length;Y++){const et=this._tiles[q[Y]];if(et.holdingForSymbolFade())continue;const ot=M?[et.tileID]:[et.tileID.unwrapTo(-1),et.tileID.unwrapTo(0)],ct=Math.pow(2,A.zoom-et.tileID.overscaledZ),ht=h*et.queryPadding*l.a3/et.tileSize/ct;for(const _t of ot){const Tt=H.map((gt=>_t.getTilePoint(new l.a5(gt.x,gt.y))));if(Tt.expandBy(ht),Tt.intersects(Mn)){const gt=z.map((Et=>_t.getTilePoint(Et))),St=U.map((Et=>_t.getTilePoint(Et)));b.push({tile:et,tileID:M?_t:_t.unwrapTo(0),queryGeometry:gt,cameraQueryGeometry:St,scale:ct})}}}return b}transformBbox(s,h,_){let b=s.map(h);if(_){const A=l.a6.fromPoints(s);A.shrinkBy(.001*Math.min(A.width(),A.height()));const M=A.map(h);l.a6.fromPoints(b).covers(M)||(b=b.map((k=>k.x>.5?new l.a5(k.x-1,k.y,k.z):k)))}return b}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map((_=>this._tiles[_].tileID));return this.transform&&this.transform.populateCache(h),h}hasTransition(){if(this._source.hasTransition())return!0;if(Qi(this._source.type)&&this._rasterFadeDuration>0){const s=at();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=s)return!0}return!1}setRasterFadeDuration(s){this._rasterFadeDuration=s}setFeatureState(s,h,_){this._state.updateState(s=s||"_geojsonTileLayer",h,_)}removeFeatureState(s,h,_){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,_)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,_){const b=this._tiles[s];b&&b.setDependencies(h,_)}reloadTilesForDependencies(s,h){for(const _ in this._tiles)this._tiles[_].hasDependency(s,h)&&this._reloadTile(_,"reloading");this._cache.filter((_=>!_.hasDependency(s,h)))}}function Bi(T,s){const h=Math.abs(2*T.wrap)-+(T.wrap<0),_=Math.abs(2*s.wrap)-+(s.wrap<0);return T.overscaledZ-s.overscaledZ||_-h||s.canonical.y-T.canonical.y||s.canonical.x-T.canonical.x}function Qi(T){return T==="raster"||T==="image"||T==="video"}gi.maxOverzooming=10,gi.maxUnderzooming=3;class xe{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.ai(s,0,1);let h=1,_=this._distances[h];const b=s*this.paddedLength+this.padding;for(;_<b&&h<this._distances.length;)_=this._distances[++h];const A=h-1,M=this._distances[A],k=_-M,O=k>0?(b-M)/k:0;return this.points[A].mult(1-O).add(this.points[h].mult(O))}}function Ji(T,s){let h=!0;return T==="always"||T!=="never"&&s!=="never"||(h=!1),h}class tn{constructor(s,h,_){const b=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(s/_),this.yCellCount=Math.ceil(h/_);for(let M=0;M<this.xCellCount*this.yCellCount;M++)b.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,_,b,A){this._forEachCell(h,_,b,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(A)}insertCircle(s,h,_,b){this._forEachCell(h-b,_-b,h+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(_),this.circles.push(b)}_insertBoxCell(s,h,_,b,A,M){this.boxCells[A].push(M)}_insertCircleCell(s,h,_,b,A,M){this.circleCells[A].push(M)}_query(s,h,_,b,A,M,k){if(_<0||s>this.width||b<0||h>this.height)return[];const O=[];if(s<=0&&h<=0&&this.width<=_&&this.height<=b){if(A)return[{key:null,x1:s,y1:h,x2:_,y2:b}];for(let z=0;z<this.boxKeys.length;z++)O.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const U=this.circles[3*z],q=this.circles[3*z+1],H=this.circles[3*z+2];O.push({key:this.circleKeys[z],x1:U-H,y1:q-H,x2:U+H,y2:q+H})}}else this._forEachCell(s,h,_,b,this._queryCell,O,{hitTest:A,overlapMode:M,seenUids:{box:{},circle:{}}},k);return O}query(s,h,_,b){return this._query(s,h,_,b,!1,null)}hitTest(s,h,_,b,A,M){return this._query(s,h,_,b,!0,A,M).length>0}hitTestCircle(s,h,_,b,A){const M=s-_,k=s+_,O=h-_,z=h+_;if(k<0||M>this.width||z<0||O>this.height)return!1;const U=[];return this._forEachCell(M,O,k,z,this._queryCellCircle,U,{hitTest:!0,overlapMode:b,circle:{x:s,y:h,radius:_},seenUids:{box:{},circle:{}}},A),U.length>0}_queryCell(s,h,_,b,A,M,k,O){const{seenUids:z,hitTest:U,overlapMode:q}=k,H=this.boxCells[A];if(H!==null){const et=this.bboxes;for(const ot of H)if(!z.box[ot]){z.box[ot]=!0;const ct=4*ot,ht=this.boxKeys[ot];if(s<=et[ct+2]&&h<=et[ct+3]&&_>=et[ct+0]&&b>=et[ct+1]&&(!O||O(ht))&&(!U||!Ji(q,ht.overlapMode))&&(M.push({key:ht,x1:et[ct],y1:et[ct+1],x2:et[ct+2],y2:et[ct+3]}),U))return!0}}const Y=this.circleCells[A];if(Y!==null){const et=this.circles;for(const ot of Y)if(!z.circle[ot]){z.circle[ot]=!0;const ct=3*ot,ht=this.circleKeys[ot];if(this._circleAndRectCollide(et[ct],et[ct+1],et[ct+2],s,h,_,b)&&(!O||O(ht))&&(!U||!Ji(q,ht.overlapMode))){const _t=et[ct],Tt=et[ct+1],gt=et[ct+2];if(M.push({key:ht,x1:_t-gt,y1:Tt-gt,x2:_t+gt,y2:Tt+gt}),U)return!0}}}return!1}_queryCellCircle(s,h,_,b,A,M,k,O){const{circle:z,seenUids:U,overlapMode:q}=k,H=this.boxCells[A];if(H!==null){const et=this.bboxes;for(const ot of H)if(!U.box[ot]){U.box[ot]=!0;const ct=4*ot,ht=this.boxKeys[ot];if(this._circleAndRectCollide(z.x,z.y,z.radius,et[ct+0],et[ct+1],et[ct+2],et[ct+3])&&(!O||O(ht))&&!Ji(q,ht.overlapMode))return M.push(!0),!0}}const Y=this.circleCells[A];if(Y!==null){const et=this.circles;for(const ot of Y)if(!U.circle[ot]){U.circle[ot]=!0;const ct=3*ot,ht=this.circleKeys[ot];if(this._circlesCollide(et[ct],et[ct+1],et[ct+2],z.x,z.y,z.radius)&&(!O||O(ht))&&!Ji(q,ht.overlapMode))return M.push(!0),!0}}}_forEachCell(s,h,_,b,A,M,k,O){const z=this._convertToXCellCoord(s),U=this._convertToYCellCoord(h),q=this._convertToXCellCoord(_),H=this._convertToYCellCoord(b);for(let Y=z;Y<=q;Y++)for(let et=U;et<=H;et++)if(A.call(this,s,h,_,b,this.xCellCount*et+Y,M,k,O))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,_,b,A,M){const k=b-s,O=A-h,z=_+M;return z*z>k*k+O*O}_circleAndRectCollide(s,h,_,b,A,M,k){const O=(M-b)/2,z=Math.abs(s-(b+O));if(z>O+_)return!1;const U=(k-A)/2,q=Math.abs(h-(A+U));if(q>U+_)return!1;if(z<=O||q<=U)return!0;const H=z-O,Y=q-U;return H*H+Y*Y<=_*_}}function Vn(T,s,h){const _=l.M();if(!T){const{vecSouth:q,vecEast:H}=fe(s),Y=C();Y[0]=H[0],Y[1]=H[1],Y[2]=q[0],Y[3]=q[1],b=Y,(U=(M=(A=Y)[0])*(z=A[3])-(O=A[2])*(k=A[1]))&&(b[0]=z*(U=1/U),b[1]=-k*U,b[2]=-O*U,b[3]=M*U),_[0]=Y[0],_[1]=Y[1],_[4]=Y[2],_[5]=Y[3]}var b,A,M,k,O,z,U;return l.O(_,_,[1/h,1/h,1]),_}function Li(T,s,h,_){if(T){const b=l.M();if(!s){const{vecSouth:A,vecEast:M}=fe(h);b[0]=M[0],b[1]=M[1],b[4]=A[0],b[5]=A[1]}return l.O(b,b,[_,_,1]),b}return h.pixelsToClipSpaceMatrix}function fe(T){const s=Math.cos(T.rollInRadians),h=Math.sin(T.rollInRadians),_=Math.cos(T.pitchInRadians),b=Math.cos(T.bearingInRadians),A=Math.sin(T.bearingInRadians),M=l.aw();M[0]=-b*_*h-A*s,M[1]=-A*_*h+b*s;const k=l.ax(M);k<1e-9?l.ay(M):l.az(M,M,1/k);const O=l.aw();O[0]=b*_*s-A*h,O[1]=A*_*s+b*h;const z=l.ax(O);return z<1e-9?l.ay(O):l.az(O,O,1/z),{vecEast:O,vecSouth:M}}function Re(T,s,h,_){let b;_?(b=[T,s,_(T,s),1],l.aB(b,b,h)):(b=[T,s,0,1],Cu(b,b,h));const A=b[3];return{point:new l.P(b[0]/A,b[1]/A),signedDistanceFromCamera:A,isOccluded:!1}}function We(T,s){return .5+T/s*.5}function Ur(T,s){return T.x>=-s[0]&&T.x<=s[0]&&T.y>=-s[1]&&T.y<=s[1]}function Nl(T,s,h,_,b,A,M,k,O,z,U,q,H){const Y=h?T.textSizeData:T.iconSizeData,et=l.as(Y,s.transform.zoom),ot=[256/s.width*2+1,256/s.height*2+1],ct=h?T.text.dynamicLayoutVertexArray:T.icon.dynamicLayoutVertexArray;ct.clear();const ht=T.lineVertexArray,_t=h?T.text.placedSymbolArray:T.icon.placedSymbolArray,Tt=s.transform.width/s.transform.height;let gt=!1;for(let St=0;St<_t.length;St++){const Et=_t.get(St);if(Et.hidden||Et.writingMode===l.at.vertical&&!gt){es(Et.numGlyphs,ct);continue}gt=!1;const xt=new l.P(Et.anchorX,Et.anchorY),Bt={getElevation:H,pitchedLabelPlaneMatrix:_,lineVertexArray:ht,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:s.transform,tileAnchorPoint:xt,unwrappedTileID:O,width:z,height:U,translation:q},Gt=ca(Et.anchorX,Et.anchorY,Bt);if(!Ur(Gt.point,ot)){es(Et.numGlyphs,ct);continue}const Ht=We(s.transform.cameraToCenterDistance,Gt.signedDistanceFromCamera),Wt=l.au(Y,et,Et),Yt=A?Wt*s.transform.getPitchedTextCorrection(Et.anchorX,Et.anchorY,O)/Ht:Wt*Ht,ve=ks({projectionContext:Bt,pitchedLabelPlaneMatrixInverse:b,symbol:Et,fontSize:Yt,flip:!1,keepUpright:M,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:ct,aspectRatio:Tt,rotateToLine:k});gt=ve.useVertical,(ve.notEnoughRoom||gt||ve.needsFlipping&&ks({projectionContext:Bt,pitchedLabelPlaneMatrixInverse:b,symbol:Et,fontSize:Yt,flip:!0,keepUpright:M,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:ct,aspectRatio:Tt,rotateToLine:k}).notEnoughRoom)&&es(Et.numGlyphs,ct)}h?T.text.dynamicLayoutVertexBuffer.updateData(ct):T.icon.dynamicLayoutVertexBuffer.updateData(ct)}function gr(T,s,h,_,b,A,M,k){const O=A.glyphStartIndex+A.numGlyphs,z=A.lineStartIndex,U=A.lineStartIndex+A.lineLength,q=s.getoffsetX(A.glyphStartIndex),H=s.getoffsetX(O-1),Y=en(T*q,h,_,b,A.segment,z,U,k,M);if(!Y)return null;const et=en(T*H,h,_,b,A.segment,z,U,k,M);return et?k.projectionCache.anyProjectionOccluded?null:{first:Y,last:et}:null}function ni(T,s,h,_){return T===l.at.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*_?{useVertical:!0}:(T===l.at.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function ks(T){const{projectionContext:s,pitchedLabelPlaneMatrixInverse:h,symbol:_,fontSize:b,flip:A,keepUpright:M,glyphOffsetArray:k,dynamicLayoutVertexArray:O,aspectRatio:z,rotateToLine:U}=T,q=b/24,H=_.lineOffsetX*q,Y=_.lineOffsetY*q;let et;if(_.numGlyphs>1){const ot=_.glyphStartIndex+_.numGlyphs,ct=_.lineStartIndex,ht=_.lineStartIndex+_.lineLength,_t=gr(q,k,H,Y,A,_,U,s);if(!_t)return{notEnoughRoom:!0};const Tt=la(_t.first.point.x,_t.first.point.y,s,h),gt=la(_t.last.point.x,_t.last.point.y,s,h);if(M&&!A){const St=ni(_.writingMode,Tt,gt,z);if(St)return St}et=[_t.first];for(let St=_.glyphStartIndex+1;St<ot-1;St++){const Et=en(q*k.getoffsetX(St),H,Y,A,_.segment,ct,ht,s,U);if(!Et)return{notEnoughRoom:!0};et.push(Et)}et.push(_t.last)}else{if(M&&!A){const ct=Vr(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,ht=_.lineStartIndex+_.segment+1,_t=new l.P(s.lineVertexArray.getx(ht),s.lineVertexArray.gety(ht)),Tt=Vr(_t.x,_t.y,s),gt=Tt.signedDistanceFromCamera>0?Tt.point:Zo(s.tileAnchorPoint,_t,ct,1,s),St=la(ct.x,ct.y,s,h),Et=la(gt.x,gt.y,s,h),xt=ni(_.writingMode,St,Et,z);if(xt)return xt}const ot=en(q*k.getoffsetX(_.glyphStartIndex),H,Y,A,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,s,U);if(!ot||s.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};et=[ot]}for(const ot of et)l.aA(O,ot.point,ot.angle);return{}}function Zo(T,s,h,_,b){const A=T.add(T.sub(s)._unit()),M=Vr(A.x,A.y,b).point,k=h.sub(M);return h.add(k._mult(_/k.mag()))}function oa(T,s,h){const _=s.projectionCache;if(_.projections[T])return _.projections[T];const b=new l.P(s.lineVertexArray.getx(T),s.lineVertexArray.gety(T)),A=Vr(b.x,b.y,s);if(A.signedDistanceFromCamera>0)return _.projections[T]=A.point,_.anyProjectionOccluded=_.anyProjectionOccluded||A.isOccluded,A.point;const M=T-h.direction;return Zo(h.distanceFromAnchor===0?s.tileAnchorPoint:new l.P(s.lineVertexArray.getx(M),s.lineVertexArray.gety(M)),b,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,s)}function Vr(T,s,h){const _=T+h.translation[0],b=s+h.translation[1];let A;return h.pitchWithMap?(A=Re(_,b,h.pitchedLabelPlaneMatrix,h.getElevation),A.isOccluded=!1):(A=h.transform.projectTileCoordinates(_,b,h.unwrappedTileID,h.getElevation),A.point.x=(.5*A.point.x+.5)*h.width,A.point.y=(.5*-A.point.y+.5)*h.height),A}function la(T,s,h,_){if(h.pitchWithMap){const b=[T,s,0,1];return l.aB(b,b,_),h.transform.projectTileCoordinates(b[0]/b[3],b[1]/b[3],h.unwrappedTileID,h.getElevation).point}return{x:T/h.width*2-1,y:1-s/h.height*2}}function ca(T,s,h){return h.transform.projectTileCoordinates(T,s,h.unwrappedTileID,h.getElevation)}function Rn(T,s,h){return T._unit()._perp()._mult(s*h)}function ys(T,s,h,_,b,A,M,k,O){if(k.projectionCache.offsets[T])return k.projectionCache.offsets[T];const z=h.add(s);if(T+O.direction<_||T+O.direction>=b)return k.projectionCache.offsets[T]=z,z;const U=oa(T+O.direction,k,O),q=Rn(U.sub(h),M,O.direction),H=h.add(q),Y=U.add(q);return k.projectionCache.offsets[T]=l.aC(A,z,H,Y)||z,k.projectionCache.offsets[T]}function en(T,s,h,_,b,A,M,k,O){const z=_?T-s:T+s;let U=z>0?1:-1,q=0;_&&(U*=-1,q=Math.PI),U<0&&(q+=Math.PI);let H,Y=U>0?A+b:A+b+1;k.projectionCache.cachedAnchorPoint?H=k.projectionCache.cachedAnchorPoint:(H=Vr(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=H);let et,ot,ct=H,ht=H,_t=0,Tt=0;const gt=Math.abs(z),St=[];let Et;for(;_t+Tt<=gt;){if(Y+=U,Y<A||Y>=M)return null;_t+=Tt,ht=ct,ot=et;const Gt={absOffsetX:gt,direction:U,distanceFromAnchor:_t,previousVertex:ht};if(ct=oa(Y,k,Gt),h===0)St.push(ht),Et=ct.sub(ht);else{let Ht;const Wt=ct.sub(ht);Ht=Wt.mag()===0?Rn(oa(Y+U,k,Gt).sub(ct),h,U):Rn(Wt,h,U),ot||(ot=ht.add(Ht)),et=ys(Y,Ht,ct,A,M,ot,h,k,Gt),St.push(ot),Et=et.sub(ot)}Tt=Et.mag()}const xt=Et._mult((gt-_t)/Tt)._add(ot||ht),Bt=q+Math.atan2(ct.y-ht.y,ct.x-ht.x);return St.push(xt),{point:xt,angle:O?Bt:0,path:St}}const zl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function es(T,s){for(let h=0;h<T;h++){const _=s.length;s.resize(_+4),s.float32.set(zl,3*_)}}function Cu(T,s,h){const _=s[0],b=s[1];return T[0]=h[0]*_+h[4]*b+h[12],T[1]=h[1]*_+h[5]*b+h[13],T[3]=h[3]*_+h[7]*b+h[15],T}const vn=100;class ao{constructor(s,h=new tn(s.width+200,s.height+200,25),_=new tn(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=_,this.pitchFactor=Math.cos(s.pitch*Math.PI/180)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+vn,this.screenBottomBoundary=s.height+vn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,_,b,A,M,k,O,z,U,q,H){const Y=this.projectAndGetPerspectiveRatio(s.anchorPointX+O[0],s.anchorPointY+O[1],A,U,H),et=_*Y.perspectiveRatio;let ot;if(M||k)ot=this._projectCollisionBox(s,et,b,A,M,k,O,Y,U,q,H);else{const Et=Y.x+(q?q.x*et:0),xt=Y.y+(q?q.y*et:0);ot={allPointsOccluded:!1,box:[Et+s.x1*et,xt+s.y1*et,Et+s.x2*et,xt+s.y2*et]}}const[ct,ht,_t,Tt]=ot.box,gt=M?ot.allPointsOccluded:Y.isOccluded;let St=gt;return St||(St=Y.perspectiveRatio<this.perspectiveRatioCutoff),St||(St=!this.isInsideGrid(ct,ht,_t,Tt)),St||h!=="always"&&this.grid.hitTest(ct,ht,_t,Tt,h,z)?{box:[ct,ht,_t,Tt],placeable:!1,offscreen:!1,occluded:gt}:{box:[ct,ht,_t,Tt],placeable:!0,offscreen:this.isOffscreen(ct,ht,_t,Tt),occluded:gt}}placeCollisionCircles(s,h,_,b,A,M,k,O,z,U,q,H,Y,et){const ot=[],ct=new l.P(h.anchorX,h.anchorY),ht=this.getPerspectiveRatio(ct.x,ct.y,M,et),_t=(z?A*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,M)/ht:A*ht)/l.aG,Tt={getElevation:et,pitchedLabelPlaneMatrix:k,lineVertexArray:_,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ct,unwrappedTileID:M,width:this.transform.width,height:this.transform.height,translation:Y},gt=gr(_t,b,h.lineOffsetX*_t,h.lineOffsetY*_t,!1,h,!1,Tt);let St=!1,Et=!1,xt=!0;if(gt){const Bt=.5*q*ht+H,Gt=new l.P(-100,-100),Ht=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Wt=new xe,Yt=gt.first,ve=gt.last;let Te=[];for(let Ve=Yt.path.length-1;Ve>=1;Ve--)Te.push(Yt.path[Ve]);for(let Ve=1;Ve<ve.path.length;Ve++)Te.push(ve.path[Ve]);const ce=2.5*Bt;if(z){const Ve=this.projectPathToScreenSpace(Te,Tt);Te=Ve.some((Fi=>Fi.signedDistanceFromCamera<=0))?[]:Ve.map((Fi=>Fi.point))}let ke=[];if(Te.length>0){const Ve=Te[0].clone(),Fi=Te[0].clone();for(let dn=1;dn<Te.length;dn++)Ve.x=Math.min(Ve.x,Te[dn].x),Ve.y=Math.min(Ve.y,Te[dn].y),Fi.x=Math.max(Fi.x,Te[dn].x),Fi.y=Math.max(Fi.y,Te[dn].y);ke=Ve.x>=Gt.x&&Fi.x<=Ht.x&&Ve.y>=Gt.y&&Fi.y<=Ht.y?[Te]:Fi.x<Gt.x||Ve.x>Ht.x||Fi.y<Gt.y||Ve.y>Ht.y?[]:l.aD([Te],Gt.x,Gt.y,Ht.x,Ht.y)}for(const Ve of ke){Wt.reset(Ve,.25*Bt);let Fi=0;Fi=Wt.length<=.5*Bt?1:Math.ceil(Wt.paddedLength/ce)+1;for(let dn=0;dn<Fi;dn++){const rn=dn/Math.max(Fi-1,1),pn=Wt.lerp(rn),Gi=pn.x+vn,qn=pn.y+vn;ot.push(Gi,qn,Bt,0);const Yi=Gi-Bt,tr=qn-Bt,kn=Gi+Bt,Xn=qn+Bt;if(xt=xt&&this.isOffscreen(Yi,tr,kn,Xn),Et=Et||this.isInsideGrid(Yi,tr,kn,Xn),s!=="always"&&this.grid.hitTestCircle(Gi,qn,Bt,s,U)&&(St=!0,!O))return{circles:[],offscreen:!1,collisionDetected:St}}}}return{circles:!O&&St||!Et||ht<this.perspectiveRatioCutoff?[]:ot,offscreen:xt,collisionDetected:St}}projectPathToScreenSpace(s,h){const _=(function(b,A){const M=l.M();return l.av(M,A.pitchedLabelPlaneMatrix),b.map((k=>{const O=Re(k.x,k.y,M,A.getElevation),z=A.transform.projectTileCoordinates(O.point.x,O.point.y,A.unwrappedTileID,A.getElevation);return z.point.x=(.5*z.point.x+.5)*A.width,z.point.y=(.5*-z.point.y+.5)*A.height,z}))})(s,h);return(function(b){let A=0,M=0,k=0,O=0;for(let z=0;z<b.length;z++)b[z].isOccluded?(k=z+1,O=0):(O++,O>M&&(M=O,A=k));return b.slice(A,A+M)})(_)}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[],_=new l.a6;for(const q of s){const H=new l.P(q.x+vn,q.y+vn);_.extend(H),h.push(H)}const{minX:b,minY:A,maxX:M,maxY:k}=_,O=this.grid.query(b,A,M,k).concat(this.ignoredGrid.query(b,A,M,k)),z={},U={};for(const q of O){const H=q.key;if(z[H.bucketInstanceId]===void 0&&(z[H.bucketInstanceId]={}),z[H.bucketInstanceId][H.featureIndex])continue;const Y=[new l.P(q.x1,q.y1),new l.P(q.x2,q.y1),new l.P(q.x2,q.y2),new l.P(q.x1,q.y2)];l.aE(h,Y)&&(z[H.bucketInstanceId][H.featureIndex]=!0,U[H.bucketInstanceId]===void 0&&(U[H.bucketInstanceId]=[]),U[H.bucketInstanceId].push(H.featureIndex))}return U}insertCollisionBox(s,h,_,b,A,M){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:A,collisionGroupID:M,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,_,b,A,M){const k=_?this.ignoredGrid:this.grid,O={bucketInstanceId:b,featureIndex:A,collisionGroupID:M,overlapMode:h};for(let z=0;z<s.length;z+=4)k.insertCircle(O,s[z],s[z+1],s[z+2])}projectAndGetPerspectiveRatio(s,h,_,b,A){if(A){let M;b?(M=[s,h,b(s,h),1],l.aB(M,M,A)):(M=[s,h,0,1],Cu(M,M,A));const k=M[3];return{x:(M[0]/k+1)/2*this.transform.width+vn,y:(-M[1]/k+1)/2*this.transform.height+vn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}{const M=this.transform.projectTileCoordinates(s,h,_,b);return{x:(M.point.x+1)/2*this.transform.width+vn,y:(1-M.point.y)/2*this.transform.height+vn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M.signedDistanceFromCamera*.5,isOccluded:M.isOccluded,signedDistanceFromCamera:M.signedDistanceFromCamera}}}getPerspectiveRatio(s,h,_,b){const A=this.transform.projectTileCoordinates(s,h,_,b);return .5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5}isOffscreen(s,h,_,b){return _<vn||s>=this.screenRightBoundary||b<vn||h>this.screenBottomBoundary}isInsideGrid(s,h,_,b){return _>=0&&s<this.gridRightBoundary&&b>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.am([]);return l.N(s,s,[-100,-100,0]),s}_projectCollisionBox(s,h,_,b,A,M,k,O,z,U,q){let H=1,Y=0,et=0,ot=1;const ct=s.anchorPointX+k[0],ht=s.anchorPointY+k[1];if(M&&!A){const Te=this.projectAndGetPerspectiveRatio(ct+1,ht,b,z,q),ce=Te.x-O.x,ke=Math.atan((Te.y-O.y)/ce)+(ce<0?Math.PI:0),Ve=Math.sin(ke),Fi=Math.cos(ke);H=Fi,Y=Ve,et=-Ve,ot=Fi}else if(!M&&A){const Te=fe(this.transform);H=Te.vecEast[0],Y=Te.vecEast[1],et=Te.vecSouth[0],ot=Te.vecSouth[1]}let _t=O.x,Tt=O.y,gt=h;A&&(_t=ct,Tt=ht,gt=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),gt*=this.transform.getPitchedTextCorrection(ct,ht,b),U||(gt*=l.ai(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(_t+=H*U.x*gt+et*U.y*gt,Tt+=Y*U.x*gt+ot*U.y*gt);const St=s.x1*gt,Et=s.x2*gt,xt=(St+Et)/2,Bt=s.y1*gt,Gt=s.y2*gt,Ht=(Bt+Gt)/2,Wt=[{offsetX:St,offsetY:Bt},{offsetX:xt,offsetY:Bt},{offsetX:Et,offsetY:Bt},{offsetX:Et,offsetY:Ht},{offsetX:Et,offsetY:Gt},{offsetX:xt,offsetY:Gt},{offsetX:St,offsetY:Gt},{offsetX:St,offsetY:Ht}];let Yt=[];for(const{offsetX:Te,offsetY:ce}of Wt)Yt.push(new l.P(_t+H*Te+et*ce,Tt+Y*Te+ot*ce));let ve=!1;if(A){const Te=Yt.map((ce=>this.projectAndGetPerspectiveRatio(ce.x,ce.y,b,z,q)));ve=Te.some((ce=>!ce.isOccluded)),Yt=Te.map((ce=>new l.P(ce.x,ce.y)))}else ve=!0;return{box:l.aF(Yt),allPointsOccluded:!ve}}}class id{constructor(s,h,_,b){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class oo{constructor(s,h,_,b,A){this.text=new id(s?s.text:null,h,_,A),this.icon=new id(s?s.icon:null,h,b,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fc{constructor(s,h,_){this.text=s,this.icon=h,this.skipFade=_}}class vs{constructor(s,h,_,b,A){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=A}}class Os{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[s]}}function nd(T,s,h,_,b){const{horizontalAlign:A,verticalAlign:M}=l.aM(T);return new l.P(-(A-.5)*s+_[0]*b,-(M-.5)*h+_[1]*b)}class t_{constructor(s,h,_,b,A){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new ao(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Os(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const h=this.terrain;return h?(_,b)=>h.getElevation(s,_,b):null}getBucketParts(s,h,_,b){const A=_.getBucket(h),M=_.latestFeatureIndex;if(!A||!M||h.id!==A.layerIds[0])return;const k=_.collisionBoxArray,O=A.layers[0].layout,z=A.layers[0].paint,U=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),q=_.tileSize/l.a3,H=_.tileID.toUnwrapped(),Y=O.get("text-rotation-alignment")==="map",et=l.aH(_,1,this.transform.zoom),ot=l.aI(this.collisionIndex.transform,_,z.get("text-translate"),z.get("text-translate-anchor")),ct=l.aI(this.collisionIndex.transform,_,z.get("icon-translate"),z.get("icon-translate-anchor")),ht=Vn(Y,this.transform,et);this.retainedQueryData[A.bucketInstanceId]=new vs(A.bucketInstanceId,M,A.sourceLayerIndex,A.index,_.tileID);const _t={bucket:A,layout:O,translationText:ot,translationIcon:ct,unwrappedTileID:H,pitchedLabelPlaneMatrix:ht,scale:U,textPixelRatio:q,holdingForFade:_.holdingForSymbolFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:l.as(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(b)for(const Tt of A.sortKeyRanges){const{sortKey:gt,symbolInstanceStart:St,symbolInstanceEnd:Et}=Tt;s.push({sortKey:gt,symbolInstanceStart:St,symbolInstanceEnd:Et,parameters:_t})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:_t})}attemptAnchorPlacement(s,h,_,b,A,M,k,O,z,U,q,H,Y,et,ot,ct,ht,_t,Tt,gt){const St=l.aJ[s.textAnchor],Et=[s.textOffset0,s.textOffset1],xt=nd(St,_,b,Et,A),Bt=this.collisionIndex.placeCollisionBox(h,H,O,z,U,k,M,ct,q.predicate,Tt,xt,gt);if((!_t||this.collisionIndex.placeCollisionBox(_t,H,O,z,U,k,M,ht,q.predicate,Tt,xt,gt).placeable)&&Bt.placeable){let Gt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(Gt=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:Et,width:_,height:b,anchor:St,textBoxScale:A,prevAnchor:Gt},this.markUsedJustification(et,St,Y,ot),et.allowVerticalPlacement&&(this.markUsedOrientation(et,ot,Y),this.placedOrientations[Y.crossTileID]=ot),{shift:xt,placedGlyphBoxes:Bt}}}placeLayerBucketPart(s,h,_){const{bucket:b,layout:A,translationText:M,translationIcon:k,unwrappedTileID:O,pitchedLabelPlaneMatrix:z,textPixelRatio:U,holdingForFade:q,collisionBoxArray:H,partiallyEvaluatedTextSize:Y,collisionGroup:et}=s.parameters,ot=A.get("text-optional"),ct=A.get("icon-optional"),ht=l.aK(A,"text-overlap","text-allow-overlap"),_t=ht==="always",Tt=l.aK(A,"icon-overlap","icon-allow-overlap"),gt=Tt==="always",St=A.get("text-rotation-alignment")==="map",Et=A.get("text-pitch-alignment")==="map",xt=A.get("icon-text-fit")!=="none",Bt=A.get("symbol-z-order")==="viewport-y",Gt=_t&&(gt||!b.hasIconData()||ct),Ht=gt&&(_t||!b.hasTextData()||ot);!b.collisionArrays&&H&&b.deserializeCollisionBoxes(H);const Wt=this.retainedQueryData[b.bucketInstanceId].tileID,Yt=this._getTerrainElevationFunc(Wt),ve=this.transform.getFastPathSimpleProjectionMatrix(Wt),Te=(ce,ke,Ve)=>{var Fi,dn;if(h[ce.crossTileID])return;if(q)return void(this.placements[ce.crossTileID]=new Fc(!1,!1,!1));let rn=!1,pn=!1,Gi=!0,qn=null,Yi={box:null,placeable:!1,offscreen:null,occluded:!1},tr={placeable:!1},kn=null,Xn=null,vr=null,va=0,To=0,So=0;ke.textFeatureIndex?va=ke.textFeatureIndex:ce.useRuntimeCollisionCircles&&(va=ce.featureIndex),ke.verticalTextFeatureIndex&&(To=ke.verticalTextFeatureIndex);const ba=ke.textBox;if(ba){const Cs=mn=>{let qi=l.at.horizontal;if(b.allowVerticalPlacement&&!mn&&this.prevPlacement){const Sn=this.prevPlacement.placedOrientations[ce.crossTileID];Sn&&(this.placedOrientations[ce.crossTileID]=Sn,qi=Sn,this.markUsedOrientation(b,qi,ce))}return qi},Eo=(mn,qi)=>{if(b.allowVerticalPlacement&&ce.numVerticalGlyphVertices>0&&ke.verticalTextBox){for(const Sn of b.writingModes)if(Sn===l.at.vertical?(Yi=qi(),tr=Yi):Yi=mn(),Yi&&Yi.placeable)break}else Yi=mn()},Co=ce.textAnchorOffsetStartIndex,Mo=ce.textAnchorOffsetEndIndex;if(Mo===Co){const mn=(qi,Sn)=>{const sn=this.collisionIndex.placeCollisionBox(qi,ht,U,Wt,O,Et,St,M,et.predicate,Yt,void 0,ve);return sn&&sn.placeable&&(this.markUsedOrientation(b,Sn,ce),this.placedOrientations[ce.crossTileID]=Sn),sn};Eo((()=>mn(ba,l.at.horizontal)),(()=>{const qi=ke.verticalTextBox;return b.allowVerticalPlacement&&ce.numVerticalGlyphVertices>0&&qi?mn(qi,l.at.vertical):{box:null,offscreen:null}})),Cs(Yi&&Yi.placeable)}else{let mn=l.aJ[(dn=(Fi=this.prevPlacement)===null||Fi===void 0?void 0:Fi.variableOffsets[ce.crossTileID])===null||dn===void 0?void 0:dn.anchor];const qi=(sn,Ed,Cd)=>{const iu=sn.x2-sn.x1,gl=sn.y2-sn.y1,Md=ce.textBoxScale,Rd=xt&&Tt==="never"?Ed:null;let xa=null,sh=ht==="never"?1:2,Ro="never";mn&&sh++;for(let Po=0;Po<sh;Po++){for(let eo=Co;eo<Mo;eo++){const Pd=b.textAnchorOffsets.get(eo);if(mn&&Pd.textAnchor!==mn)continue;const nu=this.attemptAnchorPlacement(Pd,sn,iu,gl,Md,St,Et,U,Wt,O,et,Ro,ce,b,Cd,M,k,Rd,Yt);if(nu&&(xa=nu.placedGlyphBoxes,xa&&xa.placeable))return rn=!0,qn=nu.shift,xa}mn?mn=null:Ro=ht}return _&&!xa&&(xa={box:this.collisionIndex.placeCollisionBox(ba,"always",U,Wt,O,Et,St,M,et.predicate,Yt,void 0,ve).box,offscreen:!1,placeable:!1,occluded:!1}),xa};Eo((()=>qi(ba,ke.iconBox,l.at.horizontal)),(()=>{const sn=ke.verticalTextBox;return b.allowVerticalPlacement&&(!Yi||!Yi.placeable)&&ce.numVerticalGlyphVertices>0&&sn?qi(sn,ke.verticalIconBox,l.at.vertical):{box:null,occluded:!0,offscreen:null}})),Yi&&(rn=Yi.placeable,Gi=Yi.offscreen);const Sn=Cs(Yi&&Yi.placeable);if(!rn&&this.prevPlacement){const sn=this.prevPlacement.variableOffsets[ce.crossTileID];sn&&(this.variableOffsets[ce.crossTileID]=sn,this.markUsedJustification(b,sn.anchor,ce,Sn))}}}if(kn=Yi,rn=kn&&kn.placeable,Gi=kn&&kn.offscreen,ce.useRuntimeCollisionCircles&&ce.centerJustifiedTextSymbolIndex>=0){const Cs=b.text.placedSymbolArray.get(ce.centerJustifiedTextSymbolIndex),Eo=l.au(b.textSizeData,Y,Cs),Co=A.get("text-padding");Xn=this.collisionIndex.placeCollisionCircles(ht,Cs,b.lineVertexArray,b.glyphOffsetArray,Eo,O,z,_,Et,et.predicate,ce.collisionCircleDiameter,Co,M,Yt),Xn.circles.length&&Xn.collisionDetected&&!_&&l.w("Collisions detected, but collision boxes are not shown"),rn=_t||Xn.circles.length>0&&!Xn.collisionDetected,Gi=Gi&&Xn.offscreen}if(ke.iconFeatureIndex&&(So=ke.iconFeatureIndex),ke.iconBox){const Cs=Eo=>this.collisionIndex.placeCollisionBox(Eo,Tt,U,Wt,O,Et,St,k,et.predicate,Yt,xt&&qn?qn:void 0,ve);tr&&tr.placeable&&ke.verticalIconBox?(vr=Cs(ke.verticalIconBox),pn=vr.placeable):(vr=Cs(ke.iconBox),pn=vr.placeable),Gi=Gi&&vr.offscreen}const Fs=ot||ce.numHorizontalGlyphVertices===0&&ce.numVerticalGlyphVertices===0,ml=ct||ce.numIconVertices===0;Fs||ml?ml?Fs||(pn=pn&&rn):rn=pn&&rn:pn=rn=pn&&rn;const Ao=pn&&vr.placeable;if(rn&&kn.placeable&&this.collisionIndex.insertCollisionBox(kn.box,ht,A.get("text-ignore-placement"),b.bucketInstanceId,tr&&tr.placeable&&To?To:va,et.ID),Ao&&this.collisionIndex.insertCollisionBox(vr.box,Tt,A.get("icon-ignore-placement"),b.bucketInstanceId,So,et.ID),Xn&&rn&&this.collisionIndex.insertCollisionCircles(Xn.circles,ht,A.get("text-ignore-placement"),b.bucketInstanceId,va,et.ID),_&&this.storeCollisionData(b.bucketInstanceId,Ve,ke,kn,vr,Xn),ce.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ce.crossTileID]=new Fc((rn||Gt)&&!kn?.occluded,(pn||Ht)&&!vr?.occluded,Gi||b.justReloaded),h[ce.crossTileID]=!0};if(Bt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ce=b.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ke=ce.length-1;ke>=0;--ke){const Ve=ce[ke];Te(b.symbolInstances.get(Ve),b.collisionArrays[Ve],Ve)}}else for(let ce=s.symbolInstanceStart;ce<s.symbolInstanceEnd;ce++)Te(b.symbolInstances.get(ce),b.collisionArrays[ce],ce);b.justReloaded=!1}storeCollisionData(s,h,_,b,A,M){if(_.textBox||_.iconBox){let k,O;this.collisionBoxArrays.has(s)?k=this.collisionBoxArrays.get(s):(k=new Map,this.collisionBoxArrays.set(s,k)),k.has(h)?O=k.get(h):(O={text:null,icon:null},k.set(h,O)),_.textBox&&(O.text=b.box),_.iconBox&&(O.icon=A.box)}if(M){let k=this.collisionCircleArrays[s];k===void 0&&(k=this.collisionCircleArrays[s]=[]);for(let O=0;O<M.circles.length;O+=4)k.push(M.circles[O+0]-vn),k.push(M.circles[O+1]-vn),k.push(M.circles[O+2]),k.push(M.collisionDetected?1:0)}}markUsedJustification(s,h,_,b){let A;A=b===l.at.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.aL(h)];const M=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const k of M)k>=0&&(s.text.placedSymbolArray.get(k).crossTileID=A>=0&&k!==A?0:_.crossTileID)}markUsedOrientation(s,h,_){const b=h===l.at.horizontal||h===l.at.horizontalOnly?h:0,A=h===l.at.vertical?h:0,M=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const k of M)s.text.placedSymbolArray.get(k).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const b=h?h.symbolFadeChange(s):1,A=h?h.opacities:{},M=h?h.variableOffsets:{},k=h?h.placedOrientations:{};for(const O in this.placements){const z=this.placements[O],U=A[O];U?(this.opacities[O]=new oo(U,b,z.text,z.icon),_=_||z.text!==U.text.placed||z.icon!==U.icon.placed):(this.opacities[O]=new oo(null,b,z.text,z.icon,z.skipFade),_=_||z.text||z.icon)}for(const O in A){const z=A[O];if(!this.opacities[O]){const U=new oo(z,b,!1,!1);U.isHidden()||(this.opacities[O]=U,_=_||z.text.placed||z.icon.placed)}}for(const O in M)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=M[O]);for(const O in k)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=k[O]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const _={};for(const b of h){const A=b.getBucket(s);A&&b.latestFeatureIndex&&s.id===A.layerIds[0]&&this.updateBucketOpacities(A,b.tileID,_,b.collisionBoxArray)}}updateBucketOpacities(s,h,_,b){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const A=s.layers[0],M=A.layout,k=new oo(null,0,!1,!1,!0),O=M.get("text-allow-overlap"),z=M.get("icon-allow-overlap"),U=A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=M.get("text-rotation-alignment")==="map",H=M.get("text-pitch-alignment")==="map",Y=M.get("icon-text-fit")!=="none",et=new oo(null,0,O&&(z||!s.hasIconData()||M.get("icon-optional")),z&&(O||!s.hasTextData()||M.get("text-optional")),!0);!s.collisionArrays&&b&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(b);const ot=(ht,_t,Tt)=>{for(let gt=0;gt<_t/4;gt++)ht.opacityVertexArray.emplaceBack(Tt);ht.hasVisibleVertices=ht.hasVisibleVertices||Tt!==ka},ct=this.collisionBoxArrays.get(s.bucketInstanceId);for(let ht=0;ht<s.symbolInstances.length;ht++){const _t=s.symbolInstances.get(ht),{numHorizontalGlyphVertices:Tt,numVerticalGlyphVertices:gt,crossTileID:St}=_t;let Et=this.opacities[St];_[St]?Et=k:Et||(Et=et,this.opacities[St]=Et),_[St]=!0;const xt=_t.numIconVertices>0,Bt=this.placedOrientations[_t.crossTileID],Gt=Bt===l.at.vertical,Ht=Bt===l.at.horizontal||Bt===l.at.horizontalOnly;if(Tt>0||gt>0){const Yt=Ul(Et.text);ot(s.text,Tt,Gt?ka:Yt),ot(s.text,gt,Ht?ka:Yt);const ve=Et.text.isHidden();[_t.rightJustifiedTextSymbolIndex,_t.centerJustifiedTextSymbolIndex,_t.leftJustifiedTextSymbolIndex].forEach((ke=>{ke>=0&&(s.text.placedSymbolArray.get(ke).hidden=ve||Gt?1:0)})),_t.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(_t.verticalPlacedTextSymbolIndex).hidden=ve||Ht?1:0);const Te=this.variableOffsets[_t.crossTileID];Te&&this.markUsedJustification(s,Te.anchor,_t,Bt);const ce=this.placedOrientations[_t.crossTileID];ce&&(this.markUsedJustification(s,"left",_t,ce),this.markUsedOrientation(s,ce,_t))}if(xt){const Yt=Ul(Et.icon),ve=!(Y&&_t.verticalPlacedIconSymbolIndex&&Gt);_t.placedIconSymbolIndex>=0&&(ot(s.icon,_t.numIconVertices,ve?Yt:ka),s.icon.placedSymbolArray.get(_t.placedIconSymbolIndex).hidden=Et.icon.isHidden()),_t.verticalPlacedIconSymbolIndex>=0&&(ot(s.icon,_t.numVerticalIconVertices,ve?ka:Yt),s.icon.placedSymbolArray.get(_t.verticalPlacedIconSymbolIndex).hidden=Et.icon.isHidden())}const Wt=ct&&ct.has(ht)?ct.get(ht):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Yt=s.collisionArrays[ht];if(Yt){let ve=new l.P(0,0);if(Yt.textBox||Yt.verticalTextBox){let Te=!0;if(U){const ce=this.variableOffsets[St];ce?(ve=nd(ce.anchor,ce.width,ce.height,ce.textOffset,ce.textBoxScale),q&&ve._rotate(H?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Te=!1}if(Yt.textBox||Yt.verticalTextBox){let ce;Yt.textBox&&(ce=Gt),Yt.verticalTextBox&&(ce=Ht),zh(s.textCollisionBox.collisionVertexArray,Et.text.placed,!Te||ce,Wt.text,ve.x,ve.y)}}if(Yt.iconBox||Yt.verticalIconBox){const Te=!!(!Ht&&Yt.verticalIconBox);let ce;Yt.iconBox&&(ce=Te),Yt.verticalIconBox&&(ce=!Te),zh(s.iconCollisionBox.collisionVertexArray,Et.icon.placed,ce,Wt.icon,Y?ve.x:0,Y?ve.y:0)}}}}if(s.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(s.collisionCircleArray=this.collisionCircleArrays[s.bucketInstanceId],delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>s}setStale(){this.stale=!0}}function zh(T,s,h,_,b,A){_&&_.length!==0||(_=[0,0,0,0]);const M=_[0]-vn,k=_[1]-vn,O=_[2]-vn,z=_[3]-vn;T.emplaceBack(s?1:0,h?1:0,b||0,A||0,M,k),T.emplaceBack(s?1:0,h?1:0,b||0,A||0,O,k),T.emplaceBack(s?1:0,h?1:0,b||0,A||0,O,z),T.emplaceBack(s?1:0,h?1:0,b||0,A||0,M,z)}const rd=Math.pow(2,25),Mu=Math.pow(2,24),sd=Math.pow(2,17),bs=Math.pow(2,16),Uh=Math.pow(2,9),Vh=Math.pow(2,8),Ru=Math.pow(2,1);function Ul(T){if(T.opacity===0&&!T.placed)return 0;if(T.opacity===1&&T.placed)return 4294967295;const s=T.placed?1:0,h=Math.floor(127*T.opacity);return h*rd+s*Mu+h*sd+s*bs+h*Uh+s*Vh+h*Ru+s}const ka=0;class Pu{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,_,b,A){const M=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(M,b,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(((k,O)=>k.sortKey-O.sortKey)));this._currentPartIndex<M.length;)if(h.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,A())return!0;return!1}}class Vl{constructor(s,h,_,b,A,M,k,O){this.placement=new t_(s,h,M,k,O),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(s,h,_){const b=at(),A=()=>!this._forceFullPlacement&&at()-b>2;for(;this._currentPlacementIndex>=0;){const M=h[s[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=k)&&(!M.maxzoom||M.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Pu(M)),this._inProgressLayer.continuePlacement(_[M.source],this.placement,this._showCollisionBoxes,M,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Oa=512/l.a3/2;class ad{constructor(s,h,_){this.tileID=s,this.bucketInstanceId=_,this._symbolsByKey={};const b=new Map;for(let A=0;A<h.length;A++){const M=h.get(A),k=M.key,O=b.get(k);O?O.push(M):b.set(k,[M])}for(const[A,M]of b){const k={positions:M.map((O=>({x:Math.floor(O.anchorX*Oa),y:Math.floor(O.anchorY*Oa)}))),crossTileIDs:M.map((O=>O.crossTileID))};if(k.positions.length>128){const O=new l.aN(k.positions.length,16,Uint16Array);for(const{x:z,y:U}of k.positions)O.add(z,U);O.finish(),delete k.positions,k.index=O}this._symbolsByKey[A]=k}}getScaledCoordinates(s,h){const{x:_,y:b,z:A}=this.tileID.canonical,{x:M,y:k,z:O}=h.canonical,z=Oa/Math.pow(2,O-A),U=(k*l.a3+s.anchorY)*z,q=b*l.a3*Oa;return{x:Math.floor((M*l.a3+s.anchorX)*z-_*l.a3*Oa),y:Math.floor(U-q)}}findMatches(s,h,_){const b=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let A=0;A<s.length;A++){const M=s.get(A);if(M.crossTileID)continue;const k=this._symbolsByKey[M.key];if(!k)continue;const O=this.getScaledCoordinates(M,h);if(k.index){const z=k.index.range(O.x-b,O.y-b,O.x+b,O.y+b).sort();for(const U of z){const q=k.crossTileIDs[U];if(!_[q]){_[q]=!0,M.crossTileID=q;break}}}else if(k.positions)for(let z=0;z<k.positions.length;z++){const U=k.positions[z],q=k.crossTileIDs[z];if(Math.abs(U.x-O.x)<=b&&Math.abs(U.y-O.y)<=b&&!_[q]){_[q]=!0,M.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:s})=>s))}}class qp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ba{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const _ in this.indexes){const b=this.indexes[_],A={};for(const M in b){const k=b[M];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),A[k.tileID.key]=k}this.indexes[_]=A}this.lng=s}addBucket(s,h,_){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let A=0;A<h.symbolInstances.length;A++)h.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const b=this.usedCrossTileIDs[s.overscaledZ];for(const A in this.indexes){const M=this.indexes[A];if(Number(A)>s.overscaledZ)for(const k in M){const O=M[k];O.tileID.isChildOf(s)&&O.findMatches(h.symbolInstances,s,b)}else{const k=M[s.scaledTo(Number(A)).key];k&&k.findMatches(h.symbolInstances,s,b)}}for(let A=0;A<h.symbolInstances.length;A++){const M=h.symbolInstances.get(A);M.crossTileID||(M.crossTileID=_.generate(),b[M.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new ad(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const _ of h.getCrossTileIDsLists())for(const b of _)delete this.usedCrossTileIDs[s][b]}removeStaleBuckets(s){let h=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const A in b)s[b[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[A]),delete b[A],h=!0)}return h}}class jl{constructor(){this.layerIndexes={},this.crossTileIDs=new qp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,_){let b=this.layerIndexes[s.id];b===void 0&&(b=this.layerIndexes[s.id]=new Ba);let A=!1;const M={};b.handleWrapJump(_);for(const k of h){const O=k.getBucket(s);O&&s.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(k.tileID,O,this.crossTileIDs)&&(A=!0),M[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(A=!0),A}pruneUnusedLayers(s){const h={};s.forEach((_=>{h[_]=!0}));for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}var bi="void main() {fragColor=vec4(1.0);}";const is={prelude:hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:hi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:hi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:hi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hi(bi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:hi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:hi(bi,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:hi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:hi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hi(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:hi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:hi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:hi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:hi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:hi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:hi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function hi(T,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=s.match(/in ([\w]+) ([\w]+)/g),b=T.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=A?A.concat(b):b,k={};return{fragmentSource:T=T.replace(h,((O,z,U,q,H)=>(k[H]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${U} ${q} ${H};
#else
uniform ${U} ${q} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${U} ${q} ${H} = u_${H};
#endif
`))),vertexSource:s=s.replace(h,((O,z,U,q,H)=>{const Y=q==="float"?"vec2":"vec4",et=H.match(/color/)?"color":Y;return k[H]?z==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${Y} a_${H};
out ${U} ${q} ${H};
#else
uniform ${U} ${q} u_${H};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${U} ${q} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${et}(a_${H}, u_${H}_t);
#else
    ${U} ${q} ${H} = u_${H};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${Y} a_${H};
#else
uniform ${U} ${q} u_${H};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${q} ${H} = a_${H};
#else
    ${U} ${q} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${q} ${H} = unpack_mix_${et}(a_${H}, u_${H}_t);
#else
    ${U} ${q} ${H} = u_${H};
#endif
`})),staticAttributes:_,staticUniforms:M}}class La{constructor(s,h,_){this.vertexBuffer=s,this.indexBuffer=h,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Bn=l.aO([{name:"a_pos",type:"Int16",components:2}]);const jn="#define PROJECTION_MERCATOR",$n="mercator";class Kn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return $n}get shaderDefine(){return jn}get shaderPreludeCode(){return is.projectionMercator}get vertexShaderPreludeCode(){return is.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aP.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(s){}getMeshFromTileID(s,h,_,b,A){if(this._cachedMesh)return this._cachedMesh;const M=new l.aQ;M.emplaceBack(0,0),M.emplaceBack(l.a3,0),M.emplaceBack(0,l.a3),M.emplaceBack(l.a3,l.a3);const k=s.createVertexBuffer(M,Bn.members),O=l.aR.simpleSegment(0,0,4,2),z=new l.aS;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const U=s.createIndexBuffer(z);return this._cachedMesh=new La(k,U,O),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(s){}}class Zi{constructor(s=0,h=0,_=0,b=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=_,this.right=b}interpolate(s,h,_){return h.top!=null&&s.top!=null&&(this.top=l.F.number(s.top,h.top,_)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.F.number(s.bottom,h.bottom,_)),h.left!=null&&s.left!=null&&(this.left=l.F.number(s.left,h.left,_)),h.right!=null&&s.right!=null&&(this.right=l.F.number(s.right,h.right,_)),this}getCenter(s,h){const _=l.ai((this.left+s-this.right)/2,0,s),b=l.ai((this.top+h-this.bottom)/2,0,h);return new l.P(_,b)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Zi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Iu(T,s){if(!T.renderWorldCopies||T.lngRange)return;const h=s.lng-T.center.lng;s.lng+=h>180?-360:h<-180?360:0}function lr(T){return Math.max(0,Math.floor(T))}class Ln{constructor(s,h){var _;this.applyConstrain=(b,A)=>this._constrainOverride!==null?this._constrainOverride(b,A):this._callbacks.defaultConstrain(b,A),this._callbacks=s,this._tileSize=512,this._renderWorldCopies=h?.renderWorldCopies===void 0||!!h?.renderWorldCopies,this._minZoom=h?.minZoom||0,this._maxZoom=h?.maxZoom||22,this._minPitch=h?.minPitch==null?0:h?.minPitch,this._maxPitch=h?.maxPitch==null?60:h?.maxPitch,this._constrainOverride=(_=h?.constrainOverride)!==null&&_!==void 0?_:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.U(0,0),this._elevation=0,this._zoom=0,this._tileZoom=lr(this._zoom),this._scale=l.al(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Zi,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(s,h,_){this._constrainOverride=s.constrainOverride,this._latRange=s.latRange,this._lngRange=s.lngRange,this._width=s.width,this._height=s.height,this._center=s.center,this._elevation=s.elevation,this._minElevationForCurrentTile=s.minElevationForCurrentTile,this._zoom=s.zoom,this._tileZoom=lr(this._zoom),this._scale=l.al(this._zoom),this._bearingInRadians=s.bearingInRadians,this._fovInRadians=s.fovInRadians,this._pitchInRadians=s.pitchInRadians,this._rollInRadians=s.rollInRadians,this._unmodified=s.unmodified,this._edgeInsets=new Zi(s.padding.top,s.padding.bottom,s.padding.left,s.padding.right),this._minZoom=s.minZoom,this._maxZoom=s.maxZoom,this._minPitch=s.minPitch,this._maxPitch=s.maxPitch,this._renderWorldCopies=s.renderWorldCopies,this._cameraToCenterDistance=s.cameraToCenterDistance,this._nearZ=s.nearZ,this._farZ=s.farZ,this._autoCalculateNearFarZ=!_&&s.autoCalculateNearFarZ,h&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(s){this._minElevationForCurrentTile=s}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(s){this._minZoom!==s&&(this._minZoom=s,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(s){this._minPitch!==s&&(this._minPitch=s,this.setPitch(Math.max(this.pitch,s)))}get maxPitch(){return this._maxPitch}setMaxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.setPitch(Math.min(this.pitch,s)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get constrainOverride(){return this._constrainOverride}setConstrainOverride(s){s===void 0&&(s=null),this._constrainOverride!==s&&(this._constrainOverride=s,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(s){const h=l.V(s,-180,180)*Math.PI/180;var _,b,A,M,k,O,z,U,q;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=C(),_=this._rotationMatrix,A=-this._bearingInRadians,M=(b=this._rotationMatrix)[0],k=b[1],O=b[2],z=b[3],U=Math.sin(A),q=Math.cos(A),_[0]=M*q+O*U,_[1]=k*q+z*U,_[2]=M*-U+O*q,_[3]=k*-U+z*q)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(s){const h=l.ai(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(s){const h=s/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aT(this._fovInRadians)}setFov(s){s=l.ai(s,.1,150),this.fov!==s&&(this._unmodified=!1,this._fovInRadians=l.ak(s),this._calcMatrices())}get zoom(){return this._zoom}setZoom(s){const h=this.applyConstrain(this._center,s).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=l.al(h),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(s){s!==this._elevation&&(this._elevation=s,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(s,h){this._autoCalculateNearFarZ=!1,this._nearZ=s,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,_){this._unmodified=!1,this._edgeInsets.interpolate(s,h,_),this.constrainInternal(),this._calcMatrices()}resize(s,h,_=!0){this._width=s,this._height=h,_&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new wn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(s){s?(this._lngRange=[s.getWest(),s.getEast()],this._latRange=[s.getSouth(),s.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.aj,l.aj])}getCameraQueryGeometry(s,h){if(h.length===1)return[h[0],s];{const{minX:_,minY:b,maxX:A,maxY:M}=l.a6.fromPoints(h).extend(s);return[new l.P(_,b),new l.P(A,b),new l.P(A,M),new l.P(_,M),new l.P(_,b)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:h,zoom:_}=this.applyConstrain(this.center,this.zoom);this.setCenter(h),this.setZoom(_),this._unmodified=s,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let s=l.am(new Float64Array(16));l.O(s,s,[this._width/2,-this._height/2,1]),l.N(s,s,[1,-1,0]),this._clipSpaceToPixelsMatrix=s,s=l.am(new Float64Array(16)),l.O(s,s,[1,-1,1]),l.N(s,s,[-1,-1,0]),l.O(s,s,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=s,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(s,h,_,b){const A=_!==void 0?_:this.bearing,M=b=b!==void 0?b:this.pitch,k=l.a5.fromLngLat(s,h),O=-Math.cos(l.ak(M)),z=Math.sin(l.ak(M)),U=z*Math.sin(l.ak(A)),q=-z*Math.cos(l.ak(A));let H=this.elevation;const Y=h-H;let et;O*Y>=0||Math.abs(O)<.1?(et=1e4,H=h+et*O):et=-Y/O;let ot,ct,ht=l.aU(1,k.y),_t=0;do{if(_t+=1,_t>10)break;ct=et/ht,ot=new l.a5(k.x+U*ct,k.y+q*ct),ht=1/ot.meterInMercatorCoordinateUnits()}while(Math.abs(et-ct*ht)>1e-12);return{center:ot.toLngLat(),elevation:H,zoom:l.ao(this.height/2/Math.tan(this.fovInRadians/2)/ct/this.tileSize)}}recalculateZoomAndCenter(s){if(this.elevation-s==0)return;const h=l.an(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/h,b=l.a5.fromLngLat(this.center,this.elevation),A=Ot(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=s;const M=this.calculateCenterFromCameraLngLatAlt(A.toLngLat(),l.aU(A.z,b.y),this.bearing,this.pitch);this._elevation=M.elevation,this._center=M.center,this.setZoom(M.zoom)}getCameraPoint(){const s=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(s*Math.sin(this.rollInRadians),s*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const s=l.an(1,this.center.lat)*this.worldSize;return Ot(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/s).toLngLat()}getMercatorTileCoordinates(s){if(!s)return[0,0,1,1];const h=s.canonical.z>=0?1<<s.canonical.z:Math.pow(2,s.canonical.z);return[s.canonical.x/h,s.canonical.y/h,1/h/l.a3,1/h/l.a3]}}class _r{constructor(s,h){this.min=s,this.max=h,this.center=l.aV([],l.aW([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],_=l.aX(this.min),b=l.aX(this.max);for(let A=0;A<h.length;A++)_[A]=h[A]?this.min[A]:this.center[A],b[A]=h[A]?this.center[A]:this.max[A];return b[2]=this.max[2],new _r(_,b)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersectsFrustum(s){let h=!0;for(let _=0;_<s.planes.length;_++){const b=this.intersectsPlane(s.planes[_]);if(b===0)return 0;b===1&&(h=!1)}return h?2:s.aabb.min[0]>this.max[0]||s.aabb.min[1]>this.max[1]||s.aabb.min[2]>this.max[2]||s.aabb.max[0]<this.min[0]||s.aabb.max[1]<this.min[1]||s.aabb.max[2]<this.min[2]?0:1}intersectsPlane(s){let h=s[3],_=s[3];for(let b=0;b<3;b++)s[b]>0?(h+=s[b]*this.min[b],_+=s[b]*this.max[b]):(_+=s[b]*this.min[b],h+=s[b]*this.max[b]);return h>=0?2:_<0?0:1}}class Nc{distanceToTile2d(s,h,_,b){const A=b.distanceX([s,h]),M=b.distanceY([s,h]);return Math.hypot(A,M)}getWrap(s,h,_){return _}getTileBoundingVolume(s,h,_,b){var A,M;let k=0,O=0;if(b?.terrain){const U=new l.a0(s.z,h,s.z,s.x,s.y),q=b.terrain.getMinMaxElevation(U);k=(A=q.minElevation)!==null&&A!==void 0?A:Math.min(0,_),O=(M=q.maxElevation)!==null&&M!==void 0?M:Math.max(0,_)}const z=1<<s.z;return new _r([h+s.x/z,s.y/z,k],[h+(s.x+1)/z,(s.y+1)/z,O])}allowVariableZoom(s,h){const _=s.fov*(Math.abs(Math.cos(s.rollInRadians))*s.height+Math.abs(Math.sin(s.rollInRadians))*s.width)/s.height,b=l.ai(78.5-_/2,0,60);return!!h.terrain||s.pitch>b}allowWorldCopies(){return!0}prepareNextFrame(){}}class ns{constructor(s,h,_){this.points=s,this.planes=h,this.aabb=_}static fromInvProjectionMatrix(s,h=1,_=0,b,A){const M=A?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],k=Math.pow(2,_),O=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((H=>(function(Y,et,ot,ct){const ht=l.aB([],Y,et),_t=1/ht[3]/ot*ct;return l.b0(ht,ht,[_t,_t,1/ht[3],_t])})(H,s,h,k)));b&&(function(H,Y,et,ot){const ct=ot?4:0,ht=ot?0:4;let _t=0;const Tt=[],gt=[];for(let xt=0;xt<4;xt++){const Bt=l.aY([],H[xt+ht],H[xt+ct]),Gt=l.b1(Bt);l.aV(Bt,Bt,1/Gt),Tt.push(Gt),gt.push(Bt)}for(let xt=0;xt<4;xt++){const Bt=l.b2(H[xt+ct],gt[xt],et);_t=Bt!==null&&Bt>=0?Math.max(_t,Bt):Math.max(_t,Tt[xt])}const St=(function(xt,Bt){const Gt=l.aY([],xt[Bt[0]],xt[Bt[1]]),Ht=l.aY([],xt[Bt[2]],xt[Bt[1]]),Wt=[0,0,0,0];return l.aZ(Wt,l.a_([],Gt,Ht)),Wt[3]=-l.a$(Wt,xt[Bt[0]]),Wt})(H,Y),Et=(function(xt,Bt){const Gt=l.b3(xt),Ht=l.b4([],xt,1/Gt),Wt=l.aY([],Bt,l.aV([],Ht,l.a$(Bt,Ht))),Yt=l.b3(Wt);if(Yt>0){const ve=Math.sqrt(1-Ht[3]*Ht[3]),Te=l.aV([],Ht,-Ht[3]),ce=l.aW([],Te,l.aV([],Wt,ve/Yt));return l.b5(Bt,ce)}return null})(et,St);if(Et!==null){const xt=Et/l.a$(gt[0],St);_t=Math.min(_t,xt)}for(let xt=0;xt<4;xt++){const Bt=Math.min(_t,Tt[xt]);H[xt+ht]=[H[xt+ct][0]+gt[xt][0]*Bt,H[xt+ct][1]+gt[xt][1]*Bt,H[xt+ct][2]+gt[xt][2]*Bt,1]}})(O,M[0],b,A);const z=M.map((H=>{const Y=l.aY([],O[H[0]],O[H[1]]),et=l.aY([],O[H[2]],O[H[1]]),ot=l.aZ([],l.a_([],Y,et)),ct=-l.a$(ot,O[H[1]]);return ot.concat(ct)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],q=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const H of O)for(let Y=0;Y<3;Y++)U[Y]=Math.min(U[Y],H[Y]),q[Y]=Math.max(q[Y],H[Y]);return new ns(O,z,new _r(U,q))}}class nn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,h,_){return this._helper.interpolatePadding(s,h,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,h,_=!0){this._helper.resize(s,h,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,h){this._helper.overrideNearFarZ(s,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s,h){}constructor(s){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(h,_)=>{_=l.ai(+_,this.minZoom,this.maxZoom);const b={center:new l.U(h.lng,h.lat),zoom:_};let A=this._helper._lngRange;if(!this._helper._renderWorldCopies&&A===null){const gt=179.9999999999;A=[-gt,gt]}const M=this.tileSize*l.al(b.zoom);let k=0,O=M,z=0,U=M,q=0,H=0;const{x:Y,y:et}=this.size;if(this._helper._latRange){const gt=this._helper._latRange;k=l.W(gt[1])*M,O=l.W(gt[0])*M,O-k<et&&(q=et/(O-k))}A&&(z=l.V(l.X(A[0])*M,0,M),U=l.V(l.X(A[1])*M,0,M),U<z&&(U+=M),U-z<Y&&(H=Y/(U-z)));const{x:ot,y:ct}=bt(M,h);let ht,_t;const Tt=Math.max(H||0,q||0);if(Tt){const gt=new l.P(H?(U+z)/2:ot,q?(O+k)/2:ct);return b.center=wt(M,gt).wrap(),b.zoom+=l.ao(Tt),b}if(this._helper._latRange){const gt=et/2;ct-gt<k&&(_t=k+gt),ct+gt>O&&(_t=O-gt)}if(A){const gt=(z+U)/2;let St=ot;this._helper._renderWorldCopies&&(St=l.V(ot,gt-M/2,gt+M/2));const Et=Y/2;St-Et<z&&(ht=z+Et),St+Et>U&&(ht=U-Et)}if(ht!==void 0||_t!==void 0){const gt=new l.P(ht??ot,_t??ct);b.center=wt(M,gt).wrap()}return b},this.applyConstrain=(h,_)=>this._helper.applyConstrain(h,_),this._helper=new Ln({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(h,_)=>this.defaultConstrain(h,_)},s),this._coveringTilesDetailsProvider=new Nc}clone(){const s=new nn;return s.apply(this),s}apply(s,h,_){this._helper.apply(s,h,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(s){const h=[new l.b6(0,s)];if(this._helper._renderWorldCopies){const _=this.screenPointToMercatorCoordinate(new l.P(0,0)),b=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),A=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),M=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),k=Math.floor(Math.min(_.x,b.x,A.x,M.x)),O=Math.floor(Math.max(_.x,b.x,A.x,M.x)),z=1;for(let U=k-z;U<=O+z;U++)U!==0&&h.push(new l.b6(U,s))}return h}getCameraFrustum(){return ns.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){const h=this.screenPointToLocation(this.centerPoint,s),_=s?s.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(s,h){const _=l.an(this.elevation,this.center.lat),b=this.screenPointToMercatorCoordinateAtZ(h,_),A=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),M=l.a5.fromLngLat(s),k=new l.a5(M.x-(b.x-A.x),M.y-(b.y-A.y));this.setCenter(k?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(s,h){return h?this.coordinatePoint(l.a5.fromLngLat(s),h.getElevationForLngLatZoom(s,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.a5.fromLngLat(s))}screenPointToLocation(s,h){var _;return(_=this.screenPointToMercatorCoordinate(s,h))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(s,h){if(h){const _=h.pointCoordinate(s);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(s)}screenPointToMercatorCoordinateAtZ(s,h){const _=h||0,b=[s.x,s.y,0,1],A=[s.x,s.y,1,1];l.aB(b,b,this._pixelMatrixInverse),l.aB(A,A,this._pixelMatrixInverse);const M=b[3],k=A[3],O=b[1]/M,z=A[1]/k,U=b[2]/M,q=A[2]/k,H=U===q?0:(_-U)/(q-U);return new l.a5(l.F.number(b[0]/M,A[0]/k,H)/this.worldSize,l.F.number(O,z,H)/this.worldSize,_)}coordinatePoint(s,h=0,_=this._pixelMatrix){const b=[s.x*this.worldSize,s.y*this.worldSize,h,1];return l.aB(b,b,_),new l.P(b[0]/b[3],b[1]/b[3])}getBounds(){const s=Math.max(0,this._helper._height/2-Ft(this));return new wn().extend(this.screenPointToLocation(new l.P(0,s))).extend(this.screenPointToLocation(new l.P(this._helper._width,s))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(s,h){return h?h.pointCoordinate(s)!=null:s.y>this.height/2-Ft(this)}calculatePosMatrix(s,h=!1,_){var b;const A=(b=s.key)!==null&&b!==void 0?b:l.b7(s.wrap,s.canonical.z,s.canonical.z,s.canonical.x,s.canonical.y),M=h?this._alignedPosMatrixCache:this._posMatrixCache;if(M.has(A)){const z=M.get(A);return _?z.f32:z.f64}const k=ut(s,this.worldSize);l.Q(k,h?this._alignedProjMatrix:this._viewProjMatrix,k);const O={f64:k,f32:new Float32Array(k)};return M.set(A,O),_?O.f32:O.f64}calculateFogMatrix(s){const h=s.key,_=this._fogMatrixCacheF32;if(_.has(h))return _.get(h);const b=ut(s,this.worldSize);return l.Q(b,this._fogMatrix,b),_.set(h,new Float32Array(b)),_.get(h)}calculateCenterFromCameraLngLatAlt(s,h,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(s,h,_,b)}_calculateNearFarZIfNeeded(s,h,_){if(!this._helper.autoCalculateNearFarZ)return;const b=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),A=s-b*this._helper._pixelPerMeter/Math.cos(h),M=b<0?A:s,k=Math.PI/2+this.pitchInRadians,O=l.ak(this.fov)*(Math.abs(Math.cos(l.ak(this.roll)))*this.height+Math.abs(Math.sin(l.ak(this.roll)))*this.width)/this.height*(.5+_.y/this.height),z=Math.sin(O)*M/Math.sin(l.ai(Math.PI-k-O,.01,Math.PI-.01)),U=Ft(this),q=Math.atan(U/this._helper.cameraToCenterDistance),H=l.ak(.75),Y=q>H?2*q*(.5+_.y/(2*U)):H,et=Math.sin(Y)*M/Math.sin(l.ai(Math.PI-k-Y,.01,Math.PI-.01)),ot=Math.min(z,et);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*ot+M),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const s=this.centerOffset,h=bt(this.worldSize,this.center),_=h.x,b=h.y;this._helper._pixelPerMeter=l.an(1,this.center.lat)*this.worldSize;const A=l.ak(Math.min(this.pitch,rt)),M=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(A));let k;this._calculateNearFarZIfNeeded(M,A,s),k=new Float64Array(16),l.b8(k,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.av(this._invProjMatrix,k),k[8]=2*-s.x/this._helper._width,k[9]=2*s.y/this._helper._height,this._projectionMatrix=l.b9(k),l.O(k,k,[1,-1,1]),l.N(k,k,[0,0,-this._helper.cameraToCenterDistance]),l.ba(k,k,-this.rollInRadians),l.bb(k,k,this.pitchInRadians),l.ba(k,k,-this.bearingInRadians),l.N(k,k,[-_,-b,0]),this._mercatorMatrix=l.O([],k,[this.worldSize,this.worldSize,this.worldSize]),l.O(k,k,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,k),l.N(k,k,[0,0,-this.elevation]),this._viewProjMatrix=k,this._invViewProjMatrix=l.av([],k);const O=[0,0,-1,1];l.aB(O,O,this._invViewProjMatrix),this._cameraPosition=[O[0]/O[3],O[1]/O[3],O[2]/O[3]],this._fogMatrix=new Float64Array(16),l.b8(this._fogMatrix,this.fovInRadians,this.width/this.height,M,this._helper._farZ),this._fogMatrix[8]=2*-s.x/this.width,this._fogMatrix[9]=2*s.y/this.height,l.O(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.N(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.ba(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bb(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.ba(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.N(this._fogMatrix,this._fogMatrix,[-_,-b,0]),l.O(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.N(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,k);const z=this._helper._width%2/2,U=this._helper._height%2/2,q=Math.cos(this.bearingInRadians),H=Math.sin(-this.bearingInRadians),Y=_-Math.round(_)+q*z+H*U,et=b-Math.round(b)+q*U+H*z,ot=new Float64Array(k);if(l.N(ot,ot,[Y>.5?Y-1:Y,et>.5?et-1:et,0]),this._alignedProjMatrix=ot,k=l.av(new Float64Array(16),this._pixelMatrix),!k)throw new Error("failed to invert matrix");this._pixelMatrixInverse=k,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const s=this.screenPointToMercatorCoordinate(new l.P(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.aB(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const s=l.an(1,this.center.lat)*this.worldSize;return Ot(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/s).toLngLat()}lngLatToCameraDepth(s,h){const _=l.a5.fromLngLat(s),b=[_.x*this.worldSize,_.y*this.worldSize,h,1];return l.aB(b,b,this._viewProjMatrix),b[2]/b[3]}getProjectionData(s){const{overscaledTileID:h,aligned:_,applyTerrainMatrix:b}=s,A=this._helper.getMercatorTileCoordinates(h),M=h?this.calculatePosMatrix(h,_,!0):null;let k;return k=h&&h.terrainRttPosMatrix32f&&b?h.terrainRttPosMatrix32f:M||l.bc(),{mainMatrix:k,tileMercatorCoords:A,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:k}}isLocationOccluded(s){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(s,h,_){return 1}transformLightDirection(s){return l.aX(s)}getRayDirectionFromPixel(s){throw new Error("Not implemented.")}projectTileCoordinates(s,h,_,b){const A=this.calculatePosMatrix(_);let M;b?(M=[s,h,b(s,h),1],l.aB(M,M,A)):(M=[s,h,0,1],Cu(M,M,A));const k=M[3];return{point:new l.P(M[0]/k,M[1]/k),signedDistanceFromCamera:k,isOccluded:!1}}populateCache(s){for(const h of s)this.calculatePosMatrix(h)}getMatrixForModel(s,h){const _=l.a5.fromLngLat(s,h),b=_.meterInMercatorCoordinateUnits(),A=l.bd();return l.N(A,A,[_.x,_.y,_.z]),l.ba(A,A,Math.PI),l.bb(A,A,Math.PI/2),l.O(A,A,[-b,b,b]),A}getProjectionDataForCustomLayer(s=!0){const h=new l.a0(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:s}),b=ut(h,this.worldSize);l.Q(b,this._viewProjMatrix,b),_.tileMercatorCoords=[0,0,1,1];const A=[l.a3,l.a3,this.worldSize/this._helper.pixelsPerMeter],M=l.be();return l.O(M,b,A),_.fallbackMatrix=M,_.mainMatrix=M,_}getFastPathSimpleProjectionMatrix(s){return this.calculatePosMatrix(s)}}function lo(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function co(T){if(T.useSlerp)if(T.k<1){const s=l.bf(T.startEulerAngles.roll,T.startEulerAngles.pitch,T.startEulerAngles.bearing),h=l.bf(T.endEulerAngles.roll,T.endEulerAngles.pitch,T.endEulerAngles.bearing),_=new Float64Array(4);l.bg(_,s,h,T.k);const b=l.bh(_);T.tr.setRoll(b.roll),T.tr.setPitch(b.pitch),T.tr.setBearing(b.bearing)}else T.tr.setRoll(T.endEulerAngles.roll),T.tr.setPitch(T.endEulerAngles.pitch),T.tr.setBearing(T.endEulerAngles.bearing);else T.tr.setRoll(l.F.number(T.startEulerAngles.roll,T.endEulerAngles.roll,T.k)),T.tr.setPitch(l.F.number(T.startEulerAngles.pitch,T.endEulerAngles.pitch,T.k)),T.tr.setBearing(l.F.number(T.startEulerAngles.bearing,T.endEulerAngles.bearing,T.k))}function Go(T,s,h,_,b){const A=b.padding,M=bt(b.worldSize,h.getNorthWest()),k=bt(b.worldSize,h.getNorthEast()),O=bt(b.worldSize,h.getSouthEast()),z=bt(b.worldSize,h.getSouthWest()),U=l.ak(-_),q=M.rotate(U),H=k.rotate(U),Y=O.rotate(U),et=z.rotate(U),ot=new l.P(Math.max(q.x,H.x,et.x,Y.x),Math.max(q.y,H.y,et.y,Y.y)),ct=new l.P(Math.min(q.x,H.x,et.x,Y.x),Math.min(q.y,H.y,et.y,Y.y)),ht=ot.sub(ct),_t=(b.width-(A.left+A.right+s.left+s.right))/ht.x,Tt=(b.height-(A.top+A.bottom+s.top+s.bottom))/ht.y;if(Tt<0||_t<0)return void lo();const gt=Math.min(l.ao(b.scale*Math.min(_t,Tt)),T.maxZoom),St=l.P.convert(T.offset),Et=new l.P((s.left-s.right)/2,(s.top-s.bottom)/2).rotate(l.ak(_)),xt=St.add(Et).mult(b.scale/l.al(gt));return{center:wt(b.worldSize,M.add(O).div(2).sub(xt)),zoom:gt,bearing:_}}class Er{get useGlobeControls(){return!1}handlePanInertia(s,h){const _=s.mag(),b=Math.abs(Ft(h));return{easingOffset:s.mult(Math.min(.75*b/_,1)),easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(s,h){s.bearingDelta&&h.setBearing(h.bearing+s.bearingDelta),s.pitchDelta&&h.setPitch(h.pitch+s.pitchDelta),s.rollDelta&&h.setRoll(h.roll+s.rollDelta),s.zoomDelta&&h.setZoom(h.zoom+s.zoomDelta)}handleMapControlsPan(s,h,_){s.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(_,s.around)}cameraForBoxAndBearing(s,h,_,b,A){return Go(s,h,_,b,A)}handleJumpToCenterZoom(s,h){s.zoom!==(h.zoom!==void 0?+h.zoom:s.zoom)&&s.setZoom(+h.zoom),h.center!==void 0&&s.setCenter(l.U.convert(h.center))}handleEaseTo(s,h){const _=s.zoom,b=s.padding,A={roll:s.roll,pitch:s.pitch,bearing:s.bearing},M={roll:h.roll===void 0?s.roll:h.roll,pitch:h.pitch===void 0?s.pitch:h.pitch,bearing:h.bearing===void 0?s.bearing:h.bearing},k=h.zoom!==void 0,O=!s.isPaddingEqual(h.padding);let z=!1;const U=k?+h.zoom:s.zoom;let q=s.centerPoint.add(h.offsetAsPoint);const H=s.screenPointToLocation(q),{center:Y,zoom:et}=s.applyConstrain(l.U.convert(h.center||H),U??_);Iu(s,Y);const ot=bt(s.worldSize,H),ct=bt(s.worldSize,Y).sub(ot),ht=l.al(et-_);return z=et!==_,{easeFunc:_t=>{if(z&&s.setZoom(l.F.number(_,et,_t)),l.bi(A,M)||co({startEulerAngles:A,endEulerAngles:M,tr:s,k:_t,useSlerp:A.roll!=M.roll}),O&&(s.interpolatePadding(b,h.padding,_t),q=s.centerPoint.add(h.offsetAsPoint)),h.around)s.setLocationAtPoint(h.around,h.aroundPoint);else{const Tt=l.al(s.zoom-_),gt=et>_?Math.min(2,ht):Math.max(.5,ht),St=Math.pow(gt,1-_t),Et=wt(s.worldSize,ot.add(ct.mult(_t*St)).mult(Tt));s.setLocationAtPoint(s.renderWorldCopies?Et.wrap():Et,q)}},isZooming:z,elevationCenter:Y}}handleFlyTo(s,h){const _=h.zoom!==void 0,b=s.zoom,A=s.applyConstrain(l.U.convert(h.center||h.locationAtOffset),_?+h.zoom:b),M=A.center,k=A.zoom;Iu(s,M);const O=bt(s.worldSize,h.locationAtOffset),z=bt(s.worldSize,M).sub(O),U=z.mag(),q=l.al(k-b);let H;if(h.minZoom!==void 0){const Y=Math.min(+h.minZoom,b,k),et=s.applyConstrain(M,Y).zoom;H=l.al(et-b)}return{easeFunc:(Y,et,ot,ct)=>{s.setZoom(Y===1?k:b+l.ao(et));const ht=Y===1?M:wt(s.worldSize,O.add(z.mult(ot)).mult(et));s.setLocationAtPoint(s.renderWorldCopies?ht.wrap():ht,ct)},scaleOfZoom:q,targetCenter:M,scaleOfMinZoom:H,pixelPathLength:U}}}class ln{constructor(s,h,_){this.blendFunction=s,this.blendColor=h,this.mask=_}}ln.Replace=[1,0],ln.disabled=new ln(ln.Replace,l.bj.transparent,[!1,!1,!1,!1]),ln.unblended=new ln(ln.Replace,l.bj.transparent,[!0,!0,!0,!0]),ln.alphaBlended=new ln([1,771],l.bj.transparent,[!0,!0,!0,!0]);const Pn=2305;class _i{constructor(s,h,_){this.enable=s,this.mode=h,this.frontFace=_}}_i.disabled=new _i(!1,1029,Pn),_i.backCCW=new _i(!0,1029,Pn),_i.frontCCW=new _i(!0,1028,Pn);class oi{constructor(s,h,_){this.func=s,this.mask=h,this.range=_}}oi.ReadOnly=!1,oi.ReadWrite=!0,oi.disabled=new oi(519,oi.ReadOnly,[0,1]);const Fa=7680;class Ei{constructor(s,h,_,b,A,M){this.test=s,this.ref=h,this.mask=_,this.fail=b,this.depthFail=A,this.pass=M}}Ei.disabled=new Ei({func:519,mask:0},0,0,Fa,Fa,Fa);const Yo=new WeakMap;function Bs(T){var s;if(Yo.has(T))return Yo.get(T);{const h=(s=T.getParameter(T.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Yo.set(T,h),h}}class uo{get awaitingQuery(){return!!this._readbackQueue}constructor(s){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=s;const h=s.context,_=h.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;const b=new l.aQ;b.emplaceBack(-1,-1),b.emplaceBack(2,-1),b.emplaceBack(-1,2);const A=new l.aS;A.emplaceBack(0,1,2),this._fullscreenTriangle=new La(h.createVertexBuffer(b,Bn.members),h.createIndexBuffer(A),l.aR.simpleSegment(0,0,b.length,A.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(_.TEXTURE1);const M=_.createTexture();_.bindTexture(_.TEXTURE_2D,M),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(M),Bs(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){const s=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),s.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(s,h){const _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(s,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const s=this._cachedRenderContext.context,h=s.gl;s.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),s.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(s,h){const _=this._cachedRenderContext.context,b=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:l.bj.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,b.TRIANGLES,oi.disabled,Ei.disabled,ln.unblended,_i.disabled,((A,M)=>({u_input:A,u_output_expected:M}))(s,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Bs(b)){b.bindBuffer(b.PIXEL_PACK_BUFFER,this._pbo),b.readBuffer(b.COLOR_ATTACHMENT0),b.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),b.bindBuffer(b.PIXEL_PACK_BUFFER,null);const A=b.fenceSync(b.SYNC_GPU_COMMANDS_COMPLETE,0);b.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:A}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const s=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Bs(s)){const h=s.clientWaitSync(this._readbackQueue.sync,0,0);if(h===s.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===s.TIMEOUT_EXPIRED)return;s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),s.bindBuffer(s.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=uo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(s){let h=0;return h+=s[0]/256,h+=s[1]/65536,h+=s[2]/16777216,s[3]<127&&(h=-h),h/128}}const Na=l.a3/128;function Du(T,s){const h=T.granularity!==void 0?Math.max(T.granularity,1):1,_=h+(T.generateBorders?2:0),b=h+(T.extendToNorthPole||T.generateBorders?1:0)+(T.extendToSouthPole||T.generateBorders?1:0),A=_+1,M=b+1,k=T.generateBorders?-1:0,O=T.generateBorders||T.extendToNorthPole?-1:0,z=h+(T.generateBorders?1:0),U=h+(T.generateBorders||T.extendToSouthPole?1:0),q=A*M,H=_*b*6,Y=A*M>65536;if(Y&&s==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const et=Y||s==="32bit",ot=new Int16Array(2*q);let ct=0;for(let Tt=O;Tt<=U;Tt++)for(let gt=k;gt<=z;gt++){let St=gt/h*l.a3;gt===-1&&(St=-Na),gt===h+1&&(St=l.a3+Na);let Et=Tt/h*l.a3;Tt===-1&&(Et=T.extendToNorthPole?l.bl:-Na),Tt===h+1&&(Et=T.extendToSouthPole?l.bm:l.a3+Na),ot[ct++]=St,ot[ct++]=Et}const ht=et?new Uint32Array(H):new Uint16Array(H);let _t=0;for(let Tt=0;Tt<b;Tt++)for(let gt=0;gt<_;gt++){const St=gt+1+Tt*A,Et=gt+(Tt+1)*A,xt=gt+1+(Tt+1)*A;ht[_t++]=gt+Tt*A,ht[_t++]=Et,ht[_t++]=St,ht[_t++]=St,ht[_t++]=Et,ht[_t++]=xt}return{vertices:ot.buffer.slice(0),indices:ht.buffer.slice(0),uses32bitIndices:et}}const ku=new l.aP({fill:new l.bn(128,2),line:new l.bn(512,0),tile:new l.bn(128,32),stencil:new l.bn(128,1),circle:3});class Ou{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return is.projectionGlobe}get vertexShaderPreludeCode(){return is.projectionMercator.vertexSource}get subdivisionGranularity(){return ku}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(s){this._errorMeasurement||(this._errorMeasurement=new uo(s));const h=l.W(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,b=this._errorMeasurement.updateErrorLoop(h,_),A=at();b!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=b,this._errorMeasurementLastChangeTime=A);const M=Math.min(Math.max((A-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bo(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bp(M))}_getMeshKey(s){return`${s.granularity.toString(36)}_${s.generateBorders?"b":""}${s.extendToNorthPole?"n":""}${s.extendToSouthPole?"s":""}`}getMeshFromTileID(s,h,_,b,A){const M=(A==="stencil"?ku.stencil:ku.tile).getGranularityForZoomLevel(h.z);return this._getMesh(s,{granularity:M,generateBorders:_,extendToNorthPole:h.y===0&&b,extendToSouthPole:h.y===(1<<h.z)-1&&b})}_getMesh(s,h){const _=this._getMeshKey(h);if(_ in this._tileMeshCache)return this._tileMeshCache[_];const b=(function(A,M){const k=Du(M,"16bit"),O=l.aQ.deserialize({arrayBuffer:k.vertices,length:k.vertices.byteLength/2/2}),z=l.aS.deserialize({arrayBuffer:k.indices,length:k.indices.byteLength/2/3});return new La(A.createVertexBuffer(O,Bn.members),A.createIndexBuffer(z),l.aR.simpleSegment(0,0,O.length,z.length))})(s,h);return this._tileMeshCache[_]=b,b}recalculate(s){}hasTransition(){const s=at();let h=!1;return h=h||(s-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(s){this._errorQueryLatitudeDegrees=s}}const jh=new l.t({type:new l.D(l.u.projection.type)});class Ko extends l.E{constructor(s){super(),this._transitionable=new l.x(jh,void 0),this.setProjection(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.G(0)),this._mercatorProjection=new Kn,this._verticalPerspectiveProjection=new Ou}get transitionState(){const s=this.properties.get("type");if(typeof s=="string"&&s==="mercator")return 0;if(typeof s=="string"&&s==="vertical-perspective")return 1;if(s instanceof l.bq){if(s.from==="vertical-perspective"&&s.to==="mercator")return 1-s.transition;if(s.from==="mercator"&&s.to==="vertical-perspective")return s.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(s){this._mercatorProjection.updateGPUdependent(s),this._verticalPerspectiveProjection.updateGPUdependent(s)}getMeshFromTileID(s,h,_,b,A){return this.currentProjection.getMeshFromTileID(s,h,_,b,A)}setProjection(s){this._transitionable.setValue("type",s?.type||"mercator")}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}setErrorQueryLatitudeDegrees(s){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(s),this._mercatorProjection.setErrorQueryLatitudeDegrees(s)}}function Xp(T){const s=$h(T.worldSize,T.center.lat);return 2*Math.PI*s}function za(T,s,h,_,b){const A=1/(1<<b),M=s/l.a3*A+_*A,k=l.bs((T/l.a3*A+h*A)*Math.PI*2+Math.PI,2*Math.PI),O=2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI,z=Math.cos(O),U=new Float64Array(3);return U[0]=Math.sin(k)*z,U[1]=Math.sin(O),U[2]=Math.cos(k)*z,U}function Cr(T){return(function(s,h){const _=Math.cos(h),b=new Float64Array(3);return b[0]=Math.sin(s)*_,b[1]=Math.sin(h),b[2]=Math.cos(s)*_,b})(T.lng*Math.PI/180,T.lat*Math.PI/180)}function $h(T,s){return T/(2*Math.PI)/Math.cos(s*Math.PI/180)}function Zp(T){const s=Math.asin(T[1])/Math.PI*180,h=Math.sqrt(T[0]*T[0]+T[2]*T[2]);if(h>1e-6){const _=T[0]/h,b=Math.acos(T[2]/h),A=(_>0?b:-b)/Math.PI*180;return new l.U(l.V(A,-180,180),s)}return new l.U(0,s)}function yr(T){return Math.cos(T*Math.PI/180)}function Qn(T,s){const h=yr(T),_=yr(s);return l.ao(_/h)}function ua(T,s){const h=T.rotate(s.bearingInRadians),_=s.zoom+Qn(s.center.lat,0),b=l.bo(1/yr(s.center.lat),1/yr(Math.min(Math.abs(s.center.lat),60)),l.br(_,7,3,0,1)),A=360/Xp({worldSize:s.worldSize,center:{lat:s.center.lat}});return new l.U(s.center.lng-h.x*A*b,l.ai(s.center.lat+h.y*A,-l.aj,l.aj))}function zc(T){const s=.5*T,h=Math.sin(s),_=Math.cos(s);return Math.log(h+_)-Math.log(_-h)}function od(T,s,h,_){const b=T.lat+h*_;if(Math.abs(h)>1){const A=(Math.sign(T.lat+h)!==Math.sign(T.lat)?-Math.abs(T.lat):Math.abs(T.lat))*Math.PI/180,M=Math.abs(T.lat+h)*Math.PI/180,k=zc(A+_*(M-A)),O=zc(A),z=zc(M);return new l.U(T.lng+s*((k-O)/(z-O)),b)}return new l.U(T.lng+s*_,b)}class Hh{constructor(s){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=s}swapBuffers(){if(!this._hadAnyChanges)return;const s=this._cachePrevious;this._cachePrevious=this._cache,this._cache=s,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(s,h,_,b){const A=`${s.z}_${s.x}_${s.y}_${b?.terrain?"t":""}`,M=this._cache.get(A);if(M)return M;const k=this._cachePrevious.get(A);if(k)return this._cache.set(A,k),k;const O=this._boundingVolumeFactory(s,h,_,b);return this._cache.set(A,O),this._hadAnyChanges=!0,O}}class ha{constructor(s,h,_,b){this.min=_,this.max=b,this.points=s,this.planes=h}static fromAabb(s,h){const _=[];for(let b=0;b<8;b++)_.push([1&~b?s[0]:h[0],(b>>1&1)==1?h[1]:s[1],(b>>2&1)==1?h[2]:s[2]]);return new ha(_,[[-1,0,0,h[0]],[1,0,0,-s[0]],[0,-1,0,h[1]],[0,1,0,-s[1]],[0,0,-1,h[2]],[0,0,1,-s[2]]],s,h)}static fromCenterSizeAngles(s,h,_){const b=l.bv([],_[0],_[1],_[2]),A=l.bw([],[h[0],0,0],b),M=l.bw([],[0,h[1],0],b),k=l.bw([],[0,0,h[2]],b),O=[...s],z=[...s];for(let q=0;q<8;q++)for(let H=0;H<3;H++){const Y=s[H]+A[H]*(1&~q?-1:1)+M[H]*((q>>1&1)==1?1:-1)+k[H]*((q>>2&1)==1?1:-1);O[H]=Math.min(O[H],Y),z[H]=Math.max(z[H],Y)}const U=[];for(let q=0;q<8;q++){const H=[...s];l.aW(H,H,l.aV([],A,1&~q?-1:1)),l.aW(H,H,l.aV([],M,(q>>1&1)==1?1:-1)),l.aW(H,H,l.aV([],k,(q>>2&1)==1?1:-1)),U.push(H)}return new ha(U,[[...A,-l.a$(A,U[0])],[...M,-l.a$(M,U[0])],[...k,-l.a$(k,U[0])],[-A[0],-A[1],-A[2],-l.a$(A,U[7])],[-M[0],-M[1],-M[2],-l.a$(M,U[7])],[-k[0],-k[1],-k[2],-l.a$(k,U[7])]],O,z)}intersectsFrustum(s){let h=!0;const _=this.points.length,b=this.planes.length,A=s.planes.length,M=s.points.length;for(let k=0;k<A;k++){const O=s.planes[k];let z=0;for(let U=0;U<_;U++){const q=this.points[U];O[0]*q[0]+O[1]*q[1]+O[2]*q[2]+O[3]>=0&&z++}if(z===0)return 0;z<_&&(h=!1)}if(h)return 2;for(let k=0;k<b;k++){const O=this.planes[k];let z=0;for(let U=0;U<M;U++){const q=s.points[U];O[0]*q[0]+O[1]*q[1]+O[2]*q[2]+O[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(s){const h=this.points.length;let _=0;for(let b=0;b<h;b++){const A=this.points[b];s[0]*A[0]+s[1]*A[1]+s[2]*A[2]+s[3]>=0&&_++}return _===h?2:_===0?0:1}}function Wh(T,s,h){const _=T-s;return _<0?-_:Math.max(0,_-h)}function ld(T,s,h,_,b){const A=T-h;let M;return M=A<0?Math.min(-A,1+A-b):A>1?Math.min(Math.max(A-b,0),1-A):0,Math.max(M,Wh(s,_,b))}class Gp{constructor(){this._boundingVolumeCache=new Hh(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(s,h,_,b){const A=1<<_.z,M=1/A,k=_.x/A,O=_.y/A;let z=2;return z=Math.min(z,ld(s,h,k,O,M)),z=Math.min(z,ld(s,h,k+.5,-O-M,M)),z=Math.min(z,ld(s,h,k+.5,2-O-M,M)),z}getWrap(s,h,_){const b=1<<h.z,A=1/b,M=h.x/b,k=Wh(s.x,M,A),O=Wh(s.x,M-1,A),z=Wh(s.x,M+1,A),U=Math.min(k,O,z);return U===z?1:U===O?-1:0}allowVariableZoom(s,h){return He(s,h)>4}allowWorldCopies(){return!1}getTileBoundingVolume(s,h,_,b){return this._boundingVolumeCache.getTileBoundingVolume(s,h,_,b)}_computeTileBoundingVolume(s,h,_,b){var A,M;let k=0,O=0;if(b?.terrain){const z=new l.a0(s.z,h,s.z,s.x,s.y),U=b.terrain.getMinMaxElevation(z);k=(A=U.minElevation)!==null&&A!==void 0?A:Math.min(0,_),O=(M=U.maxElevation)!==null&&M!==void 0?M:Math.max(0,_)}if(k/=l.by,O/=l.by,k+=1,O+=1,s.z<=0)return ha.fromAabb([-O,-O,-O],[O,O,O]);if(s.z===1)return ha.fromAabb([s.x===0?-O:0,s.y===0?0:-O,-O],[s.x===0?0:O,s.y===0?O:0,O]);{const z=[za(0,0,s.x,s.y,s.z),za(l.a3,0,s.x,s.y,s.z),za(l.a3,l.a3,s.x,s.y,s.z),za(0,l.a3,s.x,s.y,s.z)],U=[];for(const Wt of z)U.push(l.aV([],Wt,O));if(O!==k)for(const Wt of z)U.push(l.aV([],Wt,k));s.y===0&&U.push([0,1,0]),s.y===(1<<s.z)-1&&U.push([0,-1,0]);const q=[1,1,1],H=[-1,-1,-1];for(const Wt of U)for(let Yt=0;Yt<3;Yt++)q[Yt]=Math.min(q[Yt],Wt[Yt]),H[Yt]=Math.max(H[Yt],Wt[Yt]);const Y=za(l.a3/2,l.a3/2,s.x,s.y,s.z),et=l.a_([],[0,1,0],Y);l.aZ(et,et);const ot=l.a_([],Y,et);l.aZ(ot,ot);const ct=l.a_([],z[2],z[1]);l.aZ(ct,ct);const ht=l.a_([],z[0],z[3]);l.aZ(ht,ht),U.push(l.aV([],Y,O)),s.y>=(1<<s.z)/2&&U.push(l.aV([],za(l.a3/2,0,s.x,s.y,s.z),O)),s.y<(1<<s.z)/2&&U.push(l.aV([],za(l.a3/2,l.a3,s.x,s.y,s.z),O));const _t=Yp(Y,U),Tt=Yp(ot,U),gt=[-Y[0],-Y[1],-Y[2],_t.max],St=[Y[0],Y[1],Y[2],-_t.min],Et=[-ot[0],-ot[1],-ot[2],Tt.max],xt=[ot[0],ot[1],ot[2],-Tt.min],Bt=[...ct,0],Gt=[...ht,0],Ht=[];return s.y===0?Ht.push(l.bx(Gt,Bt,gt),l.bx(Gt,Bt,St)):Ht.push(l.bx(Et,Bt,gt),l.bx(Et,Bt,St),l.bx(Et,Gt,gt),l.bx(Et,Gt,St)),s.y===(1<<s.z)-1?Ht.push(l.bx(Gt,Bt,gt),l.bx(Gt,Bt,St)):Ht.push(l.bx(xt,Bt,gt),l.bx(xt,Bt,St),l.bx(xt,Gt,gt),l.bx(xt,Gt,St)),new ha(Ht,[gt,St,Et,xt,Bt,Gt],q,H)}}}function Yp(T,s){let h=1/0,_=-1/0;for(const b of s){const A=l.a$(T,b);h=Math.min(h,A),_=Math.max(_,A)}return{min:h,max:_}}class qh{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,h,_){return this._helper.interpolatePadding(s,h,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,h){this._helper.resize(s,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,h){this._helper.overrideNearFarZ(s,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s){}constructor(s){this._cachedClippingPlane=l.bz(),this._projectionMatrix=l.bd(),this._globeViewProjMatrix32f=l.bc(),this._globeViewProjMatrixNoCorrection=l.bd(),this._globeViewProjMatrixNoCorrectionInverted=l.bd(),this._globeProjMatrixInverted=l.bd(),this._cameraPosition=l.bt(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(h,_)=>{const b=l.ai(h.lat,-l.aj,l.aj),A=l.ai(+_,this.minZoom+Qn(0,b),this.maxZoom);return{center:new l.U(h.lng,b),zoom:A}},this.applyConstrain=(h,_)=>this._helper.applyConstrain(h,_),this._helper=new Ln({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(h,_)=>this.defaultConstrain(h,_)},s),this._coveringTilesDetailsProvider=new Gp}clone(){const s=new qh;return s.apply(this),s}apply(s,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(s)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const s=l.bt();return s[0]=this._cameraPosition[0],s[1]=this._cameraPosition[1],s[2]=this._cameraPosition[2],s}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(s){const{overscaledTileID:h,applyGlobeMatrix:_}=s,b=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:b,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(s){const h=this.pitchInRadians,_=this.cameraToCenterDistance/s,b=Math.sin(h)*_,A=Math.cos(h)*_+1,M=1/Math.sqrt(b*b+A*A)*1;let k=-b,O=A;const z=Math.sqrt(k*k+O*O);k/=z,O/=z;const U=[0,k,O];l.bA(U,U,[0,0,0],-this.bearingInRadians),l.bB(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),l.bC(U,U,[0,0,0],this.center.lng*Math.PI/180);const q=1/l.b1(U);return l.aV(U,U,q),[...U,-M*q]}isLocationOccluded(s){return!this.isSurfacePointVisible(Cr(s))}transformLightDirection(s){const h=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,b=Math.cos(_),A=[Math.sin(h)*b,Math.sin(_),Math.cos(h)*b],M=[A[2],0,-A[0]],k=[0,0,0];l.a_(k,M,A),l.aZ(M,M),l.aZ(k,k);const O=[0,0,0];return l.aZ(O,[M[0]*s[0]+k[0]*s[1]+A[0]*s[2],M[1]*s[0]+k[1]*s[1]+A[1]*s[2],M[2]*s[0]+k[2]*s[1]+A[2]*s[2]]),O}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(s,h,_){const b=(function(k,O,z){const U=1/(1<<z.z);return new l.a5(k/l.a3*U+z.x*U,O/l.a3*U+z.y*U)})(s,h,_.canonical),A=(M=b.y,[l.bs(b.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI]);var M;return this.getCircleRadiusCorrection()/Math.cos(A[1])}projectTileCoordinates(s,h,_,b){const A=_.canonical,M=za(s,h,A.x,A.y,A.z),k=1+(b?b(s,h):0)/l.by,O=[M[0]*k,M[1]*k,M[2]*k,1];l.aB(O,O,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,U=z[0]*M[0]+z[1]*M[1]+z[2]*M[2]+z[3]<0;return{point:new l.P(O[0]/O[3],O[1]/O[3]),signedDistanceFromCamera:O[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const s=$h(this.worldSize,this.center.lat),h=l.be(),_=l.be();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*s),l.b8(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const b=this.centerOffset;h[8]=2*-b.x/this._helper._width,h[9]=2*b.y/this._helper._height,this._projectionMatrix=l.b9(h),this._globeProjMatrixInverted=l.be(),l.av(this._globeProjMatrixInverted,h),l.N(h,h,[0,0,-this.cameraToCenterDistance]),l.ba(h,h,this.rollInRadians),l.bb(h,h,-this.pitchInRadians),l.ba(h,h,this.bearingInRadians),l.N(h,h,[0,0,-s]);const A=l.bt();A[0]=s,A[1]=s,A[2]=s,l.bb(_,h,this.center.lat*Math.PI/180),l.bD(_,_,-this.center.lng*Math.PI/180),l.O(_,_,A),this._globeViewProjMatrixNoCorrection=_,l.bb(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bD(h,h,-this.center.lng*Math.PI/180),l.O(h,h,A),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=l.be(),l.av(this._globeViewProjMatrixNoCorrectionInverted,_);const M=l.bt();this._cameraPosition=l.bt(),this._cameraPosition[2]=this.cameraToCenterDistance/s,l.bA(this._cameraPosition,this._cameraPosition,M,-this.rollInRadians),l.bB(this._cameraPosition,this._cameraPosition,M,this.pitchInRadians),l.bA(this._cameraPosition,this._cameraPosition,M,-this.bearingInRadians),l.aW(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bB(this._cameraPosition,this._cameraPosition,M,-this.center.lat*Math.PI/180),l.bC(this._cameraPosition,this._cameraPosition,M,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(s);const k=l.b9(this._globeViewProjMatrixNoCorrectionInverted);l.O(k,k,[1,1,-1]),this._cachedFrustum=ns.fromInvProjectionMatrix(k,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(s){l.w("calculateFogMatrix is not supported on globe projection.");const h=l.be();return l.am(h),h}getVisibleUnwrappedCoordinates(s){return[new l.b6(0,s)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){s&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const _=Cr(s);l.aV(_,_,1+h/l.by);const b=l.bz();return l.aB(b,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),b[2]/b[3]}populateCache(s){}getBounds(){const s=.5*this.width,h=.5*this.height,_=[new l.P(0,0),new l.P(s,0),new l.P(this.width,0),new l.P(this.width,h),new l.P(this.width,this.height),new l.P(s,this.height),new l.P(0,this.height),new l.P(0,h)],b=[];for(const q of _)b.push(this.unprojectScreenPoint(q));let A=0,M=0,k=0,O=0;const z=this.center;for(const q of b){const H=l.bE(z.lng,q.lng),Y=l.bE(z.lat,q.lat);H<M&&(M=H),H>A&&(A=H),Y<O&&(O=Y),Y>k&&(k=Y)}const U=[z.lng+M,z.lat+O,z.lng+A,z.lat+k];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new wn(U)}calculateCenterFromCameraLngLatAlt(s,h,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(s,h,_,b)}setLocationAtPoint(s,h){const _=Cr(this.unprojectScreenPoint(h)),b=Cr(s),A=l.bt();l.bF(A);const M=l.bt();l.bC(M,_,A,-this.center.lng*Math.PI/180),l.bB(M,M,A,this.center.lat*Math.PI/180);const k=b[0]*b[0]+b[2]*b[2],O=M[0]*M[0];if(k<O)return;const z=Math.sqrt(k-O),U=-z,q=l.bG(b[0],b[2],M[0],z),H=l.bG(b[0],b[2],M[0],U),Y=l.bt();l.bC(Y,b,A,-q);const et=l.bG(Y[1],Y[2],M[1],M[2]),ot=l.bt();l.bC(ot,b,A,-H);const ct=l.bG(ot[1],ot[2],M[1],M[2]),ht=.5*Math.PI,_t=et>=-ht&&et<=ht,Tt=ct>=-ht&&ct<=ht;let gt,St;if(_t&&Tt){const Gt=this.center.lng*Math.PI/180,Ht=this.center.lat*Math.PI/180;l.bH(q,Gt)+l.bH(et,Ht)<l.bH(H,Gt)+l.bH(ct,Ht)?(gt=q,St=et):(gt=H,St=ct)}else if(_t)gt=q,St=et;else{if(!Tt)return;gt=H,St=ct}const Et=gt/Math.PI*180,xt=St/Math.PI*180,Bt=this.center.lat;this.setCenter(new l.U(Et,l.ai(xt,-90,90))),this.setZoom(this.zoom+Qn(Bt,this.center.lat))}locationToScreenPoint(s,h){const _=Cr(s);if(h){const b=h.getElevationForLngLatZoom(s,this._helper._tileZoom);l.aV(_,_,1+b/l.by)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(s){const h=l.bz();return l.aB(h,[...s,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new l.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(s,h){if(h){const _=h.pointCoordinate(s);if(_)return _}return l.a5.fromLngLat(this.unprojectScreenPoint(s))}screenPointToLocation(s,h){var _;return(_=this.screenPointToMercatorCoordinate(s,h))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(s,h){const _=this._cameraPosition,b=this.getRayDirectionFromPixel(s);return!!this.rayPlanetIntersection(_,b)}getRayDirectionFromPixel(s){const h=l.bz();h[0]=s.x/this.width*2-1,h[1]=-1*(s.y/this.height*2-1),h[2]=1,h[3]=1,l.aB(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const _=l.bt();_[0]=h[0]-this._cameraPosition[0],_[1]=h[1]-this._cameraPosition[1],_[2]=h[2]-this._cameraPosition[2];const b=l.bt();return l.aZ(b,_),b}isSurfacePointVisible(s){const h=this._cachedClippingPlane;return h[0]*s[0]+h[1]*s[1]+h[2]*s[2]+h[3]>=0}isSurfacePointOnScreen(s){if(!this.isSurfacePointVisible(s))return!1;const h=l.bz();return l.aB(h,[...s,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(s,h){const _=l.a$(s,h),b=l.bt(),A=l.bt();l.aV(A,h,_),l.aY(b,s,A);const M=1-l.a$(b,b);if(M<0)return null;const k=l.a$(s,s)-1,O=-_+(_<0?1:-1)*Math.sqrt(M),z=k/O,U=O;return{tMin:Math.min(z,U),tMax:Math.max(z,U)}}unprojectScreenPoint(s){const h=this._cameraPosition,_=this.getRayDirectionFromPixel(s),b=this.rayPlanetIntersection(h,_);if(b){const U=l.bt();l.aW(U,h,[_[0]*b.tMin,_[1]*b.tMin,_[2]*b.tMin]);const q=l.bt();return l.aZ(q,U),Zp(q)}const A=this._cachedClippingPlane,M=A[0]*_[0]+A[1]*_[1]+A[2]*_[2],k=-l.b5(A,h)/M,O=l.bt();if(k>0)l.aW(O,h,[_[0]*k,_[1]*k,_[2]*k]);else{const U=l.bt();l.aW(U,h,[2*_[0],2*_[1],2*_[2]]);const q=l.b5(this._cachedClippingPlane,U);l.aY(O,U,[this._cachedClippingPlane[0]*q,this._cachedClippingPlane[1]*q,this._cachedClippingPlane[2]*q])}const z=(function(U){const q=l.bt();return q[0]=U[0]*-U[3],q[1]=U[1]*-U[3],q[2]=U[2]*-U[3],{center:q,radius:Math.sqrt(1-U[3]*U[3])}})(A);return Zp((function(U,q,H){const Y=l.bt();l.aY(Y,H,U);const et=l.bt();return l.bu(et,U,Y,q/l.b3(Y)),et})(z.center,z.radius,O))}getMatrixForModel(s,h){const _=l.U.convert(s),b=1/l.by,A=l.bd();return l.bD(A,A,_.lng/180*Math.PI),l.bb(A,A,-_.lat/180*Math.PI),l.N(A,A,[0,0,1+h/l.by]),l.bb(A,A,.5*Math.PI),l.O(A,A,[b,b,b]),A}getProjectionDataForCustomLayer(s=!0){const h=this.getProjectionData({overscaledTileID:new l.a0(0,0,0,0,0),applyGlobeMatrix:s});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(s){}}class Xh{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,h,_){return this._helper.interpolatePadding(s,h,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,h,_=!0){this._helper.resize(s,h,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,h){this._helper.overrideNearFarZ(s,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(s,h){this._globeness=s,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(s){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(h,_)=>this.currentTransform.defaultConstrain(h,_),this.applyConstrain=(h,_)=>this._helper.applyConstrain(h,_),this._helper=new Ln({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(h,_)=>this.defaultConstrain(h,_)},s),this._globeness=1,this._mercatorTransform=new nn,this._verticalPerspectiveTransform=new qh}clone(){const s=new Xh;return s._globeness=this._globeness,s._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,s.apply(this),s}apply(s){this._helper.apply(s),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(s){const h=this._mercatorTransform.getProjectionData(s),_=this._verticalPerspectiveTransform.getProjectionData(s);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:h.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:s.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(s){return this.currentTransform.isLocationOccluded(s)}transformLightDirection(s){return this.currentTransform.transformLightDirection(s)}getPixelScale(){return l.bo(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bo(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(s,h,_){const b=this._mercatorTransform.getPitchedTextCorrection(s,h,_),A=this._verticalPerspectiveTransform.getPitchedTextCorrection(s,h,_);return l.bo(b,A,this._globeness)}projectTileCoordinates(s,h,_,b){return this.currentTransform.projectTileCoordinates(s,h,_,b)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(s){return this.currentTransform.calculateFogMatrix(s)}getVisibleUnwrappedCoordinates(s){return this.currentTransform.getVisibleUnwrappedCoordinates(s)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(s){this._mercatorTransform.recalculateZoomAndCenter(s),this._verticalPerspectiveTransform.recalculateZoomAndCenter(s)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,h){return this.currentTransform.lngLatToCameraDepth(s,h)}populateCache(s){this._mercatorTransform.populateCache(s),this._verticalPerspectiveTransform.populateCache(s)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(s,h,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(s,h,_,b)}setLocationAtPoint(s,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(s,h),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(s,h),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(s,h){return this.currentTransform.locationToScreenPoint(s,h)}screenPointToMercatorCoordinate(s,h){return this.currentTransform.screenPointToMercatorCoordinate(s,h)}screenPointToLocation(s,h){return this.currentTransform.screenPointToLocation(s,h)}isPointOnMapSurface(s,h){return this.currentTransform.isPointOnMapSurface(s,h)}getRayDirectionFromPixel(s){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(s)}getMatrixForModel(s,h){return this.currentTransform.getMatrixForModel(s,h)}getProjectionDataForCustomLayer(s=!0){const h=this._mercatorTransform.getProjectionDataForCustomLayer(s);if(!this.isGlobeRendering)return h;const _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(s);return _.fallbackMatrix=h.mainMatrix,_}getFastPathSimpleProjectionMatrix(s){return this.currentTransform.getFastPathSimpleProjectionMatrix(s)}}class xs{get useGlobeControls(){return!0}handlePanInertia(s,h){const _=ua(s,h);return Math.abs(_.lng-h.center.lng)>180&&(_.lng=h.center.lng+179.5*Math.sign(_.lng-h.center.lng)),{easingCenter:_,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(s,h){const _=s.around,b=h.screenPointToLocation(_);s.bearingDelta&&h.setBearing(h.bearing+s.bearingDelta),s.pitchDelta&&h.setPitch(h.pitch+s.pitchDelta),s.rollDelta&&h.setRoll(h.roll+s.rollDelta);const A=h.zoom;s.zoomDelta&&h.setZoom(h.zoom+s.zoomDelta);const M=h.zoom-A;if(M===0)return;const k=l.bE(h.center.lng,b.lng),O=k/(Math.abs(k/180)+1),z=l.bE(h.center.lat,b.lat),U=h.getRayDirectionFromPixel(_),q=h.cameraPosition,H=-1*l.a$(q,U),Y=l.bt();l.aW(Y,q,[U[0]*H,U[1]*H,U[2]*H]);const et=l.b1(Y)-1,ot=Math.exp(.5*-Math.max(et-.3,0)),ct=$h(h.worldSize,h.center.lat)/Math.min(h.width,h.height),ht=l.br(ct,.9,.5,1,.25),_t=(1-l.al(-M))*Math.min(ot,ht),Tt=h.center.lat,gt=h.zoom,St=new l.U(h.center.lng+O*_t,l.ai(h.center.lat+z*_t,-l.aj,l.aj));h.setLocationAtPoint(b,_);const Et=h.center,xt=l.br(Math.abs(k),45,85,0,1),Bt=l.br(ct,.75,.35,0,1),Gt=Math.pow(Math.max(xt,Bt),.25),Ht=l.bE(Et.lng,St.lng),Wt=l.bE(Et.lat,St.lat);h.setCenter(new l.U(Et.lng+Ht*Gt,Et.lat+Wt*Gt).wrap()),h.setZoom(gt+Qn(Tt,h.center.lat))}handleMapControlsPan(s,h,_){if(!s.panDelta)return;const b=h.center.lat,A=h.zoom;h.setCenter(ua(s.panDelta,h).wrap()),h.setZoom(A+Qn(b,h.center.lat))}cameraForBoxAndBearing(s,h,_,b,A){const M=Go(s,h,_,b,A),k=h.left/A.width*2-1,O=(A.width-h.right)/A.width*2-1,z=h.top/A.height*-2+1,U=(A.height-h.bottom)/A.height*-2+1,q=l.bE(_.getWest(),_.getEast())<0,H=q?_.getEast():_.getWest(),Y=q?_.getWest():_.getEast(),et=Math.max(_.getNorth(),_.getSouth()),ot=Math.min(_.getNorth(),_.getSouth()),ct=H+.5*l.bE(H,Y),ht=et+.5*l.bE(et,ot),_t=A.clone();_t.setCenter(M.center),_t.setBearing(M.bearing),_t.setPitch(0),_t.setRoll(0),_t.setZoom(M.zoom);const Tt=_t.modelViewProjectionMatrix,gt=[Cr(_.getNorthWest()),Cr(_.getNorthEast()),Cr(_.getSouthWest()),Cr(_.getSouthEast()),Cr(new l.U(Y,ht)),Cr(new l.U(H,ht)),Cr(new l.U(ct,et)),Cr(new l.U(ct,ot))],St=Cr(M.center);let Et=Number.POSITIVE_INFINITY;for(const xt of gt)k<0&&(Et=xs.getLesserNonNegativeNonNull(Et,xs.solveVectorScale(xt,St,Tt,"x",k))),O>0&&(Et=xs.getLesserNonNegativeNonNull(Et,xs.solveVectorScale(xt,St,Tt,"x",O))),z>0&&(Et=xs.getLesserNonNegativeNonNull(Et,xs.solveVectorScale(xt,St,Tt,"y",z))),U<0&&(Et=xs.getLesserNonNegativeNonNull(Et,xs.solveVectorScale(xt,St,Tt,"y",U)));if(Number.isFinite(Et)&&Et!==0)return M.zoom=_t.zoom+l.ao(Et),M;lo()}handleJumpToCenterZoom(s,h){const _=s.center.lat,b=s.applyConstrain(h.center?l.U.convert(h.center):s.center,s.zoom).center;s.setCenter(b.wrap());const A=h.zoom!==void 0?+h.zoom:s.zoom+Qn(_,b.lat);s.zoom!==A&&s.setZoom(A)}handleEaseTo(s,h){const _=s.zoom,b=s.center,A=s.padding,M={roll:s.roll,pitch:s.pitch,bearing:s.bearing},k={roll:h.roll===void 0?s.roll:h.roll,pitch:h.pitch===void 0?s.pitch:h.pitch,bearing:h.bearing===void 0?s.bearing:h.bearing},O=h.zoom!==void 0,z=!s.isPaddingEqual(h.padding);let U=!1;const q=h.center?l.U.convert(h.center):b,H=s.applyConstrain(q,_).center;Iu(s,H);const Y=s.clone();Y.setCenter(H),Y.setZoom(O?+h.zoom:_+Qn(b.lat,q.lat)),Y.setBearing(h.bearing);const et=new l.P(l.ai(s.centerPoint.x+h.offsetAsPoint.x,0,s.width),l.ai(s.centerPoint.y+h.offsetAsPoint.y,0,s.height));Y.setLocationAtPoint(H,et);const ot=(h.offset&&h.offsetAsPoint.mag())>0?Y.center:H,ct=O?+h.zoom:_+Qn(b.lat,ot.lat),ht=_+Qn(b.lat,0),_t=ct+Qn(ot.lat,0),Tt=l.bE(b.lng,ot.lng),gt=l.bE(b.lat,ot.lat),St=l.al(_t-ht);return U=ct!==_,{easeFunc:Et=>{if(l.bi(M,k)||co({startEulerAngles:M,endEulerAngles:k,tr:s,k:Et,useSlerp:M.roll!=k.roll}),z&&s.interpolatePadding(A,h.padding,Et),h.around)l.w("Easing around a point is not supported under globe projection."),s.setLocationAtPoint(h.around,h.aroundPoint);else{const xt=_t>ht?Math.min(2,St):Math.max(.5,St),Bt=Math.pow(xt,1-Et),Gt=od(b,Tt,gt,Et*Bt);s.setCenter(Gt.wrap())}if(U){const xt=l.F.number(ht,_t,Et)+Qn(0,s.center.lat);s.setZoom(xt)}},isZooming:U,elevationCenter:ot}}handleFlyTo(s,h){const _=h.zoom!==void 0,b=s.center,A=s.zoom,M=s.padding,k=!s.isPaddingEqual(h.padding),O=s.applyConstrain(l.U.convert(h.center||h.locationAtOffset),A).center,z=_?+h.zoom:s.zoom+Qn(s.center.lat,O.lat),U=s.clone();U.setCenter(O),U.setZoom(z),U.setBearing(h.bearing);const q=new l.P(l.ai(s.centerPoint.x+h.offsetAsPoint.x,0,s.width),l.ai(s.centerPoint.y+h.offsetAsPoint.y,0,s.height));U.setLocationAtPoint(O,q);const H=U.center;Iu(s,H);const Y=(function(gt,St,Et){const xt=Cr(St),Bt=Cr(Et),Gt=l.a$(xt,Bt),Ht=Math.acos(Gt),Wt=Xp(gt);return Ht/(2*Math.PI)*Wt})(s,b,H),et=A+Qn(b.lat,0),ot=z+Qn(H.lat,0),ct=l.al(ot-et);let ht;if(typeof h.minZoom=="number"){const gt=+h.minZoom+Qn(H.lat,0),St=Math.min(gt,et,ot)+Qn(0,H.lat),Et=s.applyConstrain(H,St).zoom+Qn(H.lat,0);ht=l.al(Et-et)}const _t=l.bE(b.lng,H.lng),Tt=l.bE(b.lat,H.lat);return{easeFunc:(gt,St,Et,xt)=>{const Bt=od(b,_t,Tt,Et);k&&s.interpolatePadding(M,h.padding,gt);const Gt=gt===1?H:Bt;s.setCenter(Gt.wrap());const Ht=et+l.ao(St);s.setZoom(gt===1?z:Ht+Qn(0,Gt.lat))},scaleOfZoom:ct,targetCenter:H,scaleOfMinZoom:ht,pixelPathLength:Y}}static solveVectorScale(s,h,_,b,A){const M=b==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],k=[_[3],_[7],_[11],_[15]],O=s[0]*M[0]+s[1]*M[1]+s[2]*M[2],z=s[0]*k[0]+s[1]*k[1]+s[2]*k[2],U=h[0]*M[0]+h[1]*M[1]+h[2]*M[2],q=h[0]*k[0]+h[1]*k[1]+h[2]*k[2];return U+A*z===O+A*q||k[3]*(O-U)+M[3]*(q-z)+O*q==U*z?null:(U+M[3]-A*q-A*k[3])/(U-O-A*q+A*z)}static getLesserNonNegativeNonNull(s,h){return h!==null&&h>=0&&h<s?h:s}}class Zh{constructor(s){this._globe=s,this._mercatorCameraHelper=new Er,this._verticalPerspectiveCameraHelper=new xs}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(s,h){return this.currentHelper.handlePanInertia(s,h)}handleMapControlsRollPitchBearingZoom(s,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(s,h)}handleMapControlsPan(s,h,_){this.currentHelper.handleMapControlsPan(s,h,_)}cameraForBoxAndBearing(s,h,_,b,A){return this.currentHelper.cameraForBoxAndBearing(s,h,_,b,A)}handleJumpToCenterZoom(s,h){this.currentHelper.handleJumpToCenterZoom(s,h)}handleEaseTo(s,h){return this.currentHelper.handleEaseTo(s,h)}handleFlyTo(s,h){return this.currentHelper.handleFlyTo(s,h)}}const $l=(T,s)=>l.z(T,s&&s.filter((h=>h.identifier!=="source.canvas"))),cd=l.bI();class Bu extends l.E{constructor(s,h={}){var _,b;super(),this._rtlPluginLoaded=()=>{for(const M in this.tileManagers){const k=this.tileManagers[M].getSource().type;k!=="vector"&&k!=="geojson"||this.tileManagers[M].reload()}},this.map=s,this.dispatcher=new Ar(Ui(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",((M,k)=>this.getGlyphs(M,k))),this.dispatcher.registerMessageHandler("GI",((M,k)=>this.getImages(M,k))),this.dispatcher.registerMessageHandler("GDA",((M,k)=>this.getDashes(M,k))),this.imageManager=new qe,this.imageManager.setEventedParent(this);const A=((_=s._container)===null||_===void 0?void 0:_.lang)||typeof document<"u"&&((b=document.documentElement)===null||b===void 0?void 0:b.lang)||void 0;this.glyphManager=new we(s._requestManager,h.localIdeographFontFamily,A),this.lineAtlas=new Ce(256,512),this.crossTileSymbolIndex=new jl,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bJ()),ts().on(so,this._rtlPluginLoaded),this.on("data",(M=>{if(M.dataType!=="source"||M.sourceDataType!=="metadata")return;const k=this.tileManagers[M.sourceId];if(!k)return;const O=k.getSource();if(O&&O.vectorLayerIds)for(const z in this._layers){const U=this._layers[z];U.source===O.id&&this._validateLayer(U)}}))}_setInitialValues(){var s;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bK,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((s=this.crossTileSymbolIndex)===null||s===void 0?void 0:s.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(s,h){var _,b,A;this._checkLoaded();const M=h===null?(A=(b=(_=this.stylesheet.state)===null||_===void 0?void 0:_[s])===null||b===void 0?void 0:b.default)!==null&&A!==void 0?A:null:h;if(l.bL(M,this._globalState[s]))return this;this._globalState[s]=M,this._applyGlobalStateChanges([s])}getGlobalState(){return this._globalState}setGlobalState(s){this._checkLoaded();const h=[];for(const _ in s)!l.bL(this._globalState[_],s[_].default)&&(h.push(_),this._globalState[_]=s[_].default);this._applyGlobalStateChanges(h)}_applyGlobalStateChanges(s){if(s.length===0)return;const h=new Set,_={};for(const b of s){_[b]=this._globalState[b];for(const A in this._layers){const M=this._layers[A],k=M.getLayoutAffectingGlobalStateRefs(),O=M.getPaintAffectingGlobalStateRefs();if(k.has(b)&&h.add(M.source),O.has(b))for(const{name:z,value:U}of O.get(b))this._updatePaintProperty(M,z,U)}}this.dispatcher.broadcast("UGS",_);for(const b in this.tileManagers)h.has(b)&&(this._reloadSource(b),this._changed=!0)}loadURL(s,h={},_){this.fire(new l.l("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const b=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const A=this._loadStyleRequest;l.j(b,this._loadStyleRequest).then((M=>{this._loadStyleRequest=null,this._load(M.data,h,_)})).catch((M=>{this._loadStyleRequest=null,M&&!A.signal.aborted&&this.fire(new l.k(M))}))}loadJSON(s,h={},_){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,G.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(s,h,_)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(cd,{validate:!1})}_load(s,h,_){var b,A;let M=h.transformStyle?h.transformStyle(_,s):s;if(!h.validate||!$l(this,l.B(M))){M=Object.assign({},M),this._loaded=!0,this.stylesheet=M;for(const k in M.sources)this.addSource(k,M.sources[k],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new mi(this.stylesheet.light),this._setProjectionInternal(((b=this.stylesheet.projection)===null||b===void 0?void 0:b.type)||"mercator"),this.sky=new he(this.stylesheet.sky),this.map.setTerrain((A=this.stylesheet.terrain)!==null&&A!==void 0?A:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var s,h,_;const b=l.bM(this.stylesheet.layers);this.setGlobalState((s=this.stylesheet.state)!==null&&s!==void 0?s:null),this.dispatcher.broadcast("SL",b),this._order=b.map((A=>A.id)),this._layers={},this._serializedLayers=null;for(const A of b){const M=l.bN(A,this._globalState);if(M.setEventedParent(this,{layer:{id:A.id}}),this._layers[A.id]=M,l.bO(M)&&this.tileManagers[M.source]){const k=(_=(h=A.paint)===null||h===void 0?void 0:h["raster-fade-duration"])!==null&&_!==void 0?_:M.paint.get("raster-fade-duration");this.tileManagers[M.source].setRasterFadeDuration(k)}}}_loadSprite(s,h=!1,_=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(A,M,k,O){return l._(this,void 0,void 0,(function*(){const z=le(A),U=k>1?"@2x":"",q={},H={};for(const{id:Y,url:et}of z){const ot=M.transformRequest(Oe(et,U,".json"),"SpriteJSON");q[Y]=l.j(ot,O);const ct=M.transformRequest(Oe(et,U,".png"),"SpriteImage");H[Y]=ae.getImage(ct,O)}return yield Promise.all([...Object.values(q),...Object.values(H)]),(function(Y,et){return l._(this,void 0,void 0,(function*(){const ot={};for(const ct in Y){ot[ct]={};const ht=G.getImageCanvasContext((yield et[ct]).data),_t=(yield Y[ct]).data;for(const Tt in _t){const{width:gt,height:St,x:Et,y:xt,sdf:Bt,pixelRatio:Gt,stretchX:Ht,stretchY:Wt,content:Yt,textFitWidth:ve,textFitHeight:Te}=_t[Tt];ot[ct][Tt]={data:null,pixelRatio:Gt,sdf:Bt,stretchX:Ht,stretchY:Wt,content:Yt,textFitWidth:ve,textFitHeight:Te,spriteData:{width:gt,height:St,x:Et,y:xt,context:ht}}}}return ot}))})(q,H)}))})(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((A=>{if(this._spriteRequest=null,A)for(const M in A){this._spritesImagesIds[M]=[];const k=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter((O=>!(O in A))):[];for(const O of k)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in A[M]){const z=M==="default"?O:`${M}:${O}`;this._spritesImagesIds[M].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,A[M][O],!1):this.imageManager.addImage(z,A[M][O]),h&&(this._changedImages[z]=!0)}}})).catch((A=>{this._spriteRequest=null,b=A,this.fire(new l.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),_&&_(b)}))}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(s){const h=this.tileManagers[s.source];if(!h)return;const _=s.sourceLayer;if(!_)return;const b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(_)===-1)&&this.fire(new l.k(new Error(`Source layer "${_}" does not exist on source "${b.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.tileManagers)if(!this.tileManagers[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,h=!1){const _=this._serializedAllLayers();if(!s||s.length===0)return Object.values(h?l.bP(_):_);const b=[];for(const A of s)if(_[A]){const M=h?l.bP(_[A]):_[A];b.push(M)}return b}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const h=Object.keys(this._layers);for(const _ of h){const b=this._layers[_];b.type!=="custom"&&(s[_]=b.serialize())}return s}hasTransitions(){var s,h,_;if(!((s=this.light)===null||s===void 0)&&s.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(const b in this.tileManagers)if(this.tileManagers[b].hasTransition())return!0;for(const b in this._layers)if(this._layers[b].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(h){const b=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(b.length||A.length)&&this._updateWorkerLayers(b,A);for(const M in this._updatedSources){const k=this._updatedSources[M];if(k==="reload")this._reloadSource(M);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const _={};for(const b in this.tileManagers){const A=this.tileManagers[b];_[b]=A.used,A.used=!1}for(const b of this._order){const A=this._layers[b];A.recalculate(s,this._availableImages),!A.isHidden(s.zoom)&&A.source&&(this.tileManagers[A.source].used=!0)}for(const b in _){const A=this.tileManagers[b];!!_[b]!=!!A.used&&A.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(s),this.sky.recalculate(s),this.projection.recalculate(s),this.z=s.zoom,h&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.tileManagers)this.tileManagers[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,h={}){var _;this._checkLoaded();const b=this.serialize();if(s=h.transformStyle?h.transformStyle(b,s):s,((_=h.validate)===null||_===void 0||_)&&$l(this,l.B(s)))return!1;(s=l.bP(s)).layers=l.bM(s.layers);const A=l.bQ(b,s),M=this._getOperationsToPerform(A);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const k of M.operations)k();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const h=[],_=[];for(const b of s)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push((()=>this.addLayer.apply(this,b.args)));break;case"removeLayer":h.push((()=>this.removeLayer.apply(this,b.args)));break;case"setPaintProperty":h.push((()=>this.setPaintProperty.apply(this,b.args)));break;case"setLayoutProperty":h.push((()=>this.setLayoutProperty.apply(this,b.args)));break;case"setFilter":h.push((()=>this.setFilter.apply(this,b.args)));break;case"addSource":h.push((()=>this.addSource.apply(this,b.args)));break;case"removeSource":h.push((()=>this.removeSource.apply(this,b.args)));break;case"setLayerZoomRange":h.push((()=>this.setLayerZoomRange.apply(this,b.args)));break;case"setLight":h.push((()=>this.setLight.apply(this,b.args)));break;case"setGeoJSONSourceData":h.push((()=>this.setGeoJSONSourceData.apply(this,b.args)));break;case"setGlyphs":h.push((()=>this.setGlyphs.apply(this,b.args)));break;case"setSprite":h.push((()=>this.setSprite.apply(this,b.args)));break;case"setTerrain":h.push((()=>this.map.setTerrain.apply(this,b.args)));break;case"setSky":h.push((()=>this.setSky.apply(this,b.args)));break;case"setProjection":this.setProjection.apply(this,b.args);break;case"setGlobalState":h.push((()=>this.setGlobalState.apply(this,b.args)));break;case"setTransition":h.push((()=>{}));break;default:_.push(b.command)}return{operations:h,unimplemented:_}}addImage(s,h){if(this.getImage(s))return this.fire(new l.k(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.k(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,_={}){if(this._checkLoaded(),this.tileManagers[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.B.source,`sources.${s}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const b=this.tileManagers[s]=new gi(s,h,this.dispatcher);b.style=this,b.setEventedParent(this,(()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:s}))),b.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.tileManagers[s]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===s)return this.fire(new l.k(new Error(`Source "${s}" cannot be removed while layer "${_}" is using it.`)));const h=this.tileManagers[s];delete this.tileManagers[s],delete this._updatedSources[s],h.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.tileManagers[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const _=this.tileManagers[s].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(h),this._changed=!0}getSource(s){return this.tileManagers[s]&&this.tileManagers[s].getSource()}addLayer(s,h,_={}){this._checkLoaded();const b=s.id;if(this.getLayer(b))return void this.fire(new l.k(new Error(`Layer "${b}" already exists on this map.`)));let A;if(s.type==="custom"){if($l(this,l.bR(s)))return;A=l.bN(s,this._globalState)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(b,s.source),s=l.bP(s),s=l.e(s,{source:b})),this._validate(l.B.layer,`layers.${b}`,s,{arrayIndex:-1},_))return;A=l.bN(s,this._globalState),this._validateLayer(A),A.setEventedParent(this,{layer:{id:b}})}const M=h?this._order.indexOf(h):this._order.length;if(h&&M===-1)this.fire(new l.k(new Error(`Cannot add layer "${b}" before non-existing layer "${h}".`)));else{if(this._order.splice(M,0,b),this._layerOrderChanged=!0,this._layers[b]=A,this._removedLayers[b]&&A.source&&A.type!=="custom"){const k=this._removedLayers[b];delete this._removedLayers[b],k.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.tileManagers[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.k(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const _=this._order.indexOf(s);this._order.splice(_,1);const b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new l.k(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(b,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const _=this._order.indexOf(s);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,_){this._checkLoaded();const b=this.getLayer(s);b?b.minzoom===h&&b.maxzoom===_||(h!=null&&(b.minzoom=h),_!=null&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,_={}){this._checkLoaded();const b=this.getLayer(s);if(b){if(!l.bL(b.filter,h))return h==null?(b.setFilter(void 0),void this._updateLayer(b)):void(this._validate(l.B.filter,`layers.${b.id}.filter`,h,null,_)||(b.setFilter(l.bP(h)),this._updateLayer(b)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.bP(this.getLayer(s).filter)}setLayoutProperty(s,h,_,b={}){this._checkLoaded();const A=this.getLayer(s);A?l.bL(A.getLayoutProperty(h),_)||(A.setLayoutProperty(h,_,b),this._updateLayer(A)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const _=this.getLayer(s);if(_)return _.getLayoutProperty(h);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,_,b={}){this._checkLoaded();const A=this.getLayer(s);A?l.bL(A.getPaintProperty(h),_)||this._updatePaintProperty(A,h,_,b):this.fire(new l.k(new Error(`Cannot style non-existing layer "${s}".`)))}_updatePaintProperty(s,h,_,b={}){s.setPaintProperty(h,_,b)&&this._updateLayer(s),l.bO(s)&&h==="raster-fade-duration"&&this.tileManagers[s.source].setRasterFadeDuration(_),this._changed=!0,this._updatedPaintProps[s.id]=!0,this._serializedLayers=null}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const _=s.source,b=s.sourceLayer,A=this.tileManagers[_];if(A===void 0)return void this.fire(new l.k(new Error(`The source '${_}' does not exist in the map's style.`)));const M=A.getSource().type;M==="geojson"&&b?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||b?(s.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),A.setFeatureState(b,s.id,h)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const _=s.source,b=this.tileManagers[_];if(b===void 0)return void this.fire(new l.k(new Error(`The source '${_}' does not exist in the map's style.`)));const A=b.getSource().type,M=A==="vector"?s.sourceLayer:void 0;A!=="vector"||M?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(M,s.id,h):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,_=s.sourceLayer,b=this.tileManagers[h];if(b!==void 0)return b.getSource().type!=="vector"||_?(s.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),b.getFeatureState(_,s.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=l.bS(this.tileManagers,(A=>A.serialize())),h=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,b=this.stylesheet;return l.bT({version:b.version,name:b.name,metadata:b.metadata,light:b.light,sky:b.sky,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,projection:b.projection,sources:s,layers:h,terrain:_},(A=>A!==void 0))}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.tileManagers[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.tileManagers[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=M=>this._layers[M].type==="fill-extrusion",_={},b=[];for(let M=this._order.length-1;M>=0;M--){const k=this._order[M];if(h(k)){_[k]=M;for(const O of s){const z=O[k];if(z)for(const U of z)b.push(U)}}}b.sort(((M,k)=>k.intersectionZ-M.intersectionZ));const A=[];for(let M=this._order.length-1;M>=0;M--){const k=this._order[M];if(h(k))for(let O=b.length-1;O>=0;O--){const z=b[O].feature;if(_[z.layer.id]<M)break;A.push(z),b.pop()}else for(const O of s){const z=O[k];if(z)for(const U of z)A.push(U.feature)}}return A}queryRenderedFeatures(s,h,_){h&&h.filter&&this._validate(l.B.filter,"queryRenderedFeatures.filter",h.filter,null,h);const b={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of h.layers){const U=this._layers[z];if(!U)return this.fire(new l.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];b[U.source]=!0}}const A=[];h.availableImages=this._availableImages;const M=this._serializedAllLayers(),k=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,O=Object.assign(Object.assign({},h),{layers:k,globalState:this._globalState});for(const z in this.tileManagers)h.layers&&!b[z]||A.push(Dc(this.tileManagers[z],this._layers,M,s,O,_,this.map.terrain?(U,q,H)=>this.map.terrain.getElevation(U,q,H):void 0));return this.placement&&A.push((function(z,U,q,H,Y,et,ot){const ct={},ht=et.queryRenderedSymbols(H),_t=[];for(const Tt of Object.keys(ht).map(Number))_t.push(ot[Tt]);_t.sort($i);for(const Tt of _t){const gt=Tt.featureIndex.lookupSymbolFeatures(ht[Tt.bucketInstanceId],U,Tt.bucketIndex,Tt.sourceLayerIndex,{filterSpec:Y.filter,globalState:Y.globalState},Y.layers,Y.availableImages,z);for(const St in gt){const Et=ct[St]=ct[St]||[],xt=gt[St];xt.sort(((Bt,Gt)=>{const Ht=Tt.featureSortOrder;if(Ht){const Wt=Ht.indexOf(Bt.featureIndex);return Ht.indexOf(Gt.featureIndex)-Wt}return Gt.featureIndex-Bt.featureIndex}));for(const Bt of xt)Et.push(Bt)}}return(function(Tt,gt,St){for(const Et in Tt)for(const xt of Tt[Et])Ds(xt,St[gt[Et].source]);return Tt})(ct,z,q)})(this._layers,M,this.tileManagers,s,O,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(s,h){h?.filter&&this._validate(l.B.filter,"querySourceFeatures.filter",h.filter,null,h);const _=this.tileManagers[s];return _?(function(b,A){const M=b.getRenderableIds().map((z=>b.getTileByID(z))),k=[],O={};for(let z=0;z<M.length;z++){const U=M[z],q=U.tileID.canonical.key;O[q]||(O[q]=!0,U.querySourceFeatures(k,A))}return k})(_,h?Object.assign(Object.assign({},h),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const M in s)if(!l.bL(s[M],_[M])){b=!0;break}if(!b)return;const A={now:at(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(A)}getProjection(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.projection}setProjection(s){if(this._checkLoaded(),this.projection){if(this.projection.name===s.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=s,this._setProjectionInternal(s.type)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,h={}){this._checkLoaded();const _=this.getSky();let b=!1;if(!s&&!_)return;if(s&&!_)b=!0;else if(!s&&_)b=!0;else for(const M in s)if(!l.bL(s[M],_[M])){b=!0;break}if(!b)return;const A={now:at(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,h),this.sky.updateTransitions(A)}_setProjectionInternal(s){const h=(function(_,b){const A={constrainOverride:b};if(Array.isArray(_)){const M=new Ko({type:_});return{projection:M,transform:new Xh(A),cameraHelper:new Zh(M)}}switch(_){case"mercator":return{projection:new Kn,transform:new nn(A),cameraHelper:new Er};case"globe":{const M=new Ko({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:M,transform:new Xh(A),cameraHelper:new Zh(M)}}case"vertical-perspective":return{projection:new Ou,transform:new qh(A),cameraHelper:new xs};default:return l.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new Kn,transform:new nn(A),cameraHelper:new Er}}})(s,this.map.transformConstrain);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const _ in this.tileManagers)this.tileManagers[_].reload()}_validate(s,h,_,b,A={}){return(!A||A.validate!==!1)&&$l(this,s.call(l.B,l.e({key:h,style:this.serialize(),value:_,styleSpec:l.u},b)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ts().off(so,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.tileManagers){const _=this.tileManagers[h];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.tileManagers[s].clearTiles()}_reloadSource(s){this.tileManagers[s].resume(),this.tileManagers[s].reload()}_updateSources(s){for(const h in this.tileManagers)this.tileManagers[h].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.tileManagers)this._reloadSource(s)}_updatePlacement(s,h,_,b,A=!1){let M=!1,k=!1;const O={};for(const z of this._order){const U=this._layers[z];if(U.type!=="symbol")continue;if(!O[U.source]){const H=this.tileManagers[U.source];O[U.source]=H.getRenderableIds(!0).map((Y=>H.getTileByID(Y))).sort(((Y,et)=>et.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(et.tileID)?-1:1)))}const q=this.crossTileSymbolIndex.addLayer(U,O[U.source],s.center.lng);M=M||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(at(),s.zoom))&&(this.pauseablePlacement=new Vl(s,this.map.terrain,this._order,A,h,_,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(at()),k=!0),M&&this.pauseablePlacement.placement.setStale()),k||M)for(const z of this._order){const U=this._layers[z];U.type==="symbol"&&this.placement.updateLayerOpacities(U,O[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(at())}_releaseSymbolFadeTiles(){for(const s in this.tileManagers)this.tileManagers[s].releaseSymbolFadeTiles()}getImages(s,h){return l._(this,void 0,void 0,(function*(){const _=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const b=this.tileManagers[h.source];return b&&b.setDependencies(h.tileID.key,h.type,h.icons),_}))}getGlyphs(s,h){return l._(this,void 0,void 0,(function*(){const _=yield this.glyphManager.getGlyphs(h.stacks),b=this.tileManagers[h.source];return b&&b.setDependencies(h.tileID.key,h.type,[""]),_}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,h={}){this._checkLoaded(),s&&this._validate(l.B.glyphs,"glyphs",s,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}getDashes(s,h){return l._(this,void 0,void 0,(function*(){const _={};for(const[b,A]of Object.entries(h.dashes))_[b]=this.lineAtlas.getDash(A.dasharray,A.round);return _}))}addSprite(s,h,_={},b){this._checkLoaded();const A=[{id:s,url:h}],M=[...le(this.stylesheet.sprite),...A];this._validate(l.B.sprite,"sprite",M,null,_)||(this.stylesheet.sprite=M,this._loadSprite(A,!0,b))}removeSprite(s){this._checkLoaded();const h=le(this.stylesheet.sprite);if(h.find((_=>_.id===s))){if(this._spritesImagesIds[s])for(const _ of this._spritesImagesIds[s])this.imageManager.removeImage(_),this._changedImages[_]=!0;h.splice(h.findIndex((_=>_.id===s)),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return le(this.stylesheet.sprite)}setSprite(s,h={},_){this._checkLoaded(),s&&this._validate(l.B.sprite,"sprite",s,null,h)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,_):(this._unloadSprite(),_&&_(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const s in this.tileManagers){const h=this.tileManagers[s];if(h.setEventedParent(null),h._tiles){for(const _ in h._tiles)h._tiles[_].unloadVectorData();h._tiles={}}h._cache.reset(),h.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const s in this._layers){const h=this._layers[s];h.setEventedParent(null),h.onRemove&&h.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Ua=l.aO([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ud{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,_,b,A,M,k,O,z){this.context=s;let U=this.boundPaintVertexBuffers.length!==b.length;for(let q=0;!U&&q<b.length;q++)this.boundPaintVertexBuffers[q]!==b[q]&&(U=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||U||this.boundIndexBuffer!==A||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==z?this.freshBind(h,_,b,A,M,k,O,z):(s.bindVertexArray.set(this.vao),k&&k.bind(),A&&A.dynamicDraw&&A.bind(),O&&O.bind(),z&&z.bind())}freshBind(s,h,_,b,A,M,k,O){const z=s.numAttributes,U=this.context,q=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=O,h.enableAttributes(q,s);for(const H of _)H.enableAttributes(q,s);M&&M.enableAttributes(q,s),k&&k.enableAttributes(q,s),O&&O.enableAttributes(q,s),h.bind(),h.setVertexAttribPointers(q,s,A);for(const H of _)H.bind(),H.setVertexAttribPointers(q,s,A);M&&(M.bind(),M.setVertexAttribPointers(q,s,A)),b&&b.bind(),k&&(k.bind(),k.setVertexAttribPointers(q,s,A)),O&&(O.bind(),O.setVertexAttribPointers(q,s,A)),U.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Hl=(T,s,h,_,b)=>({u_texture:0,u_ele_delta:T,u_fog_matrix:s,u_fog_color:h?h.properties.get("fog-color"):l.bj.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:b?0:h?h.calculateFogBlendOpacity(_):0,u_horizon_color:h?h.properties.get("horizon-color"):l.bj.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:b?1:0}),Lu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ho(T){const s=[];for(let h=0;h<T.length;h++){if(T[h]===null)continue;const _=T[h].split(" ");s.push(_.pop())}return s}class Kp{constructor(s,h,_,b,A,M,k,O,z=[]){const U=s.gl;this.program=U.createProgram();const q=ho(h.staticAttributes),H=_?_.getBinderAttributes():[],Y=q.concat(H),et=is.prelude.staticUniforms?ho(is.prelude.staticUniforms):[],ot=k.staticUniforms?ho(k.staticUniforms):[],ct=h.staticUniforms?ho(h.staticUniforms):[],ht=_?_.getBinderUniforms():[],_t=et.concat(ot).concat(ct).concat(ht),Tt=[];for(const Ht of _t)Tt.indexOf(Ht)<0&&Tt.push(Ht);const gt=_?_.defines():[];Bs(U)&&gt.unshift("#version 300 es"),A&&gt.push("#define OVERDRAW_INSPECTOR;"),M&&gt.push("#define TERRAIN3D;"),O&&gt.push(O),z&&gt.push(...z);let St=gt.concat(is.prelude.fragmentSource,k.fragmentSource,h.fragmentSource).join(`
`),Et=gt.concat(is.prelude.vertexSource,k.vertexSource,h.vertexSource).join(`
`);Bs(U)||(St=(function(Ht){return Ht.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(St),Et=(function(Ht){return Ht.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Et));const xt=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(xt,St),U.compileShader(xt),!U.getShaderParameter(xt,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(xt)}`);U.attachShader(this.program,xt);const Bt=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Bt,Et),U.compileShader(Bt),!U.getShaderParameter(Bt,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(Bt)}`);U.attachShader(this.program,Bt),this.attributes={};const Gt={};this.numAttributes=Y.length;for(let Ht=0;Ht<this.numAttributes;Ht++)Y[Ht]&&(U.bindAttribLocation(this.program,Ht,Y[Ht]),this.attributes[Y[Ht]]=Ht);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(Bt),U.deleteShader(xt);for(let Ht=0;Ht<Tt.length;Ht++){const Wt=Tt[Ht];if(Wt&&!Gt[Wt]){const Yt=U.getUniformLocation(this.program,Wt);Yt&&(Gt[Wt]=Yt)}}this.fixedUniforms=b(s,Gt),this.terrainUniforms=((Ht,Wt)=>({u_depth:new l.bU(Ht,Wt.u_depth),u_terrain:new l.bU(Ht,Wt.u_terrain),u_terrain_dim:new l.bk(Ht,Wt.u_terrain_dim),u_terrain_matrix:new l.bW(Ht,Wt.u_terrain_matrix),u_terrain_unpack:new l.bX(Ht,Wt.u_terrain_unpack),u_terrain_exaggeration:new l.bk(Ht,Wt.u_terrain_exaggeration)}))(s,Gt),this.projectionUniforms=((Ht,Wt)=>({u_projection_matrix:new l.bW(Ht,Wt.u_projection_matrix),u_projection_tile_mercator_coords:new l.bX(Ht,Wt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bX(Ht,Wt.u_projection_clipping_plane),u_projection_transition:new l.bk(Ht,Wt.u_projection_transition),u_projection_fallback_matrix:new l.bW(Ht,Wt.u_projection_fallback_matrix)}))(s,Gt),this.binderUniforms=_?_.getUniforms(s,Gt):[]}draw(s,h,_,b,A,M,k,O,z,U,q,H,Y,et,ot,ct,ht,_t,Tt){const gt=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(_),s.setStencilMode(b),s.setColorMode(A),s.setCullFace(M),O){s.activeTexture.set(gt.TEXTURE2),gt.bindTexture(gt.TEXTURE_2D,O.depthTexture),s.activeTexture.set(gt.TEXTURE3),gt.bindTexture(gt.TEXTURE_2D,O.texture);for(const Et in this.terrainUniforms)this.terrainUniforms[Et].set(O[Et])}if(z)for(const Et in z)this.projectionUniforms[Lu[Et]].set(z[Et]);if(k)for(const Et in this.fixedUniforms)this.fixedUniforms[Et].set(k[Et]);ct&&ct.setUniforms(s,this.binderUniforms,et,{zoom:ot});let St=0;switch(h){case gt.LINES:St=2;break;case gt.TRIANGLES:St=3;break;case gt.LINE_STRIP:St=1}for(const Et of Y.get()){const xt=Et.vaos||(Et.vaos={});(xt[U]||(xt[U]=new ud)).bind(s,this,q,ct?ct.getPaintVertexBuffers():[],H,Et.vertexOffset,ht,_t,Tt),gt.drawElements(h,Et.primitiveLength*St,gt.UNSIGNED_SHORT,Et.primitiveOffset*St*2)}}}function Uc(T,s,h){const _=1/l.aH(h,1,s.transform.tileZoom),b=Math.pow(2,h.tileID.overscaledZ),A=h.tileSize*Math.pow(2,s.transform.tileZoom)/b,M=A*(h.tileID.canonical.x+h.tileID.wrap*b),k=A*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,T.fromScale,T.toScale],u_fade:T.t,u_pixel_coord_upper:[M>>16,k>>16],u_pixel_coord_lower:[65535&M,65535&k]}}const hd=(T,s,h,_)=>{const b=T.style.light,A=b.properties.get("position"),M=[A.x,A.y,A.z],k=l.b_();b.properties.get("anchor")==="viewport"&&l.b$(k,T.transform.bearingInRadians),l.c0(M,M,k);const O=T.transform.transformLightDirection(M),z=b.properties.get("color");return{u_lightpos:M,u_lightpos_globe:O,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+s,u_opacity:h,u_fill_translate:_}},Wl=(T,s,h,_,b,A,M)=>l.e(hd(T,s,h,_),Uc(A,T,M),{u_height_factor:-Math.pow(2,b.overscaledZ)/M.tileSize/8}),ql=(T,s,h,_)=>l.e(Uc(s,T,h),{u_fill_translate:_}),Qp=(T,s)=>({u_world:T,u_fill_translate:s}),e_=(T,s,h,_,b)=>l.e(ql(T,s,h,b),{u_world:_}),Jp=(T,s,h,_,b)=>{const A=T.transform;let M,k,O=0;if(h.paint.get("circle-pitch-alignment")==="map"){const z=l.aH(s,1,A.zoom);M=!0,k=[z,z],O=z/(l.a3*Math.pow(2,s.tileID.overscaledZ))*2*Math.PI*b}else M=!1,k=A.pixelsToGLUnits;return{u_camera_to_center_distance:A.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+M,u_device_pixel_ratio:T.pixelRatio,u_extrude_scale:k,u_globe_extrude_scale:O,u_translate:_}},Gh=T=>({u_pixel_extrude_scale:[1/T.width,1/T.height]}),fd=T=>({u_viewport_size:[T.width,T.height]}),Xl=(T,s=1)=>({u_color:T,u_overlay:0,u_overlay_scale:s}),Zl=(T,s,h,_)=>{const b=l.aH(T,1,s)/(l.a3*Math.pow(2,T.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:l.aH(T,1,s),u_intensity:h,u_globe_extrude_scale:b}},dd=(T,s,h,_)=>{const b=l.M();l.c1(b,0,T.width,T.height,0,0,1);const A=T.context.gl;return{u_matrix:b,u_world:[A.drawingBufferWidth,A.drawingBufferHeight],u_image:h,u_color_ramp:_,u_opacity:s.paint.get("heatmap-opacity")}},Va=(T,s,h)=>{const _=h.paint.get("hillshade-accent-color");let b;switch(h.paint.get("hillshade-method")){case"basic":b=4;break;case"combined":b=1;break;case"igor":b=2;break;case"multidirectional":b=3;break;default:b=0}const A=h.getIlluminationProperties();for(let M=0;M<A.directionRadians.length;M++)h.paint.get("hillshade-illumination-anchor")==="viewport"&&(A.directionRadians[M]+=T.transform.bearingInRadians);return{u_image:0,u_latrange:md(0,s.tileID),u_exaggeration:h.paint.get("hillshade-exaggeration"),u_altitudes:A.altitudeRadians,u_azimuths:A.directionRadians,u_accent:_,u_method:b,u_highlights:A.highlightColor,u_shadows:A.shadowColor}},pd=(T,s)=>{const h=s.stride,_=l.M();return l.c1(_,0,l.a3,-l.a3,0,0,1),l.N(_,_,[0,-l.a3,0]),{u_matrix:_,u_image:1,u_dimension:[h,h],u_zoom:T.overscaledZ,u_unpack:s.getUnpackVector()}};function md(T,s){const h=Math.pow(2,s.canonical.z),_=s.canonical.y;return[new l.a5(0,_/h).toLngLat().lat,new l.a5(0,(_+1)/h).toLngLat().lat]}const Gl=(T,s,h=0)=>({u_image:0,u_unpack:s.getUnpackVector(),u_dimension:[s.stride,s.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:h,u_opacity:T.paint.get("color-relief-opacity")}),Vc=(T,s,h,_)=>{const b=T.transform;return{u_translation:gd(T,s,h),u_ratio:_/l.aH(s,1,b.zoom),u_device_pixel_ratio:T.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},jc=(T,s,h,_,b)=>l.e(Vc(T,s,h,_),{u_image:0,u_image_height:b}),tm=(T,s,h,_,b)=>{const A=T.transform,M=Yh(s,A);return{u_translation:gd(T,s,h),u_texsize:s.imageAtlasTexture.size,u_ratio:_/l.aH(s,1,A.zoom),u_device_pixel_ratio:T.pixelRatio,u_image:0,u_scale:[M,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},em=(T,s,h,_,b)=>{const A=Yh(s,T.transform);return l.e(Vc(T,s,h,_),{u_tileratio:A,u_crossfade_from:b.fromScale,u_crossfade_to:b.toScale,u_image:0,u_mix:b.t,u_lineatlas_width:T.lineAtlas.width,u_lineatlas_height:T.lineAtlas.height})},im=(T,s,h,_,b,A)=>{const M=Yh(s,T.transform);return l.e(Vc(T,s,h,_),{u_image:0,u_image_height:A,u_tileratio:M,u_crossfade_from:b.fromScale,u_crossfade_to:b.toScale,u_image_dash:1,u_mix:b.t,u_lineatlas_width:T.lineAtlas.width,u_lineatlas_height:T.lineAtlas.height})};function Yh(T,s){return 1/l.aH(T,1,s.tileZoom)}function gd(T,s,h){return l.aI(T.transform,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const _d=(T,s,h,_,b)=>{return{u_tl_parent:T,u_scale_parent:s,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(M=_.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(A=_.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:nm(_.paint.get("raster-hue-rotate")),u_coords_top:[b[0].x,b[0].y,b[1].x,b[1].y],u_coords_bottom:[b[3].x,b[3].y,b[2].x,b[2].y]};var A,M};function nm(T){T*=Math.PI/180;const s=Math.sin(T),h=Math.cos(T);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const Mr=(T,s,h,_,b,A,M,k,O,z,U,q,H)=>{const Y=M.transform;return{u_is_size_zoom_constant:+(T==="constant"||T==="source"),u_is_size_feature_constant:+(T==="constant"||T==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_pitch:Y.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Y.width/Y.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_label_plane_matrix:k,u_coord_matrix:O,u_is_text:+U,u_pitch_with_map:+_,u_is_along_line:b,u_is_variable_anchor:A,u_texsize:q,u_texture:0,u_translation:z,u_pitched_scale:H}},ws=(T,s,h,_,b,A,M,k,O,z,U,q,H,Y)=>{const et=M.transform;return l.e(Mr(T,s,h,_,b,A,M,k,O,z,U,q,Y),{u_gamma_scale:_?Math.cos(et.pitch*Math.PI/180)*et.cameraToCenterDistance:1,u_device_pixel_ratio:M.pixelRatio,u_is_halo:1})},Kh=(T,s,h,_,b,A,M,k,O,z,U,q,H)=>l.e(ws(T,s,h,_,b,A,M,k,O,z,!0,U,0,H),{u_texsize_icon:q,u_texture_icon:1}),Qh=(T,s)=>({u_opacity:T,u_color:s}),Jh=(T,s,h,_,b)=>l.e((function(A,M,k,O){const z=k.imageManager.getPattern(A.from.toString()),U=k.imageManager.getPattern(A.to.toString()),{width:q,height:H}=k.imageManager.getPixelSize(),Y=Math.pow(2,O.tileID.overscaledZ),et=O.tileSize*Math.pow(2,k.transform.tileZoom)/Y,ot=et*(O.tileID.canonical.x+O.tileID.wrap*Y),ct=et*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[q,H],u_mix:M.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/l.aH(O,1,k.transform.tileZoom),u_pixel_coord_upper:[ot>>16,ct>>16],u_pixel_coord_lower:[65535&ot,65535&ct]}})(h,b,s,_),{u_opacity:T}),tf=(T,s)=>{},Fu={fillExtrusion:(T,s)=>({u_lightpos:new l.bY(T,s.u_lightpos),u_lightpos_globe:new l.bY(T,s.u_lightpos_globe),u_lightintensity:new l.bk(T,s.u_lightintensity),u_lightcolor:new l.bY(T,s.u_lightcolor),u_vertical_gradient:new l.bk(T,s.u_vertical_gradient),u_opacity:new l.bk(T,s.u_opacity),u_fill_translate:new l.bZ(T,s.u_fill_translate)}),fillExtrusionPattern:(T,s)=>({u_lightpos:new l.bY(T,s.u_lightpos),u_lightpos_globe:new l.bY(T,s.u_lightpos_globe),u_lightintensity:new l.bk(T,s.u_lightintensity),u_lightcolor:new l.bY(T,s.u_lightcolor),u_vertical_gradient:new l.bk(T,s.u_vertical_gradient),u_height_factor:new l.bk(T,s.u_height_factor),u_opacity:new l.bk(T,s.u_opacity),u_fill_translate:new l.bZ(T,s.u_fill_translate),u_image:new l.bU(T,s.u_image),u_texsize:new l.bZ(T,s.u_texsize),u_pixel_coord_upper:new l.bZ(T,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.bZ(T,s.u_pixel_coord_lower),u_scale:new l.bY(T,s.u_scale),u_fade:new l.bk(T,s.u_fade)}),fill:(T,s)=>({u_fill_translate:new l.bZ(T,s.u_fill_translate)}),fillPattern:(T,s)=>({u_image:new l.bU(T,s.u_image),u_texsize:new l.bZ(T,s.u_texsize),u_pixel_coord_upper:new l.bZ(T,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.bZ(T,s.u_pixel_coord_lower),u_scale:new l.bY(T,s.u_scale),u_fade:new l.bk(T,s.u_fade),u_fill_translate:new l.bZ(T,s.u_fill_translate)}),fillOutline:(T,s)=>({u_world:new l.bZ(T,s.u_world),u_fill_translate:new l.bZ(T,s.u_fill_translate)}),fillOutlinePattern:(T,s)=>({u_world:new l.bZ(T,s.u_world),u_image:new l.bU(T,s.u_image),u_texsize:new l.bZ(T,s.u_texsize),u_pixel_coord_upper:new l.bZ(T,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.bZ(T,s.u_pixel_coord_lower),u_scale:new l.bY(T,s.u_scale),u_fade:new l.bk(T,s.u_fade),u_fill_translate:new l.bZ(T,s.u_fill_translate)}),circle:(T,s)=>({u_camera_to_center_distance:new l.bk(T,s.u_camera_to_center_distance),u_scale_with_map:new l.bU(T,s.u_scale_with_map),u_pitch_with_map:new l.bU(T,s.u_pitch_with_map),u_extrude_scale:new l.bZ(T,s.u_extrude_scale),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_globe_extrude_scale:new l.bk(T,s.u_globe_extrude_scale),u_translate:new l.bZ(T,s.u_translate)}),collisionBox:(T,s)=>({u_pixel_extrude_scale:new l.bZ(T,s.u_pixel_extrude_scale)}),collisionCircle:(T,s)=>({u_viewport_size:new l.bZ(T,s.u_viewport_size)}),debug:(T,s)=>({u_color:new l.bV(T,s.u_color),u_overlay:new l.bU(T,s.u_overlay),u_overlay_scale:new l.bk(T,s.u_overlay_scale)}),depth:tf,clippingMask:tf,heatmap:(T,s)=>({u_extrude_scale:new l.bk(T,s.u_extrude_scale),u_intensity:new l.bk(T,s.u_intensity),u_globe_extrude_scale:new l.bk(T,s.u_globe_extrude_scale)}),heatmapTexture:(T,s)=>({u_matrix:new l.bW(T,s.u_matrix),u_world:new l.bZ(T,s.u_world),u_image:new l.bU(T,s.u_image),u_color_ramp:new l.bU(T,s.u_color_ramp),u_opacity:new l.bk(T,s.u_opacity)}),hillshade:(T,s)=>({u_image:new l.bU(T,s.u_image),u_latrange:new l.bZ(T,s.u_latrange),u_exaggeration:new l.bk(T,s.u_exaggeration),u_altitudes:new l.c3(T,s.u_altitudes),u_azimuths:new l.c3(T,s.u_azimuths),u_accent:new l.bV(T,s.u_accent),u_method:new l.bU(T,s.u_method),u_shadows:new l.c2(T,s.u_shadows),u_highlights:new l.c2(T,s.u_highlights)}),hillshadePrepare:(T,s)=>({u_matrix:new l.bW(T,s.u_matrix),u_image:new l.bU(T,s.u_image),u_dimension:new l.bZ(T,s.u_dimension),u_zoom:new l.bk(T,s.u_zoom),u_unpack:new l.bX(T,s.u_unpack)}),colorRelief:(T,s)=>({u_image:new l.bU(T,s.u_image),u_unpack:new l.bX(T,s.u_unpack),u_dimension:new l.bZ(T,s.u_dimension),u_elevation_stops:new l.bU(T,s.u_elevation_stops),u_color_stops:new l.bU(T,s.u_color_stops),u_color_ramp_size:new l.bU(T,s.u_color_ramp_size),u_opacity:new l.bk(T,s.u_opacity)}),line:(T,s)=>({u_translation:new l.bZ(T,s.u_translation),u_ratio:new l.bk(T,s.u_ratio),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_units_to_pixels:new l.bZ(T,s.u_units_to_pixels)}),lineGradient:(T,s)=>({u_translation:new l.bZ(T,s.u_translation),u_ratio:new l.bk(T,s.u_ratio),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_units_to_pixels:new l.bZ(T,s.u_units_to_pixels),u_image:new l.bU(T,s.u_image),u_image_height:new l.bk(T,s.u_image_height)}),linePattern:(T,s)=>({u_translation:new l.bZ(T,s.u_translation),u_texsize:new l.bZ(T,s.u_texsize),u_ratio:new l.bk(T,s.u_ratio),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_image:new l.bU(T,s.u_image),u_units_to_pixels:new l.bZ(T,s.u_units_to_pixels),u_scale:new l.bY(T,s.u_scale),u_fade:new l.bk(T,s.u_fade)}),lineSDF:(T,s)=>({u_translation:new l.bZ(T,s.u_translation),u_ratio:new l.bk(T,s.u_ratio),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_units_to_pixels:new l.bZ(T,s.u_units_to_pixels),u_image:new l.bU(T,s.u_image),u_mix:new l.bk(T,s.u_mix),u_tileratio:new l.bk(T,s.u_tileratio),u_crossfade_from:new l.bk(T,s.u_crossfade_from),u_crossfade_to:new l.bk(T,s.u_crossfade_to),u_lineatlas_width:new l.bk(T,s.u_lineatlas_width),u_lineatlas_height:new l.bk(T,s.u_lineatlas_height)}),lineGradientSDF:(T,s)=>({u_translation:new l.bZ(T,s.u_translation),u_ratio:new l.bk(T,s.u_ratio),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_units_to_pixels:new l.bZ(T,s.u_units_to_pixels),u_image:new l.bU(T,s.u_image),u_image_height:new l.bk(T,s.u_image_height),u_tileratio:new l.bk(T,s.u_tileratio),u_crossfade_from:new l.bk(T,s.u_crossfade_from),u_crossfade_to:new l.bk(T,s.u_crossfade_to),u_image_dash:new l.bU(T,s.u_image_dash),u_mix:new l.bk(T,s.u_mix),u_lineatlas_width:new l.bk(T,s.u_lineatlas_width),u_lineatlas_height:new l.bk(T,s.u_lineatlas_height)}),raster:(T,s)=>({u_tl_parent:new l.bZ(T,s.u_tl_parent),u_scale_parent:new l.bk(T,s.u_scale_parent),u_buffer_scale:new l.bk(T,s.u_buffer_scale),u_fade_t:new l.bk(T,s.u_fade_t),u_opacity:new l.bk(T,s.u_opacity),u_image0:new l.bU(T,s.u_image0),u_image1:new l.bU(T,s.u_image1),u_brightness_low:new l.bk(T,s.u_brightness_low),u_brightness_high:new l.bk(T,s.u_brightness_high),u_saturation_factor:new l.bk(T,s.u_saturation_factor),u_contrast_factor:new l.bk(T,s.u_contrast_factor),u_spin_weights:new l.bY(T,s.u_spin_weights),u_coords_top:new l.bX(T,s.u_coords_top),u_coords_bottom:new l.bX(T,s.u_coords_bottom)}),symbolIcon:(T,s)=>({u_is_size_zoom_constant:new l.bU(T,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bU(T,s.u_is_size_feature_constant),u_size_t:new l.bk(T,s.u_size_t),u_size:new l.bk(T,s.u_size),u_camera_to_center_distance:new l.bk(T,s.u_camera_to_center_distance),u_pitch:new l.bk(T,s.u_pitch),u_rotate_symbol:new l.bU(T,s.u_rotate_symbol),u_aspect_ratio:new l.bk(T,s.u_aspect_ratio),u_fade_change:new l.bk(T,s.u_fade_change),u_label_plane_matrix:new l.bW(T,s.u_label_plane_matrix),u_coord_matrix:new l.bW(T,s.u_coord_matrix),u_is_text:new l.bU(T,s.u_is_text),u_pitch_with_map:new l.bU(T,s.u_pitch_with_map),u_is_along_line:new l.bU(T,s.u_is_along_line),u_is_variable_anchor:new l.bU(T,s.u_is_variable_anchor),u_texsize:new l.bZ(T,s.u_texsize),u_texture:new l.bU(T,s.u_texture),u_translation:new l.bZ(T,s.u_translation),u_pitched_scale:new l.bk(T,s.u_pitched_scale)}),symbolSDF:(T,s)=>({u_is_size_zoom_constant:new l.bU(T,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bU(T,s.u_is_size_feature_constant),u_size_t:new l.bk(T,s.u_size_t),u_size:new l.bk(T,s.u_size),u_camera_to_center_distance:new l.bk(T,s.u_camera_to_center_distance),u_pitch:new l.bk(T,s.u_pitch),u_rotate_symbol:new l.bU(T,s.u_rotate_symbol),u_aspect_ratio:new l.bk(T,s.u_aspect_ratio),u_fade_change:new l.bk(T,s.u_fade_change),u_label_plane_matrix:new l.bW(T,s.u_label_plane_matrix),u_coord_matrix:new l.bW(T,s.u_coord_matrix),u_is_text:new l.bU(T,s.u_is_text),u_pitch_with_map:new l.bU(T,s.u_pitch_with_map),u_is_along_line:new l.bU(T,s.u_is_along_line),u_is_variable_anchor:new l.bU(T,s.u_is_variable_anchor),u_texsize:new l.bZ(T,s.u_texsize),u_texture:new l.bU(T,s.u_texture),u_gamma_scale:new l.bk(T,s.u_gamma_scale),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_is_halo:new l.bU(T,s.u_is_halo),u_translation:new l.bZ(T,s.u_translation),u_pitched_scale:new l.bk(T,s.u_pitched_scale)}),symbolTextAndIcon:(T,s)=>({u_is_size_zoom_constant:new l.bU(T,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bU(T,s.u_is_size_feature_constant),u_size_t:new l.bk(T,s.u_size_t),u_size:new l.bk(T,s.u_size),u_camera_to_center_distance:new l.bk(T,s.u_camera_to_center_distance),u_pitch:new l.bk(T,s.u_pitch),u_rotate_symbol:new l.bU(T,s.u_rotate_symbol),u_aspect_ratio:new l.bk(T,s.u_aspect_ratio),u_fade_change:new l.bk(T,s.u_fade_change),u_label_plane_matrix:new l.bW(T,s.u_label_plane_matrix),u_coord_matrix:new l.bW(T,s.u_coord_matrix),u_is_text:new l.bU(T,s.u_is_text),u_pitch_with_map:new l.bU(T,s.u_pitch_with_map),u_is_along_line:new l.bU(T,s.u_is_along_line),u_is_variable_anchor:new l.bU(T,s.u_is_variable_anchor),u_texsize:new l.bZ(T,s.u_texsize),u_texsize_icon:new l.bZ(T,s.u_texsize_icon),u_texture:new l.bU(T,s.u_texture),u_texture_icon:new l.bU(T,s.u_texture_icon),u_gamma_scale:new l.bk(T,s.u_gamma_scale),u_device_pixel_ratio:new l.bk(T,s.u_device_pixel_ratio),u_is_halo:new l.bU(T,s.u_is_halo),u_translation:new l.bZ(T,s.u_translation),u_pitched_scale:new l.bk(T,s.u_pitched_scale)}),background:(T,s)=>({u_opacity:new l.bk(T,s.u_opacity),u_color:new l.bV(T,s.u_color)}),backgroundPattern:(T,s)=>({u_opacity:new l.bk(T,s.u_opacity),u_image:new l.bU(T,s.u_image),u_pattern_tl_a:new l.bZ(T,s.u_pattern_tl_a),u_pattern_br_a:new l.bZ(T,s.u_pattern_br_a),u_pattern_tl_b:new l.bZ(T,s.u_pattern_tl_b),u_pattern_br_b:new l.bZ(T,s.u_pattern_br_b),u_texsize:new l.bZ(T,s.u_texsize),u_mix:new l.bk(T,s.u_mix),u_pattern_size_a:new l.bZ(T,s.u_pattern_size_a),u_pattern_size_b:new l.bZ(T,s.u_pattern_size_b),u_scale_a:new l.bk(T,s.u_scale_a),u_scale_b:new l.bk(T,s.u_scale_b),u_pixel_coord_upper:new l.bZ(T,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.bZ(T,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bk(T,s.u_tile_units_to_pixels)}),terrain:(T,s)=>({u_texture:new l.bU(T,s.u_texture),u_ele_delta:new l.bk(T,s.u_ele_delta),u_fog_matrix:new l.bW(T,s.u_fog_matrix),u_fog_color:new l.bV(T,s.u_fog_color),u_fog_ground_blend:new l.bk(T,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bk(T,s.u_fog_ground_blend_opacity),u_horizon_color:new l.bV(T,s.u_horizon_color),u_horizon_fog_blend:new l.bk(T,s.u_horizon_fog_blend),u_is_globe_mode:new l.bk(T,s.u_is_globe_mode)}),terrainDepth:(T,s)=>({u_ele_delta:new l.bk(T,s.u_ele_delta)}),terrainCoords:(T,s)=>({u_texture:new l.bU(T,s.u_texture),u_terrain_coords_id:new l.bk(T,s.u_terrain_coords_id),u_ele_delta:new l.bk(T,s.u_ele_delta)}),projectionErrorMeasurement:(T,s)=>({u_input:new l.bk(T,s.u_input),u_output_expected:new l.bk(T,s.u_output_expected)}),atmosphere:(T,s)=>({u_sun_pos:new l.bY(T,s.u_sun_pos),u_atmosphere_blend:new l.bk(T,s.u_atmosphere_blend),u_globe_position:new l.bY(T,s.u_globe_position),u_globe_radius:new l.bk(T,s.u_globe_radius),u_inv_proj_matrix:new l.bW(T,s.u_inv_proj_matrix)}),sky:(T,s)=>({u_sky_color:new l.bV(T,s.u_sky_color),u_horizon_color:new l.bV(T,s.u_horizon_color),u_horizon:new l.bZ(T,s.u_horizon),u_horizon_normal:new l.bZ(T,s.u_horizon_normal),u_sky_horizon_blend:new l.bk(T,s.u_sky_horizon_blend),u_sky_blend:new l.bk(T,s.u_sky_blend)})};class Yl{constructor(s,h,_){this.context=s;const b=s.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yd{constructor(s,h,_,b){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=b,this.context=s;const A=s.gl;this.buffer=A.createBuffer(),s.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let _=0;_<this.attributes.length;_++){const b=h.attributes[this.attributes[_].name];b!==void 0&&s.enableVertexAttribArray(b)}}setVertexAttribPointers(s,h,_){for(let b=0;b<this.attributes.length;b++){const A=this.attributes[b],M=h.attributes[A.name];M!==void 0&&s.vertexAttribPointer(M,A.components,s[Qo[A.type]],!1,this.itemSize,A.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mi{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vd extends Mi{getDefault(){return l.bj.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class rm extends Mi{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Jo extends Mi{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class $c extends Mi{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ef extends Mi{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Nu extends Mi{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class ja extends Mi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class zu extends Mi{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class nf extends Mi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class tl extends Mi{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Uu extends Mi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Hc extends Mi{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ws extends Mi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class bd extends Mi{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class xd extends Mi{getDefault(){return l.bj.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Vu extends Mi{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Rr extends Mi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Kl extends Mi{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class rs extends Mi{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class $a extends Mi{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Wc extends Mi{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ju extends Mi{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class fo extends Mi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class el extends Mi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class il extends Mi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class rf extends Mi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class pi extends Mi{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class po extends Mi{getDefault(){return null}set(s){var h;if(s===this.current&&!this.dirty)return;const _=this.gl;Bs(_)?_.bindVertexArray(s):(h=_.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class i_ extends Mi{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Ts extends Mi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Ql extends Mi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class fa extends Mi{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class sm extends fa{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class $u extends fa{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Jl extends fa{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}const qc="Framebuffer is not complete";class Hu{constructor(s,h,_,b,A){this.context=s,this.width=h,this.height=_;const M=s.gl,k=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new sm(s,k),b)this.depthAttachment=A?new Jl(s,k):new $u(s,k);else if(A)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error(qc)}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&s.deleteRenderbuffer(_)}s.deleteFramebuffer(this.framebuffer)}}class Xc{constructor(s){var h,_;if(this.gl=s,this.clearColor=new vd(this),this.clearDepth=new rm(this),this.clearStencil=new Jo(this),this.colorMask=new $c(this),this.depthMask=new ef(this),this.stencilMask=new Nu(this),this.stencilFunc=new ja(this),this.stencilOp=new zu(this),this.stencilTest=new nf(this),this.depthRange=new tl(this),this.depthTest=new Uu(this),this.depthFunc=new Hc(this),this.blend=new Ws(this),this.blendFunc=new bd(this),this.blendColor=new xd(this),this.blendEquation=new Vu(this),this.cullFace=new Rr(this),this.cullFaceSide=new Kl(this),this.frontFace=new rs(this),this.program=new $a(this),this.activeTexture=new Wc(this),this.viewport=new ju(this),this.bindFramebuffer=new fo(this),this.bindRenderbuffer=new el(this),this.bindTexture=new il(this),this.bindVertexBuffer=new rf(this),this.bindElementBuffer=new pi(this),this.bindVertexArray=new po(this),this.pixelStoreUnpack=new i_(this),this.pixelStoreUnpackPremultiplyAlpha=new Ts(this),this.pixelStoreUnpackFlipY=new Ql(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Bs(s)){this.HALF_FLOAT=s.HALF_FLOAT;const b=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=s.RGBA16F)!==null&&h!==void 0?h:b?.RGBA16F_EXT,this.RGB16F=(_=s.RGB16F)!==null&&_!==void 0?_:b?.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const b=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=b?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Yl(this,s,h)}createVertexBuffer(s,h,_){return new yd(this,s,h,_)}createRenderbuffer(s,h,_){const b=this.gl,A=b.createRenderbuffer();return this.bindRenderbuffer.set(A),b.renderbufferStorage(b.RENDERBUFFER,s,h,_),this.bindRenderbuffer.set(null),A}createFramebuffer(s,h,_,b){return new Hu(this,s,h,_,b)}clear({color:s,depth:h,stencil:_}){const b=this.gl;let A=0;s&&(A|=b.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(A|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(A|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(A)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){l.bL(s.blendFunction,ln.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Bs(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var h;return Bs(this.gl)?this.gl.deleteVertexArray(s):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}let nl;function ss(T,s,h,_,b){const A=T.context,M=T.transform,k=A.gl,O=T.useProgram("collisionBox"),z=[];let U=0,q=0;for(let ht=0;ht<_.length;ht++){const _t=_[ht],Tt=s.getTile(_t).getBucket(h);if(!Tt)continue;const gt=b?Tt.textCollisionBox:Tt.iconCollisionBox,St=Tt.collisionCircleArray;St.length>0&&(z.push({circleArray:St,circleOffset:q,coord:_t}),U+=St.length/4,q=U),gt&&O.draw(A,k.LINES,oi.disabled,Ei.disabled,T.colorModeForRenderPass(),_i.disabled,Gh(T.transform),T.style.map.terrain&&T.style.map.terrain.getTerrainData(_t),M.getProjectionData({overscaledTileID:_t,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,null,T.transform.zoom,null,null,gt.collisionVertexBuffer)}if(!b||!z.length)return;const H=T.useProgram("collisionCircle"),Y=new l.c4;Y.resize(4*U),Y._trim();let et=0;for(const ht of z)for(let _t=0;_t<ht.circleArray.length/4;_t++){const Tt=4*_t,gt=ht.circleArray[Tt+0],St=ht.circleArray[Tt+1],Et=ht.circleArray[Tt+2],xt=ht.circleArray[Tt+3];Y.emplace(et++,gt,St,Et,xt,0),Y.emplace(et++,gt,St,Et,xt,1),Y.emplace(et++,gt,St,Et,xt,2),Y.emplace(et++,gt,St,Et,xt,3)}(!nl||nl.length<2*U)&&(nl=(function(ht){const _t=2*ht,Tt=new l.c6;Tt.resize(_t),Tt._trim();for(let gt=0;gt<_t;gt++){const St=6*gt;Tt.uint16[St+0]=4*gt+0,Tt.uint16[St+1]=4*gt+1,Tt.uint16[St+2]=4*gt+2,Tt.uint16[St+3]=4*gt+2,Tt.uint16[St+4]=4*gt+3,Tt.uint16[St+5]=4*gt+0}return Tt})(U));const ot=A.createIndexBuffer(nl,!0),ct=A.createVertexBuffer(Y,l.c5.members,!0);for(const ht of z){const _t=fd(T.transform);H.draw(A,k.TRIANGLES,oi.disabled,Ei.disabled,T.colorModeForRenderPass(),_i.disabled,_t,T.style.map.terrain&&T.style.map.terrain.getTerrainData(ht.coord),null,h.id,ct,ot,l.aR.simpleSegment(0,2*ht.circleOffset,ht.circleArray.length,ht.circleArray.length/2),null,T.transform.zoom,null,null,null)}ct.destroy(),ot.destroy()}const tc=l.am(new Float32Array(16));function mo(T,s,h,_,b,A){const{horizontalAlign:M,verticalAlign:k}=l.aM(T);return new l.P((-(M-.5)*s/b+_[0])*A,(-(k-.5)*h/b+_[1])*A)}function ec(T,s,h,_,b,A){const M=s.tileAnchorPoint.add(new l.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let k=_.mult(A);h||(k=k.rotate(-b));const O=M.add(k);return Re(O.x,O.y,s.pitchedLabelPlaneMatrix,s.getElevation).point}if(h){const k=Vr(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(T),O=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return T.add(_.rotate(O))}return T.add(_)}function rl(T,s,h,_,b,A,M,k,O,z,U,q){const H=T.text.placedSymbolArray,Y=T.text.dynamicLayoutVertexArray,et=T.icon.dynamicLayoutVertexArray,ot={};Y.clear();for(let ct=0;ct<H.length;ct++){const ht=H.get(ct),_t=ht.hidden||!ht.crossTileID||T.allowVerticalPlacement&&!ht.placedOrientation?null:_[ht.crossTileID];if(_t){const Tt=new l.P(ht.anchorX,ht.anchorY),gt={getElevation:q,width:b.width,height:b.height,pitchedLabelPlaneMatrix:A,pitchWithMap:h,transform:b,tileAnchorPoint:Tt,translation:z,unwrappedTileID:U},St=h?ca(Tt.x,Tt.y,gt):Vr(Tt.x,Tt.y,gt),Et=We(b.cameraToCenterDistance,St.signedDistanceFromCamera);let xt=l.au(T.textSizeData,k,ht)*Et/l.aG;h&&(xt*=T.tilePixelRatio/M);const{width:Bt,height:Gt,anchor:Ht,textOffset:Wt,textBoxScale:Yt}=_t,ve=mo(Ht,Bt,Gt,Wt,Yt,xt),Te=b.getPitchedTextCorrection(Tt.x+z[0],Tt.y+z[1],U),ce=ec(St.point,gt,s,ve,-b.bearingInRadians,Te),ke=T.allowVerticalPlacement&&ht.placedOrientation===l.at.vertical?Math.PI/2:0;for(let Ve=0;Ve<ht.numGlyphs;Ve++)l.aA(Y,ce,ke);O&&ht.associatedIconIndex>=0&&(ot[ht.associatedIconIndex]={shiftedAnchor:ce,angle:ke})}else es(ht.numGlyphs,Y)}if(O){et.clear();const ct=T.icon.placedSymbolArray;for(let ht=0;ht<ct.length;ht++){const _t=ct.get(ht);if(_t.hidden)es(_t.numGlyphs,et);else{const Tt=ot[ht];if(Tt)for(let gt=0;gt<_t.numGlyphs;gt++)l.aA(et,Tt.shiftedAnchor,Tt.angle);else es(_t.numGlyphs,et)}}T.icon.dynamicLayoutVertexBuffer.updateData(et)}T.text.dynamicLayoutVertexBuffer.updateData(Y)}function Pr(T,s,h){return h.iconsInText&&s?"symbolTextAndIcon":T?"symbolSDF":"symbolIcon"}function as(T,s,h,_,b,A,M,k,O,z,U,q,H){const Y=T.context,et=Y.gl,ot=T.transform,ct=k==="map",ht=O==="map",_t=k!=="viewport"&&h.layout.get("symbol-placement")!=="point",Tt=ct&&!ht&&!_t,gt=!h.layout.get("symbol-sort-key").isConstant();let St=!1;const Et=T.getDepthModeForSublayer(0,oi.ReadOnly),xt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Bt=[],Gt=ot.getCircleRadiusCorrection();for(const Ht of _){const Wt=s.getTile(Ht),Yt=Wt.getBucket(h);if(!Yt)continue;const ve=b?Yt.text:Yt.icon;if(!ve||!ve.segments.get().length||!ve.hasVisibleVertices)continue;const Te=ve.programConfigurations.get(h.id),ce=b||Yt.sdfIcons,ke=b?Yt.textSizeData:Yt.iconSizeData,Ve=ht||ot.pitch!==0,Fi=T.useProgram(Pr(ce,b,Yt),Te),dn=l.as(ke,ot.zoom),rn=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ht);let pn,Gi,qn,Yi,tr=[0,0],kn=null;if(b)Gi=Wt.glyphAtlasTexture,qn=et.LINEAR,pn=Wt.glyphAtlasTexture.size,Yt.iconsInText&&(tr=Wt.imageAtlasTexture.size,kn=Wt.imageAtlasTexture,Yi=Ve||T.options.rotating||T.options.zooming||ke.kind==="composite"||ke.kind==="camera"?et.LINEAR:et.NEAREST);else{const mn=h.layout.get("icon-size").constantOr(0)!==1||Yt.iconsNeedLinear;Gi=Wt.imageAtlasTexture,qn=ce||T.options.rotating||T.options.zooming||mn||Ve?et.LINEAR:et.NEAREST,pn=Wt.imageAtlasTexture.size}const Xn=l.aH(Wt,1,T.transform.zoom),vr=Vn(ct,T.transform,Xn),va=l.M();l.av(va,vr);const To=Li(ht,ct,T.transform,Xn),So=l.aI(ot,Wt,A,M),ba=ot.getProjectionData({overscaledTileID:Ht,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),Fs=xt&&Yt.hasTextData(),ml=h.layout.get("icon-text-fit")!=="none"&&Fs&&Yt.hasIconData();if(_t){const mn=T.style.map.terrain?(Sn,sn)=>T.style.map.terrain.getElevation(Ht,Sn,sn):null,qi=h.layout.get("text-rotation-alignment")==="map";Nl(Yt,T,b,vr,va,ht,z,qi,Ht.toUnwrapped(),ot.width,ot.height,So,mn)}const Ao=b&&xt||ml,Cs=_t||Ao?tc:ht?vr:T.transform.clipSpaceToPixelsMatrix,Eo=ce&&h.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Co;Co=ce?Yt.iconsInText?Kh(ke.kind,dn,Tt,ht,_t,Ao,T,Cs,To,So,pn,tr,Gt):ws(ke.kind,dn,Tt,ht,_t,Ao,T,Cs,To,So,b,pn,0,Gt):Mr(ke.kind,dn,Tt,ht,_t,Ao,T,Cs,To,So,b,pn,Gt);const Mo={program:Fi,buffers:ve,uniformValues:Co,projectionData:ba,atlasTexture:Gi,atlasTextureIcon:kn,atlasInterpolation:qn,atlasInterpolationIcon:Yi,isSDF:ce,hasHalo:Eo};if(gt&&Yt.canOverlap){St=!0;const mn=ve.segments.get();for(const qi of mn)Bt.push({segments:new l.aR([qi]),sortKey:qi.sortKey,state:Mo,terrainData:rn})}else Bt.push({segments:ve.segments,sortKey:0,state:Mo,terrainData:rn})}St&&Bt.sort(((Ht,Wt)=>Ht.sortKey-Wt.sortKey));for(const Ht of Bt){const Wt=Ht.state;if(Y.activeTexture.set(et.TEXTURE0),Wt.atlasTexture.bind(Wt.atlasInterpolation,et.CLAMP_TO_EDGE),Wt.atlasTextureIcon&&(Y.activeTexture.set(et.TEXTURE1),Wt.atlasTextureIcon&&Wt.atlasTextureIcon.bind(Wt.atlasInterpolationIcon,et.CLAMP_TO_EDGE)),Wt.isSDF){const Yt=Wt.uniformValues;Wt.hasHalo&&(Yt.u_is_halo=1,go(Wt.buffers,Ht.segments,h,T,Wt.program,Et,U,q,Yt,Wt.projectionData,Ht.terrainData)),Yt.u_is_halo=0}go(Wt.buffers,Ht.segments,h,T,Wt.program,Et,U,q,Wt.uniformValues,Wt.projectionData,Ht.terrainData)}}function go(T,s,h,_,b,A,M,k,O,z,U){const q=_.context;b.draw(q,q.gl.TRIANGLES,A,M,k,_i.backCCW,O,U,z,h.id,T.layoutVertexBuffer,T.indexBuffer,s,h.paint,_.transform.zoom,T.programConfigurations.get(h.id),T.dynamicLayoutVertexBuffer,T.opacityVertexBuffer)}function Ss(T,s,h,_,b){const A=T.context,M=A.gl,k=Ei.disabled,O=new ln([M.ONE,M.ONE],l.bj.transparent,[!0,!0,!0,!0]),z=s.getBucket(h);if(!z)return;const U=_.key;let q=h.heatmapFbos.get(U);q||(q=da(A,s.tileSize,s.tileSize),h.heatmapFbos.set(U,q)),A.bindFramebuffer.set(q.framebuffer),A.viewport.set([0,0,s.tileSize,s.tileSize]),A.clear({color:l.bj.transparent});const H=z.programConfigurations.get(h.id),Y=T.useProgram("heatmap",H,!b),et=T.transform.getProjectionData({overscaledTileID:s.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ot=T.style.map.terrain.getTerrainData(_);Y.draw(A,M.TRIANGLES,oi.disabled,k,O,_i.disabled,Zl(s,T.transform.zoom,h.paint.get("heatmap-intensity"),1),ot,et,h.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,h.paint,T.transform.zoom,H)}function Ha(T,s,h,_,b){const A=T.context,M=A.gl,k=T.transform;A.setColorMode(T.colorModeForRenderPass());const O=Zc(A,s),z=h.key,U=s.heatmapFbos.get(z);if(!U)return;A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,U.colorAttachment.get()),A.activeTexture.set(M.TEXTURE1),O.bind(M.LINEAR,M.CLAMP_TO_EDGE);const q=k.getProjectionData({overscaledTileID:h,applyTerrainMatrix:b,applyGlobeMatrix:!_});T.useProgram("heatmapTexture").draw(A,M.TRIANGLES,oi.disabled,Ei.disabled,T.colorModeForRenderPass(),_i.disabled,dd(T,s,0,1),null,q,s.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments,s.paint,k.zoom),U.destroy(),s.heatmapFbos.delete(z)}function da(T,s,h){var _,b;const A=T.gl,M=A.createTexture();A.bindTexture(A.TEXTURE_2D,M),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR);const k=(_=T.HALF_FLOAT)!==null&&_!==void 0?_:A.UNSIGNED_BYTE,O=(b=T.RGBA16F)!==null&&b!==void 0?b:A.RGBA;A.texImage2D(A.TEXTURE_2D,0,O,s,h,0,A.RGBA,k,null);const z=T.createFramebuffer(s,h,!1,!1);return z.colorAttachment.set(M),z}function Zc(T,s){return s.colorRampTexture||(s.colorRampTexture=new l.T(T,s.colorRamp,T.gl.RGBA)),s.colorRampTexture}function Gc(T,s,h,_,b,A,M,k){let O=256;if(b.stepInterpolant){const z=s.getSource().maxzoom,U=M.canonical.z===z?Math.ceil(1<<T.transform.maxZoom-M.canonical.z):1;O=l.ai(l.c8(A.maxLineLength/l.a3*1024*U),256,h.maxTextureSize)}return k.gradient=l.c9({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:O,image:k.gradient||void 0,clips:A.lineClipsArray}),k.texture?k.texture.update(k.gradient):k.texture=new l.T(h,k.gradient,_.RGBA),k.version=b.gradientVersion,k.texture}function sf(T,s,h,_,b){T.activeTexture.set(s.TEXTURE0),h.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),_.updatePaintBuffers(b)}function wd(T,s,h,_,b,A){(b||T.lineAtlas.dirty)&&(s.activeTexture.set(h.TEXTURE0),T.lineAtlas.bind(s)),_.updatePaintBuffers(A)}function Jn(T,s,h,_,b,A,M){const k=A.gradients[b.id];let O=k.texture;b.gradientVersion!==k.version&&(O=Gc(T,s,h,_,b,A,M,k)),h.activeTexture.set(_.TEXTURE0),O.bind(b.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE)}function cn(T,s,h,_,b,A,M,k,O){const z=A.gradients[b.id];let U=z.texture;b.gradientVersion!==z.version&&(U=Gc(T,s,h,_,b,A,M,z)),h.activeTexture.set(_.TEXTURE0),U.bind(b.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE),h.activeTexture.set(_.TEXTURE1),T.lineAtlas.bind(h),k.updatePaintBuffers(O)}function Ri(T,s,h,_,b){if(!h||!_||!_.imageAtlas)return;const A=_.imageAtlas.patternPositions;let M=A[h.to.toString()],k=A[h.from.toString()];if(!M&&k&&(M=k),!k&&M&&(k=M),!M||!k){const O=b.getPaintProperty(s);M=A[O],k=A[O]}M&&k&&T.setConstantPatternPositions(M,k)}function Wa(T,s,h,_,b,A,M,k){const O=T.context.gl,z="fill-pattern",U=h.paint.get(z),q=U&&U.constantOr(1),H=h.getCrossfadeParameters();let Y,et,ot,ct,ht;const _t=T.transform,Tt=h.paint.get("fill-translate"),gt=h.paint.get("fill-translate-anchor");M?(et=q&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=O.LINES):(et=q?"fillPattern":"fill",Y=O.TRIANGLES);const St=U.constantOr(null);for(const Et of _){const xt=s.getTile(Et);if(q&&!xt.patternsLoaded())continue;const Bt=xt.getBucket(h);if(!Bt)continue;const Gt=Bt.programConfigurations.get(h.id),Ht=T.useProgram(et,Gt),Wt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Et);q&&(T.context.activeTexture.set(O.TEXTURE0),xt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Gt.updatePaintBuffers(H)),Ri(Gt,z,St,xt,h);const Yt=_t.getProjectionData({overscaledTileID:Et,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),ve=l.aI(_t,xt,Tt,gt);if(M){ct=Bt.indexBuffer2,ht=Bt.segments2;const ce=[O.drawingBufferWidth,O.drawingBufferHeight];ot=et==="fillOutlinePattern"&&q?e_(T,H,xt,ce,ve):Qp(ce,ve)}else ct=Bt.indexBuffer,ht=Bt.segments,ot=q?ql(T,H,xt,ve):{u_fill_translate:ve};const Te=T.stencilModeForClipping(Et);Ht.draw(T.context,Y,b,Te,A,_i.backCCW,ot,Wt,Yt,h.id,Bt.layoutVertexBuffer,ct,ht,h.paint,T.transform.zoom,Gt)}}function Ii(T,s,h,_,b,A,M,k){const O=T.context,z=O.gl,U="fill-extrusion-pattern",q=h.paint.get(U),H=q.constantOr(1),Y=h.getCrossfadeParameters(),et=h.paint.get("fill-extrusion-opacity"),ot=q.constantOr(null),ct=T.transform;for(const ht of _){const _t=s.getTile(ht),Tt=_t.getBucket(h);if(!Tt)continue;const gt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ht),St=Tt.programConfigurations.get(h.id),Et=T.useProgram(H?"fillExtrusionPattern":"fillExtrusion",St);H&&(T.context.activeTexture.set(z.TEXTURE0),_t.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),St.updatePaintBuffers(Y));const xt=ct.getProjectionData({overscaledTileID:ht,applyGlobeMatrix:!k,applyTerrainMatrix:!0});Ri(St,U,ot,_t,h);const Bt=l.aI(ct,_t,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Gt=h.paint.get("fill-extrusion-vertical-gradient"),Ht=H?Wl(T,Gt,et,Bt,ht,Y,_t):hd(T,Gt,et,Bt);Et.draw(O,O.gl.TRIANGLES,b,A,M,_i.backCCW,Ht,gt,xt,h.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,h.paint,T.transform.zoom,St,T.style.map.terrain&&Tt.centroidVertexBuffer)}}function pa(T,s,h,_,b,A,M,k,O){var z;const U=T.style.projection,q=T.context,H=T.transform,Y=q.gl,et=[`#define NUM_ILLUMINATION_SOURCES ${h.paint.get("hillshade-highlight-color").values.length}`],ot=T.useProgram("hillshade",null,!1,et),ct=!T.options.moving;for(const ht of _){const _t=s.getTile(ht),Tt=_t.fbo;if(!Tt)continue;const gt=U.getMeshFromTileID(q,ht.canonical,k,!0,"raster"),St=(z=T.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(ht);q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Tt.colorAttachment.get());const Et=H.getProjectionData({overscaledTileID:ht,aligned:ct,applyGlobeMatrix:!O,applyTerrainMatrix:!0});ot.draw(q,Y.TRIANGLES,A,b[ht.overscaledZ],M,_i.backCCW,Va(T,_t,h),St,Et,h.id,gt.vertexBuffer,gt.indexBuffer,gt.segments)}}function Hn(T,s,h,_,b,A,M,k,O){var z;const U=T.style.projection,q=T.context,H=T.transform,Y=q.gl,et=T.useProgram("colorRelief"),ot=!T.options.moving;let ct=!0,ht=0;for(const _t of _){const Tt=s.getTile(_t),gt=Tt.dem;if(ct){const Ht=Y.getParameter(Y.MAX_TEXTURE_SIZE),{elevationTexture:Wt,colorTexture:Yt}=h.getColorRampTextures(q,Ht,gt.getUnpackVector());q.activeTexture.set(Y.TEXTURE1),Wt.bind(Y.NEAREST,Y.CLAMP_TO_EDGE),q.activeTexture.set(Y.TEXTURE4),Yt.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),ct=!1,ht=Wt.size[0]}if(!gt||!gt.data)continue;const St=gt.stride,Et=gt.getPixels();if(q.activeTexture.set(Y.TEXTURE0),q.pixelStoreUnpackPremultiplyAlpha.set(!1),Tt.demTexture=Tt.demTexture||T.getTileTexture(St),Tt.demTexture){const Ht=Tt.demTexture;Ht.update(Et,{premultiply:!1}),Ht.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}else Tt.demTexture=new l.T(q,Et,Y.RGBA,{premultiply:!1}),Tt.demTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const xt=U.getMeshFromTileID(q,_t.canonical,k,!0,"raster"),Bt=(z=T.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(_t),Gt=H.getProjectionData({overscaledTileID:_t,aligned:ot,applyGlobeMatrix:!O,applyTerrainMatrix:!0});et.draw(q,Y.TRIANGLES,A,b[_t.overscaledZ],M,_i.backCCW,Gl(h,Tt.dem,ht),Bt,Gt,h.id,xt.vertexBuffer,xt.indexBuffer,xt.segments)}}const Yc=[new l.P(0,0),new l.P(l.a3,0),new l.P(l.a3,l.a3),new l.P(0,l.a3)];function sl(T,s,h,_,b,A,M,k,O=!1,z=!1){const U=_[_.length-1].overscaledZ,q=T.context,H=q.gl,Y=T.useProgram("raster"),et=T.transform,ot=T.style.projection,ct=T.colorModeForRenderPass(),ht=!T.options.moving,_t=h.paint.get("raster-opacity"),Tt=h.paint.get("raster-resampling"),gt=h.paint.get("raster-fade-duration"),St=!!T.style.map.terrain;for(const Et of _){const xt=T.getDepthModeForSublayer(Et.overscaledZ-U,_t===1?oi.ReadWrite:oi.ReadOnly,H.LESS),Bt=s.getTile(Et),Gt=Tt==="nearest"?H.NEAREST:H.LINEAR;q.activeTexture.set(H.TEXTURE0),Bt.texture.bind(Gt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(H.TEXTURE1);const{parentTile:Ht,parentScaleBy:Wt,parentTopLeft:Yt,fadeValues:ve}=ic(Bt,s,gt,St);Bt.fadeOpacity=ve.tileOpacity,Ht?(Ht.fadeOpacity=ve.parentTileOpacity,Ht.texture.bind(Gt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST)):Bt.texture.bind(Gt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Bt.texture.useMipmap&&q.extTextureFilterAnisotropic&&T.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const Te=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Et),ce=et.getProjectionData({overscaledTileID:Et,aligned:ht,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),ke=_d(Yt,Wt,ve.fadeMix,h,k),Ve=ot.getMeshFromTileID(q,Et.canonical,A,M,"raster");Y.draw(q,H.TRIANGLES,xt,b?b[Et.overscaledZ]:Ei.disabled,ct,O?_i.frontCCW:_i.backCCW,ke,Te,ce,h.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}function ic(T,s,h,_){const b={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(h===0||_)return b;if(T.fadingParentID){const A=s.getLoadedTile(T.fadingParentID);if(!A)return b;const M=Math.pow(2,A.tileID.overscaledZ-T.tileID.overscaledZ),k=[T.tileID.canonical.x*M%1,T.tileID.canonical.y*M%1],O=(function(z,U,q){const H=at(),Y=(H-U.timeAdded)/q,et=z.fadingDirection===Ct.Incoming,ot=l.ai((H-z.timeAdded)/q,0,1),ct=l.ai(1-Y,0,1),ht=et?ot:ct;return{tileOpacity:ht,parentTileOpacity:et?ct:ot,fadeMix:{opacity:1,mix:1-ht}}})(T,A,h);return{parentTile:A,parentScaleBy:M,parentTopLeft:k,fadeValues:O}}if(T.selfFading){const A=(function(M,k){const O=(at()-M.timeAdded)/k,z=l.ai(O,0,1);return{tileOpacity:z,fadeMix:{opacity:z,mix:0}}})(T,h);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:A}}return b}const qs=new l.bj(1,0,0,1),Wu=new l.bj(0,1,0,1),_o=new l.bj(0,0,1,1),qu=new l.bj(1,0,1,1),al=new l.bj(0,1,1,1);function ma(T,s,h,_){Ls(T,0,s+h/2,T.transform.width,h,_)}function qa(T,s,h,_){Ls(T,s-h/2,0,h,T.transform.height,_)}function Ls(T,s,h,_,b,A){const M=T.context,k=M.gl;k.enable(k.SCISSOR_TEST),k.scissor(s*T.pixelRatio,h*T.pixelRatio,_*T.pixelRatio,b*T.pixelRatio),M.clear({color:A}),k.disable(k.SCISSOR_TEST)}function af(T,s,h){const _=T.context,b=_.gl,A=T.useProgram("debug"),M=oi.disabled,k=Ei.disabled,O=T.colorModeForRenderPass(),z="$debug",U=T.style.map.terrain&&T.style.map.terrain.getTerrainData(h);_.activeTexture.set(b.TEXTURE0);const q=s.getTileByID(h.key).latestRawTileData,H=Math.floor((q&&q.byteLength||0)/1024),Y=s.getTile(h).tileSize,et=512/Math.min(Y,512)*(h.overscaledZ/T.transform.zoom)*.5;let ot=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ot+=` => ${h.overscaledZ}`),(function(ht,_t){ht.initDebugOverlayCanvas();const Tt=ht.debugOverlayCanvas,gt=ht.context.gl,St=ht.debugOverlayCanvas.getContext("2d");St.clearRect(0,0,Tt.width,Tt.height),St.shadowColor="white",St.shadowBlur=2,St.lineWidth=1.5,St.strokeStyle="white",St.textBaseline="top",St.font="bold 36px Open Sans, sans-serif",St.fillText(_t,5,5),St.strokeText(_t,5,5),ht.debugOverlayTexture.update(Tt),ht.debugOverlayTexture.bind(gt.LINEAR,gt.CLAMP_TO_EDGE)})(T,`${ot} ${H}kB`);const ct=T.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});A.draw(_,b.TRIANGLES,M,k,ln.alphaBlended,_i.disabled,Xl(l.bj.transparent,et),null,ct,z,T.debugBuffer,T.quadTriangleIndexBuffer,T.debugSegments),A.draw(_,b.LINE_STRIP,M,k,O,_i.disabled,Xl(l.bj.red),U,ct,z,T.debugBuffer,T.tileBorderIndexBuffer,T.debugSegments)}function Xa(T,s,h,_){const{isRenderingGlobe:b}=_,A=T.context,M=A.gl,k=T.transform,O=T.colorModeForRenderPass(),z=T.getDepthModeFor3D(),U=T.useProgram("terrain");A.bindFramebuffer.set(null),A.viewport.set([0,0,T.width,T.height]);for(const q of h){const H=s.getTerrainMesh(q.tileID),Y=T.renderToTexture.getTexture(q),et=s.getTerrainData(q.tileID);A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,Y.texture);const ot=s.getMeshFrameDelta(k.zoom),ct=k.calculateFogMatrix(q.tileID.toUnwrapped()),ht=Hl(ot,ct,T.style.sky,k.pitch,b),_t=k.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(A,M.TRIANGLES,z,Ei.disabled,O,_i.backCCW,ht,et,_t,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}}function ol(T,s){if(!s.mesh){const h=new l.aQ;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const _=new l.aS;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),s.mesh=new La(T.createVertexBuffer(h,Bn.members),T.createIndexBuffer(_),l.aR.simpleSegment(0,0,h.length,_.length))}return s.mesh}class Xu{constructor(s,h){this.context=new Xc(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.am(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=gi.maxUnderzooming+gi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jl}resize(s,h,_){if(this.width=Math.floor(s*_),this.height=Math.floor(h*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const s=this.context,h=new l.aQ;h.emplaceBack(0,0),h.emplaceBack(l.a3,0),h.emplaceBack(0,l.a3),h.emplaceBack(l.a3,l.a3),this.tileExtentBuffer=s.createVertexBuffer(h,Bn.members),this.tileExtentSegments=l.aR.simpleSegment(0,0,4,2);const _=new l.aQ;_.emplaceBack(0,0),_.emplaceBack(l.a3,0),_.emplaceBack(0,l.a3),_.emplaceBack(l.a3,l.a3),this.debugBuffer=s.createVertexBuffer(_,Bn.members),this.debugSegments=l.aR.simpleSegment(0,0,4,5);const b=new l.cb;b.emplaceBack(0,0,0,0),b.emplaceBack(l.a3,0,l.a3,0),b.emplaceBack(0,l.a3,0,l.a3),b.emplaceBack(l.a3,l.a3,l.a3,l.a3),this.rasterBoundsBuffer=s.createVertexBuffer(b,Ua.members),this.rasterBoundsSegments=l.aR.simpleSegment(0,0,4,2);const A=new l.aQ;A.emplaceBack(0,0),A.emplaceBack(l.a3,0),A.emplaceBack(0,l.a3),A.emplaceBack(l.a3,l.a3),this.rasterBoundsBufferPosOnly=s.createVertexBuffer(A,Bn.members),this.rasterBoundsSegmentsPosOnly=l.aR.simpleSegment(0,0,4,5);const M=new l.aQ;M.emplaceBack(0,0),M.emplaceBack(1,0),M.emplaceBack(0,1),M.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(M,Bn.members),this.viewportSegments=l.aR.simpleSegment(0,0,4,2);const k=new l.cc;k.emplaceBack(0),k.emplaceBack(1),k.emplaceBack(3),k.emplaceBack(2),k.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(k);const O=new l.aS;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(O);const z=this.context.gl;this.stencilClearMode=new Ei({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new La(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=l.M();l.c1(_,0,this.width,this.height,0,0,1),l.O(_,_,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const b={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(s,h.TRIANGLES,oi.disabled,this.stencilClearMode,ln.disabled,_i.disabled,null,null,b,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h,_){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source,this.nextStencilID+h.length>256&&this.clearStencil();const b=this.context;b.setColorMode(ln.disabled),b.setDepthMode(oi.disabled);const A={};for(const M of h)A[M.key]=this.nextStencilID++;this._renderTileMasks(A,h,_,!0),this._renderTileMasks(A,h,_,!1),this._tileClippingMaskIDs=A}_renderTileMasks(s,h,_,b){const A=this.context,M=A.gl,k=this.style.projection,O=this.transform,z=this.useProgram("clippingMask");for(const U of h){const q=s[U.key],H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),Y=k.getMeshFromTileID(this.context,U.canonical,b,!0,"stencil"),et=O.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!_,applyTerrainMatrix:!0});z.draw(A,M.TRIANGLES,oi.disabled,new Ei({func:M.ALWAYS,mask:0},q,255,M.KEEP,M.KEEP,M.REPLACE),ln.disabled,_?_i.disabled:_i.backCCW,null,H,et,"$clipping",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}_renderTilesDepthBuffer(){const s=this.context,h=s.gl,_=this.style.projection,b=this.transform,A=this.useProgram("depth"),M=this.getDepthModeFor3D(),k=si(b,{tileSize:b.tileSize});for(const O of k){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),U=_.getMeshFromTileID(this.context,O.canonical,!0,!0,"raster"),q=b.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!0,applyTerrainMatrix:!0});A.draw(s,h.TRIANGLES,M,Ei.disabled,ln.disabled,_i.backCCW,null,z,q,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Ei({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new Ei({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(s){const h=this.context.gl,_=s.sort(((M,k)=>k.overscaledZ-M.overscaledZ)),b=_[_.length-1].overscaledZ,A=_[0].overscaledZ-b+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const M={};for(let k=0;k<A;k++)M[k+b]=new Ei({func:h.GEQUAL,mask:255},k+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=A,[M,_]}return[{[b]:Ei.disabled},_]}stencilConfigForOverlapTwoPass(s){const h=this.context.gl,_=s.sort(((M,k)=>k.overscaledZ-M.overscaledZ)),b=_[_.length-1].overscaledZ,A=_[0].overscaledZ-b+1;if(this.clearStencil(),A>1){const M={},k={};for(let O=0;O<A;O++)M[O+b]=new Ei({func:h.GREATER,mask:255},A+1+O,255,h.KEEP,h.KEEP,h.REPLACE),k[O+b]=new Ei({func:h.GREATER,mask:255},1+O,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*A+1,[M,k,_]}return this.nextStencilID=3,[{[b]:new Ei({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[b]:new Ei({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},_]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new ln([s.CONSTANT_COLOR,s.ONE],new l.bj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ln.unblended:ln.alphaBlended}getDepthModeForSublayer(s,h,_){if(!this.opaquePassEnabledForLayer())return oi.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new oi(_||this.context.gl.LEQUAL,h,[b,b])}getDepthModeFor3D(){return new oi(this.context.gl.LEQUAL,oi.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){var _,b;this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(at()),this.imageManager.beginFrame();const A=this.style._order,M=this.style.tileManagers,k={},O={},z={},U={isRenderingToTexture:!1,isRenderingGlobe:((_=s.projection)===null||_===void 0?void 0:_.transitionState)>0};for(const H in M){const Y=M[H];Y.used&&Y.prepare(this.context),k[H]=Y.getVisibleCoordinates(!1),O[H]=k[H].slice().reverse(),z[H]=Y.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<A.length;H++)if(this.style._layers[A[H]].is3D()){this.opaquePassCutoff=H;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const H of A){const Y=this.style._layers[H];if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;const et=O[Y.source];(Y.type==="custom"||et.length)&&this.renderLayer(this,M[Y.source],Y,et,U)}if((b=this.style.projection)===null||b===void 0||b.updateGPUdependent({context:this.context,useProgram:H=>this.useProgram(H)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.bj.black:l.bj.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(H,Y){const et=H.context,ot=et.gl,ct=((Et,xt,Bt)=>{const Gt=Math.cos(xt.rollInRadians),Ht=Math.sin(xt.rollInRadians),Wt=Ft(xt),Yt=xt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Et.properties.get("sky-color"),u_horizon_color:Et.properties.get("horizon-color"),u_horizon:[(xt.width/2-Wt*Ht)*Bt,(xt.height/2+Wt*Gt)*Bt],u_horizon_normal:[-Ht,Gt],u_sky_horizon_blend:Et.properties.get("sky-horizon-blend")*xt.height/2*Bt,u_sky_blend:Yt}})(Y,H.style.map.transform,H.pixelRatio),ht=new oi(ot.LEQUAL,oi.ReadWrite,[0,1]),_t=Ei.disabled,Tt=H.colorModeForRenderPass(),gt=H.useProgram("sky"),St=ol(et,Y);gt.draw(et,ot.TRIANGLES,ht,_t,Tt,_i.disabled,ct,null,void 0,"sky",St.vertexBuffer,St.indexBuffer,St.segments)})(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[A[this.currentLayer]],Y=M[H.source],et=k[H.source];this._renderTileClippingMasks(H,et,!1),this.renderLayer(this,Y,H,et,U)}this.renderPass="translucent";let q=!1;for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const H=this.style._layers[A[this.currentLayer]],Y=M[H.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(H,U))continue;this.opaquePassEnabledForLayer()||q||(q=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const et=(H.type==="symbol"?z:O)[H.source];this._renderTileClippingMasks(H,k[H.source],!!this.renderToTexture),this.renderLayer(this,Y,H,et,U)}if(U.isRenderingGlobe&&(function(H,Y,et){const ot=H.context,ct=ot.gl,ht=H.useProgram("atmosphere"),_t=new oi(ct.LEQUAL,oi.ReadOnly,[0,1]),Tt=H.transform,gt=(function(Yt,ve){const Te=Yt.properties.get("position"),ce=[-Te.x,-Te.y,-Te.z],ke=l.am(new Float64Array(16));return Yt.properties.get("anchor")==="map"&&(l.ba(ke,ke,ve.rollInRadians),l.bb(ke,ke,-ve.pitchInRadians),l.ba(ke,ke,ve.bearingInRadians),l.bb(ke,ke,ve.center.lat*Math.PI/180),l.bD(ke,ke,-ve.center.lng*Math.PI/180)),l.ca(ce,ce,ke),ce})(et,H.transform),St=Tt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Et=Y.properties.get("atmosphere-blend")*St.projectionTransition;if(Et===0)return;const xt=$h(Tt.worldSize,Tt.center.lat),Bt=Tt.inverseProjectionMatrix,Gt=new Float64Array(4);Gt[3]=1,l.aB(Gt,Gt,Tt.modelViewProjectionMatrix),Gt[0]/=Gt[3],Gt[1]/=Gt[3],Gt[2]/=Gt[3],Gt[3]=1,l.aB(Gt,Gt,Bt),Gt[0]/=Gt[3],Gt[1]/=Gt[3],Gt[2]/=Gt[3],Gt[3]=1;const Ht=((Yt,ve,Te,ce,ke)=>({u_sun_pos:Yt,u_atmosphere_blend:ve,u_globe_position:Te,u_globe_radius:ce,u_inv_proj_matrix:ke}))(gt,Et,[Gt[0],Gt[1],Gt[2]],xt,Bt),Wt=ol(ot,Y);ht.draw(ot,ct.TRIANGLES,_t,Ei.disabled,ln.alphaBlended,_i.disabled,Ht,null,null,"atmosphere",Wt.vertexBuffer,Wt.indexBuffer,Wt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const H=(function(Y,et){let ot=null;const ct=Object.values(Y._layers).flatMap((gt=>gt.source&&!gt.isHidden(et)?[Y.tileManagers[gt.source]]:[])),ht=ct.filter((gt=>gt.getSource().type==="vector")),_t=ct.filter((gt=>gt.getSource().type!=="vector")),Tt=gt=>{(!ot||ot.getSource().maxzoom<gt.getSource().maxzoom)&&(ot=gt)};return ht.forEach((gt=>Tt(gt))),ot||_t.forEach((gt=>Tt(gt))),ot})(this.style,this.transform.zoom);H&&(function(Y,et,ot){for(let ct=0;ct<ot.length;ct++)af(Y,et,ot[ct])})(this,H,H.getVisibleCoordinates())}this.options.showPadding&&(function(H){const Y=H.transform.padding;ma(H,H.transform.height-(Y.top||0),3,qs),ma(H,Y.bottom||0,3,Wu),qa(H,Y.left||0,3,_o),qa(H,H.transform.width-(Y.right||0),3,qu);const et=H.transform.centerPoint;(function(ot,ct,ht,_t){Ls(ot,ct-1,ht-10,2,20,_t),Ls(ot,ct-10,ht-1,20,2,_t)})(H,et.x,H.transform.height-et.y,al)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let b=this.terrainFacilitator.dirty;b||(b=s?!l.cd(h,_):!l.ce(h,_)),b||(b=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),b&&(l.cf(h,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(A,M){const k=A.context,O=k.gl,z=A.transform,U=ln.unblended,q=new oi(O.LEQUAL,oi.ReadWrite,[0,1]),H=M.tileManager.getRenderableTiles(),Y=A.useProgram("terrainDepth");k.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),k.clear({color:l.bj.transparent,depth:1});for(const et of H){const ot=M.getTerrainMesh(et.tileID),ct=M.getTerrainData(et.tileID),ht=z.getProjectionData({overscaledTileID:et.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),_t={u_ele_delta:M.getMeshFrameDelta(z.zoom)};Y.draw(k,O.TRIANGLES,q,Ei.disabled,U,_i.backCCW,_t,ct,ht,"terrain",ot.vertexBuffer,ot.indexBuffer,ot.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,A.width,A.height])})(this,this.style.map.terrain),(function(A,M){const k=A.context,O=k.gl,z=A.transform,U=ln.unblended,q=new oi(O.LEQUAL,oi.ReadWrite,[0,1]),H=M.getCoordsTexture(),Y=M.tileManager.getRenderableTiles(),et=A.useProgram("terrainCoords");k.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),k.clear({color:l.bj.transparent,depth:1}),M.coordsIndex=[];for(const ot of Y){const ct=M.getTerrainMesh(ot.tileID),ht=M.getTerrainData(ot.tileID);k.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,H.texture);const _t={u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(z.zoom)},Tt=z.getProjectionData({overscaledTileID:ot.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});et.draw(k,O.TRIANGLES,q,Ei.disabled,U,_i.backCCW,_t,ht,Tt,"terrain",ct.vertexBuffer,ct.indexBuffer,ct.segments),M.coordsIndex.push(ot.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,A.width,A.height])})(this,this.style.map.terrain))}renderLayer(s,h,_,b,A){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(b||[]).length)&&(this.id=_.id,l.cg(_)?(function(M,k,O,z,U,q){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:H}=q,Y=Ei.disabled,et=M.colorModeForRenderPass();(O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ot,ct,ht,_t,Tt,gt,St,Et,xt){const Bt=ct.transform,Gt=ct.style.map.terrain,Ht=Tt==="map",Wt=gt==="map";for(const Yt of ot){const ve=_t.getTile(Yt),Te=ve.getBucket(ht);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const ce=l.as(Te.textSizeData,Bt.zoom),ke=l.aH(ve,1,ct.transform.zoom),Ve=Vn(Ht,ct.transform,ke),Fi=ht.layout.get("icon-text-fit")!=="none"&&Te.hasIconData();if(ce){const dn=Math.pow(2,Bt.zoom-ve.tileID.overscaledZ),rn=Gt?(pn,Gi)=>Gt.getElevation(Yt,pn,Gi):null;rl(Te,Ht,Wt,xt,Bt,Ve,dn,ce,Fi,l.aI(Bt,ve,St,Et),Yt.toUnwrapped(),rn)}}})(z,M,O,k,O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),U),O.paint.get("icon-opacity").constantOr(1)!==0&&as(M,k,O,z,!1,O.paint.get("icon-translate"),O.paint.get("icon-translate-anchor"),O.layout.get("icon-rotation-alignment"),O.layout.get("icon-pitch-alignment"),O.layout.get("icon-keep-upright"),Y,et,H),O.paint.get("text-opacity").constantOr(1)!==0&&as(M,k,O,z,!0,O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.layout.get("text-keep-upright"),Y,et,H),k.map.showCollisionBoxes&&(ss(M,k,O,z,!0),ss(M,k,O,z,!1))})(s,h,_,b,this.style.placement.variableOffsets,A):l.ch(_)?(function(M,k,O,z,U){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:q}=U,H=O.paint.get("circle-opacity"),Y=O.paint.get("circle-stroke-width"),et=O.paint.get("circle-stroke-opacity"),ot=!O.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(Y.constantOr(1)===0||et.constantOr(1)===0))return;const ct=M.context,ht=ct.gl,_t=M.transform,Tt=M.getDepthModeForSublayer(0,oi.ReadOnly),gt=Ei.disabled,St=M.colorModeForRenderPass(),Et=[],xt=_t.getCircleRadiusCorrection();for(let Bt=0;Bt<z.length;Bt++){const Gt=z[Bt],Ht=k.getTile(Gt),Wt=Ht.getBucket(O);if(!Wt)continue;const Yt=O.paint.get("circle-translate"),ve=O.paint.get("circle-translate-anchor"),Te=l.aI(_t,Ht,Yt,ve),ce=Wt.programConfigurations.get(O.id),ke=M.useProgram("circle",ce),Ve=Wt.layoutVertexBuffer,Fi=Wt.indexBuffer,dn=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Gt),rn={programConfiguration:ce,program:ke,layoutVertexBuffer:Ve,indexBuffer:Fi,uniformValues:Jp(M,Ht,O,Te,xt),terrainData:dn,projectionData:_t.getProjectionData({overscaledTileID:Gt,applyGlobeMatrix:!q,applyTerrainMatrix:!0})};if(ot){const pn=Wt.segments.get();for(const Gi of pn)Et.push({segments:new l.aR([Gi]),sortKey:Gi.sortKey,state:rn})}else Et.push({segments:Wt.segments,sortKey:0,state:rn})}ot&&Et.sort(((Bt,Gt)=>Bt.sortKey-Gt.sortKey));for(const Bt of Et){const{programConfiguration:Gt,program:Ht,layoutVertexBuffer:Wt,indexBuffer:Yt,uniformValues:ve,terrainData:Te,projectionData:ce}=Bt.state;Ht.draw(ct,ht.TRIANGLES,Tt,gt,St,_i.backCCW,ve,Te,ce,O.id,Wt,Yt,Bt.segments,O.paint,M.transform.zoom,Gt)}})(s,h,_,b,A):l.ci(_)?(function(M,k,O,z,U){if(O.paint.get("heatmap-opacity")===0)return;const q=M.context,{isRenderingToTexture:H,isRenderingGlobe:Y}=U;if(M.style.map.terrain){for(const et of z){const ot=k.getTile(et);k.hasRenderableParent(et)||(M.renderPass==="offscreen"?Ss(M,ot,O,et,Y):M.renderPass==="translucent"&&Ha(M,O,et,H,Y))}q.viewport.set([0,0,M.width,M.height])}else M.renderPass==="offscreen"?(function(et,ot,ct,ht){const _t=et.context,Tt=_t.gl,gt=et.transform,St=Ei.disabled,Et=new ln([Tt.ONE,Tt.ONE],l.bj.transparent,[!0,!0,!0,!0]);(function(xt,Bt,Gt){const Ht=xt.gl;xt.activeTexture.set(Ht.TEXTURE1),xt.viewport.set([0,0,Bt.width/4,Bt.height/4]);let Wt=Gt.heatmapFbos.get(l.c7);Wt?(Ht.bindTexture(Ht.TEXTURE_2D,Wt.colorAttachment.get()),xt.bindFramebuffer.set(Wt.framebuffer)):(Wt=da(xt,Bt.width/4,Bt.height/4),Gt.heatmapFbos.set(l.c7,Wt))})(_t,et,ct),_t.clear({color:l.bj.transparent});for(let xt=0;xt<ht.length;xt++){const Bt=ht[xt];if(ot.hasRenderableParent(Bt))continue;const Gt=ot.getTile(Bt),Ht=Gt.getBucket(ct);if(!Ht)continue;const Wt=Ht.programConfigurations.get(ct.id),Yt=et.useProgram("heatmap",Wt),ve=gt.getProjectionData({overscaledTileID:Bt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Te=gt.getCircleRadiusCorrection();Yt.draw(_t,Tt.TRIANGLES,oi.disabled,St,Et,_i.backCCW,Zl(Gt,gt.zoom,ct.paint.get("heatmap-intensity"),Te),null,ve,ct.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,ct.paint,gt.zoom,Wt)}_t.viewport.set([0,0,et.width,et.height])})(M,k,O,z):M.renderPass==="translucent"&&(function(et,ot){const ct=et.context,ht=ct.gl;ct.setColorMode(et.colorModeForRenderPass());const _t=ot.heatmapFbos.get(l.c7);_t&&(ct.activeTexture.set(ht.TEXTURE0),ht.bindTexture(ht.TEXTURE_2D,_t.colorAttachment.get()),ct.activeTexture.set(ht.TEXTURE1),Zc(ct,ot).bind(ht.LINEAR,ht.CLAMP_TO_EDGE),et.useProgram("heatmapTexture").draw(ct,ht.TRIANGLES,oi.disabled,Ei.disabled,et.colorModeForRenderPass(),_i.disabled,dd(et,ot,0,1),null,null,ot.id,et.viewportBuffer,et.quadTriangleIndexBuffer,et.viewportSegments,ot.paint,et.transform.zoom))})(M,O)})(s,h,_,b,A):l.cj(_)?(function(M,k,O,z,U){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:q}=U,H=O.paint.get("line-opacity"),Y=O.paint.get("line-width");if(H.constantOr(1)===0||Y.constantOr(1)===0)return;const et=M.getDepthModeForSublayer(0,oi.ReadOnly),ot=M.colorModeForRenderPass(),ct=O.paint.get("line-dasharray"),ht=ct.constantOr(1),_t=O.paint.get("line-pattern"),Tt=_t.constantOr(1),gt=O.paint.get("line-gradient"),St=O.getCrossfadeParameters();let Et;Et=Tt?"linePattern":ht&&gt?"lineGradientSDF":ht?"lineSDF":gt?"lineGradient":"line";const xt=M.context,Bt=xt.gl,Gt=M.transform;let Ht=!0;for(const Wt of z){const Yt=k.getTile(Wt);if(Tt&&!Yt.patternsLoaded())continue;const ve=Yt.getBucket(O);if(!ve)continue;const Te=ve.programConfigurations.get(O.id),ce=M.context.program.get(),ke=M.useProgram(Et,Te),Ve=Ht||ke.program!==ce,Fi=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Wt),dn=_t.constantOr(null),rn=ct&&ct.constantOr(null);if(dn&&Yt.imageAtlas){const tr=Yt.imageAtlas,kn=tr.patternPositions[dn.to.toString()],Xn=tr.patternPositions[dn.from.toString()];kn&&Xn&&Te.setConstantPatternPositions(kn,Xn)}else if(rn){const tr=O.layout.get("line-cap")==="round",kn=M.lineAtlas.getDash(rn.to,tr),Xn=M.lineAtlas.getDash(rn.from,tr);Te.setConstantDashPositions(kn,Xn)}const pn=Gt.getProjectionData({overscaledTileID:Wt,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),Gi=Gt.getPixelScale();let qn;Tt?(qn=tm(M,Yt,O,Gi,St),sf(xt,Bt,Yt,Te,St)):ht&&gt?(qn=im(M,Yt,O,Gi,St,ve.lineClipsArray.length),cn(M,k,xt,Bt,O,ve,Wt,Te,St)):ht?(qn=em(M,Yt,O,Gi,St),wd(M,xt,Bt,Te,Ve,St)):gt?(qn=jc(M,Yt,O,Gi,ve.lineClipsArray.length),Jn(M,k,xt,Bt,O,ve,Wt)):qn=Vc(M,Yt,O,Gi);const Yi=M.stencilModeForClipping(Wt);ke.draw(xt,Bt.TRIANGLES,et,Yi,ot,_i.disabled,qn,Fi,pn,O.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,O.paint,M.transform.zoom,Te,ve.layoutVertexBuffer2),Ht=!1}})(s,h,_,b,A):l.ck(_)?(function(M,k,O,z,U){const q=O.paint.get("fill-color"),H=O.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const{isRenderingToTexture:Y}=U,et=M.colorModeForRenderPass(),ot=O.paint.get("fill-pattern"),ct=M.opaquePassEnabledForLayer()&&!ot.constantOr(1)&&q.constantOr(l.bj.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(M.renderPass===ct){const ht=M.getDepthModeForSublayer(1,M.renderPass==="opaque"?oi.ReadWrite:oi.ReadOnly);Wa(M,k,O,z,ht,et,!1,Y)}if(M.renderPass==="translucent"&&O.paint.get("fill-antialias")){const ht=M.getDepthModeForSublayer(O.getPaintProperty("fill-outline-color")?2:0,oi.ReadOnly);Wa(M,k,O,z,ht,et,!0,Y)}})(s,h,_,b,A):l.cl(_)?(function(M,k,O,z,U){const q=O.paint.get("fill-extrusion-opacity");if(q===0)return;const{isRenderingToTexture:H}=U;if(M.renderPass==="translucent"){const Y=new oi(M.context.gl.LEQUAL,oi.ReadWrite,M.depthRangeFor3D);if(q!==1||O.paint.get("fill-extrusion-pattern").constantOr(1))Ii(M,k,O,z,Y,Ei.disabled,ln.disabled,H),Ii(M,k,O,z,Y,M.stencilModeFor3D(),M.colorModeForRenderPass(),H);else{const et=M.colorModeForRenderPass();Ii(M,k,O,z,Y,Ei.disabled,et,H)}}})(s,h,_,b,A):l.cm(_)?(function(M,k,O,z,U){if(M.renderPass!=="offscreen"&&M.renderPass!=="translucent")return;const{isRenderingToTexture:q}=U,H=M.context,Y=M.style.projection.useSubdivision,et=M.getDepthModeForSublayer(0,oi.ReadOnly),ot=M.colorModeForRenderPass();if(M.renderPass==="offscreen")(function(ct,ht,_t,Tt,gt,St,Et){const xt=ct.context,Bt=xt.gl;for(const Gt of _t){const Ht=ht.getTile(Gt),Wt=Ht.dem;if(!Wt||!Wt.data||!Ht.needsHillshadePrepare)continue;const Yt=Wt.dim,ve=Wt.stride,Te=Wt.getPixels();if(xt.activeTexture.set(Bt.TEXTURE1),xt.pixelStoreUnpackPremultiplyAlpha.set(!1),Ht.demTexture=Ht.demTexture||ct.getTileTexture(ve),Ht.demTexture){const ke=Ht.demTexture;ke.update(Te,{premultiply:!1}),ke.bind(Bt.NEAREST,Bt.CLAMP_TO_EDGE)}else Ht.demTexture=new l.T(xt,Te,Bt.RGBA,{premultiply:!1}),Ht.demTexture.bind(Bt.NEAREST,Bt.CLAMP_TO_EDGE);xt.activeTexture.set(Bt.TEXTURE0);let ce=Ht.fbo;if(!ce){const ke=new l.T(xt,{width:Yt,height:Yt,data:null},Bt.RGBA);ke.bind(Bt.LINEAR,Bt.CLAMP_TO_EDGE),ce=Ht.fbo=xt.createFramebuffer(Yt,Yt,!0,!1),ce.colorAttachment.set(ke.texture)}xt.bindFramebuffer.set(ce.framebuffer),xt.viewport.set([0,0,Yt,Yt]),ct.useProgram("hillshadePrepare").draw(xt,Bt.TRIANGLES,gt,St,Et,_i.disabled,pd(Ht.tileID,Wt),null,null,Tt.id,ct.rasterBoundsBuffer,ct.quadTriangleIndexBuffer,ct.rasterBoundsSegments),Ht.needsHillshadePrepare=!1}})(M,k,z,O,et,Ei.disabled,ot),H.viewport.set([0,0,M.width,M.height]);else if(M.renderPass==="translucent")if(Y){const[ct,ht,_t]=M.stencilConfigForOverlapTwoPass(z);pa(M,k,O,_t,ct,et,ot,!1,q),pa(M,k,O,_t,ht,et,ot,!0,q)}else{const[ct,ht]=M.getStencilConfigForOverlapAndUpdateStencilID(z);pa(M,k,O,ht,ct,et,ot,!1,q)}})(s,h,_,b,A):l.cn(_)?(function(M,k,O,z,U){if(M.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:q}=U,H=M.style.projection.useSubdivision,Y=M.getDepthModeForSublayer(0,oi.ReadOnly),et=M.colorModeForRenderPass();if(H){const[ot,ct,ht]=M.stencilConfigForOverlapTwoPass(z);Hn(M,k,O,ht,ot,Y,et,!1,q),Hn(M,k,O,ht,ct,Y,et,!0,q)}else{const[ot,ct]=M.getStencilConfigForOverlapAndUpdateStencilID(z);Hn(M,k,O,ct,ot,Y,et,!1,q)}})(s,h,_,b,A):l.bO(_)?(function(M,k,O,z,U){if(M.renderPass!=="translucent"||O.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:q}=U,H=k.getSource(),Y=M.style.projection.useSubdivision;if(H instanceof _s)sl(M,k,O,z,null,!1,!1,H.tileCoords,H.flippedWindingOrder,q);else if(Y){const[et,ot,ct]=M.stencilConfigForOverlapTwoPass(z);sl(M,k,O,ct,et,!1,!0,Yc,!1,q),sl(M,k,O,ct,ot,!0,!0,Yc,!1,q)}else{const[et,ot]=M.getStencilConfigForOverlapAndUpdateStencilID(z);sl(M,k,O,ot,et,!1,!0,Yc,!1,q)}})(s,h,_,b,A):l.co(_)?(function(M,k,O,z,U){const q=O.paint.get("background-color"),H=O.paint.get("background-opacity");if(H===0)return;const{isRenderingToTexture:Y}=U,et=M.context,ot=et.gl,ct=M.style.projection,ht=M.transform,_t=ht.tileSize,Tt=O.paint.get("background-pattern");if(M.isPatternMissing(Tt))return;const gt=!Tt&&q.a===1&&H===1&&M.opaquePassEnabledForLayer()?"opaque":"translucent";if(M.renderPass!==gt)return;const St=Ei.disabled,Et=M.getDepthModeForSublayer(0,gt==="opaque"?oi.ReadWrite:oi.ReadOnly),xt=M.colorModeForRenderPass(),Bt=M.useProgram(Tt?"backgroundPattern":"background"),Gt=z||si(ht,{tileSize:_t,terrain:M.style.map.terrain});Tt&&(et.activeTexture.set(ot.TEXTURE0),M.imageManager.bind(M.context));const Ht=O.getCrossfadeParameters();for(const Wt of Gt){const Yt=ht.getProjectionData({overscaledTileID:Wt,applyGlobeMatrix:!Y,applyTerrainMatrix:!0}),ve=Tt?Jh(H,M,Tt,{tileID:Wt,tileSize:_t},Ht):Qh(H,q),Te=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Wt),ce=ct.getMeshFromTileID(et,Wt.canonical,!1,!0,"raster");Bt.draw(et,ot.TRIANGLES,Et,St,xt,_i.backCCW,ve,Te,Yt,O.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}})(s,0,_,b,A):l.cp(_)&&(function(M,k,O,z){const{isRenderingGlobe:U}=z,q=M.context,H=O.implementation,Y=M.style.projection,et=M.transform,ot=et.getProjectionDataForCustomLayer(U),ct={farZ:et.farZ,nearZ:et.nearZ,fov:et.fov*Math.PI/180,modelViewProjectionMatrix:et.modelViewProjectionMatrix,projectionMatrix:et.projectionMatrix,shaderData:{variantName:Y.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Y.shaderPreludeCode.vertexSource}`,define:Y.shaderDefine},defaultProjectionData:ot},ht=H.renderingMode?H.renderingMode:"2d";if(M.renderPass==="offscreen"){const _t=H.prerender;_t&&(M.setCustomLayerDefaults(),q.setColorMode(M.colorModeForRenderPass()),_t.call(H,q.gl,ct),q.setDirty(),M.setBaseState())}else if(M.renderPass==="translucent"){M.setCustomLayerDefaults(),q.setColorMode(M.colorModeForRenderPass()),q.setStencilMode(Ei.disabled);const _t=ht==="3d"?M.getDepthModeFor3D():M.getDepthModeForSublayer(0,oi.ReadOnly);q.setDepthMode(_t),H.render(q.gl,ct),q.setDirty(),M.setBaseState(),q.bindFramebuffer.set(null)}})(s,0,_,A))}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),_=this.imageManager.getPattern(s.to.toString());return!h||!_}useProgram(s,h,_=!1,b=[]){this.cache=this.cache||{};const A=!!this.style.map.terrain,M=this.style.projection,k=_?is.projectionMercator:M.shaderPreludeCode,O=_?jn:M.shaderDefine,z=s+(h?h.cacheKey:"")+`/${_?$n:M.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(A?"/terrain":"")+(b?`/${b.join("/")}`:"");return this.cache[z]||(this.cache[z]=new Kp(this.context,is[s],h,Fu[s],this._showOverdrawInspector,A,k,O,b)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var s,h;if(this._tileTextures){for(const _ in this._tileTextures){const b=this._tileTextures[_];if(b)for(const A of b)A.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((s=this.tileExtentMesh.vertexBuffer)===null||s===void 0||s.destroy()),this.tileExtentMesh&&((h=this.tileExtentMesh.indexBuffer)===null||h===void 0||h.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const _ in this.cache){const b=this.cache[_];b&&b.program&&this.context.gl.deleteProgram(b.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:h}=this.context.gl;return this.width!==s||this.height!==h}}function yo(T,s){let h,_=!1,b=null,A=null;const M=()=>{b=null,_&&(T.apply(A,h),b=setTimeout(M,s),_=!1)};return(...k)=>(_=!0,A=this,h=k,b||M(),b)}class cr{constructor(s){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let _;return h.split("&").map((b=>b.split("="))).forEach((b=>{b[0]===this._hashName&&(_=b)})),(_&&_[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const _=h.join("/");let b=_;b.split("&").length>0&&(b=b.split("&")[0]),this._hashName&&(b=`${this._hashName}=${_}`);let A=window.location.hash.replace(b,"");A.startsWith("#&")?A=A.slice(0,1)+A.slice(2):A==="#"&&(A="");let M=window.location.href.replace(/(#.+)?$/,A);M=M.replace("&&","&"),window.history.replaceState(window.history.state,null,M)},this._updateHash=yo(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const h=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,b),M=Math.round(h.lng*A)/A,k=Math.round(h.lat*A)/A,O=this._map.getBearing(),z=this._map.getPitch();let U="";if(U+=s?`/${M}/${k}/${_}`:`${_}/${k}/${M}`,(O||z)&&(U+="/"+Math.round(10*O)/10),z&&(U+=`/${Math.round(z)}`),this._hashName){const q=this._hashName;let H=!1;const Y=window.location.hash.slice(1).split("&").map((et=>{const ot=et.split("=")[0];return ot===q?(H=!0,`${ot}=${U}`):et})).filter((et=>et));return H||Y.push(`${q}=${U}`),`#${Y.join("&")}`}return`#${U}`}_isValidHash(s){if(s.length<3||s.some(isNaN))return!1;try{new l.U(+s[2],+s[1])}catch{return!1}const h=+s[0],_=+(s[3]||0),b=+(s[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&_>=-180&&_<=180&&b>=this._map.getMinPitch()&&b<=this._map.getMaxPitch()}}const vo={linearity:.3,easing:l.cq(0,0,.3,1)},Td=l.e({deceleration:2500,maxSpeed:1400},vo),am=l.e({deceleration:20,maxSpeed:1400},vo),om=l.e({deceleration:1e3,maxSpeed:360},vo),of=l.e({deceleration:1e3,maxSpeed:90},vo),Wn=l.e({deceleration:1e3,maxSpeed:360},vo);class As{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:at(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=at();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)h.zoom+=A.zoomDelta||0,h.bearing+=A.bearingDelta||0,h.pitch+=A.pitchDelta||0,h.roll+=A.rollDelta||0,A.panDelta&&h.pan._add(A.panDelta),A.around&&(h.around=A.around),A.pinchAround&&(h.pinchAround=A.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(h.pan.mag()){const A=Za(h.pan.mag(),_,l.e({},Td,s||{})),M=h.pan.mult(A.amount/h.pan.mag()),k=this._map.cameraHelper.handlePanInertia(M,this._map.transform);b.center=k.easingCenter,b.offset=k.easingOffset,ur(b,A)}if(h.zoom){const A=Za(h.zoom,_,am);b.zoom=this._map.transform.zoom+A.amount,ur(b,A)}if(h.bearing){const A=Za(h.bearing,_,om);b.bearing=this._map.transform.bearing+l.ai(A.amount,-179,179),ur(b,A)}if(h.pitch){const A=Za(h.pitch,_,of);b.pitch=this._map.transform.pitch+A.amount,ur(b,A)}if(h.roll){const A=Za(h.roll,_,Wn);b.roll=this._map.transform.roll+l.ai(A.amount,-179,179),ur(b,A)}if(b.zoom||b.bearing){const A=h.pinchAround===void 0?h.around:h.pinchAround;b.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),l.e(b,{noMoveStart:!0})}}function ur(T,s){(!T.duration||T.duration<s.duration)&&(T.duration=s.duration,T.easing=s.easing)}function Za(T,s,h){const{maxSpeed:_,linearity:b,deceleration:A}=h,M=l.ai(T*b/(s/1e3),-_,_),k=Math.abs(M)/(A*b);return{easing:h.easing,duration:1e3*k,amount:M*(k/2)}}class bn extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,_,b={}){_=_ instanceof MouseEvent?_:new MouseEvent(s,_);const A=J.mousePos(h.getCanvas(),_),M=h.unproject(A);super(s,l.e({point:A,lngLat:M,originalEvent:_},b)),this._defaultPrevented=!1,this.target=h}}class Ga extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,_){const b=s==="touchend"?_.changedTouches:_.touches,A=J.touchPos(h.getCanvasContainer(),b),M=A.map((O=>h.unproject(O))),k=A.reduce(((O,z,U,q)=>O.add(z.div(q.length))),new l.P(0,0));super(s,{points:A,point:k,lngLats:M,lngLat:h.unproject(k),originalEvent:_}),this._defaultPrevented=!1}}class Xs extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,_){super(s,{originalEvent:_}),this._defaultPrevented=!1}}class n_{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Xs(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new bn(s.type,this._map,s))}mouseup(s){this._map.fire(new bn(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new bn(s.type,this._map,s))}dblclick(s){return this._firePreventable(new bn(s.type,this._map,s))}mouseover(s){this._map.fire(new bn(s.type,this._map,s))}mouseout(s){this._map.fire(new bn(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ga(s.type,this._map,s))}touchmove(s){this._map.fire(new Ga(s.type,this._map,s))}touchend(s){this._map.fire(new Ga(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ga(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lm{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new bn(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new bn(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zu{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.screenPointToLocation(l.P.convert(s),this._map.terrain)}}class Sd{constructor(s,h){this._map=s,this._tr=new Zu(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(J.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=J.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const A=Math.min(b.x,_.x),M=Math.max(b.x,_.x),k=Math.min(b.y,_.y),O=Math.max(b.y,_.y);J.setTransform(this._box,`translate(${A}px,${k}px)`),this._box.style.width=M-A+"px",this._box.style.height=O-k+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const _=this._startPos,b=h;if(this.reset(),J.suppressClick(),_.x!==b.x||_.y!==b.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:s})),{cameraAnimation:A=>A.fitScreenCoordinates(_,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(J.remove(this._box),this._box=null),J.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.l(s,{originalEvent:h}))}}function Ya(T,s){if(T.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${T.length}, points ${s.length}`);const h={};for(let _=0;_<T.length;_++)h[T[_].identifier]=s[_];return h}class nc{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),_.length===this.numTouches&&(this.centroid=(function(b){const A=new l.P(0,0);for(const M of b)A._add(M);return A.div(b.length)})(h),this.touches=Ya(_,h)))}touchmove(s,h,_){if(this.aborted||!this.centroid)return;const b=Ya(_,h);for(const A in this.touches){const M=b[A];(!M||M.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(s,h,_){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Es{constructor(s){this.singleTap=new nc(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,_){this.singleTap.touchstart(s,h,_)}touchmove(s,h,_){this.singleTap.touchmove(s,h,_)}touchend(s,h,_){const b=this.singleTap.touchend(s,h,_);if(b){const A=s.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(b)<30;if(A&&M||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Ie{constructor(s){this._tr=new Zu(s),this._zoomIn=new Es({numTouches:1,numTaps:2}),this._zoomOut=new Es({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,_){this._zoomIn.touchstart(s,h,_),this._zoomOut.touchstart(s,h,_)}touchmove(s,h,_){this._zoomIn.touchmove(s,h,_),this._zoomOut.touchmove(s,h,_)}touchend(s,h,_){const b=this._zoomIn.touchend(s,h,_),A=this._zoomOut.touchend(s,h,_),M=this._tr;return b?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(b)},{originalEvent:s})}):A?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(A)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ga{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const h=this._moveFunction(...s);if(h.bearingDelta||h.pitchDelta||h.rollDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(s,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,h){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const b=Array.isArray(h)?h[0]:h;return!this._moved&&b.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(_,b))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&J.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Gu=0,Yu=2,ll={[Gu]:1,[Yu]:2};class Ka{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const h=J.mouseButton(s);this._eventButton=h}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!(function(h,_){const b=ll[_];return h.buttons===void 0||(h.buttons&b)!==b})(s,this._eventButton)}isValidEndEvent(s){return J.mouseButton(s)===this._eventButton}}class lf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}class rc{constructor(s=new Ka({checkCorrectEvent:()=>!0}),h=new lf){this.mouseMoveStateManager=s,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(s,h,_){return s instanceof MouseEvent?h(s):typeof TouchEvent<"u"&&s instanceof TouchEvent?_(s):void 0}startMove(s){this._executeRelevantHandler(s,(h=>this.mouseMoveStateManager.startMove(h)),(h=>this.oneFingerTouchMoveStateManager.startMove(h)))}endMove(s){this._executeRelevantHandler(s,(h=>this.mouseMoveStateManager.endMove(h)),(h=>this.oneFingerTouchMoveStateManager.endMove(h)))}isValidStartEvent(s){return this._executeRelevantHandler(s,(h=>this.mouseMoveStateManager.isValidStartEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h)))}isValidMoveEvent(s){return this._executeRelevantHandler(s,(h=>this.mouseMoveStateManager.isValidMoveEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h)))}isValidEndEvent(s){return this._executeRelevantHandler(s,(h=>this.mouseMoveStateManager.isValidEndEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h)))}}const Zs=T=>{T.mousedown=T.dragStart,T.mousemoveWindow=T.dragMove,T.mouseup=T.dragEnd,T.contextmenu=s=>{s.preventDefault()}};class cf{constructor(s,h){this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,h,_){return this._calculateTransform(s,h,_)}touchmove(s,h,_){if(this._active){if(!this._shouldBePrevented(_.length))return s.preventDefault(),this._calculateTransform(s,h,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,h,_){this._calculateTransform(s,h,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,_){_.length>0&&(this._active=!0);const b=Ya(_,h),A=new l.P(0,0),M=new l.P(0,0);let k=0;for(const z in b){const U=b[z],q=this._touches[z];q&&(A._add(U),M._add(U.sub(q)),k++,b[z]=U)}if(this._touches=b,this._shouldBePrevented(k)||!M.mag())return;const O=M.div(k);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(k),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uf{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,_){if(!this._firstTwoTouches)return;s.preventDefault();const[b,A]=this._firstTwoTouches,M=Qa(_,h,b),k=Qa(_,h,A);if(!M||!k)return;const O=this._aroundCenter?null:M.add(k).div(2);return this._move([M,k],O,s)}touchend(s,h,_){if(!this._firstTwoTouches)return;const[b,A]=this._firstTwoTouches,M=Qa(_,h,b),k=Qa(_,h,A);M&&k||(this._active&&J.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Qa(T,s,h){for(let _=0;_<T.length;_++)if(T[_].identifier===h)return s[_]}function Kc(T,s){return Math.log(T/s)/Math.LN2}class Ku extends uf{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const _=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,_),pinchAround:h}}}function sc(T,s){return 180*T.angleWith(s)/Math.PI}class Qu extends uf{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h,_){const b=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:sc(this._vector,b),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,_=sc(s,this._startVector);return Math.abs(_)<h}}function Ju(T){return Math.abs(T.y)>Math.abs(T.x)}class cl extends uf{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,_){super.touchstart(s,h,_),this._currentTouchCount=_.length}_start(s){this._lastPoints=s,Ju(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=s[0].sub(this._lastPoints[0]),A=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,A,_.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(b.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,_){if(this._valid!==void 0)return this._valid;const b=s.mag()>=2,A=h.mag()>=2;if(!b&&!A)return;if(!b||!A)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const M=s.y>0==h.y>0;return Ju(s)&&Ju(h)&&M}}const cm={panStep:100,bearingStep:15,pitchStep:10};class jr{constructor(s){this._tr=new Zu(s);const h=cm;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,_=0,b=0,A=0,M=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?_=-1:(s.preventDefault(),A=-1);break;case 39:s.shiftKey?_=1:(s.preventDefault(),A=1);break;case 38:s.shiftKey?b=1:(s.preventDefault(),M=-1);break;case 40:s.shiftKey?b=-1:(s.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:k=>{const O=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:Hi,zoom:h?Math.round(O.zoom)+h*(s.shiftKey?2:1):O.zoom,bearing:O.bearing+_*this._bearingStep,pitch:O.pitch+b*this._pitchStep,offset:[-A*this._panStep,-M*this._panStep],center:O.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hi(T){return T*(2-T)}const hf=4.000244140625,_a=1/450;class ya{constructor(s,h){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=s,this._tr=new Zu(s),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=_a}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const _=at(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%hf==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(b*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=J.mousePos(this._map.getCanvas(),s),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(l.U.convert(_.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const k=s.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=k),typeof this._targetZoom=="number"&&(this._targetZoom+=k)}if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>hf?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&O!==0&&(O=1/O);const z=typeof this._targetZoom!="number"?s.scale:l.al(this._targetZoom);this._targetZoom=s.applyConstrain(s.getCameraLngLat(),l.ao(z*O)).zoom,this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?s.zoom:this._targetZoom,_=this._startZoom,b=this._easing;let A,M=!1;if(this._type==="wheel"&&_&&b){const k=at()-this._lastWheelEventTime,O=Math.min((k+5)/200,1),z=b(O);A=l.F.number(_,h,z),O<1?this._frameId||(this._frameId=!0):M=!0}else A=h,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=A,{noInertia:!0,needsRenderFrame:!M,zoomDelta:A-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.cs;if(this._prevEase){const _=this._prevEase,b=(at()-_.start)/_.duration,A=_.easing(b+.01)-_.easing(b),M=.27/Math.sqrt(A*A+1e-4)*.01,k=Math.sqrt(.0729-M*M);h=l.cq(M,k,.25,1)}return this._prevEase={start:at(),duration:s,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ac{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ff{constructor(s){this._tr=new Zu(s),this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class df{constructor(){this._tap=new Es({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,h,_){if(!this._swipePoint)if(this._tapTime){const b=h[0],A=s.timeStamp-this._tapTime<500,M=this._tapPoint.dist(b)<30;A&&M?_.length>0&&(this._swipePoint=b,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(s,h,_)}touchmove(s,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=h[0],A=b.y-this._swipePoint.y;return this._swipePoint=b,s.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(s,h,_)}touchend(s,h,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const b=this._tap.touchend(s,h,_);b&&(this._tapTime=s.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qc{constructor(s,h,_){this._el=s,this._mousePan=h,this._touchPan=_}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class os{constructor(s,h,_,b){this._pitchWithRotate=s.pitchWithRotate,this._rollEnabled=s.rollEnabled,this._mouseRotate=h,this._mousePitch=_,this._mouseRoll=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Jc{constructor(s,h,_,b){this._el=s,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ze{constructor(s,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=J.create("div","maplibregl-cooperative-gesture-screen",s);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=h,this._container.appendChild(b);const A=document.createElement("div");A.className="maplibregl-mobile-message",A.textContent=_,this._container.appendChild(A),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(J.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,h){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:s,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const je=T=>T.zoom||T.drag||T.roll||T.pitch||T.rotate;class ul extends l.l{}function th(T){return T.panDelta&&T.panDelta.mag()||T.zoomDelta||T.bearingDelta||T.pitchDelta||T.rollDelta}class tu{constructor(s,h){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,A)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=b.type==="renderFrame"?void 0:b,k={needsRenderFrame:!1},O={},z={};for(const{handlerName:H,handler:Y,allowed:et}of this._handlers){if(!Y.isEnabled())continue;let ot;if(this._blockedByActive(z,et,H))Y.reset();else if(Y[A||b.type]){if(l.ct(b,A||b.type)){const ct=J.mousePos(this._map.getCanvas(),b);ot=Y[A||b.type](b,ct)}else if(l.cu(b,A||b.type)){const ct=this._getMapTouches(b.touches),ht=J.touchPos(this._map.getCanvas(),ct);ot=Y[A||b.type](b,ht,ct)}else l.cv(A||b.type)||(ot=Y[A||b.type](b));this.mergeHandlerResult(k,O,ot,H,M),ot&&ot.needsRenderFrame&&this._triggerRenderFrame()}(ot||Y.isActive())&&(z[H]=Y)}const U={};for(const H in this._previousActiveHandlers)z[H]||(U[H]=M);this._previousActiveHandlers=z,(Object.keys(U).length||th(k))&&(this._changes.push([k,O,U]),this._triggerRenderFrame()),(Object.keys(z).length||th(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=k;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new As(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,A,M]of this._listeners)J.addEventListener(b,A,b===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[s,h,_]of this._listeners)J.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(s){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new n_(h,s));const b=h.boxZoom=new Sd(h,s);this._add("boxZoom",b),s.interactive&&s.boxZoom&&b.enable();const A=h.cooperativeGestures=new ze(h,s.cooperativeGestures);this._add("cooperativeGestures",A),s.cooperativeGestures&&A.enable();const M=new Ie(h),k=new ff(h);h.doubleClickZoom=new ac(k,M),this._add("tapZoom",M),this._add("clickZoom",k),s.interactive&&s.doubleClickZoom&&h.doubleClickZoom.enable();const O=new df;this._add("tapDragZoom",O);const z=h.touchPitch=new cl(h);this._add("touchPitch",z),s.interactive&&s.touchPitch&&h.touchPitch.enable(s.touchPitch);const U=()=>h.project(h.getCenter()),q=(function({enable:gt,clickTolerance:St,aroundCenter:Et=!0,minPixelCenterThreshold:xt=100,rotateDegreesPerPixelMoved:Bt=.8},Gt){const Ht=new Ka({checkCorrectEvent:Wt=>J.mouseButton(Wt)===0&&Wt.ctrlKey||J.mouseButton(Wt)===2&&!Wt.ctrlKey});return new ga({clickTolerance:St,move:(Wt,Yt)=>{const ve=Gt();if(Et&&Math.abs(ve.y-Wt.y)>xt)return{bearingDelta:l.cr(new l.P(Wt.x,Yt.y),Yt,ve)};let Te=(Yt.x-Wt.x)*Bt;return Et&&Yt.y<ve.y&&(Te=-Te),{bearingDelta:Te}},moveStateManager:Ht,enable:gt,assignEvents:Zs})})(s,U),H=(function({enable:gt,clickTolerance:St,pitchDegreesPerPixelMoved:Et=-.5}){const xt=new Ka({checkCorrectEvent:Bt=>J.mouseButton(Bt)===0&&Bt.ctrlKey||J.mouseButton(Bt)===2});return new ga({clickTolerance:St,move:(Bt,Gt)=>({pitchDelta:(Gt.y-Bt.y)*Et}),moveStateManager:xt,enable:gt,assignEvents:Zs})})(s),Y=(function({enable:gt,clickTolerance:St,rollDegreesPerPixelMoved:Et=.3},xt){const Bt=new Ka({checkCorrectEvent:Gt=>J.mouseButton(Gt)===2&&Gt.ctrlKey});return new ga({clickTolerance:St,move:(Gt,Ht)=>{const Wt=xt();let Yt=(Ht.x-Gt.x)*Et;return Ht.y<Wt.y&&(Yt=-Yt),{rollDelta:Yt}},moveStateManager:Bt,enable:gt,assignEvents:Zs})})(s,U);h.dragRotate=new os(s,q,H,Y),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",H,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Y,["mousePitch"]),s.interactive&&s.dragRotate&&h.dragRotate.enable();const et=(function({enable:gt,clickTolerance:St}){const Et=new Ka({checkCorrectEvent:xt=>J.mouseButton(xt)===0&&!xt.ctrlKey});return new ga({clickTolerance:St,move:(xt,Bt)=>({around:Bt,panDelta:Bt.sub(xt)}),activateOnStart:!0,moveStateManager:Et,enable:gt,assignEvents:Zs})})(s),ot=new cf(s,h);h.dragPan=new Qc(_,et,ot),this._add("mousePan",et),this._add("touchPan",ot,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&h.dragPan.enable(s.dragPan);const ct=new Qu,ht=new Ku;h.touchZoomRotate=new Jc(_,ht,ct,O),this._add("touchRotate",ct,["touchPan","touchZoom"]),this._add("touchZoom",ht,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&h.touchZoomRotate.enable(s.touchZoomRotate),this._add("blockableMapEvent",new lm(h));const _t=h.scrollZoom=new ya(h,(()=>this._triggerRenderFrame()));this._add("scrollZoom",_t,["mousePan"]),s.interactive&&s.scrollZoom&&h.scrollZoom.enable(s.scrollZoom);const Tt=h.keyboard=new jr(h);this._add("keyboard",Tt),s.interactive&&s.keyboard&&h.keyboard.enable()}_add(s,h,_){this._handlers.push({handlerName:s,handler:h,allowed:_}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!je(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,_){for(const b in s)if(b!==_&&(!h||h.indexOf(b)<0))return!0;return!1}_getMapTouches(s){const h=[];for(const _ of s)this._el.contains(_.target)&&h.push(_);return h}mergeHandlerResult(s,h,_,b,A){if(!_)return;l.e(s,_);const M={handlerName:b,originalEvent:_.originalEvent||A};_.zoomDelta!==void 0&&(h.zoom=M),_.panDelta!==void 0&&(h.drag=M),_.rollDelta!==void 0&&(h.roll=M),_.pitchDelta!==void 0&&(h.pitch=M),_.bearingDelta!==void 0&&(h.rotate=M)}_applyChanges(){const s={},h={},_={};for(const[b,A,M]of this._changes)b.panDelta&&(s.panDelta=(s.panDelta||new l.P(0,0))._add(b.panDelta)),b.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+b.pitchDelta),b.rollDelta&&(s.rollDelta=(s.rollDelta||0)+b.rollDelta),b.around!==void 0&&(s.around=b.around),b.pinchAround!==void 0&&(s.pinchAround=b.pinchAround),b.noInertia&&(s.noInertia=b.noInertia),l.e(h,A),l.e(_,M);this._updateMapTransform(s,h,_),this._changes=[]}_updateMapTransform(s,h,_){const b=this._map,A=b._getTransformForUpdate(),M=b.terrain;if(!(th(s)||M&&this._terrainMovement))return this._fireEvents(h,_,!0);b._stop(!0);let{panDelta:k,zoomDelta:O,bearingDelta:z,pitchDelta:U,rollDelta:q,around:H,pinchAround:Y}=s;Y!==void 0&&(H=Y),H=H||b.transform.centerPoint,M&&!A.isPointOnMapSurface(H)&&(H=A.centerPoint);const et={panDelta:k,zoomDelta:O,rollDelta:q,pitchDelta:U,bearingDelta:z,around:H};this._map.cameraHelper.useGlobeControls&&!A.isPointOnMapSurface(H)&&(H=A.centerPoint);const ot=H.distSqr(A.centerPoint)<.01?A.center:A.screenPointToLocation(k?H.sub(k):H);this._handleMapControls({terrain:M,tr:A,deltasForHelper:et,preZoomAroundLoc:ot,combinedEventsInProgress:h,panDelta:k}),b._applyUpdatedTransform(A),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,_,!0)}_handleMapControls({terrain:s,tr:h,deltasForHelper:_,preZoomAroundLoc:b,combinedEventsInProgress:A,panDelta:M}){const k=this._map.cameraHelper;if(k.handleMapControlsRollPitchBearingZoom(_,h),s)return k.useGlobeControls?(this._terrainMovement||!A.drag&&!A.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void k.handleMapControlsPan(_,h,b)):this._terrainMovement||!A.drag&&!A.zoom?void(A.drag&&this._terrainMovement&&M?h.setCenter(h.screenPointToLocation(h.centerPoint.sub(M))):k.handleMapControlsPan(_,h,b)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void k.handleMapControlsPan(_,h,b));k.handleMapControlsPan(_,h,b)}_fireEvents(s,h,_){const b=je(this._eventsInProgress),A=je(s),M={};for(const q in s){const{originalEvent:H}=s[q];this._eventsInProgress[q]||(M[`${q}start`]=H),this._eventsInProgress[q]=s[q]}!b&&A&&this._fireEvent("movestart",A.originalEvent);for(const q in M)this._fireEvent(q,M[q]);A&&this._fireEvent("move",A.originalEvent);for(const q in s){const{originalEvent:H}=s[q];this._fireEvent(q,H)}const k={};let O;for(const q in this._eventsInProgress){const{handlerName:H,originalEvent:Y}=this._eventsInProgress[q];this._handlersById[H].isActive()||(delete this._eventsInProgress[q],O=h[H]||Y,k[`${q}end`]=O)}for(const q in k)this._fireEvent(q,k[q]);const z=je(this._eventsInProgress),U=(b||A)&&!z;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const q=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&q.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(q)}if(_&&U){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!q||!q.essential&&G.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:O})),H(this._map.getBearing())&&this._map.resetNorth()):(H(q.bearing||this._map.getBearing())&&(q.bearing=0),q.freezeElevation=!0,this._map.easeTo(q,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.l(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((s=>{delete this._frameId,this.handleEvent(new ul("renderFrame",{timeStamp:s})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ir extends l.E{constructor(s,h,_){super(),this._renderFrameCallback=()=>{const b=Math.min((at()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(b)),b<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=_.bearingSnap,this.cameraHelper=h,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(s,h){s.apply(this.transform),this.transform=s,this.cameraHelper=h}getCenter(){return new l.U(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(s,h){return this.jumpTo({elevation:s},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(s){this._centerClampedToGround=s}panBy(s,h,_){return s=l.P.convert(s).mult(-1),this.panTo(this.transform.center,l.e({offset:s},h),_)}panTo(s,h,_){return this.easeTo(l.e({center:s},h),_)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,_){return this.easeTo(l.e({zoom:s},h),_)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(s,h){return s!=this.transform.fov&&(this.transform.setFov(s),this.fire(new l.l("movestart",h)).fire(new l.l("move",h)).fire(new l.l("moveend",h))),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,_){return this.easeTo(l.e({bearing:s},h),_)}resetNorth(s,h){return this.rotateTo(0,l.e({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}getRoll(){return this.transform.roll}setRoll(s,h){return this.jumpTo({roll:s},h),this}cameraForBounds(s,h){s=wn.convert(s).adjustAntiMeridian();const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),_,h)}_cameraForBoxAndBearing(s,h,_,b){const A={top:0,bottom:0,right:0,left:0};if(typeof(b=l.e({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const z=b.padding;b.padding={top:z,bottom:z,right:z,left:z}}const M=l.e(A,b.padding);b.padding=M;const k=this.transform,O=new wn(s,h);return this.cameraHelper.cameraForBoxAndBearing(b,M,O,_,k)}fitBounds(s,h,_){return this._fitInternal(this.cameraForBounds(s,h),h,_)}fitScreenCoordinates(s,h,_,b,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(s)),this.transform.screenPointToLocation(l.P.convert(h)),_,b),b,A)}_fitInternal(s,h,_){return s?(delete(h=l.e(s,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(s,h){this.stop();const _=this._getTransformForUpdate();let b=!1,A=!1,M=!1;const k=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,s);const O=_.zoom!==k;return"elevation"in s&&_.elevation!==+s.elevation&&_.setElevation(+s.elevation),"bearing"in s&&_.bearing!==+s.bearing&&(b=!0,_.setBearing(+s.bearing)),"pitch"in s&&_.pitch!==+s.pitch&&(A=!0,_.setPitch(+s.pitch)),"roll"in s&&_.roll!==+s.roll&&(M=!0,_.setRoll(+s.roll)),s.padding==null||_.isPaddingEqual(s.padding)||_.setPadding(s.padding),this._applyUpdatedTransform(_),this.fire(new l.l("movestart",h)).fire(new l.l("move",h)),O&&this.fire(new l.l("zoomstart",h)).fire(new l.l("zoom",h)).fire(new l.l("zoomend",h)),b&&this.fire(new l.l("rotatestart",h)).fire(new l.l("rotate",h)).fire(new l.l("rotateend",h)),A&&this.fire(new l.l("pitchstart",h)).fire(new l.l("pitch",h)).fire(new l.l("pitchend",h)),M&&this.fire(new l.l("rollstart",h)).fire(new l.l("roll",h)).fire(new l.l("rollend",h)),this.fire(new l.l("moveend",h))}calculateCameraOptionsFromTo(s,h,_,b=0){const A=l.a5.fromLngLat(s,h),M=l.a5.fromLngLat(_,b),k=M.x-A.x,O=M.y-A.y,z=M.z-A.z,U=Math.hypot(k,O,z);if(U===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(k,O),H=l.ao(this.transform.cameraToCenterDistance/U/this.transform.tileSize),Y=180*Math.atan2(k,-O)/Math.PI;let et=180*Math.acos(q/U)/Math.PI;return et=z<0?90-et:90+et,{center:M.toLngLat(),elevation:b,zoom:H,pitch:et,bearing:Y}}calculateCameraOptionsFromCameraLngLatAltRotation(s,h,_,b,A){const M=this.transform.calculateCenterFromCameraLngLatAlt(s,h,_,b);return{center:M.center,elevation:M.elevation,zoom:M.zoom,bearing:_,pitch:b,roll:A}}easeTo(s,h){this._stop(!1,s.easeId),((s=l.e({offset:[0,0],duration:500,easing:l.cs},s)).animate===!1||!s.essential&&G.prefersReducedMotion)&&(s.duration=0);const _=this._getTransformForUpdate(),b=this.getBearing(),A=_.pitch,M=_.roll,k="bearing"in s?this._normalizeBearing(s.bearing,b):b,O="pitch"in s?+s.pitch:A,z="roll"in s?this._normalizeBearing(s.roll,M):M,U="padding"in s?s.padding:_.padding,q=l.P.convert(s.offset);let H,Y;s.around&&(H=l.U.convert(s.around),Y=_.locationToScreenPoint(H));const et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ot=this.cameraHelper.handleEaseTo(_,{bearing:k,pitch:O,roll:z,padding:U,around:H,aroundPoint:Y,offsetAsPoint:q,offset:s.offset,zoom:s.zoom,center:s.center});return this._rotating=this._rotating||b!==k,this._pitching=this._pitching||O!==A,this._rolling=this._rolling||z!==M,this._padding=!_.isPaddingEqual(U),this._zooming=this._zooming||ot.isZooming,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,et),this.terrain&&this._prepareElevation(ot.elevationCenter),this._ease((ct=>{ot.easeFunc(ct),this.terrain&&!s.freezeElevation&&this._updateElevation(ct),this._applyUpdatedTransform(_),this._fireMoveEvents(h)}),(ct=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(h,ct)}),s),this}_prepareEase(s,h,_={}){this._moving=!0,h||_.moving||this.fire(new l.l("movestart",s)),this._zooming&&!_.zooming&&this.fire(new l.l("zoomstart",s)),this._rotating&&!_.rotating&&this.fire(new l.l("rotatestart",s)),this._pitching&&!_.pitching&&this.fire(new l.l("pitchstart",s)),this._rolling&&!_.rolling&&this.fire(new l.l("rollstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&h!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(_-(h-(_*s+this._elevationStart))/(1-s)),this._elevationTarget=h}this.transform.setElevation(l.F.number(this._elevationStart,this._elevationTarget,s))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){if(!this.terrain&&s.elevation>=0&&s.pitch<=90)return{};const h=s.getCameraLngLat(),_=s.getCameraAltitude(),b=this.terrain?this.terrain.getElevationForLngLatZoom(h,s.zoom):0;if(_<b){const A=this.calculateCameraOptionsFromTo(h,b,s.center,s.elevation);return{pitch:A.pitch,zoom:A.zoom}}return{}}_applyUpdatedTransform(s){const h=[];if(h.push((b=>this._elevateCameraIfInsideTerrain(b))),this.transformCameraUpdate&&h.push((b=>this.transformCameraUpdate(b))),!h.length)return;const _=s.clone();for(const b of h){const A=_.clone(),{center:M,zoom:k,roll:O,pitch:z,bearing:U,elevation:q}=b(A);M&&A.setCenter(M),q!==void 0&&A.setElevation(q),k!==void 0&&A.setZoom(k),O!==void 0&&A.setRoll(O),z!==void 0&&A.setPitch(z),U!==void 0&&A.setBearing(U),_.apply(A)}this.transform.apply(_)}_fireMoveEvents(s){this.fire(new l.l("move",s)),this._zooming&&this.fire(new l.l("zoom",s)),this._rotating&&this.fire(new l.l("rotate",s)),this._pitching&&this.fire(new l.l("pitch",s)),this._rolling&&this.fire(new l.l("roll",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const _=this._zooming,b=this._rotating,A=this._pitching,M=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new l.l("zoomend",s)),b&&this.fire(new l.l("rotateend",s)),A&&this.fire(new l.l("pitchend",s)),M&&this.fire(new l.l("rollend",s)),this.fire(new l.l("moveend",s))}flyTo(s,h){if(!s.essential&&G.prefersReducedMotion){const Yt=l.S(s,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Yt,h)}this.stop(),s=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cs},s);const _=this._getTransformForUpdate(),b=_.bearing,A=_.pitch,M=_.roll,k=_.padding,O="bearing"in s?this._normalizeBearing(s.bearing,b):b,z="pitch"in s?+s.pitch:A,U="roll"in s?this._normalizeBearing(s.roll,M):M,q="padding"in s?s.padding:_.padding,H=l.P.convert(s.offset);let Y=_.centerPoint.add(H);const et=_.screenPointToLocation(Y),ot=this.cameraHelper.handleFlyTo(_,{bearing:O,pitch:z,roll:U,padding:q,locationAtOffset:et,offsetAsPoint:H,center:s.center,minZoom:s.minZoom,zoom:s.zoom});let ct=s.curve;const ht=Math.max(_.width,_.height),_t=ht/ot.scaleOfZoom,Tt=ot.pixelPathLength;typeof ot.scaleOfMinZoom=="number"&&(ct=Math.sqrt(ht/ot.scaleOfMinZoom/Tt*2));const gt=ct*ct;function St(Yt){const ve=(_t*_t-ht*ht+(Yt?-1:1)*gt*gt*Tt*Tt)/(2*(Yt?_t:ht)*gt*Tt);return Math.log(Math.sqrt(ve*ve+1)-ve)}function Et(Yt){return(Math.exp(Yt)-Math.exp(-Yt))/2}function xt(Yt){return(Math.exp(Yt)+Math.exp(-Yt))/2}const Bt=St(!1);let Gt=function(Yt){return xt(Bt)/xt(Bt+ct*Yt)},Ht=function(Yt){return ht*((xt(Bt)*(Et(ve=Bt+ct*Yt)/xt(ve))-Et(Bt))/gt)/Tt;var ve},Wt=(St(!0)-Bt)/ct;if(Math.abs(Tt)<2e-6||!isFinite(Wt)){if(Math.abs(ht-_t)<1e-6)return this.easeTo(s,h);const Yt=_t<ht?-1:1;Wt=Math.abs(Math.log(_t/ht))/ct,Ht=()=>0,Gt=ve=>Math.exp(Yt*ct*ve)}return s.duration="duration"in s?+s.duration:1e3*Wt/("screenSpeed"in s?+s.screenSpeed/ct:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=b!==O,this._pitching=z!==A,this._rolling=U!==M,this._padding=!_.isPaddingEqual(q),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ot.targetCenter),this._ease((Yt=>{const ve=Yt*Wt,Te=1/Gt(ve),ce=Ht(ve);this._rotating&&_.setBearing(l.F.number(b,O,Yt)),this._pitching&&_.setPitch(l.F.number(A,z,Yt)),this._rolling&&_.setRoll(l.F.number(M,U,Yt)),this._padding&&(_.interpolatePadding(k,q,Yt),Y=_.centerPoint.add(H)),ot.easeFunc(Yt,Te,ce,Y),this.terrain&&!s.freezeElevation&&this._updateElevation(Yt),this._applyUpdatedTransform(_),this._fireMoveEvents(h)}),(()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(h)}),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,h)}return s||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(s,h,_){_.animate===!1||_.duration===0?(s(1),h()):(this._easeStart=at(),this._easeOptions=_,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,h){s=l.V(s,-180,180);const _=Math.abs(s-h);return Math.abs(s-360-h)<_&&(s-=360),Math.abs(s+360-h)<_&&(s+=360),s}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(l.U.convert(s),this.transform.tileZoom):null}}const ls={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class In{constructor(s=ls){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=J.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=J.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=J.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){J.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const _=this._map._getUIString(`AttributionControl.${h}`);s.title=_,s.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map((b=>typeof b!="string"?"":b))):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const h=this._map.style.tileManagers;for(const b in h){const A=h[b];if(A.used||A.usedForTerrain){const M=A.getSource();M.attribution&&s.indexOf(M.attribution)<0&&s.push(M.attribution)}}s=s.filter((b=>String(b).trim())),s.sort(((b,A)=>b.length-A.length)),s=s.filter(((b,A)=>{for(let M=A+1;M<s.length;M++)if(s[M].indexOf(b)>=0)return!1;return!0}));const _=s.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,s.length?(this._innerContainer.innerHTML=J.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ja{constructor(s={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const _=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=J.create("div","maplibregl-ctrl");const h=J.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){J.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ad{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const b of _)if(b.id===s)return void(b.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var um=l.aO([{name:"a_pos3d",type:"Int16",components:3}]);class hl extends l.E{constructor(s){super(),this._lastTilesetChange=at(),this.tileManager=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=s._source.tileSize*2**this.deltaZoom,s.usedForTerrain=!0,s.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(s,h){this.tileManager.update(s,h),this._renderableTilesKeys=[];const _={};for(const b of si(s,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.tileManager._source.calculateTileZoom}))_[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.terrainRttPosMatrix32f=new Float64Array(16),l.c1(b.terrainRttPosMatrix32f,0,l.a3,l.a3,0,0,1),this._tiles[b.key]=new Q(b,this.tileSize),this._lastTilesetChange=at());for(const b in this._tiles)_[b]||delete this._tiles[b]}freeRtt(s){for(const h in this._tiles){const _=this._tiles[h];(!s||_.tileID.equals(s)||_.tileID.isChildOf(s)||s.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((s=>this.getTileByID(s)))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s,h){return h?this._getTerrainCoordsForTileRanges(s,h):this._getTerrainCoordsForRegularTile(s)}_getTerrainCoordsForRegularTile(s){const h={};for(const _ of this._renderableTilesKeys){const b=this._tiles[_].tileID,A=s.clone(),M=l.be();if(b.canonical.equals(s.canonical))l.c1(M,0,l.a3,l.a3,0,0,1);else if(b.canonical.isChildOf(s.canonical)){const k=b.canonical.z-s.canonical.z,O=b.canonical.x-(b.canonical.x>>k<<k),z=b.canonical.y-(b.canonical.y>>k<<k),U=l.a3>>k;l.c1(M,0,U,U,0,0,1),l.N(M,M,[-O*U,-z*U,0])}else{if(!s.canonical.isChildOf(b.canonical))continue;{const k=s.canonical.z-b.canonical.z,O=s.canonical.x-(s.canonical.x>>k<<k),z=s.canonical.y-(s.canonical.y>>k<<k),U=l.a3>>k;l.c1(M,0,l.a3,l.a3,0,0,1),l.N(M,M,[O*U,z*U,0]),l.O(M,M,[1/2**k,1/2**k,0])}}A.terrainRttPosMatrix32f=new Float32Array(M),h[_]=A}return h}_getTerrainCoordsForTileRanges(s,h){const _={};for(const b of this._renderableTilesKeys){const A=this._tiles[b].tileID;if(!this._isWithinTileRanges(A,h))continue;const M=s.clone(),k=l.be();if(A.canonical.z===s.canonical.z){const O=s.canonical.x-A.canonical.x,z=s.canonical.y-A.canonical.y;l.c1(k,0,l.a3,l.a3,0,0,1),l.N(k,k,[O*l.a3,z*l.a3,0])}else if(A.canonical.z>s.canonical.z){const O=A.canonical.z-s.canonical.z,z=A.canonical.x-(A.canonical.x>>O<<O),U=A.canonical.y-(A.canonical.y>>O<<O),q=s.canonical.x-(A.canonical.x>>O),H=s.canonical.y-(A.canonical.y>>O),Y=l.a3>>O;l.c1(k,0,Y,Y,0,0,1),l.N(k,k,[-z*Y+q*l.a3,-U*Y+H*l.a3,0])}else{const O=s.canonical.z-A.canonical.z,z=s.canonical.x-(s.canonical.x>>O<<O),U=s.canonical.y-(s.canonical.y>>O<<O),q=(s.canonical.x>>O)-A.canonical.x,H=(s.canonical.y>>O)-A.canonical.y,Y=l.a3<<O;l.c1(k,0,Y,Y,0,0,1),l.N(k,k,[z*l.a3+q*Y,U*l.a3+H*Y,0])}M.terrainRttPosMatrix32f=new Float32Array(k),_[b]=M}return _}getSourceTile(s,h){const _=this.tileManager._source;let b=s.overscaledZ-this.deltaZoom;if(b>_.maxzoom&&(b=_.maxzoom),b<_.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(b).key);let A=this.tileManager.getTileByID(this._sourceTileCache[s.key]);if((!A||!A.dem)&&h)for(;b>=_.minzoom&&(!A||!A.dem);)A=this.tileManager.getTileByID(s.scaledTo(b--).key);return A}anyTilesAfterTime(s=Date.now()){return this._lastTilesetChange>=s}_isWithinTileRanges(s,h){return h[s.canonical.z]&&s.canonical.x>=h[s.canonical.z].minTileX&&s.canonical.x<=h[s.canonical.z].maxTileX&&s.canonical.y>=h[s.canonical.z].minTileY&&s.canonical.y<=h[s.canonical.z].maxTileY}}class Dr{constructor(s,h,_){this._meshCache={},this.painter=s,this.tileManager=new hl(h),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,h,_,b=l.a3){var A;if(!(h>=0&&h<b&&_>=0&&_<b))return 0;const M=this.getTerrainData(s),k=(A=M.tile)===null||A===void 0?void 0:A.dem;if(!k)return 0;const O=l.cw([],[h/b*l.a3,_/b*l.a3],M.u_terrain_matrix),z=[O[0]*k.dim,O[1]*k.dim],U=Math.floor(z[0]),q=Math.floor(z[1]),H=z[0]-U,Y=z[1]-q;return k.get(U,q)*(1-H)*(1-Y)+k.get(U+1,q)*H*(1-Y)+k.get(U,q+1)*(1-H)*Y+k.get(U+1,q+1)*H*Y}getElevationForLngLatZoom(s,h){if(!l.cx(h,s.wrap()))return 0;const{tileID:_,mercatorX:b,mercatorY:A}=this._getOverscaledTileIDFromLngLatZoom(s,h);return this.getElevation(_,b%l.a3,A%l.a3,l.a3)}getElevation(s,h,_,b=l.a3){return this.getDEMElevation(s,h,_,b)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const b=this.painter.context,A=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(b,A,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(b,new l.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.am([])}const h=this.tileManager.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const b=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new l.T(b,h.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),h.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const _=h&&h+h.tileID.key+s.key;if(_&&!this._demMatrixCache[_]){const b=this.tileManager.getSource().maxzoom;let A=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=b?A=s.canonical.z-b:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=s.canonical.x-(s.canonical.x>>A<<A),k=s.canonical.y-(s.canonical.y>>A<<A),O=l.cy(new Float64Array(16),[1/(l.a3<<A),1/(l.a3<<A),0]);l.N(O,O,[M*l.a3,k*l.a3,0]),this._demMatrixCache[s.key]={matrix:O,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(s){const h=this.painter,_=h.width/devicePixelRatio,b=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(h.context,{width:_,height:b,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(h.context,{width:_,height:b,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(_,b,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,_,b))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,M=0;A<this._coordsTextureSize;A++)for(let k=0;k<this._coordsTextureSize;k++,M+=4)h[M+0]=255&k,h[M+1]=255&A,h[M+2]=k>>8<<4|A>>8,h[M+3]=0;const _=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),b=new l.T(s,_,s.gl.RGBA,{premultiply:!1});return b.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),_=this.painter.context,b=_.gl,A=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(A,k-M-1,1,1,b.RGBA,b.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const O=h[0]+(h[2]>>4<<8),z=h[1]+((15&h[2])<<8),U=this.coordsIndex[255-h[3]],q=U&&this.tileManager.getTileByID(U);if(!q)return null;const H=this._coordsTextureSize,Y=(1<<q.tileID.canonical.z)*H;return new l.a5((q.tileID.canonical.x*H+O)/Y+q.tileID.wrap,(q.tileID.canonical.y*H+z)/Y,this.getElevation(q.tileID,O,z,H))}depthAtPoint(s){const h=new Uint8Array(4),_=this.painter.context,b=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(s){var h;const _=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,b=_&&s.canonical.y===0,A=_&&s.canonical.y===(1<<s.canonical.z)-1,M=`m_${b?"n":""}_${A?"s":""}`;if(this._meshCache[M])return this._meshCache[M];const k=this.painter.context,O=new l.cz,z=new l.aS,U=this.meshSize,q=l.a3/U,H=U*U;for(let xt=0;xt<=U;xt++)for(let Bt=0;Bt<=U;Bt++)O.emplaceBack(Bt*q,xt*q,0);for(let xt=0;xt<H;xt+=U+1)for(let Bt=0;Bt<U;Bt++)z.emplaceBack(Bt+xt,U+Bt+xt+1,U+Bt+xt+2),z.emplaceBack(Bt+xt,U+Bt+xt+2,Bt+xt+1);const Y=O.length,et=Y+(U+1),ot=(U+1)*U,ct=b?l.bl:0,ht=b?0:1,_t=A?l.bm:l.a3,Tt=A?0:1;for(let xt=0;xt<=U;xt++)O.emplaceBack(xt*q,ct,ht);for(let xt=0;xt<=U;xt++)O.emplaceBack(xt*q,_t,Tt);for(let xt=0;xt<U;xt++)z.emplaceBack(ot+xt,et+xt,et+xt+1),z.emplaceBack(ot+xt,et+xt+1,ot+xt+1),z.emplaceBack(0+xt,Y+xt+1,Y+xt),z.emplaceBack(0+xt,0+xt+1,Y+xt+1);const gt=O.length,St=gt+2*(U+1);for(const xt of[0,1])for(let Bt=0;Bt<=U;Bt++)for(const Gt of[0,1])O.emplaceBack(xt*l.a3,Bt*q,Gt);for(let xt=0;xt<2*U;xt+=2)z.emplaceBack(gt+xt,gt+xt+1,gt+xt+3),z.emplaceBack(gt+xt,gt+xt+3,gt+xt+2),z.emplaceBack(St+xt,St+xt+3,St+xt+1),z.emplaceBack(St+xt,St+xt+2,St+xt+3);const Et=new La(k.createVertexBuffer(O,um.members),k.createIndexBuffer(z),l.aR.simpleSegment(0,0,O.length,z.length));return this._meshCache[M]=Et,Et}getMeshFrameDelta(s){return 2*Math.PI*l.by/Math.pow(2,Math.max(s,0))/5}getMinTileElevationForLngLatZoom(s,h){var _;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(s,h);return(_=this.getMinMaxElevation(b).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,_={minElevation:null,maxElevation:null};return h&&h.dem&&(_.minElevation=h.dem.min*this.exaggeration,_.maxElevation=h.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(s,h){const _=l.a5.fromLngLat(s.wrap()),b=(1<<h)*l.a3,A=_.x*b,M=_.y*b,k=Math.floor(A/l.a3),O=Math.floor(M/l.a3);return{tileID:new l.a0(h,0,h,k,O),mercatorX:A,mercatorY:M}}}class fi{constructor(s,h,_){this._context=s,this._size=h,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(_.texture),{id:s,fbo:h,texture:_,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((h=>s.id!==h)),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((s=>!s.inUse))===!1}}const Wi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class to{constructor(s,h){this.painter=s,this.terrain=h,this.pool=new fi(s.context,30,h.tileManager.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=s._order.filter((_=>!s._layers[_].isHidden(h))),this._coordsAscending={};for(const _ in s.tileManagers){this._coordsAscending[_]={};const b=s.tileManagers[_].getVisibleCoordinates(),A=s.tileManagers[_].getSource(),M=A instanceof _s?A.terrainTileRanges:null;for(const k of b){const O=this.terrain.tileManager.getTerrainCoords(k,M);for(const z in O)this._coordsAscending[_][z]||(this._coordsAscending[_][z]=[]),this._coordsAscending[_][z].push(O[z])}}this._coordsAscendingStr={};for(const _ of s._order){const b=s._layers[_],A=b.source;if(Wi[b.type]&&!this._coordsAscendingStr[A]){this._coordsAscendingStr[A]={};for(const M in this._coordsAscending[A])this._coordsAscendingStr[A][M]=this._coordsAscending[A][M].map((k=>k.key)).sort().join()}}for(const _ of this._renderableTiles)for(const b in this._coordsAscendingStr){const A=this._coordsAscendingStr[b][_.tileID.key];A&&A!==_.rttCoords[b]&&(_.rtt=[])}}renderLayer(s,h){if(s.isHidden(this.painter.transform.zoom))return!1;const _=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),b=s.type,A=this.painter,M=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(Wi[b]&&(this._prevType&&Wi[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(s.id),!M))return!0;if(Wi[this._prevType]||Wi[b]&&M){this._prevType=b;const k=this._stacks.length-1,O=this._stacks[k]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(Xa(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[k]){const q=this.pool.getObjectForId(z.rtt[k].id);if(q.stamp===z.rtt[k].stamp){this.pool.useObject(q);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),z.rtt[k]={id:U.id,stamp:U.stamp},A.context.bindFramebuffer.set(U.fbo.framebuffer),A.context.clear({color:l.bj.transparent,stencil:0}),A.currentStencilSource=void 0;for(let q=0;q<O.length;q++){const H=A.style._layers[O[q]],Y=H.source?this._coordsAscending[H.source][z.tileID.key]:[z.tileID];A.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),A._renderTileClippingMasks(H,Y,!0),A.renderLayer(A,A.style.tileManagers[H.source],H,Y,_),H.source&&(z.rttCoords[H.source]=this._coordsAscendingStr[H.source][z.tileID.key])}}return Xa(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),Wi[b]}return!1}}const ci={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Vi=w,Dn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ls,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},eu={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class fl{constructor(s,h,_=!1){this.mousedown=A=>{this.startMove(A,J.mousePos(this.element,A)),J.addEventListener(window,"mousemove",this.mousemove),J.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.move(A,J.mousePos(this.element,A))},this.mouseup=A=>{this._rotatePitchHandler.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=J.touchPos(this.element,A.targetTouches)[0],this.startMove(A,this._startPos),J.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=J.touchPos(this.element,A.targetTouches)[0],this.move(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const b=new rc;this._rotatePitchHandler=new ga({clickTolerance:3,move:(A,M)=>{const k=h.getBoundingClientRect(),O=new l.P((k.bottom-k.top)/2,(k.right-k.left)/2);return{bearingDelta:l.cr(new l.P(A.x,M.y),M,O),pitchDelta:_?-.5*(M.y-A.y):void 0}},moveStateManager:b,enable:!0,assignEvents:()=>{}}),this.map=s,J.addEventListener(h,"mousedown",this.mousedown),J.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),J.addEventListener(h,"touchcancel",this.reset)}startMove(s,h){this._rotatePitchHandler.dragStart(s,h),J.disableDrag()}move(s,h){const _=this.map,{bearingDelta:b,pitchDelta:A}=this._rotatePitchHandler.dragMove(s,h)||{};b&&_.setBearing(_.getBearing()+b),A&&_.setPitch(_.getPitch()+A)}off(){const s=this.element;J.removeEventListener(s,"mousedown",this.mousedown),J.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),J.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.removeEventListener(window,"touchend",this.touchend),J.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){J.enableDrag(),J.removeEventListener(window,"mousemove",this.mousemove),J.removeEventListener(window,"mouseup",this.mouseup),J.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.removeEventListener(window,"touchend",this.touchend)}}let kr;function oc(T,s,h,_=!1){if(_||!h.getCoveringTilesDetailsProvider().allowWorldCopies())return T?.wrap();const b=new l.U(T.lng,T.lat);if(T=new l.U(T.lng,T.lat),s){const A=new l.U(T.lng-360,T.lat),M=new l.U(T.lng+360,T.lat),k=h.locationToScreenPoint(T).distSqr(s);h.locationToScreenPoint(A).distSqr(s)<k?T=A:h.locationToScreenPoint(M).distSqr(s)<k&&(T=M)}for(;Math.abs(T.lng-h.center.lng)>180;){const A=h.locationToScreenPoint(T);if(A.x>=0&&A.y>=0&&A.x<=h.width&&A.y<=h.height)break;T.lng>h.center.lng?T.lng-=360:T.lng+=360}return T.lng!==b.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(T))?T:b}const bo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xo(T,s,h){const _=T.classList;for(const b in bo)_.remove(`maplibregl-${h}-anchor-${b}`);_.add(`maplibregl-${h}-anchor-${s}`)}class eh extends l.E{constructor(s){if(super(),this._onKeyPress=h=>{const _=h.code,b=h.charCode||h.keyCode;_!=="Space"&&_!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=h=>{const _=h.originalEvent.target,b=this._element;this._popup&&(_===b||b.contains(_))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();(h?.type==="terrain"||h?.type==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=oc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),J.setTransform(this._element,`${bo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${b}`),G.frameAsync(new AbortController).then((()=>{this._updateOpacity(h&&h.type==="moveend")})).catch((()=>{}))},this._onMove=h=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(s?.opacity,s?.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=l.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=J.create("div");const h=J.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${_}px`),h.setAttributeNS(null,"width",`${b}px`),h.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const A=J.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const M=J.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const k=J.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ht of O){const _t=J.createNS("http://www.w3.org/2000/svg","ellipse");_t.setAttributeNS(null,"opacity","0.04"),_t.setAttributeNS(null,"cx","10.5"),_t.setAttributeNS(null,"cy","5.80029008"),_t.setAttributeNS(null,"rx",ht.rx),_t.setAttributeNS(null,"ry",ht.ry),k.appendChild(_t)}const z=J.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const U=J.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(U);const q=J.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const H=J.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(H);const Y=J.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const et=J.createNS("http://www.w3.org/2000/svg","g");et.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ot=J.createNS("http://www.w3.org/2000/svg","circle");ot.setAttributeNS(null,"fill","#000000"),ot.setAttributeNS(null,"opacity","0.25"),ot.setAttributeNS(null,"cx","5.5"),ot.setAttributeNS(null,"cy","5.5"),ot.setAttributeNS(null,"r","5.4999962");const ct=J.createNS("http://www.w3.org/2000/svg","circle");ct.setAttributeNS(null,"fill","#FFFFFF"),ct.setAttributeNS(null,"cx","5.5"),ct.setAttributeNS(null,"cy","5.5"),ct.setAttributeNS(null,"r","5.4999962"),et.appendChild(ot),et.appendChild(ct),M.appendChild(k),M.appendChild(z),M.appendChild(q),M.appendChild(Y),M.appendChild(et),h.appendChild(M),h.setAttributeNS(null,"height",_*this._scale+"px"),h.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(h),this._offset=l.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(h=>{h.preventDefault()})),this._element.addEventListener("mousedown",(h=>{h.preventDefault()})),xo(this._element,this._anchor,"marker"),s&&s.className)for(const h of s.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),s.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),J.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.U.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const b=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var h,_;const b=(h=this._map)===null||h===void 0?void 0:h.terrain,A=this._map.transform.isLocationOccluded(this._lngLat);if(!b||A){const Y=A?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Y&&(this._element.style.opacity=Y))}if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const M=this._map,k=M.terrain.depthAtPoint(this._pos),O=M.terrain.getElevationForLngLatZoom(this._lngLat,M.transform.tileZoom);if(M.transform.lngLatToCameraDepth(this._lngLat,O)-k<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/M.transform.pixelsPerMeter,U=Math.sin(M.getPitch()*Math.PI/180)*z,q=M.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),H=M.transform.lngLatToCameraDepth(this._lngLat,O+U)-q>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=l.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,h){return(this._opacity===void 0||s===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Tn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let dl=0,wo=!1;const pf={maxWidth:100,unit:"metric"};function ih(T,s,h){const _=h&&h.maxWidth||100,b=T._container.clientHeight/2,A=T._container.clientWidth/2,M=T.unproject([A-_/2,b]),k=T.unproject([A+_/2,b]),O=Math.round(T.project(k).x-T.project(M).x),z=Math.min(_,O,T._container.clientWidth),U=M.distanceTo(k);if(h&&h.unit==="imperial"){const q=3.2808*U;q>5280?pl(s,z,q/5280,T._getUIString("ScaleControl.Miles")):pl(s,z,q,T._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?pl(s,z,U/1852,T._getUIString("ScaleControl.NauticalMiles")):U>=1e3?pl(s,z,U/1e3,T._getUIString("ScaleControl.Kilometers")):pl(s,z,U,T._getUIString("ScaleControl.Meters"))}function pl(T,s,h,_){const b=(function(A){const M=Math.pow(10,`${Math.floor(A)}`.length-1);let k=A/M;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:(function(O){const z=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*z)/z})(k),M*k})(h);T.style.width=s*(b/h)+"px",T.innerHTML=`${b}&nbsp;${_}`}const nh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},rh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lc(T){if(T){if(typeof T=="number"){const s=Math.round(Math.abs(T)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,T),"top-left":new l.P(s,s),"top-right":new l.P(-s,s),bottom:new l.P(0,-T),"bottom-left":new l.P(s,-s),"bottom-right":new l.P(-s,-s),left:new l.P(T,0),right:new l.P(-T,0)}}if(T instanceof l.P||Array.isArray(T)){const s=l.P.convert(T);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.P.convert(T.center||[0,0]),top:l.P.convert(T.top||[0,0]),"top-left":l.P.convert(T["top-left"]||[0,0]),"top-right":l.P.convert(T["top-right"]||[0,0]),bottom:l.P.convert(T.bottom||[0,0]),"bottom-left":l.P.convert(T["bottom-left"]||[0,0]),"bottom-right":l.P.convert(T["bottom-right"]||[0,0]),left:l.P.convert(T.left||[0,0]),right:l.P.convert(T.right||[0,0])}}return lc(new l.P(0,0))}const Or=w;m.AJAXError=l.cD,m.Event=l.l,m.Evented=l.E,m.LngLat=l.U,m.MercatorCoordinate=l.a5,m.Point=l.P,m.addProtocol=l.cE,m.config=l.a,m.removeProtocol=l.cF,m.AttributionControl=In,m.BoxZoomHandler=Sd,m.CanvasSource=Oc,m.CooperativeGesturesHandler=ze,m.DoubleClickZoomHandler=ac,m.DragPanHandler=Qc,m.DragRotateHandler=os,m.EdgeInsets=Zi,m.FullscreenControl=class extends l.E{constructor(T={}){super(),this._onFullscreenChange=()=>{var s;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=h?.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,T&&T.container&&(T.container instanceof HTMLElement?this._container=T.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(T){return this._map=T,this._container||(this._container=this._map.getContainer()),this._controlContainer=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){J.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const T=this._fullscreenButton=J.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);J.create("span","maplibregl-ctrl-icon",T).setAttribute("aria-hidden","true"),T.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const T=this._getTitle();this._fullscreenButton.setAttribute("aria-label",T),this._fullscreenButton.title=T}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=or,m.GeolocateControl=class extends l.E{constructor(T){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",s)),this._finish()}},this._updateCamera=s=>{const h=new l.U(s.coords.longitude,s.coords.latitude),_=s.coords.accuracy,b=this._map.getBearing(),A=l.e({bearing:b},this.options.fitBoundsOptions),M=wn.fromLngLat(h,_);this._map.fitBounds(M,A,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const h=new l.U(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=s.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=s=>{if(this._map){if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&wo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this._geolocateButton=J.create("button","maplibregl-ctrl-geolocate",this._container),J.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=J.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new eh({element:this._dotElement}),this._circleElement=J.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new eh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(h=>{const _=h?.[0]instanceof ResizeObserverEntry;h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||_||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},Tn,T)}onAdd(T){return this._map=T,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(s=!1){if(kr!==void 0&&!s)return kr;if(window.navigator.permissions===void 0)return kr=!!window.navigator.geolocation,kr;try{kr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{kr=!!window.navigator.geolocation}return kr}))})().then((s=>this._finishSetupUI(s))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),J.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,dl=0,wo=!1}_isOutOfMapMaxBounds(T){const s=this._map.getMaxBounds(),h=T.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const T=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&T))return;const s=this._map.project(T),h=this._map.unproject([s.x+100,s.y]),_=T.distanceTo(h)/100,b=2*this._accuracy/_;this._circleElement.style.width=`${b.toFixed(2)}px`,this._circleElement.style.height=`${b.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":dl--,wo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let T;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),dl++,dl>1?(T={maximumAge:6e5,timeout:0},wo=!0):(T=this.options.positionOptions,wo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,T)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.GlobeControl=class{constructor(){this._toggleProjection=()=>{var T;const s=(T=this._map.getProjection())===null||T===void 0?void 0:T.type;this._map.setProjection(s!=="mercator"&&s?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var T;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((T=this._map.getProjection())===null||T===void 0?void 0:T.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(T){return this._map=T,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=J.create("button","maplibregl-ctrl-globe",this._container),J.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){J.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},m.Hash=cr,m.ImageSource=_s,m.KeyboardHandler=jr,m.LngLatBounds=wn,m.LogoControl=Ja,m.Map=class extends Ir{constructor(T){var s,h;l.cA.mark(l.cB.create);const _=Object.assign(Object.assign(Object.assign({},Dn),T),{canvasContextAttributes:Object.assign(Object.assign({},Dn.canvasContextAttributes),T.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const b=new nn,A=new Er;if(_.minZoom!==void 0&&b.setMinZoom(_.minZoom),_.maxZoom!==void 0&&b.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&b.setMinPitch(_.minPitch),_.maxPitch!==void 0&&b.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&b.setRenderWorldCopies(_.renderWorldCopies),_.transformConstrain!==null&&b.setConstrainOverride(_.transformConstrain),super(b,A,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ad,this._controls=[],this._mapId=l.ab(),this._lostContextStyle={style:null,images:null},this._contextLost=k=>{k.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const O of Object.values(this.style._layers))if(O.type==="custom"&&console.warn(`Custom layer with id '${O.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),O._listeners)for(const[z]of Object.entries(O._listeners))console.warn(`Custom layer with id '${O.id}' had event listeners for event '${z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:k}))},this._contextRestored=k=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:k}))},this._onMapScroll=k=>{if(k.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ci),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this._zoomLevelsToOverscale=_.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=_.transformCameraUpdate,this.transformConstrain=_.transformConstrain,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,_.reduceMotion!==void 0&&(G.prefersReducedMotion=_.reduceMotion),this._imageQueueHandle=ae.addThrottleControl((()=>this.isMoving())),this._requestManager=new qt(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let k=!1;const O=yo((z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((z=>{k?O(z):k=!0})),this._resizeObserver.observe(this._container)}this.handlers=new tu(this,_),this._hash=_.hash&&new cr(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,l.e({},_.fitBoundsOptions,{duration:0}))));const M=typeof _.style=="string"||((h=(s=_.style)===null||s===void 0?void 0:s.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,M),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new In(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Ja,_.logoPosition),this.on("style.load",(()=>{if(M||this._resizeTransform(),this.transform.unmodified){const k=l.S(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(k)}})),this.on("data",(k=>{this._update(k.dataType==="style"),this.fire(new l.l(`${k.dataType}data`,k))})),this.on("dataloading",(k=>{this.fire(new l.l(`${k.dataType}dataloading`,k))})),this.on("dataabort",(k=>{this.fire(new l.l("sourcedataabort",k))}))}_getMapId(){return this._mapId}setGlobalStateProperty(T,s){return this.style.setGlobalStateProperty(T,s),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(T,s){if(s===void 0&&(s=T.getDefaultPosition?T.getDefaultPosition():"top-right"),!T||!T.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=T.onAdd(this);this._controls.push(T);const _=this._controlPositions[s];return s.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(T){if(!T||!T.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(T);return s>-1&&this._controls.splice(s,1),T.onRemove(this),this}hasControl(T){return this._controls.indexOf(T)>-1}coveringTiles(T){return si(this.transform,T)}calculateCameraOptionsFromTo(T,s,h,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(T,s,h,_)}resize(T,s=!0){const[h,_]=this._containerDimensions(),b=this._getClampedPixelRatio(h,_);if(this._resizeCanvas(h,_,b),this.painter.resize(h,_,b),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const k=this._getClampedPixelRatio(h,_);this._resizeCanvas(h,_,k),this.painter.resize(h,_,k)}this._resizeTransform(s);const A=!this._moving;return A&&(this.stop(),this.fire(new l.l("movestart",T)).fire(new l.l("move",T))),this.fire(new l.l("resize",T)),A&&this.fire(new l.l("moveend",T)),this}_resizeTransform(T=!0){var s;const[h,_]=this._containerDimensions();this.transform.resize(h,_,T),(s=this._requestedCameraState)===null||s===void 0||s.resize(h,_,T)}_getClampedPixelRatio(T,s){const{0:h,1:_}=this._maxCanvasSize,b=this.getPixelRatio(),A=T*b,M=s*b;return Math.min(A>h?h/A:1,M>_?_/M:1)*b}getPixelRatio(){var T;return(T=this._overridePixelRatio)!==null&&T!==void 0?T:devicePixelRatio}setPixelRatio(T){this._overridePixelRatio=T,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(T){return this.transform.setMaxBounds(wn.convert(T)),this._update()}setMinZoom(T){if((T=T??-2)>=-2&&T<=this.transform.maxZoom)return this.transform.setMinZoom(T),this._update(),this.getZoom()<T&&this.setZoom(T),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(T){if((T=T??22)>=this.transform.minZoom)return this.transform.setMaxZoom(T),this._update(),this.getZoom()>T&&this.setZoom(T),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(T){if((T=T??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(T>=0&&T<=this.transform.maxPitch)return this.transform.setMinPitch(T),this._update(),this.getPitch()<T&&this.setPitch(T),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(T){if((T=T??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(T>=this.transform.minPitch)return this.transform.setMaxPitch(T),this._update(),this.getPitch()>T&&this.setPitch(T),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(T){return this.transform.setRenderWorldCopies(T),this._update()}setTransformConstrain(T){return this.transform.setConstrainOverride(T),this._update()}project(T){return this.transform.locationToScreenPoint(l.U.convert(T),this.style&&this.terrain)}unproject(T){return this.transform.screenPointToLocation(l.P.convert(T),this.terrain)}isMoving(){var T;return this._moving||((T=this.handlers)===null||T===void 0?void 0:T.isMoving())}isZooming(){var T;return this._zooming||((T=this.handlers)===null||T===void 0?void 0:T.isZooming())}isRotating(){var T;return this._rotating||((T=this.handlers)===null||T===void 0?void 0:T.isRotating())}_createDelegatedListener(T,s,h){if(T==="mouseenter"||T==="mouseover"){let _=!1;return{layers:s,listener:h,delegates:{mousemove:A=>{const M=s.filter((O=>this.getLayer(O))),k=M.length!==0?this.queryRenderedFeatures(A.point,{layers:M}):[];k.length?_||(_=!0,h.call(this,new bn(T,this,A.originalEvent,{features:k}))):_=!1},mouseout:()=>{_=!1}}}}if(T==="mouseleave"||T==="mouseout"){let _=!1;return{layers:s,listener:h,delegates:{mousemove:M=>{const k=s.filter((O=>this.getLayer(O)));(k.length!==0?this.queryRenderedFeatures(M.point,{layers:k}):[]).length?_=!0:_&&(_=!1,h.call(this,new bn(T,this,M.originalEvent)))},mouseout:M=>{_&&(_=!1,h.call(this,new bn(T,this,M.originalEvent)))}}}}{const _=b=>{const A=s.filter((k=>this.getLayer(k))),M=A.length!==0?this.queryRenderedFeatures(b.point,{layers:A}):[];M.length&&(b.features=M,h.call(this,b),delete b.features)};return{layers:s,listener:h,delegates:{[T]:_}}}}_saveDelegatedListener(T,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[T]=this._delegatedListeners[T]||[],this._delegatedListeners[T].push(s)}_removeDelegatedListener(T,s,h){if(!this._delegatedListeners||!this._delegatedListeners[T])return;const _=this._delegatedListeners[T];for(let b=0;b<_.length;b++){const A=_[b];if(A.listener===h&&A.layers.length===s.length&&A.layers.every((M=>s.includes(M)))){for(const M in A.delegates)this.off(M,A.delegates[M]);return void _.splice(b,1)}}}on(T,s,h){if(h===void 0)return super.on(T,s);const _=typeof s=="string"?[s]:s,b=this._createDelegatedListener(T,_,h);this._saveDelegatedListener(T,b);for(const A in b.delegates)this.on(A,b.delegates[A]);return{unsubscribe:()=>{this._removeDelegatedListener(T,_,h)}}}once(T,s,h){if(h===void 0)return super.once(T,s);const _=typeof s=="string"?[s]:s,b=this._createDelegatedListener(T,_,h);for(const A in b.delegates){const M=b.delegates[A];b.delegates[A]=(...k)=>{this._removeDelegatedListener(T,_,h),M(...k)}}this._saveDelegatedListener(T,b);for(const A in b.delegates)this.once(A,b.delegates[A]);return this}off(T,s,h){return h===void 0?super.off(T,s):(this._removeDelegatedListener(T,typeof s=="string"?[s]:s,h),this)}queryRenderedFeatures(T,s){if(!this.style)return[];let h;const _=T instanceof l.P||Array.isArray(T),b=_?T:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(_?{}:T)||{},b instanceof l.P||typeof b[0]=="number")h=[l.P.convert(b)];else{const A=l.P.convert(b[0]),M=l.P.convert(b[1]);h=[A,new l.P(M.x,A.y),M,new l.P(A.x,M.y),A]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(T,s){return this.style.querySourceFeatures(T,s)}setStyle(T,s){return(s=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&T?(this._diffStyle(T,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(T,s))}setTransformRequest(T){return this._requestManager.setTransformRequest(T),this}_getUIString(T){const s=this._locale[T];if(s==null)throw new Error(`Missing UI string '${T}'`);return s}_updateStyle(T,s){var h,_;if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(T,s)));const b=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!T)),T?(this.style=new Bu(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof T=="string"?this.style.loadURL(T,s,b):this.style.loadJSON(T,s,b),this):((_=(h=this.style)===null||h===void 0?void 0:h.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Bu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(T,s){if(typeof T=="string"){const h=this._requestManager.transformRequest(T,"Style");l.j(h,new AbortController).then((_=>{this._updateDiff(_.data,s)})).catch((_=>{_&&this.fire(new l.k(_))}))}else typeof T=="object"&&this._updateDiff(T,s)}_updateDiff(T,s){try{this.style.setState(T,s)&&this._update(!0)}catch(h){l.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(T,s)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(T,s){return this._lazyInitEmptyStyle(),this.style.addSource(T,s),this._update(!0)}isSourceLoaded(T){const s=this.style&&this.style.tileManagers[T];if(s!==void 0)return s.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${T}'`)))}setTerrain(T){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),T){const s=this.style.tileManagers[T.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${T.source}`);this.terrain===null&&s.reload();for(const h in this.style._layers){const _=this.style._layers[h];_.type==="hillshade"&&_.source===T.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),_.type==="color-relief"&&_.source===T.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Dr(this.painter,s,T),this.painter.renderToTexture=new to(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{var _;h.dataType==="style"?this.terrain.tileManager.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==T.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=h.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:T})),this}getTerrain(){var T,s;return(s=(T=this.terrain)===null||T===void 0?void 0:T.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const T=this.style&&this.style.tileManagers;for(const s in T){const h=T[s]._tiles;for(const _ in h){const b=h[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(T){return this.style.removeSource(T),this._update(!0)}getSource(T){return this.style.getSource(T)}setSourceTileLodParams(T,s,h){if(h){const _=this.getSource(h);if(!_)throw new Error(`There is no source with ID "${h}", cannot set LOD parameters`);_.calculateTileZoom=ie(Math.max(1,T),Math.max(1,s))}else for(const _ in this.style.tileManagers)this.style.tileManagers[_].getSource().calculateTileZoom=ie(Math.max(1,T),Math.max(1,s));return this._update(!0),this}refreshTiles(T,s){const h=this.style.tileManagers[T];if(!h)throw new Error(`There is no tile manager with ID "${T}", cannot refresh tile`);s===void 0?h.reload(!0):h.refreshTiles(s.map((_=>new l.a8(_.z,_.x,_.y))))}addImage(T,s,h={}){const{pixelRatio:_=1,sdf:b=!1,stretchX:A,stretchY:M,content:k,textFitWidth:O,textFitHeight:z}=h;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||l.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:q,data:H}=s,Y=s;return this.style.addImage(T,{data:new l.R({width:U,height:q},new Uint8Array(H)),pixelRatio:_,stretchX:A,stretchY:M,content:k,textFitWidth:O,textFitHeight:z,sdf:b,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,T),this}}{const{width:U,height:q,data:H}=G.getImageData(s);this.style.addImage(T,{data:new l.R({width:U,height:q},H),pixelRatio:_,stretchX:A,stretchY:M,content:k,textFitWidth:O,textFitHeight:z,sdf:b,version:0})}}updateImage(T,s){const h=this.style.getImage(T);if(!h)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=s instanceof HTMLImageElement||l.b(s)?G.getImageData(s):s,{width:b,height:A,data:M}=_;if(b===void 0||A===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==h.data.width||A!==h.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(s instanceof HTMLImageElement||l.b(s));return h.data.replace(M,k),this.style.updateImage(T,h),this}getImage(T){return this.style.getImage(T)}hasImage(T){return T?!!this.style.getImage(T):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(T){this.style.removeImage(T)}loadImage(T){return ae.getImage(this._requestManager.transformRequest(T,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(T,s){return this._lazyInitEmptyStyle(),this.style.addLayer(T,s),this._update(!0)}moveLayer(T,s){return this.style.moveLayer(T,s),this._update(!0)}removeLayer(T){return this.style.removeLayer(T),this._update(!0)}getLayer(T){return this.style.getLayer(T)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(T,s,h){return this.style.setLayerZoomRange(T,s,h),this._update(!0)}setFilter(T,s,h={}){return this.style.setFilter(T,s,h),this._update(!0)}getFilter(T){return this.style.getFilter(T)}setPaintProperty(T,s,h,_={}){return this.style.setPaintProperty(T,s,h,_),this._update(!0)}getPaintProperty(T,s){return this.style.getPaintProperty(T,s)}setLayoutProperty(T,s,h,_={}){return this.style.setLayoutProperty(T,s,h,_),this._update(!0)}getLayoutProperty(T,s){return this.style.getLayoutProperty(T,s)}setGlyphs(T,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(T,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(T,s,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(T,s,h,(_=>{_||this._update(!0)})),this}removeSprite(T){return this._lazyInitEmptyStyle(),this.style.removeSprite(T),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(T,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(T,s,(h=>{h||this._update(!0)})),this}setLight(T,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(T,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(T,s={}){return this._lazyInitEmptyStyle(),this.style.setSky(T,s),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(T,s){return this.style.setFeatureState(T,s),this._update()}removeFeatureState(T,s){return this.style.removeFeatureState(T,s),this._update()}getFeatureState(T){return this.style.getFeatureState(T)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let T=0,s=0;return this._container&&(T=this._container.clientWidth||400,s=this._container.clientHeight||300),[T,s]}_setupContainer(){const T=this._container;T.classList.add("maplibregl-map");const s=this._canvasContainer=J.create("div","maplibregl-canvas-container",T);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=J.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),_=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],_);const b=this._controlContainer=J.create("div","maplibregl-control-container",T),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((M=>{A[M]=J.create("div",`maplibregl-ctrl-${M} `,b)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(T,s,h){this._canvas.width=Math.floor(h*T),this._canvas.height=Math.floor(h*s),this._canvas.style.width=`${T}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const T=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let s=null;this._canvas.addEventListener("webglcontextcreationerror",(_=>{s={requestedAttributes:T},_&&(s.statusMessage=_.statusMessage,s.type=_.type)}),{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,T):this._canvas.getContext("webgl2",T)||this._canvas.getContext("webgl",T),!h){const _="Failed to initialize WebGL";throw s?(s.message=_,new Error(JSON.stringify(s))):new Error(_)}this.painter=new Xu(h,this.transform),mt.testSupport(h)}migrateProjection(T,s){super.migrateProjection(T,s),this.painter.transform=T,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(T){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||T,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(T){return this._update(),this._renderTaskQueue.add(T)}_cancelRenderFrame(T){this._renderTaskQueue.remove(T)}_render(T){var s,h,_,b,A;const M=this._idleTriggered?this._fadeDuration:0,k=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(T),this._removed)return;let O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const q=this.transform.zoom,H=at();this.style.zoomHistory.update(q,H);const Y=new l.G(q,{now:H,fadeDuration:M,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),et=Y.crossFadingFactor();et===1&&et===this._crossFadingFactor||(O=!0,this._crossFadingFactor=et),this.style.update(Y)}const z=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==k;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((b=this.style.projection)===null||b===void 0?void 0:b.transitionState,(A=this.style.projection)===null||A===void 0?void 0:A.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cA.mark(l.cB.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,l.cA.mark(l.cB.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var T;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ae.removeThrottleControl(this._imageQueueHandle),(T=this._resizeObserver)===null||T===void 0||T.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s?.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),J.remove(this._canvasContainer),J.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cA.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,G.frame(this._frameRequest,(T=>{l.cA.frame(T),this._frameRequest=null;try{this._render(T)}catch(s){if(!l.cC(s)&&!(function(h){return h.message===qc})(s))throw s}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(T){this._showTileBoundaries!==T&&(this._showTileBoundaries=T,this._update())}get showPadding(){return!!this._showPadding}set showPadding(T){this._showPadding!==T&&(this._showPadding=T,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(T){this._showCollisionBoxes!==T&&(this._showCollisionBoxes=T,T?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(T){this._showOverdrawInspector!==T&&(this._showOverdrawInspector=T,this._update())}get repaint(){return!!this._repaint}set repaint(T){this._repaint!==T&&(this._repaint=T,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(T){this._vertices=T,this._update()}get version(){return Vi}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(T){return this._lazyInitEmptyStyle(),this.style.setProjection(T),this._update(!0)}},m.MapMouseEvent=bn,m.MapTouchEvent=Ga,m.MapWheelEvent=Xs,m.Marker=eh,m.NavigationControl=class{constructor(T){this._updateZoomButtons=()=>{const s=this._map.getZoom(),h=s===this._map.getMaxZoom(),_=s===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(s,h)=>{const _=this._map._getUIString(`NavigationControl.${h}`);s.title=_,s.setAttribute("aria-label",_)},this.options=l.e({},eu,T),this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(s=>this._map.zoomIn({},{originalEvent:s}))),J.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(s=>this._map.zoomOut({},{originalEvent:s}))),J.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})})),this._compassIcon=J.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(T){return this._map=T,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){J.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(T,s){const h=J.create("button",T,this._container);return h.type="button",h.addEventListener("click",s),h}},m.Popup=class extends l.E{constructor(T){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&J.remove(this._content),this._container&&(J.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=J.create("div","maplibregl-popup",this._map.getContainer()),this._tip=J.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=oc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!s)return;const h=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const b=lc(this.options.offset);if(!_){const M=this._container.offsetWidth,k=this._container.offsetHeight;let O;O=h.y+b.bottom.y<k?["top"]:h.y>this._map.transform.height-k?["bottom"]:[],h.x<M/2?O.push("left"):h.x>this._map.transform.width-M/2&&O.push("right"),_=O.length===0?"bottom":O.join("-")}let A=h.add(b[_]);this.options.subpixelPositioning||(A=A.round()),J.setTransform(this._container,`${bo[_]} translate(${A.x}px,${A.y}px)`),xo(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(nh),T)}addTo(T){return this._map&&this.remove(),this._map=T,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(T){return this._lngLat=l.U.convert(T),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(T){return this.setDOMContent(document.createTextNode(T))}setHTML(T){const s=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=T;_=h.firstChild,_;)s.appendChild(_);return this.setDOMContent(s)}getMaxWidth(){var T;return(T=this._container)===null||T===void 0?void 0:T.style.maxWidth}setMaxWidth(T){return this.options.maxWidth=T,this._update(),this}setDOMContent(T){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=J.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(T),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(T){return this._container&&this._container.classList.add(T),this}removeClassName(T){return this._container&&this._container.classList.remove(T),this}setOffset(T){return this.options.offset=T,this._update(),this}toggleClassName(T){if(this._container)return this._container.classList.toggle(T)}setSubpixelPositioning(T){this.options.subpixelPositioning=T}_createCloseButton(){this.options.closeButton&&(this._closeButton=J.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const T=this._container.querySelector(rh);T&&T.focus()}},m.RasterDEMTileSource=Pa,m.RasterTileSource=qo,m.ScaleControl=class{constructor(T){this._onMove=()=>{ih(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,ih(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},pf),T)}getDefaultPosition(){return"bottom-left"}onAdd(T){return this._map=T,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-scale",T.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){J.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=ya,m.Style=Bu,m.TerrainControl=class{constructor(T){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=T}onAdd(T){return this._map=T,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=J.create("button","maplibregl-ctrl-terrain",this._container),J.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){J.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=cl,m.TwoFingersTouchRotateHandler=Qu,m.TwoFingersTouchZoomHandler=Ku,m.TwoFingersTouchZoomRotateHandler=Jc,m.VectorTileSource=Hs,m.VideoSource=kc,m.addSourceType=(T,s)=>l._(void 0,void 0,void 0,(function*(){if(Bc(T))throw new Error(`A source type called "${T}" already exists.`);((h,_)=>{Da[h]=_})(T,s)})),m.clearPrewarmedResources=function(){const T=Je;T&&(T.isPreloaded()&&T.numActive()===1?(T.release(Me),Je=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.createTileMesh=Du,m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return ts().getRTLTextPluginStatus()},m.getVersion=function(){return Or},m.getWorkerCount=function(){return ei.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(T){return gs().broadcast("IS",T)},m.isTimeFrozen=function(){return nt.isFrozen()},m.now=at,m.prewarm=function(){Ui().acquire(Me)},m.restoreNow=function(){nt.restoreNow()},m.setMaxParallelImageRequests=function(T){l.a.MAX_PARALLEL_IMAGE_REQUESTS=T},m.setNow=function(T){nt.setNow(T)},m.setRTLTextPlugin=function(T,s){return ts().setRTLTextPlugin(T,s)},m.setWorkerCount=function(T){ei.workerCount=T},m.setWorkerUrl=function(T){l.a.WORKER_URL=T}}));var f=e;return f}))})(fb)),fb.exports}var yR=w9();const T9=qR(yR),S9=WR({__proto__:null,default:T9},[yR]);const A9=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),E9=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,n)=>n?n.toUpperCase():e.toLowerCase()),dE=i=>{const t=E9(i);return t.charAt(0).toUpperCase()+t.slice(1)},vR=(...i)=>i.filter((t,e,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===e).join(" ").trim(),C9=i=>{for(const t in i)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var M9={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const R9=me.forwardRef(({color:i="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:n,className:a="",children:f,iconNode:m,...l},w)=>me.createElement("svg",{ref:w,...M9,width:t,height:t,stroke:i,strokeWidth:n?Number(e)*24/Number(t):e,className:vR("lucide",a),...!f&&!C9(l)&&{"aria-hidden":"true"},...l},[...m.map(([C,P])=>me.createElement(C,P)),...Array.isArray(f)?f:[f]]));const ed=(i,t)=>{const e=me.forwardRef(({className:n,...a},f)=>me.createElement(R9,{ref:f,iconNode:t,className:vR(`lucide-${A9(dE(i))}`,`lucide-${i}`,n),...a}));return e.displayName=dE(i),e};const P9=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],B$=ed("cloud-rain",P9);const I9=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],L$=ed("file-text",I9);const D9=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],F$=ed("flame",D9);const k9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],N$=ed("globe",k9);const O9=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],z$=ed("server",O9);const B9=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],U$=ed("settings",B9);const L9=[["path",{d:"M14 9.536V7a4 4 0 0 1 4-4h1.5a.5.5 0 0 1 .5.5V5a4 4 0 0 1-4 4 4 4 0 0 0-4 4c0 2 1 3 1 5a5 5 0 0 1-1 3",key:"139s4v"}],["path",{d:"M4 9a5 5 0 0 1 8 4 5 5 0 0 1-8-4",key:"1dlkgp"}],["path",{d:"M5 21h14",key:"11awu3"}]],V$=ed("sprout",L9);const F9=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],j$=ed("zap",F9);function bR(i){var t,e,n="";if(typeof i=="string"||typeof i=="number")n+=i;else if(typeof i=="object")if(Array.isArray(i)){var a=i.length;for(t=0;t<a;t++)i[t]&&(e=bR(i[t]))&&(n&&(n+=" "),n+=e)}else for(e in i)i[e]&&(n&&(n+=" "),n+=e);return n}function N9(){for(var i,t,e=0,n="",a=arguments.length;e<a;e++)(i=arguments[e])&&(t=bR(i))&&(n&&(n+=" "),n+=t);return n}const z9=(i,t)=>{const e=new Array(i.length+t.length);for(let n=0;n<i.length;n++)e[n]=i[n];for(let n=0;n<t.length;n++)e[i.length+n]=t[n];return e},U9=(i,t)=>({classGroupId:i,validator:t}),xR=(i=new Map,t=null,e)=>({nextPart:i,validators:t,classGroupId:e}),jb="-",pE=[],V9="arbitrary..",j9=i=>{const t=H9(i),{conflictingClassGroups:e,conflictingClassGroupModifiers:n}=i;return{getClassGroupId:m=>{if(m.startsWith("[")&&m.endsWith("]"))return $9(m);const l=m.split(jb),w=l[0]===""&&l.length>1?1:0;return wR(l,w,t)},getConflictingClassGroupIds:(m,l)=>{if(l){const w=n[m],C=e[m];return w?C?z9(C,w):w:C||pE}return e[m]||pE}}},wR=(i,t,e)=>{if(i.length-t===0)return e.classGroupId;const a=i[t],f=e.nextPart.get(a);if(f){const C=wR(i,t+1,f);if(C)return C}const m=e.validators;if(m===null)return;const l=t===0?i.join(jb):i.slice(t).join(jb),w=m.length;for(let C=0;C<w;C++){const P=m[C];if(P.validator(l))return P.classGroupId}},$9=i=>i.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=i.slice(1,-1),e=t.indexOf(":"),n=t.slice(0,e);return n?V9+n:void 0})(),H9=i=>{const{theme:t,classGroups:e}=i;return W9(e,t)},W9=(i,t)=>{const e=xR();for(const n in i){const a=i[n];cT(a,e,n,t)}return e},cT=(i,t,e,n)=>{const a=i.length;for(let f=0;f<a;f++){const m=i[f];q9(m,t,e,n)}},q9=(i,t,e,n)=>{if(typeof i=="string"){X9(i,t,e);return}if(typeof i=="function"){Z9(i,t,e,n);return}G9(i,t,e,n)},X9=(i,t,e)=>{const n=i===""?t:TR(t,i);n.classGroupId=e},Z9=(i,t,e,n)=>{if(Y9(i)){cT(i(n),t,e,n);return}t.validators===null&&(t.validators=[]),t.validators.push(U9(e,i))},G9=(i,t,e,n)=>{const a=Object.entries(i),f=a.length;for(let m=0;m<f;m++){const[l,w]=a[m];cT(w,TR(t,l),e,n)}},TR=(i,t)=>{let e=i;const n=t.split(jb),a=n.length;for(let f=0;f<a;f++){const m=n[f];let l=e.nextPart.get(m);l||(l=xR(),e.nextPart.set(m,l)),e=l}return e},Y9=i=>"isThemeGetter"in i&&i.isThemeGetter===!0,K9=i=>{if(i<1)return{get:()=>{},set:()=>{}};let t=0,e=Object.create(null),n=Object.create(null);const a=(f,m)=>{e[f]=m,t++,t>i&&(t=0,n=e,e=Object.create(null))};return{get(f){let m=e[f];if(m!==void 0)return m;if((m=n[f])!==void 0)return a(f,m),m},set(f,m){f in e?e[f]=m:a(f,m)}}},I1="!",mE=":",Q9=[],gE=(i,t,e,n,a)=>({modifiers:i,hasImportantModifier:t,baseClassName:e,maybePostfixModifierPosition:n,isExternal:a}),J9=i=>{const{prefix:t,experimentalParseClassName:e}=i;let n=a=>{const f=[];let m=0,l=0,w=0,C;const P=a.length;for(let at=0;at<P;at++){const J=a[at];if(m===0&&l===0){if(J===mE){f.push(a.slice(w,at)),w=at+1;continue}if(J==="/"){C=at;continue}}J==="["?m++:J==="]"?m--:J==="("?l++:J===")"&&l--}const L=f.length===0?a:a.slice(w);let j=L,G=!1;L.endsWith(I1)?(j=L.slice(0,-1),G=!0):L.startsWith(I1)&&(j=L.slice(1),G=!0);const nt=C&&C>w?C-w:void 0;return gE(f,G,j,nt)};if(t){const a=t+mE,f=n;n=m=>m.startsWith(a)?f(m.slice(a.length)):gE(Q9,!1,m,void 0,!0)}if(e){const a=n;n=f=>e({className:f,parseClassName:a})}return n},t$=i=>{const t=new Map;return i.orderSensitiveModifiers.forEach((e,n)=>{t.set(e,1e6+n)}),e=>{const n=[];let a=[];for(let f=0;f<e.length;f++){const m=e[f],l=m[0]==="[",w=t.has(m);l||w?(a.length>0&&(a.sort(),n.push(...a),a=[]),n.push(m)):a.push(m)}return a.length>0&&(a.sort(),n.push(...a)),n}},e$=i=>({cache:K9(i.cacheSize),parseClassName:J9(i),sortModifiers:t$(i),...j9(i)}),i$=/\s+/,n$=(i,t)=>{const{parseClassName:e,getClassGroupId:n,getConflictingClassGroupIds:a,sortModifiers:f}=t,m=[],l=i.trim().split(i$);let w="";for(let C=l.length-1;C>=0;C-=1){const P=l[C],{isExternal:L,modifiers:j,hasImportantModifier:G,baseClassName:nt,maybePostfixModifierPosition:at}=e(P);if(L){w=P+(w.length>0?" "+w:w);continue}let J=!!at,mt=n(J?nt.substring(0,at):nt);if(!mt){if(!J){w=P+(w.length>0?" "+w:w);continue}if(mt=n(nt),!mt){w=P+(w.length>0?" "+w:w);continue}J=!1}const Mt=j.length===0?"":j.length===1?j[0]:f(j).join(":"),pt=G?Mt+I1:Mt,Pt=pt+mt;if(m.indexOf(Pt)>-1)continue;m.push(Pt);const kt=a(mt,J);for(let $t=0;$t<kt.length;++$t){const ae=kt[$t];m.push(pt+ae)}w=P+(w.length>0?" "+w:w)}return w},r$=(...i)=>{let t=0,e,n,a="";for(;t<i.length;)(e=i[t++])&&(n=SR(e))&&(a&&(a+=" "),a+=n);return a},SR=i=>{if(typeof i=="string")return i;let t,e="";for(let n=0;n<i.length;n++)i[n]&&(t=SR(i[n]))&&(e&&(e+=" "),e+=t);return e},s$=(i,...t)=>{let e,n,a,f;const m=w=>{const C=t.reduce((P,L)=>L(P),i());return e=e$(C),n=e.cache.get,a=e.cache.set,f=l,l(w)},l=w=>{const C=n(w);if(C)return C;const P=n$(w,e);return a(w,P),P};return f=m,(...w)=>f(r$(...w))},a$=[],fs=i=>{const t=e=>e[i]||a$;return t.isThemeGetter=!0,t},AR=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,ER=/^\((?:(\w[\w-]*):)?(.+)\)$/i,o$=/^\d+\/\d+$/,l$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,c$=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,u$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,h$=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,f$=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,vg=i=>o$.test(i),Oi=i=>!!i&&!Number.isNaN(Number(i)),Vf=i=>!!i&&Number.isInteger(Number(i)),Ex=i=>i.endsWith("%")&&Oi(i.slice(0,-1)),Ih=i=>l$.test(i),d$=()=>!0,p$=i=>c$.test(i)&&!u$.test(i),CR=()=>!1,m$=i=>h$.test(i),g$=i=>f$.test(i),_$=i=>!Ke(i)&&!Qe(i),y$=i=>Qg(i,PR,CR),Ke=i=>AR.test(i),bp=i=>Qg(i,IR,p$),Cx=i=>Qg(i,T$,Oi),_E=i=>Qg(i,MR,CR),v$=i=>Qg(i,RR,g$),Jv=i=>Qg(i,DR,m$),Qe=i=>ER.test(i),K_=i=>Jg(i,IR),b$=i=>Jg(i,S$),yE=i=>Jg(i,MR),x$=i=>Jg(i,PR),w$=i=>Jg(i,RR),tb=i=>Jg(i,DR,!0),Qg=(i,t,e)=>{const n=AR.exec(i);return n?n[1]?t(n[1]):e(n[2]):!1},Jg=(i,t,e=!1)=>{const n=ER.exec(i);return n?n[1]?t(n[1]):e:!1},MR=i=>i==="position"||i==="percentage",RR=i=>i==="image"||i==="url",PR=i=>i==="length"||i==="size"||i==="bg-size",IR=i=>i==="length",T$=i=>i==="number",S$=i=>i==="family-name",DR=i=>i==="shadow",A$=()=>{const i=fs("color"),t=fs("font"),e=fs("text"),n=fs("font-weight"),a=fs("tracking"),f=fs("leading"),m=fs("breakpoint"),l=fs("container"),w=fs("spacing"),C=fs("radius"),P=fs("shadow"),L=fs("inset-shadow"),j=fs("text-shadow"),G=fs("drop-shadow"),nt=fs("blur"),at=fs("perspective"),J=fs("aspect"),mt=fs("ease"),Mt=fs("animate"),pt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Pt=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],kt=()=>[...Pt(),Qe,Ke],$t=()=>["auto","hidden","clip","visible","scroll"],ae=()=>["auto","contain","none"],qt=()=>[Qe,Ke,w],le=()=>[vg,"full","auto",...qt()],Oe=()=>[Vf,"none","subgrid",Qe,Ke],Be=()=>["auto",{span:["full",Vf,Qe,Ke]},Vf,Qe,Ke],qe=()=>[Vf,"auto",Qe,Ke],ri=()=>["auto","min","max","fr",Qe,Ke],Ne=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],wi=()=>["start","end","center","stretch","center-safe","end-safe"],ne=()=>["auto",...qt()],we=()=>[vg,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...qt()],ye=()=>[i,Qe,Ke],Ue=()=>[...Pt(),yE,_E,{position:[Qe,Ke]}],mi=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Dt=()=>["auto","cover","contain",x$,y$,{size:[Qe,Ke]}],he=()=>[Ex,K_,bp],Ce=()=>["","none","full",C,Qe,Ke],Me=()=>["",Oi,K_,bp],ei=()=>["solid","dashed","dotted","double"],ii=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Je=()=>[Oi,Ex,yE,_E],zi=()=>["","none",nt,Qe,Ke],Ui=()=>["none",Oi,Qe,Ke],Ar=()=>["none",Oi,Qe,Ke],gs=()=>[Oi,Qe,Ke],ar=()=>[vg,"full",...qt()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ih],breakpoint:[Ih],color:[d$],container:[Ih],"drop-shadow":[Ih],ease:["in","out","in-out"],font:[_$],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ih],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ih],shadow:[Ih],spacing:["px",Oi],text:[Ih],"text-shadow":[Ih],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",vg,Ke,Qe,J]}],container:["container"],columns:[{columns:[Oi,Ke,Qe,l]}],"break-after":[{"break-after":pt()}],"break-before":[{"break-before":pt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:kt()}],overflow:[{overflow:$t()}],"overflow-x":[{"overflow-x":$t()}],"overflow-y":[{"overflow-y":$t()}],overscroll:[{overscroll:ae()}],"overscroll-x":[{"overscroll-x":ae()}],"overscroll-y":[{"overscroll-y":ae()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:le()}],"inset-x":[{"inset-x":le()}],"inset-y":[{"inset-y":le()}],start:[{start:le()}],end:[{end:le()}],top:[{top:le()}],right:[{right:le()}],bottom:[{bottom:le()}],left:[{left:le()}],visibility:["visible","invisible","collapse"],z:[{z:[Vf,"auto",Qe,Ke]}],basis:[{basis:[vg,"full","auto",l,...qt()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Oi,vg,"auto","initial","none",Ke]}],grow:[{grow:["",Oi,Qe,Ke]}],shrink:[{shrink:["",Oi,Qe,Ke]}],order:[{order:[Vf,"first","last","none",Qe,Ke]}],"grid-cols":[{"grid-cols":Oe()}],"col-start-end":[{col:Be()}],"col-start":[{"col-start":qe()}],"col-end":[{"col-end":qe()}],"grid-rows":[{"grid-rows":Oe()}],"row-start-end":[{row:Be()}],"row-start":[{"row-start":qe()}],"row-end":[{"row-end":qe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ri()}],"auto-rows":[{"auto-rows":ri()}],gap:[{gap:qt()}],"gap-x":[{"gap-x":qt()}],"gap-y":[{"gap-y":qt()}],"justify-content":[{justify:[...Ne(),"normal"]}],"justify-items":[{"justify-items":[...wi(),"normal"]}],"justify-self":[{"justify-self":["auto",...wi()]}],"align-content":[{content:["normal",...Ne()]}],"align-items":[{items:[...wi(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...wi(),{baseline:["","last"]}]}],"place-content":[{"place-content":Ne()}],"place-items":[{"place-items":[...wi(),"baseline"]}],"place-self":[{"place-self":["auto",...wi()]}],p:[{p:qt()}],px:[{px:qt()}],py:[{py:qt()}],ps:[{ps:qt()}],pe:[{pe:qt()}],pt:[{pt:qt()}],pr:[{pr:qt()}],pb:[{pb:qt()}],pl:[{pl:qt()}],m:[{m:ne()}],mx:[{mx:ne()}],my:[{my:ne()}],ms:[{ms:ne()}],me:[{me:ne()}],mt:[{mt:ne()}],mr:[{mr:ne()}],mb:[{mb:ne()}],ml:[{ml:ne()}],"space-x":[{"space-x":qt()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":qt()}],"space-y-reverse":["space-y-reverse"],size:[{size:we()}],w:[{w:[l,"screen",...we()]}],"min-w":[{"min-w":[l,"screen","none",...we()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[m]},...we()]}],h:[{h:["screen","lh",...we()]}],"min-h":[{"min-h":["screen","lh","none",...we()]}],"max-h":[{"max-h":["screen","lh",...we()]}],"font-size":[{text:["base",e,K_,bp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,Qe,Cx]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ex,Ke]}],"font-family":[{font:[b$,Ke,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,Qe,Ke]}],"line-clamp":[{"line-clamp":[Oi,"none",Qe,Cx]}],leading:[{leading:[f,...qt()]}],"list-image":[{"list-image":["none",Qe,Ke]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Qe,Ke]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:ye()}],"text-color":[{text:ye()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ei(),"wavy"]}],"text-decoration-thickness":[{decoration:[Oi,"from-font","auto",Qe,bp]}],"text-decoration-color":[{decoration:ye()}],"underline-offset":[{"underline-offset":[Oi,"auto",Qe,Ke]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:qt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Qe,Ke]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Qe,Ke]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Ue()}],"bg-repeat":[{bg:mi()}],"bg-size":[{bg:Dt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Vf,Qe,Ke],radial:["",Qe,Ke],conic:[Vf,Qe,Ke]},w$,v$]}],"bg-color":[{bg:ye()}],"gradient-from-pos":[{from:he()}],"gradient-via-pos":[{via:he()}],"gradient-to-pos":[{to:he()}],"gradient-from":[{from:ye()}],"gradient-via":[{via:ye()}],"gradient-to":[{to:ye()}],rounded:[{rounded:Ce()}],"rounded-s":[{"rounded-s":Ce()}],"rounded-e":[{"rounded-e":Ce()}],"rounded-t":[{"rounded-t":Ce()}],"rounded-r":[{"rounded-r":Ce()}],"rounded-b":[{"rounded-b":Ce()}],"rounded-l":[{"rounded-l":Ce()}],"rounded-ss":[{"rounded-ss":Ce()}],"rounded-se":[{"rounded-se":Ce()}],"rounded-ee":[{"rounded-ee":Ce()}],"rounded-es":[{"rounded-es":Ce()}],"rounded-tl":[{"rounded-tl":Ce()}],"rounded-tr":[{"rounded-tr":Ce()}],"rounded-br":[{"rounded-br":Ce()}],"rounded-bl":[{"rounded-bl":Ce()}],"border-w":[{border:Me()}],"border-w-x":[{"border-x":Me()}],"border-w-y":[{"border-y":Me()}],"border-w-s":[{"border-s":Me()}],"border-w-e":[{"border-e":Me()}],"border-w-t":[{"border-t":Me()}],"border-w-r":[{"border-r":Me()}],"border-w-b":[{"border-b":Me()}],"border-w-l":[{"border-l":Me()}],"divide-x":[{"divide-x":Me()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Me()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ei(),"hidden","none"]}],"divide-style":[{divide:[...ei(),"hidden","none"]}],"border-color":[{border:ye()}],"border-color-x":[{"border-x":ye()}],"border-color-y":[{"border-y":ye()}],"border-color-s":[{"border-s":ye()}],"border-color-e":[{"border-e":ye()}],"border-color-t":[{"border-t":ye()}],"border-color-r":[{"border-r":ye()}],"border-color-b":[{"border-b":ye()}],"border-color-l":[{"border-l":ye()}],"divide-color":[{divide:ye()}],"outline-style":[{outline:[...ei(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Oi,Qe,Ke]}],"outline-w":[{outline:["",Oi,K_,bp]}],"outline-color":[{outline:ye()}],shadow:[{shadow:["","none",P,tb,Jv]}],"shadow-color":[{shadow:ye()}],"inset-shadow":[{"inset-shadow":["none",L,tb,Jv]}],"inset-shadow-color":[{"inset-shadow":ye()}],"ring-w":[{ring:Me()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:ye()}],"ring-offset-w":[{"ring-offset":[Oi,bp]}],"ring-offset-color":[{"ring-offset":ye()}],"inset-ring-w":[{"inset-ring":Me()}],"inset-ring-color":[{"inset-ring":ye()}],"text-shadow":[{"text-shadow":["none",j,tb,Jv]}],"text-shadow-color":[{"text-shadow":ye()}],opacity:[{opacity:[Oi,Qe,Ke]}],"mix-blend":[{"mix-blend":[...ii(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ii()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Oi]}],"mask-image-linear-from-pos":[{"mask-linear-from":Je()}],"mask-image-linear-to-pos":[{"mask-linear-to":Je()}],"mask-image-linear-from-color":[{"mask-linear-from":ye()}],"mask-image-linear-to-color":[{"mask-linear-to":ye()}],"mask-image-t-from-pos":[{"mask-t-from":Je()}],"mask-image-t-to-pos":[{"mask-t-to":Je()}],"mask-image-t-from-color":[{"mask-t-from":ye()}],"mask-image-t-to-color":[{"mask-t-to":ye()}],"mask-image-r-from-pos":[{"mask-r-from":Je()}],"mask-image-r-to-pos":[{"mask-r-to":Je()}],"mask-image-r-from-color":[{"mask-r-from":ye()}],"mask-image-r-to-color":[{"mask-r-to":ye()}],"mask-image-b-from-pos":[{"mask-b-from":Je()}],"mask-image-b-to-pos":[{"mask-b-to":Je()}],"mask-image-b-from-color":[{"mask-b-from":ye()}],"mask-image-b-to-color":[{"mask-b-to":ye()}],"mask-image-l-from-pos":[{"mask-l-from":Je()}],"mask-image-l-to-pos":[{"mask-l-to":Je()}],"mask-image-l-from-color":[{"mask-l-from":ye()}],"mask-image-l-to-color":[{"mask-l-to":ye()}],"mask-image-x-from-pos":[{"mask-x-from":Je()}],"mask-image-x-to-pos":[{"mask-x-to":Je()}],"mask-image-x-from-color":[{"mask-x-from":ye()}],"mask-image-x-to-color":[{"mask-x-to":ye()}],"mask-image-y-from-pos":[{"mask-y-from":Je()}],"mask-image-y-to-pos":[{"mask-y-to":Je()}],"mask-image-y-from-color":[{"mask-y-from":ye()}],"mask-image-y-to-color":[{"mask-y-to":ye()}],"mask-image-radial":[{"mask-radial":[Qe,Ke]}],"mask-image-radial-from-pos":[{"mask-radial-from":Je()}],"mask-image-radial-to-pos":[{"mask-radial-to":Je()}],"mask-image-radial-from-color":[{"mask-radial-from":ye()}],"mask-image-radial-to-color":[{"mask-radial-to":ye()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":Pt()}],"mask-image-conic-pos":[{"mask-conic":[Oi]}],"mask-image-conic-from-pos":[{"mask-conic-from":Je()}],"mask-image-conic-to-pos":[{"mask-conic-to":Je()}],"mask-image-conic-from-color":[{"mask-conic-from":ye()}],"mask-image-conic-to-color":[{"mask-conic-to":ye()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Ue()}],"mask-repeat":[{mask:mi()}],"mask-size":[{mask:Dt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Qe,Ke]}],filter:[{filter:["","none",Qe,Ke]}],blur:[{blur:zi()}],brightness:[{brightness:[Oi,Qe,Ke]}],contrast:[{contrast:[Oi,Qe,Ke]}],"drop-shadow":[{"drop-shadow":["","none",G,tb,Jv]}],"drop-shadow-color":[{"drop-shadow":ye()}],grayscale:[{grayscale:["",Oi,Qe,Ke]}],"hue-rotate":[{"hue-rotate":[Oi,Qe,Ke]}],invert:[{invert:["",Oi,Qe,Ke]}],saturate:[{saturate:[Oi,Qe,Ke]}],sepia:[{sepia:["",Oi,Qe,Ke]}],"backdrop-filter":[{"backdrop-filter":["","none",Qe,Ke]}],"backdrop-blur":[{"backdrop-blur":zi()}],"backdrop-brightness":[{"backdrop-brightness":[Oi,Qe,Ke]}],"backdrop-contrast":[{"backdrop-contrast":[Oi,Qe,Ke]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Oi,Qe,Ke]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Oi,Qe,Ke]}],"backdrop-invert":[{"backdrop-invert":["",Oi,Qe,Ke]}],"backdrop-opacity":[{"backdrop-opacity":[Oi,Qe,Ke]}],"backdrop-saturate":[{"backdrop-saturate":[Oi,Qe,Ke]}],"backdrop-sepia":[{"backdrop-sepia":["",Oi,Qe,Ke]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":qt()}],"border-spacing-x":[{"border-spacing-x":qt()}],"border-spacing-y":[{"border-spacing-y":qt()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Qe,Ke]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Oi,"initial",Qe,Ke]}],ease:[{ease:["linear","initial",mt,Qe,Ke]}],delay:[{delay:[Oi,Qe,Ke]}],animate:[{animate:["none",Mt,Qe,Ke]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[at,Qe,Ke]}],"perspective-origin":[{"perspective-origin":kt()}],rotate:[{rotate:Ui()}],"rotate-x":[{"rotate-x":Ui()}],"rotate-y":[{"rotate-y":Ui()}],"rotate-z":[{"rotate-z":Ui()}],scale:[{scale:Ar()}],"scale-x":[{"scale-x":Ar()}],"scale-y":[{"scale-y":Ar()}],"scale-z":[{"scale-z":Ar()}],"scale-3d":["scale-3d"],skew:[{skew:gs()}],"skew-x":[{"skew-x":gs()}],"skew-y":[{"skew-y":gs()}],transform:[{transform:[Qe,Ke,"","none","gpu","cpu"]}],"transform-origin":[{origin:kt()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ar()}],"translate-x":[{"translate-x":ar()}],"translate-y":[{"translate-y":ar()}],"translate-z":[{"translate-z":ar()}],"translate-none":["translate-none"],accent:[{accent:ye()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:ye()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Qe,Ke]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":qt()}],"scroll-mx":[{"scroll-mx":qt()}],"scroll-my":[{"scroll-my":qt()}],"scroll-ms":[{"scroll-ms":qt()}],"scroll-me":[{"scroll-me":qt()}],"scroll-mt":[{"scroll-mt":qt()}],"scroll-mr":[{"scroll-mr":qt()}],"scroll-mb":[{"scroll-mb":qt()}],"scroll-ml":[{"scroll-ml":qt()}],"scroll-p":[{"scroll-p":qt()}],"scroll-px":[{"scroll-px":qt()}],"scroll-py":[{"scroll-py":qt()}],"scroll-ps":[{"scroll-ps":qt()}],"scroll-pe":[{"scroll-pe":qt()}],"scroll-pt":[{"scroll-pt":qt()}],"scroll-pr":[{"scroll-pr":qt()}],"scroll-pb":[{"scroll-pb":qt()}],"scroll-pl":[{"scroll-pl":qt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Qe,Ke]}],fill:[{fill:["none",...ye()]}],"stroke-w":[{stroke:[Oi,K_,bp,Cx]}],stroke:[{stroke:["none",...ye()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},E$=s$(A$);function $$(...i){return E$(N9(i))}export{B$ as C,k$ as D,L$ as F,N$ as G,O$ as M,cR as S,pR as T,j$ as Z,T9 as a,V$ as b,$$ as c,F$ as d,U$ as e,z$ as f,C$ as g,Mx as j,R$ as m,me as r};
