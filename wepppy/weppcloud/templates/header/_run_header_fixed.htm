{% from "controls/_pure_macros.html" import header_text_field %}
<header class="wc-header wc-run-header">
  <div class="wc-container wc-container--fluid">
    <div class="wc-run-header__inner">
      <div class="wc-run-header__title-row">
        <a class="wc-brand" href="{{ url_for('weppcloud_site.index') }}">WEPPcloud</a>
        <span class="wc-run-header__descriptor">
          {{ current_ron.runid }} {{ current_ron.config_stem }}
        </span>
      </div>
      <div class="wc-run-header__content">
        <div class="wc-run-header__fields">
          {{ header_text_field(
            "input_name",
            "Project name",
            value=current_ron.name,
            placeholder="Name",
            attrs={
              "oninput": "Project.getInstance().setNameFromInput()",
              "onblur": "Project.getInstance().commitNameFromInput()"
            },
            extra_class="disable-readonly"
          ) }}
          {{ header_text_field(
            "input_scenario",
            "Scenario",
            value=current_ron.scenario,
            placeholder="Scenario",
            attrs={
              "oninput": "Project.getInstance().setScenarioFromInput()",
              "onblur": "Project.getInstance().commitScenarioFromInput()"
            },
            extra_class="disable-readonly"
          ) }}
        </div>
        <div class="wc-run-header__right">
          <div class="wc-run-header__actions">
            <a class="pure-button pure-button-secondary"
               href="{{ url_for_run('readme.readme_editor', runid=current_ron.runid, config=current_ron.config_stem) }}"
               target="_blank"
               rel="noopener">
              README
            </a>
            {% if not pup_relpath %}
            <a class="pure-button pure-button-secondary"
               href="{{ url_for_run('fork.rq_fork_console', runid=current_ron.runid, config=current_ron.config_stem) }}"
               target="_blank"
               rel="noopener">
              FORK
            </a>
            <a class="pure-button pure-button-secondary"
               href="{{ url_for_run('archive.rq_archive_dashboard', runid=current_ron.runid, config=current_ron.config_stem) }}"
               target="_blank"
               rel="noopener">
              ARCHIVE
            </a>
            {% endif %}
          </div>
          <details class="wc-run-header__menu">
            <summary class="wc-run-header__menu-button pure-button pure-button-secondary">
              More
            </summary>
            <div class="wc-run-header__menu-content">
              <button type="button"
                      class="pure-button"
                      data-toggle="modal"
                      data-target="#puModal">
                PowerUser
              </button>
              <button type="button"
                      class="pure-button"
                      data-toggle="modal"
                      data-target="#unitizerModal">
                Unitizer
              </button>
              <label class="wc-run-header__toggle">
                <input id="checkbox_readonly"
                       type="checkbox"
                       onchange="Project.getInstance().set_readonly(this.checked);"
                       {% if current_ron.readonly %}checked{% endif %}>
                <span>Readonly</span>
              </label>
              <label class="wc-run-header__toggle">
                <input id="checkbox_public"
                       type="checkbox"
                       onchange="Project.getInstance().set_public(this.checked);"
                       {% if current_ron.public %}checked{% endif %}>
                <span>Public</span>
              </label>
              {% if user.has_role('Admin') %}
              <a class="pure-button pure-button-secondary"
                 href="{{ url_for('admin.view_access_log', runid=current_ron.runid, config=current_ron.config_stem) }}"
                 target="_blank"
                 rel="noopener">
                Access log
              </a>
              {% endif %}
            </div>
          </details>
        </div>
      </div>
    </div>
  </div>
</header>
<script>
  "use strict";
  var pup_relpath = {{ current_ron.pup_relpath | tojson }};
  $(function () {
    if (!pup_relpath) {
      return;
    }
    $.ajaxPrefilter(function (options) {
      if (!options.url) {
        return;
      }
      var url = options.url;
      if (
        /^https?:\/\//i.test(url) ||
        url.startsWith("//") ||
        url.indexOf("pup=") !== -1
      ) {
        return;
      }
      var separator = url.indexOf("?") !== -1 ? "&" : "?";
      options.url = url + separator + "pup=" + encodeURIComponent(pup_relpath);
    });
  });
</script>
