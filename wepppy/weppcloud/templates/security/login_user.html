{% extends "security/_layout.html" %}
{% from "security/_macros.html" import render_aligned_field, render_aligned_password, render_aligned_checkbox, render_form_errors, prop_next %}

{% set title = 'WEPPcloud Sign In' %}

{% block title %}{{ title }}{% endblock %}
{% block auth_heading %}WEPPcloud Sign In{% endblock %}
{% block auth_subheading %}<p>Enter your WEPPcloud credentials to access tools and projects.</p>{% endblock %}

{% block content %}
  <form action="{{ url_for_security('login') }}{{ prop_next() }}" method="post" name="login_user_form" class="pure-form pure-form-aligned wc-auth-form" novalidate>
    <fieldset>
      {{ login_user_form.hidden_tag() }}
      {{ render_form_errors(login_user_form) }}

      {% if login_user_form.email and "email" in identity_attributes %}
        {{ render_aligned_field(login_user_form.email, label_text='Email', input_class='pure-input-1', placeholder='you@example.com', autocomplete='username') }}
      {% endif %}

      {% if login_user_form.username and "username" in identity_attributes %}
        {% if login_user_form.email and "email" in identity_attributes %}
          <div class="wc-auth-separator" aria-hidden="true">or</div>
        {% endif %}
        {{ render_aligned_field(login_user_form.username, label_text='Username', input_class='pure-input-1', autocomplete='username') }}
      {% endif %}

      {{ render_aligned_password(login_user_form.password, toggle_id='wc-password-toggle', input_class='pure-input-1', autocomplete='current-password') }}

      {% if login_user_form.remember %}
        {{ render_aligned_checkbox(login_user_form.remember, 'Remember me on this device') }}
      {% endif %}

      <div class="pure-controls">
        {{ login_user_form.submit(class_='pure-button pure-button-primary') }}
      </div>
    </fieldset>
  </form>
{% endblock %}

{% block auth_footer %}
  {% include "security/_menu.html" %}
{% endblock %}

{% block script_extras %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.wc-password-toggle').forEach(function (toggle) {
    var targetId = toggle.getAttribute('data-target');
    var input = document.getElementById(targetId);
    if (!input) {
      return;
    }
    toggle.addEventListener('click', function () {
      var showing = input.type === 'text';
      input.type = showing ? 'password' : 'text';
      toggle.textContent = showing ? 'Show' : 'Hide';
      toggle.setAttribute('aria-label', showing ? 'Show password' : 'Hide password');
    });
  });
});
</script>
{% endblock %}
