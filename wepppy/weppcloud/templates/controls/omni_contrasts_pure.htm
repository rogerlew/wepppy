{% import "controls/_pure_macros.html" as ui %}
{% from "shared/console_macros.htm" import button_row %}

{% set description %}
  <p class="wc-text-muted">
    Define contrast scenarios to compare Omni outputs by cumulative objective thresholds. Contrasts
    reuse results generated by the Scenario Runner; rerun Omni after updating these values.
  </p>
{% endset %}

{% call ui.control_shell(
     form_id="omni_contrasts_form",
     title="Omni Contrast Definitions",
     collapsible=False,
     description=description
   ) %}

  {{ ui.select_field(
       "omni_contrast_objective_parameter",
       "Objective parameter",
       options=[
         ("Soil_Loss_kg", "Soil Loss (kg)"),
         ("Runoff_mm", "Runoff (mm)"),
         ("Runoff_Volume_m3", "Runoff Volume (m³)"),
         ("Subrunoff_mm", "Subrunoff (mm)"),
         ("Subrunoff_Volume_m3", "Subrunoff Volume (m³)"),
         ("Total_Phosphorus_kg", "Total Phosphorus (kg)")
       ],
       selected=omni.contrast_object_param if omni.contrast_object_param is defined else None,
       extra_control_class="disable-readonly"
     ) }}

  {% set scenario_option_labels = [
    ("uniform_high", "Uniform High Severity Fire"),
    ("uniform_moderate", "Uniform Moderate Severity Fire"),
    ("uniform_low", "Uniform Low Severity Fire"),
    ("thinning", "Thinning"),
    ("mulch", "Mulching"),
    ("sbs_map", "SBS Map"),
    ("undisturbed", "Undisturbed"),
    ("prescribed_fire", "Prescribed Fire")
  ] %}

  {{ ui.select_field(
       "omni_control_scenario",
       "Control scenario",
       options=scenario_option_labels,
       selected=omni.control_scenario if omni.control_scenario is defined else None,
       extra_control_class="disable-readonly"
     ) }}

  {{ ui.select_field(
       "omni_contrast_scenario",
       "Contrast scenario",
       options=scenario_option_labels,
       selected=omni.contrast_scenario if omni.contrast_scenario is defined else None,
       extra_control_class="disable-readonly"
     ) }}

  {{ ui.numeric_field(
       "omni_contrast_cumulative_obj_param_threshold_fraction",
       "Cumulative objective threshold fraction",
       value="%.3f"|format(omni.contrast_cumulative_obj_param_threshold_fraction or 0.8),
       precision="0.01",
       min=0.0,
       max=1.0,
       help="Limit the contrast set by total contribution (0–1).",
       attrs={"class": "disable-readonly"}
     ) }}

  <p class="wc-text-muted">
    Contrast execution is being refactored for Pure runs₀. Use the legacy control if you need to run contrasts today.
  </p>

  {% call button_row() %}
    <button id="btn_define_omni_contrasts"
            class="pure-button pure-button-disabled"
            type="button"
            disabled>
      Define contrasts (coming soon)
    </button>
  {% endcall %}

{% endcall %}
