{% import "controls/_pure_macros.html" as ui %}

{% set subcatchment_radio_attrs = {"data-subcatchment-role": "cmap-option"} %}

{% set wepp_radio_options = namespace(values=[
  {"id": "wepp_sub_cmap_radio_runoff", "label": "Runoff", "value": "sub_runoff", "attrs": subcatchment_radio_attrs},
  {"id": "wepp_sub_cmap_radio_subrunoff", "label": "Lateral Flow", "value": "sub_subrunoff", "attrs": subcatchment_radio_attrs},
  {"id": "wepp_sub_cmap_radio_baseflow", "label": "Baseflow", "value": "sub_baseflow", "attrs": subcatchment_radio_attrs},
  {"id": "wepp_sub_cmap_radio_loss", "label": "Sediment Yield", "value": "sub_loss", "attrs": subcatchment_radio_attrs}
]) %}

{% if wepp.has_phosphorus %}
  {% set wepp_radio_options.values = wepp_radio_options.values + [
    {"id": "wepp_sub_cmap_radio_phosphorus", "label": "Total Phosphorus", "value": "sub_phosphorus", "attrs": subcatchment_radio_attrs}
  ] %}
{% endif %}

{% if 'ash' in ron.mods %}
  {% set wepp_radio_options.values = wepp_radio_options.values + [
    {"id": "ash_sub_cmap_radio_load", "label": "Ash Load", "value": "ash_load", "attrs": subcatchment_radio_attrs},
    {"id": "ash_sub_cmap_radio_wind", "label": "Wind", "value": "wind_transport (kg/ha)", "attrs": subcatchment_radio_attrs},
    {"id": "ash_sub_cmap_radio_water", "label": "Water", "value": "water_transport (kg/ha)", "attrs": subcatchment_radio_attrs},
    {"id": "ash_sub_cmap_radio_windwater", "label": "Wind/Water", "value": "ash_transport (kg/ha)", "attrs": subcatchment_radio_attrs}
  ] %}
{% endif %}

<h3 class="wc-map-panel__title">WEPP Results</h3>
<p class="wc-text-muted">Choose a metric to recolor the subcatchment map and adjust the legend scale as needed.</p>

{{ ui.radio_group(
     "wepp_sub_cmap_radio",
     label="Color map",
     layout="vertical",
     options=wepp_radio_options.values
   ) }}

<div class="wc-map-scale" data-map-scale="sub_runoff">
  {{ ui.color_scale(
       "wepp_sub_cmap_range_runoff",
       "wepp_sub_cmap_canvas_runoff",
       "wepp_sub_cmap_canvas_runoff_min",
       "wepp_sub_cmap_canvas_runoff_max",
       label="Runoff legend",
       range_attrs={"min": "0.0001", "max": "100", "value": "5", "step": "0.1", "data-subcatchment-role": "scale-range", "data-subcatchment-scale": "runoff"}
     ) }}
</div>

<div class="wc-map-scale" data-map-scale="sub_loss">
  {{ ui.color_scale(
       "wepp_sub_cmap_range_loss",
       "wepp_sub_cmap_canvas_loss",
       "wepp_sub_cmap_canvas_loss_min",
       "wepp_sub_cmap_canvas_loss_max",
       label="Sediment yield legend",
       range_attrs={"min": "0.0001", "max": "100", "value": "5", "step": "0.1", "data-subcatchment-role": "scale-range", "data-subcatchment-scale": "loss"}
     ) }}
</div>

{% if wepp.has_phosphorus %}
  <div class="wc-map-scale" data-map-scale="sub_phosphorus">
    {{ ui.color_scale(
         "wepp_sub_cmap_range_phosphorus",
         "wepp_sub_cmap_canvas_phosphorus",
         "wepp_sub_cmap_canvas_phosphorus_min",
         "wepp_sub_cmap_canvas_phosphorus_max",
         label="Total phosphorus legend",
         range_attrs={"min": "0.0001", "max": "100", "value": "5", "step": "0.1", "data-subcatchment-role": "scale-range", "data-subcatchment-scale": "phosphorus"},
         units_id="wepp_sub_cmap_canvas_phosphorus_units"
       ) }}
  </div>
{% endif %}

{% if 'ash' in ron.mods %}
  <h4 class="wc-map-panel__subtitle">Ash Transport Visualizations</h4>
  <div class="wc-map-scale" data-map-scale="ash_load">
    {{ ui.color_scale(
         "ash_sub_cmap_range_load",
         "ash_sub_cmap_canvas_load",
         "ash_sub_cmap_canvas_load_min",
         "ash_sub_cmap_canvas_load_max",
         label="Ash load legend",
         range_attrs={"min": "0.0001", "max": "100", "value": "5", "step": "0.1", "data-subcatchment-role": "scale-range", "data-subcatchment-scale": "ash_load"}
       ) }}
  </div>
  <div class="wc-map-scale" data-map-scale="ash_transport (kg/ha)">
    {{ ui.color_scale(
         "ash_sub_cmap_range_transport",
         "ash_sub_cmap_canvas_transport",
         "ash_sub_cmap_canvas_transport_min",
         "ash_sub_cmap_canvas_transport_max",
         label="Ash transport legend",
         range_attrs={"min": "0.0001", "max": "20", "value": "2", "step": "0.05", "data-subcatchment-role": "scale-range", "data-subcatchment-scale": "ash_transport"},
         units_id="ash_sub_cmap_canvas_transport_units"
       ) }}
  </div>
{% endif %}
