{% import "controls/_pure_macros.html" as ui %}
{% from "shared/console_macros.htm" import button_row %}

{% set stacktrace_panel_override = ui.stacktrace_panel(
     id="wepp_stacktrace_panel",
     summary="Details",
     collapsed=True,
     body_id="stacktrace",
     empty_state="No stack trace recorded."
   ) %}

{% call ui.control_shell(
     form_id="wepp_form",
     title="WEPP",
     collapsible=False,
     status_panel_options={"id": "wepp_status_panel", "height": "6rem"},
     stacktrace_panel_override=stacktrace_panel_override
   ) %}

  <p class="wc-text-muted">
    Configure WEPP runtime options and advanced processing. Refer to the
    <a href="https://doc.wepp.cloud/QuickStart.htm#wepp-advanced-options" target="_blank" rel="noopener noreferrer">documentation</a>
    for detailed guidance.
  </p>

  {% call ui.collapsible_card(title="Advanced options", expanded=False, card_id="wepp_advanced_options") %}
    <div class="wc-stack" data-wepp-advanced>
      {% call ui.card("WEPP UI - Hourly Seepage", attrs={"id": "wepp_hourly_seepage"}) %}
      {% include "controls/wepp_pure_advanced_options/wepp_ui.htm" %}
      {% endcall %}
      {% call ui.card("Potential ET (PMET)", attrs={"id": "wepp_pmet_options"}) %}
      {% include "controls/wepp_pure_advanced_options/pmet.htm" %}
      {% endcall %}
      {% call ui.card("Frost", attrs={"id": "wepp_frost_options"}) %}
      {% include "controls/wepp_pure_advanced_options/frost.htm" %}
      {% endcall %}
      {% call ui.card("Snow", attrs={"id": "wepp_snow_options"}) %}
      {% include "controls/wepp_pure_advanced_options/snow.htm" %}
      {% endcall %}
      {% call ui.card("Baseflow Processing", attrs={"id": "wepp_baseflow_options"}) %}
      {% include "controls/wepp_pure_advanced_options/baseflow.htm" %}
      {% endcall %}
      {% call ui.card("Channel Inputs (chan.inp)", attrs={"id": "wepp_chan_inp_options"}) %}
      {% include "controls/wepp_pure_advanced_options/chan_inp.htm" %}
      {% endcall %}
      {% call ui.card("Channel Parameters", attrs={"id": "wepp_channel_parameters"}) %}
      {% include "controls/wepp_pure_advanced_options/channels.htm" %}
      {% endcall %}
      {% call ui.card("Flowpaths (Experimental)", attrs={"id": "wepp_flowpaths_options"}) %}
      {% include "controls/wepp_pure_advanced_options/flowpaths.htm" %}
      {% endcall %}
      {% call ui.card("Bedrock", attrs={"id": "wepp_bedrock_options"}) %}
      {% include "controls/wepp_pure_advanced_options/bedrock.htm" %}
      {% endcall %}
      {% call ui.card("Clip Hillslopes", attrs={"id": "wepp_clip_hillslopes"}) %}
      {% include "controls/wepp_pure_advanced_options/clip_hillslopes.htm" %}
      {% endcall %}
      {% call ui.card("Soil Options", attrs={"id": "wepp_soil_options"}) %}
      {% include "controls/wepp_pure_advanced_options/clip_soils_depth.htm" %}
      {% endcall %}
      {% call ui.card("Phosphorus", attrs={"id": "wepp_phosphorus_options"}) %}
      {% include "controls/wepp_pure_advanced_options/phosphorus.htm" %}
      {% endcall %}
      {% call ui.card("Export Configuration", attrs={"id": "wepp_export_configuration"}) %}
      {% include "controls/wepp_pure_advanced_options/prep_details.htm" %}
      {% endcall %}
      {% call ui.card("WEPP Version", attrs={"id": "wepp_binary_selection"}) %}
      {% include "controls/wepp_pure_advanced_options/wepp_bin.htm" %}
      {% endcall %}
      {% if reveg %}
        {% call ui.card("Revegetation Scenarios", attrs={"id": "wepp_revegetation_options"}) %}
          {% include "controls/wepp_pure_advanced_options/revegetation.htm" %}
        {% endcall %}
      {% endif %}
    </div>
  {% endcall %}

  {% call button_row() %}
    <button
      id="btn_run_wepp"
      type="button"
      class="pure-button pure-button-primary disable-readonly"
      data-wepp-action="run">
      <img id="run_wepp_lock" src="{{ url_for('static', filename='open-iconic/png/lock-locked-2x.png') }}" alt="Lock" style="display:none;">
      Run WEPP
    </button>
  {% endcall %}
  {{ ui.job_hint("hint_run_wepp") }}

{% endcall %}

<div id="wepp-results" class="wc-stack"></div>
