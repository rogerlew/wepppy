{% import "controls/_pure_macros.html" as ui %}
{% from "shared/console_macros.htm" import button_row %}

{% set status_panel_override %}
  {% call ui.status_panel(
       id="wepp_status_panel",
       title="Status",
       variant="compact",
       log_id="status",
       height="6rem"
     ) %}
    <div id="rq_job" class="wc-status-panel__meta" aria-live="polite"></div>
    <span id="braille" class="wc-status-panel__meta" aria-hidden="true"></span>
  {% endcall %}
{% endset %}

{% set stacktrace_panel_override = ui.stacktrace_panel(
     id="wepp_stacktrace_panel",
     summary="Details",
     collapsed=True,
     body_id="stacktrace",
     empty_state="No stack trace recorded."
   ) %}

{% call ui.control_shell(
     form_id="wepp_form",
     title="WEPP",
     collapsible=False,
     status_panel_override=status_panel_override,
     stacktrace_panel_override=stacktrace_panel_override
   ) %}

  <p class="wc-text-muted">
    Configure WEPP runtime options and advanced processing. Refer to the
    <a href="https://doc.wepp.cloud/QuickStart.htm#wepp-advanced-options" target="_blank" rel="noopener noreferrer">documentation</a>
    for detailed guidance.
  </p>

  {% call ui.collapsible_card(title="Advanced options", expanded=False, card_id="wepp_advanced_options") %}
    <div class="wc-stack" data-wepp-advanced>
      {% include "controls/wepp_pure_advanced_options/wepp_ui.htm" %}
      {% include "controls/wepp_pure_advanced_options/pmet.htm" %}
      {% include "controls/wepp_pure_advanced_options/frost.htm" %}
      {% include "controls/wepp_pure_advanced_options/snow.htm" %}
      {% include "controls/wepp_pure_advanced_options/baseflow.htm" %}
      {% include "controls/wepp_pure_advanced_options/chan_inp.htm" %}
      {% include "controls/wepp_pure_advanced_options/channels.htm" %}
      {% include "controls/wepp_pure_advanced_options/flowpaths.htm" %}
      {% include "controls/wepp_pure_advanced_options/bedrock.htm" %}
      {% include "controls/wepp_pure_advanced_options/clip_hillslopes.htm" %}
      {% include "controls/wepp_pure_advanced_options/clip_soils_depth.htm" %}
      {% include "controls/wepp_pure_advanced_options/phosphorus.htm" %}
      {% include "controls/wepp_pure_advanced_options/prep_details.htm" %}
      {% include "controls/wepp_pure_advanced_options/wepp_bin.htm" %}
      {% if reveg %}
        {% include "controls/wepp_pure_advanced_options/revegetation.htm" %}
      {% endif %}
    </div>
  {% endcall %}

  {% call button_row() %}
    <button
      id="btn_run_wepp"
      type="button"
      class="pure-button pure-button-primary disable-readonly"
      data-wepp-action="run">
      <img id="run_wepp_lock" src="{{ url_for('static', filename='open-iconic/png/lock-locked-2x.png') }}" alt="Lock" style="display:none;">
      Run WEPP
    </button>
  {% endcall %}
  <p id="hint_run_wepp" class="wc-text-muted" aria-live="polite"></p>

{% endcall %}

<div id="wepp-results" class="wc-stack"></div>
