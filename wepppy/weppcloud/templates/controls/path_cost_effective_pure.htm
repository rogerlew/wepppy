{# Doc: controllers_js/README.md — Path CE Controller Reference (2025 helper migration) #}
{% import "controls/_pure_macros.html" as ui %}
{% from "shared/console_macros.htm" import button_row %}

{% set description %}
  <p class="wc-text-muted">
    Configure PATH Cost-Effective thresholds and treatment options, then launch the optimization.
    Results stream through the run status panel and persist under the run’s <code>path/</code> directory.
  </p>
{% endset %}

{% call ui.control_shell(
     form_id="path_ce_form",
     title="PATH Cost-Effective",
     collapsible=True,
     description=description,
     status_panel_options={
     "id": "path_ce_status_panel",
     "job_id": "path_ce_rq_job",
     "braille_id": "path_ce_braille"
     },
     summary_panel_options={
       "body_html": '<div class="wc-summary-pane"><dl class="wc-summary-pane__list" id="path_ce_summary"></dl></div>'
     },
     stacktrace_panel_options={
       "panel_id": "path_ce_stacktrace_panel",
       "body_id": "path_ce_stacktrace",
       "description": "<p class='wc-field__help'>Appears when an exception occurs.</p><p id='path_ce_message' class='wc-field__help' aria-live='polite'></p>"
     }
   ) %}

  <style>
    #path_ce_cost_table .path-ce-cost-field {
      display: flex;
      align-items: center;
      gap: 0.65rem;
    }

    #path_ce_cost_table .path-ce-cost-field input {
      flex: 1;
    }

    #path_ce_cost_table .path-ce-cost-unit {
      font-weight: 600;
      white-space: nowrap;
    }
  </style>

  <fieldset class="wc-fieldset">
    <legend class="wc-fieldset__legend">Thresholds</legend>
    <div class="wc-field wc-field--inline">
      <label class="wc-field__label" for="path_ce_sddc_threshold">Sediment Discharge Threshold (tons)</label>
      <input id="path_ce_sddc_threshold" name="sddc_threshold" class="pure-input-1" type="number" step="any" min="0" placeholder="0">
    </div>
    <div class="wc-field wc-field--inline">
      <label class="wc-field__label" for="path_ce_sdyd_threshold">Sediment Yield Threshold (tons)</label>
      <input id="path_ce_sdyd_threshold" name="sdyd_threshold" class="pure-input-1" type="number" step="any" min="0" placeholder="0">
    </div>
  </fieldset>

  <fieldset class="wc-fieldset">
    <legend class="wc-fieldset__legend">Filters</legend>
    <div class="wc-grid wc-grid--2">
      <div class="wc-field">
        <label class="wc-field__label" for="path_ce_slope_min">Slope ≥ (deg)</label>
        <input id="path_ce_slope_min" name="slope_min" class="pure-input-1" type="number" step="any" placeholder="None">
      </div>
      <div class="wc-field">
        <label class="wc-field__label" for="path_ce_slope_max">Slope ≤ (deg)</label>
        <input id="path_ce_slope_max" name="slope_max" class="pure-input-1" type="number" step="any" placeholder="None">
      </div>
    </div>
    <div class="wc-field">
      <label class="wc-field__label" for="path_ce_severity">Burn Severities</label>
      <select id="path_ce_severity" name="severity_filter" class="pure-input-1" multiple size="3">
        <option value="High">High</option>
        <option value="Moderate">Moderate</option>
        <option value="Low">Low</option>
      </select>
      <p class="wc-field__help">Hold Ctrl/Command to select multiple severities. Leave empty to include all.</p>
    </div>
  </fieldset>

  <fieldset class="wc-fieldset">
    <legend class="wc-fieldset__legend">Scenario Package</legend>
    <div class="wc-field">
      <p class="wc-field__help">
        PATH provisions a fixed Omni bundle before each run. The solver compares the post-fire SBS baseline,
        three mulch intensities, and the undisturbed reference scenario.
      </p>
      <ul class="wc-list">
        <li><strong>SBS Map (`sbs_map`)</strong>: current post-fire baseline.</li>
        <li><strong>Mulch 0.5 tons/acre (`mulch_15_sbs_map`)</strong>: +15% ground cover.</li>
        <li><strong>Mulch 1.0 tons/acre (`mulch_30_sbs_map`)</strong>: +30% ground cover.</li>
        <li><strong>Mulch 2.0 tons/acre (`mulch_60_sbs_map`)</strong>: +60% ground cover.</li>
        <li><strong>Undisturbed (`undisturbed`)</strong>: pre-fire reference run.</li>
      </ul>
    </div>
  </fieldset>

  <fieldset class="wc-fieldset">
    <legend class="wc-fieldset__legend">Mulch Costs</legend>
    <div class="wc-field">
      <table class="wc-table" id="path_ce_cost_table" aria-describedby="path_ce_cost_help">
        <thead>
          <tr>
            <th scope="col">Label</th>
            <th scope="col">Scenario Key</th>
            <th scope="col">Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Mulch 0.5 tons/acre</td>
            <td><code>mulch_15_sbs_map</code></td>
            <td>
              <div class="path-ce-cost-field" data-unitizer-category="currency-area">
                <input
                  type="number"
                  class="pure-input-1"
                  step="any"
                  min="0"
                  name="mulch_costs[mulch_15_sbs_map]"
                  data-pathce-cost="mulch_15_sbs_map"
                  data-unitizer-category="currency-area"
                  data-unitizer-unit="$/ha"
                  placeholder="0"
                >
                <span
                  class="path-ce-cost-unit"
                  data-unitizer-label
                  data-unitizer-category="currency-area"
                  data-unitizer-unit="$/ha"
                >$/ha</span>
              </div>
            </td>
          </tr>
          <tr>
            <td>Mulch 1.0 tons/acre</td>
            <td><code>mulch_30_sbs_map</code></td>
            <td>
              <div class="path-ce-cost-field" data-unitizer-category="currency-area">
                <input
                  type="number"
                  class="pure-input-1"
                  step="any"
                  min="0"
                  name="mulch_costs[mulch_30_sbs_map]"
                  data-pathce-cost="mulch_30_sbs_map"
                  data-unitizer-category="currency-area"
                  data-unitizer-unit="$/ha"
                  placeholder="0"
                >
                <span
                  class="path-ce-cost-unit"
                  data-unitizer-label
                  data-unitizer-category="currency-area"
                  data-unitizer-unit="$/ha"
                >$/ha</span>
              </div>
            </td>
          </tr>
          <tr>
            <td>Mulch 2.0 tons/acre</td>
            <td><code>mulch_60_sbs_map</code></td>
            <td>
              <div class="path-ce-cost-field" data-unitizer-category="currency-area">
                <input
                  type="number"
                  class="pure-input-1"
                  step="any"
                  min="0"
                  name="mulch_costs[mulch_60_sbs_map]"
                  data-pathce-cost="mulch_60_sbs_map"
                  data-unitizer-category="currency-area"
                  data-unitizer-unit="$/ha"
                  placeholder="0"
                >
                <span
                  class="path-ce-cost-unit"
                  data-unitizer-label
                  data-unitizer-category="currency-area"
                  data-unitizer-unit="$/ha"
                >$/ha</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <p id="path_ce_cost_help" class="wc-field__help">
        Enter treatment costs in USD per hectare (or acre if English units are selected). PATH multiplies by Omni hillslope areas to build the solver cost vector.
      </p>
    </div>
  </fieldset>

  {% call button_row() %}
    <button
      id="path_ce_run"
      type="button"
      class="pure-button pure-button-primary disable-readonly"
      data-pathce-action="run">
      Run PATH Cost-Effective
    </button>
  {% endcall %}
  {{ ui.job_hint("path_ce_hint", extra_class="wc-field__help") }}

{% endcall %}
