{# Doc: controllers_js/README.md — Path CE Controller Reference (2025 helper migration) #}
{% import "controls/_pure_macros.html" as ui %}
{% from "shared/console_macros.htm" import button_row %}

{% set description %}
  <p class="wc-text-muted">
    Configure PATH Cost-Effective thresholds and treatment options, then launch the optimization.
    Results stream through the run status panel and persist under the run’s <code>path/</code> directory.
  </p>
{% endset %}

{% call ui.control_shell(
     form_id="path_ce_form",
     title="PATH Cost-Effective",
     collapsible=False,
     description=description,
     status_panel_options={
       "id": "path_ce_status_panel",
       "job_id": "path_ce_rq_job",
       "braille_id": "path_ce_braille"
     },
     summary_panel_options={
       "body_html": '<dl class="wc-summary-list" id="path_ce_summary"></dl>'
     },
     stacktrace_panel_options={
       "panel_id": "path_ce_stacktrace_panel",
       "body_id": "path_ce_stacktrace",
       "description": "Appears when an exception occurs."
     }
   ) %}

  <fieldset class="wc-fieldset">
    <legend class="wc-fieldset__legend">Thresholds</legend>
    <div class="wc-field wc-field--inline">
      <label class="wc-field__label" for="path_ce_sddc_threshold">Sediment Discharge Threshold (tons)</label>
      <input id="path_ce_sddc_threshold" name="sddc_threshold" class="pure-input-1" type="number" step="any" min="0" placeholder="0">
    </div>
    <div class="wc-field wc-field--inline">
      <label class="wc-field__label" for="path_ce_sdyd_threshold">Sediment Yield Threshold (tons)</label>
      <input id="path_ce_sdyd_threshold" name="sdyd_threshold" class="pure-input-1" type="number" step="any" min="0" placeholder="0">
    </div>
  </fieldset>

  <fieldset class="wc-fieldset">
    <legend class="wc-fieldset__legend">Filters</legend>
    <div class="wc-grid wc-grid--2">
      <div class="wc-field">
        <label class="wc-field__label" for="path_ce_slope_min">Slope ≥ (deg)</label>
        <input id="path_ce_slope_min" name="slope_min" class="pure-input-1" type="number" step="any" placeholder="None">
      </div>
      <div class="wc-field">
        <label class="wc-field__label" for="path_ce_slope_max">Slope ≤ (deg)</label>
        <input id="path_ce_slope_max" name="slope_max" class="pure-input-1" type="number" step="any" placeholder="None">
      </div>
    </div>
    <div class="wc-field">
      <label class="wc-field__label" for="path_ce_severity">Burn Severities</label>
      <select id="path_ce_severity" name="severity_filter" class="pure-input-1" multiple size="3">
        <option value="High">High</option>
        <option value="Moderate">Moderate</option>
        <option value="Low">Low</option>
      </select>
      <p class="wc-field__help">Hold Ctrl/Command to select multiple severities. Leave empty to include all.</p>
    </div>
  </fieldset>

  <fieldset class="wc-fieldset">
    <legend class="wc-fieldset__legend">Treatments</legend>
    <div class="wc-field">
      <table class="wc-table" id="path_ce_treatments_table" aria-describedby="path_ce_treatments_help">
        <thead>
          <tr>
            <th scope="col">Label</th>
            <th scope="col">Scenario Key</th>
            <th scope="col">Quantity</th>
            <th scope="col">Unit Cost ($/ton)</th>
            <th scope="col">Fixed Cost ($)</th>
            <th scope="col" class="wc-table__actions">Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p id="path_ce_treatments_help" class="wc-field__help">
        Map UI-facing treatment labels to Omni scenario keys. Costs drive optimization; leave at 0 to ignore.
      </p>
      <button
        id="path_ce_add_treatment"
        type="button"
        class="pure-button pure-button-secondary"
        data-pathce-action="add-treatment">
        Add Treatment
      </button>
    </div>
  </fieldset>

  {% call button_row() %}
    <button
      id="path_ce_save"
      type="button"
      class="pure-button"
      data-pathce-action="save-config">
      Save Configuration
    </button>
    <button
      id="path_ce_run"
      type="button"
      class="pure-button pure-button-primary disable-readonly"
      data-pathce-action="run">
      Run PATH Cost-Effective
    </button>
  {% endcall %}
  <p id="path_ce_hint" class="wc-field__help" aria-live="polite"></p>

{% endcall %}
