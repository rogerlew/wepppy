{# Doc: controllers_js/README.md â€” Climate Controller Reference (2024 helper migration) #}

{% set monthly_ppts = station.monthlies.ppts %}
{% set monthly_nwds = station.monthlies.nwds %}
{% set monthly_tmax = station.monthlies.tmaxs %}
{% set monthly_tmin = station.monthlies.tmins %}
{% set precip = namespace(totals=[], annual=0) %}
{# MEAN P values in .par files are per storm day; scale by NWDS to get monthly totals #}
{% for i in range(monthly_ppts | length) %}
  {% set total = monthly_ppts[i] * monthly_nwds[i] %}
  {% set precip.totals = precip.totals + [total] %}
  {% set precip.annual = precip.annual + total %}
{% endfor %}
{% set monthly_precip_totals = precip.totals %}
{% set annual_precip = precip.annual %}
{% set average_tmax = mean(monthly_tmax) %}
{% set average_tmin = mean(monthly_tmin) %}

<h3 class="wc-heading wc-heading--sm">Monthly summary</h3>
<h5>{{ title }}</h5>

<div class="wc-stack">
  <div class="wc-summary-pane">
    <dl class="wc-summary-pane__list">
      <div class="wc-summary-pane__item">
        <dt class="wc-summary-pane__term">Average annual precip</dt>
        <dd class="wc-summary-pane__definition">
          {{ unitizer(annual_precip, 'in') | safe }} {{ unitizer_units('in') | safe }}
        </dd>
      </div>
      <div class="wc-summary-pane__item">
        <dt class="wc-summary-pane__term">Average monthly T max</dt>
        <dd class="wc-summary-pane__definition">
          {{ unitizer(average_tmax, 'degf') | safe }} {{ unitizer_units('degf') | safe }}
        </dd>
      </div>
      <div class="wc-summary-pane__item">
        <dt class="wc-summary-pane__term">Average monthly T min</dt>
        <dd class="wc-summary-pane__definition">
          {{ unitizer(average_tmin, 'degf') | safe }} {{ unitizer_units('degf') | safe }}
        </dd>
      </div>
    </dl>
  </div>

  <div class="wc-table-wrapper">
    <table class="wc-table wc-table--dense">
      <thead>
        <tr>
          <th scope="col">Metric</th>
          <th scope="col" class="wc-text-center">Jan</th>
          <th scope="col" class="wc-text-center">Feb</th>
          <th scope="col" class="wc-text-center">Mar</th>
          <th scope="col" class="wc-text-center">Apr</th>
          <th scope="col" class="wc-text-center">May</th>
          <th scope="col" class="wc-text-center">Jun</th>
          <th scope="col" class="wc-text-center">Jul</th>
          <th scope="col" class="wc-text-center">Aug</th>
          <th scope="col" class="wc-text-center">Sep</th>
          <th scope="col" class="wc-text-center">Oct</th>
          <th scope="col" class="wc-text-center">Nov</th>
          <th scope="col" class="wc-text-center">Dec</th>
          <th scope="col">Units</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row">Mean precip</th>
          {% for value in monthly_precip_totals %}
          <td class="wc-text-right">{{ unitizer(value, 'in') | safe }}</td>
          {% endfor %}
          <td>{{ unitizer_units('in') | safe }}</td>
        </tr>
        <tr>
          <th scope="row">Num wet days</th>
          {% for value in monthly_nwds %}
          <td class="wc-text-right">{{ value | round | int }}</td>
          {% endfor %}
          <td>days</td>
        </tr>
        <tr>
          <th scope="row">T max</th>
          {% for value in monthly_tmax %}
          <td class="wc-text-right">{{ unitizer(value, 'degf') | safe }}</td>
          {% endfor %}
          <td>{{ unitizer_units('degf') | safe }}</td>
        </tr>
        <tr>
          <th scope="row">T min</th>
          {% for value in monthly_tmin %}
          <td class="wc-text-right">{{ unitizer(value, 'degf') | safe }}</td>
          {% endfor %}
          <td>{{ unitizer_units('degf') | safe }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
