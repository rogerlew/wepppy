{# Doc: controllers_js/README.md â€” Omni Controller Reference (2024 helper migration) #}
{% import "controls/_pure_macros.html" as ui %}
{% from "shared/console_macros.htm" import button_row %}

{% set description %}
  <p class="wc-text-muted">
    Configure Omni mitigation scenarios to run after WEPP finishes. The builder lets you mix uniform burn
    severities, treatments, mulching, and uploaded SBS rasters. Scenarios execute in the order listed.
  </p>
  <p class="wc-text-muted">
    SBS map uploads must be GeoTIFF/IMG files 100&nbsp;MB or smaller and should align with the project DEM.
  </p>
{% endset %}

{% call ui.control_shell(
     form_id="omni_form",
     title="Omni Scenario Runner",
     collapsible=True,
     description=description
   ) %}

  <div class="wc-stack">
    <div class="wc-card">
      <div class="wc-card__body wc-stack">
        <div id="scenario-container" class="wc-stack"></div>
        <div class="omni-scenario-actions">
          <div class="omni-scenario-actions__buttons">
            <button id="add-omni-scenario"
                    type="button"
                    class="pure-button pure-button-secondary disable-readonly"
                    data-omni-action="add-scenario">
              Add scenario
            </button>
            <button id="delete-omni-scenarios"
                    type="button"
                    class="pure-button button-error disable-readonly"
                    data-omni-action="delete-selected"
                    disabled>
              Delete selected scenarios
            </button>
          </div>
        </div>
      </div>
    </div>
    <p class="wc-text-muted">
      Mulching and thinning scenarios depend on their base scenario outputs. Place base scenarios ahead of
      derived treatments so Omni can reuse results efficiently.
    </p>
  </div>

  {% call button_row() %}
    <button id="btn_run_omni"
            class="pure-button pure-button-primary disable-readonly"
            type="button"
            data-omni-action="run-scenarios">
      Run Omni
    </button>
  {% endcall %}
  {{ ui.job_hint("hint_run_omni", extra_class="wc-field__help") }}

  <div class="wc-modal" id="omni-delete-modal" data-modal hidden>
    <div class="wc-modal__overlay" data-modal-dismiss></div>
    <div class="wc-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="omniDeleteModalTitle">
      <header class="wc-modal__header">
        <h2 class="wc-modal__title" id="omniDeleteModalTitle">Delete scenarios</h2>
        <button type="button"
                class="wc-modal__close"
                data-modal-dismiss
                aria-label="Close delete scenarios dialog">
          &times;
        </button>
      </header>
      <div class="wc-modal__body">
        <p class="wc-text-muted">The following scenarios and their results will be removed:</p>
        <ul class="wc-list" data-omni-role="delete-list"></ul>
      </div>
      <footer class="wc-modal__footer">
        <button type="button" class="pure-button pure-button-secondary" data-modal-dismiss>Cancel</button>
        <button type="button" class="pure-button button-error" data-omni-action="confirm-delete">
          Delete scenarios
        </button>
      </footer>
    </div>
  </div>

{% endcall %}
