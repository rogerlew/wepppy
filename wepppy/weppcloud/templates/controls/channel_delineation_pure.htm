{% import "controls/_pure_macros.html" as ui %}
{% from "shared/console_macros.htm" import button_row %}

{% call ui.control_shell(
     form_id="build_channels_form",
     title="Channel Delineation"
   ) %}

  <input type="hidden" id="map_center" name="map_center">
  <input type="hidden" id="map_zoom" name="map_zoom">
  <input type="hidden" id="map_bounds" name="map_bounds">
  <input type="hidden" id="map_distance" name="map_distance">

  <div class="wc-stack">
    {{ ui.radio_group(
         "set_extent_mode",
         label="Extent mode",
         layout="horizontal",
         options=[
           {
             "id": "set_extent_mode_map",
             "label": "Use map extent",
             "value": "0",
             "selected": watershed.set_extent_mode == 0,
             "attrs": {"class": "disable-readonly", "data-channel-role": "extent-mode"}
           },
           {
             "id": "set_extent_mode_manual",
             "label": "Specify extent",
             "value": "1",
             "selected": watershed.set_extent_mode == 1,
             "attrs": {"class": "disable-readonly", "data-channel-role": "extent-mode"}
           }
         ]
       ) }}

    <div id="map_bounds_text_group" class="wc-field" style="display: none;">
      <label class="wc-field__label" for="map_bounds_text">Manual extent (south, west, north, east)</label>
      <input
        id="map_bounds_text"
        name="map_bounds_text"
        class="wc-field__control disable-readonly"
        type="text"
        value="{{ watershed.map_bounds_text }}"
        placeholder="-122.52, 44.16, -122.41, 44.23"
        aria-label="south, west, north, east">
    </div>
  </div>

  <div class="unitizer-wrapper">
    <div class="unitizer units-m">
      {% if watershed.delineation_backend_is_topaz or watershed.delineation_backend_is_wbt %}
      <div class="wc-stack">
        <div class="wc-field">
          <label class="wc-field__label" for="input_mcl">
            Minimum channel length (m)
            <a data-toggle="tooltip"
               data-placement="top"
               title="Recommended to use default value.">
              <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
            </a>
          </label>
          <input
            id="input_mcl"
            name="mcl"
            class="wc-field__control disable-readonly"
            type="text"
            value="{{ watershed.mcl | round | int }}"
            data-convert-target="#input_mcl_en"
            data-convert-func="m_to_ft"
            data-convert-decimals="2">
        </div>

        <div class="wc-field">
          <label class="wc-field__label" for="input_csa">
            Critical source area (ha)
            <a data-toggle="tooltip"
               data-placement="top"
               title="The minimum drainage area below which a permanent channel forms.">
              <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
            </a>
          </label>
          <input
            id="input_csa"
            name="csa"
            class="wc-field__control disable-readonly"
            type="text"
            value="{{ watershed.csa | round | int }}"
            data-convert-target="#input_csa_en"
            data-convert-func="ha_to_ac"
            data-convert-decimals="2">
        </div>
      </div>
      {% else %}
      <input type="hidden" id="input_mcl" value="-1" name="mcl">
      <div class="wc-field">
        <label class="wc-field__label" for="input_csa">
          Critical source area
          <a data-toggle="tooltip"
             data-placement="top"
             title="The minimum drainage area below which a permanent channel forms.">
            <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
          </a>
        </label>
        <input
          id="input_csa"
          name="csa"
          class="wc-field__control disable-readonly"
          type="text"
          value="{{ watershed.pkcsa }}">
      </div>
      {% endif %}
    </div>

    <div class="unitizer units-ft">
      {% if watershed.delineation_backend_is_topaz or watershed.delineation_backend_is_wbt %}
      <div class="wc-stack">
        <div class="wc-field">
          <label class="wc-field__label" for="input_mcl_en">
            Minimum channel length (ft)
            <a data-toggle="tooltip"
               data-placement="top"
               title="Recommended to use default value.">
              <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
            </a>
          </label>
          <input
            id="input_mcl_en"
            name="mcl_en"
            class="wc-field__control disable-readonly"
            type="text"
            value="{{ (watershed.mcl * 3.28084) | round | int }}"
            data-convert-target="#input_mcl"
            data-convert-func="ft_to_m"
            data-convert-decimals="2">
        </div>

        <div class="wc-field">
          <label class="wc-field__label" for="input_csa_en">
            Critical source area (acre)
            <a data-toggle="tooltip"
               data-placement="top"
               title="The minimum drainage area below which a permanent channel forms.">
              <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
            </a>
          </label>
          <input
            id="input_csa_en"
            name="csa_en"
            class="wc-field__control disable-readonly"
            type="text"
            value="{{ (watershed.csa * 2.47105) | round | int }}"
            data-convert-target="#input_csa"
            data-convert-func="ac_to_ha"
            data-convert-decimals="2">
        </div>
      </div>
      {% else %}
      <input type="hidden" id="input_mcl_en" value="-1" name="mcl_en">
      <div class="wc-field">
        <label class="wc-field__label" for="input_csa_en">
          Critical source area
          <a data-toggle="tooltip"
             data-placement="top"
             title="The minimum drainage area below which a permanent channel forms.">
            <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
          </a>
        </label>
        <input
          id="input_csa_en"
          name="csa_en"
          class="wc-field__control disable-readonly"
          type="text"
          value="{{ watershed.pkcsa }}">
      </div>
      {% endif %}
    </div>
  </div>

  {% if watershed.delineation_backend_is_wbt %}
  <div class="wc-stack">
    <div class="wc-field">
      <label class="wc-field__label" for="input_wbt_fill_or_breach">
        Depression smoothing algorithm
        <a data-toggle="tooltip"
           data-placement="top"
           title="Specify whether DEM should be filled or breached.">
          <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
        </a>
      </label>
      <select
        id="input_wbt_fill_or_breach"
        name="wbt_fill_or_breach"
        class="wc-field__control disable-readonly"
        data-channel-role="wbt-fill">
        <option value="fill" {% if watershed.wbt_fill_or_breach=='fill' %}selected{% endif %}>Fill</option>
        <option value="breach" {% if watershed.wbt_fill_or_breach=='breach' %}selected{% endif %}>Breach</option>
        <option value="breach_least_cost" {% if watershed.wbt_fill_or_breach=='breach_least_cost' %}selected{% endif %}>Breach (Least Cost)</option>
      </select>
    </div>

    <div id="wbt_blc_dist_container" class="wc-field">
      <label class="wc-field__label" for="wbt_blc_dist">
        Breach least cost distance (m)
        <a data-toggle="tooltip"
           data-placement="top"
           title="Recommended to use default value.">
          <img src="{{ url_for('static', filename='images/61692-200-24.png') }}" alt="Help">
        </a>
      </label>
      <input
        id="wbt_blc_dist"
        name="wbt_blc_dist"
        class="wc-field__control disable-readonly"
        type="text"
        value="{{ watershed.wbt_blc_dist }}"
        aria-label="Breach least cost distance">
    </div>
  </div>
  {% endif %}

  <div class="wc-stack hide-readonly">
    {% call button_row() %}
      <button
        id="btn_build_channels_en"
        class="pure-button pure-button-primary"
        type="button"
        data-channel-action="build">
        <img
        id="build_channels_en_lock"
        src="{{ url_for('static', filename='open-iconic/png/lock-locked-2x.png') }}"
        alt=""
        style="display:none; margin-right: var(--wc-space-xs);">
        Build Channels
      </button>
    {% endcall %}
    <small id="hint_build_channels_en" class="wc-text-muted"></small>
  </div>

{% endcall %}
