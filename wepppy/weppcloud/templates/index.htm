{% extends "base_pure.htm" %}

{% block title %}WEPPcloud{% endblock %}

{% block header_nav %}
<nav class="wc-nav" aria-label="Primary">
  <a class="wc-nav__link" href="{{ url_for('weppcloud_site.about') }}">About</a>
  {% if current_user.is_authenticated %}
    <a class="wc-nav__link" href="{{ url_for('user.runs') }}">Runs</a>
    <a class="wc-nav__link" href="{{ url_for('user.profile') }}">Profile</a>
    <details class="wc-nav__menu">
      <summary class="wc-nav__menu-button">More</summary>
      <div class="wc-nav__menu-content">
        {% if current_user.has_role('Admin') %}
          <a class="pure-button pure-button-secondary"
             href="{{ url_for('admin.allruns') }}"
             rel="noopener">
            All Runs
          </a>
        {% endif %}
        {% if current_user.has_role('Root') %}
          <a class="pure-button pure-button-secondary"
             href="{{ url_for('admin.usermod') }}"
             rel="noopener">
            Usermod
          </a>
        {% endif %}
        {% if current_user.has_role('Root') or current_user.has_role('Admin') or current_user.has_role('Dev') %}
          <a class="pure-button pure-button-secondary"
             href="{{ url_for('admin.runid_query') }}"
             rel="noopener">
            Runid Query
          </a>
        {% endif %}
        <a class="pure-button pure-button-secondary"
           href="{{ url_for('security.logout') }}"
           rel="noopener">
          Logout
        </a>
      </div>
    </details>
  {% else %}
    <a class="wc-nav__link" href="{{ url_for('security.login') }}">Login</a>
  {% endif %}
</nav>
{% endblock %}

{% block body %}
<div class="wc-stack">
  <div id="run-context-menu" class="wc-context-menu" aria-hidden="true" role="menu">
    <p class="wc-context-menu__title">Launch interface with units</p>
    <div class="wc-context-menu__actions">
      <button type="button" class="pure-button" data-unitizer="false" role="menuitem">SI</button>
      <button type="button" class="pure-button pure-button-secondary" data-unitizer="true" role="menuitem">English</button>
    </div>
  </div>

  <section class="wc-banner wc-stack" aria-label="WEPPcloud updates">
    <p class="wc-banner__lead">Stay up to date with WEPPcloud video tutorials and documentation.</p>
    <div class="wc-banner__links">
      <a href="https://www.youtube.com/@fswepp4700" target="_blank" rel="noopener">
        <img src="{{ url_for('static', filename='images/youtube.png') }}" alt="" class="wc-banner__icon" />
        Visit the WEPPcloud YouTube channel
      </a>
      <a href="https://doc.wepp.cloud">Documentation &amp; QuickStart Guide</a>
    </div>
  </section>

  <section class="wc-panel" aria-labelledby="section-disturbed">
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/disturbed.png') }}" alt="Disturbed interface illustration" />
      </div>
      <div class="wc-feature__body">
        <h2 id="section-disturbed">WEPPcloud-(Un)Disturbed for United States</h2>
        <p>
          The WEPPcloud-Disturbed interface allows users to upload burn severity maps and predict erosion based on fire impacts.
          Unburned conditions can be analysed by skipping the burn severity map. SSURGO-derived soils and NLCD landuse parameterize
          unburned runs, while fire and treatment scenarios procedurally generate soils and managements from the disturbed database
          using soil texture and landuse.
        </p>
        <p>
          This workflow enables meaningful comparisons across unburned, burned, and treatment conditions and incorporates the Wildfire
          Ash Transport And Risk estimation tool (WATAR). In the long term Disturbed is envisioned to replace the WEPPcloud-PEP interface.
        </p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="{{ url_for('run_0.create', config='disturbed9002') }}" title="disturbed9002" data-run-menu rel="nofollow">Start Disturbed Run (CONUS)</a>
          <a class="pure-button" href="{{ url_for('run_0.create', config='disturbed-hi') }}" title="disturbed-hi" data-run-menu rel="nofollow">Start Disturbed-Hawaii Run (Experimental)</a>
          <a class="pure-button" href="{{ url_for('run_0.create', config='disturbed-ak') }}" title="disturbed-ak" data-run-menu rel="nofollow">Start Disturbed-Alaska Run (Experimental)</a>
        </div>
        <p class="wc-feature__metrics">
          {{ runs_counter['disturbed_projects'] }} projects and {{ commafy(runs_counter['disturbed_hillruns']) }} hillslopes ({{ commafy(runs_counter['disturbed_ash_hillruns']) }} WATAR hillslopes) ran since January 1, 2024.
        </p>
      </div>
    </article>
  </section>

  <section class="wc-panel" aria-labelledby="section-revegetation">
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/revegetation.webp') }}" alt="Revegetation interface illustration" />
      </div>
      <div class="wc-feature__body">
        <h2 id="section-revegetation">WEPPcloud-Revegetation for United States</h2>
        <p>
          The WEPPcloud-Revegetation interface supports burn severity uploads and leverages historical vegetative cover data from the
          <a href="https://rangelands.app/">Rangeland Analysis Platform (RAP)</a> to model post-fire hydrology and erosion.
          Users can simulate stochastic wildfires, recovery trajectories, and cover transformations across perennial, annual, shrub,
          and tree components following the fire event.
        </p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="{{ url_for('run_0.create', config='reveg') }}" title="reveg" data-run-menu rel="nofollow">Start Revegetation Run (CONUS)</a>
          <a class="pure-button" href="{{ url_for('run_0.create', config='reveg-mofe') }}" title="reveg-mofe" data-run-menu rel="nofollow">Start Multiple OFE Revegetation Run (CONUS)</a>
          <a class="pure-button" href="{{ url_for('run_0.create', config='reveg-10m-mofe') }}" title="reveg-10m-mofe" data-run-menu rel="nofollow">Start 10m Multiple OFE Revegetation Run (CONUS)</a>
          <a class="pure-button pure-button-secondary" href="{{ url_for('run_0.create', config='disturbed-ak') }}" title="disturbed-ak" data-run-menu rel="nofollow">Start Disturbed-Alaska Run (Experimental)</a>
        </div>
        <p class="wc-feature__metrics">
          {{ runs_counter['reveg_projects'] }} projects and {{ commafy(runs_counter['reveg_hillruns']) }} hillslopes ran since January 1, 2024.
        </p>
      </div>
    </article>
  </section>

  <section class="wc-panel" aria-labelledby="section-eu">
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/europe.png') }}" alt="European interface illustration" />
      </div>
      <div class="wc-feature__body">
        <h2 id="section-eu">WEPPcloud-EU</h2>
        <p>WEPPcloud for Europe uses ESDAC landuses to assign managements and builds soils from ESDAC and EU-SoilHydroGrids data. U.S. climate stations are selected using E-OBS monthly precipitation and temperature patterns.</p>
        <p>
          The PeP interfaces extend post-fire erosion modeling and WATAR ash transport modeling by parameterizing soils based on burn severity and soil texture via Disturbed WEPP soil files.
        </p>
        <p>
          This project has received funding from the European Union's Horizon 2020 research and innovation programme under grant agreement No 10100389.
        </p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="{{ url_for('run_0.create', config='eu-disturbed') }}" title="eu-disturbed" data-run-menu rel="nofollow">Start EU WEPPcloud-Disturbed Run</a>
        </div>
        <p class="wc-feature__metrics">
          {{ runs_counter['eu_projects'] }} EU projects and {{ commafy(runs_counter['eu_hillruns']) }} hillslopes ran since January 1, 2024.
          EU WATAR hillslopes ran since January 1, 2023 {{ commafy(runs_counter['eu_ash_hillruns']) }}.
        </p>
      </div>
    </article>
  </section>

  <section class="wc-panel" aria-labelledby="section-au">
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/australia200.png') }}" alt="Australian interface illustration" />
      </div>
      <div class="wc-feature__body">
        <h2 id="section-au">WEPPcloud-AU</h2>
        <p>WEPPcloud for Australia assigns managements from the Land Use of Australia 2010-11 dataset and constructs soils from ASRIS data. U.S. climate stations are selected using AGDC monthly precipitation and temperature patterns.</p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="{{ url_for('run_0.create', config='au-disturbed') }}" title="au-disturbed" data-run-menu rel="nofollow">Start AU-Disturbed WEPPcloud Run w/ WATAR (Experimental)</a>
        </div>
        <p class="wc-feature__metrics">
          {{ runs_counter['au_projects'] }} EU projects and {{ commafy(runs_counter['au_hillruns']) }} hillslopes ran since January 1, 2024.
          EU WATAR hillslopes ran since January 1, 2023 {{ commafy(runs_counter['au_ash_hillruns']) }}.
        </p>
      </div>
    </article>
  </section>

  <section class="wc-panel" aria-labelledby="section-rhem">
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/rhem.png') }}" alt="RHEM interface illustration" />
      </div>
      <div class="wc-feature__body">
        <h2 id="section-rhem">WEPPcloud-RHEM</h2>
        <p>
          Run the Rangeland Hydrology and Erosion Model (RHEM) across the United States. Where available, foliar and ground covers are
          estimated from NLCD Shrubland 2016 data, while SURGO/STATSGO identifies soil textures.
        </p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="{{ url_for('run_0.create', config='rhem') }}" title="rhem" data-run-menu rel="nofollow">Start RHEM Run (Experimental)</a>
        </div>
        <p class="wc-feature__metrics">
          {{ runs_counter['rhem_projects'] }} RHEM projects and {{ commafy(runs_counter['rhem_hillruns']) }} RHEM hillslopes ran since January 1, 2024.
        </p>
      </div>
    </article>
  </section>

  <section class="wc-panel wc-stack" aria-labelledby="section-site-resources">
    <h2 id="section-site-resources">Site Specific Resources</h2>
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/lt.jpg') }}" alt="Lake Tahoe project" />
      </div>
      <div class="wc-feature__body">
        <h3>Lake Tahoe</h3>
        <p>The Lake Tahoe project incorporates region-specific soil, phosphorus, and estimated soil burn severity datasets.</p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="lt" rel="nofollow">View Results and Run WEPP</a>
        </div>
      </div>
    </article>
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/widlfire_credit_NOAA_DanBorsum.jpg') }}" alt="Hazard SEES FireEarth project" />
      </div>
      <div class="wc-feature__body">
        <h3>Hazards and Disasters (Hazard SEES) - FireEarth Project</h3>
        <p>Data portals related to the Hazard SEES - FireEarth Project.</p>
        <div class="wc-feature__actions">
          {% if current_user.has_role('PortlandGroup') %}
          <a class="pure-button" href="portland-municipal" rel="nofollow">Portland Municipal Watersheds</a>
          {% endif %}
          <a class="pure-button" href="seattle-municipal" rel="nofollow">Seattle Municipal Watersheds</a>
        </div>
      </div>
    </article>
  </section>

  <section class="wc-panel wc-stack" aria-labelledby="section-legacy">
    <h2 id="section-legacy">Legacy Interfaces</h2>
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/0.jpg') }}" alt="Legacy WEPPcloud interface" />
      </div>
      <div class="wc-feature__body">
        <h3>WEPPcloud</h3>
        <p>
          Run WEPP anywhere in the continental United States. Legacy interface. Since 2021 we recommend using WEPPcloud-US instead of WEPP-PEP.
          WEPP-PEP is limited to four general soils based on textures, whereas WEPPcloud-Disturbed incorporates spatial soil variability from
          SSURGO/STATSGO databases. Elevation data is sourced from the USGS National Elevation Set, watersheds are delineated with TOPAZ, soils
          originate from SURGO/STATSGO, landcover from the USGS National Landcover dataset, and climates from the CLIGEN database.
        </p>
        <p><strong>This interface has been deprecated. For new projects run (Un)Disturbed without a burn severity map.</strong></p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="{{ url_for('run_0.create', config='0') }}" rel="nofollow">Start WEPPcloud Run</a>
          <a class="pure-button pure-button-secondary" href="{{ url_for('run_0.create', config='13') }}" rel="nofollow">10m (Experimental)</a>
        </div>
        <p class="wc-feature__metrics">
          {{ runs_counter['0_projects'] }} projects and {{ commafy(runs_counter['0_hillruns']) }} hillslopes ran since January 1, 2024.
        </p>
      </div>
    </article>
    <article class="wc-feature">
      <div class="wc-feature__media">
        <img src="{{ url_for('static', filename='images/interfaces/baer.jpg') }}" alt="WEPPcloud-PEP interface" />
      </div>
      <div class="wc-feature__body">
        <h3>WEPPcloud-PEP w/ WATAR</h3>
        <p>
          The WEPPcloud Post-Fire Erosion Prediction (PEP) interface allows users to upload burn severity maps and predict erosion based on fire severity.
          Legacy interface. We recommend migrating to WEPPcloud-(Un)Disturbed for new projects. WEPPcloud-PEP is limited to four general soils based on textures,
          whereas WEPPcloud-Disturbed captures spatial soil variability from SSURGO/STATSGO. Soil textures are identified from SSURGO and unburned conditions
          use 2006.2 forest soils and managements based on soil texture. Burned areas are assigned burned soils and managements aligned to texture.
          The PeP interface incorporates the Wildfire Ash Transport And Risk estimation tool (WATAR).
        </p>
        <p>
          <a href="https://youtu.be/g8_ClR96tFU">View 15 May 2019 USDA Forest Service Webinar: <em>An Introduction to WEPPcloud-PEP</em></a>
        </p>
        <p><strong>This interface has been deprecated. For new projects run (Un)Disturbed without a burn severity map.</strong></p>
        <div class="wc-feature__actions">
          <a class="pure-button" href="{{ url_for('run_0.create', config='baer') }}" rel="nofollow">Start WEPPcloud Run</a>
        </div>
        <p class="wc-feature__metrics">
          {{ runs_counter['baer_projects'] }} projects and {{ commafy(runs_counter['baer_hillruns']) }} hillslopes ({{ commafy(runs_counter['baer_ash_hillruns']) }} WATAR hillslopes) ran since January 1, 2024.
        </p>
        <p>
          <a href="{{ url_for('static', filename='resources/baer/Rattlesnake.tif') }}">Download Example 4 Class SBS Map (Rattlesnake Fire)</a>
        </p>
      </div>
    </article>
  </section>

  <section class="wc-panel wc-stack" aria-label="Utilities and documentation">
    <div class="wc-stack">
      <div>
        <h3>WEPPcloud Utilities</h3>
        <a href="combined_ws_viewer/url_generator/">Combined Watershed Viewer URL Generator</a>
      </div>
      <div>
        <h3>WEPPcloud Test Watersheds</h3>
        <a href="joh/">Test Watersheds</a>
      </div>
      <div>
        <h3>Contact</h3>
        <p>For technical assistance please contact Roger Lew at <a href="mailto:rogerlew@uidaho.edu">rogerlew@uidaho.edu</a>.</p>
        <p>For other requests please contact Mariana Dobre at <a href="mailto:mdobre@uidaho.edu">mdobre@uidaho.edu</a> or Roger Lew at <a href="mailto:rogerlew@uidaho.edu">rogerlew@uidaho.edu</a>.</p>
      </div>
      <div>
        <h3>Documentation</h3>
        <p>WEPPcloud Documentation can be found at <a href="https://doc.wepp.cloud">https://doc.wepp.cloud</a>.</p>
      </div>
    </div>
  </section>

  <section class="wc-panel wc-stack" aria-labelledby="section-sponsors">
    <h2 id="section-sponsors">Sponsors</h2>
    <div class="wc-stack">
      <div>
        <a href="https://www.idahoecosystems.org/">
          NSF Idaho EPSCoR
        </a>
        <p>This work was made possible by the NSF Idaho EPSCoR Program and by the National Science Foundation under award number IIA-1301792.</p>
      </div>
      <div>
        <a href="https://www.usda.gov/">
          USDA
        </a>
        <p>This work is supported by AFRI program [grant no2016-67020-25320/project accession no. 1009827] from the USDA National Institute of Food and Agriculture.</p>
      </div>
      <div>
        <a href="https://www.ukri.org/">
          UKRI / NERC
        </a>
        <p>
          The Wildfire Ash Transport And Risk estimation tool (WATAR) was made possible with collaboration from Swansea University (Jonay Neris, Stefan Doerr) and the US Forest Service (Pete Robichaud, William Elliott),
          and funding provided by UK NERC Grant NE/R011125/1 and European Commission (H2020 FirEUrisk project no. 101003890).
        </p>
      </div>
      <div>
        <a href="https://www.nasa.gov/">
          NASA Western Water Applications Office
        </a>
        <p>The revegetation module in WEPPcloud was supported by NASA's Western Water Application Office (WWAO).</p>
      </div>
    </div>
  </section>

  <section class="wc-panel wc-stack" aria-labelledby="section-affiliations">
    <h2 id="section-affiliations">Affiliations and Collaborators</h2>
    <div class="wc-stack">
      <div>
        <a href="https://www.uidaho.edu/">
          University of Idaho
        </a>
        <p>Go Vandals! <a href="https://uidaho.edu/">University of Idaho</a></p>
      </div>
      <div>
        <a href="https://research-and-innovation.ec.europa.eu/funding/funding-opportunities/funding-programmes-and-open-calls/horizon-2020_en/">
          European Union Horizon 2020
        </a>
        <p>
          WEPPcloud EU has received funding from the European Union's Horizon 2020 research and innovation programme under grant agreement No 101003890.
        </p>
      </div>
      <div>
        <a href="https://www.swansea.ac.uk/">
          Swansea University
        </a>
        <p><em>Gweddw Crefft Heb Ei Dawn</em> Technical Skill is Bereft Without Culture. <a href="https://www.swansea.ac.uk/">Swansea University</a></p>
      </div>
      <div>
        <a href="https://www.fs.fed.us/">
          USDA Forest Service
        </a>
        <p>
          Caring for the land and serving people. <a href="https://www.fs.usda.gov/research/rmrs">Rocky Mountain Research Station</a>
        </p>
      </div>
      <div>
        <a href="https://hpc.uidaho.edu/">
          University of Idaho Research Computing &amp; Data Services
        </a>
        <p>
          WEPPcloud is proudly hosted by the <a href="https://hpc.uidaho.edu/">University of Idaho Research Computing + Data Services</a>.
        </p>
      </div>
    </div>
    <div>
      <p><strong>wepppy</strong></p>
      <p>Powered by wepppy <a href="https://github.com/rogerlew/wepppy">https://github.com/rogerlew/wepppy</a></p>
    </div>
  </section>

  <section class="wc-panel wc-stack" aria-label="Project acknowledgements">
    <div>
      <h3>Contributors</h3>
      <p>Roger Lew, Mariana Dobre, William Elliot, Pete Robichaud, Erin Brooks, Anurag Srivastava, Jim Frakenberger, Jonay Neris, Stefan Doerr, Cristina Santin, Mary E. Miller.</p>
    </div>
    <div>
      <h3>Attributions</h3>
      <p>Map baselayers provided by Google (Terrain, Satellite) and USGS (NLCD).</p>
    </div>
    <div>
      <h3>Legal Disclaimer</h3>
      <p>
        THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
        INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
        DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
        SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
        SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
        WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
        THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
      </p>
    </div>
  </section>
</div>
{% endblock %}

{% block script_extras %}
<script src="{{ url_for('static', filename='js/controllers.js') }}" defer></script>
<script>
(() => {
  const contextMenu = document.getElementById('run-context-menu');
  if (!contextMenu) {
    return;
  }

  let activeLink = null;

  const hideMenu = () => {
    contextMenu.setAttribute('aria-hidden', 'true');
    contextMenu.style.left = '-9999px';
    contextMenu.style.top = '-9999px';
    activeLink = null;
  };

  const showMenu = (event, link) => {
    event.preventDefault();
    activeLink = link;
    contextMenu.style.left = `${event.clientX}px`;
    contextMenu.style.top = `${event.clientY}px`;
    contextMenu.setAttribute('aria-hidden', 'false');
  };

  const onDocumentClick = (event) => {
    if (!contextMenu.contains(event.target)) {
      hideMenu();
    }
  };

  hideMenu();

  document.querySelectorAll('[data-run-menu]').forEach((link) => {
    link.addEventListener('contextmenu', (event) => {
      showMenu(event, link);
      document.addEventListener('click', onDocumentClick, { once: true });
    });
  });

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      hideMenu();
    }
  });

  contextMenu.querySelectorAll('[data-unitizer]').forEach((button) => {
    button.addEventListener('click', () => {
      if (!activeLink) {
        return;
      }

      const url = new URL(activeLink.href, window.location.origin);
      url.searchParams.set('unitizer:is_english', button.dataset.unitizer === 'true');
      window.location.href = url.toString();
      hideMenu();
    });
  });
})();
</script>
{% endblock %}
